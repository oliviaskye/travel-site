var v6=Object.defineProperty;var x6=(e,t,i)=>t in e?v6(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var fr=(e,t,i)=>x6(e,typeof t!="symbol"?t+"":t,i);function b6(e,t){for(var i=0;i<t.length;i++){const l=t[i];if(typeof l!="string"&&!Array.isArray(l)){for(const d in l)if(d!=="default"&&!(d in e)){const y=Object.getOwnPropertyDescriptor(l,d);y&&Object.defineProperty(e,d,y.get?y:{enumerable:!0,get:()=>l[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const y of d)if(y.type==="childList")for(const S of y.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&l(S)}).observe(document,{childList:!0,subtree:!0});function i(d){const y={};return d.integrity&&(y.integrity=d.integrity),d.referrerPolicy&&(y.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?y.credentials="include":d.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function l(d){if(d.ep)return;d.ep=!0;const y=i(d);fetch(d.href,y)}})();var BO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ly(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function rM(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function l(){return this instanceof l?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(l){var d=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(i,l,d.get?d:{enumerable:!0,get:function(){return e[l]}})}),i}var NO={exports:{}},wn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cy=Symbol.for("react.element"),w6=Symbol.for("react.portal"),S6=Symbol.for("react.fragment"),T6=Symbol.for("react.strict_mode"),E6=Symbol.for("react.profiler"),M6=Symbol.for("react.provider"),C6=Symbol.for("react.context"),I6=Symbol.for("react.forward_ref"),P6=Symbol.for("react.suspense"),A6=Symbol.for("react.memo"),D6=Symbol.for("react.lazy"),DD=Symbol.iterator;function R6(e){return e===null||typeof e!="object"?null:(e=DD&&e[DD]||e["@@iterator"],typeof e=="function"?e:null)}var UO={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jO=Object.assign,VO={};function Vp(e,t,i){this.props=e,this.context=t,this.refs=VO,this.updater=i||UO}Vp.prototype.isReactComponent={};Vp.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Vp.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function $O(){}$O.prototype=Vp.prototype;function nM(e,t,i){this.props=e,this.context=t,this.refs=VO,this.updater=i||UO}var iM=nM.prototype=new $O;iM.constructor=nM;jO(iM,Vp.prototype);iM.isPureReactComponent=!0;var RD=Array.isArray,WO=Object.prototype.hasOwnProperty,oM={current:null},GO={key:!0,ref:!0,__self:!0,__source:!0};function HO(e,t,i){var l,d={},y=null,S=null;if(t!=null)for(l in t.ref!==void 0&&(S=t.ref),t.key!==void 0&&(y=""+t.key),t)WO.call(t,l)&&!GO.hasOwnProperty(l)&&(d[l]=t[l]);var R=arguments.length-2;if(R===1)d.children=i;else if(1<R){for(var a=Array(R),N=0;N<R;N++)a[N]=arguments[N+2];d.children=a}if(e&&e.defaultProps)for(l in R=e.defaultProps,R)d[l]===void 0&&(d[l]=R[l]);return{$$typeof:cy,type:e,key:y,ref:S,props:d,_owner:oM.current}}function k6(e,t){return{$$typeof:cy,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function aM(e){return typeof e=="object"&&e!==null&&e.$$typeof===cy}function O6(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var kD=/\/+/g;function AS(e,t){return typeof e=="object"&&e!==null&&e.key!=null?O6(""+e.key):t.toString(36)}function tx(e,t,i,l,d){var y=typeof e;(y==="undefined"||y==="boolean")&&(e=null);var S=!1;if(e===null)S=!0;else switch(y){case"string":case"number":S=!0;break;case"object":switch(e.$$typeof){case cy:case w6:S=!0}}if(S)return S=e,d=d(S),e=l===""?"."+AS(S,0):l,RD(d)?(i="",e!=null&&(i=e.replace(kD,"$&/")+"/"),tx(d,t,i,"",function(N){return N})):d!=null&&(aM(d)&&(d=k6(d,i+(!d.key||S&&S.key===d.key?"":(""+d.key).replace(kD,"$&/")+"/")+e)),t.push(d)),1;if(S=0,l=l===""?".":l+":",RD(e))for(var R=0;R<e.length;R++){y=e[R];var a=l+AS(y,R);S+=tx(y,t,i,a,d)}else if(a=R6(e),typeof a=="function")for(e=a.call(e),R=0;!(y=e.next()).done;)y=y.value,a=l+AS(y,R++),S+=tx(y,t,i,a,d);else if(y==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return S}function Sv(e,t,i){if(e==null)return e;var l=[],d=0;return tx(e,l,"","",function(y){return t.call(i,y,d++)}),l}function L6(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var na={current:null},rx={transition:null},z6={ReactCurrentDispatcher:na,ReactCurrentBatchConfig:rx,ReactCurrentOwner:oM};function qO(){throw Error("act(...) is not supported in production builds of React.")}wn.Children={map:Sv,forEach:function(e,t,i){Sv(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return Sv(e,function(){t++}),t},toArray:function(e){return Sv(e,function(t){return t})||[]},only:function(e){if(!aM(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};wn.Component=Vp;wn.Fragment=S6;wn.Profiler=E6;wn.PureComponent=nM;wn.StrictMode=T6;wn.Suspense=P6;wn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z6;wn.act=qO;wn.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var l=jO({},e.props),d=e.key,y=e.ref,S=e._owner;if(t!=null){if(t.ref!==void 0&&(y=t.ref,S=oM.current),t.key!==void 0&&(d=""+t.key),e.type&&e.type.defaultProps)var R=e.type.defaultProps;for(a in t)WO.call(t,a)&&!GO.hasOwnProperty(a)&&(l[a]=t[a]===void 0&&R!==void 0?R[a]:t[a])}var a=arguments.length-2;if(a===1)l.children=i;else if(1<a){R=Array(a);for(var N=0;N<a;N++)R[N]=arguments[N+2];l.children=R}return{$$typeof:cy,type:e.type,key:d,ref:y,props:l,_owner:S}};wn.createContext=function(e){return e={$$typeof:C6,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:M6,_context:e},e.Consumer=e};wn.createElement=HO;wn.createFactory=function(e){var t=HO.bind(null,e);return t.type=e,t};wn.createRef=function(){return{current:null}};wn.forwardRef=function(e){return{$$typeof:I6,render:e}};wn.isValidElement=aM;wn.lazy=function(e){return{$$typeof:D6,_payload:{_status:-1,_result:e},_init:L6}};wn.memo=function(e,t){return{$$typeof:A6,type:e,compare:t===void 0?null:t}};wn.startTransition=function(e){var t=rx.transition;rx.transition={};try{e()}finally{rx.transition=t}};wn.unstable_act=qO;wn.useCallback=function(e,t){return na.current.useCallback(e,t)};wn.useContext=function(e){return na.current.useContext(e)};wn.useDebugValue=function(){};wn.useDeferredValue=function(e){return na.current.useDeferredValue(e)};wn.useEffect=function(e,t){return na.current.useEffect(e,t)};wn.useId=function(){return na.current.useId()};wn.useImperativeHandle=function(e,t,i){return na.current.useImperativeHandle(e,t,i)};wn.useInsertionEffect=function(e,t){return na.current.useInsertionEffect(e,t)};wn.useLayoutEffect=function(e,t){return na.current.useLayoutEffect(e,t)};wn.useMemo=function(e,t){return na.current.useMemo(e,t)};wn.useReducer=function(e,t,i){return na.current.useReducer(e,t,i)};wn.useRef=function(e){return na.current.useRef(e)};wn.useState=function(e){return na.current.useState(e)};wn.useSyncExternalStore=function(e,t,i){return na.current.useSyncExternalStore(e,t,i)};wn.useTransition=function(){return na.current.useTransition()};wn.version="18.3.1";NO.exports=wn;var we=NO.exports;const ne=ly(we),bx=b6({__proto__:null,default:ne},[we]);var ZO={exports:{}},qa={},YO={exports:{}},XO={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ht,Dt){var Tt=ht.length;ht.push(Dt);e:for(;0<Tt;){var tr=Tt-1>>>1,Vr=ht[tr];if(0<d(Vr,Dt))ht[tr]=Dt,ht[Tt]=Vr,Tt=tr;else break e}}function i(ht){return ht.length===0?null:ht[0]}function l(ht){if(ht.length===0)return null;var Dt=ht[0],Tt=ht.pop();if(Tt!==Dt){ht[0]=Tt;e:for(var tr=0,Vr=ht.length,Nr=Vr>>>1;tr<Nr;){var ct=2*(tr+1)-1,$t=ht[ct],Ht=ct+1,Bt=ht[Ht];if(0>d($t,Tt))Ht<Vr&&0>d(Bt,$t)?(ht[tr]=Bt,ht[Ht]=Tt,tr=Ht):(ht[tr]=$t,ht[ct]=Tt,tr=ct);else if(Ht<Vr&&0>d(Bt,Tt))ht[tr]=Bt,ht[Ht]=Tt,tr=Ht;else break e}}return Dt}function d(ht,Dt){var Tt=ht.sortIndex-Dt.sortIndex;return Tt!==0?Tt:ht.id-Dt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;e.unstable_now=function(){return y.now()}}else{var S=Date,R=S.now();e.unstable_now=function(){return S.now()-R}}var a=[],N=[],G=1,q=null,X=3,oe=!1,te=!1,ie=!1,pe=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(ht){for(var Dt=i(N);Dt!==null;){if(Dt.callback===null)l(N);else if(Dt.startTime<=ht)l(N),Dt.sortIndex=Dt.expirationTime,t(a,Dt);else break;Dt=i(N)}}function Me(ht){if(ie=!1,ce(ht),!te)if(i(a)!==null)te=!0,gt(Le);else{var Dt=i(N);Dt!==null&&Ze(Me,Dt.startTime-ht)}}function Le(ht,Dt){te=!1,ie&&(ie=!1,se(je),je=-1),oe=!0;var Tt=X;try{for(ce(Dt),q=i(a);q!==null&&(!(q.expirationTime>Dt)||ht&&!et());){var tr=q.callback;if(typeof tr=="function"){q.callback=null,X=q.priorityLevel;var Vr=tr(q.expirationTime<=Dt);Dt=e.unstable_now(),typeof Vr=="function"?q.callback=Vr:q===i(a)&&l(a),ce(Dt)}else l(a);q=i(a)}if(q!==null)var Nr=!0;else{var ct=i(N);ct!==null&&Ze(Me,ct.startTime-Dt),Nr=!1}return Nr}finally{q=null,X=Tt,oe=!1}}var Je=!1,Qe=null,je=-1,Ct=5,ye=-1;function et(){return!(e.unstable_now()-ye<Ct)}function dt(){if(Qe!==null){var ht=e.unstable_now();ye=ht;var Dt=!0;try{Dt=Qe(!0,ht)}finally{Dt?Xt():(Je=!1,Qe=null)}}else Je=!1}var Xt;if(typeof le=="function")Xt=function(){le(dt)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,yt=Mt.port2;Mt.port1.onmessage=dt,Xt=function(){yt.postMessage(null)}}else Xt=function(){pe(dt,0)};function gt(ht){Qe=ht,Je||(Je=!0,Xt())}function Ze(ht,Dt){je=pe(function(){ht(e.unstable_now())},Dt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ht){ht.callback=null},e.unstable_continueExecution=function(){te||oe||(te=!0,gt(Le))},e.unstable_forceFrameRate=function(ht){0>ht||125<ht?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ct=0<ht?Math.floor(1e3/ht):5},e.unstable_getCurrentPriorityLevel=function(){return X},e.unstable_getFirstCallbackNode=function(){return i(a)},e.unstable_next=function(ht){switch(X){case 1:case 2:case 3:var Dt=3;break;default:Dt=X}var Tt=X;X=Dt;try{return ht()}finally{X=Tt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ht,Dt){switch(ht){case 1:case 2:case 3:case 4:case 5:break;default:ht=3}var Tt=X;X=ht;try{return Dt()}finally{X=Tt}},e.unstable_scheduleCallback=function(ht,Dt,Tt){var tr=e.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?tr+Tt:tr):Tt=tr,ht){case 1:var Vr=-1;break;case 2:Vr=250;break;case 5:Vr=1073741823;break;case 4:Vr=1e4;break;default:Vr=5e3}return Vr=Tt+Vr,ht={id:G++,callback:Dt,priorityLevel:ht,startTime:Tt,expirationTime:Vr,sortIndex:-1},Tt>tr?(ht.sortIndex=Tt,t(N,ht),i(a)===null&&ht===i(N)&&(ie?(se(je),je=-1):ie=!0,Ze(Me,Tt-tr))):(ht.sortIndex=Vr,t(a,ht),te||oe||(te=!0,gt(Le))),ht},e.unstable_shouldYield=et,e.unstable_wrapCallback=function(ht){var Dt=X;return function(){var Tt=X;X=Dt;try{return ht.apply(this,arguments)}finally{X=Tt}}}})(XO);YO.exports=XO;var F6=YO.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B6=we,Ha=F6;function Qt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var KO=new Set,L_={};function wd(e,t){Pp(e,t),Pp(e+"Capture",t)}function Pp(e,t){for(L_[e]=t,e=0;e<t.length;e++)KO.add(t[e])}var uc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wT=Object.prototype.hasOwnProperty,N6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,OD={},LD={};function U6(e){return wT.call(LD,e)?!0:wT.call(OD,e)?!1:N6.test(e)?LD[e]=!0:(OD[e]=!0,!1)}function j6(e,t,i,l){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return l?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function V6(e,t,i,l){if(t===null||typeof t>"u"||j6(e,t,i,l))return!0;if(l)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ia(e,t,i,l,d,y,S){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=l,this.attributeNamespace=d,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=y,this.removeEmptyString=S}var Io={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Io[e]=new ia(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Io[t]=new ia(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Io[e]=new ia(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Io[e]=new ia(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Io[e]=new ia(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Io[e]=new ia(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Io[e]=new ia(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Io[e]=new ia(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Io[e]=new ia(e,5,!1,e.toLowerCase(),null,!1,!1)});var sM=/[\-:]([a-z])/g;function lM(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(sM,lM);Io[t]=new ia(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(sM,lM);Io[t]=new ia(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(sM,lM);Io[t]=new ia(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Io[e]=new ia(e,1,!1,e.toLowerCase(),null,!1,!1)});Io.xlinkHref=new ia("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Io[e]=new ia(e,1,!1,e.toLowerCase(),null,!0,!0)});function cM(e,t,i,l){var d=Io.hasOwnProperty(t)?Io[t]:null;(d!==null?d.type!==0:l||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(V6(t,i,d,l)&&(i=null),l||d===null?U6(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):d.mustUseProperty?e[d.propertyName]=i===null?d.type===3?!1:"":i:(t=d.attributeName,l=d.attributeNamespace,i===null?e.removeAttribute(t):(d=d.type,i=d===3||d===4&&i===!0?"":""+i,l?e.setAttributeNS(l,t,i):e.setAttribute(t,i))))}var xc=B6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tv=Symbol.for("react.element"),ip=Symbol.for("react.portal"),op=Symbol.for("react.fragment"),uM=Symbol.for("react.strict_mode"),ST=Symbol.for("react.profiler"),JO=Symbol.for("react.provider"),QO=Symbol.for("react.context"),hM=Symbol.for("react.forward_ref"),TT=Symbol.for("react.suspense"),ET=Symbol.for("react.suspense_list"),dM=Symbol.for("react.memo"),wu=Symbol.for("react.lazy"),eL=Symbol.for("react.offscreen"),zD=Symbol.iterator;function $g(e){return e===null||typeof e!="object"?null:(e=zD&&e[zD]||e["@@iterator"],typeof e=="function"?e:null)}var Di=Object.assign,DS;function d_(e){if(DS===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);DS=t&&t[1]||""}return`
`+DS+e}var RS=!1;function kS(e,t){if(!e||RS)return"";RS=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(N){var l=N}Reflect.construct(e,[],t)}else{try{t.call()}catch(N){l=N}e.call(t.prototype)}else{try{throw Error()}catch(N){l=N}e()}}catch(N){if(N&&l&&typeof N.stack=="string"){for(var d=N.stack.split(`
`),y=l.stack.split(`
`),S=d.length-1,R=y.length-1;1<=S&&0<=R&&d[S]!==y[R];)R--;for(;1<=S&&0<=R;S--,R--)if(d[S]!==y[R]){if(S!==1||R!==1)do if(S--,R--,0>R||d[S]!==y[R]){var a=`
`+d[S].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=S&&0<=R);break}}}finally{RS=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?d_(e):""}function $6(e){switch(e.tag){case 5:return d_(e.type);case 16:return d_("Lazy");case 13:return d_("Suspense");case 19:return d_("SuspenseList");case 0:case 2:case 15:return e=kS(e.type,!1),e;case 11:return e=kS(e.type.render,!1),e;case 1:return e=kS(e.type,!0),e;default:return""}}function MT(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case op:return"Fragment";case ip:return"Portal";case ST:return"Profiler";case uM:return"StrictMode";case TT:return"Suspense";case ET:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case QO:return(e.displayName||"Context")+".Consumer";case JO:return(e._context.displayName||"Context")+".Provider";case hM:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case dM:return t=e.displayName||null,t!==null?t:MT(e.type)||"Memo";case wu:t=e._payload,e=e._init;try{return MT(e(t))}catch{}}return null}function W6(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return MT(t);case 8:return t===uM?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ju(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function tL(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function G6(e){var t=tL(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,y=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return d.call(this)},set:function(S){l=""+S,y.call(this,S)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ev(e){e._valueTracker||(e._valueTracker=G6(e))}function rL(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),l="";return e&&(l=tL(e)?e.checked?"true":"false":e.value),e=l,e!==i?(t.setValue(e),!0):!1}function wx(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function CT(e,t){var i=t.checked;return Di({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function FD(e,t){var i=t.defaultValue==null?"":t.defaultValue,l=t.checked!=null?t.checked:t.defaultChecked;i=ju(t.value!=null?t.value:i),e._wrapperState={initialChecked:l,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function nL(e,t){t=t.checked,t!=null&&cM(e,"checked",t,!1)}function IT(e,t){nL(e,t);var i=ju(t.value),l=t.type;if(i!=null)l==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(l==="submit"||l==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?PT(e,t.type,i):t.hasOwnProperty("defaultValue")&&PT(e,t.type,ju(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function BD(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var l=t.type;if(!(l!=="submit"&&l!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function PT(e,t,i){(t!=="number"||wx(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var f_=Array.isArray;function yp(e,t,i,l){if(e=e.options,t){t={};for(var d=0;d<i.length;d++)t["$"+i[d]]=!0;for(i=0;i<e.length;i++)d=t.hasOwnProperty("$"+e[i].value),e[i].selected!==d&&(e[i].selected=d),d&&l&&(e[i].defaultSelected=!0)}else{for(i=""+ju(i),t=null,d=0;d<e.length;d++){if(e[d].value===i){e[d].selected=!0,l&&(e[d].defaultSelected=!0);return}t!==null||e[d].disabled||(t=e[d])}t!==null&&(t.selected=!0)}}function AT(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Qt(91));return Di({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ND(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(Qt(92));if(f_(i)){if(1<i.length)throw Error(Qt(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:ju(i)}}function iL(e,t){var i=ju(t.value),l=ju(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),l!=null&&(e.defaultValue=""+l)}function UD(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function oL(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function DT(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?oL(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Mv,aL=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,l,d){MSApp.execUnsafeLocalFunction(function(){return e(t,i,l,d)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Mv=Mv||document.createElement("div"),Mv.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Mv.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function z_(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var v_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},H6=["Webkit","ms","Moz","O"];Object.keys(v_).forEach(function(e){H6.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),v_[t]=v_[e]})});function sL(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||v_.hasOwnProperty(e)&&v_[e]?(""+t).trim():t+"px"}function lL(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var l=i.indexOf("--")===0,d=sL(i,t[i],l);i==="float"&&(i="cssFloat"),l?e.setProperty(i,d):e[i]=d}}var q6=Di({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function RT(e,t){if(t){if(q6[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Qt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Qt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Qt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Qt(62))}}function kT(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var OT=null;function fM(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var LT=null,vp=null,xp=null;function jD(e){if(e=dy(e)){if(typeof LT!="function")throw Error(Qt(280));var t=e.stateNode;t&&(t=I1(t),LT(e.stateNode,e.type,t))}}function cL(e){vp?xp?xp.push(e):xp=[e]:vp=e}function uL(){if(vp){var e=vp,t=xp;if(xp=vp=null,jD(e),t)for(e=0;e<t.length;e++)jD(t[e])}}function hL(e,t){return e(t)}function dL(){}var OS=!1;function fL(e,t,i){if(OS)return e(t,i);OS=!0;try{return hL(e,t,i)}finally{OS=!1,(vp!==null||xp!==null)&&(dL(),uL())}}function F_(e,t){var i=e.stateNode;if(i===null)return null;var l=I1(i);if(l===null)return null;i=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(Qt(231,t,typeof i));return i}var zT=!1;if(uc)try{var Wg={};Object.defineProperty(Wg,"passive",{get:function(){zT=!0}}),window.addEventListener("test",Wg,Wg),window.removeEventListener("test",Wg,Wg)}catch{zT=!1}function Z6(e,t,i,l,d,y,S,R,a){var N=Array.prototype.slice.call(arguments,3);try{t.apply(i,N)}catch(G){this.onError(G)}}var x_=!1,Sx=null,Tx=!1,FT=null,Y6={onError:function(e){x_=!0,Sx=e}};function X6(e,t,i,l,d,y,S,R,a){x_=!1,Sx=null,Z6.apply(Y6,arguments)}function K6(e,t,i,l,d,y,S,R,a){if(X6.apply(this,arguments),x_){if(x_){var N=Sx;x_=!1,Sx=null}else throw Error(Qt(198));Tx||(Tx=!0,FT=N)}}function Sd(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function pL(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function VD(e){if(Sd(e)!==e)throw Error(Qt(188))}function J6(e){var t=e.alternate;if(!t){if(t=Sd(e),t===null)throw Error(Qt(188));return t!==e?null:e}for(var i=e,l=t;;){var d=i.return;if(d===null)break;var y=d.alternate;if(y===null){if(l=d.return,l!==null){i=l;continue}break}if(d.child===y.child){for(y=d.child;y;){if(y===i)return VD(d),e;if(y===l)return VD(d),t;y=y.sibling}throw Error(Qt(188))}if(i.return!==l.return)i=d,l=y;else{for(var S=!1,R=d.child;R;){if(R===i){S=!0,i=d,l=y;break}if(R===l){S=!0,l=d,i=y;break}R=R.sibling}if(!S){for(R=y.child;R;){if(R===i){S=!0,i=y,l=d;break}if(R===l){S=!0,l=y,i=d;break}R=R.sibling}if(!S)throw Error(Qt(189))}}if(i.alternate!==l)throw Error(Qt(190))}if(i.tag!==3)throw Error(Qt(188));return i.stateNode.current===i?e:t}function mL(e){return e=J6(e),e!==null?gL(e):null}function gL(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=gL(e);if(t!==null)return t;e=e.sibling}return null}var _L=Ha.unstable_scheduleCallback,$D=Ha.unstable_cancelCallback,Q6=Ha.unstable_shouldYield,eU=Ha.unstable_requestPaint,ji=Ha.unstable_now,tU=Ha.unstable_getCurrentPriorityLevel,pM=Ha.unstable_ImmediatePriority,yL=Ha.unstable_UserBlockingPriority,Ex=Ha.unstable_NormalPriority,rU=Ha.unstable_LowPriority,vL=Ha.unstable_IdlePriority,T1=null,Pl=null;function nU(e){if(Pl&&typeof Pl.onCommitFiberRoot=="function")try{Pl.onCommitFiberRoot(T1,e,void 0,(e.current.flags&128)===128)}catch{}}var Ws=Math.clz32?Math.clz32:aU,iU=Math.log,oU=Math.LN2;function aU(e){return e>>>=0,e===0?32:31-(iU(e)/oU|0)|0}var Cv=64,Iv=4194304;function p_(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Mx(e,t){var i=e.pendingLanes;if(i===0)return 0;var l=0,d=e.suspendedLanes,y=e.pingedLanes,S=i&268435455;if(S!==0){var R=S&~d;R!==0?l=p_(R):(y&=S,y!==0&&(l=p_(y)))}else S=i&~d,S!==0?l=p_(S):y!==0&&(l=p_(y));if(l===0)return 0;if(t!==0&&t!==l&&!(t&d)&&(d=l&-l,y=t&-t,d>=y||d===16&&(y&4194240)!==0))return t;if(l&4&&(l|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=l;0<t;)i=31-Ws(t),d=1<<i,l|=e[i],t&=~d;return l}function sU(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lU(e,t){for(var i=e.suspendedLanes,l=e.pingedLanes,d=e.expirationTimes,y=e.pendingLanes;0<y;){var S=31-Ws(y),R=1<<S,a=d[S];a===-1?(!(R&i)||R&l)&&(d[S]=sU(R,t)):a<=t&&(e.expiredLanes|=R),y&=~R}}function BT(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function xL(){var e=Cv;return Cv<<=1,!(Cv&4194240)&&(Cv=64),e}function LS(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function uy(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ws(t),e[t]=i}function cU(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var l=e.eventTimes;for(e=e.expirationTimes;0<i;){var d=31-Ws(i),y=1<<d;t[d]=0,l[d]=-1,e[d]=-1,i&=~y}}function mM(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var l=31-Ws(i),d=1<<l;d&t|e[l]&t&&(e[l]|=t),i&=~d}}var Wn=0;function bL(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var wL,gM,SL,TL,EL,NT=!1,Pv=[],Du=null,Ru=null,ku=null,B_=new Map,N_=new Map,Tu=[],uU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function WD(e,t){switch(e){case"focusin":case"focusout":Du=null;break;case"dragenter":case"dragleave":Ru=null;break;case"mouseover":case"mouseout":ku=null;break;case"pointerover":case"pointerout":B_.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":N_.delete(t.pointerId)}}function Gg(e,t,i,l,d,y){return e===null||e.nativeEvent!==y?(e={blockedOn:t,domEventName:i,eventSystemFlags:l,nativeEvent:y,targetContainers:[d]},t!==null&&(t=dy(t),t!==null&&gM(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,d!==null&&t.indexOf(d)===-1&&t.push(d),e)}function hU(e,t,i,l,d){switch(t){case"focusin":return Du=Gg(Du,e,t,i,l,d),!0;case"dragenter":return Ru=Gg(Ru,e,t,i,l,d),!0;case"mouseover":return ku=Gg(ku,e,t,i,l,d),!0;case"pointerover":var y=d.pointerId;return B_.set(y,Gg(B_.get(y)||null,e,t,i,l,d)),!0;case"gotpointercapture":return y=d.pointerId,N_.set(y,Gg(N_.get(y)||null,e,t,i,l,d)),!0}return!1}function ML(e){var t=nd(e.target);if(t!==null){var i=Sd(t);if(i!==null){if(t=i.tag,t===13){if(t=pL(i),t!==null){e.blockedOn=t,EL(e.priority,function(){SL(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function nx(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=UT(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);OT=l,i.target.dispatchEvent(l),OT=null}else return t=dy(i),t!==null&&gM(t),e.blockedOn=i,!1;t.shift()}return!0}function GD(e,t,i){nx(e)&&i.delete(t)}function dU(){NT=!1,Du!==null&&nx(Du)&&(Du=null),Ru!==null&&nx(Ru)&&(Ru=null),ku!==null&&nx(ku)&&(ku=null),B_.forEach(GD),N_.forEach(GD)}function Hg(e,t){e.blockedOn===t&&(e.blockedOn=null,NT||(NT=!0,Ha.unstable_scheduleCallback(Ha.unstable_NormalPriority,dU)))}function U_(e){function t(d){return Hg(d,e)}if(0<Pv.length){Hg(Pv[0],e);for(var i=1;i<Pv.length;i++){var l=Pv[i];l.blockedOn===e&&(l.blockedOn=null)}}for(Du!==null&&Hg(Du,e),Ru!==null&&Hg(Ru,e),ku!==null&&Hg(ku,e),B_.forEach(t),N_.forEach(t),i=0;i<Tu.length;i++)l=Tu[i],l.blockedOn===e&&(l.blockedOn=null);for(;0<Tu.length&&(i=Tu[0],i.blockedOn===null);)ML(i),i.blockedOn===null&&Tu.shift()}var bp=xc.ReactCurrentBatchConfig,Cx=!0;function fU(e,t,i,l){var d=Wn,y=bp.transition;bp.transition=null;try{Wn=1,_M(e,t,i,l)}finally{Wn=d,bp.transition=y}}function pU(e,t,i,l){var d=Wn,y=bp.transition;bp.transition=null;try{Wn=4,_M(e,t,i,l)}finally{Wn=d,bp.transition=y}}function _M(e,t,i,l){if(Cx){var d=UT(e,t,i,l);if(d===null)GS(e,t,l,Ix,i),WD(e,l);else if(hU(d,e,t,i,l))l.stopPropagation();else if(WD(e,l),t&4&&-1<uU.indexOf(e)){for(;d!==null;){var y=dy(d);if(y!==null&&wL(y),y=UT(e,t,i,l),y===null&&GS(e,t,l,Ix,i),y===d)break;d=y}d!==null&&l.stopPropagation()}else GS(e,t,l,null,i)}}var Ix=null;function UT(e,t,i,l){if(Ix=null,e=fM(l),e=nd(e),e!==null)if(t=Sd(e),t===null)e=null;else if(i=t.tag,i===13){if(e=pL(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ix=e,null}function CL(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tU()){case pM:return 1;case yL:return 4;case Ex:case rU:return 16;case vL:return 536870912;default:return 16}default:return 16}}var Mu=null,yM=null,ix=null;function IL(){if(ix)return ix;var e,t=yM,i=t.length,l,d="value"in Mu?Mu.value:Mu.textContent,y=d.length;for(e=0;e<i&&t[e]===d[e];e++);var S=i-e;for(l=1;l<=S&&t[i-l]===d[y-l];l++);return ix=d.slice(e,1<l?1-l:void 0)}function ox(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Av(){return!0}function HD(){return!1}function Za(e){function t(i,l,d,y,S){this._reactName=i,this._targetInst=d,this.type=l,this.nativeEvent=y,this.target=S,this.currentTarget=null;for(var R in e)e.hasOwnProperty(R)&&(i=e[R],this[R]=i?i(y):y[R]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Av:HD,this.isPropagationStopped=HD,this}return Di(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Av)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Av)},persist:function(){},isPersistent:Av}),t}var $p={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vM=Za($p),hy=Di({},$p,{view:0,detail:0}),mU=Za(hy),zS,FS,qg,E1=Di({},hy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xM,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qg&&(qg&&e.type==="mousemove"?(zS=e.screenX-qg.screenX,FS=e.screenY-qg.screenY):FS=zS=0,qg=e),zS)},movementY:function(e){return"movementY"in e?e.movementY:FS}}),qD=Za(E1),gU=Di({},E1,{dataTransfer:0}),_U=Za(gU),yU=Di({},hy,{relatedTarget:0}),BS=Za(yU),vU=Di({},$p,{animationName:0,elapsedTime:0,pseudoElement:0}),xU=Za(vU),bU=Di({},$p,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wU=Za(bU),SU=Di({},$p,{data:0}),ZD=Za(SU),TU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},EU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function CU(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=MU[e])?!!t[e]:!1}function xM(){return CU}var IU=Di({},hy,{key:function(e){if(e.key){var t=TU[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ox(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?EU[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xM,charCode:function(e){return e.type==="keypress"?ox(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ox(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),PU=Za(IU),AU=Di({},E1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),YD=Za(AU),DU=Di({},hy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xM}),RU=Za(DU),kU=Di({},$p,{propertyName:0,elapsedTime:0,pseudoElement:0}),OU=Za(kU),LU=Di({},E1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),zU=Za(LU),FU=[9,13,27,32],bM=uc&&"CompositionEvent"in window,b_=null;uc&&"documentMode"in document&&(b_=document.documentMode);var BU=uc&&"TextEvent"in window&&!b_,PL=uc&&(!bM||b_&&8<b_&&11>=b_),XD=" ",KD=!1;function AL(e,t){switch(e){case"keyup":return FU.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function DL(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ap=!1;function NU(e,t){switch(e){case"compositionend":return DL(t);case"keypress":return t.which!==32?null:(KD=!0,XD);case"textInput":return e=t.data,e===XD&&KD?null:e;default:return null}}function UU(e,t){if(ap)return e==="compositionend"||!bM&&AL(e,t)?(e=IL(),ix=yM=Mu=null,ap=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return PL&&t.locale!=="ko"?null:t.data;default:return null}}var jU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function JD(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!jU[e.type]:t==="textarea"}function RL(e,t,i,l){cL(l),t=Px(t,"onChange"),0<t.length&&(i=new vM("onChange","change",null,i,l),e.push({event:i,listeners:t}))}var w_=null,j_=null;function VU(e){$L(e,0)}function M1(e){var t=cp(e);if(rL(t))return e}function $U(e,t){if(e==="change")return t}var kL=!1;if(uc){var NS;if(uc){var US="oninput"in document;if(!US){var QD=document.createElement("div");QD.setAttribute("oninput","return;"),US=typeof QD.oninput=="function"}NS=US}else NS=!1;kL=NS&&(!document.documentMode||9<document.documentMode)}function eR(){w_&&(w_.detachEvent("onpropertychange",OL),j_=w_=null)}function OL(e){if(e.propertyName==="value"&&M1(j_)){var t=[];RL(t,j_,e,fM(e)),fL(VU,t)}}function WU(e,t,i){e==="focusin"?(eR(),w_=t,j_=i,w_.attachEvent("onpropertychange",OL)):e==="focusout"&&eR()}function GU(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return M1(j_)}function HU(e,t){if(e==="click")return M1(t)}function qU(e,t){if(e==="input"||e==="change")return M1(t)}function ZU(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qs=typeof Object.is=="function"?Object.is:ZU;function V_(e,t){if(qs(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),l=Object.keys(t);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var d=i[l];if(!wT.call(t,d)||!qs(e[d],t[d]))return!1}return!0}function tR(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function rR(e,t){var i=tR(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=t&&l>=t)return{node:i,offset:t-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=tR(i)}}function LL(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?LL(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function zL(){for(var e=window,t=wx();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=wx(e.document)}return t}function wM(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function YU(e){var t=zL(),i=e.focusedElem,l=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&LL(i.ownerDocument.documentElement,i)){if(l!==null&&wM(i)){if(t=l.start,e=l.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var d=i.textContent.length,y=Math.min(l.start,d);l=l.end===void 0?y:Math.min(l.end,d),!e.extend&&y>l&&(d=l,l=y,y=d),d=rR(i,y);var S=rR(i,l);d&&S&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==S.node||e.focusOffset!==S.offset)&&(t=t.createRange(),t.setStart(d.node,d.offset),e.removeAllRanges(),y>l?(e.addRange(t),e.extend(S.node,S.offset)):(t.setEnd(S.node,S.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var XU=uc&&"documentMode"in document&&11>=document.documentMode,sp=null,jT=null,S_=null,VT=!1;function nR(e,t,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;VT||sp==null||sp!==wx(l)||(l=sp,"selectionStart"in l&&wM(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),S_&&V_(S_,l)||(S_=l,l=Px(jT,"onSelect"),0<l.length&&(t=new vM("onSelect","select",null,t,i),e.push({event:t,listeners:l}),t.target=sp)))}function Dv(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var lp={animationend:Dv("Animation","AnimationEnd"),animationiteration:Dv("Animation","AnimationIteration"),animationstart:Dv("Animation","AnimationStart"),transitionend:Dv("Transition","TransitionEnd")},jS={},FL={};uc&&(FL=document.createElement("div").style,"AnimationEvent"in window||(delete lp.animationend.animation,delete lp.animationiteration.animation,delete lp.animationstart.animation),"TransitionEvent"in window||delete lp.transitionend.transition);function C1(e){if(jS[e])return jS[e];if(!lp[e])return e;var t=lp[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in FL)return jS[e]=t[i];return e}var BL=C1("animationend"),NL=C1("animationiteration"),UL=C1("animationstart"),jL=C1("transitionend"),VL=new Map,iR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qu(e,t){VL.set(e,t),wd(t,[e])}for(var VS=0;VS<iR.length;VS++){var $S=iR[VS],KU=$S.toLowerCase(),JU=$S[0].toUpperCase()+$S.slice(1);qu(KU,"on"+JU)}qu(BL,"onAnimationEnd");qu(NL,"onAnimationIteration");qu(UL,"onAnimationStart");qu("dblclick","onDoubleClick");qu("focusin","onFocus");qu("focusout","onBlur");qu(jL,"onTransitionEnd");Pp("onMouseEnter",["mouseout","mouseover"]);Pp("onMouseLeave",["mouseout","mouseover"]);Pp("onPointerEnter",["pointerout","pointerover"]);Pp("onPointerLeave",["pointerout","pointerover"]);wd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));wd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));wd("onBeforeInput",["compositionend","keypress","textInput","paste"]);wd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));wd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));wd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var m_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QU=new Set("cancel close invalid load scroll toggle".split(" ").concat(m_));function oR(e,t,i){var l=e.type||"unknown-event";e.currentTarget=i,K6(l,t,void 0,e),e.currentTarget=null}function $L(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],d=l.event;l=l.listeners;e:{var y=void 0;if(t)for(var S=l.length-1;0<=S;S--){var R=l[S],a=R.instance,N=R.currentTarget;if(R=R.listener,a!==y&&d.isPropagationStopped())break e;oR(d,R,N),y=a}else for(S=0;S<l.length;S++){if(R=l[S],a=R.instance,N=R.currentTarget,R=R.listener,a!==y&&d.isPropagationStopped())break e;oR(d,R,N),y=a}}}if(Tx)throw e=FT,Tx=!1,FT=null,e}function mi(e,t){var i=t[qT];i===void 0&&(i=t[qT]=new Set);var l=e+"__bubble";i.has(l)||(WL(t,e,2,!1),i.add(l))}function WS(e,t,i){var l=0;t&&(l|=4),WL(i,e,l,t)}var Rv="_reactListening"+Math.random().toString(36).slice(2);function $_(e){if(!e[Rv]){e[Rv]=!0,KO.forEach(function(i){i!=="selectionchange"&&(QU.has(i)||WS(i,!1,e),WS(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Rv]||(t[Rv]=!0,WS("selectionchange",!1,t))}}function WL(e,t,i,l){switch(CL(t)){case 1:var d=fU;break;case 4:d=pU;break;default:d=_M}i=d.bind(null,t,i,e),d=void 0,!zT||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(d=!0),l?d!==void 0?e.addEventListener(t,i,{capture:!0,passive:d}):e.addEventListener(t,i,!0):d!==void 0?e.addEventListener(t,i,{passive:d}):e.addEventListener(t,i,!1)}function GS(e,t,i,l,d){var y=l;if(!(t&1)&&!(t&2)&&l!==null)e:for(;;){if(l===null)return;var S=l.tag;if(S===3||S===4){var R=l.stateNode.containerInfo;if(R===d||R.nodeType===8&&R.parentNode===d)break;if(S===4)for(S=l.return;S!==null;){var a=S.tag;if((a===3||a===4)&&(a=S.stateNode.containerInfo,a===d||a.nodeType===8&&a.parentNode===d))return;S=S.return}for(;R!==null;){if(S=nd(R),S===null)return;if(a=S.tag,a===5||a===6){l=y=S;continue e}R=R.parentNode}}l=l.return}fL(function(){var N=y,G=fM(i),q=[];e:{var X=VL.get(e);if(X!==void 0){var oe=vM,te=e;switch(e){case"keypress":if(ox(i)===0)break e;case"keydown":case"keyup":oe=PU;break;case"focusin":te="focus",oe=BS;break;case"focusout":te="blur",oe=BS;break;case"beforeblur":case"afterblur":oe=BS;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=qD;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=_U;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=RU;break;case BL:case NL:case UL:oe=xU;break;case jL:oe=OU;break;case"scroll":oe=mU;break;case"wheel":oe=zU;break;case"copy":case"cut":case"paste":oe=wU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=YD}var ie=(t&4)!==0,pe=!ie&&e==="scroll",se=ie?X!==null?X+"Capture":null:X;ie=[];for(var le=N,ce;le!==null;){ce=le;var Me=ce.stateNode;if(ce.tag===5&&Me!==null&&(ce=Me,se!==null&&(Me=F_(le,se),Me!=null&&ie.push(W_(le,Me,ce)))),pe)break;le=le.return}0<ie.length&&(X=new oe(X,te,null,i,G),q.push({event:X,listeners:ie}))}}if(!(t&7)){e:{if(X=e==="mouseover"||e==="pointerover",oe=e==="mouseout"||e==="pointerout",X&&i!==OT&&(te=i.relatedTarget||i.fromElement)&&(nd(te)||te[hc]))break e;if((oe||X)&&(X=G.window===G?G:(X=G.ownerDocument)?X.defaultView||X.parentWindow:window,oe?(te=i.relatedTarget||i.toElement,oe=N,te=te?nd(te):null,te!==null&&(pe=Sd(te),te!==pe||te.tag!==5&&te.tag!==6)&&(te=null)):(oe=null,te=N),oe!==te)){if(ie=qD,Me="onMouseLeave",se="onMouseEnter",le="mouse",(e==="pointerout"||e==="pointerover")&&(ie=YD,Me="onPointerLeave",se="onPointerEnter",le="pointer"),pe=oe==null?X:cp(oe),ce=te==null?X:cp(te),X=new ie(Me,le+"leave",oe,i,G),X.target=pe,X.relatedTarget=ce,Me=null,nd(G)===N&&(ie=new ie(se,le+"enter",te,i,G),ie.target=ce,ie.relatedTarget=pe,Me=ie),pe=Me,oe&&te)t:{for(ie=oe,se=te,le=0,ce=ie;ce;ce=Hf(ce))le++;for(ce=0,Me=se;Me;Me=Hf(Me))ce++;for(;0<le-ce;)ie=Hf(ie),le--;for(;0<ce-le;)se=Hf(se),ce--;for(;le--;){if(ie===se||se!==null&&ie===se.alternate)break t;ie=Hf(ie),se=Hf(se)}ie=null}else ie=null;oe!==null&&aR(q,X,oe,ie,!1),te!==null&&pe!==null&&aR(q,pe,te,ie,!0)}}e:{if(X=N?cp(N):window,oe=X.nodeName&&X.nodeName.toLowerCase(),oe==="select"||oe==="input"&&X.type==="file")var Le=$U;else if(JD(X))if(kL)Le=qU;else{Le=GU;var Je=WU}else(oe=X.nodeName)&&oe.toLowerCase()==="input"&&(X.type==="checkbox"||X.type==="radio")&&(Le=HU);if(Le&&(Le=Le(e,N))){RL(q,Le,i,G);break e}Je&&Je(e,X,N),e==="focusout"&&(Je=X._wrapperState)&&Je.controlled&&X.type==="number"&&PT(X,"number",X.value)}switch(Je=N?cp(N):window,e){case"focusin":(JD(Je)||Je.contentEditable==="true")&&(sp=Je,jT=N,S_=null);break;case"focusout":S_=jT=sp=null;break;case"mousedown":VT=!0;break;case"contextmenu":case"mouseup":case"dragend":VT=!1,nR(q,i,G);break;case"selectionchange":if(XU)break;case"keydown":case"keyup":nR(q,i,G)}var Qe;if(bM)e:{switch(e){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else ap?AL(e,i)&&(je="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(je="onCompositionStart");je&&(PL&&i.locale!=="ko"&&(ap||je!=="onCompositionStart"?je==="onCompositionEnd"&&ap&&(Qe=IL()):(Mu=G,yM="value"in Mu?Mu.value:Mu.textContent,ap=!0)),Je=Px(N,je),0<Je.length&&(je=new ZD(je,e,null,i,G),q.push({event:je,listeners:Je}),Qe?je.data=Qe:(Qe=DL(i),Qe!==null&&(je.data=Qe)))),(Qe=BU?NU(e,i):UU(e,i))&&(N=Px(N,"onBeforeInput"),0<N.length&&(G=new ZD("onBeforeInput","beforeinput",null,i,G),q.push({event:G,listeners:N}),G.data=Qe))}$L(q,t)})}function W_(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Px(e,t){for(var i=t+"Capture",l=[];e!==null;){var d=e,y=d.stateNode;d.tag===5&&y!==null&&(d=y,y=F_(e,i),y!=null&&l.unshift(W_(e,y,d)),y=F_(e,t),y!=null&&l.push(W_(e,y,d))),e=e.return}return l}function Hf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function aR(e,t,i,l,d){for(var y=t._reactName,S=[];i!==null&&i!==l;){var R=i,a=R.alternate,N=R.stateNode;if(a!==null&&a===l)break;R.tag===5&&N!==null&&(R=N,d?(a=F_(i,y),a!=null&&S.unshift(W_(i,a,R))):d||(a=F_(i,y),a!=null&&S.push(W_(i,a,R)))),i=i.return}S.length!==0&&e.push({event:t,listeners:S})}var ej=/\r\n?/g,tj=/\u0000|\uFFFD/g;function sR(e){return(typeof e=="string"?e:""+e).replace(ej,`
`).replace(tj,"")}function kv(e,t,i){if(t=sR(t),sR(e)!==t&&i)throw Error(Qt(425))}function Ax(){}var $T=null,WT=null;function GT(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var HT=typeof setTimeout=="function"?setTimeout:void 0,rj=typeof clearTimeout=="function"?clearTimeout:void 0,lR=typeof Promise=="function"?Promise:void 0,nj=typeof queueMicrotask=="function"?queueMicrotask:typeof lR<"u"?function(e){return lR.resolve(null).then(e).catch(ij)}:HT;function ij(e){setTimeout(function(){throw e})}function HS(e,t){var i=t,l=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(l===0){e.removeChild(d),U_(t);return}l--}else i!=="$"&&i!=="$?"&&i!=="$!"||l++;i=d}while(i);U_(t)}function Ou(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function cR(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var Wp=Math.random().toString(36).slice(2),El="__reactFiber$"+Wp,G_="__reactProps$"+Wp,hc="__reactContainer$"+Wp,qT="__reactEvents$"+Wp,oj="__reactListeners$"+Wp,aj="__reactHandles$"+Wp;function nd(e){var t=e[El];if(t)return t;for(var i=e.parentNode;i;){if(t=i[hc]||i[El]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=cR(e);e!==null;){if(i=e[El])return i;e=cR(e)}return t}e=i,i=e.parentNode}return null}function dy(e){return e=e[El]||e[hc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function cp(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Qt(33))}function I1(e){return e[G_]||null}var ZT=[],up=-1;function Zu(e){return{current:e}}function _i(e){0>up||(e.current=ZT[up],ZT[up]=null,up--)}function ui(e,t){up++,ZT[up]=e.current,e.current=t}var Vu={},$o=Zu(Vu),xa=Zu(!1),fd=Vu;function Ap(e,t){var i=e.type.contextTypes;if(!i)return Vu;var l=e.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===t)return l.__reactInternalMemoizedMaskedChildContext;var d={},y;for(y in i)d[y]=t[y];return l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=d),d}function ba(e){return e=e.childContextTypes,e!=null}function Dx(){_i(xa),_i($o)}function uR(e,t,i){if($o.current!==Vu)throw Error(Qt(168));ui($o,t),ui(xa,i)}function GL(e,t,i){var l=e.stateNode;if(t=t.childContextTypes,typeof l.getChildContext!="function")return i;l=l.getChildContext();for(var d in l)if(!(d in t))throw Error(Qt(108,W6(e)||"Unknown",d));return Di({},i,l)}function Rx(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vu,fd=$o.current,ui($o,e),ui(xa,xa.current),!0}function hR(e,t,i){var l=e.stateNode;if(!l)throw Error(Qt(169));i?(e=GL(e,t,fd),l.__reactInternalMemoizedMergedChildContext=e,_i(xa),_i($o),ui($o,e)):_i(xa),ui(xa,i)}var oc=null,P1=!1,qS=!1;function HL(e){oc===null?oc=[e]:oc.push(e)}function sj(e){P1=!0,HL(e)}function Yu(){if(!qS&&oc!==null){qS=!0;var e=0,t=Wn;try{var i=oc;for(Wn=1;e<i.length;e++){var l=i[e];do l=l(!0);while(l!==null)}oc=null,P1=!1}catch(d){throw oc!==null&&(oc=oc.slice(e+1)),_L(pM,Yu),d}finally{Wn=t,qS=!1}}return null}var hp=[],dp=0,kx=null,Ox=0,ps=[],ms=0,pd=null,sc=1,lc="";function Xh(e,t){hp[dp++]=Ox,hp[dp++]=kx,kx=e,Ox=t}function qL(e,t,i){ps[ms++]=sc,ps[ms++]=lc,ps[ms++]=pd,pd=e;var l=sc;e=lc;var d=32-Ws(l)-1;l&=~(1<<d),i+=1;var y=32-Ws(t)+d;if(30<y){var S=d-d%5;y=(l&(1<<S)-1).toString(32),l>>=S,d-=S,sc=1<<32-Ws(t)+d|i<<d|l,lc=y+e}else sc=1<<y|i<<d|l,lc=e}function SM(e){e.return!==null&&(Xh(e,1),qL(e,1,0))}function TM(e){for(;e===kx;)kx=hp[--dp],hp[dp]=null,Ox=hp[--dp],hp[dp]=null;for(;e===pd;)pd=ps[--ms],ps[ms]=null,lc=ps[--ms],ps[ms]=null,sc=ps[--ms],ps[ms]=null}var $a=null,Va=null,bi=!1,Vs=null;function ZL(e,t){var i=ys(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function dR(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,$a=e,Va=Ou(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,$a=e,Va=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=pd!==null?{id:sc,overflow:lc}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=ys(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,$a=e,Va=null,!0):!1;default:return!1}}function YT(e){return(e.mode&1)!==0&&(e.flags&128)===0}function XT(e){if(bi){var t=Va;if(t){var i=t;if(!dR(e,t)){if(YT(e))throw Error(Qt(418));t=Ou(i.nextSibling);var l=$a;t&&dR(e,t)?ZL(l,i):(e.flags=e.flags&-4097|2,bi=!1,$a=e)}}else{if(YT(e))throw Error(Qt(418));e.flags=e.flags&-4097|2,bi=!1,$a=e}}}function fR(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$a=e}function Ov(e){if(e!==$a)return!1;if(!bi)return fR(e),bi=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!GT(e.type,e.memoizedProps)),t&&(t=Va)){if(YT(e))throw YL(),Error(Qt(418));for(;t;)ZL(e,t),t=Ou(t.nextSibling)}if(fR(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Qt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){Va=Ou(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}Va=null}}else Va=$a?Ou(e.stateNode.nextSibling):null;return!0}function YL(){for(var e=Va;e;)e=Ou(e.nextSibling)}function Dp(){Va=$a=null,bi=!1}function EM(e){Vs===null?Vs=[e]:Vs.push(e)}var lj=xc.ReactCurrentBatchConfig;function Zg(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(Qt(309));var l=i.stateNode}if(!l)throw Error(Qt(147,e));var d=l,y=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===y?t.ref:(t=function(S){var R=d.refs;S===null?delete R[y]:R[y]=S},t._stringRef=y,t)}if(typeof e!="string")throw Error(Qt(284));if(!i._owner)throw Error(Qt(290,e))}return e}function Lv(e,t){throw e=Object.prototype.toString.call(t),Error(Qt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pR(e){var t=e._init;return t(e._payload)}function XL(e){function t(se,le){if(e){var ce=se.deletions;ce===null?(se.deletions=[le],se.flags|=16):ce.push(le)}}function i(se,le){if(!e)return null;for(;le!==null;)t(se,le),le=le.sibling;return null}function l(se,le){for(se=new Map;le!==null;)le.key!==null?se.set(le.key,le):se.set(le.index,le),le=le.sibling;return se}function d(se,le){return se=Bu(se,le),se.index=0,se.sibling=null,se}function y(se,le,ce){return se.index=ce,e?(ce=se.alternate,ce!==null?(ce=ce.index,ce<le?(se.flags|=2,le):ce):(se.flags|=2,le)):(se.flags|=1048576,le)}function S(se){return e&&se.alternate===null&&(se.flags|=2),se}function R(se,le,ce,Me){return le===null||le.tag!==6?(le=eT(ce,se.mode,Me),le.return=se,le):(le=d(le,ce),le.return=se,le)}function a(se,le,ce,Me){var Le=ce.type;return Le===op?G(se,le,ce.props.children,Me,ce.key):le!==null&&(le.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===wu&&pR(Le)===le.type)?(Me=d(le,ce.props),Me.ref=Zg(se,le,ce),Me.return=se,Me):(Me=dx(ce.type,ce.key,ce.props,null,se.mode,Me),Me.ref=Zg(se,le,ce),Me.return=se,Me)}function N(se,le,ce,Me){return le===null||le.tag!==4||le.stateNode.containerInfo!==ce.containerInfo||le.stateNode.implementation!==ce.implementation?(le=tT(ce,se.mode,Me),le.return=se,le):(le=d(le,ce.children||[]),le.return=se,le)}function G(se,le,ce,Me,Le){return le===null||le.tag!==7?(le=ud(ce,se.mode,Me,Le),le.return=se,le):(le=d(le,ce),le.return=se,le)}function q(se,le,ce){if(typeof le=="string"&&le!==""||typeof le=="number")return le=eT(""+le,se.mode,ce),le.return=se,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Tv:return ce=dx(le.type,le.key,le.props,null,se.mode,ce),ce.ref=Zg(se,null,le),ce.return=se,ce;case ip:return le=tT(le,se.mode,ce),le.return=se,le;case wu:var Me=le._init;return q(se,Me(le._payload),ce)}if(f_(le)||$g(le))return le=ud(le,se.mode,ce,null),le.return=se,le;Lv(se,le)}return null}function X(se,le,ce,Me){var Le=le!==null?le.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return Le!==null?null:R(se,le,""+ce,Me);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Tv:return ce.key===Le?a(se,le,ce,Me):null;case ip:return ce.key===Le?N(se,le,ce,Me):null;case wu:return Le=ce._init,X(se,le,Le(ce._payload),Me)}if(f_(ce)||$g(ce))return Le!==null?null:G(se,le,ce,Me,null);Lv(se,ce)}return null}function oe(se,le,ce,Me,Le){if(typeof Me=="string"&&Me!==""||typeof Me=="number")return se=se.get(ce)||null,R(le,se,""+Me,Le);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case Tv:return se=se.get(Me.key===null?ce:Me.key)||null,a(le,se,Me,Le);case ip:return se=se.get(Me.key===null?ce:Me.key)||null,N(le,se,Me,Le);case wu:var Je=Me._init;return oe(se,le,ce,Je(Me._payload),Le)}if(f_(Me)||$g(Me))return se=se.get(ce)||null,G(le,se,Me,Le,null);Lv(le,Me)}return null}function te(se,le,ce,Me){for(var Le=null,Je=null,Qe=le,je=le=0,Ct=null;Qe!==null&&je<ce.length;je++){Qe.index>je?(Ct=Qe,Qe=null):Ct=Qe.sibling;var ye=X(se,Qe,ce[je],Me);if(ye===null){Qe===null&&(Qe=Ct);break}e&&Qe&&ye.alternate===null&&t(se,Qe),le=y(ye,le,je),Je===null?Le=ye:Je.sibling=ye,Je=ye,Qe=Ct}if(je===ce.length)return i(se,Qe),bi&&Xh(se,je),Le;if(Qe===null){for(;je<ce.length;je++)Qe=q(se,ce[je],Me),Qe!==null&&(le=y(Qe,le,je),Je===null?Le=Qe:Je.sibling=Qe,Je=Qe);return bi&&Xh(se,je),Le}for(Qe=l(se,Qe);je<ce.length;je++)Ct=oe(Qe,se,je,ce[je],Me),Ct!==null&&(e&&Ct.alternate!==null&&Qe.delete(Ct.key===null?je:Ct.key),le=y(Ct,le,je),Je===null?Le=Ct:Je.sibling=Ct,Je=Ct);return e&&Qe.forEach(function(et){return t(se,et)}),bi&&Xh(se,je),Le}function ie(se,le,ce,Me){var Le=$g(ce);if(typeof Le!="function")throw Error(Qt(150));if(ce=Le.call(ce),ce==null)throw Error(Qt(151));for(var Je=Le=null,Qe=le,je=le=0,Ct=null,ye=ce.next();Qe!==null&&!ye.done;je++,ye=ce.next()){Qe.index>je?(Ct=Qe,Qe=null):Ct=Qe.sibling;var et=X(se,Qe,ye.value,Me);if(et===null){Qe===null&&(Qe=Ct);break}e&&Qe&&et.alternate===null&&t(se,Qe),le=y(et,le,je),Je===null?Le=et:Je.sibling=et,Je=et,Qe=Ct}if(ye.done)return i(se,Qe),bi&&Xh(se,je),Le;if(Qe===null){for(;!ye.done;je++,ye=ce.next())ye=q(se,ye.value,Me),ye!==null&&(le=y(ye,le,je),Je===null?Le=ye:Je.sibling=ye,Je=ye);return bi&&Xh(se,je),Le}for(Qe=l(se,Qe);!ye.done;je++,ye=ce.next())ye=oe(Qe,se,je,ye.value,Me),ye!==null&&(e&&ye.alternate!==null&&Qe.delete(ye.key===null?je:ye.key),le=y(ye,le,je),Je===null?Le=ye:Je.sibling=ye,Je=ye);return e&&Qe.forEach(function(dt){return t(se,dt)}),bi&&Xh(se,je),Le}function pe(se,le,ce,Me){if(typeof ce=="object"&&ce!==null&&ce.type===op&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Tv:e:{for(var Le=ce.key,Je=le;Je!==null;){if(Je.key===Le){if(Le=ce.type,Le===op){if(Je.tag===7){i(se,Je.sibling),le=d(Je,ce.props.children),le.return=se,se=le;break e}}else if(Je.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===wu&&pR(Le)===Je.type){i(se,Je.sibling),le=d(Je,ce.props),le.ref=Zg(se,Je,ce),le.return=se,se=le;break e}i(se,Je);break}else t(se,Je);Je=Je.sibling}ce.type===op?(le=ud(ce.props.children,se.mode,Me,ce.key),le.return=se,se=le):(Me=dx(ce.type,ce.key,ce.props,null,se.mode,Me),Me.ref=Zg(se,le,ce),Me.return=se,se=Me)}return S(se);case ip:e:{for(Je=ce.key;le!==null;){if(le.key===Je)if(le.tag===4&&le.stateNode.containerInfo===ce.containerInfo&&le.stateNode.implementation===ce.implementation){i(se,le.sibling),le=d(le,ce.children||[]),le.return=se,se=le;break e}else{i(se,le);break}else t(se,le);le=le.sibling}le=tT(ce,se.mode,Me),le.return=se,se=le}return S(se);case wu:return Je=ce._init,pe(se,le,Je(ce._payload),Me)}if(f_(ce))return te(se,le,ce,Me);if($g(ce))return ie(se,le,ce,Me);Lv(se,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,le!==null&&le.tag===6?(i(se,le.sibling),le=d(le,ce),le.return=se,se=le):(i(se,le),le=eT(ce,se.mode,Me),le.return=se,se=le),S(se)):i(se,le)}return pe}var Rp=XL(!0),KL=XL(!1),Lx=Zu(null),zx=null,fp=null,MM=null;function CM(){MM=fp=zx=null}function IM(e){var t=Lx.current;_i(Lx),e._currentValue=t}function KT(e,t,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===i)break;e=e.return}}function wp(e,t){zx=e,MM=fp=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(va=!0),e.firstContext=null)}function xs(e){var t=e._currentValue;if(MM!==e)if(e={context:e,memoizedValue:t,next:null},fp===null){if(zx===null)throw Error(Qt(308));fp=e,zx.dependencies={lanes:0,firstContext:e}}else fp=fp.next=e;return t}var id=null;function PM(e){id===null?id=[e]:id.push(e)}function JL(e,t,i,l){var d=t.interleaved;return d===null?(i.next=i,PM(t)):(i.next=d.next,d.next=i),t.interleaved=i,dc(e,l)}function dc(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Su=!1;function AM(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function QL(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function cc(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Lu(e,t,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,Dn&2){var d=l.pending;return d===null?t.next=t:(t.next=d.next,d.next=t),l.pending=t,dc(e,i)}return d=l.interleaved,d===null?(t.next=t,PM(l)):(t.next=d.next,d.next=t),l.interleaved=t,dc(e,i)}function ax(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,mM(e,i)}}function mR(e,t){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var d=null,y=null;if(i=i.firstBaseUpdate,i!==null){do{var S={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};y===null?d=y=S:y=y.next=S,i=i.next}while(i!==null);y===null?d=y=t:y=y.next=t}else d=y=t;i={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:y,shared:l.shared,effects:l.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Fx(e,t,i,l){var d=e.updateQueue;Su=!1;var y=d.firstBaseUpdate,S=d.lastBaseUpdate,R=d.shared.pending;if(R!==null){d.shared.pending=null;var a=R,N=a.next;a.next=null,S===null?y=N:S.next=N,S=a;var G=e.alternate;G!==null&&(G=G.updateQueue,R=G.lastBaseUpdate,R!==S&&(R===null?G.firstBaseUpdate=N:R.next=N,G.lastBaseUpdate=a))}if(y!==null){var q=d.baseState;S=0,G=N=a=null,R=y;do{var X=R.lane,oe=R.eventTime;if((l&X)===X){G!==null&&(G=G.next={eventTime:oe,lane:0,tag:R.tag,payload:R.payload,callback:R.callback,next:null});e:{var te=e,ie=R;switch(X=t,oe=i,ie.tag){case 1:if(te=ie.payload,typeof te=="function"){q=te.call(oe,q,X);break e}q=te;break e;case 3:te.flags=te.flags&-65537|128;case 0:if(te=ie.payload,X=typeof te=="function"?te.call(oe,q,X):te,X==null)break e;q=Di({},q,X);break e;case 2:Su=!0}}R.callback!==null&&R.lane!==0&&(e.flags|=64,X=d.effects,X===null?d.effects=[R]:X.push(R))}else oe={eventTime:oe,lane:X,tag:R.tag,payload:R.payload,callback:R.callback,next:null},G===null?(N=G=oe,a=q):G=G.next=oe,S|=X;if(R=R.next,R===null){if(R=d.shared.pending,R===null)break;X=R,R=X.next,X.next=null,d.lastBaseUpdate=X,d.shared.pending=null}}while(!0);if(G===null&&(a=q),d.baseState=a,d.firstBaseUpdate=N,d.lastBaseUpdate=G,t=d.shared.interleaved,t!==null){d=t;do S|=d.lane,d=d.next;while(d!==t)}else y===null&&(d.shared.lanes=0);gd|=S,e.lanes=S,e.memoizedState=q}}function gR(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var l=e[t],d=l.callback;if(d!==null){if(l.callback=null,l=i,typeof d!="function")throw Error(Qt(191,d));d.call(l)}}}var fy={},Al=Zu(fy),H_=Zu(fy),q_=Zu(fy);function od(e){if(e===fy)throw Error(Qt(174));return e}function DM(e,t){switch(ui(q_,t),ui(H_,e),ui(Al,fy),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:DT(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=DT(t,e)}_i(Al),ui(Al,t)}function kp(){_i(Al),_i(H_),_i(q_)}function ez(e){od(q_.current);var t=od(Al.current),i=DT(t,e.type);t!==i&&(ui(H_,e),ui(Al,i))}function RM(e){H_.current===e&&(_i(Al),_i(H_))}var Ii=Zu(0);function Bx(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ZS=[];function kM(){for(var e=0;e<ZS.length;e++)ZS[e]._workInProgressVersionPrimary=null;ZS.length=0}var sx=xc.ReactCurrentDispatcher,YS=xc.ReactCurrentBatchConfig,md=0,Ai=null,io=null,po=null,Nx=!1,T_=!1,Z_=0,cj=0;function Fo(){throw Error(Qt(321))}function OM(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!qs(e[i],t[i]))return!1;return!0}function LM(e,t,i,l,d,y){if(md=y,Ai=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sx.current=e===null||e.memoizedState===null?fj:pj,e=i(l,d),T_){y=0;do{if(T_=!1,Z_=0,25<=y)throw Error(Qt(301));y+=1,po=io=null,t.updateQueue=null,sx.current=mj,e=i(l,d)}while(T_)}if(sx.current=Ux,t=io!==null&&io.next!==null,md=0,po=io=Ai=null,Nx=!1,t)throw Error(Qt(300));return e}function zM(){var e=Z_!==0;return Z_=0,e}function bl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return po===null?Ai.memoizedState=po=e:po=po.next=e,po}function bs(){if(io===null){var e=Ai.alternate;e=e!==null?e.memoizedState:null}else e=io.next;var t=po===null?Ai.memoizedState:po.next;if(t!==null)po=t,io=e;else{if(e===null)throw Error(Qt(310));io=e,e={memoizedState:io.memoizedState,baseState:io.baseState,baseQueue:io.baseQueue,queue:io.queue,next:null},po===null?Ai.memoizedState=po=e:po=po.next=e}return po}function Y_(e,t){return typeof t=="function"?t(e):t}function XS(e){var t=bs(),i=t.queue;if(i===null)throw Error(Qt(311));i.lastRenderedReducer=e;var l=io,d=l.baseQueue,y=i.pending;if(y!==null){if(d!==null){var S=d.next;d.next=y.next,y.next=S}l.baseQueue=d=y,i.pending=null}if(d!==null){y=d.next,l=l.baseState;var R=S=null,a=null,N=y;do{var G=N.lane;if((md&G)===G)a!==null&&(a=a.next={lane:0,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),l=N.hasEagerState?N.eagerState:e(l,N.action);else{var q={lane:G,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null};a===null?(R=a=q,S=l):a=a.next=q,Ai.lanes|=G,gd|=G}N=N.next}while(N!==null&&N!==y);a===null?S=l:a.next=R,qs(l,t.memoizedState)||(va=!0),t.memoizedState=l,t.baseState=S,t.baseQueue=a,i.lastRenderedState=l}if(e=i.interleaved,e!==null){d=e;do y=d.lane,Ai.lanes|=y,gd|=y,d=d.next;while(d!==e)}else d===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function KS(e){var t=bs(),i=t.queue;if(i===null)throw Error(Qt(311));i.lastRenderedReducer=e;var l=i.dispatch,d=i.pending,y=t.memoizedState;if(d!==null){i.pending=null;var S=d=d.next;do y=e(y,S.action),S=S.next;while(S!==d);qs(y,t.memoizedState)||(va=!0),t.memoizedState=y,t.baseQueue===null&&(t.baseState=y),i.lastRenderedState=y}return[y,l]}function tz(){}function rz(e,t){var i=Ai,l=bs(),d=t(),y=!qs(l.memoizedState,d);if(y&&(l.memoizedState=d,va=!0),l=l.queue,FM(oz.bind(null,i,l,e),[e]),l.getSnapshot!==t||y||po!==null&&po.memoizedState.tag&1){if(i.flags|=2048,X_(9,iz.bind(null,i,l,d,t),void 0,null),mo===null)throw Error(Qt(349));md&30||nz(i,t,d)}return d}function nz(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Ai.updateQueue,t===null?(t={lastEffect:null,stores:null},Ai.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function iz(e,t,i,l){t.value=i,t.getSnapshot=l,az(t)&&sz(e)}function oz(e,t,i){return i(function(){az(t)&&sz(e)})}function az(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!qs(e,i)}catch{return!0}}function sz(e){var t=dc(e,1);t!==null&&Gs(t,e,1,-1)}function _R(e){var t=bl();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Y_,lastRenderedState:e},t.queue=e,e=e.dispatch=dj.bind(null,Ai,e),[t.memoizedState,e]}function X_(e,t,i,l){return e={tag:e,create:t,destroy:i,deps:l,next:null},t=Ai.updateQueue,t===null?(t={lastEffect:null,stores:null},Ai.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,t.lastEffect=e)),e}function lz(){return bs().memoizedState}function lx(e,t,i,l){var d=bl();Ai.flags|=e,d.memoizedState=X_(1|t,i,void 0,l===void 0?null:l)}function A1(e,t,i,l){var d=bs();l=l===void 0?null:l;var y=void 0;if(io!==null){var S=io.memoizedState;if(y=S.destroy,l!==null&&OM(l,S.deps)){d.memoizedState=X_(t,i,y,l);return}}Ai.flags|=e,d.memoizedState=X_(1|t,i,y,l)}function yR(e,t){return lx(8390656,8,e,t)}function FM(e,t){return A1(2048,8,e,t)}function cz(e,t){return A1(4,2,e,t)}function uz(e,t){return A1(4,4,e,t)}function hz(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function dz(e,t,i){return i=i!=null?i.concat([e]):null,A1(4,4,hz.bind(null,t,e),i)}function BM(){}function fz(e,t){var i=bs();t=t===void 0?null:t;var l=i.memoizedState;return l!==null&&t!==null&&OM(t,l[1])?l[0]:(i.memoizedState=[e,t],e)}function pz(e,t){var i=bs();t=t===void 0?null:t;var l=i.memoizedState;return l!==null&&t!==null&&OM(t,l[1])?l[0]:(e=e(),i.memoizedState=[e,t],e)}function mz(e,t,i){return md&21?(qs(i,t)||(i=xL(),Ai.lanes|=i,gd|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,va=!0),e.memoizedState=i)}function uj(e,t){var i=Wn;Wn=i!==0&&4>i?i:4,e(!0);var l=YS.transition;YS.transition={};try{e(!1),t()}finally{Wn=i,YS.transition=l}}function gz(){return bs().memoizedState}function hj(e,t,i){var l=Fu(e);if(i={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null},_z(e))yz(t,i);else if(i=JL(e,t,i,l),i!==null){var d=ra();Gs(i,e,l,d),vz(i,t,l)}}function dj(e,t,i){var l=Fu(e),d={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null};if(_z(e))yz(t,d);else{var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=t.lastRenderedReducer,y!==null))try{var S=t.lastRenderedState,R=y(S,i);if(d.hasEagerState=!0,d.eagerState=R,qs(R,S)){var a=t.interleaved;a===null?(d.next=d,PM(t)):(d.next=a.next,a.next=d),t.interleaved=d;return}}catch{}finally{}i=JL(e,t,d,l),i!==null&&(d=ra(),Gs(i,e,l,d),vz(i,t,l))}}function _z(e){var t=e.alternate;return e===Ai||t!==null&&t===Ai}function yz(e,t){T_=Nx=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function vz(e,t,i){if(i&4194240){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,mM(e,i)}}var Ux={readContext:xs,useCallback:Fo,useContext:Fo,useEffect:Fo,useImperativeHandle:Fo,useInsertionEffect:Fo,useLayoutEffect:Fo,useMemo:Fo,useReducer:Fo,useRef:Fo,useState:Fo,useDebugValue:Fo,useDeferredValue:Fo,useTransition:Fo,useMutableSource:Fo,useSyncExternalStore:Fo,useId:Fo,unstable_isNewReconciler:!1},fj={readContext:xs,useCallback:function(e,t){return bl().memoizedState=[e,t===void 0?null:t],e},useContext:xs,useEffect:yR,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,lx(4194308,4,hz.bind(null,t,e),i)},useLayoutEffect:function(e,t){return lx(4194308,4,e,t)},useInsertionEffect:function(e,t){return lx(4,2,e,t)},useMemo:function(e,t){var i=bl();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var l=bl();return t=i!==void 0?i(t):t,l.memoizedState=l.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},l.queue=e,e=e.dispatch=hj.bind(null,Ai,e),[l.memoizedState,e]},useRef:function(e){var t=bl();return e={current:e},t.memoizedState=e},useState:_R,useDebugValue:BM,useDeferredValue:function(e){return bl().memoizedState=e},useTransition:function(){var e=_R(!1),t=e[0];return e=uj.bind(null,e[1]),bl().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var l=Ai,d=bl();if(bi){if(i===void 0)throw Error(Qt(407));i=i()}else{if(i=t(),mo===null)throw Error(Qt(349));md&30||nz(l,t,i)}d.memoizedState=i;var y={value:i,getSnapshot:t};return d.queue=y,yR(oz.bind(null,l,y,e),[e]),l.flags|=2048,X_(9,iz.bind(null,l,y,i,t),void 0,null),i},useId:function(){var e=bl(),t=mo.identifierPrefix;if(bi){var i=lc,l=sc;i=(l&~(1<<32-Ws(l)-1)).toString(32)+i,t=":"+t+"R"+i,i=Z_++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=cj++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},pj={readContext:xs,useCallback:fz,useContext:xs,useEffect:FM,useImperativeHandle:dz,useInsertionEffect:cz,useLayoutEffect:uz,useMemo:pz,useReducer:XS,useRef:lz,useState:function(){return XS(Y_)},useDebugValue:BM,useDeferredValue:function(e){var t=bs();return mz(t,io.memoizedState,e)},useTransition:function(){var e=XS(Y_)[0],t=bs().memoizedState;return[e,t]},useMutableSource:tz,useSyncExternalStore:rz,useId:gz,unstable_isNewReconciler:!1},mj={readContext:xs,useCallback:fz,useContext:xs,useEffect:FM,useImperativeHandle:dz,useInsertionEffect:cz,useLayoutEffect:uz,useMemo:pz,useReducer:KS,useRef:lz,useState:function(){return KS(Y_)},useDebugValue:BM,useDeferredValue:function(e){var t=bs();return io===null?t.memoizedState=e:mz(t,io.memoizedState,e)},useTransition:function(){var e=KS(Y_)[0],t=bs().memoizedState;return[e,t]},useMutableSource:tz,useSyncExternalStore:rz,useId:gz,unstable_isNewReconciler:!1};function Ns(e,t){if(e&&e.defaultProps){t=Di({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function JT(e,t,i,l){t=e.memoizedState,i=i(l,t),i=i==null?t:Di({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var D1={isMounted:function(e){return(e=e._reactInternals)?Sd(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var l=ra(),d=Fu(e),y=cc(l,d);y.payload=t,i!=null&&(y.callback=i),t=Lu(e,y,d),t!==null&&(Gs(t,e,d,l),ax(t,e,d))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var l=ra(),d=Fu(e),y=cc(l,d);y.tag=1,y.payload=t,i!=null&&(y.callback=i),t=Lu(e,y,d),t!==null&&(Gs(t,e,d,l),ax(t,e,d))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ra(),l=Fu(e),d=cc(i,l);d.tag=2,t!=null&&(d.callback=t),t=Lu(e,d,l),t!==null&&(Gs(t,e,l,i),ax(t,e,l))}};function vR(e,t,i,l,d,y,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,y,S):t.prototype&&t.prototype.isPureReactComponent?!V_(i,l)||!V_(d,y):!0}function xz(e,t,i){var l=!1,d=Vu,y=t.contextType;return typeof y=="object"&&y!==null?y=xs(y):(d=ba(t)?fd:$o.current,l=t.contextTypes,y=(l=l!=null)?Ap(e,d):Vu),t=new t(i,y),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=D1,e.stateNode=t,t._reactInternals=e,l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=y),t}function xR(e,t,i,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,l),t.state!==e&&D1.enqueueReplaceState(t,t.state,null)}function QT(e,t,i,l){var d=e.stateNode;d.props=i,d.state=e.memoizedState,d.refs={},AM(e);var y=t.contextType;typeof y=="object"&&y!==null?d.context=xs(y):(y=ba(t)?fd:$o.current,d.context=Ap(e,y)),d.state=e.memoizedState,y=t.getDerivedStateFromProps,typeof y=="function"&&(JT(e,t,y,i),d.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(t=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),t!==d.state&&D1.enqueueReplaceState(d,d.state,null),Fx(e,i,d,l),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function Op(e,t){try{var i="",l=t;do i+=$6(l),l=l.return;while(l);var d=i}catch(y){d=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:t,stack:d,digest:null}}function JS(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function eE(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var gj=typeof WeakMap=="function"?WeakMap:Map;function bz(e,t,i){i=cc(-1,i),i.tag=3,i.payload={element:null};var l=t.value;return i.callback=function(){Vx||(Vx=!0,uE=l),eE(e,t)},i}function wz(e,t,i){i=cc(-1,i),i.tag=3;var l=e.type.getDerivedStateFromError;if(typeof l=="function"){var d=t.value;i.payload=function(){return l(d)},i.callback=function(){eE(e,t)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(i.callback=function(){eE(e,t),typeof l!="function"&&(zu===null?zu=new Set([this]):zu.add(this));var S=t.stack;this.componentDidCatch(t.value,{componentStack:S!==null?S:""})}),i}function bR(e,t,i){var l=e.pingCache;if(l===null){l=e.pingCache=new gj;var d=new Set;l.set(t,d)}else d=l.get(t),d===void 0&&(d=new Set,l.set(t,d));d.has(i)||(d.add(i),e=Aj.bind(null,e,t,i),t.then(e,e))}function wR(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function SR(e,t,i,l,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=cc(-1,1),t.tag=2,Lu(i,t,1))),i.lanes|=1),e)}var _j=xc.ReactCurrentOwner,va=!1;function ta(e,t,i,l){t.child=e===null?KL(t,null,i,l):Rp(t,e.child,i,l)}function TR(e,t,i,l,d){i=i.render;var y=t.ref;return wp(t,d),l=LM(e,t,i,l,y,d),i=zM(),e!==null&&!va?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,fc(e,t,d)):(bi&&i&&SM(t),t.flags|=1,ta(e,t,l,d),t.child)}function ER(e,t,i,l,d){if(e===null){var y=i.type;return typeof y=="function"&&!HM(y)&&y.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=y,Sz(e,t,y,l,d)):(e=dx(i.type,null,l,t,t.mode,d),e.ref=t.ref,e.return=t,t.child=e)}if(y=e.child,!(e.lanes&d)){var S=y.memoizedProps;if(i=i.compare,i=i!==null?i:V_,i(S,l)&&e.ref===t.ref)return fc(e,t,d)}return t.flags|=1,e=Bu(y,l),e.ref=t.ref,e.return=t,t.child=e}function Sz(e,t,i,l,d){if(e!==null){var y=e.memoizedProps;if(V_(y,l)&&e.ref===t.ref)if(va=!1,t.pendingProps=l=y,(e.lanes&d)!==0)e.flags&131072&&(va=!0);else return t.lanes=e.lanes,fc(e,t,d)}return tE(e,t,i,l,d)}function Tz(e,t,i){var l=t.pendingProps,d=l.children,y=e!==null?e.memoizedState:null;if(l.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ui(mp,Ua),Ua|=i;else{if(!(i&1073741824))return e=y!==null?y.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ui(mp,Ua),Ua|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=y!==null?y.baseLanes:i,ui(mp,Ua),Ua|=l}else y!==null?(l=y.baseLanes|i,t.memoizedState=null):l=i,ui(mp,Ua),Ua|=l;return ta(e,t,d,i),t.child}function Ez(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function tE(e,t,i,l,d){var y=ba(i)?fd:$o.current;return y=Ap(t,y),wp(t,d),i=LM(e,t,i,l,y,d),l=zM(),e!==null&&!va?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,fc(e,t,d)):(bi&&l&&SM(t),t.flags|=1,ta(e,t,i,d),t.child)}function MR(e,t,i,l,d){if(ba(i)){var y=!0;Rx(t)}else y=!1;if(wp(t,d),t.stateNode===null)cx(e,t),xz(t,i,l),QT(t,i,l,d),l=!0;else if(e===null){var S=t.stateNode,R=t.memoizedProps;S.props=R;var a=S.context,N=i.contextType;typeof N=="object"&&N!==null?N=xs(N):(N=ba(i)?fd:$o.current,N=Ap(t,N));var G=i.getDerivedStateFromProps,q=typeof G=="function"||typeof S.getSnapshotBeforeUpdate=="function";q||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(R!==l||a!==N)&&xR(t,S,l,N),Su=!1;var X=t.memoizedState;S.state=X,Fx(t,l,S,d),a=t.memoizedState,R!==l||X!==a||xa.current||Su?(typeof G=="function"&&(JT(t,i,G,l),a=t.memoizedState),(R=Su||vR(t,i,R,l,X,a,N))?(q||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(t.flags|=4194308)):(typeof S.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=a),S.props=l,S.state=a,S.context=N,l=R):(typeof S.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{S=t.stateNode,QL(e,t),R=t.memoizedProps,N=t.type===t.elementType?R:Ns(t.type,R),S.props=N,q=t.pendingProps,X=S.context,a=i.contextType,typeof a=="object"&&a!==null?a=xs(a):(a=ba(i)?fd:$o.current,a=Ap(t,a));var oe=i.getDerivedStateFromProps;(G=typeof oe=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(R!==q||X!==a)&&xR(t,S,l,a),Su=!1,X=t.memoizedState,S.state=X,Fx(t,l,S,d);var te=t.memoizedState;R!==q||X!==te||xa.current||Su?(typeof oe=="function"&&(JT(t,i,oe,l),te=t.memoizedState),(N=Su||vR(t,i,N,l,X,te,a)||!1)?(G||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(l,te,a),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(l,te,a)),typeof S.componentDidUpdate=="function"&&(t.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof S.componentDidUpdate!="function"||R===e.memoizedProps&&X===e.memoizedState||(t.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===e.memoizedProps&&X===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=te),S.props=l,S.state=te,S.context=a,l=N):(typeof S.componentDidUpdate!="function"||R===e.memoizedProps&&X===e.memoizedState||(t.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===e.memoizedProps&&X===e.memoizedState||(t.flags|=1024),l=!1)}return rE(e,t,i,l,y,d)}function rE(e,t,i,l,d,y){Ez(e,t);var S=(t.flags&128)!==0;if(!l&&!S)return d&&hR(t,i,!1),fc(e,t,y);l=t.stateNode,_j.current=t;var R=S&&typeof i.getDerivedStateFromError!="function"?null:l.render();return t.flags|=1,e!==null&&S?(t.child=Rp(t,e.child,null,y),t.child=Rp(t,null,R,y)):ta(e,t,R,y),t.memoizedState=l.state,d&&hR(t,i,!0),t.child}function Mz(e){var t=e.stateNode;t.pendingContext?uR(e,t.pendingContext,t.pendingContext!==t.context):t.context&&uR(e,t.context,!1),DM(e,t.containerInfo)}function CR(e,t,i,l,d){return Dp(),EM(d),t.flags|=256,ta(e,t,i,l),t.child}var nE={dehydrated:null,treeContext:null,retryLane:0};function iE(e){return{baseLanes:e,cachePool:null,transitions:null}}function Cz(e,t,i){var l=t.pendingProps,d=Ii.current,y=!1,S=(t.flags&128)!==0,R;if((R=S)||(R=e!==null&&e.memoizedState===null?!1:(d&2)!==0),R?(y=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),ui(Ii,d&1),e===null)return XT(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(S=l.children,e=l.fallback,y?(l=t.mode,y=t.child,S={mode:"hidden",children:S},!(l&1)&&y!==null?(y.childLanes=0,y.pendingProps=S):y=O1(S,l,0,null),e=ud(e,l,i,null),y.return=t,e.return=t,y.sibling=e,t.child=y,t.child.memoizedState=iE(i),t.memoizedState=nE,e):NM(t,S));if(d=e.memoizedState,d!==null&&(R=d.dehydrated,R!==null))return yj(e,t,S,l,R,d,i);if(y){y=l.fallback,S=t.mode,d=e.child,R=d.sibling;var a={mode:"hidden",children:l.children};return!(S&1)&&t.child!==d?(l=t.child,l.childLanes=0,l.pendingProps=a,t.deletions=null):(l=Bu(d,a),l.subtreeFlags=d.subtreeFlags&14680064),R!==null?y=Bu(R,y):(y=ud(y,S,i,null),y.flags|=2),y.return=t,l.return=t,l.sibling=y,t.child=l,l=y,y=t.child,S=e.child.memoizedState,S=S===null?iE(i):{baseLanes:S.baseLanes|i,cachePool:null,transitions:S.transitions},y.memoizedState=S,y.childLanes=e.childLanes&~i,t.memoizedState=nE,l}return y=e.child,e=y.sibling,l=Bu(y,{mode:"visible",children:l.children}),!(t.mode&1)&&(l.lanes=i),l.return=t,l.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=l,t.memoizedState=null,l}function NM(e,t){return t=O1({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function zv(e,t,i,l){return l!==null&&EM(l),Rp(t,e.child,null,i),e=NM(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function yj(e,t,i,l,d,y,S){if(i)return t.flags&256?(t.flags&=-257,l=JS(Error(Qt(422))),zv(e,t,S,l)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(y=l.fallback,d=t.mode,l=O1({mode:"visible",children:l.children},d,0,null),y=ud(y,d,S,null),y.flags|=2,l.return=t,y.return=t,l.sibling=y,t.child=l,t.mode&1&&Rp(t,e.child,null,S),t.child.memoizedState=iE(S),t.memoizedState=nE,y);if(!(t.mode&1))return zv(e,t,S,null);if(d.data==="$!"){if(l=d.nextSibling&&d.nextSibling.dataset,l)var R=l.dgst;return l=R,y=Error(Qt(419)),l=JS(y,l,void 0),zv(e,t,S,l)}if(R=(S&e.childLanes)!==0,va||R){if(l=mo,l!==null){switch(S&-S){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(l.suspendedLanes|S)?0:d,d!==0&&d!==y.retryLane&&(y.retryLane=d,dc(e,d),Gs(l,e,d,-1))}return GM(),l=JS(Error(Qt(421))),zv(e,t,S,l)}return d.data==="$?"?(t.flags|=128,t.child=e.child,t=Dj.bind(null,e),d._reactRetry=t,null):(e=y.treeContext,Va=Ou(d.nextSibling),$a=t,bi=!0,Vs=null,e!==null&&(ps[ms++]=sc,ps[ms++]=lc,ps[ms++]=pd,sc=e.id,lc=e.overflow,pd=t),t=NM(t,l.children),t.flags|=4096,t)}function IR(e,t,i){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),KT(e.return,t,i)}function QS(e,t,i,l,d){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:d}:(y.isBackwards=t,y.rendering=null,y.renderingStartTime=0,y.last=l,y.tail=i,y.tailMode=d)}function Iz(e,t,i){var l=t.pendingProps,d=l.revealOrder,y=l.tail;if(ta(e,t,l.children,i),l=Ii.current,l&2)l=l&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&IR(e,i,t);else if(e.tag===19)IR(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}if(ui(Ii,l),!(t.mode&1))t.memoizedState=null;else switch(d){case"forwards":for(i=t.child,d=null;i!==null;)e=i.alternate,e!==null&&Bx(e)===null&&(d=i),i=i.sibling;i=d,i===null?(d=t.child,t.child=null):(d=i.sibling,i.sibling=null),QS(t,!1,d,i,y);break;case"backwards":for(i=null,d=t.child,t.child=null;d!==null;){if(e=d.alternate,e!==null&&Bx(e)===null){t.child=d;break}e=d.sibling,d.sibling=i,i=d,d=e}QS(t,!0,i,null,y);break;case"together":QS(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function cx(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function fc(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),gd|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Qt(153));if(t.child!==null){for(e=t.child,i=Bu(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Bu(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function vj(e,t,i){switch(t.tag){case 3:Mz(t),Dp();break;case 5:ez(t);break;case 1:ba(t.type)&&Rx(t);break;case 4:DM(t,t.stateNode.containerInfo);break;case 10:var l=t.type._context,d=t.memoizedProps.value;ui(Lx,l._currentValue),l._currentValue=d;break;case 13:if(l=t.memoizedState,l!==null)return l.dehydrated!==null?(ui(Ii,Ii.current&1),t.flags|=128,null):i&t.child.childLanes?Cz(e,t,i):(ui(Ii,Ii.current&1),e=fc(e,t,i),e!==null?e.sibling:null);ui(Ii,Ii.current&1);break;case 19:if(l=(i&t.childLanes)!==0,e.flags&128){if(l)return Iz(e,t,i);t.flags|=128}if(d=t.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),ui(Ii,Ii.current),l)break;return null;case 22:case 23:return t.lanes=0,Tz(e,t,i)}return fc(e,t,i)}var Pz,oE,Az,Dz;Pz=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};oE=function(){};Az=function(e,t,i,l){var d=e.memoizedProps;if(d!==l){e=t.stateNode,od(Al.current);var y=null;switch(i){case"input":d=CT(e,d),l=CT(e,l),y=[];break;case"select":d=Di({},d,{value:void 0}),l=Di({},l,{value:void 0}),y=[];break;case"textarea":d=AT(e,d),l=AT(e,l),y=[];break;default:typeof d.onClick!="function"&&typeof l.onClick=="function"&&(e.onclick=Ax)}RT(i,l);var S;i=null;for(N in d)if(!l.hasOwnProperty(N)&&d.hasOwnProperty(N)&&d[N]!=null)if(N==="style"){var R=d[N];for(S in R)R.hasOwnProperty(S)&&(i||(i={}),i[S]="")}else N!=="dangerouslySetInnerHTML"&&N!=="children"&&N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&N!=="autoFocus"&&(L_.hasOwnProperty(N)?y||(y=[]):(y=y||[]).push(N,null));for(N in l){var a=l[N];if(R=d!=null?d[N]:void 0,l.hasOwnProperty(N)&&a!==R&&(a!=null||R!=null))if(N==="style")if(R){for(S in R)!R.hasOwnProperty(S)||a&&a.hasOwnProperty(S)||(i||(i={}),i[S]="");for(S in a)a.hasOwnProperty(S)&&R[S]!==a[S]&&(i||(i={}),i[S]=a[S])}else i||(y||(y=[]),y.push(N,i)),i=a;else N==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,R=R?R.__html:void 0,a!=null&&R!==a&&(y=y||[]).push(N,a)):N==="children"?typeof a!="string"&&typeof a!="number"||(y=y||[]).push(N,""+a):N!=="suppressContentEditableWarning"&&N!=="suppressHydrationWarning"&&(L_.hasOwnProperty(N)?(a!=null&&N==="onScroll"&&mi("scroll",e),y||R===a||(y=[])):(y=y||[]).push(N,a))}i&&(y=y||[]).push("style",i);var N=y;(t.updateQueue=N)&&(t.flags|=4)}};Dz=function(e,t,i,l){i!==l&&(t.flags|=4)};function Yg(e,t){if(!bi)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Bo(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(t)for(var d=e.child;d!==null;)i|=d.lanes|d.childLanes,l|=d.subtreeFlags&14680064,l|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)i|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=l,e.childLanes=i,t}function xj(e,t,i){var l=t.pendingProps;switch(TM(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bo(t),null;case 1:return ba(t.type)&&Dx(),Bo(t),null;case 3:return l=t.stateNode,kp(),_i(xa),_i($o),kM(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Ov(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Vs!==null&&(fE(Vs),Vs=null))),oE(e,t),Bo(t),null;case 5:RM(t);var d=od(q_.current);if(i=t.type,e!==null&&t.stateNode!=null)Az(e,t,i,l,d),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!l){if(t.stateNode===null)throw Error(Qt(166));return Bo(t),null}if(e=od(Al.current),Ov(t)){l=t.stateNode,i=t.type;var y=t.memoizedProps;switch(l[El]=t,l[G_]=y,e=(t.mode&1)!==0,i){case"dialog":mi("cancel",l),mi("close",l);break;case"iframe":case"object":case"embed":mi("load",l);break;case"video":case"audio":for(d=0;d<m_.length;d++)mi(m_[d],l);break;case"source":mi("error",l);break;case"img":case"image":case"link":mi("error",l),mi("load",l);break;case"details":mi("toggle",l);break;case"input":FD(l,y),mi("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!y.multiple},mi("invalid",l);break;case"textarea":ND(l,y),mi("invalid",l)}RT(i,y),d=null;for(var S in y)if(y.hasOwnProperty(S)){var R=y[S];S==="children"?typeof R=="string"?l.textContent!==R&&(y.suppressHydrationWarning!==!0&&kv(l.textContent,R,e),d=["children",R]):typeof R=="number"&&l.textContent!==""+R&&(y.suppressHydrationWarning!==!0&&kv(l.textContent,R,e),d=["children",""+R]):L_.hasOwnProperty(S)&&R!=null&&S==="onScroll"&&mi("scroll",l)}switch(i){case"input":Ev(l),BD(l,y,!0);break;case"textarea":Ev(l),UD(l);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(l.onclick=Ax)}l=d,t.updateQueue=l,l!==null&&(t.flags|=4)}else{S=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=oL(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=S.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof l.is=="string"?e=S.createElement(i,{is:l.is}):(e=S.createElement(i),i==="select"&&(S=e,l.multiple?S.multiple=!0:l.size&&(S.size=l.size))):e=S.createElementNS(e,i),e[El]=t,e[G_]=l,Pz(e,t,!1,!1),t.stateNode=e;e:{switch(S=kT(i,l),i){case"dialog":mi("cancel",e),mi("close",e),d=l;break;case"iframe":case"object":case"embed":mi("load",e),d=l;break;case"video":case"audio":for(d=0;d<m_.length;d++)mi(m_[d],e);d=l;break;case"source":mi("error",e),d=l;break;case"img":case"image":case"link":mi("error",e),mi("load",e),d=l;break;case"details":mi("toggle",e),d=l;break;case"input":FD(e,l),d=CT(e,l),mi("invalid",e);break;case"option":d=l;break;case"select":e._wrapperState={wasMultiple:!!l.multiple},d=Di({},l,{value:void 0}),mi("invalid",e);break;case"textarea":ND(e,l),d=AT(e,l),mi("invalid",e);break;default:d=l}RT(i,d),R=d;for(y in R)if(R.hasOwnProperty(y)){var a=R[y];y==="style"?lL(e,a):y==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&aL(e,a)):y==="children"?typeof a=="string"?(i!=="textarea"||a!=="")&&z_(e,a):typeof a=="number"&&z_(e,""+a):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(L_.hasOwnProperty(y)?a!=null&&y==="onScroll"&&mi("scroll",e):a!=null&&cM(e,y,a,S))}switch(i){case"input":Ev(e),BD(e,l,!1);break;case"textarea":Ev(e),UD(e);break;case"option":l.value!=null&&e.setAttribute("value",""+ju(l.value));break;case"select":e.multiple=!!l.multiple,y=l.value,y!=null?yp(e,!!l.multiple,y,!1):l.defaultValue!=null&&yp(e,!!l.multiple,l.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=Ax)}switch(i){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Bo(t),null;case 6:if(e&&t.stateNode!=null)Dz(e,t,e.memoizedProps,l);else{if(typeof l!="string"&&t.stateNode===null)throw Error(Qt(166));if(i=od(q_.current),od(Al.current),Ov(t)){if(l=t.stateNode,i=t.memoizedProps,l[El]=t,(y=l.nodeValue!==i)&&(e=$a,e!==null))switch(e.tag){case 3:kv(l.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&kv(l.nodeValue,i,(e.mode&1)!==0)}y&&(t.flags|=4)}else l=(i.nodeType===9?i:i.ownerDocument).createTextNode(l),l[El]=t,t.stateNode=l}return Bo(t),null;case 13:if(_i(Ii),l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(bi&&Va!==null&&t.mode&1&&!(t.flags&128))YL(),Dp(),t.flags|=98560,y=!1;else if(y=Ov(t),l!==null&&l.dehydrated!==null){if(e===null){if(!y)throw Error(Qt(318));if(y=t.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(Qt(317));y[El]=t}else Dp(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Bo(t),y=!1}else Vs!==null&&(fE(Vs),Vs=null),y=!0;if(!y)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(l=l!==null,l!==(e!==null&&e.memoizedState!==null)&&l&&(t.child.flags|=8192,t.mode&1&&(e===null||Ii.current&1?oo===0&&(oo=3):GM())),t.updateQueue!==null&&(t.flags|=4),Bo(t),null);case 4:return kp(),oE(e,t),e===null&&$_(t.stateNode.containerInfo),Bo(t),null;case 10:return IM(t.type._context),Bo(t),null;case 17:return ba(t.type)&&Dx(),Bo(t),null;case 19:if(_i(Ii),y=t.memoizedState,y===null)return Bo(t),null;if(l=(t.flags&128)!==0,S=y.rendering,S===null)if(l)Yg(y,!1);else{if(oo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(S=Bx(e),S!==null){for(t.flags|=128,Yg(y,!1),l=S.updateQueue,l!==null&&(t.updateQueue=l,t.flags|=4),t.subtreeFlags=0,l=i,i=t.child;i!==null;)y=i,e=l,y.flags&=14680066,S=y.alternate,S===null?(y.childLanes=0,y.lanes=e,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=S.childLanes,y.lanes=S.lanes,y.child=S.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=S.memoizedProps,y.memoizedState=S.memoizedState,y.updateQueue=S.updateQueue,y.type=S.type,e=S.dependencies,y.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return ui(Ii,Ii.current&1|2),t.child}e=e.sibling}y.tail!==null&&ji()>Lp&&(t.flags|=128,l=!0,Yg(y,!1),t.lanes=4194304)}else{if(!l)if(e=Bx(S),e!==null){if(t.flags|=128,l=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Yg(y,!0),y.tail===null&&y.tailMode==="hidden"&&!S.alternate&&!bi)return Bo(t),null}else 2*ji()-y.renderingStartTime>Lp&&i!==1073741824&&(t.flags|=128,l=!0,Yg(y,!1),t.lanes=4194304);y.isBackwards?(S.sibling=t.child,t.child=S):(i=y.last,i!==null?i.sibling=S:t.child=S,y.last=S)}return y.tail!==null?(t=y.tail,y.rendering=t,y.tail=t.sibling,y.renderingStartTime=ji(),t.sibling=null,i=Ii.current,ui(Ii,l?i&1|2:i&1),t):(Bo(t),null);case 22:case 23:return WM(),l=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==l&&(t.flags|=8192),l&&t.mode&1?Ua&1073741824&&(Bo(t),t.subtreeFlags&6&&(t.flags|=8192)):Bo(t),null;case 24:return null;case 25:return null}throw Error(Qt(156,t.tag))}function bj(e,t){switch(TM(t),t.tag){case 1:return ba(t.type)&&Dx(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return kp(),_i(xa),_i($o),kM(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return RM(t),null;case 13:if(_i(Ii),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Qt(340));Dp()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return _i(Ii),null;case 4:return kp(),null;case 10:return IM(t.type._context),null;case 22:case 23:return WM(),null;case 24:return null;default:return null}}var Fv=!1,jo=!1,wj=typeof WeakSet=="function"?WeakSet:Set,Sr=null;function pp(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(l){Fi(e,t,l)}else i.current=null}function aE(e,t,i){try{i()}catch(l){Fi(e,t,l)}}var PR=!1;function Sj(e,t){if($T=Cx,e=zL(),wM(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var d=l.anchorOffset,y=l.focusNode;l=l.focusOffset;try{i.nodeType,y.nodeType}catch{i=null;break e}var S=0,R=-1,a=-1,N=0,G=0,q=e,X=null;t:for(;;){for(var oe;q!==i||d!==0&&q.nodeType!==3||(R=S+d),q!==y||l!==0&&q.nodeType!==3||(a=S+l),q.nodeType===3&&(S+=q.nodeValue.length),(oe=q.firstChild)!==null;)X=q,q=oe;for(;;){if(q===e)break t;if(X===i&&++N===d&&(R=S),X===y&&++G===l&&(a=S),(oe=q.nextSibling)!==null)break;q=X,X=q.parentNode}q=oe}i=R===-1||a===-1?null:{start:R,end:a}}else i=null}i=i||{start:0,end:0}}else i=null;for(WT={focusedElem:e,selectionRange:i},Cx=!1,Sr=t;Sr!==null;)if(t=Sr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Sr=e;else for(;Sr!==null;){t=Sr;try{var te=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(te!==null){var ie=te.memoizedProps,pe=te.memoizedState,se=t.stateNode,le=se.getSnapshotBeforeUpdate(t.elementType===t.type?ie:Ns(t.type,ie),pe);se.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var ce=t.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Qt(163))}}catch(Me){Fi(t,t.return,Me)}if(e=t.sibling,e!==null){e.return=t.return,Sr=e;break}Sr=t.return}return te=PR,PR=!1,te}function E_(e,t,i){var l=t.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var d=l=l.next;do{if((d.tag&e)===e){var y=d.destroy;d.destroy=void 0,y!==void 0&&aE(t,i,y)}d=d.next}while(d!==l)}}function R1(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var l=i.create;i.destroy=l()}i=i.next}while(i!==t)}}function sE(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function Rz(e){var t=e.alternate;t!==null&&(e.alternate=null,Rz(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[El],delete t[G_],delete t[qT],delete t[oj],delete t[aj])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function kz(e){return e.tag===5||e.tag===3||e.tag===4}function AR(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||kz(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function lE(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=Ax));else if(l!==4&&(e=e.child,e!==null))for(lE(e,t,i),e=e.sibling;e!==null;)lE(e,t,i),e=e.sibling}function cE(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(l!==4&&(e=e.child,e!==null))for(cE(e,t,i),e=e.sibling;e!==null;)cE(e,t,i),e=e.sibling}var To=null,js=!1;function yu(e,t,i){for(i=i.child;i!==null;)Oz(e,t,i),i=i.sibling}function Oz(e,t,i){if(Pl&&typeof Pl.onCommitFiberUnmount=="function")try{Pl.onCommitFiberUnmount(T1,i)}catch{}switch(i.tag){case 5:jo||pp(i,t);case 6:var l=To,d=js;To=null,yu(e,t,i),To=l,js=d,To!==null&&(js?(e=To,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):To.removeChild(i.stateNode));break;case 18:To!==null&&(js?(e=To,i=i.stateNode,e.nodeType===8?HS(e.parentNode,i):e.nodeType===1&&HS(e,i),U_(e)):HS(To,i.stateNode));break;case 4:l=To,d=js,To=i.stateNode.containerInfo,js=!0,yu(e,t,i),To=l,js=d;break;case 0:case 11:case 14:case 15:if(!jo&&(l=i.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){d=l=l.next;do{var y=d,S=y.destroy;y=y.tag,S!==void 0&&(y&2||y&4)&&aE(i,t,S),d=d.next}while(d!==l)}yu(e,t,i);break;case 1:if(!jo&&(pp(i,t),l=i.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=i.memoizedProps,l.state=i.memoizedState,l.componentWillUnmount()}catch(R){Fi(i,t,R)}yu(e,t,i);break;case 21:yu(e,t,i);break;case 22:i.mode&1?(jo=(l=jo)||i.memoizedState!==null,yu(e,t,i),jo=l):yu(e,t,i);break;default:yu(e,t,i)}}function DR(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new wj),t.forEach(function(l){var d=Rj.bind(null,e,l);i.has(l)||(i.add(l),l.then(d,d))})}}function Bs(e,t){var i=t.deletions;if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];try{var y=e,S=t,R=S;e:for(;R!==null;){switch(R.tag){case 5:To=R.stateNode,js=!1;break e;case 3:To=R.stateNode.containerInfo,js=!0;break e;case 4:To=R.stateNode.containerInfo,js=!0;break e}R=R.return}if(To===null)throw Error(Qt(160));Oz(y,S,d),To=null,js=!1;var a=d.alternate;a!==null&&(a.return=null),d.return=null}catch(N){Fi(d,t,N)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Lz(t,e),t=t.sibling}function Lz(e,t){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Bs(t,e),gl(e),l&4){try{E_(3,e,e.return),R1(3,e)}catch(ie){Fi(e,e.return,ie)}try{E_(5,e,e.return)}catch(ie){Fi(e,e.return,ie)}}break;case 1:Bs(t,e),gl(e),l&512&&i!==null&&pp(i,i.return);break;case 5:if(Bs(t,e),gl(e),l&512&&i!==null&&pp(i,i.return),e.flags&32){var d=e.stateNode;try{z_(d,"")}catch(ie){Fi(e,e.return,ie)}}if(l&4&&(d=e.stateNode,d!=null)){var y=e.memoizedProps,S=i!==null?i.memoizedProps:y,R=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{R==="input"&&y.type==="radio"&&y.name!=null&&nL(d,y),kT(R,S);var N=kT(R,y);for(S=0;S<a.length;S+=2){var G=a[S],q=a[S+1];G==="style"?lL(d,q):G==="dangerouslySetInnerHTML"?aL(d,q):G==="children"?z_(d,q):cM(d,G,q,N)}switch(R){case"input":IT(d,y);break;case"textarea":iL(d,y);break;case"select":var X=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!y.multiple;var oe=y.value;oe!=null?yp(d,!!y.multiple,oe,!1):X!==!!y.multiple&&(y.defaultValue!=null?yp(d,!!y.multiple,y.defaultValue,!0):yp(d,!!y.multiple,y.multiple?[]:"",!1))}d[G_]=y}catch(ie){Fi(e,e.return,ie)}}break;case 6:if(Bs(t,e),gl(e),l&4){if(e.stateNode===null)throw Error(Qt(162));d=e.stateNode,y=e.memoizedProps;try{d.nodeValue=y}catch(ie){Fi(e,e.return,ie)}}break;case 3:if(Bs(t,e),gl(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{U_(t.containerInfo)}catch(ie){Fi(e,e.return,ie)}break;case 4:Bs(t,e),gl(e);break;case 13:Bs(t,e),gl(e),d=e.child,d.flags&8192&&(y=d.memoizedState!==null,d.stateNode.isHidden=y,!y||d.alternate!==null&&d.alternate.memoizedState!==null||(VM=ji())),l&4&&DR(e);break;case 22:if(G=i!==null&&i.memoizedState!==null,e.mode&1?(jo=(N=jo)||G,Bs(t,e),jo=N):Bs(t,e),gl(e),l&8192){if(N=e.memoizedState!==null,(e.stateNode.isHidden=N)&&!G&&e.mode&1)for(Sr=e,G=e.child;G!==null;){for(q=Sr=G;Sr!==null;){switch(X=Sr,oe=X.child,X.tag){case 0:case 11:case 14:case 15:E_(4,X,X.return);break;case 1:pp(X,X.return);var te=X.stateNode;if(typeof te.componentWillUnmount=="function"){l=X,i=X.return;try{t=l,te.props=t.memoizedProps,te.state=t.memoizedState,te.componentWillUnmount()}catch(ie){Fi(l,i,ie)}}break;case 5:pp(X,X.return);break;case 22:if(X.memoizedState!==null){kR(q);continue}}oe!==null?(oe.return=X,Sr=oe):kR(q)}G=G.sibling}e:for(G=null,q=e;;){if(q.tag===5){if(G===null){G=q;try{d=q.stateNode,N?(y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(R=q.stateNode,a=q.memoizedProps.style,S=a!=null&&a.hasOwnProperty("display")?a.display:null,R.style.display=sL("display",S))}catch(ie){Fi(e,e.return,ie)}}}else if(q.tag===6){if(G===null)try{q.stateNode.nodeValue=N?"":q.memoizedProps}catch(ie){Fi(e,e.return,ie)}}else if((q.tag!==22&&q.tag!==23||q.memoizedState===null||q===e)&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===e)break e;for(;q.sibling===null;){if(q.return===null||q.return===e)break e;G===q&&(G=null),q=q.return}G===q&&(G=null),q.sibling.return=q.return,q=q.sibling}}break;case 19:Bs(t,e),gl(e),l&4&&DR(e);break;case 21:break;default:Bs(t,e),gl(e)}}function gl(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(kz(i)){var l=i;break e}i=i.return}throw Error(Qt(160))}switch(l.tag){case 5:var d=l.stateNode;l.flags&32&&(z_(d,""),l.flags&=-33);var y=AR(e);cE(e,y,d);break;case 3:case 4:var S=l.stateNode.containerInfo,R=AR(e);lE(e,R,S);break;default:throw Error(Qt(161))}}catch(a){Fi(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Tj(e,t,i){Sr=e,zz(e)}function zz(e,t,i){for(var l=(e.mode&1)!==0;Sr!==null;){var d=Sr,y=d.child;if(d.tag===22&&l){var S=d.memoizedState!==null||Fv;if(!S){var R=d.alternate,a=R!==null&&R.memoizedState!==null||jo;R=Fv;var N=jo;if(Fv=S,(jo=a)&&!N)for(Sr=d;Sr!==null;)S=Sr,a=S.child,S.tag===22&&S.memoizedState!==null?OR(d):a!==null?(a.return=S,Sr=a):OR(d);for(;y!==null;)Sr=y,zz(y),y=y.sibling;Sr=d,Fv=R,jo=N}RR(e)}else d.subtreeFlags&8772&&y!==null?(y.return=d,Sr=y):RR(e)}}function RR(e){for(;Sr!==null;){var t=Sr;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:jo||R1(5,t);break;case 1:var l=t.stateNode;if(t.flags&4&&!jo)if(i===null)l.componentDidMount();else{var d=t.elementType===t.type?i.memoizedProps:Ns(t.type,i.memoizedProps);l.componentDidUpdate(d,i.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var y=t.updateQueue;y!==null&&gR(t,y,l);break;case 3:var S=t.updateQueue;if(S!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}gR(t,S,i)}break;case 5:var R=t.stateNode;if(i===null&&t.flags&4){i=R;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&i.focus();break;case"img":a.src&&(i.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var N=t.alternate;if(N!==null){var G=N.memoizedState;if(G!==null){var q=G.dehydrated;q!==null&&U_(q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Qt(163))}jo||t.flags&512&&sE(t)}catch(X){Fi(t,t.return,X)}}if(t===e){Sr=null;break}if(i=t.sibling,i!==null){i.return=t.return,Sr=i;break}Sr=t.return}}function kR(e){for(;Sr!==null;){var t=Sr;if(t===e){Sr=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Sr=i;break}Sr=t.return}}function OR(e){for(;Sr!==null;){var t=Sr;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{R1(4,t)}catch(a){Fi(t,i,a)}break;case 1:var l=t.stateNode;if(typeof l.componentDidMount=="function"){var d=t.return;try{l.componentDidMount()}catch(a){Fi(t,d,a)}}var y=t.return;try{sE(t)}catch(a){Fi(t,y,a)}break;case 5:var S=t.return;try{sE(t)}catch(a){Fi(t,S,a)}}}catch(a){Fi(t,t.return,a)}if(t===e){Sr=null;break}var R=t.sibling;if(R!==null){R.return=t.return,Sr=R;break}Sr=t.return}}var Ej=Math.ceil,jx=xc.ReactCurrentDispatcher,UM=xc.ReactCurrentOwner,vs=xc.ReactCurrentBatchConfig,Dn=0,mo=null,Xi=null,Co=0,Ua=0,mp=Zu(0),oo=0,K_=null,gd=0,k1=0,jM=0,M_=null,ya=null,VM=0,Lp=1/0,ic=null,Vx=!1,uE=null,zu=null,Bv=!1,Cu=null,$x=0,C_=0,hE=null,ux=-1,hx=0;function ra(){return Dn&6?ji():ux!==-1?ux:ux=ji()}function Fu(e){return e.mode&1?Dn&2&&Co!==0?Co&-Co:lj.transition!==null?(hx===0&&(hx=xL()),hx):(e=Wn,e!==0||(e=window.event,e=e===void 0?16:CL(e.type)),e):1}function Gs(e,t,i,l){if(50<C_)throw C_=0,hE=null,Error(Qt(185));uy(e,i,l),(!(Dn&2)||e!==mo)&&(e===mo&&(!(Dn&2)&&(k1|=i),oo===4&&Eu(e,Co)),wa(e,l),i===1&&Dn===0&&!(t.mode&1)&&(Lp=ji()+500,P1&&Yu()))}function wa(e,t){var i=e.callbackNode;lU(e,t);var l=Mx(e,e===mo?Co:0);if(l===0)i!==null&&$D(i),e.callbackNode=null,e.callbackPriority=0;else if(t=l&-l,e.callbackPriority!==t){if(i!=null&&$D(i),t===1)e.tag===0?sj(LR.bind(null,e)):HL(LR.bind(null,e)),nj(function(){!(Dn&6)&&Yu()}),i=null;else{switch(bL(l)){case 1:i=pM;break;case 4:i=yL;break;case 16:i=Ex;break;case 536870912:i=vL;break;default:i=Ex}i=Wz(i,Fz.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function Fz(e,t){if(ux=-1,hx=0,Dn&6)throw Error(Qt(327));var i=e.callbackNode;if(Sp()&&e.callbackNode!==i)return null;var l=Mx(e,e===mo?Co:0);if(l===0)return null;if(l&30||l&e.expiredLanes||t)t=Wx(e,l);else{t=l;var d=Dn;Dn|=2;var y=Nz();(mo!==e||Co!==t)&&(ic=null,Lp=ji()+500,cd(e,t));do try{Ij();break}catch(R){Bz(e,R)}while(!0);CM(),jx.current=y,Dn=d,Xi!==null?t=0:(mo=null,Co=0,t=oo)}if(t!==0){if(t===2&&(d=BT(e),d!==0&&(l=d,t=dE(e,d))),t===1)throw i=K_,cd(e,0),Eu(e,l),wa(e,ji()),i;if(t===6)Eu(e,l);else{if(d=e.current.alternate,!(l&30)&&!Mj(d)&&(t=Wx(e,l),t===2&&(y=BT(e),y!==0&&(l=y,t=dE(e,y))),t===1))throw i=K_,cd(e,0),Eu(e,l),wa(e,ji()),i;switch(e.finishedWork=d,e.finishedLanes=l,t){case 0:case 1:throw Error(Qt(345));case 2:Kh(e,ya,ic);break;case 3:if(Eu(e,l),(l&130023424)===l&&(t=VM+500-ji(),10<t)){if(Mx(e,0)!==0)break;if(d=e.suspendedLanes,(d&l)!==l){ra(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=HT(Kh.bind(null,e,ya,ic),t);break}Kh(e,ya,ic);break;case 4:if(Eu(e,l),(l&4194240)===l)break;for(t=e.eventTimes,d=-1;0<l;){var S=31-Ws(l);y=1<<S,S=t[S],S>d&&(d=S),l&=~y}if(l=d,l=ji()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*Ej(l/1960))-l,10<l){e.timeoutHandle=HT(Kh.bind(null,e,ya,ic),l);break}Kh(e,ya,ic);break;case 5:Kh(e,ya,ic);break;default:throw Error(Qt(329))}}}return wa(e,ji()),e.callbackNode===i?Fz.bind(null,e):null}function dE(e,t){var i=M_;return e.current.memoizedState.isDehydrated&&(cd(e,t).flags|=256),e=Wx(e,t),e!==2&&(t=ya,ya=i,t!==null&&fE(t)),e}function fE(e){ya===null?ya=e:ya.push.apply(ya,e)}function Mj(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var l=0;l<i.length;l++){var d=i[l],y=d.getSnapshot;d=d.value;try{if(!qs(y(),d))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Eu(e,t){for(t&=~jM,t&=~k1,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Ws(t),l=1<<i;e[i]=-1,t&=~l}}function LR(e){if(Dn&6)throw Error(Qt(327));Sp();var t=Mx(e,0);if(!(t&1))return wa(e,ji()),null;var i=Wx(e,t);if(e.tag!==0&&i===2){var l=BT(e);l!==0&&(t=l,i=dE(e,l))}if(i===1)throw i=K_,cd(e,0),Eu(e,t),wa(e,ji()),i;if(i===6)throw Error(Qt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Kh(e,ya,ic),wa(e,ji()),null}function $M(e,t){var i=Dn;Dn|=1;try{return e(t)}finally{Dn=i,Dn===0&&(Lp=ji()+500,P1&&Yu())}}function _d(e){Cu!==null&&Cu.tag===0&&!(Dn&6)&&Sp();var t=Dn;Dn|=1;var i=vs.transition,l=Wn;try{if(vs.transition=null,Wn=1,e)return e()}finally{Wn=l,vs.transition=i,Dn=t,!(Dn&6)&&Yu()}}function WM(){Ua=mp.current,_i(mp)}function cd(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,rj(i)),Xi!==null)for(i=Xi.return;i!==null;){var l=i;switch(TM(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&Dx();break;case 3:kp(),_i(xa),_i($o),kM();break;case 5:RM(l);break;case 4:kp();break;case 13:_i(Ii);break;case 19:_i(Ii);break;case 10:IM(l.type._context);break;case 22:case 23:WM()}i=i.return}if(mo=e,Xi=e=Bu(e.current,null),Co=Ua=t,oo=0,K_=null,jM=k1=gd=0,ya=M_=null,id!==null){for(t=0;t<id.length;t++)if(i=id[t],l=i.interleaved,l!==null){i.interleaved=null;var d=l.next,y=i.pending;if(y!==null){var S=y.next;y.next=d,l.next=S}i.pending=l}id=null}return e}function Bz(e,t){do{var i=Xi;try{if(CM(),sx.current=Ux,Nx){for(var l=Ai.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}Nx=!1}if(md=0,po=io=Ai=null,T_=!1,Z_=0,UM.current=null,i===null||i.return===null){oo=1,K_=t,Xi=null;break}e:{var y=e,S=i.return,R=i,a=t;if(t=Co,R.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var N=a,G=R,q=G.tag;if(!(G.mode&1)&&(q===0||q===11||q===15)){var X=G.alternate;X?(G.updateQueue=X.updateQueue,G.memoizedState=X.memoizedState,G.lanes=X.lanes):(G.updateQueue=null,G.memoizedState=null)}var oe=wR(S);if(oe!==null){oe.flags&=-257,SR(oe,S,R,y,t),oe.mode&1&&bR(y,N,t),t=oe,a=N;var te=t.updateQueue;if(te===null){var ie=new Set;ie.add(a),t.updateQueue=ie}else te.add(a);break e}else{if(!(t&1)){bR(y,N,t),GM();break e}a=Error(Qt(426))}}else if(bi&&R.mode&1){var pe=wR(S);if(pe!==null){!(pe.flags&65536)&&(pe.flags|=256),SR(pe,S,R,y,t),EM(Op(a,R));break e}}y=a=Op(a,R),oo!==4&&(oo=2),M_===null?M_=[y]:M_.push(y),y=S;do{switch(y.tag){case 3:y.flags|=65536,t&=-t,y.lanes|=t;var se=bz(y,a,t);mR(y,se);break e;case 1:R=a;var le=y.type,ce=y.stateNode;if(!(y.flags&128)&&(typeof le.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(zu===null||!zu.has(ce)))){y.flags|=65536,t&=-t,y.lanes|=t;var Me=wz(y,R,t);mR(y,Me);break e}}y=y.return}while(y!==null)}jz(i)}catch(Le){t=Le,Xi===i&&i!==null&&(Xi=i=i.return);continue}break}while(!0)}function Nz(){var e=jx.current;return jx.current=Ux,e===null?Ux:e}function GM(){(oo===0||oo===3||oo===2)&&(oo=4),mo===null||!(gd&268435455)&&!(k1&268435455)||Eu(mo,Co)}function Wx(e,t){var i=Dn;Dn|=2;var l=Nz();(mo!==e||Co!==t)&&(ic=null,cd(e,t));do try{Cj();break}catch(d){Bz(e,d)}while(!0);if(CM(),Dn=i,jx.current=l,Xi!==null)throw Error(Qt(261));return mo=null,Co=0,oo}function Cj(){for(;Xi!==null;)Uz(Xi)}function Ij(){for(;Xi!==null&&!Q6();)Uz(Xi)}function Uz(e){var t=$z(e.alternate,e,Ua);e.memoizedProps=e.pendingProps,t===null?jz(e):Xi=t,UM.current=null}function jz(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=bj(i,t),i!==null){i.flags&=32767,Xi=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{oo=6,Xi=null;return}}else if(i=xj(i,t,Ua),i!==null){Xi=i;return}if(t=t.sibling,t!==null){Xi=t;return}Xi=t=e}while(t!==null);oo===0&&(oo=5)}function Kh(e,t,i){var l=Wn,d=vs.transition;try{vs.transition=null,Wn=1,Pj(e,t,i,l)}finally{vs.transition=d,Wn=l}return null}function Pj(e,t,i,l){do Sp();while(Cu!==null);if(Dn&6)throw Error(Qt(327));i=e.finishedWork;var d=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(Qt(177));e.callbackNode=null,e.callbackPriority=0;var y=i.lanes|i.childLanes;if(cU(e,y),e===mo&&(Xi=mo=null,Co=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||Bv||(Bv=!0,Wz(Ex,function(){return Sp(),null})),y=(i.flags&15990)!==0,i.subtreeFlags&15990||y){y=vs.transition,vs.transition=null;var S=Wn;Wn=1;var R=Dn;Dn|=4,UM.current=null,Sj(e,i),Lz(i,e),YU(WT),Cx=!!$T,WT=$T=null,e.current=i,Tj(i),eU(),Dn=R,Wn=S,vs.transition=y}else e.current=i;if(Bv&&(Bv=!1,Cu=e,$x=d),y=e.pendingLanes,y===0&&(zu=null),nU(i.stateNode),wa(e,ji()),t!==null)for(l=e.onRecoverableError,i=0;i<t.length;i++)d=t[i],l(d.value,{componentStack:d.stack,digest:d.digest});if(Vx)throw Vx=!1,e=uE,uE=null,e;return $x&1&&e.tag!==0&&Sp(),y=e.pendingLanes,y&1?e===hE?C_++:(C_=0,hE=e):C_=0,Yu(),null}function Sp(){if(Cu!==null){var e=bL($x),t=vs.transition,i=Wn;try{if(vs.transition=null,Wn=16>e?16:e,Cu===null)var l=!1;else{if(e=Cu,Cu=null,$x=0,Dn&6)throw Error(Qt(331));var d=Dn;for(Dn|=4,Sr=e.current;Sr!==null;){var y=Sr,S=y.child;if(Sr.flags&16){var R=y.deletions;if(R!==null){for(var a=0;a<R.length;a++){var N=R[a];for(Sr=N;Sr!==null;){var G=Sr;switch(G.tag){case 0:case 11:case 15:E_(8,G,y)}var q=G.child;if(q!==null)q.return=G,Sr=q;else for(;Sr!==null;){G=Sr;var X=G.sibling,oe=G.return;if(Rz(G),G===N){Sr=null;break}if(X!==null){X.return=oe,Sr=X;break}Sr=oe}}}var te=y.alternate;if(te!==null){var ie=te.child;if(ie!==null){te.child=null;do{var pe=ie.sibling;ie.sibling=null,ie=pe}while(ie!==null)}}Sr=y}}if(y.subtreeFlags&2064&&S!==null)S.return=y,Sr=S;else e:for(;Sr!==null;){if(y=Sr,y.flags&2048)switch(y.tag){case 0:case 11:case 15:E_(9,y,y.return)}var se=y.sibling;if(se!==null){se.return=y.return,Sr=se;break e}Sr=y.return}}var le=e.current;for(Sr=le;Sr!==null;){S=Sr;var ce=S.child;if(S.subtreeFlags&2064&&ce!==null)ce.return=S,Sr=ce;else e:for(S=le;Sr!==null;){if(R=Sr,R.flags&2048)try{switch(R.tag){case 0:case 11:case 15:R1(9,R)}}catch(Le){Fi(R,R.return,Le)}if(R===S){Sr=null;break e}var Me=R.sibling;if(Me!==null){Me.return=R.return,Sr=Me;break e}Sr=R.return}}if(Dn=d,Yu(),Pl&&typeof Pl.onPostCommitFiberRoot=="function")try{Pl.onPostCommitFiberRoot(T1,e)}catch{}l=!0}return l}finally{Wn=i,vs.transition=t}}return!1}function zR(e,t,i){t=Op(i,t),t=bz(e,t,1),e=Lu(e,t,1),t=ra(),e!==null&&(uy(e,1,t),wa(e,t))}function Fi(e,t,i){if(e.tag===3)zR(e,e,i);else for(;t!==null;){if(t.tag===3){zR(t,e,i);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(zu===null||!zu.has(l))){e=Op(i,e),e=wz(t,e,1),t=Lu(t,e,1),e=ra(),t!==null&&(uy(t,1,e),wa(t,e));break}}t=t.return}}function Aj(e,t,i){var l=e.pingCache;l!==null&&l.delete(t),t=ra(),e.pingedLanes|=e.suspendedLanes&i,mo===e&&(Co&i)===i&&(oo===4||oo===3&&(Co&130023424)===Co&&500>ji()-VM?cd(e,0):jM|=i),wa(e,t)}function Vz(e,t){t===0&&(e.mode&1?(t=Iv,Iv<<=1,!(Iv&130023424)&&(Iv=4194304)):t=1);var i=ra();e=dc(e,t),e!==null&&(uy(e,t,i),wa(e,i))}function Dj(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),Vz(e,i)}function Rj(e,t){var i=0;switch(e.tag){case 13:var l=e.stateNode,d=e.memoizedState;d!==null&&(i=d.retryLane);break;case 19:l=e.stateNode;break;default:throw Error(Qt(314))}l!==null&&l.delete(t),Vz(e,i)}var $z;$z=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||xa.current)va=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return va=!1,vj(e,t,i);va=!!(e.flags&131072)}else va=!1,bi&&t.flags&1048576&&qL(t,Ox,t.index);switch(t.lanes=0,t.tag){case 2:var l=t.type;cx(e,t),e=t.pendingProps;var d=Ap(t,$o.current);wp(t,i),d=LM(null,t,l,e,d,i);var y=zM();return t.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ba(l)?(y=!0,Rx(t)):y=!1,t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,AM(t),d.updater=D1,t.stateNode=d,d._reactInternals=t,QT(t,l,e,i),t=rE(null,t,l,!0,y,i)):(t.tag=0,bi&&y&&SM(t),ta(null,t,d,i),t=t.child),t;case 16:l=t.elementType;e:{switch(cx(e,t),e=t.pendingProps,d=l._init,l=d(l._payload),t.type=l,d=t.tag=Oj(l),e=Ns(l,e),d){case 0:t=tE(null,t,l,e,i);break e;case 1:t=MR(null,t,l,e,i);break e;case 11:t=TR(null,t,l,e,i);break e;case 14:t=ER(null,t,l,Ns(l.type,e),i);break e}throw Error(Qt(306,l,""))}return t;case 0:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Ns(l,d),tE(e,t,l,d,i);case 1:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Ns(l,d),MR(e,t,l,d,i);case 3:e:{if(Mz(t),e===null)throw Error(Qt(387));l=t.pendingProps,y=t.memoizedState,d=y.element,QL(e,t),Fx(t,l,null,i);var S=t.memoizedState;if(l=S.element,y.isDehydrated)if(y={element:l,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},t.updateQueue.baseState=y,t.memoizedState=y,t.flags&256){d=Op(Error(Qt(423)),t),t=CR(e,t,l,i,d);break e}else if(l!==d){d=Op(Error(Qt(424)),t),t=CR(e,t,l,i,d);break e}else for(Va=Ou(t.stateNode.containerInfo.firstChild),$a=t,bi=!0,Vs=null,i=KL(t,null,l,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Dp(),l===d){t=fc(e,t,i);break e}ta(e,t,l,i)}t=t.child}return t;case 5:return ez(t),e===null&&XT(t),l=t.type,d=t.pendingProps,y=e!==null?e.memoizedProps:null,S=d.children,GT(l,d)?S=null:y!==null&&GT(l,y)&&(t.flags|=32),Ez(e,t),ta(e,t,S,i),t.child;case 6:return e===null&&XT(t),null;case 13:return Cz(e,t,i);case 4:return DM(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=Rp(t,null,l,i):ta(e,t,l,i),t.child;case 11:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Ns(l,d),TR(e,t,l,d,i);case 7:return ta(e,t,t.pendingProps,i),t.child;case 8:return ta(e,t,t.pendingProps.children,i),t.child;case 12:return ta(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(l=t.type._context,d=t.pendingProps,y=t.memoizedProps,S=d.value,ui(Lx,l._currentValue),l._currentValue=S,y!==null)if(qs(y.value,S)){if(y.children===d.children&&!xa.current){t=fc(e,t,i);break e}}else for(y=t.child,y!==null&&(y.return=t);y!==null;){var R=y.dependencies;if(R!==null){S=y.child;for(var a=R.firstContext;a!==null;){if(a.context===l){if(y.tag===1){a=cc(-1,i&-i),a.tag=2;var N=y.updateQueue;if(N!==null){N=N.shared;var G=N.pending;G===null?a.next=a:(a.next=G.next,G.next=a),N.pending=a}}y.lanes|=i,a=y.alternate,a!==null&&(a.lanes|=i),KT(y.return,i,t),R.lanes|=i;break}a=a.next}}else if(y.tag===10)S=y.type===t.type?null:y.child;else if(y.tag===18){if(S=y.return,S===null)throw Error(Qt(341));S.lanes|=i,R=S.alternate,R!==null&&(R.lanes|=i),KT(S,i,t),S=y.sibling}else S=y.child;if(S!==null)S.return=y;else for(S=y;S!==null;){if(S===t){S=null;break}if(y=S.sibling,y!==null){y.return=S.return,S=y;break}S=S.return}y=S}ta(e,t,d.children,i),t=t.child}return t;case 9:return d=t.type,l=t.pendingProps.children,wp(t,i),d=xs(d),l=l(d),t.flags|=1,ta(e,t,l,i),t.child;case 14:return l=t.type,d=Ns(l,t.pendingProps),d=Ns(l.type,d),ER(e,t,l,d,i);case 15:return Sz(e,t,t.type,t.pendingProps,i);case 17:return l=t.type,d=t.pendingProps,d=t.elementType===l?d:Ns(l,d),cx(e,t),t.tag=1,ba(l)?(e=!0,Rx(t)):e=!1,wp(t,i),xz(t,l,d),QT(t,l,d,i),rE(null,t,l,!0,e,i);case 19:return Iz(e,t,i);case 22:return Tz(e,t,i)}throw Error(Qt(156,t.tag))};function Wz(e,t){return _L(e,t)}function kj(e,t,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ys(e,t,i,l){return new kj(e,t,i,l)}function HM(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Oj(e){if(typeof e=="function")return HM(e)?1:0;if(e!=null){if(e=e.$$typeof,e===hM)return 11;if(e===dM)return 14}return 2}function Bu(e,t){var i=e.alternate;return i===null?(i=ys(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function dx(e,t,i,l,d,y){var S=2;if(l=e,typeof e=="function")HM(e)&&(S=1);else if(typeof e=="string")S=5;else e:switch(e){case op:return ud(i.children,d,y,t);case uM:S=8,d|=8;break;case ST:return e=ys(12,i,t,d|2),e.elementType=ST,e.lanes=y,e;case TT:return e=ys(13,i,t,d),e.elementType=TT,e.lanes=y,e;case ET:return e=ys(19,i,t,d),e.elementType=ET,e.lanes=y,e;case eL:return O1(i,d,y,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case JO:S=10;break e;case QO:S=9;break e;case hM:S=11;break e;case dM:S=14;break e;case wu:S=16,l=null;break e}throw Error(Qt(130,e==null?e:typeof e,""))}return t=ys(S,i,t,d),t.elementType=e,t.type=l,t.lanes=y,t}function ud(e,t,i,l){return e=ys(7,e,l,t),e.lanes=i,e}function O1(e,t,i,l){return e=ys(22,e,l,t),e.elementType=eL,e.lanes=i,e.stateNode={isHidden:!1},e}function eT(e,t,i){return e=ys(6,e,null,t),e.lanes=i,e}function tT(e,t,i){return t=ys(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Lj(e,t,i,l,d){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=LS(0),this.expirationTimes=LS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=LS(0),this.identifierPrefix=l,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function qM(e,t,i,l,d,y,S,R,a){return e=new Lj(e,t,i,R,a),t===1?(t=1,y===!0&&(t|=8)):t=0,y=ys(3,null,null,t),e.current=y,y.stateNode=e,y.memoizedState={element:l,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},AM(y),e}function zj(e,t,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ip,key:l==null?null:""+l,children:e,containerInfo:t,implementation:i}}function Gz(e){if(!e)return Vu;e=e._reactInternals;e:{if(Sd(e)!==e||e.tag!==1)throw Error(Qt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ba(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Qt(171))}if(e.tag===1){var i=e.type;if(ba(i))return GL(e,i,t)}return t}function Hz(e,t,i,l,d,y,S,R,a){return e=qM(i,l,!0,e,d,y,S,R,a),e.context=Gz(null),i=e.current,l=ra(),d=Fu(i),y=cc(l,d),y.callback=t??null,Lu(i,y,d),e.current.lanes=d,uy(e,d,l),wa(e,l),e}function L1(e,t,i,l){var d=t.current,y=ra(),S=Fu(d);return i=Gz(i),t.context===null?t.context=i:t.pendingContext=i,t=cc(y,S),t.payload={element:e},l=l===void 0?null:l,l!==null&&(t.callback=l),e=Lu(d,t,S),e!==null&&(Gs(e,d,S,y),ax(e,d,S)),S}function Gx(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function FR(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function ZM(e,t){FR(e,t),(e=e.alternate)&&FR(e,t)}function Fj(){return null}var qz=typeof reportError=="function"?reportError:function(e){console.error(e)};function YM(e){this._internalRoot=e}z1.prototype.render=YM.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Qt(409));L1(e,t,null,null)};z1.prototype.unmount=YM.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;_d(function(){L1(null,e,null,null)}),t[hc]=null}};function z1(e){this._internalRoot=e}z1.prototype.unstable_scheduleHydration=function(e){if(e){var t=TL();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Tu.length&&t!==0&&t<Tu[i].priority;i++);Tu.splice(i,0,e),i===0&&ML(e)}};function XM(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function F1(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function BR(){}function Bj(e,t,i,l,d){if(d){if(typeof l=="function"){var y=l;l=function(){var N=Gx(S);y.call(N)}}var S=Hz(t,l,e,0,null,!1,!1,"",BR);return e._reactRootContainer=S,e[hc]=S.current,$_(e.nodeType===8?e.parentNode:e),_d(),S}for(;d=e.lastChild;)e.removeChild(d);if(typeof l=="function"){var R=l;l=function(){var N=Gx(a);R.call(N)}}var a=qM(e,0,!1,null,null,!1,!1,"",BR);return e._reactRootContainer=a,e[hc]=a.current,$_(e.nodeType===8?e.parentNode:e),_d(function(){L1(t,a,i,l)}),a}function B1(e,t,i,l,d){var y=i._reactRootContainer;if(y){var S=y;if(typeof d=="function"){var R=d;d=function(){var a=Gx(S);R.call(a)}}L1(t,S,e,d)}else S=Bj(i,t,e,d,l);return Gx(S)}wL=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=p_(t.pendingLanes);i!==0&&(mM(t,i|1),wa(t,ji()),!(Dn&6)&&(Lp=ji()+500,Yu()))}break;case 13:_d(function(){var l=dc(e,1);if(l!==null){var d=ra();Gs(l,e,1,d)}}),ZM(e,1)}};gM=function(e){if(e.tag===13){var t=dc(e,134217728);if(t!==null){var i=ra();Gs(t,e,134217728,i)}ZM(e,134217728)}};SL=function(e){if(e.tag===13){var t=Fu(e),i=dc(e,t);if(i!==null){var l=ra();Gs(i,e,t,l)}ZM(e,t)}};TL=function(){return Wn};EL=function(e,t){var i=Wn;try{return Wn=e,t()}finally{Wn=i}};LT=function(e,t,i){switch(t){case"input":if(IT(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var l=i[t];if(l!==e&&l.form===e.form){var d=I1(l);if(!d)throw Error(Qt(90));rL(l),IT(l,d)}}}break;case"textarea":iL(e,i);break;case"select":t=i.value,t!=null&&yp(e,!!i.multiple,t,!1)}};hL=$M;dL=_d;var Nj={usingClientEntryPoint:!1,Events:[dy,cp,I1,cL,uL,$M]},Xg={findFiberByHostInstance:nd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Uj={bundleType:Xg.bundleType,version:Xg.version,rendererPackageName:Xg.rendererPackageName,rendererConfig:Xg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xc.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=mL(e),e===null?null:e.stateNode},findFiberByHostInstance:Xg.findFiberByHostInstance||Fj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nv.isDisabled&&Nv.supportsFiber)try{T1=Nv.inject(Uj),Pl=Nv}catch{}}qa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nj;qa.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!XM(t))throw Error(Qt(200));return zj(e,t,null,i)};qa.createRoot=function(e,t){if(!XM(e))throw Error(Qt(299));var i=!1,l="",d=qz;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(d=t.onRecoverableError)),t=qM(e,1,!1,null,null,i,!1,l,d),e[hc]=t.current,$_(e.nodeType===8?e.parentNode:e),new YM(t)};qa.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Qt(188)):(e=Object.keys(e).join(","),Error(Qt(268,e)));return e=mL(t),e=e===null?null:e.stateNode,e};qa.flushSync=function(e){return _d(e)};qa.hydrate=function(e,t,i){if(!F1(t))throw Error(Qt(200));return B1(null,e,t,!0,i)};qa.hydrateRoot=function(e,t,i){if(!XM(e))throw Error(Qt(405));var l=i!=null&&i.hydratedSources||null,d=!1,y="",S=qz;if(i!=null&&(i.unstable_strictMode===!0&&(d=!0),i.identifierPrefix!==void 0&&(y=i.identifierPrefix),i.onRecoverableError!==void 0&&(S=i.onRecoverableError)),t=Hz(t,null,e,1,i??null,d,!1,y,S),e[hc]=t.current,$_(e),l)for(e=0;e<l.length;e++)i=l[e],d=i._getVersion,d=d(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,d]:t.mutableSourceEagerHydrationData.push(i,d);return new z1(t)};qa.render=function(e,t,i){if(!F1(t))throw Error(Qt(200));return B1(null,e,t,!1,i)};qa.unmountComponentAtNode=function(e){if(!F1(e))throw Error(Qt(40));return e._reactRootContainer?(_d(function(){B1(null,null,e,!1,function(){e._reactRootContainer=null,e[hc]=null})}),!0):!1};qa.unstable_batchedUpdates=$M;qa.unstable_renderSubtreeIntoContainer=function(e,t,i,l){if(!F1(i))throw Error(Qt(200));if(e==null||e._reactInternals===void 0)throw Error(Qt(38));return B1(e,t,i,!1,l)};qa.version="18.3.1-next-f1338f8080-20240426";function Zz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Zz)}catch(e){console.error(e)}}Zz(),ZO.exports=qa;var N1=ZO.exports;const Uv=ly(N1);var Yz,NR=N1;Yz=NR.createRoot,NR.hydrateRoot;/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function J_(){return J_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},J_.apply(this,arguments)}var Iu;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Iu||(Iu={}));const UR="popstate";function jj(e){e===void 0&&(e={});function t(l,d){let{pathname:y,search:S,hash:R}=l.location;return pE("",{pathname:y,search:S,hash:R},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function i(l,d){return typeof d=="string"?d:Hx(d)}return $j(t,i,null,e)}function Ki(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Xz(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Vj(){return Math.random().toString(36).substr(2,8)}function jR(e,t){return{usr:e.state,key:e.key,idx:t}}function pE(e,t,i,l){return i===void 0&&(i=null),J_({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Gp(t):t,{state:i,key:t&&t.key||l||Vj()})}function Hx(e){let{pathname:t="/",search:i="",hash:l=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),l&&l!=="#"&&(t+=l.charAt(0)==="#"?l:"#"+l),t}function Gp(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let l=e.indexOf("?");l>=0&&(t.search=e.substr(l),e=e.substr(0,l)),e&&(t.pathname=e)}return t}function $j(e,t,i,l){l===void 0&&(l={});let{window:d=document.defaultView,v5Compat:y=!1}=l,S=d.history,R=Iu.Pop,a=null,N=G();N==null&&(N=0,S.replaceState(J_({},S.state,{idx:N}),""));function G(){return(S.state||{idx:null}).idx}function q(){R=Iu.Pop;let pe=G(),se=pe==null?null:pe-N;N=pe,a&&a({action:R,location:ie.location,delta:se})}function X(pe,se){R=Iu.Push;let le=pE(ie.location,pe,se);N=G()+1;let ce=jR(le,N),Me=ie.createHref(le);try{S.pushState(ce,"",Me)}catch(Le){if(Le instanceof DOMException&&Le.name==="DataCloneError")throw Le;d.location.assign(Me)}y&&a&&a({action:R,location:ie.location,delta:1})}function oe(pe,se){R=Iu.Replace;let le=pE(ie.location,pe,se);N=G();let ce=jR(le,N),Me=ie.createHref(le);S.replaceState(ce,"",Me),y&&a&&a({action:R,location:ie.location,delta:0})}function te(pe){let se=d.location.origin!=="null"?d.location.origin:d.location.href,le=typeof pe=="string"?pe:Hx(pe);return le=le.replace(/ $/,"%20"),Ki(se,"No window.location.(origin|href) available to create URL for href: "+le),new URL(le,se)}let ie={get action(){return R},get location(){return e(d,S)},listen(pe){if(a)throw new Error("A history only accepts one active listener");return d.addEventListener(UR,q),a=pe,()=>{d.removeEventListener(UR,q),a=null}},createHref(pe){return t(d,pe)},createURL:te,encodeLocation(pe){let se=te(pe);return{pathname:se.pathname,search:se.search,hash:se.hash}},push:X,replace:oe,go(pe){return S.go(pe)}};return ie}var VR;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(VR||(VR={}));function Wj(e,t,i){return i===void 0&&(i="/"),Gj(e,t,i,!1)}function Gj(e,t,i,l){let d=typeof t=="string"?Gp(t):t,y=KM(d.pathname||"/",i);if(y==null)return null;let S=Kz(e);Hj(S);let R=null;for(let a=0;R==null&&a<S.length;++a){let N=nV(y);R=tV(S[a],N,l)}return R}function Kz(e,t,i,l){t===void 0&&(t=[]),i===void 0&&(i=[]),l===void 0&&(l="");let d=(y,S,R)=>{let a={relativePath:R===void 0?y.path||"":R,caseSensitive:y.caseSensitive===!0,childrenIndex:S,route:y};a.relativePath.startsWith("/")&&(Ki(a.relativePath.startsWith(l),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(l.length));let N=Nu([l,a.relativePath]),G=i.concat(a);y.children&&y.children.length>0&&(Ki(y.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+N+'".')),Kz(y.children,t,G,N)),!(y.path==null&&!y.index)&&t.push({path:N,score:Qj(N,y.index),routesMeta:G})};return e.forEach((y,S)=>{var R;if(y.path===""||!((R=y.path)!=null&&R.includes("?")))d(y,S);else for(let a of Jz(y.path))d(y,S,a)}),t}function Jz(e){let t=e.split("/");if(t.length===0)return[];let[i,...l]=t,d=i.endsWith("?"),y=i.replace(/\?$/,"");if(l.length===0)return d?[y,""]:[y];let S=Jz(l.join("/")),R=[];return R.push(...S.map(a=>a===""?y:[y,a].join("/"))),d&&R.push(...S),R.map(a=>e.startsWith("/")&&a===""?"/":a)}function Hj(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:eV(t.routesMeta.map(l=>l.childrenIndex),i.routesMeta.map(l=>l.childrenIndex)))}const qj=/^:[\w-]+$/,Zj=3,Yj=2,Xj=1,Kj=10,Jj=-2,$R=e=>e==="*";function Qj(e,t){let i=e.split("/"),l=i.length;return i.some($R)&&(l+=Jj),t&&(l+=Yj),i.filter(d=>!$R(d)).reduce((d,y)=>d+(qj.test(y)?Zj:y===""?Xj:Kj),l)}function eV(e,t){return e.length===t.length&&e.slice(0,-1).every((l,d)=>l===t[d])?e[e.length-1]-t[t.length-1]:0}function tV(e,t,i){let{routesMeta:l}=e,d={},y="/",S=[];for(let R=0;R<l.length;++R){let a=l[R],N=R===l.length-1,G=y==="/"?t:t.slice(y.length)||"/",q=WR({path:a.relativePath,caseSensitive:a.caseSensitive,end:N},G),X=a.route;if(!q&&N&&i&&!l[l.length-1].route.index&&(q=WR({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},G)),!q)return null;Object.assign(d,q.params),S.push({params:d,pathname:Nu([y,q.pathname]),pathnameBase:sV(Nu([y,q.pathnameBase])),route:X}),q.pathnameBase!=="/"&&(y=Nu([y,q.pathnameBase]))}return S}function WR(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,l]=rV(e.path,e.caseSensitive,e.end),d=t.match(i);if(!d)return null;let y=d[0],S=y.replace(/(.)\/+$/,"$1"),R=d.slice(1);return{params:l.reduce((N,G,q)=>{let{paramName:X,isOptional:oe}=G;if(X==="*"){let ie=R[q]||"";S=y.slice(0,y.length-ie.length).replace(/(.)\/+$/,"$1")}const te=R[q];return oe&&!te?N[X]=void 0:N[X]=(te||"").replace(/%2F/g,"/"),N},{}),pathname:y,pathnameBase:S,pattern:e}}function rV(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),Xz(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let l=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(S,R,a)=>(l.push({paramName:R,isOptional:a!=null}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(l.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,t?void 0:"i"),l]}function nV(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Xz(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function KM(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,l=e.charAt(i);return l&&l!=="/"?null:e.slice(i)||"/"}function iV(e,t){t===void 0&&(t="/");let{pathname:i,search:l="",hash:d=""}=typeof e=="string"?Gp(e):e;return{pathname:i?i.startsWith("/")?i:oV(i,t):t,search:lV(l),hash:cV(d)}}function oV(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?i.length>1&&i.pop():d!=="."&&i.push(d)}),i.length>1?i.join("/"):"/"}function rT(e,t,i,l){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function aV(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function Qz(e,t){let i=aV(e);return t?i.map((l,d)=>d===i.length-1?l.pathname:l.pathnameBase):i.map(l=>l.pathnameBase)}function e4(e,t,i,l){l===void 0&&(l=!1);let d;typeof e=="string"?d=Gp(e):(d=J_({},e),Ki(!d.pathname||!d.pathname.includes("?"),rT("?","pathname","search",d)),Ki(!d.pathname||!d.pathname.includes("#"),rT("#","pathname","hash",d)),Ki(!d.search||!d.search.includes("#"),rT("#","search","hash",d)));let y=e===""||d.pathname==="",S=y?"/":d.pathname,R;if(S==null)R=i;else{let q=t.length-1;if(!l&&S.startsWith("..")){let X=S.split("/");for(;X[0]==="..";)X.shift(),q-=1;d.pathname=X.join("/")}R=q>=0?t[q]:"/"}let a=iV(d,R),N=S&&S!=="/"&&S.endsWith("/"),G=(y||S===".")&&i.endsWith("/");return!a.pathname.endsWith("/")&&(N||G)&&(a.pathname+="/"),a}const Nu=e=>e.join("/").replace(/\/\/+/g,"/"),sV=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),lV=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,cV=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function uV(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const t4=["post","put","patch","delete"];new Set(t4);const hV=["get",...t4];new Set(hV);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Q_(){return Q_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},Q_.apply(this,arguments)}const JM=we.createContext(null),dV=we.createContext(null),Td=we.createContext(null),U1=we.createContext(null),Xu=we.createContext({outlet:null,matches:[],isDataRoute:!1}),r4=we.createContext(null);function fV(e,t){let{relative:i}=t===void 0?{}:t;py()||Ki(!1);let{basename:l,navigator:d}=we.useContext(Td),{hash:y,pathname:S,search:R}=o4(e,{relative:i}),a=S;return l!=="/"&&(a=S==="/"?l:Nu([l,S])),d.createHref({pathname:a,search:R,hash:y})}function py(){return we.useContext(U1)!=null}function Ku(){return py()||Ki(!1),we.useContext(U1).location}function n4(e){we.useContext(Td).static||we.useLayoutEffect(e)}function Hp(){let{isDataRoute:e}=we.useContext(Xu);return e?MV():pV()}function pV(){py()||Ki(!1);let e=we.useContext(JM),{basename:t,future:i,navigator:l}=we.useContext(Td),{matches:d}=we.useContext(Xu),{pathname:y}=Ku(),S=JSON.stringify(Qz(d,i.v7_relativeSplatPath)),R=we.useRef(!1);return n4(()=>{R.current=!0}),we.useCallback(function(N,G){if(G===void 0&&(G={}),!R.current)return;if(typeof N=="number"){l.go(N);return}let q=e4(N,JSON.parse(S),y,G.relative==="path");e==null&&t!=="/"&&(q.pathname=q.pathname==="/"?t:Nu([t,q.pathname])),(G.replace?l.replace:l.push)(q,G.state,G)},[t,l,S,y,e])}function i4(){let{matches:e}=we.useContext(Xu),t=e[e.length-1];return t?t.params:{}}function o4(e,t){let{relative:i}=t===void 0?{}:t,{future:l}=we.useContext(Td),{matches:d}=we.useContext(Xu),{pathname:y}=Ku(),S=JSON.stringify(Qz(d,l.v7_relativeSplatPath));return we.useMemo(()=>e4(e,JSON.parse(S),y,i==="path"),[e,S,y,i])}function mV(e,t){return gV(e,t)}function gV(e,t,i,l){py()||Ki(!1);let{navigator:d}=we.useContext(Td),{matches:y}=we.useContext(Xu),S=y[y.length-1],R=S?S.params:{};S&&S.pathname;let a=S?S.pathnameBase:"/";S&&S.route;let N=Ku(),G;if(t){var q;let pe=typeof t=="string"?Gp(t):t;a==="/"||(q=pe.pathname)!=null&&q.startsWith(a)||Ki(!1),G=pe}else G=N;let X=G.pathname||"/",oe=X;if(a!=="/"){let pe=a.replace(/^\//,"").split("/");oe="/"+X.replace(/^\//,"").split("/").slice(pe.length).join("/")}let te=Wj(e,{pathname:oe}),ie=bV(te&&te.map(pe=>Object.assign({},pe,{params:Object.assign({},R,pe.params),pathname:Nu([a,d.encodeLocation?d.encodeLocation(pe.pathname).pathname:pe.pathname]),pathnameBase:pe.pathnameBase==="/"?a:Nu([a,d.encodeLocation?d.encodeLocation(pe.pathnameBase).pathname:pe.pathnameBase])})),y,i,l);return t&&ie?we.createElement(U1.Provider,{value:{location:Q_({pathname:"/",search:"",hash:"",state:null,key:"default"},G),navigationType:Iu.Pop}},ie):ie}function _V(){let e=EV(),t=uV(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return we.createElement(we.Fragment,null,we.createElement("h2",null,"Unexpected Application Error!"),we.createElement("h3",{style:{fontStyle:"italic"}},t),i?we.createElement("pre",{style:d},i):null,null)}const yV=we.createElement(_V,null);class vV extends we.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?we.createElement(Xu.Provider,{value:this.props.routeContext},we.createElement(r4.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xV(e){let{routeContext:t,match:i,children:l}=e,d=we.useContext(JM);return d&&d.static&&d.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=i.route.id),we.createElement(Xu.Provider,{value:t},l)}function bV(e,t,i,l){var d;if(t===void 0&&(t=[]),i===void 0&&(i=null),l===void 0&&(l=null),e==null){var y;if(!i)return null;if(i.errors)e=i.matches;else if((y=l)!=null&&y.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let S=e,R=(d=i)==null?void 0:d.errors;if(R!=null){let G=S.findIndex(q=>q.route.id&&(R==null?void 0:R[q.route.id])!==void 0);G>=0||Ki(!1),S=S.slice(0,Math.min(S.length,G+1))}let a=!1,N=-1;if(i&&l&&l.v7_partialHydration)for(let G=0;G<S.length;G++){let q=S[G];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(N=G),q.route.id){let{loaderData:X,errors:oe}=i,te=q.route.loader&&X[q.route.id]===void 0&&(!oe||oe[q.route.id]===void 0);if(q.route.lazy||te){a=!0,N>=0?S=S.slice(0,N+1):S=[S[0]];break}}}return S.reduceRight((G,q,X)=>{let oe,te=!1,ie=null,pe=null;i&&(oe=R&&q.route.id?R[q.route.id]:void 0,ie=q.route.errorElement||yV,a&&(N<0&&X===0?(te=!0,pe=null):N===X&&(te=!0,pe=q.route.hydrateFallbackElement||null)));let se=t.concat(S.slice(0,X+1)),le=()=>{let ce;return oe?ce=ie:te?ce=pe:q.route.Component?ce=we.createElement(q.route.Component,null):q.route.element?ce=q.route.element:ce=G,we.createElement(xV,{match:q,routeContext:{outlet:G,matches:se,isDataRoute:i!=null},children:ce})};return i&&(q.route.ErrorBoundary||q.route.errorElement||X===0)?we.createElement(vV,{location:i.location,revalidation:i.revalidation,component:ie,error:oe,children:le(),routeContext:{outlet:null,matches:se,isDataRoute:!0}}):le()},null)}var a4=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(a4||{}),qx=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(qx||{});function wV(e){let t=we.useContext(JM);return t||Ki(!1),t}function SV(e){let t=we.useContext(dV);return t||Ki(!1),t}function TV(e){let t=we.useContext(Xu);return t||Ki(!1),t}function s4(e){let t=TV(),i=t.matches[t.matches.length-1];return i.route.id||Ki(!1),i.route.id}function EV(){var e;let t=we.useContext(r4),i=SV(qx.UseRouteError),l=s4(qx.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[l]}function MV(){let{router:e}=wV(a4.UseNavigateStable),t=s4(qx.UseNavigateStable),i=we.useRef(!1);return n4(()=>{i.current=!0}),we.useCallback(function(d,y){y===void 0&&(y={}),i.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,Q_({fromRouteId:t},y)))},[e,t])}function hs(e){Ki(!1)}function CV(e){let{basename:t="/",children:i=null,location:l,navigationType:d=Iu.Pop,navigator:y,static:S=!1,future:R}=e;py()&&Ki(!1);let a=t.replace(/^\/*/,"/"),N=we.useMemo(()=>({basename:a,navigator:y,static:S,future:Q_({v7_relativeSplatPath:!1},R)}),[a,R,y,S]);typeof l=="string"&&(l=Gp(l));let{pathname:G="/",search:q="",hash:X="",state:oe=null,key:te="default"}=l,ie=we.useMemo(()=>{let pe=KM(G,a);return pe==null?null:{location:{pathname:pe,search:q,hash:X,state:oe,key:te},navigationType:d}},[a,G,q,X,oe,te,d]);return ie==null?null:we.createElement(Td.Provider,{value:N},we.createElement(U1.Provider,{children:i,value:ie}))}function IV(e){let{children:t,location:i}=e;return mV(mE(t),i)}new Promise(()=>{});function mE(e,t){t===void 0&&(t=[]);let i=[];return we.Children.forEach(e,(l,d)=>{if(!we.isValidElement(l))return;let y=[...t,d];if(l.type===we.Fragment){i.push.apply(i,mE(l.props.children,y));return}l.type!==hs&&Ki(!1),!l.props.index||!l.props.children||Ki(!1);let S={id:l.props.id||y.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(S.children=mE(l.props.children,y)),i.push(S)}),i}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gE(){return gE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},gE.apply(this,arguments)}function PV(e,t){if(e==null)return{};var i={},l=Object.keys(e),d,y;for(y=0;y<l.length;y++)d=l[y],!(t.indexOf(d)>=0)&&(i[d]=e[d]);return i}function AV(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function DV(e,t){return e.button===0&&(!t||t==="_self")&&!AV(e)}const RV=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],kV="6";try{window.__reactRouterVersion=kV}catch{}const OV="startTransition",GR=bx[OV];function LV(e){let{basename:t,children:i,future:l,window:d}=e,y=we.useRef();y.current==null&&(y.current=jj({window:d,v5Compat:!0}));let S=y.current,[R,a]=we.useState({action:S.action,location:S.location}),{v7_startTransition:N}=l||{},G=we.useCallback(q=>{N&&GR?GR(()=>a(q)):a(q)},[a,N]);return we.useLayoutEffect(()=>S.listen(G),[S,G]),we.createElement(CV,{basename:t,children:i,location:R.location,navigationType:R.action,navigator:S,future:l})}const zV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",FV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Uu=we.forwardRef(function(t,i){let{onClick:l,relative:d,reloadDocument:y,replace:S,state:R,target:a,to:N,preventScrollReset:G,viewTransition:q}=t,X=PV(t,RV),{basename:oe}=we.useContext(Td),te,ie=!1;if(typeof N=="string"&&FV.test(N)&&(te=N,zV))try{let ce=new URL(window.location.href),Me=N.startsWith("//")?new URL(ce.protocol+N):new URL(N),Le=KM(Me.pathname,oe);Me.origin===ce.origin&&Le!=null?N=Le+Me.search+Me.hash:ie=!0}catch{}let pe=fV(N,{relative:d}),se=BV(N,{replace:S,state:R,target:a,preventScrollReset:G,relative:d,viewTransition:q});function le(ce){l&&l(ce),ce.defaultPrevented||se(ce)}return we.createElement("a",gE({},X,{href:te||pe,onClick:ie||y?l:le,ref:i,target:a}))});var HR;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(HR||(HR={}));var qR;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(qR||(qR={}));function BV(e,t){let{target:i,replace:l,state:d,preventScrollReset:y,relative:S,viewTransition:R}=t===void 0?{}:t,a=Hp(),N=Ku(),G=o4(e,{relative:S});return we.useCallback(q=>{if(DV(q,i)){q.preventDefault();let X=l!==void 0?l:Hx(N)===Hx(G);a(e,{replace:X,state:d,preventScrollReset:y,relative:S,viewTransition:R})}},[N,a,G,l,d,i,e,y,S,R])}var l4="https://js.stripe.com/v3",NV=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ZR="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",UV=function(){for(var t=document.querySelectorAll('script[src^="'.concat(l4,'"]')),i=0;i<t.length;i++){var l=t[i];if(NV.test(l.src))return l}return null},YR=function(t){var i="",l=document.createElement("script");l.src="".concat(l4).concat(i);var d=document.head||document.body;if(!d)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return d.appendChild(l),l},jV=function(t,i){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"5.1.0",startTime:i})},Kg=null,jv=null,Vv=null,VV=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},$V=function(t,i){return function(){window.Stripe?t(window.Stripe):i(new Error("Stripe.js not available"))}},WV=function(t){return Kg!==null?Kg:(Kg=new Promise(function(i,l){if(typeof window>"u"||typeof document>"u"){i(null);return}if(window.Stripe&&t&&console.warn(ZR),window.Stripe){i(window.Stripe);return}try{var d=UV();if(d&&t)console.warn(ZR);else if(!d)d=YR(t);else if(d&&Vv!==null&&jv!==null){var y;d.removeEventListener("load",Vv),d.removeEventListener("error",jv),(y=d.parentNode)===null||y===void 0||y.removeChild(d),d=YR(t)}Vv=$V(i,l),jv=VV(l),d.addEventListener("load",Vv),d.addEventListener("error",jv)}catch(S){l(S);return}}),Kg.catch(function(i){return Kg=null,Promise.reject(i)}))},GV=function(t,i,l){if(t===null)return null;var d=t.apply(void 0,i);return jV(d,l),d},Jg,c4=!1,u4=function(){return Jg||(Jg=WV(null).catch(function(t){return Jg=null,Promise.reject(t)}),Jg)};Promise.resolve().then(function(){return u4()}).catch(function(e){c4||console.warn(e)});var h4=function(){for(var t=arguments.length,i=new Array(t),l=0;l<t;l++)i[l]=arguments[l];c4=!0;var d=Date.now();return u4().then(function(y){return GV(y,i,d)})},d4={exports:{}},HV="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",qV=HV,ZV=qV;function f4(){}function p4(){}p4.resetWarningCache=f4;var YV=function(){function e(l,d,y,S,R,a){if(a!==ZV){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}e.isRequired=e;function t(){return e}var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:p4,resetWarningCache:f4};return i.PropTypes=i,i};d4.exports=YV();var Ya=d4.exports;const Ci=ly(Ya);function XR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),i.push.apply(i,l)}return i}function KR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XR(Object(i),!0).forEach(function(l){m4(e,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XR(Object(i)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(i,l))})}return e}function fx(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?fx=function(t){return typeof t}:fx=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fx(e)}function m4(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function g4(e,t){return XV(e)||KV(e,t)||JV(e,t)||QV()}function XV(e){if(Array.isArray(e))return e}function KV(e,t){var i=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]);if(i!=null){var l=[],d=!0,y=!1,S,R;try{for(i=i.call(e);!(d=(S=i.next()).done)&&(l.push(S.value),!(t&&l.length===t));d=!0);}catch(a){y=!0,R=a}finally{try{!d&&i.return!=null&&i.return()}finally{if(y)throw R}}return l}}function JV(e,t){if(e){if(typeof e=="string")return JR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return JR(e,t)}}function JR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,l=new Array(t);i<t;i++)l[i]=e[i];return l}function QV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ba=function(t,i,l){var d=!!l,y=ne.useRef(l);ne.useEffect(function(){y.current=l},[l]),ne.useEffect(function(){if(!d||!t)return function(){};var S=function(){y.current&&y.current.apply(y,arguments)};return t.on(i,S),function(){t.off(i,S)}},[d,i,t,y])},_E=function(t){var i=ne.useRef(t);return ne.useEffect(function(){i.current=t},[t]),i.current},zp=function(t){return t!==null&&fx(t)==="object"},e3=function(t){return zp(t)&&typeof t.then=="function"},t3=function(t){return zp(t)&&typeof t.elements=="function"&&typeof t.createToken=="function"&&typeof t.createPaymentMethod=="function"&&typeof t.confirmCardPayment=="function"},QR="[object Object]",r3=function e(t,i){if(!zp(t)||!zp(i))return t===i;var l=Array.isArray(t),d=Array.isArray(i);if(l!==d)return!1;var y=Object.prototype.toString.call(t)===QR,S=Object.prototype.toString.call(i)===QR;if(y!==S)return!1;if(!y&&!l)return t===i;var R=Object.keys(t),a=Object.keys(i);if(R.length!==a.length)return!1;for(var N={},G=0;G<R.length;G+=1)N[R[G]]=!0;for(var q=0;q<a.length;q+=1)N[a[q]]=!0;var X=Object.keys(N);if(X.length!==R.length)return!1;var oe=t,te=i,ie=function(se){return e(oe[se],te[se])};return X.every(ie)},_4=function(t,i,l){return zp(t)?Object.keys(t).reduce(function(d,y){var S=!zp(i)||!r3(t[y],i[y]);return l.includes(y)?(S&&console.warn("Unsupported prop change: options.".concat(y," is not a mutable property.")),d):S?KR(KR({},d||{}),{},m4({},y,t[y])):d},null):null},y4="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ek=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y4;if(t===null||t3(t))return t;throw new Error(i)},n3=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y4;if(e3(t))return{tag:"async",stripePromise:Promise.resolve(t).then(function(d){return ek(d,i)})};var l=ek(t,i);return l===null?{tag:"empty"}:{tag:"sync",stripe:l}},i3=function(t){!t||!t._registerWrapper||!t.registerAppInfo||(t._registerWrapper({name:"react-stripe-js",version:"2.9.0"}),t.registerAppInfo({name:"react-stripe-js",version:"2.9.0",url:"https://stripe.com/docs/stripe-js/react"}))},j1=ne.createContext(null);j1.displayName="ElementsContext";var v4=function(t,i){if(!t)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(i," in an <Elements> provider."));return t},QM=function(t){var i=t.stripe,l=t.options,d=t.children,y=ne.useMemo(function(){return n3(i)},[i]),S=ne.useState(function(){return{stripe:y.tag==="sync"?y.stripe:null,elements:y.tag==="sync"?y.stripe.elements(l):null}}),R=g4(S,2),a=R[0],N=R[1];ne.useEffect(function(){var X=!0,oe=function(ie){N(function(pe){return pe.stripe?pe:{stripe:ie,elements:ie.elements(l)}})};return y.tag==="async"&&!a.stripe?y.stripePromise.then(function(te){te&&X&&oe(te)}):y.tag==="sync"&&!a.stripe&&oe(y.stripe),function(){X=!1}},[y,a,l]);var G=_E(i);ne.useEffect(function(){G!==null&&G!==i&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[G,i]);var q=_E(l);return ne.useEffect(function(){if(a.elements){var X=_4(l,q,["clientSecret","fonts"]);X&&a.elements.update(X)}},[l,q,a.elements]),ne.useEffect(function(){i3(a.stripe)},[a.stripe]),ne.createElement(j1.Provider,{value:a},d)};QM.propTypes={stripe:Ci.any,options:Ci.object};var o3=function(t){var i=ne.useContext(j1);return v4(i,t)},x4=function(){var t=o3("calls useElements()"),i=t.elements;return i};Ci.func.isRequired;var b4=ne.createContext(null);b4.displayName="CheckoutSdkContext";var a3=function(t,i){if(!t)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(i," in an <CheckoutProvider> provider."));return t},s3=ne.createContext(null);s3.displayName="CheckoutContext";Ci.any,Ci.shape({clientSecret:Ci.string.isRequired,elementsOptions:Ci.object}).isRequired;var yE=function(t){var i=ne.useContext(b4),l=ne.useContext(j1);if(i&&l)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CheckoutProvider> and <Elements> providers."));return i?a3(i,t):v4(l,t)},l3=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Qi=function(t,i){var l="".concat(l3(t),"Element"),d=function(a){var N=a.id,G=a.className,q=a.options,X=q===void 0?{}:q,oe=a.onBlur,te=a.onFocus,ie=a.onReady,pe=a.onChange,se=a.onEscape,le=a.onClick,ce=a.onLoadError,Me=a.onLoaderStart,Le=a.onNetworksChange,Je=a.onConfirm,Qe=a.onCancel,je=a.onShippingAddressChange,Ct=a.onShippingRateChange,ye=yE("mounts <".concat(l,">")),et="elements"in ye?ye.elements:null,dt="checkoutSdk"in ye?ye.checkoutSdk:null,Xt=ne.useState(null),Mt=g4(Xt,2),yt=Mt[0],gt=Mt[1],Ze=ne.useRef(null),ht=ne.useRef(null);Ba(yt,"blur",oe),Ba(yt,"focus",te),Ba(yt,"escape",se),Ba(yt,"click",le),Ba(yt,"loaderror",ce),Ba(yt,"loaderstart",Me),Ba(yt,"networkschange",Le),Ba(yt,"confirm",Je),Ba(yt,"cancel",Qe),Ba(yt,"shippingaddresschange",je),Ba(yt,"shippingratechange",Ct),Ba(yt,"change",pe);var Dt;ie&&(t==="expressCheckout"?Dt=ie:Dt=function(){ie(yt)}),Ba(yt,"ready",Dt),ne.useLayoutEffect(function(){if(Ze.current===null&&ht.current!==null&&(et||dt)){var tr=null;dt?tr=dt.createElement(t,X):et&&(tr=et.create(t,X)),Ze.current=tr,gt(tr),tr&&tr.mount(ht.current)}},[et,dt,X]);var Tt=_E(X);return ne.useEffect(function(){if(Ze.current){var tr=_4(X,Tt,["paymentRequest"]);tr&&"update"in Ze.current&&Ze.current.update(tr)}},[X,Tt]),ne.useLayoutEffect(function(){return function(){if(Ze.current&&typeof Ze.current.destroy=="function")try{Ze.current.destroy(),Ze.current=null}catch{}}},[]),ne.createElement("div",{id:N,className:G,ref:ht})},y=function(a){yE("mounts <".concat(l,">"));var N=a.id,G=a.className;return ne.createElement("div",{id:N,className:G})},S=i?y:d;return S.propTypes={id:Ci.string,className:Ci.string,onChange:Ci.func,onBlur:Ci.func,onFocus:Ci.func,onReady:Ci.func,onEscape:Ci.func,onClick:Ci.func,onLoadError:Ci.func,onLoaderStart:Ci.func,onNetworksChange:Ci.func,onConfirm:Ci.func,onCancel:Ci.func,onShippingAddressChange:Ci.func,onShippingRateChange:Ci.func,options:Ci.object},S.displayName=l,S.__elementType=t,S},eo=typeof window>"u",c3=ne.createContext(null);c3.displayName="EmbeddedCheckoutProviderContext";var w4=function(){var t=yE("calls useStripe()"),i=t.stripe;return i};Qi("auBankAccount",eo);var Zx=Qi("card",eo);Qi("cardNumber",eo);Qi("cardExpiry",eo);Qi("cardCvc",eo);Qi("fpxBank",eo);Qi("iban",eo);Qi("idealBank",eo);Qi("p24Bank",eo);Qi("epsBank",eo);Qi("payment",eo);Qi("expressCheckout",eo);Qi("currencySelector",eo);Qi("paymentRequestButton",eo);Qi("linkAuthentication",eo);Qi("address",eo);Qi("shippingAddress",eo);Qi("paymentMethodMessaging",eo);Qi("affirmMessage",eo);Qi("afterpayClearpayMessage",eo);function S4(e,t){return function(){return e.apply(t,arguments)}}const{toString:u3}=Object.prototype,{getPrototypeOf:eC}=Object,V1=(e=>t=>{const i=u3.call(t);return e[i]||(e[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Xs=e=>(e=e.toLowerCase(),t=>V1(t)===e),$1=e=>t=>typeof t===e,{isArray:qp}=Array,ey=$1("undefined");function h3(e){return e!==null&&!ey(e)&&e.constructor!==null&&!ey(e.constructor)&&Wa(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const T4=Xs("ArrayBuffer");function d3(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&T4(e.buffer),t}const f3=$1("string"),Wa=$1("function"),E4=$1("number"),W1=e=>e!==null&&typeof e=="object",p3=e=>e===!0||e===!1,px=e=>{if(V1(e)!=="object")return!1;const t=eC(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},m3=Xs("Date"),g3=Xs("File"),_3=Xs("Blob"),y3=Xs("FileList"),v3=e=>W1(e)&&Wa(e.pipe),x3=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Wa(e.append)&&((t=V1(e))==="formdata"||t==="object"&&Wa(e.toString)&&e.toString()==="[object FormData]"))},b3=Xs("URLSearchParams"),[w3,S3,T3,E3]=["ReadableStream","Request","Response","Headers"].map(Xs),M3=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function my(e,t,{allOwnKeys:i=!1}={}){if(e===null||typeof e>"u")return;let l,d;if(typeof e!="object"&&(e=[e]),qp(e))for(l=0,d=e.length;l<d;l++)t.call(null,e[l],l,e);else{const y=i?Object.getOwnPropertyNames(e):Object.keys(e),S=y.length;let R;for(l=0;l<S;l++)R=y[l],t.call(null,e[R],R,e)}}function M4(e,t){t=t.toLowerCase();const i=Object.keys(e);let l=i.length,d;for(;l-- >0;)if(d=i[l],t===d.toLowerCase())return d;return null}const ad=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,C4=e=>!ey(e)&&e!==ad;function vE(){const{caseless:e}=C4(this)&&this||{},t={},i=(l,d)=>{const y=e&&M4(t,d)||d;px(t[y])&&px(l)?t[y]=vE(t[y],l):px(l)?t[y]=vE({},l):qp(l)?t[y]=l.slice():t[y]=l};for(let l=0,d=arguments.length;l<d;l++)arguments[l]&&my(arguments[l],i);return t}const C3=(e,t,i,{allOwnKeys:l}={})=>(my(t,(d,y)=>{i&&Wa(d)?e[y]=S4(d,i):e[y]=d},{allOwnKeys:l}),e),I3=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),P3=(e,t,i,l)=>{e.prototype=Object.create(t.prototype,l),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},A3=(e,t,i,l)=>{let d,y,S;const R={};if(t=t||{},e==null)return t;do{for(d=Object.getOwnPropertyNames(e),y=d.length;y-- >0;)S=d[y],(!l||l(S,e,t))&&!R[S]&&(t[S]=e[S],R[S]=!0);e=i!==!1&&eC(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},D3=(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;const l=e.indexOf(t,i);return l!==-1&&l===i},R3=e=>{if(!e)return null;if(qp(e))return e;let t=e.length;if(!E4(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},k3=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&eC(Uint8Array)),O3=(e,t)=>{const l=(e&&e[Symbol.iterator]).call(e);let d;for(;(d=l.next())&&!d.done;){const y=d.value;t.call(e,y[0],y[1])}},L3=(e,t)=>{let i;const l=[];for(;(i=e.exec(t))!==null;)l.push(i);return l},z3=Xs("HTMLFormElement"),F3=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,l,d){return l.toUpperCase()+d}),tk=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),B3=Xs("RegExp"),I4=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),l={};my(i,(d,y)=>{let S;(S=t(d,y,e))!==!1&&(l[y]=S||d)}),Object.defineProperties(e,l)},N3=e=>{I4(e,(t,i)=>{if(Wa(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const l=e[i];if(Wa(l)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},U3=(e,t)=>{const i={},l=d=>{d.forEach(y=>{i[y]=!0})};return qp(e)?l(e):l(String(e).split(t)),i},j3=()=>{},V3=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,nT="abcdefghijklmnopqrstuvwxyz",rk="0123456789",P4={DIGIT:rk,ALPHA:nT,ALPHA_DIGIT:nT+nT.toUpperCase()+rk},$3=(e=16,t=P4.ALPHA_DIGIT)=>{let i="";const{length:l}=t;for(;e--;)i+=t[Math.random()*l|0];return i};function W3(e){return!!(e&&Wa(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const G3=e=>{const t=new Array(10),i=(l,d)=>{if(W1(l)){if(t.indexOf(l)>=0)return;if(!("toJSON"in l)){t[d]=l;const y=qp(l)?[]:{};return my(l,(S,R)=>{const a=i(S,d+1);!ey(a)&&(y[R]=a)}),t[d]=void 0,y}}return l};return i(e,0)},H3=Xs("AsyncFunction"),q3=e=>e&&(W1(e)||Wa(e))&&Wa(e.then)&&Wa(e.catch),A4=((e,t)=>e?setImmediate:t?((i,l)=>(ad.addEventListener("message",({source:d,data:y})=>{d===ad&&y===i&&l.length&&l.shift()()},!1),d=>{l.push(d),ad.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Wa(ad.postMessage)),Z3=typeof queueMicrotask<"u"?queueMicrotask.bind(ad):typeof process<"u"&&process.nextTick||A4,At={isArray:qp,isArrayBuffer:T4,isBuffer:h3,isFormData:x3,isArrayBufferView:d3,isString:f3,isNumber:E4,isBoolean:p3,isObject:W1,isPlainObject:px,isReadableStream:w3,isRequest:S3,isResponse:T3,isHeaders:E3,isUndefined:ey,isDate:m3,isFile:g3,isBlob:_3,isRegExp:B3,isFunction:Wa,isStream:v3,isURLSearchParams:b3,isTypedArray:k3,isFileList:y3,forEach:my,merge:vE,extend:C3,trim:M3,stripBOM:I3,inherits:P3,toFlatObject:A3,kindOf:V1,kindOfTest:Xs,endsWith:D3,toArray:R3,forEachEntry:O3,matchAll:L3,isHTMLForm:z3,hasOwnProperty:tk,hasOwnProp:tk,reduceDescriptors:I4,freezeMethods:N3,toObjectSet:U3,toCamelCase:F3,noop:j3,toFiniteNumber:V3,findKey:M4,global:ad,isContextDefined:C4,ALPHABET:P4,generateString:$3,isSpecCompliantForm:W3,toJSONObject:G3,isAsyncFn:H3,isThenable:q3,setImmediate:A4,asap:Z3};function sn(e,t,i,l,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),l&&(this.request=l),d&&(this.response=d,this.status=d.status?d.status:null)}At.inherits(sn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:At.toJSONObject(this.config),code:this.code,status:this.status}}});const D4=sn.prototype,R4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{R4[e]={value:e}});Object.defineProperties(sn,R4);Object.defineProperty(D4,"isAxiosError",{value:!0});sn.from=(e,t,i,l,d,y)=>{const S=Object.create(D4);return At.toFlatObject(e,S,function(a){return a!==Error.prototype},R=>R!=="isAxiosError"),sn.call(S,e.message,t,i,l,d),S.cause=e,S.name=e.name,y&&Object.assign(S,y),S};const Y3=null;function xE(e){return At.isPlainObject(e)||At.isArray(e)}function k4(e){return At.endsWith(e,"[]")?e.slice(0,-2):e}function nk(e,t,i){return e?e.concat(t).map(function(d,y){return d=k4(d),!i&&y?"["+d+"]":d}).join(i?".":""):t}function X3(e){return At.isArray(e)&&!e.some(xE)}const K3=At.toFlatObject(At,{},null,function(t){return/^is[A-Z]/.test(t)});function G1(e,t,i){if(!At.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,i=At.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ie,pe){return!At.isUndefined(pe[ie])});const l=i.metaTokens,d=i.visitor||G,y=i.dots,S=i.indexes,a=(i.Blob||typeof Blob<"u"&&Blob)&&At.isSpecCompliantForm(t);if(!At.isFunction(d))throw new TypeError("visitor must be a function");function N(te){if(te===null)return"";if(At.isDate(te))return te.toISOString();if(!a&&At.isBlob(te))throw new sn("Blob is not supported. Use a Buffer instead.");return At.isArrayBuffer(te)||At.isTypedArray(te)?a&&typeof Blob=="function"?new Blob([te]):Buffer.from(te):te}function G(te,ie,pe){let se=te;if(te&&!pe&&typeof te=="object"){if(At.endsWith(ie,"{}"))ie=l?ie:ie.slice(0,-2),te=JSON.stringify(te);else if(At.isArray(te)&&X3(te)||(At.isFileList(te)||At.endsWith(ie,"[]"))&&(se=At.toArray(te)))return ie=k4(ie),se.forEach(function(ce,Me){!(At.isUndefined(ce)||ce===null)&&t.append(S===!0?nk([ie],Me,y):S===null?ie:ie+"[]",N(ce))}),!1}return xE(te)?!0:(t.append(nk(pe,ie,y),N(te)),!1)}const q=[],X=Object.assign(K3,{defaultVisitor:G,convertValue:N,isVisitable:xE});function oe(te,ie){if(!At.isUndefined(te)){if(q.indexOf(te)!==-1)throw Error("Circular reference detected in "+ie.join("."));q.push(te),At.forEach(te,function(se,le){(!(At.isUndefined(se)||se===null)&&d.call(t,se,At.isString(le)?le.trim():le,ie,X))===!0&&oe(se,ie?ie.concat(le):[le])}),q.pop()}}if(!At.isObject(e))throw new TypeError("data must be an object");return oe(e),t}function ik(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(l){return t[l]})}function tC(e,t){this._pairs=[],e&&G1(e,this,t)}const O4=tC.prototype;O4.append=function(t,i){this._pairs.push([t,i])};O4.toString=function(t){const i=t?function(l){return t.call(this,l,ik)}:ik;return this._pairs.map(function(d){return i(d[0])+"="+i(d[1])},"").join("&")};function J3(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function L4(e,t,i){if(!t)return e;const l=i&&i.encode||J3,d=i&&i.serialize;let y;if(d?y=d(t,i):y=At.isURLSearchParams(t)?t.toString():new tC(t,i).toString(l),y){const S=e.indexOf("#");S!==-1&&(e=e.slice(0,S)),e+=(e.indexOf("?")===-1?"?":"&")+y}return e}class ok{constructor(){this.handlers=[]}use(t,i,l){return this.handlers.push({fulfilled:t,rejected:i,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){At.forEach(this.handlers,function(l){l!==null&&t(l)})}}const z4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q3=typeof URLSearchParams<"u"?URLSearchParams:tC,e$=typeof FormData<"u"?FormData:null,t$=typeof Blob<"u"?Blob:null,r$={isBrowser:!0,classes:{URLSearchParams:Q3,FormData:e$,Blob:t$},protocols:["http","https","file","blob","url","data"]},rC=typeof window<"u"&&typeof document<"u",bE=typeof navigator=="object"&&navigator||void 0,n$=rC&&(!bE||["ReactNative","NativeScript","NS"].indexOf(bE.product)<0),i$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",o$=rC&&window.location.href||"http://localhost",a$=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:rC,hasStandardBrowserEnv:n$,hasStandardBrowserWebWorkerEnv:i$,navigator:bE,origin:o$},Symbol.toStringTag,{value:"Module"})),Sa={...a$,...r$};function s$(e,t){return G1(e,new Sa.classes.URLSearchParams,Object.assign({visitor:function(i,l,d,y){return Sa.isNode&&At.isBuffer(i)?(this.append(l,i.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},t))}function l$(e){return At.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function c$(e){const t={},i=Object.keys(e);let l;const d=i.length;let y;for(l=0;l<d;l++)y=i[l],t[y]=e[y];return t}function F4(e){function t(i,l,d,y){let S=i[y++];if(S==="__proto__")return!0;const R=Number.isFinite(+S),a=y>=i.length;return S=!S&&At.isArray(d)?d.length:S,a?(At.hasOwnProp(d,S)?d[S]=[d[S],l]:d[S]=l,!R):((!d[S]||!At.isObject(d[S]))&&(d[S]=[]),t(i,l,d[S],y)&&At.isArray(d[S])&&(d[S]=c$(d[S])),!R)}if(At.isFormData(e)&&At.isFunction(e.entries)){const i={};return At.forEachEntry(e,(l,d)=>{t(l$(l),d,i,0)}),i}return null}function u$(e,t,i){if(At.isString(e))try{return(t||JSON.parse)(e),At.trim(e)}catch(l){if(l.name!=="SyntaxError")throw l}return(0,JSON.stringify)(e)}const gy={transitional:z4,adapter:["xhr","http","fetch"],transformRequest:[function(t,i){const l=i.getContentType()||"",d=l.indexOf("application/json")>-1,y=At.isObject(t);if(y&&At.isHTMLForm(t)&&(t=new FormData(t)),At.isFormData(t))return d?JSON.stringify(F4(t)):t;if(At.isArrayBuffer(t)||At.isBuffer(t)||At.isStream(t)||At.isFile(t)||At.isBlob(t)||At.isReadableStream(t))return t;if(At.isArrayBufferView(t))return t.buffer;if(At.isURLSearchParams(t))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let R;if(y){if(l.indexOf("application/x-www-form-urlencoded")>-1)return s$(t,this.formSerializer).toString();if((R=At.isFileList(t))||l.indexOf("multipart/form-data")>-1){const a=this.env&&this.env.FormData;return G1(R?{"files[]":t}:t,a&&new a,this.formSerializer)}}return y||d?(i.setContentType("application/json",!1),u$(t)):t}],transformResponse:[function(t){const i=this.transitional||gy.transitional,l=i&&i.forcedJSONParsing,d=this.responseType==="json";if(At.isResponse(t)||At.isReadableStream(t))return t;if(t&&At.isString(t)&&(l&&!this.responseType||d)){const S=!(i&&i.silentJSONParsing)&&d;try{return JSON.parse(t)}catch(R){if(S)throw R.name==="SyntaxError"?sn.from(R,sn.ERR_BAD_RESPONSE,this,null,this.response):R}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Sa.classes.FormData,Blob:Sa.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};At.forEach(["delete","get","head","post","put","patch"],e=>{gy.headers[e]={}});const h$=At.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),d$=e=>{const t={};let i,l,d;return e&&e.split(`
`).forEach(function(S){d=S.indexOf(":"),i=S.substring(0,d).trim().toLowerCase(),l=S.substring(d+1).trim(),!(!i||t[i]&&h$[i])&&(i==="set-cookie"?t[i]?t[i].push(l):t[i]=[l]:t[i]=t[i]?t[i]+", "+l:l)}),t},ak=Symbol("internals");function Qg(e){return e&&String(e).trim().toLowerCase()}function mx(e){return e===!1||e==null?e:At.isArray(e)?e.map(mx):String(e)}function f$(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=i.exec(e);)t[l[1]]=l[2];return t}const p$=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function iT(e,t,i,l,d){if(At.isFunction(l))return l.call(this,t,i);if(d&&(t=i),!!At.isString(t)){if(At.isString(l))return t.indexOf(l)!==-1;if(At.isRegExp(l))return l.test(t)}}function m$(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,i,l)=>i.toUpperCase()+l)}function g$(e,t){const i=At.toCamelCase(" "+t);["get","set","has"].forEach(l=>{Object.defineProperty(e,l+i,{value:function(d,y,S){return this[l].call(this,t,d,y,S)},configurable:!0})})}class Ta{constructor(t){t&&this.set(t)}set(t,i,l){const d=this;function y(R,a,N){const G=Qg(a);if(!G)throw new Error("header name must be a non-empty string");const q=At.findKey(d,G);(!q||d[q]===void 0||N===!0||N===void 0&&d[q]!==!1)&&(d[q||a]=mx(R))}const S=(R,a)=>At.forEach(R,(N,G)=>y(N,G,a));if(At.isPlainObject(t)||t instanceof this.constructor)S(t,i);else if(At.isString(t)&&(t=t.trim())&&!p$(t))S(d$(t),i);else if(At.isHeaders(t))for(const[R,a]of t.entries())y(a,R,l);else t!=null&&y(i,t,l);return this}get(t,i){if(t=Qg(t),t){const l=At.findKey(this,t);if(l){const d=this[l];if(!i)return d;if(i===!0)return f$(d);if(At.isFunction(i))return i.call(this,d,l);if(At.isRegExp(i))return i.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Qg(t),t){const l=At.findKey(this,t);return!!(l&&this[l]!==void 0&&(!i||iT(this,this[l],l,i)))}return!1}delete(t,i){const l=this;let d=!1;function y(S){if(S=Qg(S),S){const R=At.findKey(l,S);R&&(!i||iT(l,l[R],R,i))&&(delete l[R],d=!0)}}return At.isArray(t)?t.forEach(y):y(t),d}clear(t){const i=Object.keys(this);let l=i.length,d=!1;for(;l--;){const y=i[l];(!t||iT(this,this[y],y,t,!0))&&(delete this[y],d=!0)}return d}normalize(t){const i=this,l={};return At.forEach(this,(d,y)=>{const S=At.findKey(l,y);if(S){i[S]=mx(d),delete i[y];return}const R=t?m$(y):String(y).trim();R!==y&&delete i[y],i[R]=mx(d),l[R]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const i=Object.create(null);return At.forEach(this,(l,d)=>{l!=null&&l!==!1&&(i[d]=t&&At.isArray(l)?l.join(", "):l)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,i])=>t+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...i){const l=new this(t);return i.forEach(d=>l.set(d)),l}static accessor(t){const l=(this[ak]=this[ak]={accessors:{}}).accessors,d=this.prototype;function y(S){const R=Qg(S);l[R]||(g$(d,S),l[R]=!0)}return At.isArray(t)?t.forEach(y):y(t),this}}Ta.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);At.reduceDescriptors(Ta.prototype,({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(l){this[i]=l}}});At.freezeMethods(Ta);function oT(e,t){const i=this||gy,l=t||i,d=Ta.from(l.headers);let y=l.data;return At.forEach(e,function(R){y=R.call(i,y,d.normalize(),t?t.status:void 0)}),d.normalize(),y}function B4(e){return!!(e&&e.__CANCEL__)}function Zp(e,t,i){sn.call(this,e??"canceled",sn.ERR_CANCELED,t,i),this.name="CanceledError"}At.inherits(Zp,sn,{__CANCEL__:!0});function N4(e,t,i){const l=i.config.validateStatus;!i.status||!l||l(i.status)?e(i):t(new sn("Request failed with status code "+i.status,[sn.ERR_BAD_REQUEST,sn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function _$(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function y$(e,t){e=e||10;const i=new Array(e),l=new Array(e);let d=0,y=0,S;return t=t!==void 0?t:1e3,function(a){const N=Date.now(),G=l[y];S||(S=N),i[d]=a,l[d]=N;let q=y,X=0;for(;q!==d;)X+=i[q++],q=q%e;if(d=(d+1)%e,d===y&&(y=(y+1)%e),N-S<t)return;const oe=G&&N-G;return oe?Math.round(X*1e3/oe):void 0}}function v$(e,t){let i=0,l=1e3/t,d,y;const S=(N,G=Date.now())=>{i=G,d=null,y&&(clearTimeout(y),y=null),e.apply(null,N)};return[(...N)=>{const G=Date.now(),q=G-i;q>=l?S(N,G):(d=N,y||(y=setTimeout(()=>{y=null,S(d)},l-q)))},()=>d&&S(d)]}const Yx=(e,t,i=3)=>{let l=0;const d=y$(50,250);return v$(y=>{const S=y.loaded,R=y.lengthComputable?y.total:void 0,a=S-l,N=d(a),G=S<=R;l=S;const q={loaded:S,total:R,progress:R?S/R:void 0,bytes:a,rate:N||void 0,estimated:N&&R&&G?(R-S)/N:void 0,event:y,lengthComputable:R!=null,[t?"download":"upload"]:!0};e(q)},i)},sk=(e,t)=>{const i=e!=null;return[l=>t[0]({lengthComputable:i,total:e,loaded:l}),t[1]]},lk=e=>(...t)=>At.asap(()=>e(...t)),x$=Sa.hasStandardBrowserEnv?function(){const t=Sa.navigator&&/(msie|trident)/i.test(Sa.navigator.userAgent),i=document.createElement("a");let l;function d(y){let S=y;return t&&(i.setAttribute("href",S),S=i.href),i.setAttribute("href",S),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return l=d(window.location.href),function(S){const R=At.isString(S)?d(S):S;return R.protocol===l.protocol&&R.host===l.host}}():function(){return function(){return!0}}(),b$=Sa.hasStandardBrowserEnv?{write(e,t,i,l,d,y){const S=[e+"="+encodeURIComponent(t)];At.isNumber(i)&&S.push("expires="+new Date(i).toGMTString()),At.isString(l)&&S.push("path="+l),At.isString(d)&&S.push("domain="+d),y===!0&&S.push("secure"),document.cookie=S.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function w$(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function S$(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function U4(e,t){return e&&!w$(t)?S$(e,t):t}const ck=e=>e instanceof Ta?{...e}:e;function yd(e,t){t=t||{};const i={};function l(N,G,q){return At.isPlainObject(N)&&At.isPlainObject(G)?At.merge.call({caseless:q},N,G):At.isPlainObject(G)?At.merge({},G):At.isArray(G)?G.slice():G}function d(N,G,q){if(At.isUndefined(G)){if(!At.isUndefined(N))return l(void 0,N,q)}else return l(N,G,q)}function y(N,G){if(!At.isUndefined(G))return l(void 0,G)}function S(N,G){if(At.isUndefined(G)){if(!At.isUndefined(N))return l(void 0,N)}else return l(void 0,G)}function R(N,G,q){if(q in t)return l(N,G);if(q in e)return l(void 0,N)}const a={url:y,method:y,data:y,baseURL:S,transformRequest:S,transformResponse:S,paramsSerializer:S,timeout:S,timeoutMessage:S,withCredentials:S,withXSRFToken:S,adapter:S,responseType:S,xsrfCookieName:S,xsrfHeaderName:S,onUploadProgress:S,onDownloadProgress:S,decompress:S,maxContentLength:S,maxBodyLength:S,beforeRedirect:S,transport:S,httpAgent:S,httpsAgent:S,cancelToken:S,socketPath:S,responseEncoding:S,validateStatus:R,headers:(N,G)=>d(ck(N),ck(G),!0)};return At.forEach(Object.keys(Object.assign({},e,t)),function(G){const q=a[G]||d,X=q(e[G],t[G],G);At.isUndefined(X)&&q!==R||(i[G]=X)}),i}const j4=e=>{const t=yd({},e);let{data:i,withXSRFToken:l,xsrfHeaderName:d,xsrfCookieName:y,headers:S,auth:R}=t;t.headers=S=Ta.from(S),t.url=L4(U4(t.baseURL,t.url),e.params,e.paramsSerializer),R&&S.set("Authorization","Basic "+btoa((R.username||"")+":"+(R.password?unescape(encodeURIComponent(R.password)):"")));let a;if(At.isFormData(i)){if(Sa.hasStandardBrowserEnv||Sa.hasStandardBrowserWebWorkerEnv)S.setContentType(void 0);else if((a=S.getContentType())!==!1){const[N,...G]=a?a.split(";").map(q=>q.trim()).filter(Boolean):[];S.setContentType([N||"multipart/form-data",...G].join("; "))}}if(Sa.hasStandardBrowserEnv&&(l&&At.isFunction(l)&&(l=l(t)),l||l!==!1&&x$(t.url))){const N=d&&y&&b$.read(y);N&&S.set(d,N)}return t},T$=typeof XMLHttpRequest<"u",E$=T$&&function(e){return new Promise(function(i,l){const d=j4(e);let y=d.data;const S=Ta.from(d.headers).normalize();let{responseType:R,onUploadProgress:a,onDownloadProgress:N}=d,G,q,X,oe,te;function ie(){oe&&oe(),te&&te(),d.cancelToken&&d.cancelToken.unsubscribe(G),d.signal&&d.signal.removeEventListener("abort",G)}let pe=new XMLHttpRequest;pe.open(d.method.toUpperCase(),d.url,!0),pe.timeout=d.timeout;function se(){if(!pe)return;const ce=Ta.from("getAllResponseHeaders"in pe&&pe.getAllResponseHeaders()),Le={data:!R||R==="text"||R==="json"?pe.responseText:pe.response,status:pe.status,statusText:pe.statusText,headers:ce,config:e,request:pe};N4(function(Qe){i(Qe),ie()},function(Qe){l(Qe),ie()},Le),pe=null}"onloadend"in pe?pe.onloadend=se:pe.onreadystatechange=function(){!pe||pe.readyState!==4||pe.status===0&&!(pe.responseURL&&pe.responseURL.indexOf("file:")===0)||setTimeout(se)},pe.onabort=function(){pe&&(l(new sn("Request aborted",sn.ECONNABORTED,e,pe)),pe=null)},pe.onerror=function(){l(new sn("Network Error",sn.ERR_NETWORK,e,pe)),pe=null},pe.ontimeout=function(){let Me=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const Le=d.transitional||z4;d.timeoutErrorMessage&&(Me=d.timeoutErrorMessage),l(new sn(Me,Le.clarifyTimeoutError?sn.ETIMEDOUT:sn.ECONNABORTED,e,pe)),pe=null},y===void 0&&S.setContentType(null),"setRequestHeader"in pe&&At.forEach(S.toJSON(),function(Me,Le){pe.setRequestHeader(Le,Me)}),At.isUndefined(d.withCredentials)||(pe.withCredentials=!!d.withCredentials),R&&R!=="json"&&(pe.responseType=d.responseType),N&&([X,te]=Yx(N,!0),pe.addEventListener("progress",X)),a&&pe.upload&&([q,oe]=Yx(a),pe.upload.addEventListener("progress",q),pe.upload.addEventListener("loadend",oe)),(d.cancelToken||d.signal)&&(G=ce=>{pe&&(l(!ce||ce.type?new Zp(null,e,pe):ce),pe.abort(),pe=null)},d.cancelToken&&d.cancelToken.subscribe(G),d.signal&&(d.signal.aborted?G():d.signal.addEventListener("abort",G)));const le=_$(d.url);if(le&&Sa.protocols.indexOf(le)===-1){l(new sn("Unsupported protocol "+le+":",sn.ERR_BAD_REQUEST,e));return}pe.send(y||null)})},M$=(e,t)=>{const{length:i}=e=e?e.filter(Boolean):[];if(t||i){let l=new AbortController,d;const y=function(N){if(!d){d=!0,R();const G=N instanceof Error?N:this.reason;l.abort(G instanceof sn?G:new Zp(G instanceof Error?G.message:G))}};let S=t&&setTimeout(()=>{S=null,y(new sn(`timeout ${t} of ms exceeded`,sn.ETIMEDOUT))},t);const R=()=>{e&&(S&&clearTimeout(S),S=null,e.forEach(N=>{N.unsubscribe?N.unsubscribe(y):N.removeEventListener("abort",y)}),e=null)};e.forEach(N=>N.addEventListener("abort",y));const{signal:a}=l;return a.unsubscribe=()=>At.asap(R),a}},C$=function*(e,t){let i=e.byteLength;if(i<t){yield e;return}let l=0,d;for(;l<i;)d=l+t,yield e.slice(l,d),l=d},I$=async function*(e,t){for await(const i of P$(e))yield*C$(i,t)},P$=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:i,value:l}=await t.read();if(i)break;yield l}}finally{await t.cancel()}},uk=(e,t,i,l)=>{const d=I$(e,t);let y=0,S,R=a=>{S||(S=!0,l&&l(a))};return new ReadableStream({async pull(a){try{const{done:N,value:G}=await d.next();if(N){R(),a.close();return}let q=G.byteLength;if(i){let X=y+=q;i(X)}a.enqueue(new Uint8Array(G))}catch(N){throw R(N),N}},cancel(a){return R(a),d.return()}},{highWaterMark:2})},H1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",V4=H1&&typeof ReadableStream=="function",A$=H1&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),$4=(e,...t)=>{try{return!!e(...t)}catch{return!1}},D$=V4&&$4(()=>{let e=!1;const t=new Request(Sa.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),hk=64*1024,wE=V4&&$4(()=>At.isReadableStream(new Response("").body)),Xx={stream:wE&&(e=>e.body)};H1&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Xx[t]&&(Xx[t]=At.isFunction(e[t])?i=>i[t]():(i,l)=>{throw new sn(`Response type '${t}' is not supported`,sn.ERR_NOT_SUPPORT,l)})})})(new Response);const R$=async e=>{if(e==null)return 0;if(At.isBlob(e))return e.size;if(At.isSpecCompliantForm(e))return(await new Request(Sa.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(At.isArrayBufferView(e)||At.isArrayBuffer(e))return e.byteLength;if(At.isURLSearchParams(e)&&(e=e+""),At.isString(e))return(await A$(e)).byteLength},k$=async(e,t)=>{const i=At.toFiniteNumber(e.getContentLength());return i??R$(t)},O$=H1&&(async e=>{let{url:t,method:i,data:l,signal:d,cancelToken:y,timeout:S,onDownloadProgress:R,onUploadProgress:a,responseType:N,headers:G,withCredentials:q="same-origin",fetchOptions:X}=j4(e);N=N?(N+"").toLowerCase():"text";let oe=M$([d,y&&y.toAbortSignal()],S),te;const ie=oe&&oe.unsubscribe&&(()=>{oe.unsubscribe()});let pe;try{if(a&&D$&&i!=="get"&&i!=="head"&&(pe=await k$(G,l))!==0){let Le=new Request(t,{method:"POST",body:l,duplex:"half"}),Je;if(At.isFormData(l)&&(Je=Le.headers.get("content-type"))&&G.setContentType(Je),Le.body){const[Qe,je]=sk(pe,Yx(lk(a)));l=uk(Le.body,hk,Qe,je)}}At.isString(q)||(q=q?"include":"omit");const se="credentials"in Request.prototype;te=new Request(t,{...X,signal:oe,method:i.toUpperCase(),headers:G.normalize().toJSON(),body:l,duplex:"half",credentials:se?q:void 0});let le=await fetch(te);const ce=wE&&(N==="stream"||N==="response");if(wE&&(R||ce&&ie)){const Le={};["status","statusText","headers"].forEach(Ct=>{Le[Ct]=le[Ct]});const Je=At.toFiniteNumber(le.headers.get("content-length")),[Qe,je]=R&&sk(Je,Yx(lk(R),!0))||[];le=new Response(uk(le.body,hk,Qe,()=>{je&&je(),ie&&ie()}),Le)}N=N||"text";let Me=await Xx[At.findKey(Xx,N)||"text"](le,e);return!ce&&ie&&ie(),await new Promise((Le,Je)=>{N4(Le,Je,{data:Me,headers:Ta.from(le.headers),status:le.status,statusText:le.statusText,config:e,request:te})})}catch(se){throw ie&&ie(),se&&se.name==="TypeError"&&/fetch/i.test(se.message)?Object.assign(new sn("Network Error",sn.ERR_NETWORK,e,te),{cause:se.cause||se}):sn.from(se,se&&se.code,e,te)}}),SE={http:Y3,xhr:E$,fetch:O$};At.forEach(SE,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const dk=e=>`- ${e}`,L$=e=>At.isFunction(e)||e===null||e===!1,W4={getAdapter:e=>{e=At.isArray(e)?e:[e];const{length:t}=e;let i,l;const d={};for(let y=0;y<t;y++){i=e[y];let S;if(l=i,!L$(i)&&(l=SE[(S=String(i)).toLowerCase()],l===void 0))throw new sn(`Unknown adapter '${S}'`);if(l)break;d[S||"#"+y]=l}if(!l){const y=Object.entries(d).map(([R,a])=>`adapter ${R} `+(a===!1?"is not supported by the environment":"is not available in the build"));let S=t?y.length>1?`since :
`+y.map(dk).join(`
`):" "+dk(y[0]):"as no adapter specified";throw new sn("There is no suitable adapter to dispatch the request "+S,"ERR_NOT_SUPPORT")}return l},adapters:SE};function aT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Zp(null,e)}function fk(e){return aT(e),e.headers=Ta.from(e.headers),e.data=oT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),W4.getAdapter(e.adapter||gy.adapter)(e).then(function(l){return aT(e),l.data=oT.call(e,e.transformResponse,l),l.headers=Ta.from(l.headers),l},function(l){return B4(l)||(aT(e),l&&l.response&&(l.response.data=oT.call(e,e.transformResponse,l.response),l.response.headers=Ta.from(l.response.headers))),Promise.reject(l)})}const G4="1.7.7",nC={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{nC[e]=function(l){return typeof l===e||"a"+(t<1?"n ":" ")+e}});const pk={};nC.transitional=function(t,i,l){function d(y,S){return"[Axios v"+G4+"] Transitional option '"+y+"'"+S+(l?". "+l:"")}return(y,S,R)=>{if(t===!1)throw new sn(d(S," has been removed"+(i?" in "+i:"")),sn.ERR_DEPRECATED);return i&&!pk[S]&&(pk[S]=!0,console.warn(d(S," has been deprecated since v"+i+" and will be removed in the near future"))),t?t(y,S,R):!0}};function z$(e,t,i){if(typeof e!="object")throw new sn("options must be an object",sn.ERR_BAD_OPTION_VALUE);const l=Object.keys(e);let d=l.length;for(;d-- >0;){const y=l[d],S=t[y];if(S){const R=e[y],a=R===void 0||S(R,y,e);if(a!==!0)throw new sn("option "+y+" must be "+a,sn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new sn("Unknown option "+y,sn.ERR_BAD_OPTION)}}const TE={assertOptions:z$,validators:nC},vu=TE.validators;class hd{constructor(t){this.defaults=t,this.interceptors={request:new ok,response:new ok}}async request(t,i){try{return await this._request(t,i)}catch(l){if(l instanceof Error){let d;Error.captureStackTrace?Error.captureStackTrace(d={}):d=new Error;const y=d.stack?d.stack.replace(/^.+\n/,""):"";try{l.stack?y&&!String(l.stack).endsWith(y.replace(/^.+\n.+\n/,""))&&(l.stack+=`
`+y):l.stack=y}catch{}}throw l}}_request(t,i){typeof t=="string"?(i=i||{},i.url=t):i=t||{},i=yd(this.defaults,i);const{transitional:l,paramsSerializer:d,headers:y}=i;l!==void 0&&TE.assertOptions(l,{silentJSONParsing:vu.transitional(vu.boolean),forcedJSONParsing:vu.transitional(vu.boolean),clarifyTimeoutError:vu.transitional(vu.boolean)},!1),d!=null&&(At.isFunction(d)?i.paramsSerializer={serialize:d}:TE.assertOptions(d,{encode:vu.function,serialize:vu.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let S=y&&At.merge(y.common,y[i.method]);y&&At.forEach(["delete","get","head","post","put","patch","common"],te=>{delete y[te]}),i.headers=Ta.concat(S,y);const R=[];let a=!0;this.interceptors.request.forEach(function(ie){typeof ie.runWhen=="function"&&ie.runWhen(i)===!1||(a=a&&ie.synchronous,R.unshift(ie.fulfilled,ie.rejected))});const N=[];this.interceptors.response.forEach(function(ie){N.push(ie.fulfilled,ie.rejected)});let G,q=0,X;if(!a){const te=[fk.bind(this),void 0];for(te.unshift.apply(te,R),te.push.apply(te,N),X=te.length,G=Promise.resolve(i);q<X;)G=G.then(te[q++],te[q++]);return G}X=R.length;let oe=i;for(q=0;q<X;){const te=R[q++],ie=R[q++];try{oe=te(oe)}catch(pe){ie.call(this,pe);break}}try{G=fk.call(this,oe)}catch(te){return Promise.reject(te)}for(q=0,X=N.length;q<X;)G=G.then(N[q++],N[q++]);return G}getUri(t){t=yd(this.defaults,t);const i=U4(t.baseURL,t.url);return L4(i,t.params,t.paramsSerializer)}}At.forEach(["delete","get","head","options"],function(t){hd.prototype[t]=function(i,l){return this.request(yd(l||{},{method:t,url:i,data:(l||{}).data}))}});At.forEach(["post","put","patch"],function(t){function i(l){return function(y,S,R){return this.request(yd(R||{},{method:t,headers:l?{"Content-Type":"multipart/form-data"}:{},url:y,data:S}))}}hd.prototype[t]=i(),hd.prototype[t+"Form"]=i(!0)});class iC{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(y){i=y});const l=this;this.promise.then(d=>{if(!l._listeners)return;let y=l._listeners.length;for(;y-- >0;)l._listeners[y](d);l._listeners=null}),this.promise.then=d=>{let y;const S=new Promise(R=>{l.subscribe(R),y=R}).then(d);return S.cancel=function(){l.unsubscribe(y)},S},t(function(y,S,R){l.reason||(l.reason=new Zp(y,S,R),i(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const t=new AbortController,i=l=>{t.abort(l)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new iC(function(d){t=d}),cancel:t}}}function F$(e){return function(i){return e.apply(null,i)}}function B$(e){return At.isObject(e)&&e.isAxiosError===!0}const EE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(EE).forEach(([e,t])=>{EE[t]=e});function H4(e){const t=new hd(e),i=S4(hd.prototype.request,t);return At.extend(i,hd.prototype,t,{allOwnKeys:!0}),At.extend(i,t,null,{allOwnKeys:!0}),i.create=function(d){return H4(yd(e,d))},i}const Rn=H4(gy);Rn.Axios=hd;Rn.CanceledError=Zp;Rn.CancelToken=iC;Rn.isCancel=B4;Rn.VERSION=G4;Rn.toFormData=G1;Rn.AxiosError=sn;Rn.Cancel=Rn.CanceledError;Rn.all=function(t){return Promise.all(t)};Rn.spread=F$;Rn.isAxiosError=B$;Rn.mergeConfig=yd;Rn.AxiosHeaders=Ta;Rn.formToJSON=e=>F4(At.isHTMLForm(e)?new FormData(e):e);Rn.getAdapter=W4.getAdapter;Rn.HttpStatusCode=EE;Rn.default=Rn;const N$=({selectedCountry:e,onChange:t})=>{const i=["Afghanistan","Albania","Algeria","Andorra","Angola","Anguilla","Antigua & Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia & Herzegovina","Botswana","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Cape Verde","Cayman Islands","Chad","Chile","China","Colombia","Congo","Cook Islands","Costa Rica","Cote D Ivoire","Croatia","Cruise Ship","Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Estonia","Ethiopia","Falkland Islands","Faroe Islands","Fiji","Finland","France","French Polynesia","French West Indies","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guam","Guatemala","Guernsey","Guinea","Guinea Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kuwait","Kyrgyz Republic","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macau","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Mauritania","Mauritius","Mexico","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Namibia","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Norway","Oman","Pakistan","Palestine","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Pierre & Miquelon","Samoa","San Marino","Satellite","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","South Africa","South Korea","Spain","Sri Lanka","St Kitts & Nevis","St Lucia","St Vincent","St. Lucia","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor L'Este","Togo","Tonga","Trinidad & Tobago","Tunisia","Turkey","Turkmenistan","Turks & Caicos","Uganda","Ukraine","United Arab Emirates","United Kingdom","Uruguay","Uzbekistan","Venezuela","Vietnam","Virgin Islands (US)","Yemen","Zambia","Zimbabwe"];return ne.createElement("select",{name:"country",id:"inputCountry",className:"select",value:e,onChange:t,required:!0},ne.createElement("option",{value:"",hidden:!0,disabled:!0},"Choose here ..."),i.map(l=>ne.createElement("option",{key:l,value:l},l)))},q4=we.createContext(),oC=()=>we.useContext(q4),U$={user:null},j$=(e,t)=>{switch(t.type){case"UPDATE_USER":return{...e,user:t.payload};default:return e}},V$=({children:e})=>{const[t,i]=we.useReducer(j$,U$);return ne.createElement(q4.Provider,{value:{state:t,dispatch:i}},e)},$$=()=>{const[e,t]=we.useState({name:"",email:"",password:"",age:"",phoneNumber:"",country:"",gender:""}),[i,l]=we.useState(null),{dispatch:d}=oC(),y=Hp(),S=a=>{t(N=>({...N,[a.target.name]:a.target.value}))},R=async a=>{if(a.preventDefault(),!e.name||!e.email||!e.password||!e.age||!e.phoneNumber||!e.country||!e.gender)l("All fields are required.");else try{const N=await Rn.post("http://localhost:5000/api/auth/register",e);console.log(N.data),l(null),alert("Registration successful!"),d({type:"UPDATE_USER",payload:N.data.user}),y("/")}catch(N){console.error("Error during registration:",N.response.data),l(N.response.data.message||"Registration failed.")}};return ne.createElement("div",{className:"register"},ne.createElement("div",null,ne.createElement("div",{className:"container"},ne.createElement("h1",null,"Register"),ne.createElement("form",null,ne.createElement("label",null,"name"),ne.createElement("br",null),ne.createElement("input",{type:"text",placeholder:"Name",name:"name",onChange:S,required:!0}),ne.createElement("br",null),ne.createElement("label",null,"email"),ne.createElement("br",null),ne.createElement("input",{type:"email",placeholder:"Email",name:"email",onChange:S,required:!0}),ne.createElement("br",null),ne.createElement("label",null,"password"),ne.createElement("br",null),ne.createElement("input",{type:"password",placeholder:"Password",name:"password",onChange:S,required:!0}),ne.createElement("br",null),ne.createElement("label",null,"age"),ne.createElement("br",null),ne.createElement("input",{type:"number",placeholder:"Age",name:"age",onChange:S,required:!0}),ne.createElement("br",null),ne.createElement("label",null,"phone number"),ne.createElement("br",null),ne.createElement("input",{type:"text",placeholder:"Phone Number",name:"phoneNumber",onChange:S,required:!0}),ne.createElement("br",null),ne.createElement("label",null,"country"),ne.createElement("br",null),ne.createElement(N$,{selectedCountry:e.country,onChange:S}),ne.createElement("div",null,ne.createElement("label",null,ne.createElement("input",{type:"radio",name:"gender",value:"Male",onChange:S,required:!0}),"Male"),ne.createElement("label",null,ne.createElement("input",{type:"radio",name:"gender",value:"Female",onChange:S,required:!0}),"Female"),ne.createElement("label",null,ne.createElement("input",{type:"radio",name:"gender",value:"Other",onChange:S,required:!0}),"Other")),i&&ne.createElement("p",{className:"error"},i),ne.createElement("button",{onClick:R},"Register")))))},W$=()=>{var X,oe;const[e,t]=we.useState({emailOrPhone:"",password:""}),[i,l]=we.useState(null),[d,y]=we.useState(!1),S=Hp(),R=Ku(),{dispatch:a}=oC(),N=((oe=(X=R.state)==null?void 0:X.from)==null?void 0:oe.pathname)||"/",G=te=>{t(ie=>({...ie,[te.target.name]:te.target.value}))},q=async te=>{var ie,pe;te.preventDefault(),y(!0),l(null);try{const se=await Rn.post("http://localhost:5000/api/auth/login",e);console.log(se.data),se.data.success&&(a({type:"UPDATE_USER",payload:se.data.result}),localStorage.setItem("userId",se.data.result.id),localStorage.setItem("email",se.data.result.email),S(N))}catch(se){const le=((pe=(ie=se.response)==null?void 0:ie.data)==null?void 0:pe.message)||"Login failed. Please try again.";console.log("Login error:",se),l(le)}finally{y(!1)}};return ne.createElement("div",{className:"container"},ne.createElement("div",null,ne.createElement("div",{className:"input"},ne.createElement("h2",{className:"title"},"Login"),ne.createElement("form",{onSubmit:q},ne.createElement("label",{htmlFor:"input"},"Email/Phone Number"),ne.createElement("br",null),ne.createElement("input",{type:"text",placeholder:"Email or Phone Number",name:"emailOrPhone",onChange:G,required:!0}),ne.createElement("br",null),ne.createElement("label",{htmlFor:"input"},"Password"),ne.createElement("br",null),ne.createElement("input",{type:"password",placeholder:"Password",name:"password",onChange:G,required:!0}),ne.createElement("br",null),i&&ne.createElement("p",{className:"error"},i),ne.createElement("button",{type:"submit",disabled:d},d?"Logging in...":"Login")))))},G$="_NavWrapper_5qt4c_1",H$="_navbarActive_5qt4c_19",q$="_ContainerNav_5qt4c_33",Z$="_logo_5qt4c_45",Y$="_NavButtons_5qt4c_77",X$="_logoImage_5qt4c_123",K$="_activeNav_5qt4c_203",ec={NavWrapper:G$,navbarActive:H$,ContainerNav:q$,logo:Z$,NavButtons:Y$,logoImage:X$,activeNav:K$},J$="/assets/WebsiteLogo-BlDlt4Hy.png";function Yp(){const e=we.useRef(),t=we.useRef(),i=Hp(),l=()=>{e.current.classList.toggle(ec.activeNav)};window.addEventListener("scroll",function(){window.scrollY>100?t.current.classList.add(ec.navbarActive):t.current.classList.remove(ec.navbarActive)});const d=()=>{i("/RegisterLogin")};return ne.createElement("div",{className:ec.NavWrapper,ref:t},ne.createElement("div",{className:ec.ContainerNav},ne.createElement("div",{className:ec.logo},ne.createElement("a",{href:"#"},ne.createElement("img",{src:J$,alt:"Traveler Logo",className:ec.logoImage}),"Traveler")),ne.createElement("ul",{ref:e},ne.createElement(Uu,{to:"/"},ne.createElement("li",null,"Home")),ne.createElement("li",null,"Destination"),ne.createElement("li",null,"Recommended"),ne.createElement("li",null,"Testimonials"),ne.createElement("li",null,"Inspiration"),ne.createElement(Uu,{to:"/map"},ne.createElement("li",null,"Map")),ne.createElement(Uu,{to:"/UserProfile"},ne.createElement("li",null,"Profil")))),ne.createElement("div",{className:ec.NavButtons},ne.createElement("button",{className:ec.button,onClick:d},"Signin"),ne.createElement("i",{className:"ri-menu-3-line",onClick:l})))}function Q$(){var y,S;const[e,t]=we.useState(!0),l=((S=(y=Ku().state)==null?void 0:y.from)==null?void 0:S.pathname)||"/",d=R=>{t(R==="login")};return ne.createElement("div",null,ne.createElement(Yp,null),ne.createElement("br",null),ne.createElement("br",null),ne.createElement("br",null),ne.createElement("br",null)," ",ne.createElement("br",null),ne.createElement("br",null),ne.createElement("div",null,ne.createElement("button",{onClick:()=>d("login")},"Login"),ne.createElement("button",{onClick:()=>d("register")},"Register")),e?ne.createElement(W$,{redirectPath:l}):ne.createElement($$,null))}var Z4={},_y={},yy={},pc={},Y4={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function i(){for(var y="",S=0;S<arguments.length;S++){var R=arguments[S];R&&(y=d(y,l(R)))}return y}function l(y){if(typeof y=="string"||typeof y=="number")return y;if(typeof y!="object")return"";if(Array.isArray(y))return i.apply(null,y);if(y.toString!==Object.prototype.toString&&!y.toString.toString().includes("[native code]"))return y.toString();var S="";for(var R in y)t.call(y,R)&&y[R]&&(S=d(S,R));return S}function d(y,S){return S?y?y+" "+S:y+S:y}e.exports?(i.default=i,e.exports=i):window.classNames=i})()})(Y4);var Ed=Y4.exports;const X4=7,Kx=365.2425,vy=6048e5,K4=864e5,mc=6e4,Md=36e5,aC=1e3,mk=525600,gp=43200,Jx=1440,J4=60,Q4=3,eF=12,tF=4,q1=3600,sC=60,lC=q1*24,e8=lC*7,rF=lC*Kx,nF=rF/12,t8=nF*3,gk=Symbol.for("constructDateFrom");function Rr(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&gk in e?e[gk](t):e instanceof Date?new e.constructor(t):new Date(t)}function Rt(e,t){return Rr(t||e,e)}function Ol(e,t,i){const l=Rt(e,i==null?void 0:i.in);return isNaN(t)?Rr((i==null?void 0:i.in)||e,NaN):(t&&l.setDate(l.getDate()+t),l)}function xy(e,t,i){const l=Rt(e,i==null?void 0:i.in);if(isNaN(t))return Rr((i==null?void 0:i.in)||e,NaN);if(!t)return l;const d=l.getDate(),y=Rr((i==null?void 0:i.in)||e,l.getTime());y.setMonth(l.getMonth()+t+1,0);const S=y.getDate();return d>=S?y:(l.setFullYear(y.getFullYear(),y.getMonth(),d),l)}function rp(e,t,i){const{years:l=0,months:d=0,weeks:y=0,days:S=0,hours:R=0,minutes:a=0,seconds:N=0}=t,G=Rt(e,i==null?void 0:i.in),q=d||l?xy(G,d+l*12):G,X=S||y?Ol(q,S+y*7):q,oe=a+R*60,ie=(N+oe*60)*1e3;return Rr((i==null?void 0:i.in)||e,+X+ie)}function iF(e,t){return Rt(e,t==null?void 0:t.in).getDay()===6}function oF(e,t){return Rt(e,t==null?void 0:t.in).getDay()===0}function Tp(e,t){const i=Rt(e,t==null?void 0:t.in).getDay();return i===0||i===6}function aF(e,t,i){const l=Rt(e,i==null?void 0:i.in),d=Tp(l,i);if(isNaN(t))return Rr(i==null?void 0:i.in,NaN);const y=l.getHours(),S=t<0?-1:1,R=Math.trunc(t/5);l.setDate(l.getDate()+R*7);let a=Math.abs(t%5);for(;a>0;)l.setDate(l.getDate()+S),Tp(l,i)||(a-=1);return d&&Tp(l,i)&&t!==0&&(iF(l,i)&&l.setDate(l.getDate()+(S<0?2:-1)),oF(l,i)&&l.setDate(l.getDate()+(S<0?1:-2))),l.setHours(y),l}function Z1(e,t,i){return Rr((i==null?void 0:i.in)||e,+Rt(e)+t)}function sF(e,t,i){return Z1(e,t*Md,i)}let lF={};function oa(){return lF}function r8(e){lF=e}function Mo(e,t){var R,a,N,G;const i=oa(),l=(t==null?void 0:t.weekStartsOn)??((a=(R=t==null?void 0:t.locale)==null?void 0:R.options)==null?void 0:a.weekStartsOn)??i.weekStartsOn??((G=(N=i.locale)==null?void 0:N.options)==null?void 0:G.weekStartsOn)??0,d=Rt(e,t==null?void 0:t.in),y=d.getDay(),S=(y<l?7:0)+y-l;return d.setDate(d.getDate()-S),d.setHours(0,0,0,0),d}function Zs(e,t){return Mo(e,{...t,weekStartsOn:1})}function $u(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear(),d=Rr(i,0);d.setFullYear(l+1,0,4),d.setHours(0,0,0,0);const y=Zs(d),S=Rr(i,0);S.setFullYear(l,0,4),S.setHours(0,0,0,0);const R=Zs(S);return i.getTime()>=y.getTime()?l+1:i.getTime()>=R.getTime()?l:l-1}function Ea(e){const t=Rt(e),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+e-+i}function Kn(e,...t){const i=Rr.bind(null,e||t.find(l=>typeof l=="object"));return t.map(i)}function Fp(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setHours(0,0,0,0),i}function Dl(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=Fp(l),S=Fp(d),R=+y-Ea(y),a=+S-Ea(S);return Math.round((R-a)/K4)}function Wu(e,t){const i=$u(e,t),l=Rr((t==null?void 0:t.in)||e,0);return l.setFullYear(i,0,4),l.setHours(0,0,0,0),Zs(l)}function cF(e,t,i){let l=Rt(e,i==null?void 0:i.in);const d=Dl(l,Wu(l,i)),y=Rr((i==null?void 0:i.in)||e,0);return y.setFullYear(t,0,4),y.setHours(0,0,0,0),l=Wu(y),l.setDate(l.getDate()+d),l}function uF(e,t,i){return cF(e,$u(e,i)+t,i)}function cC(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setTime(l.getTime()+t*mc),l}function uC(e,t,i){return xy(e,t*3,i)}function hF(e,t,i){return Z1(e,t*1e3,i)}function Y1(e,t,i){return Ol(e,t*7,i)}function dF(e,t,i){return xy(e,t*12,i)}function n8(e,t,i){const[l,d]=[+Rt(e.start,i==null?void 0:i.in),+Rt(e.end,i==null?void 0:i.in)].sort((R,a)=>R-a),[y,S]=[+Rt(t.start,i==null?void 0:i.in),+Rt(t.end,i==null?void 0:i.in)].sort((R,a)=>R-a);return i!=null&&i.inclusive?l<=S&&y<=d:l<S&&y<d}function fF(e,t){let i,l=t==null?void 0:t.in;return e.forEach(d=>{!l&&typeof d=="object"&&(l=Rr.bind(null,d));const y=Rt(d,l);(!i||i<y||isNaN(+y))&&(i=y)}),Rr(l,i||NaN)}function pF(e,t){let i,l=t==null?void 0:t.in;return e.forEach(d=>{!l&&typeof d=="object"&&(l=Rr.bind(null,d));const y=Rt(d,l);(!i||i>y||isNaN(+y))&&(i=y)}),Rr(l,i||NaN)}function i8(e,t,i){const[l,d,y]=Kn(i==null?void 0:i.in,e,t.start,t.end);return pF([fF([l,d],i),y],i)}function mF(e,t){const i=+Rt(e);if(isNaN(i))return NaN;let l,d;return t.forEach((y,S)=>{const R=Rt(y);if(isNaN(+R)){l=NaN,d=NaN;return}const a=Math.abs(i-+R);(l==null||a<d)&&(l=S,d=a)}),l}function o8(e,t,i){const[l,...d]=Kn(i==null?void 0:i.in,e,...t),y=mF(l,d);if(typeof y=="number"&&isNaN(y))return Rr(l,NaN);if(y!==void 0)return d[y]}function Rl(e,t){const i=+Rt(e)-+Rt(t);return i<0?-1:i>0?1:i}function a8(e,t){const i=+Rt(e)-+Rt(t);return i>0?-1:i<0?1:i}function Ji(e){return Rr(e,Date.now())}function s8(e){const t=Math.trunc(e/X4);return t===0?0:t}function by(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return+Fp(l)==+Fp(d)}function gF(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function gc(e){return!(!gF(e)&&typeof e!="number"||isNaN(+Rt(e)))}function l8(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);if(!gc(l)||!gc(d))return NaN;const y=Dl(l,d),S=y<0?-1:1,R=Math.trunc(y/7);let a=R*5,N=Ol(d,R*7);for(;!by(l,N);)a+=Tp(N,i)?0:S,N=Ol(N,S);return a===0?0:a}function _F(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return $u(l,i)-$u(d,i)}function c8(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=Zs(l),S=Zs(d),R=+y-Ea(y),a=+S-Ea(S);return Math.round((R-a)/vy)}function Qx(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=l.getFullYear()-d.getFullYear(),S=l.getMonth()-d.getMonth();return y*12+S}function ME(e,t){const i=Rt(e,t==null?void 0:t.in);return Math.trunc(i.getMonth()/3)+1}function gx(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=l.getFullYear()-d.getFullYear(),S=ME(l)-ME(d);return y*4+S}function e1(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=Mo(l,i),S=Mo(d,i),R=+y-Ea(y),a=+S-Ea(S);return Math.round((R-a)/vy)}function I_(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return l.getFullYear()-d.getFullYear()}function hC(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=_k(l,d),S=Math.abs(Dl(l,d));l.setDate(l.getDate()-y*S);const R=+(_k(l,d)===-y),a=y*(S-R);return a===0?0:a}function _k(e,t){const i=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return i<0?-1:i>0?1:i}function Ju(e){return t=>{const l=(e?Math[e]:Math.trunc)(t);return l===0?0:l}}function t1(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=(+l-+d)/Md;return Ju(i==null?void 0:i.roundingMethod)(y)}function yF(e,t,i){return uF(e,-t,i)}function u8(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=Rl(l,d),S=Math.abs(_F(l,d,i)),R=yF(l,y*S,i),a=+(Rl(R,d)===-y),N=y*(S-a);return N===0?0:N}function dC(e,t){return+Rt(e)-+Rt(t)}function r1(e,t,i){const l=dC(e,t)/mc;return Ju(i==null?void 0:i.roundingMethod)(l)}function fC(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setHours(23,59,59,999),i}function pC(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getMonth();return i.setFullYear(i.getFullYear(),l+1,0),i.setHours(23,59,59,999),i}function vF(e,t){const i=Rt(e,t==null?void 0:t.in);return+fC(i,t)==+pC(i,t)}function X1(e,t,i){const[l,d,y]=Kn(i==null?void 0:i.in,e,e,t),S=Rl(d,y),R=Math.abs(Qx(d,y));if(R<1)return 0;d.getMonth()===1&&d.getDate()>27&&d.setDate(30),d.setMonth(d.getMonth()-S*R);let a=Rl(d,y)===-S;vF(l)&&R===1&&Rl(l,y)===1&&(a=!1);const N=S*(R-+a);return N===0?0:N}function h8(e,t,i){const l=X1(e,t,i)/3;return Ju(i==null?void 0:i.roundingMethod)(l)}function Ep(e,t,i){const l=dC(e,t)/1e3;return Ju(i==null?void 0:i.roundingMethod)(l)}function d8(e,t,i){const l=hC(e,t,i)/7;return Ju(i==null?void 0:i.roundingMethod)(l)}function xF(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t),y=Rl(l,d),S=Math.abs(I_(l,d));l.setFullYear(1584),d.setFullYear(1584);const R=Rl(l,d)===-y,a=y*(S-+R);return a===0?0:a}function bc(e,t){const[i,l]=Kn(e,t.start,t.end);return{start:i,end:l}}function bF(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);let d=+i>+l;const y=d?+i:+l,S=d?l:i;S.setHours(0,0,0,0);let R=(t==null?void 0:t.step)??1;if(!R)return[];R<0&&(R=-R,d=!d);const a=[];for(;+S<=y;)a.push(Rr(i,S)),S.setDate(S.getDate()+R),S.setHours(0,0,0,0);return d?a.reverse():a}function f8(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);let d=+i>+l;const y=d?+i:+l,S=d?l:i;S.setMinutes(0,0,0);let R=(t==null?void 0:t.step)??1;if(!R)return[];R<0&&(R=-R,d=!d);const a=[];for(;+S<=y;)a.push(Rr(i,S)),S.setHours(S.getHours()+R);return d?a.reverse():a}function p8(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);i.setSeconds(0,0);let d=+i>+l;const y=d?+i:+l;let S=d?l:i,R=(t==null?void 0:t.step)??1;if(!R)return[];R<0&&(R=-R,d=!d);const a=[];for(;+S<=y;)a.push(Rr(i,S)),S=cC(S,R);return d?a.reverse():a}function m8(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);let d=+i>+l;const y=d?+i:+l,S=d?l:i;S.setHours(0,0,0,0),S.setDate(1);let R=(t==null?void 0:t.step)??1;if(!R)return[];R<0&&(R=-R,d=!d);const a=[];for(;+S<=y;)a.push(Rr(i,S)),S.setMonth(S.getMonth()+R);return d?a.reverse():a}function sd(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getMonth(),d=l-l%3;return i.setMonth(d,1),i.setHours(0,0,0,0),i}function g8(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);let d=+i>+l;const y=d?+sd(i):+sd(l);let S=sd(d?l:i),R=(t==null?void 0:t.step)??1;if(!R)return[];R<0&&(R=-R,d=!d);const a=[];for(;+S<=y;)a.push(Rr(i,S)),S=uC(S,R);return d?a.reverse():a}function _8(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);let d=+i>+l;const y=Mo(d?l:i,t),S=Mo(d?i:l,t);y.setHours(15),S.setHours(15);const R=+S.getTime();let a=y,N=(t==null?void 0:t.step)??1;if(!N)return[];N<0&&(N=-N,d=!d);const G=[];for(;+a<=R;)a.setHours(0),G.push(Rr(i,a)),a=Y1(a,N),a.setHours(15);return d?G.reverse():G}function mC(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e),d=bF({start:i,end:l},t),y=[];let S=0;for(;S<d.length;){const R=d[S++];Tp(R)&&y.push(Rr(i,R))}return y}function K1(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setDate(1),i.setHours(0,0,0,0),i}function y8(e,t){const i=K1(e,t),l=pC(e,t);return mC({start:i,end:l},t)}function wF(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear();return i.setFullYear(l+1,0,0),i.setHours(23,59,59,999),i}function gC(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setFullYear(i.getFullYear(),0,1),i.setHours(0,0,0,0),i}function v8(e,t){const i=gC(e,t),l=wF(e,t);return mC({start:i,end:l},t)}function x8(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e);let d=+i>+l;const y=d?+i:+l,S=d?l:i;S.setHours(0,0,0,0),S.setMonth(0,1);let R=(t==null?void 0:t.step)??1;if(!R)return[];R<0&&(R=-R,d=!d);const a=[];for(;+S<=y;)a.push(Rr(i,S)),S.setFullYear(S.getFullYear()+R);return d?a.reverse():a}function b8(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear(),d=9+Math.floor(l/10)*10;return i.setFullYear(d,11,31),i.setHours(23,59,59,999),i}function w8(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setMinutes(59,59,999),i}function SF(e,t){var R,a,N,G;const i=oa(),l=(t==null?void 0:t.weekStartsOn)??((a=(R=t==null?void 0:t.locale)==null?void 0:R.options)==null?void 0:a.weekStartsOn)??i.weekStartsOn??((G=(N=i.locale)==null?void 0:N.options)==null?void 0:G.weekStartsOn)??0,d=Rt(e,t==null?void 0:t.in),y=d.getDay(),S=(y<l?-7:0)+6-(y-l);return d.setDate(d.getDate()+S),d.setHours(23,59,59,999),d}function S8(e,t){return SF(e,{...t,weekStartsOn:1})}function T8(e,t){const i=$u(e,t),l=Rr((t==null?void 0:t.in)||e,0);l.setFullYear(i+1,0,4),l.setHours(0,0,0,0);const d=Zs(l,t);return d.setMilliseconds(d.getMilliseconds()-1),d}function E8(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setSeconds(59,999),i}function M8(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getMonth(),d=l-l%3+3;return i.setMonth(d,0),i.setHours(23,59,59,999),i}function C8(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setMilliseconds(999),i}function I8(e){return fC(Date.now(),e)}function P8(e){const t=Ji(e==null?void 0:e.in),i=t.getFullYear(),l=t.getMonth(),d=t.getDate(),y=Ji(e==null?void 0:e.in);return y.setFullYear(i,l,d+1),y.setHours(23,59,59,999),e!=null&&e.in?e.in(y):y}function A8(e){const t=Ji(e==null?void 0:e.in),i=Rr(e==null?void 0:e.in,0);return i.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()-1),i.setHours(23,59,59,999),i}const D8={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},R8=(e,t,i)=>{let l;const d=D8[e];return typeof d=="string"?l=d:t===1?l=d.one:l=d.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+l:l+" ago":l};function sT(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}const k8={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},O8={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},L8={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},z8={date:sT({formats:k8,defaultWidth:"full"}),time:sT({formats:O8,defaultWidth:"full"}),dateTime:sT({formats:L8,defaultWidth:"full"})},F8={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},B8=(e,t,i,l)=>F8[e];function e_(e){return(t,i)=>{const l=i!=null&&i.context?String(i.context):"standalone";let d;if(l==="formatting"&&e.formattingValues){const S=e.defaultFormattingWidth||e.defaultWidth,R=i!=null&&i.width?String(i.width):S;d=e.formattingValues[R]||e.formattingValues[S]}else{const S=e.defaultWidth,R=i!=null&&i.width?String(i.width):e.defaultWidth;d=e.values[R]||e.values[S]}const y=e.argumentCallback?e.argumentCallback(t):t;return d[y]}}const N8={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},U8={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},j8={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},V8={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},$8={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},W8={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},G8=(e,t)=>{const i=Number(e),l=i%100;if(l>20||l<10)switch(l%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},H8={ordinalNumber:G8,era:e_({values:N8,defaultWidth:"wide"}),quarter:e_({values:U8,defaultWidth:"wide",argumentCallback:e=>e-1}),month:e_({values:j8,defaultWidth:"wide"}),day:e_({values:V8,defaultWidth:"wide"}),dayPeriod:e_({values:$8,defaultWidth:"wide",formattingValues:W8,defaultFormattingWidth:"wide"})};function t_(e){return(t,i={})=>{const l=i.width,d=l&&e.matchPatterns[l]||e.matchPatterns[e.defaultMatchWidth],y=t.match(d);if(!y)return null;const S=y[0],R=l&&e.parsePatterns[l]||e.parsePatterns[e.defaultParseWidth],a=Array.isArray(R)?Z8(R,q=>q.test(S)):q8(R,q=>q.test(S));let N;N=e.valueCallback?e.valueCallback(a):a,N=i.valueCallback?i.valueCallback(N):N;const G=t.slice(S.length);return{value:N,rest:G}}}function q8(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i}function Z8(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i}function Y8(e){return(t,i={})=>{const l=t.match(e.matchPattern);if(!l)return null;const d=l[0],y=t.match(e.parsePattern);if(!y)return null;let S=e.valueCallback?e.valueCallback(y[0]):y[0];S=i.valueCallback?i.valueCallback(S):S;const R=t.slice(d.length);return{value:S,rest:R}}}const X8=/^(\d+)(th|st|nd|rd)?/i,K8=/\d+/i,J8={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Q8={any:[/^b/i,/^(a|c)/i]},eW={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},tW={any:[/1/i,/2/i,/3/i,/4/i]},rW={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},nW={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},iW={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},oW={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},aW={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},sW={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},lW={ordinalNumber:Y8({matchPattern:X8,parsePattern:K8,valueCallback:e=>parseInt(e,10)}),era:t_({matchPatterns:J8,defaultMatchWidth:"wide",parsePatterns:Q8,defaultParseWidth:"any"}),quarter:t_({matchPatterns:eW,defaultMatchWidth:"wide",parsePatterns:tW,defaultParseWidth:"any",valueCallback:e=>e+1}),month:t_({matchPatterns:rW,defaultMatchWidth:"wide",parsePatterns:nW,defaultParseWidth:"any"}),day:t_({matchPatterns:iW,defaultMatchWidth:"wide",parsePatterns:oW,defaultParseWidth:"any"}),dayPeriod:t_({matchPatterns:aW,defaultMatchWidth:"any",parsePatterns:sW,defaultParseWidth:"any"})},Xp={code:"en-US",formatDistance:R8,formatLong:z8,formatRelative:B8,localize:H8,match:lW,options:{weekStartsOn:0,firstWeekContainsDate:1}};function TF(e,t){const i=Rt(e,t==null?void 0:t.in);return Dl(i,gC(i))+1}function _C(e,t){const i=Rt(e,t==null?void 0:t.in),l=+Zs(i)-+Wu(i);return Math.round(l/vy)+1}function J1(e,t){var G,q,X,oe;const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear(),d=oa(),y=(t==null?void 0:t.firstWeekContainsDate)??((q=(G=t==null?void 0:t.locale)==null?void 0:G.options)==null?void 0:q.firstWeekContainsDate)??d.firstWeekContainsDate??((oe=(X=d.locale)==null?void 0:X.options)==null?void 0:oe.firstWeekContainsDate)??1,S=Rr((t==null?void 0:t.in)||e,0);S.setFullYear(l+1,0,y),S.setHours(0,0,0,0);const R=Mo(S,t),a=Rr((t==null?void 0:t.in)||e,0);a.setFullYear(l,0,y),a.setHours(0,0,0,0);const N=Mo(a,t);return+i>=+R?l+1:+i>=+N?l:l-1}function n1(e,t){var R,a,N,G;const i=oa(),l=(t==null?void 0:t.firstWeekContainsDate)??((a=(R=t==null?void 0:t.locale)==null?void 0:R.options)==null?void 0:a.firstWeekContainsDate)??i.firstWeekContainsDate??((G=(N=i.locale)==null?void 0:N.options)==null?void 0:G.firstWeekContainsDate)??1,d=J1(e,t),y=Rr((t==null?void 0:t.in)||e,0);return y.setFullYear(d,0,l),y.setHours(0,0,0,0),Mo(y,t)}function yC(e,t){const i=Rt(e,t==null?void 0:t.in),l=+Mo(i,t)-+n1(i,t);return Math.round(l/vy)+1}function Br(e,t){const i=e<0?"-":"",l=Math.abs(e).toString().padStart(t,"0");return i+l}const wl={y(e,t){const i=e.getFullYear(),l=i>0?i:1-i;return Br(t==="yy"?l%100:l,t.length)},M(e,t){const i=e.getMonth();return t==="M"?String(i+1):Br(i+1,2)},d(e,t){return Br(e.getDate(),t.length)},a(e,t){const i=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(e,t){return Br(e.getHours()%12||12,t.length)},H(e,t){return Br(e.getHours(),t.length)},m(e,t){return Br(e.getMinutes(),t.length)},s(e,t){return Br(e.getSeconds(),t.length)},S(e,t){const i=t.length,l=e.getMilliseconds(),d=Math.trunc(l*Math.pow(10,i-3));return Br(d,t.length)}},qf={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},CE={G:function(e,t,i){const l=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(l,{width:"abbreviated"});case"GGGGG":return i.era(l,{width:"narrow"});case"GGGG":default:return i.era(l,{width:"wide"})}},y:function(e,t,i){if(t==="yo"){const l=e.getFullYear(),d=l>0?l:1-l;return i.ordinalNumber(d,{unit:"year"})}return wl.y(e,t)},Y:function(e,t,i,l){const d=J1(e,l),y=d>0?d:1-d;if(t==="YY"){const S=y%100;return Br(S,2)}return t==="Yo"?i.ordinalNumber(y,{unit:"year"}):Br(y,t.length)},R:function(e,t){const i=$u(e);return Br(i,t.length)},u:function(e,t){const i=e.getFullYear();return Br(i,t.length)},Q:function(e,t,i){const l=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(l);case"QQ":return Br(l,2);case"Qo":return i.ordinalNumber(l,{unit:"quarter"});case"QQQ":return i.quarter(l,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(l,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(l,{width:"wide",context:"formatting"})}},q:function(e,t,i){const l=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(l);case"qq":return Br(l,2);case"qo":return i.ordinalNumber(l,{unit:"quarter"});case"qqq":return i.quarter(l,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(l,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(l,{width:"wide",context:"standalone"})}},M:function(e,t,i){const l=e.getMonth();switch(t){case"M":case"MM":return wl.M(e,t);case"Mo":return i.ordinalNumber(l+1,{unit:"month"});case"MMM":return i.month(l,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(l,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(l,{width:"wide",context:"formatting"})}},L:function(e,t,i){const l=e.getMonth();switch(t){case"L":return String(l+1);case"LL":return Br(l+1,2);case"Lo":return i.ordinalNumber(l+1,{unit:"month"});case"LLL":return i.month(l,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(l,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(l,{width:"wide",context:"standalone"})}},w:function(e,t,i,l){const d=yC(e,l);return t==="wo"?i.ordinalNumber(d,{unit:"week"}):Br(d,t.length)},I:function(e,t,i){const l=_C(e);return t==="Io"?i.ordinalNumber(l,{unit:"week"}):Br(l,t.length)},d:function(e,t,i){return t==="do"?i.ordinalNumber(e.getDate(),{unit:"date"}):wl.d(e,t)},D:function(e,t,i){const l=TF(e);return t==="Do"?i.ordinalNumber(l,{unit:"dayOfYear"}):Br(l,t.length)},E:function(e,t,i){const l=e.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(l,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(l,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(l,{width:"short",context:"formatting"});case"EEEE":default:return i.day(l,{width:"wide",context:"formatting"})}},e:function(e,t,i,l){const d=e.getDay(),y=(d-l.weekStartsOn+8)%7||7;switch(t){case"e":return String(y);case"ee":return Br(y,2);case"eo":return i.ordinalNumber(y,{unit:"day"});case"eee":return i.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(d,{width:"short",context:"formatting"});case"eeee":default:return i.day(d,{width:"wide",context:"formatting"})}},c:function(e,t,i,l){const d=e.getDay(),y=(d-l.weekStartsOn+8)%7||7;switch(t){case"c":return String(y);case"cc":return Br(y,t.length);case"co":return i.ordinalNumber(y,{unit:"day"});case"ccc":return i.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(d,{width:"narrow",context:"standalone"});case"cccccc":return i.day(d,{width:"short",context:"standalone"});case"cccc":default:return i.day(d,{width:"wide",context:"standalone"})}},i:function(e,t,i){const l=e.getDay(),d=l===0?7:l;switch(t){case"i":return String(d);case"ii":return Br(d,t.length);case"io":return i.ordinalNumber(d,{unit:"day"});case"iii":return i.day(l,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(l,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(l,{width:"short",context:"formatting"});case"iiii":default:return i.day(l,{width:"wide",context:"formatting"})}},a:function(e,t,i){const d=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,t,i){const l=e.getHours();let d;switch(l===12?d=qf.noon:l===0?d=qf.midnight:d=l/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,t,i){const l=e.getHours();let d;switch(l>=17?d=qf.evening:l>=12?d=qf.afternoon:l>=4?d=qf.morning:d=qf.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,t,i){if(t==="ho"){let l=e.getHours()%12;return l===0&&(l=12),i.ordinalNumber(l,{unit:"hour"})}return wl.h(e,t)},H:function(e,t,i){return t==="Ho"?i.ordinalNumber(e.getHours(),{unit:"hour"}):wl.H(e,t)},K:function(e,t,i){const l=e.getHours()%12;return t==="Ko"?i.ordinalNumber(l,{unit:"hour"}):Br(l,t.length)},k:function(e,t,i){let l=e.getHours();return l===0&&(l=24),t==="ko"?i.ordinalNumber(l,{unit:"hour"}):Br(l,t.length)},m:function(e,t,i){return t==="mo"?i.ordinalNumber(e.getMinutes(),{unit:"minute"}):wl.m(e,t)},s:function(e,t,i){return t==="so"?i.ordinalNumber(e.getSeconds(),{unit:"second"}):wl.s(e,t)},S:function(e,t){return wl.S(e,t)},X:function(e,t,i){const l=e.getTimezoneOffset();if(l===0)return"Z";switch(t){case"X":return vk(l);case"XXXX":case"XX":return Jh(l);case"XXXXX":case"XXX":default:return Jh(l,":")}},x:function(e,t,i){const l=e.getTimezoneOffset();switch(t){case"x":return vk(l);case"xxxx":case"xx":return Jh(l);case"xxxxx":case"xxx":default:return Jh(l,":")}},O:function(e,t,i){const l=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+yk(l,":");case"OOOO":default:return"GMT"+Jh(l,":")}},z:function(e,t,i){const l=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+yk(l,":");case"zzzz":default:return"GMT"+Jh(l,":")}},t:function(e,t,i){const l=Math.trunc(+e/1e3);return Br(l,t.length)},T:function(e,t,i){return Br(+e,t.length)}};function yk(e,t=""){const i=e>0?"-":"+",l=Math.abs(e),d=Math.trunc(l/60),y=l%60;return y===0?i+String(d):i+String(d)+t+Br(y,2)}function vk(e,t){return e%60===0?(e>0?"-":"+")+Br(Math.abs(e)/60,2):Jh(e,t)}function Jh(e,t=""){const i=e>0?"-":"+",l=Math.abs(e),d=Br(Math.trunc(l/60),2),y=Br(l%60,2);return i+d+t+y}const xk=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},EF=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},cW=(e,t)=>{const i=e.match(/(P+)(p+)?/)||[],l=i[1],d=i[2];if(!d)return xk(e,t);let y;switch(l){case"P":y=t.dateTime({width:"short"});break;case"PP":y=t.dateTime({width:"medium"});break;case"PPP":y=t.dateTime({width:"long"});break;case"PPPP":default:y=t.dateTime({width:"full"});break}return y.replace("{{date}}",xk(l,t)).replace("{{time}}",EF(d,t))},i1={p:EF,P:cW},uW=/^D+$/,hW=/^Y+$/,dW=["D","DD","YY","YYYY"];function MF(e){return uW.test(e)}function CF(e){return hW.test(e)}function IE(e,t,i){const l=fW(e,t,i);if(console.warn(l),dW.includes(e))throw new RangeError(l)}function fW(e,t,i){const l=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${l} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const pW=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,mW=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,gW=/^'([^]*?)'?$/,_W=/''/g,yW=/[a-zA-Z]/;function ty(e,t,i){var G,q,X,oe,te,ie,pe,se;const l=oa(),d=(i==null?void 0:i.locale)??l.locale??Xp,y=(i==null?void 0:i.firstWeekContainsDate)??((q=(G=i==null?void 0:i.locale)==null?void 0:G.options)==null?void 0:q.firstWeekContainsDate)??l.firstWeekContainsDate??((oe=(X=l.locale)==null?void 0:X.options)==null?void 0:oe.firstWeekContainsDate)??1,S=(i==null?void 0:i.weekStartsOn)??((ie=(te=i==null?void 0:i.locale)==null?void 0:te.options)==null?void 0:ie.weekStartsOn)??l.weekStartsOn??((se=(pe=l.locale)==null?void 0:pe.options)==null?void 0:se.weekStartsOn)??0,R=Rt(e,i==null?void 0:i.in);if(!gc(R))throw new RangeError("Invalid time value");let a=t.match(mW).map(le=>{const ce=le[0];if(ce==="p"||ce==="P"){const Me=i1[ce];return Me(le,d.formatLong)}return le}).join("").match(pW).map(le=>{if(le==="''")return{isToken:!1,value:"'"};const ce=le[0];if(ce==="'")return{isToken:!1,value:vW(le)};if(CE[ce])return{isToken:!0,value:le};if(ce.match(yW))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ce+"`");return{isToken:!1,value:le}});d.localize.preprocessor&&(a=d.localize.preprocessor(R,a));const N={firstWeekContainsDate:y,weekStartsOn:S,locale:d};return a.map(le=>{if(!le.isToken)return le.value;const ce=le.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&CF(ce)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&MF(ce))&&IE(ce,t,String(e));const Me=CE[ce[0]];return Me(R,ce,d.localize,N)}).join("")}function vW(e){const t=e.match(gW);return t?t[1].replace(_W,"'"):e}function IF(e,t,i){const l=oa(),d=(i==null?void 0:i.locale)??l.locale??Xp,y=2520,S=Rl(e,t);if(isNaN(S))throw new RangeError("Invalid time value");const R=Object.assign({},i,{addSuffix:i==null?void 0:i.addSuffix,comparison:S}),[a,N]=Kn(i==null?void 0:i.in,...S>0?[t,e]:[e,t]),G=Ep(N,a),q=(Ea(N)-Ea(a))/1e3,X=Math.round((G-q)/60);let oe;if(X<2)return i!=null&&i.includeSeconds?G<5?d.formatDistance("lessThanXSeconds",5,R):G<10?d.formatDistance("lessThanXSeconds",10,R):G<20?d.formatDistance("lessThanXSeconds",20,R):G<40?d.formatDistance("halfAMinute",0,R):G<60?d.formatDistance("lessThanXMinutes",1,R):d.formatDistance("xMinutes",1,R):X===0?d.formatDistance("lessThanXMinutes",1,R):d.formatDistance("xMinutes",X,R);if(X<45)return d.formatDistance("xMinutes",X,R);if(X<90)return d.formatDistance("aboutXHours",1,R);if(X<Jx){const te=Math.round(X/60);return d.formatDistance("aboutXHours",te,R)}else{if(X<y)return d.formatDistance("xDays",1,R);if(X<gp){const te=Math.round(X/Jx);return d.formatDistance("xDays",te,R)}else if(X<gp*2)return oe=Math.round(X/gp),d.formatDistance("aboutXMonths",oe,R)}if(oe=X1(N,a),oe<12){const te=Math.round(X/gp);return d.formatDistance("xMonths",te,R)}else{const te=oe%12,ie=Math.trunc(oe/12);return te<3?d.formatDistance("aboutXYears",ie,R):te<9?d.formatDistance("overXYears",ie,R):d.formatDistance("almostXYears",ie+1,R)}}function PF(e,t,i){const l=oa(),d=(i==null?void 0:i.locale)??l.locale??Xp,y=Rl(e,t);if(isNaN(y))throw new RangeError("Invalid time value");const S=Object.assign({},i,{addSuffix:i==null?void 0:i.addSuffix,comparison:y}),[R,a]=Kn(i==null?void 0:i.in,...y>0?[t,e]:[e,t]),N=Ju((i==null?void 0:i.roundingMethod)??"round"),G=a.getTime()-R.getTime(),q=G/mc,X=Ea(a)-Ea(R),oe=(G-X)/mc,te=i==null?void 0:i.unit;let ie;if(te?ie=te:q<1?ie="second":q<60?ie="minute":q<Jx?ie="hour":oe<gp?ie="day":oe<mk?ie="month":ie="year",ie==="second"){const pe=N(G/1e3);return d.formatDistance("xSeconds",pe,S)}else if(ie==="minute"){const pe=N(q);return d.formatDistance("xMinutes",pe,S)}else if(ie==="hour"){const pe=N(q/60);return d.formatDistance("xHours",pe,S)}else if(ie==="day"){const pe=N(oe/Jx);return d.formatDistance("xDays",pe,S)}else if(ie==="month"){const pe=N(oe/gp);return pe===12&&te!=="month"?d.formatDistance("xYears",1,S):d.formatDistance("xMonths",pe,S)}else{const pe=N(oe/mk);return d.formatDistance("xYears",pe,S)}}function xW(e,t){return IF(e,Ji(e),t)}function bW(e,t){return PF(e,Ji(e),t)}const wW=["years","months","weeks","days","hours","minutes","seconds"];function SW(e,t){const i=oa(),l=(t==null?void 0:t.locale)??i.locale??Xp,d=(t==null?void 0:t.format)??wW,y=(t==null?void 0:t.zero)??!1,S=(t==null?void 0:t.delimiter)??" ";return l.formatDistance?d.reduce((a,N)=>{const G=`x${N.replace(/(^.)/,X=>X.toUpperCase())}`,q=e[N];return q!==void 0&&(y||e[N])?a.concat(l.formatDistance(G,q)):a},[]).join(S):""}function TW(e,t){const i=Rt(e,t==null?void 0:t.in);if(isNaN(+i))throw new RangeError("Invalid time value");const l=(t==null?void 0:t.format)??"extended",d=(t==null?void 0:t.representation)??"complete";let y="",S="";const R=l==="extended"?"-":"",a=l==="extended"?":":"";if(d!=="time"){const N=Br(i.getDate(),2),G=Br(i.getMonth()+1,2);y=`${Br(i.getFullYear(),4)}${R}${G}${R}${N}`}if(d!=="date"){const N=i.getTimezoneOffset();if(N!==0){const ie=Math.abs(N),pe=Br(Math.trunc(ie/60),2),se=Br(ie%60,2);S=`${N<0?"+":"-"}${pe}:${se}`}else S="Z";const G=Br(i.getHours(),2),q=Br(i.getMinutes(),2),X=Br(i.getSeconds(),2),oe=y===""?"":"T",te=[G,q,X].join(a);y=`${y}${oe}${te}${S}`}return y}function EW(e,t){const i=Rt(e,t==null?void 0:t.in);if(!gc(i))throw new RangeError("Invalid time value");const l=(t==null?void 0:t.format)??"extended",d=(t==null?void 0:t.representation)??"complete";let y="";const S=l==="extended"?"-":"",R=l==="extended"?":":"";if(d!=="time"){const a=Br(i.getDate(),2),N=Br(i.getMonth()+1,2);y=`${Br(i.getFullYear(),4)}${S}${N}${S}${a}`}if(d!=="date"){const a=Br(i.getHours(),2),N=Br(i.getMinutes(),2),G=Br(i.getSeconds(),2);y=`${y}${y===""?"":" "}${a}${R}${N}${R}${G}`}return y}function MW(e){const{years:t=0,months:i=0,days:l=0,hours:d=0,minutes:y=0,seconds:S=0}=e;return`P${t}Y${i}M${l}DT${d}H${y}M${S}S`}function CW(e,t){const i=Rt(e,t==null?void 0:t.in);if(!gc(i))throw new RangeError("Invalid time value");const l=(t==null?void 0:t.fractionDigits)??0,d=Br(i.getDate(),2),y=Br(i.getMonth()+1,2),S=i.getFullYear(),R=Br(i.getHours(),2),a=Br(i.getMinutes(),2),N=Br(i.getSeconds(),2);let G="";if(l>0){const oe=i.getMilliseconds(),te=Math.trunc(oe*Math.pow(10,l-3));G="."+Br(te,l)}let q="";const X=i.getTimezoneOffset();if(X!==0){const oe=Math.abs(X),te=Br(Math.trunc(oe/60),2),ie=Br(oe%60,2);q=`${X<0?"+":"-"}${te}:${ie}`}else q="Z";return`${S}-${y}-${d}T${R}:${a}:${N}${G}${q}`}const IW=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],PW=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function AW(e){const t=Rt(e);if(!gc(t))throw new RangeError("Invalid time value");const i=IW[t.getUTCDay()],l=Br(t.getUTCDate(),2),d=PW[t.getUTCMonth()],y=t.getUTCFullYear(),S=Br(t.getUTCHours(),2),R=Br(t.getUTCMinutes(),2),a=Br(t.getUTCSeconds(),2);return`${i}, ${l} ${d} ${y} ${S}:${R}:${a} GMT`}function DW(e,t,i){var q,X,oe,te;const[l,d]=Kn(i==null?void 0:i.in,e,t),y=oa(),S=(i==null?void 0:i.locale)??y.locale??Xp,R=(i==null?void 0:i.weekStartsOn)??((X=(q=i==null?void 0:i.locale)==null?void 0:q.options)==null?void 0:X.weekStartsOn)??y.weekStartsOn??((te=(oe=y.locale)==null?void 0:oe.options)==null?void 0:te.weekStartsOn)??0,a=Dl(l,d);if(isNaN(a))throw new RangeError("Invalid time value");let N;a<-6?N="other":a<-1?N="lastWeek":a<0?N="yesterday":a<1?N="today":a<2?N="tomorrow":a<7?N="nextWeek":N="other";const G=S.formatRelative(N,l,d,{locale:S,weekStartsOn:R});return ty(l,G,{locale:S,weekStartsOn:R})}function RW(e,t){return Rt(e*1e3,t==null?void 0:t.in)}function AF(e,t){return Rt(e,t==null?void 0:t.in).getDate()}function Q1(e,t){return Rt(e,t==null?void 0:t.in).getDay()}function DF(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear(),d=i.getMonth(),y=Rr(i,0);return y.setFullYear(l,d+1,0),y.setHours(0,0,0,0),y.getDate()}function RF(e,t){const l=Rt(e,t==null?void 0:t.in).getFullYear();return l%400===0||l%4===0&&l%100!==0}function kW(e,t){const i=Rt(e,t==null?void 0:t.in);return Number.isNaN(+i)?NaN:RF(i)?366:365}function OW(e,t){const l=Rt(e,t==null?void 0:t.in).getFullYear();return Math.floor(l/10)*10}function kF(){return Object.assign({},oa())}function LW(e,t){return Rt(e,t==null?void 0:t.in).getHours()}function OF(e,t){const i=Rt(e,t==null?void 0:t.in).getDay();return i===0?7:i}function zW(e,t){const i=Wu(e,t),d=+Wu(Y1(i,60))-+i;return Math.round(d/vy)}function FW(e){return Rt(e).getMilliseconds()}function BW(e,t){return Rt(e,t==null?void 0:t.in).getMinutes()}function NW(e,t){return Rt(e,t==null?void 0:t.in).getMonth()}function UW(e,t){const[i,l]=[+Rt(e.start),+Rt(e.end)].sort((q,X)=>q-X),[d,y]=[+Rt(t.start),+Rt(t.end)].sort((q,X)=>q-X);if(!(i<y&&d<l))return 0;const R=d<i?i:d,a=R-Ea(R),N=y>l?l:y,G=N-Ea(N);return Math.ceil((G-a)/K4)}function jW(e){return Rt(e).getSeconds()}function VW(e){return+Rt(e)}function $W(e){return Math.trunc(+Rt(e)/1e3)}function WW(e,t){var a,N,G,q;const i=oa(),l=(t==null?void 0:t.weekStartsOn)??((N=(a=t==null?void 0:t.locale)==null?void 0:a.options)==null?void 0:N.weekStartsOn)??i.weekStartsOn??((q=(G=i.locale)==null?void 0:G.options)==null?void 0:q.weekStartsOn)??0,d=AF(Rt(e,t==null?void 0:t.in));if(isNaN(d))return NaN;const y=Q1(K1(e,t));let S=l-y;S<=0&&(S+=7);const R=d-S;return Math.ceil(R/7)+1}function LF(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getMonth();return i.setFullYear(i.getFullYear(),l+1,0),i.setHours(0,0,0,0),Rt(i,t==null?void 0:t.in)}function GW(e,t){const i=Rt(e,t==null?void 0:t.in);return e1(LF(i,t),K1(i,t),t)+1}function HW(e,t){return Rt(e,t==null?void 0:t.in).getFullYear()}function qW(e){return Math.trunc(e*Md)}function ZW(e){return Math.trunc(e*J4)}function YW(e){return Math.trunc(e*q1)}function XW(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);if(isNaN(+l))throw new TypeError("Start date is invalid");if(isNaN(+d))throw new TypeError("End date is invalid");if(i!=null&&i.assertPositive&&+l>+d)throw new TypeError("End date must be after start date");return{start:l,end:d}}function KW(e,t){const{start:i,end:l}=bc(t==null?void 0:t.in,e),d={},y=xF(l,i);y&&(d.years=y);const S=rp(i,{years:d.years}),R=X1(l,S);R&&(d.months=R);const a=rp(S,{months:d.months}),N=hC(l,a);N&&(d.days=N);const G=rp(a,{days:d.days}),q=t1(l,G);q&&(d.hours=q);const X=rp(G,{hours:d.hours}),oe=r1(l,X);oe&&(d.minutes=oe);const te=rp(X,{minutes:d.minutes}),ie=Ep(l,te);return ie&&(d.seconds=ie),d}function JW(e,t,i){let l;return QW(t)?l=t:i=t,new Intl.DateTimeFormat(i==null?void 0:i.locale,l).format(Rt(e))}function QW(e){return e!==void 0&&!("locale"in e)}function eG(e,t,i){let l=0,d;const[y,S]=Kn(i==null?void 0:i.in,e,t);if(i!=null&&i.unit)d=i==null?void 0:i.unit,d==="second"?l=Ep(y,S):d==="minute"?l=r1(y,S):d==="hour"?l=t1(y,S):d==="day"?l=Dl(y,S):d==="week"?l=e1(y,S):d==="month"?l=Qx(y,S):d==="quarter"?l=gx(y,S):d==="year"&&(l=I_(y,S));else{const a=Ep(y,S);Math.abs(a)<sC?(l=Ep(y,S),d="second"):Math.abs(a)<q1?(l=r1(y,S),d="minute"):Math.abs(a)<lC&&Math.abs(Dl(y,S))<1?(l=t1(y,S),d="hour"):Math.abs(a)<e8&&(l=Dl(y,S))&&Math.abs(l)<7?d="day":Math.abs(a)<nF?(l=e1(y,S),d="week"):Math.abs(a)<t8?(l=Qx(y,S),d="month"):Math.abs(a)<rF&&gx(y,S)<4?(l=gx(y,S),d="quarter"):(l=I_(y,S),d="year")}return new Intl.RelativeTimeFormat(i==null?void 0:i.locale,{numeric:"auto",...i}).format(l,d)}function tG(e,t){return+Rt(e)>+Rt(t)}function rG(e,t){return+Rt(e)<+Rt(t)}function nG(e,t){return+Rt(e)==+Rt(t)}function iG(e,t,i){const l=new Date(e,t,i);return l.getFullYear()===e&&l.getMonth()===t&&l.getDate()===i}function oG(e,t){return Rt(e,t==null?void 0:t.in).getDate()===1}function aG(e,t){return Rt(e,t==null?void 0:t.in).getDay()===5}function sG(e){return+Rt(e)>Date.now()}function zF(e,t){const i=lG(t)?new t(0):Rr(t,0);return i.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),i.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),i}function lG(e){var t;return typeof e=="function"&&((t=e.prototype)==null?void 0:t.constructor)===e}const cG=10;class FF{constructor(){fr(this,"subPriority",0)}validate(t,i){return!0}}class uG extends FF{constructor(t,i,l,d,y){super(),this.value=t,this.validateValue=i,this.setValue=l,this.priority=d,y&&(this.subPriority=y)}validate(t,i){return this.validateValue(t,this.value,i)}set(t,i,l){return this.setValue(t,i,this.value,l)}}class hG extends FF{constructor(i,l){super();fr(this,"priority",cG);fr(this,"subPriority",-1);this.context=i||(d=>Rr(l,d))}set(i,l){return l.timestampIsSet?i:Rr(i,zF(i,this.context))}}class Nn{run(t,i,l,d){const y=this.parse(t,i,l,d);return y?{setter:new uG(y.value,this.validate,this.set,this.priority,this.subPriority),rest:y.rest}:null}validate(t,i,l){return!0}}class dG extends Nn{constructor(){super(...arguments);fr(this,"priority",140);fr(this,"incompatibleTokens",["R","u","t","T"])}parse(i,l,d){switch(l){case"G":case"GG":case"GGG":return d.era(i,{width:"abbreviated"})||d.era(i,{width:"narrow"});case"GGGGG":return d.era(i,{width:"narrow"});case"GGGG":default:return d.era(i,{width:"wide"})||d.era(i,{width:"abbreviated"})||d.era(i,{width:"narrow"})}}set(i,l,d){return l.era=d,i.setFullYear(d,0,1),i.setHours(0,0,0,0),i}}const Vi={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ml={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function $i(e,t){return e&&{value:t(e.value),rest:e.rest}}function Pi(e,t){const i=t.match(e);return i?{value:parseInt(i[0],10),rest:t.slice(i[0].length)}:null}function Cl(e,t){const i=t.match(e);if(!i)return null;if(i[0]==="Z")return{value:0,rest:t.slice(1)};const l=i[1]==="+"?1:-1,d=i[2]?parseInt(i[2],10):0,y=i[3]?parseInt(i[3],10):0,S=i[5]?parseInt(i[5],10):0;return{value:l*(d*Md+y*mc+S*aC),rest:t.slice(i[0].length)}}function BF(e){return Pi(Vi.anyDigitsSigned,e)}function Bi(e,t){switch(e){case 1:return Pi(Vi.singleDigit,t);case 2:return Pi(Vi.twoDigits,t);case 3:return Pi(Vi.threeDigits,t);case 4:return Pi(Vi.fourDigits,t);default:return Pi(new RegExp("^\\d{1,"+e+"}"),t)}}function o1(e,t){switch(e){case 1:return Pi(Vi.singleDigitSigned,t);case 2:return Pi(Vi.twoDigitsSigned,t);case 3:return Pi(Vi.threeDigitsSigned,t);case 4:return Pi(Vi.fourDigitsSigned,t);default:return Pi(new RegExp("^-?\\d{1,"+e+"}"),t)}}function vC(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function NF(e,t){const i=t>0,l=i?t:1-t;let d;if(l<=50)d=e||100;else{const y=l+50,S=Math.trunc(y/100)*100,R=e>=y%100;d=e+S-(R?100:0)}return i?d:1-d}function UF(e){return e%400===0||e%4===0&&e%100!==0}class fG extends Nn{constructor(){super(...arguments);fr(this,"priority",130);fr(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(i,l,d){const y=S=>({year:S,isTwoDigitYear:l==="yy"});switch(l){case"y":return $i(Bi(4,i),y);case"yo":return $i(d.ordinalNumber(i,{unit:"year"}),y);default:return $i(Bi(l.length,i),y)}}validate(i,l){return l.isTwoDigitYear||l.year>0}set(i,l,d){const y=i.getFullYear();if(d.isTwoDigitYear){const R=NF(d.year,y);return i.setFullYear(R,0,1),i.setHours(0,0,0,0),i}const S=!("era"in l)||l.era===1?d.year:1-d.year;return i.setFullYear(S,0,1),i.setHours(0,0,0,0),i}}class pG extends Nn{constructor(){super(...arguments);fr(this,"priority",130);fr(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(i,l,d){const y=S=>({year:S,isTwoDigitYear:l==="YY"});switch(l){case"Y":return $i(Bi(4,i),y);case"Yo":return $i(d.ordinalNumber(i,{unit:"year"}),y);default:return $i(Bi(l.length,i),y)}}validate(i,l){return l.isTwoDigitYear||l.year>0}set(i,l,d,y){const S=J1(i,y);if(d.isTwoDigitYear){const a=NF(d.year,S);return i.setFullYear(a,0,y.firstWeekContainsDate),i.setHours(0,0,0,0),Mo(i,y)}const R=!("era"in l)||l.era===1?d.year:1-d.year;return i.setFullYear(R,0,y.firstWeekContainsDate),i.setHours(0,0,0,0),Mo(i,y)}}class mG extends Nn{constructor(){super(...arguments);fr(this,"priority",130);fr(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(i,l){return o1(l==="R"?4:l.length,i)}set(i,l,d){const y=Rr(i,0);return y.setFullYear(d,0,4),y.setHours(0,0,0,0),Zs(y)}}class gG extends Nn{constructor(){super(...arguments);fr(this,"priority",130);fr(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(i,l){return o1(l==="u"?4:l.length,i)}set(i,l,d){return i.setFullYear(d,0,1),i.setHours(0,0,0,0),i}}class _G extends Nn{constructor(){super(...arguments);fr(this,"priority",120);fr(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(i,l,d){switch(l){case"Q":case"QQ":return Bi(l.length,i);case"Qo":return d.ordinalNumber(i,{unit:"quarter"});case"QQQ":return d.quarter(i,{width:"abbreviated",context:"formatting"})||d.quarter(i,{width:"narrow",context:"formatting"});case"QQQQQ":return d.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return d.quarter(i,{width:"wide",context:"formatting"})||d.quarter(i,{width:"abbreviated",context:"formatting"})||d.quarter(i,{width:"narrow",context:"formatting"})}}validate(i,l){return l>=1&&l<=4}set(i,l,d){return i.setMonth((d-1)*3,1),i.setHours(0,0,0,0),i}}class yG extends Nn{constructor(){super(...arguments);fr(this,"priority",120);fr(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(i,l,d){switch(l){case"q":case"qq":return Bi(l.length,i);case"qo":return d.ordinalNumber(i,{unit:"quarter"});case"qqq":return d.quarter(i,{width:"abbreviated",context:"standalone"})||d.quarter(i,{width:"narrow",context:"standalone"});case"qqqqq":return d.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return d.quarter(i,{width:"wide",context:"standalone"})||d.quarter(i,{width:"abbreviated",context:"standalone"})||d.quarter(i,{width:"narrow",context:"standalone"})}}validate(i,l){return l>=1&&l<=4}set(i,l,d){return i.setMonth((d-1)*3,1),i.setHours(0,0,0,0),i}}class vG extends Nn{constructor(){super(...arguments);fr(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);fr(this,"priority",110)}parse(i,l,d){const y=S=>S-1;switch(l){case"M":return $i(Pi(Vi.month,i),y);case"MM":return $i(Bi(2,i),y);case"Mo":return $i(d.ordinalNumber(i,{unit:"month"}),y);case"MMM":return d.month(i,{width:"abbreviated",context:"formatting"})||d.month(i,{width:"narrow",context:"formatting"});case"MMMMM":return d.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return d.month(i,{width:"wide",context:"formatting"})||d.month(i,{width:"abbreviated",context:"formatting"})||d.month(i,{width:"narrow",context:"formatting"})}}validate(i,l){return l>=0&&l<=11}set(i,l,d){return i.setMonth(d,1),i.setHours(0,0,0,0),i}}class xG extends Nn{constructor(){super(...arguments);fr(this,"priority",110);fr(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(i,l,d){const y=S=>S-1;switch(l){case"L":return $i(Pi(Vi.month,i),y);case"LL":return $i(Bi(2,i),y);case"Lo":return $i(d.ordinalNumber(i,{unit:"month"}),y);case"LLL":return d.month(i,{width:"abbreviated",context:"standalone"})||d.month(i,{width:"narrow",context:"standalone"});case"LLLLL":return d.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return d.month(i,{width:"wide",context:"standalone"})||d.month(i,{width:"abbreviated",context:"standalone"})||d.month(i,{width:"narrow",context:"standalone"})}}validate(i,l){return l>=0&&l<=11}set(i,l,d){return i.setMonth(d,1),i.setHours(0,0,0,0),i}}function jF(e,t,i){const l=Rt(e,i==null?void 0:i.in),d=yC(l,i)-t;return l.setDate(l.getDate()-d*7),Rt(l,i==null?void 0:i.in)}class bG extends Nn{constructor(){super(...arguments);fr(this,"priority",100);fr(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(i,l,d){switch(l){case"w":return Pi(Vi.week,i);case"wo":return d.ordinalNumber(i,{unit:"week"});default:return Bi(l.length,i)}}validate(i,l){return l>=1&&l<=53}set(i,l,d,y){return Mo(jF(i,d,y),y)}}function VF(e,t,i){const l=Rt(e,i==null?void 0:i.in),d=_C(l,i)-t;return l.setDate(l.getDate()-d*7),l}class wG extends Nn{constructor(){super(...arguments);fr(this,"priority",100);fr(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(i,l,d){switch(l){case"I":return Pi(Vi.week,i);case"Io":return d.ordinalNumber(i,{unit:"week"});default:return Bi(l.length,i)}}validate(i,l){return l>=1&&l<=53}set(i,l,d){return Zs(VF(i,d))}}const SG=[31,28,31,30,31,30,31,31,30,31,30,31],TG=[31,29,31,30,31,30,31,31,30,31,30,31];class EG extends Nn{constructor(){super(...arguments);fr(this,"priority",90);fr(this,"subPriority",1);fr(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(i,l,d){switch(l){case"d":return Pi(Vi.date,i);case"do":return d.ordinalNumber(i,{unit:"date"});default:return Bi(l.length,i)}}validate(i,l){const d=i.getFullYear(),y=UF(d),S=i.getMonth();return y?l>=1&&l<=TG[S]:l>=1&&l<=SG[S]}set(i,l,d){return i.setDate(d),i.setHours(0,0,0,0),i}}class MG extends Nn{constructor(){super(...arguments);fr(this,"priority",90);fr(this,"subpriority",1);fr(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(i,l,d){switch(l){case"D":case"DD":return Pi(Vi.dayOfYear,i);case"Do":return d.ordinalNumber(i,{unit:"date"});default:return Bi(l.length,i)}}validate(i,l){const d=i.getFullYear();return UF(d)?l>=1&&l<=366:l>=1&&l<=365}set(i,l,d){return i.setMonth(0,d),i.setHours(0,0,0,0),i}}function eb(e,t,i){var q,X,oe,te;const l=oa(),d=(i==null?void 0:i.weekStartsOn)??((X=(q=i==null?void 0:i.locale)==null?void 0:q.options)==null?void 0:X.weekStartsOn)??l.weekStartsOn??((te=(oe=l.locale)==null?void 0:oe.options)==null?void 0:te.weekStartsOn)??0,y=Rt(e,i==null?void 0:i.in),S=y.getDay(),a=(t%7+7)%7,N=7-d,G=t<0||t>6?t-(S+N)%7:(a+N)%7-(S+N)%7;return Ol(y,G,i)}class CG extends Nn{constructor(){super(...arguments);fr(this,"priority",90);fr(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(i,l,d){switch(l){case"E":case"EE":case"EEE":return d.day(i,{width:"abbreviated",context:"formatting"})||d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"});case"EEEEE":return d.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"});case"EEEE":default:return d.day(i,{width:"wide",context:"formatting"})||d.day(i,{width:"abbreviated",context:"formatting"})||d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"})}}validate(i,l){return l>=0&&l<=6}set(i,l,d,y){return i=eb(i,d,y),i.setHours(0,0,0,0),i}}class IG extends Nn{constructor(){super(...arguments);fr(this,"priority",90);fr(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(i,l,d,y){const S=R=>{const a=Math.floor((R-1)/7)*7;return(R+y.weekStartsOn+6)%7+a};switch(l){case"e":case"ee":return $i(Bi(l.length,i),S);case"eo":return $i(d.ordinalNumber(i,{unit:"day"}),S);case"eee":return d.day(i,{width:"abbreviated",context:"formatting"})||d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"});case"eeeee":return d.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"});case"eeee":default:return d.day(i,{width:"wide",context:"formatting"})||d.day(i,{width:"abbreviated",context:"formatting"})||d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"})}}validate(i,l){return l>=0&&l<=6}set(i,l,d,y){return i=eb(i,d,y),i.setHours(0,0,0,0),i}}class PG extends Nn{constructor(){super(...arguments);fr(this,"priority",90);fr(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(i,l,d,y){const S=R=>{const a=Math.floor((R-1)/7)*7;return(R+y.weekStartsOn+6)%7+a};switch(l){case"c":case"cc":return $i(Bi(l.length,i),S);case"co":return $i(d.ordinalNumber(i,{unit:"day"}),S);case"ccc":return d.day(i,{width:"abbreviated",context:"standalone"})||d.day(i,{width:"short",context:"standalone"})||d.day(i,{width:"narrow",context:"standalone"});case"ccccc":return d.day(i,{width:"narrow",context:"standalone"});case"cccccc":return d.day(i,{width:"short",context:"standalone"})||d.day(i,{width:"narrow",context:"standalone"});case"cccc":default:return d.day(i,{width:"wide",context:"standalone"})||d.day(i,{width:"abbreviated",context:"standalone"})||d.day(i,{width:"short",context:"standalone"})||d.day(i,{width:"narrow",context:"standalone"})}}validate(i,l){return l>=0&&l<=6}set(i,l,d,y){return i=eb(i,d,y),i.setHours(0,0,0,0),i}}function $F(e,t,i){const l=Rt(e,i==null?void 0:i.in),d=OF(l,i),y=t-d;return Ol(l,y,i)}class AG extends Nn{constructor(){super(...arguments);fr(this,"priority",90);fr(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(i,l,d){const y=S=>S===0?7:S;switch(l){case"i":case"ii":return Bi(l.length,i);case"io":return d.ordinalNumber(i,{unit:"day"});case"iii":return $i(d.day(i,{width:"abbreviated",context:"formatting"})||d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"}),y);case"iiiii":return $i(d.day(i,{width:"narrow",context:"formatting"}),y);case"iiiiii":return $i(d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"}),y);case"iiii":default:return $i(d.day(i,{width:"wide",context:"formatting"})||d.day(i,{width:"abbreviated",context:"formatting"})||d.day(i,{width:"short",context:"formatting"})||d.day(i,{width:"narrow",context:"formatting"}),y)}}validate(i,l){return l>=1&&l<=7}set(i,l,d){return i=$F(i,d),i.setHours(0,0,0,0),i}}class DG extends Nn{constructor(){super(...arguments);fr(this,"priority",80);fr(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(i,l,d){switch(l){case"a":case"aa":case"aaa":return d.dayPeriod(i,{width:"abbreviated",context:"formatting"})||d.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaaa":return d.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return d.dayPeriod(i,{width:"wide",context:"formatting"})||d.dayPeriod(i,{width:"abbreviated",context:"formatting"})||d.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,l,d){return i.setHours(vC(d),0,0,0),i}}class RG extends Nn{constructor(){super(...arguments);fr(this,"priority",80);fr(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(i,l,d){switch(l){case"b":case"bb":case"bbb":return d.dayPeriod(i,{width:"abbreviated",context:"formatting"})||d.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbbb":return d.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return d.dayPeriod(i,{width:"wide",context:"formatting"})||d.dayPeriod(i,{width:"abbreviated",context:"formatting"})||d.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,l,d){return i.setHours(vC(d),0,0,0),i}}class kG extends Nn{constructor(){super(...arguments);fr(this,"priority",80);fr(this,"incompatibleTokens",["a","b","t","T"])}parse(i,l,d){switch(l){case"B":case"BB":case"BBB":return d.dayPeriod(i,{width:"abbreviated",context:"formatting"})||d.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBBB":return d.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return d.dayPeriod(i,{width:"wide",context:"formatting"})||d.dayPeriod(i,{width:"abbreviated",context:"formatting"})||d.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,l,d){return i.setHours(vC(d),0,0,0),i}}class OG extends Nn{constructor(){super(...arguments);fr(this,"priority",70);fr(this,"incompatibleTokens",["H","K","k","t","T"])}parse(i,l,d){switch(l){case"h":return Pi(Vi.hour12h,i);case"ho":return d.ordinalNumber(i,{unit:"hour"});default:return Bi(l.length,i)}}validate(i,l){return l>=1&&l<=12}set(i,l,d){const y=i.getHours()>=12;return y&&d<12?i.setHours(d+12,0,0,0):!y&&d===12?i.setHours(0,0,0,0):i.setHours(d,0,0,0),i}}class LG extends Nn{constructor(){super(...arguments);fr(this,"priority",70);fr(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(i,l,d){switch(l){case"H":return Pi(Vi.hour23h,i);case"Ho":return d.ordinalNumber(i,{unit:"hour"});default:return Bi(l.length,i)}}validate(i,l){return l>=0&&l<=23}set(i,l,d){return i.setHours(d,0,0,0),i}}class zG extends Nn{constructor(){super(...arguments);fr(this,"priority",70);fr(this,"incompatibleTokens",["h","H","k","t","T"])}parse(i,l,d){switch(l){case"K":return Pi(Vi.hour11h,i);case"Ko":return d.ordinalNumber(i,{unit:"hour"});default:return Bi(l.length,i)}}validate(i,l){return l>=0&&l<=11}set(i,l,d){return i.getHours()>=12&&d<12?i.setHours(d+12,0,0,0):i.setHours(d,0,0,0),i}}class FG extends Nn{constructor(){super(...arguments);fr(this,"priority",70);fr(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(i,l,d){switch(l){case"k":return Pi(Vi.hour24h,i);case"ko":return d.ordinalNumber(i,{unit:"hour"});default:return Bi(l.length,i)}}validate(i,l){return l>=1&&l<=24}set(i,l,d){const y=d<=24?d%24:d;return i.setHours(y,0,0,0),i}}class BG extends Nn{constructor(){super(...arguments);fr(this,"priority",60);fr(this,"incompatibleTokens",["t","T"])}parse(i,l,d){switch(l){case"m":return Pi(Vi.minute,i);case"mo":return d.ordinalNumber(i,{unit:"minute"});default:return Bi(l.length,i)}}validate(i,l){return l>=0&&l<=59}set(i,l,d){return i.setMinutes(d,0,0),i}}class NG extends Nn{constructor(){super(...arguments);fr(this,"priority",50);fr(this,"incompatibleTokens",["t","T"])}parse(i,l,d){switch(l){case"s":return Pi(Vi.second,i);case"so":return d.ordinalNumber(i,{unit:"second"});default:return Bi(l.length,i)}}validate(i,l){return l>=0&&l<=59}set(i,l,d){return i.setSeconds(d,0),i}}class UG extends Nn{constructor(){super(...arguments);fr(this,"priority",30);fr(this,"incompatibleTokens",["t","T"])}parse(i,l){const d=y=>Math.trunc(y*Math.pow(10,-l.length+3));return $i(Bi(l.length,i),d)}set(i,l,d){return i.setMilliseconds(d),i}}class jG extends Nn{constructor(){super(...arguments);fr(this,"priority",10);fr(this,"incompatibleTokens",["t","T","x"])}parse(i,l){switch(l){case"X":return Cl(Ml.basicOptionalMinutes,i);case"XX":return Cl(Ml.basic,i);case"XXXX":return Cl(Ml.basicOptionalSeconds,i);case"XXXXX":return Cl(Ml.extendedOptionalSeconds,i);case"XXX":default:return Cl(Ml.extended,i)}}set(i,l,d){return l.timestampIsSet?i:Rr(i,i.getTime()-Ea(i)-d)}}class VG extends Nn{constructor(){super(...arguments);fr(this,"priority",10);fr(this,"incompatibleTokens",["t","T","X"])}parse(i,l){switch(l){case"x":return Cl(Ml.basicOptionalMinutes,i);case"xx":return Cl(Ml.basic,i);case"xxxx":return Cl(Ml.basicOptionalSeconds,i);case"xxxxx":return Cl(Ml.extendedOptionalSeconds,i);case"xxx":default:return Cl(Ml.extended,i)}}set(i,l,d){return l.timestampIsSet?i:Rr(i,i.getTime()-Ea(i)-d)}}class $G extends Nn{constructor(){super(...arguments);fr(this,"priority",40);fr(this,"incompatibleTokens","*")}parse(i){return BF(i)}set(i,l,d){return[Rr(i,d*1e3),{timestampIsSet:!0}]}}class WG extends Nn{constructor(){super(...arguments);fr(this,"priority",20);fr(this,"incompatibleTokens","*")}parse(i){return BF(i)}set(i,l,d){return[Rr(i,d),{timestampIsSet:!0}]}}const WF={G:new dG,y:new fG,Y:new pG,R:new mG,u:new gG,Q:new _G,q:new yG,M:new vG,L:new xG,w:new bG,I:new wG,d:new EG,D:new MG,E:new CG,e:new IG,c:new PG,i:new AG,a:new DG,b:new RG,B:new kG,h:new OG,H:new LG,K:new zG,k:new FG,m:new BG,s:new NG,S:new UG,X:new jG,x:new VG,t:new $G,T:new WG},GG=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,HG=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qG=/^'([^]*?)'?$/,ZG=/''/g,YG=/\S/,XG=/[a-zA-Z]/;function GF(e,t,i,l){var pe,se,le,ce,Me,Le,Je,Qe;const d=()=>Rr((l==null?void 0:l.in)||i,NaN),y=kF(),S=(l==null?void 0:l.locale)??y.locale??Xp,R=(l==null?void 0:l.firstWeekContainsDate)??((se=(pe=l==null?void 0:l.locale)==null?void 0:pe.options)==null?void 0:se.firstWeekContainsDate)??y.firstWeekContainsDate??((ce=(le=y.locale)==null?void 0:le.options)==null?void 0:ce.firstWeekContainsDate)??1,a=(l==null?void 0:l.weekStartsOn)??((Le=(Me=l==null?void 0:l.locale)==null?void 0:Me.options)==null?void 0:Le.weekStartsOn)??y.weekStartsOn??((Qe=(Je=y.locale)==null?void 0:Je.options)==null?void 0:Qe.weekStartsOn)??0;if(!t)return e?d():Rt(i,l==null?void 0:l.in);const N={firstWeekContainsDate:R,weekStartsOn:a,locale:S},G=[new hG(l==null?void 0:l.in,i)],q=t.match(HG).map(je=>{const Ct=je[0];if(Ct in i1){const ye=i1[Ct];return ye(je,S.formatLong)}return je}).join("").match(GG),X=[];for(let je of q){!(l!=null&&l.useAdditionalWeekYearTokens)&&CF(je)&&IE(je,t,e),!(l!=null&&l.useAdditionalDayOfYearTokens)&&MF(je)&&IE(je,t,e);const Ct=je[0],ye=WF[Ct];if(ye){const{incompatibleTokens:et}=ye;if(Array.isArray(et)){const Xt=X.find(Mt=>et.includes(Mt.token)||Mt.token===Ct);if(Xt)throw new RangeError(`The format string mustn't contain \`${Xt.fullToken}\` and \`${je}\` at the same time`)}else if(ye.incompatibleTokens==="*"&&X.length>0)throw new RangeError(`The format string mustn't contain \`${je}\` and any other token at the same time`);X.push({token:Ct,fullToken:je});const dt=ye.run(e,je,S.match,N);if(!dt)return d();G.push(dt.setter),e=dt.rest}else{if(Ct.match(XG))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Ct+"`");if(je==="''"?je="'":Ct==="'"&&(je=KG(je)),e.indexOf(je)===0)e=e.slice(je.length);else return d()}}if(e.length>0&&YG.test(e))return d();const oe=G.map(je=>je.priority).sort((je,Ct)=>Ct-je).filter((je,Ct,ye)=>ye.indexOf(je)===Ct).map(je=>G.filter(Ct=>Ct.priority===je).sort((Ct,ye)=>ye.subPriority-Ct.subPriority)).map(je=>je[0]);let te=Rt(i,l==null?void 0:l.in);if(isNaN(+te))return d();const ie={};for(const je of oe){if(!je.validate(te,N))return d();const Ct=je.set(te,ie,N);Array.isArray(Ct)?(te=Ct[0],Object.assign(ie,Ct[1])):te=Ct}return te}function KG(e){return e.match(qG)[1].replace(ZG,"'")}function JG(e,t,i){return gc(GF(e,t,new Date,i))}function QG(e,t){return Rt(e,t==null?void 0:t.in).getDay()===1}function eH(e){return+Rt(e)<Date.now()}function PE(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setMinutes(0,0,0),i}function HF(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return+PE(l)==+PE(d)}function xC(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return+Mo(l,i)==+Mo(d,i)}function qF(e,t,i){return xC(e,t,{...i,weekStartsOn:1})}function tH(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return+Wu(l)==+Wu(d)}function AE(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setSeconds(0,0),i}function ZF(e,t){return+AE(e)==+AE(t)}function YF(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return l.getFullYear()===d.getFullYear()&&l.getMonth()===d.getMonth()}function XF(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return+sd(l)==+sd(d)}function DE(e,t){const i=Rt(e,t==null?void 0:t.in);return i.setMilliseconds(0),i}function KF(e,t){return+DE(e)==+DE(t)}function JF(e,t,i){const[l,d]=Kn(i==null?void 0:i.in,e,t);return l.getFullYear()===d.getFullYear()}function rH(e,t){return HF(Rt(e,t==null?void 0:t.in),Ji((t==null?void 0:t.in)||e))}function nH(e,t){return qF(Rr((t==null?void 0:t.in)||e,e),Ji((t==null?void 0:t.in)||e))}function iH(e){return ZF(e,Ji(e))}function oH(e,t){return YF(Rr((t==null?void 0:t.in)||e,e),Ji((t==null?void 0:t.in)||e))}function aH(e,t){return XF(Rr((t==null?void 0:t.in)||e,e),Ji((t==null?void 0:t.in)||e))}function sH(e){return KF(e,Ji(e))}function lH(e,t){return xC(Rr((t==null?void 0:t.in)||e,e),Ji((t==null?void 0:t.in)||e),t)}function cH(e,t){return JF(Rr((t==null?void 0:t.in)||e,e),Ji((t==null?void 0:t.in)||e))}function uH(e,t){return Rt(e,t==null?void 0:t.in).getDay()===4}function hH(e,t){return by(Rr((t==null?void 0:t.in)||e,e),Ji((t==null?void 0:t.in)||e))}function dH(e,t){return by(e,Ol(Ji((t==null?void 0:t.in)||e),1),t)}function fH(e,t){return Rt(e,t==null?void 0:t.in).getDay()===2}function pH(e,t){return Rt(e,t==null?void 0:t.in).getDay()===3}function mH(e,t,i){const l=+Rt(e,i==null?void 0:i.in),[d,y]=[+Rt(t.start,i==null?void 0:i.in),+Rt(t.end,i==null?void 0:i.in)].sort((S,R)=>S-R);return l>=d&&l<=y}function tb(e,t,i){return Ol(e,-t,i)}function gH(e,t){return by(Rr((t==null?void 0:t.in)||e,e),tb(Ji((t==null?void 0:t.in)||e),1))}function _H(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear(),d=9+Math.floor(l/10)*10;return i.setFullYear(d+1,0,0),i.setHours(0,0,0,0),Rt(i,t==null?void 0:t.in)}function QF(e,t){var R,a,N,G;const i=oa(),l=(t==null?void 0:t.weekStartsOn)??((a=(R=t==null?void 0:t.locale)==null?void 0:R.options)==null?void 0:a.weekStartsOn)??i.weekStartsOn??((G=(N=i.locale)==null?void 0:N.options)==null?void 0:G.weekStartsOn)??0,d=Rt(e,t==null?void 0:t.in),y=d.getDay(),S=(y<l?-7:0)+6-(y-l);return d.setHours(0,0,0,0),d.setDate(d.getDate()+S),d}function yH(e,t){return QF(e,{...t,weekStartsOn:1})}function vH(e,t){const i=$u(e,t),l=Rr((t==null?void 0:t.in)||e,0);l.setFullYear(i+1,0,4),l.setHours(0,0,0,0);const d=Zs(l,t);return d.setDate(d.getDate()-1),d}function xH(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getMonth(),d=l-l%3+3;return i.setMonth(d,0),i.setHours(0,0,0,0),i}function bH(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear();return i.setFullYear(l+1,0,0),i.setHours(0,0,0,0),i}const wH=/(\w)\1*|''|'(''|[^'])+('|$)|./g,SH=/^'([^]*?)'?$/,TH=/''/g,EH=/[a-zA-Z]/;function MH(e,t){const i=Rt(e);if(!gc(i))throw new RangeError("Invalid time value");const l=t.match(wH);return l?l.map(y=>{if(y==="''")return"'";const S=y[0];if(S==="'")return CH(y);const R=wl[S];if(R)return R(i,y);if(S.match(EH))throw new RangeError("Format string contains an unescaped latin alphabet character `"+S+"`");return y}).join(""):""}function CH(e){const t=e.match(SH);return t?t[1].replace(TH,"'"):e}function IH({years:e,months:t,weeks:i,days:l,hours:d,minutes:y,seconds:S}){let R=0;e&&(R+=e*Kx),t&&(R+=t*(Kx/12)),i&&(R+=i*7),l&&(R+=l);let a=R*24*60*60;return d&&(a+=d*60*60),y&&(a+=y*60),S&&(a+=S),Math.trunc(a*1e3)}function PH(e){const t=e/Md;return Math.trunc(t)}function AH(e){const t=e/mc;return Math.trunc(t)}function DH(e){const t=e/aC;return Math.trunc(t)}function RH(e){const t=e/J4;return Math.trunc(t)}function kH(e){return Math.trunc(e*mc)}function OH(e){return Math.trunc(e*sC)}function LH(e){const t=e/Q4;return Math.trunc(t)}function zH(e){const t=e/eF;return Math.trunc(t)}function Qu(e,t,i){let l=t-Q1(e,i);return l<=0&&(l+=7),Ol(e,l,i)}function FH(e,t){return Qu(e,5,t)}function BH(e,t){return Qu(e,1,t)}function NH(e,t){return Qu(e,6,t)}function UH(e,t){return Qu(e,0,t)}function jH(e,t){return Qu(e,4,t)}function VH(e,t){return Qu(e,2,t)}function $H(e,t){return Qu(e,3,t)}function WH(e,t){const i=()=>Rr(t==null?void 0:t.in,NaN),l=(t==null?void 0:t.additionalDigits)??2,d=ZH(e);let y;if(d.date){const N=YH(d.date,l);y=XH(N.restDateString,N.year)}if(!y||isNaN(+y))return i();const S=+y;let R=0,a;if(d.time&&(R=KH(d.time),isNaN(R)))return i();if(d.timezone){if(a=JH(d.timezone),isNaN(a))return i()}else{const N=new Date(S+R),G=Rt(0,t==null?void 0:t.in);return G.setFullYear(N.getUTCFullYear(),N.getUTCMonth(),N.getUTCDate()),G.setHours(N.getUTCHours(),N.getUTCMinutes(),N.getUTCSeconds(),N.getUTCMilliseconds()),G}return Rt(S+R+a,t==null?void 0:t.in)}const $v={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},GH=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,HH=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,qH=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ZH(e){const t={},i=e.split($v.dateTimeDelimiter);let l;if(i.length>2)return t;if(/:/.test(i[0])?l=i[0]:(t.date=i[0],l=i[1],$v.timeZoneDelimiter.test(t.date)&&(t.date=e.split($v.timeZoneDelimiter)[0],l=e.substr(t.date.length,e.length))),l){const d=$v.timezone.exec(l);d?(t.time=l.replace(d[1],""),t.timezone=d[1]):t.time=l}return t}function YH(e,t){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),l=e.match(i);if(!l)return{year:NaN,restDateString:""};const d=l[1]?parseInt(l[1]):null,y=l[2]?parseInt(l[2]):null;return{year:y===null?d:y*100,restDateString:e.slice((l[1]||l[2]).length)}}function XH(e,t){if(t===null)return new Date(NaN);const i=e.match(GH);if(!i)return new Date(NaN);const l=!!i[4],d=r_(i[1]),y=r_(i[2])-1,S=r_(i[3]),R=r_(i[4]),a=r_(i[5])-1;if(l)return nq(t,R,a)?QH(t,R,a):new Date(NaN);{const N=new Date(0);return!tq(t,y,S)||!rq(t,d)?new Date(NaN):(N.setUTCFullYear(t,y,Math.max(d,S)),N)}}function r_(e){return e?parseInt(e):1}function KH(e){const t=e.match(HH);if(!t)return NaN;const i=lT(t[1]),l=lT(t[2]),d=lT(t[3]);return iq(i,l,d)?i*Md+l*mc+d*1e3:NaN}function lT(e){return e&&parseFloat(e.replace(",","."))||0}function JH(e){if(e==="Z")return 0;const t=e.match(qH);if(!t)return 0;const i=t[1]==="+"?-1:1,l=parseInt(t[2]),d=t[3]&&parseInt(t[3])||0;return oq(l,d)?i*(l*Md+d*mc):NaN}function QH(e,t,i){const l=new Date(0);l.setUTCFullYear(e,0,4);const d=l.getUTCDay()||7,y=(t-1)*7+i+1-d;return l.setUTCDate(l.getUTCDate()+y),l}const eq=[31,null,31,30,31,30,31,31,30,31,30,31];function eB(e){return e%400===0||e%4===0&&e%100!==0}function tq(e,t,i){return t>=0&&t<=11&&i>=1&&i<=(eq[t]||(eB(e)?29:28))}function rq(e,t){return t>=1&&t<=(eB(e)?366:365)}function nq(e,t,i){return t>=1&&t<=53&&i>=0&&i<=6}function iq(e,t,i){return e===24?t===0&&i===0:i>=0&&i<60&&t>=0&&t<60&&e>=0&&e<25}function oq(e,t){return t>=0&&t<=59}function aq(e,t){const i=e.match(/(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2})(?:\.(\d{0,7}))?(?:Z|(.)(\d{2}):?(\d{2})?)?/);return Rt(i?Date.UTC(+i[1],+i[2]-1,+i[3],+i[4]-(+i[9]||0)*(i[8]=="-"?-1:1),+i[5]-(+i[10]||0)*(i[8]=="-"?-1:1),+i[6],+((i[7]||"0")+"00").substring(0,3)):NaN,t==null?void 0:t.in)}function eh(e,t,i){let l=Q1(e,i)-t;return l<=0&&(l+=7),tb(e,l,i)}function sq(e,t){return eh(e,5,t)}function lq(e,t){return eh(e,1,t)}function cq(e,t){return eh(e,6,t)}function uq(e,t){return eh(e,0,t)}function hq(e,t){return eh(e,4,t)}function dq(e,t){return eh(e,2,t)}function fq(e,t){return eh(e,3,t)}function pq(e){return Math.trunc(e*Q4)}function mq(e){const t=e/tF;return Math.trunc(t)}function gq(e,t){const i=(t==null?void 0:t.nearestTo)??1;if(i<1||i>12)return Rr((t==null?void 0:t.in)||e,NaN);const l=Rt(e,t==null?void 0:t.in),d=l.getMinutes()/60,y=l.getSeconds()/60/60,S=l.getMilliseconds()/1e3/60/60,R=l.getHours()+d+y+S,a=(t==null?void 0:t.roundingMethod)??"round",G=Ju(a)(R/i)*i;return l.setHours(G,0,0,0),l}function _q(e,t){const i=(t==null?void 0:t.nearestTo)??1;if(i<1||i>30)return Rr(e,NaN);const l=Rt(e,t==null?void 0:t.in),d=l.getSeconds()/60,y=l.getMilliseconds()/1e3/60,S=l.getMinutes()+d+y,R=(t==null?void 0:t.roundingMethod)??"round",N=Ju(R)(S/i)*i;return l.setMinutes(N,0,0),l}function yq(e){const t=e/q1;return Math.trunc(t)}function vq(e){return e*aC}function xq(e){const t=e/sC;return Math.trunc(t)}function bC(e,t,i){const l=Rt(e,i==null?void 0:i.in),d=l.getFullYear(),y=l.getDate(),S=Rr((i==null?void 0:i.in)||e,0);S.setFullYear(d,t,15),S.setHours(0,0,0,0);const R=DF(S);return l.setMonth(t,Math.min(y,R)),l}function bq(e,t,i){let l=Rt(e,i==null?void 0:i.in);return isNaN(+l)?Rr((i==null?void 0:i.in)||e,NaN):(t.year!=null&&l.setFullYear(t.year),t.month!=null&&(l=bC(l,t.month)),t.date!=null&&l.setDate(t.date),t.hours!=null&&l.setHours(t.hours),t.minutes!=null&&l.setMinutes(t.minutes),t.seconds!=null&&l.setSeconds(t.seconds),t.milliseconds!=null&&l.setMilliseconds(t.milliseconds),l)}function wq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setDate(t),l}function Sq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setMonth(0),l.setDate(t),l}function Tq(e){const t={},i=oa();for(const l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l]);for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(e[l]===void 0?delete t[l]:t[l]=e[l]);r8(t)}function Eq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setHours(t),l}function Mq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setMilliseconds(t),l}function Cq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setMinutes(t),l}function Iq(e,t,i){const l=Rt(e,i==null?void 0:i.in),d=Math.trunc(l.getMonth()/3)+1,y=t-d;return bC(l,l.getMonth()+y*3)}function Pq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return l.setSeconds(t),l}function Aq(e,t,i){var a,N,G,q;const l=oa(),d=(i==null?void 0:i.firstWeekContainsDate)??((N=(a=i==null?void 0:i.locale)==null?void 0:a.options)==null?void 0:N.firstWeekContainsDate)??l.firstWeekContainsDate??((q=(G=l.locale)==null?void 0:G.options)==null?void 0:q.firstWeekContainsDate)??1,y=Dl(Rt(e,i==null?void 0:i.in),n1(e,i),i),S=Rr((i==null?void 0:i.in)||e,0);S.setFullYear(t,0,d),S.setHours(0,0,0,0);const R=n1(S,i);return R.setDate(R.getDate()+y),R}function Dq(e,t,i){const l=Rt(e,i==null?void 0:i.in);return isNaN(+l)?Rr((i==null?void 0:i.in)||e,NaN):(l.setFullYear(t),l)}function Rq(e,t){const i=Rt(e,t==null?void 0:t.in),l=i.getFullYear(),d=Math.floor(l/10)*10;return i.setFullYear(d,0,1),i.setHours(0,0,0,0),i}function kq(e){return Fp(Date.now(),e)}function Oq(e){const t=Ji(e==null?void 0:e.in),i=t.getFullYear(),l=t.getMonth(),d=t.getDate(),y=Rr(e==null?void 0:e.in,0);return y.setFullYear(i,l,d+1),y.setHours(0,0,0,0),y}function Lq(e){const t=Ji(e==null?void 0:e.in),i=t.getFullYear(),l=t.getMonth(),d=t.getDate(),y=Ji(e==null?void 0:e.in);return y.setFullYear(i,l,d-1),y.setHours(0,0,0,0),y}function tB(e,t,i){return xy(e,-t,i)}function zq(e,t,i){const{years:l=0,months:d=0,weeks:y=0,days:S=0,hours:R=0,minutes:a=0,seconds:N=0}=t,G=tB(e,d+l*12,i),q=tb(G,S+y*7,i),X=a+R*60,te=(N+X*60)*1e3;return Rr((i==null?void 0:i.in)||e,+q-te)}function Fq(e,t,i){return aF(e,-t,i)}function Bq(e,t,i){return sF(e,-t,i)}function Nq(e,t,i){return Z1(e,-t,i)}function Uq(e,t,i){return cC(e,-t,i)}function jq(e,t,i){return uC(e,-t,i)}function Vq(e,t,i){return hF(e,-t,i)}function $q(e,t,i){return Y1(e,-t,i)}function Wq(e,t,i){return dF(e,-t,i)}function Gq(e){return Math.trunc(e*X4)}function Hq(e){return Math.trunc(e*Kx)}function qq(e){return Math.trunc(e*eF)}function Zq(e){return Math.trunc(e*tF)}const Yq=Object.freeze(Object.defineProperty({__proto__:null,add:rp,addBusinessDays:aF,addDays:Ol,addHours:sF,addISOWeekYears:uF,addMilliseconds:Z1,addMinutes:cC,addMonths:xy,addQuarters:uC,addSeconds:hF,addWeeks:Y1,addYears:dF,areIntervalsOverlapping:n8,clamp:i8,closestIndexTo:mF,closestTo:o8,compareAsc:Rl,compareDesc:a8,constructFrom:Rr,constructNow:Ji,daysToWeeks:s8,differenceInBusinessDays:l8,differenceInCalendarDays:Dl,differenceInCalendarISOWeekYears:_F,differenceInCalendarISOWeeks:c8,differenceInCalendarMonths:Qx,differenceInCalendarQuarters:gx,differenceInCalendarWeeks:e1,differenceInCalendarYears:I_,differenceInDays:hC,differenceInHours:t1,differenceInISOWeekYears:u8,differenceInMilliseconds:dC,differenceInMinutes:r1,differenceInMonths:X1,differenceInQuarters:h8,differenceInSeconds:Ep,differenceInWeeks:d8,differenceInYears:xF,eachDayOfInterval:bF,eachHourOfInterval:f8,eachMinuteOfInterval:p8,eachMonthOfInterval:m8,eachQuarterOfInterval:g8,eachWeekOfInterval:_8,eachWeekendOfInterval:mC,eachWeekendOfMonth:y8,eachWeekendOfYear:v8,eachYearOfInterval:x8,endOfDay:fC,endOfDecade:b8,endOfHour:w8,endOfISOWeek:S8,endOfISOWeekYear:T8,endOfMinute:E8,endOfMonth:pC,endOfQuarter:M8,endOfSecond:C8,endOfToday:I8,endOfTomorrow:P8,endOfWeek:SF,endOfYear:wF,endOfYesterday:A8,format:ty,formatDate:ty,formatDistance:IF,formatDistanceStrict:PF,formatDistanceToNow:xW,formatDistanceToNowStrict:bW,formatDuration:SW,formatISO:TW,formatISO9075:EW,formatISODuration:MW,formatRFC3339:CW,formatRFC7231:AW,formatRelative:DW,formatters:CE,fromUnixTime:RW,getDate:AF,getDay:Q1,getDayOfYear:TF,getDaysInMonth:DF,getDaysInYear:kW,getDecade:OW,getDefaultOptions:kF,getHours:LW,getISODay:OF,getISOWeek:_C,getISOWeekYear:$u,getISOWeeksInYear:zW,getMilliseconds:FW,getMinutes:BW,getMonth:NW,getOverlappingDaysInIntervals:UW,getQuarter:ME,getSeconds:jW,getTime:VW,getUnixTime:$W,getWeek:yC,getWeekOfMonth:WW,getWeekYear:J1,getWeeksInMonth:GW,getYear:HW,hoursToMilliseconds:qW,hoursToMinutes:ZW,hoursToSeconds:YW,interval:XW,intervalToDuration:KW,intlFormat:JW,intlFormatDistance:eG,isAfter:tG,isBefore:rG,isDate:gF,isEqual:nG,isExists:iG,isFirstDayOfMonth:oG,isFriday:aG,isFuture:sG,isLastDayOfMonth:vF,isLeapYear:RF,isMatch:JG,isMonday:QG,isPast:eH,isSameDay:by,isSameHour:HF,isSameISOWeek:qF,isSameISOWeekYear:tH,isSameMinute:ZF,isSameMonth:YF,isSameQuarter:XF,isSameSecond:KF,isSameWeek:xC,isSameYear:JF,isSaturday:iF,isSunday:oF,isThisHour:rH,isThisISOWeek:nH,isThisMinute:iH,isThisMonth:oH,isThisQuarter:aH,isThisSecond:sH,isThisWeek:lH,isThisYear:cH,isThursday:uH,isToday:hH,isTomorrow:dH,isTuesday:fH,isValid:gc,isWednesday:pH,isWeekend:Tp,isWithinInterval:mH,isYesterday:gH,lastDayOfDecade:_H,lastDayOfISOWeek:yH,lastDayOfISOWeekYear:vH,lastDayOfMonth:LF,lastDayOfQuarter:xH,lastDayOfWeek:QF,lastDayOfYear:bH,lightFormat:MH,lightFormatters:wl,longFormatters:i1,max:fF,milliseconds:IH,millisecondsToHours:PH,millisecondsToMinutes:AH,millisecondsToSeconds:DH,min:pF,minutesToHours:RH,minutesToMilliseconds:kH,minutesToSeconds:OH,monthsToQuarters:LH,monthsToYears:zH,nextDay:Qu,nextFriday:FH,nextMonday:BH,nextSaturday:NH,nextSunday:UH,nextThursday:jH,nextTuesday:VH,nextWednesday:$H,parse:GF,parseISO:WH,parseJSON:aq,parsers:WF,previousDay:eh,previousFriday:sq,previousMonday:lq,previousSaturday:cq,previousSunday:uq,previousThursday:hq,previousTuesday:dq,previousWednesday:fq,quartersToMonths:pq,quartersToYears:mq,roundToNearestHours:gq,roundToNearestMinutes:_q,secondsToHours:yq,secondsToMilliseconds:vq,secondsToMinutes:xq,set:bq,setDate:wq,setDay:eb,setDayOfYear:Sq,setDefaultOptions:Tq,setHours:Eq,setISODay:$F,setISOWeek:VF,setISOWeekYear:cF,setMilliseconds:Mq,setMinutes:Cq,setMonth:bC,setQuarter:Iq,setSeconds:Pq,setWeek:jF,setWeekYear:Aq,setYear:Dq,startOfDay:Fp,startOfDecade:Rq,startOfHour:PE,startOfISOWeek:Zs,startOfISOWeekYear:Wu,startOfMinute:AE,startOfMonth:K1,startOfQuarter:sd,startOfSecond:DE,startOfToday:kq,startOfTomorrow:Oq,startOfWeek:Mo,startOfWeekYear:n1,startOfYear:gC,startOfYesterday:Lq,sub:zq,subBusinessDays:Fq,subDays:tb,subHours:Bq,subISOWeekYears:yF,subMilliseconds:Nq,subMinutes:Uq,subMonths:tB,subQuarters:jq,subSeconds:Vq,subWeeks:$q,subYears:Wq,toDate:Rt,transpose:zF,weeksToDays:Gq,yearsToDays:Hq,yearsToMonths:qq,yearsToQuarters:Zq},Symbol.toStringTag,{value:"Module"})),Cd=rM(Yq);Object.defineProperty(pc,"__esModule",{value:!0});pc.rangeShape=pc.default=void 0;var Gh=Xq(we),An=rB(Ya),cT=rB(Ed),ea=Cd;function rB(e){return e&&e.__esModule?e:{default:e}}function nB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(nB=function(l){return l?i:t})(e)}function Xq(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=nB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function RE(){return RE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},RE.apply(this,arguments)}function n_(e,t,i){return t=Kq(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Kq(e){var t=Jq(e,"string");return typeof t=="symbol"?t:String(t)}function Jq(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var l=i.call(e,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class wC extends Gh.Component{constructor(t,i){super(t,i),n_(this,"handleKeyEvent",l=>{const{day:d,onMouseDown:y,onMouseUp:S}=this.props;[13,32].includes(l.keyCode)&&(l.type==="keydown"?y(d):S(d))}),n_(this,"handleMouseEvent",l=>{const{day:d,disabled:y,onPreviewChange:S,onMouseEnter:R,onMouseDown:a,onMouseUp:N}=this.props,G={};if(y){S();return}switch(l.type){case"mouseenter":R(d),S(d),G.hover=!0;break;case"blur":case"mouseleave":G.hover=!1;break;case"mousedown":G.active=!0,a(d);break;case"mouseup":l.stopPropagation(),G.active=!1,N(d);break;case"focus":S(d);break}Object.keys(G).length&&this.setState(G)}),n_(this,"getClassNames",()=>{const{isPassive:l,isToday:d,isWeekend:y,isStartOfWeek:S,isEndOfWeek:R,isStartOfMonth:a,isEndOfMonth:N,disabled:G,styles:q}=this.props;return(0,cT.default)(q.day,{[q.dayPassive]:l,[q.dayDisabled]:G,[q.dayToday]:d,[q.dayWeekend]:y,[q.dayStartOfWeek]:S,[q.dayEndOfWeek]:R,[q.dayStartOfMonth]:a,[q.dayEndOfMonth]:N,[q.dayHovered]:this.state.hover,[q.dayActive]:this.state.active})}),n_(this,"renderPreviewPlaceholder",()=>{const{preview:l,day:d,styles:y}=this.props;if(!l)return null;const S=l.startDate?(0,ea.endOfDay)(l.startDate):null,R=l.endDate?(0,ea.startOfDay)(l.endDate):null,a=(!S||(0,ea.isAfter)(d,S))&&(!R||(0,ea.isBefore)(d,R)),N=!a&&(0,ea.isSameDay)(d,S),G=!a&&(0,ea.isSameDay)(d,R);return Gh.default.createElement("span",{className:(0,cT.default)({[y.dayStartPreview]:N,[y.dayInPreview]:a,[y.dayEndPreview]:G}),style:{color:l.color}})}),n_(this,"renderSelectionPlaceholders",()=>{const{styles:l,ranges:d,day:y}=this.props;return this.props.displayMode==="date"?(0,ea.isSameDay)(this.props.day,this.props.date)?Gh.default.createElement("span",{className:l.selected,style:{color:this.props.color}}):null:d.reduce((R,a)=>{let N=a.startDate,G=a.endDate;N&&G&&(0,ea.isBefore)(G,N)&&([N,G]=[G,N]),N=N?(0,ea.endOfDay)(N):null,G=G?(0,ea.startOfDay)(G):null;const q=(!N||(0,ea.isAfter)(y,N))&&(!G||(0,ea.isBefore)(y,G)),X=!q&&(0,ea.isSameDay)(y,N),oe=!q&&(0,ea.isSameDay)(y,G);return q||X||oe?[...R,{isStartEdge:X,isEndEdge:oe,isInRange:q,...a}]:R},[]).map((R,a)=>Gh.default.createElement("span",{key:a,className:(0,cT.default)({[l.startEdge]:R.isStartEdge,[l.endEdge]:R.isEndEdge,[l.inRange]:R.isInRange}),style:{color:R.color||this.props.color}}))}),this.state={hover:!1,active:!1}}render(){const{dayContentRenderer:t}=this.props;return Gh.default.createElement("button",RE({type:"button",onMouseEnter:this.handleMouseEvent,onMouseLeave:this.handleMouseEvent,onFocus:this.handleMouseEvent,onMouseDown:this.handleMouseEvent,onMouseUp:this.handleMouseEvent,onBlur:this.handleMouseEvent,onPauseCapture:this.handleMouseEvent,onKeyDown:this.handleKeyEvent,onKeyUp:this.handleKeyEvent,className:this.getClassNames(this.props.styles)},this.props.disabled||this.props.isPassive?{tabIndex:-1}:{},{style:{color:this.props.color}}),this.renderSelectionPlaceholders(),this.renderPreviewPlaceholder(),Gh.default.createElement("span",{className:this.props.styles.dayNumber},(t==null?void 0:t(this.props.day))||Gh.default.createElement("span",null,(0,ea.format)(this.props.day,this.props.dayDisplayFormat))))}}wC.defaultProps={};const Qq=pc.rangeShape=An.default.shape({startDate:An.default.object,endDate:An.default.object,color:An.default.string,key:An.default.string,autoFocus:An.default.bool,disabled:An.default.bool,showDateDisplay:An.default.bool});wC.propTypes={day:An.default.object.isRequired,dayDisplayFormat:An.default.string,date:An.default.object,ranges:An.default.arrayOf(Qq),preview:An.default.shape({startDate:An.default.object,endDate:An.default.object,color:An.default.string}),onPreviewChange:An.default.func,previewColor:An.default.string,disabled:An.default.bool,isPassive:An.default.bool,isToday:An.default.bool,isWeekend:An.default.bool,isStartOfWeek:An.default.bool,isEndOfWeek:An.default.bool,isStartOfMonth:An.default.bool,isEndOfMonth:An.default.bool,color:An.default.string,displayMode:An.default.oneOf(["dateRange","date"]),styles:An.default.object,onMouseDown:An.default.func,onMouseUp:An.default.func,onMouseEnter:An.default.func,dayContentRenderer:An.default.func};pc.default=wC;var rb={},wc={};Object.defineProperty(wc,"__esModule",{value:!0});wc.calcFocusDate=r7;wc.findNextRangeIndex=n7;wc.generateStyles=o7;wc.getMonthDisplayRange=i7;var e7=t7(Ed),ac=Cd;function t7(e){return e&&e.__esModule?e:{default:e}}function r7(e,t){const{shownDate:i,date:l,months:d,ranges:y,focusedRange:S,displayMode:R}=t;let a;if(R==="dateRange"){const G=y[S[0]]||{};a={start:G.startDate,end:G.endDate}}else a={start:l,end:l};a.start=(0,ac.startOfMonth)(a.start||new Date),a.end=(0,ac.endOfMonth)(a.end||a.start);const N=a.start||a.end||i||new Date;return e?(0,ac.differenceInCalendarMonths)(a.start,a.end)>d?e:N:i||N}function n7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1;const i=e.findIndex((l,d)=>d>t&&l.autoFocus!==!1&&!l.disabled);return i!==-1?i:e.findIndex(l=>l.autoFocus!==!1&&!l.disabled)}function i7(e,t,i){const l=(0,ac.startOfMonth)(e,t),d=(0,ac.endOfMonth)(e,t),y=(0,ac.startOfWeek)(l,t);let S=(0,ac.endOfWeek)(d,t);return i&&(0,ac.differenceInCalendarDays)(S,y)<=34&&(S=(0,ac.addDays)(S,7)),{start:y,end:S,startDateOfMonth:l,endDateOfMonth:d}}function o7(e){return e.length?e.filter(i=>!!i).reduce((i,l)=>(Object.keys(l).forEach(d=>{i[d]=(0,e7.default)(i[d],l[d])}),i),{}):{}}Object.defineProperty(rb,"__esModule",{value:!0});rb.default=void 0;var rd=aB(we),ni=s7(Ya),iB=aB(pc),Zi=Cd,a7=wc;function s7(e){return e&&e.__esModule?e:{default:e}}function oB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(oB=function(l){return l?i:t})(e)}function aB(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=oB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function kE(){return kE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},kE.apply(this,arguments)}function l7(e,t,i){const l=new Date;return rd.default.createElement("div",{className:e.weekDays},(0,Zi.eachDayOfInterval)({start:(0,Zi.startOfWeek)(l,t),end:(0,Zi.endOfWeek)(l,t)}).map((d,y)=>rd.default.createElement("span",{className:e.weekDay,key:y},(0,Zi.format)(d,i,t))))}class SC extends rd.PureComponent{render(){const t=new Date,{displayMode:i,focusedRange:l,drag:d,styles:y,disabledDates:S,disabledDay:R}=this.props,a=this.props.minDate&&(0,Zi.startOfDay)(this.props.minDate),N=this.props.maxDate&&(0,Zi.endOfDay)(this.props.maxDate),G=(0,a7.getMonthDisplayRange)(this.props.month,this.props.dateOptions,this.props.fixedHeight);let q=this.props.ranges;if(i==="dateRange"&&d.status){let{startDate:oe,endDate:te}=d.range;q=q.map((ie,pe)=>pe!==l[0]?ie:{...ie,startDate:oe,endDate:te})}const X=this.props.showPreview&&!d.disablePreview;return rd.default.createElement("div",{className:y.month,style:this.props.style},this.props.showMonthName?rd.default.createElement("div",{className:y.monthName},(0,Zi.format)(this.props.month,this.props.monthDisplayFormat,this.props.dateOptions)):null,this.props.showWeekDays&&l7(y,this.props.dateOptions,this.props.weekdayDisplayFormat),rd.default.createElement("div",{className:y.days,onMouseLeave:this.props.onMouseLeave},(0,Zi.eachDayOfInterval)({start:G.start,end:G.end}).map((oe,te)=>{const ie=(0,Zi.isSameDay)(oe,G.startDateOfMonth),pe=(0,Zi.isSameDay)(oe,G.endDateOfMonth),se=a&&(0,Zi.isBefore)(oe,a)||N&&(0,Zi.isAfter)(oe,N),le=S.some(Me=>(0,Zi.isSameDay)(Me,oe)),ce=R(oe);return rd.default.createElement(iB.default,kE({},this.props,{ranges:q,day:oe,preview:X?this.props.preview:null,isWeekend:(0,Zi.isWeekend)(oe,this.props.dateOptions),isToday:(0,Zi.isSameDay)(oe,t),isStartOfWeek:(0,Zi.isSameDay)(oe,(0,Zi.startOfWeek)(oe,this.props.dateOptions)),isEndOfWeek:(0,Zi.isSameDay)(oe,(0,Zi.endOfWeek)(oe,this.props.dateOptions)),isStartOfMonth:ie,isEndOfMonth:pe,key:te,disabled:se||le||ce,isPassive:!(0,Zi.isWithinInterval)(oe,{start:G.startDateOfMonth,end:G.endDateOfMonth}),styles:y,onMouseDown:this.props.onDragSelectionStart,onMouseUp:this.props.onDragSelectionEnd,onMouseEnter:this.props.onDragSelectionMove,dragRange:d.range,drag:d.status}))})))}}SC.defaultProps={};SC.propTypes={style:ni.default.object,styles:ni.default.object,month:ni.default.object,drag:ni.default.object,dateOptions:ni.default.object,disabledDates:ni.default.array,disabledDay:ni.default.func,preview:ni.default.shape({startDate:ni.default.object,endDate:ni.default.object}),showPreview:ni.default.bool,displayMode:ni.default.oneOf(["dateRange","date"]),minDate:ni.default.object,maxDate:ni.default.object,ranges:ni.default.arrayOf(iB.rangeShape),focusedRange:ni.default.arrayOf(ni.default.number),onDragSelectionStart:ni.default.func,onDragSelectionEnd:ni.default.func,onDragSelectionMove:ni.default.func,onMouseLeave:ni.default.func,monthDisplayFormat:ni.default.string,weekdayDisplayFormat:ni.default.string,dayDisplayFormat:ni.default.string,showWeekDays:ni.default.bool,showMonthName:ni.default.bool,fixedHeight:ni.default.bool};rb.default=SC;var nb={};Object.defineProperty(nb,"__esModule",{value:!0});nb.default=void 0;var Wv=u7(we),_l=sB(Ya),c7=sB(Ed),i_=Cd;function sB(e){return e&&e.__esModule?e:{default:e}}function lB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(lB=function(l){return l?i:t})(e)}function u7(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=lB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function uT(e,t,i){return t=h7(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h7(e){var t=d7(e,"string");return typeof t=="symbol"?t:String(t)}function d7(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var l=i.call(e,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class TC extends Wv.PureComponent{constructor(t,i){super(t,i),uT(this,"onKeyDown",l=>{const{value:d}=this.state;l.key==="Enter"&&this.update(d)}),uT(this,"onChange",l=>{this.setState({value:l.target.value,changed:!0,invalid:!1})}),uT(this,"onBlur",()=>{const{value:l}=this.state;this.update(l)}),this.state={invalid:!1,changed:!1,value:this.formatDate(t)}}componentDidUpdate(t){const{value:i}=t;(0,i_.isEqual)(i,this.props.value)||this.setState({value:this.formatDate(this.props)})}formatDate(t){let{value:i,dateDisplayFormat:l,dateOptions:d}=t;return i&&(0,i_.isValid)(i)?(0,i_.format)(i,l,d):""}update(t){const{invalid:i,changed:l}=this.state;if(i||!l||!t)return;const{onChange:d,dateDisplayFormat:y,dateOptions:S}=this.props,R=(0,i_.parse)(t,y,new Date,S);(0,i_.isValid)(R)?this.setState({changed:!1},()=>d(R)):this.setState({invalid:!0})}render(){const{className:t,readOnly:i,placeholder:l,ariaLabel:d,disabled:y,onFocus:S}=this.props,{value:R,invalid:a}=this.state;return Wv.default.createElement("span",{className:(0,c7.default)("rdrDateInput",t)},Wv.default.createElement("input",{readOnly:i,disabled:y,value:R,placeholder:l,"aria-label":d,onKeyDown:this.onKeyDown,onChange:this.onChange,onBlur:this.onBlur,onFocus:S}),a&&Wv.default.createElement("span",{className:"rdrWarning"},"⚠"))}}TC.propTypes={value:_l.default.object,placeholder:_l.default.string,disabled:_l.default.bool,readOnly:_l.default.bool,dateOptions:_l.default.object,dateDisplayFormat:_l.default.string,ariaLabel:_l.default.string,className:_l.default.string,onFocus:_l.default.func.isRequired,onChange:_l.default.func.isRequired};TC.defaultProps={readOnly:!0,disabled:!1,dateDisplayFormat:"MMM D, YYYY"};nb.default=TC;var cB={exports:{}};(function(e,t){(function(i,l){l(Ya,we)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:BO,function(i,l){i=a(i),l=R(l);var d,y;function S(){if(typeof WeakMap!="function")return null;var ct=new WeakMap;return S=function(){return ct},ct}function R(ct){if(ct&&ct.__esModule)return ct;if(ct===null||N(ct)!=="object"&&typeof ct!="function")return{default:ct};var $t=S();if($t&&$t.has(ct))return $t.get(ct);var Ht={},Bt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var It in ct)if(Object.prototype.hasOwnProperty.call(ct,It)){var qt=Bt?Object.getOwnPropertyDescriptor(ct,It):null;qt&&(qt.get||qt.set)?Object.defineProperty(Ht,It,qt):Ht[It]=ct[It]}return Ht.default=ct,$t&&$t.set(ct,Ht),Ht}function a(ct){return ct&&ct.__esModule?ct:{default:ct}}function N(ct){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?N=function(Ht){return typeof Ht}:N=function(Ht){return Ht&&typeof Symbol=="function"&&Ht.constructor===Symbol&&Ht!==Symbol.prototype?"symbol":typeof Ht},N(ct)}function G(ct,$t){if(!(ct instanceof $t))throw new TypeError("Cannot call a class as a function")}function q(ct,$t){for(var Ht=0;Ht<$t.length;Ht++){var Bt=$t[Ht];Bt.enumerable=Bt.enumerable||!1,Bt.configurable=!0,"value"in Bt&&(Bt.writable=!0),Object.defineProperty(ct,Bt.key,Bt)}}function X(ct,$t,Ht){return $t&&q(ct.prototype,$t),Ht&&q(ct,Ht),ct}function oe(ct,$t){if(typeof $t!="function"&&$t!==null)throw new TypeError("Super expression must either be null or a function");ct.prototype=Object.create($t&&$t.prototype,{constructor:{value:ct,writable:!0,configurable:!0}}),$t&&te(ct,$t)}function te(ct,$t){return te=Object.setPrototypeOf||function(Bt,It){return Bt.__proto__=It,Bt},te(ct,$t)}function ie(ct){var $t=le();return function(){var Bt=ce(ct),It;if($t){var qt=ce(this).constructor;It=Reflect.construct(Bt,arguments,qt)}else It=Bt.apply(this,arguments);return pe(this,It)}}function pe(ct,$t){return $t&&(N($t)==="object"||typeof $t=="function")?$t:se(ct)}function se(ct){if(ct===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ct}function le(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function ce(ct){return ce=Object.setPrototypeOf?Object.getPrototypeOf:function(Ht){return Ht.__proto__||Object.getPrototypeOf(Ht)},ce(ct)}function Me(ct,$t){var Ht=Object.keys(ct);if(Object.getOwnPropertySymbols){var Bt=Object.getOwnPropertySymbols(ct);$t&&(Bt=Bt.filter(function(It){return Object.getOwnPropertyDescriptor(ct,It).enumerable})),Ht.push.apply(Ht,Bt)}return Ht}function Le(ct){for(var $t=1;$t<arguments.length;$t++){var Ht=arguments[$t]!=null?arguments[$t]:{};$t%2?Me(Object(Ht),!0).forEach(function(Bt){Je(ct,Bt,Ht[Bt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ct,Object.getOwnPropertyDescriptors(Ht)):Me(Object(Ht)).forEach(function(Bt){Object.defineProperty(ct,Bt,Object.getOwnPropertyDescriptor(Ht,Bt))})}return ct}function Je(ct,$t,Ht){return $t in ct?Object.defineProperty(ct,$t,{value:Ht,enumerable:!0,configurable:!0,writable:!0}):ct[$t]=Ht,ct}var Qe={x:"clientWidth",y:"clientHeight"},je={x:"clientTop",y:"clientLeft"},Ct={x:"innerWidth",y:"innerHeight"},ye={x:"offsetWidth",y:"offsetHeight"},et={x:"offsetLeft",y:"offsetTop"},dt={x:"overflowX",y:"overflowY"},Xt={x:"scrollWidth",y:"scrollHeight"},Mt={x:"scrollLeft",y:"scrollTop"},yt={x:"width",y:"height"},gt=function(){},Ze=function(){if(typeof window>"u")return!1;var ct=!1;try{document.createElement("div").addEventListener("test",gt,{get passive(){return ct=!0,!1}})}catch{}return ct}()?{passive:!0}:!1,ht="ReactList failed to reach a stable state.",Dt=40,Tt=function($t,Ht){for(var Bt in Ht)if($t[Bt]!==Ht[Bt])return!1;return!0},tr=function($t){for(var Ht=$t.props.axis,Bt=$t.getEl(),It=dt[Ht];Bt=Bt.parentElement;)switch(window.getComputedStyle(Bt)[It]){case"auto":case"scroll":case"overlay":return Bt}return window},Vr=function($t){var Ht=$t.props.axis,Bt=$t.scrollParent;return Bt===window?window[Ct[Ht]]:Bt[Qe[Ht]]},Nr=function($t,Ht){var Bt=$t.length,It=$t.minSize,qt=$t.type,Wt=Ht.from,be=Ht.size,er=Ht.itemsPerRow;be=Math.max(be,It);var cr=be%er;return cr&&(be+=er-cr),be>Bt&&(be=Bt),Wt=qt==="simple"||!Wt?0:Math.max(Math.min(Wt,Bt-be),0),(cr=Wt%er)&&(Wt-=cr,be+=cr),Wt===Ht.from&&be==Ht.size?Ht:Le(Le({},Ht),{},{from:Wt,size:be})};e.exports=(y=d=function(ct){oe(Ht,ct);var $t=ie(Ht);X(Ht,null,[{key:"getDerivedStateFromProps",value:function(It,qt){var Wt=Nr(It,qt);return Wt===qt?null:Wt}}]);function Ht(Bt){var It;return G(this,Ht),It=$t.call(this,Bt),It.state=Nr(Bt,{itemsPerRow:1,from:Bt.initialIndex,size:0}),It.cache={},It.cachedScrollPosition=null,It.prevPrevState={},It.unstable=!1,It.updateCounter=0,It}return X(Ht,[{key:"componentDidMount",value:function(){this.updateFrameAndClearCache=this.updateFrameAndClearCache.bind(this),window.addEventListener("resize",this.updateFrameAndClearCache),this.updateFrame(this.scrollTo.bind(this,this.props.initialIndex))}},{key:"componentDidUpdate",value:function(It){var qt=this;if(this.props.axis!==It.axis&&this.clearSizeCache(),!this.unstable){if(++this.updateCounter>Dt)return this.unstable=!0,console.error(ht);this.updateCounterTimeoutId||(this.updateCounterTimeoutId=setTimeout(function(){qt.updateCounter=0,delete qt.updateCounterTimeoutId},0)),this.updateFrame()}}},{key:"maybeSetState",value:function(It,qt){if(Tt(this.state,It))return qt();this.setState(It,qt)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateFrameAndClearCache),this.scrollParent.removeEventListener("scroll",this.updateFrameAndClearCache,Ze),this.scrollParent.removeEventListener("mousewheel",gt,Ze)}},{key:"getOffset",value:function(It){var qt=this.props.axis,Wt=It[je[qt]]||0,be=et[qt];do Wt+=It[be]||0;while(It=It.offsetParent);return Wt}},{key:"getEl",value:function(){return this.el||this.items}},{key:"getScrollPosition",value:function(){if(typeof this.cachedScrollPosition=="number")return this.cachedScrollPosition;var It=this.scrollParent,qt=this.props.axis,Wt=Mt[qt],be=It===window?document.body[Wt]||document.documentElement[Wt]:It[Wt],er=this.getScrollSize()-this.props.scrollParentViewportSizeGetter(this),cr=Math.max(0,Math.min(be,er)),pr=this.getEl();return this.cachedScrollPosition=this.getOffset(It)+cr-this.getOffset(pr),this.cachedScrollPosition}},{key:"setScroll",value:function(It){var qt=this.scrollParent,Wt=this.props.axis;if(It+=this.getOffset(this.getEl()),qt===window)return window.scrollTo(0,It);It-=this.getOffset(this.scrollParent),qt[Mt[Wt]]=It}},{key:"getScrollSize",value:function(){var It=this.scrollParent,qt=document,Wt=qt.body,be=qt.documentElement,er=Xt[this.props.axis];return It===window?Math.max(Wt[er],be[er]):It[er]}},{key:"hasDeterminateSize",value:function(){var It=this.props,qt=It.itemSizeGetter,Wt=It.type;return Wt==="uniform"||qt}},{key:"getStartAndEnd",value:function(){var It=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props.threshold,qt=this.getScrollPosition(),Wt=Math.max(0,qt-It),be=qt+this.props.scrollParentViewportSizeGetter(this)+It;return this.hasDeterminateSize()&&(be=Math.min(be,this.getSpaceBefore(this.props.length))),{start:Wt,end:be}}},{key:"getItemSizeAndItemsPerRow",value:function(){var It=this.props,qt=It.axis,Wt=It.useStaticSize,be=this.state,er=be.itemSize,cr=be.itemsPerRow;if(Wt&&er&&cr)return{itemSize:er,itemsPerRow:cr};var pr=this.items.children;if(!pr.length)return{};var lt=pr[0],Lr=lt[ye[qt]],br=Math.abs(Lr-er);if((isNaN(br)||br>=1)&&(er=Lr),!er)return{};var Kr=et[qt],sr=lt[Kr];cr=1;for(var Hr=pr[cr];Hr&&Hr[Kr]===sr;Hr=pr[cr])++cr;return{itemSize:er,itemsPerRow:cr}}},{key:"clearSizeCache",value:function(){this.cachedScrollPosition=null}},{key:"updateFrameAndClearCache",value:function(It){return this.clearSizeCache(),this.updateFrame(It)}},{key:"updateFrame",value:function(It){switch(this.updateScrollParent(),typeof It!="function"&&(It=gt),this.props.type){case"simple":return this.updateSimpleFrame(It);case"variable":return this.updateVariableFrame(It);case"uniform":return this.updateUniformFrame(It)}}},{key:"updateScrollParent",value:function(){var It=this.scrollParent;this.scrollParent=this.props.scrollParentGetter(this),It!==this.scrollParent&&(It&&(It.removeEventListener("scroll",this.updateFrameAndClearCache),It.removeEventListener("mousewheel",gt)),this.clearSizeCache(),this.scrollParent.addEventListener("scroll",this.updateFrameAndClearCache,Ze),this.scrollParent.addEventListener("mousewheel",gt,Ze))}},{key:"updateSimpleFrame",value:function(It){var qt=this.getStartAndEnd(),Wt=qt.end,be=this.items.children,er=0;if(be.length){var cr=this.props.axis,pr=be[0],lt=be[be.length-1];er=this.getOffset(lt)+lt[ye[cr]]-this.getOffset(pr)}if(er>Wt)return It();var Lr=this.props,br=Lr.pageSize,Kr=Lr.length,sr=Math.min(this.state.size+br,Kr);this.maybeSetState({size:sr},It)}},{key:"updateVariableFrame",value:function(It){this.props.itemSizeGetter||this.cacheSizes();for(var qt=this.getStartAndEnd(),Wt=qt.start,be=qt.end,er=this.props,cr=er.length,pr=er.pageSize,lt=0,Lr=0,br=0,Kr=cr-1;Lr<Kr;){var sr=this.getSizeOfItem(Lr);if(sr==null||lt+sr>Wt)break;lt+=sr,++Lr}for(var Hr=cr-Lr;br<Hr&&lt<be;){var mn=this.getSizeOfItem(Lr+br);if(mn==null){br=Math.min(br+pr,Hr);break}lt+=mn,++br}this.maybeSetState(Nr(this.props,{from:Lr,itemsPerRow:1,size:br}),It)}},{key:"updateUniformFrame",value:function(It){var qt=this.getItemSizeAndItemsPerRow(),Wt=qt.itemSize,be=qt.itemsPerRow;if(!Wt||!be)return It();var er=this.getStartAndEnd(),cr=er.start,pr=er.end,lt=Nr(this.props,{from:Math.floor(cr/Wt)*be,size:(Math.ceil((pr-cr)/Wt)+1)*be,itemsPerRow:be}),Lr=lt.from,br=lt.size;return this.maybeSetState({itemsPerRow:be,from:Lr,itemSize:Wt,size:br},It)}},{key:"getSpaceBefore",value:function(It){var qt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(qt[It]!=null)return qt[It];var Wt=this.state,be=Wt.itemSize,er=Wt.itemsPerRow;if(be)return qt[It]=Math.floor(It/er)*be;for(var cr=It;cr>0&&qt[--cr]==null;);for(var pr=qt[cr]||0,lt=cr;lt<It;++lt){qt[lt]=pr;var Lr=this.getSizeOfItem(lt);if(Lr==null)break;pr+=Lr}return qt[It]=pr}},{key:"cacheSizes",value:function(){for(var It=this.cache,qt=this.state.from,Wt=this.items.children,be=ye[this.props.axis],er=0,cr=Wt.length;er<cr;++er)It[qt+er]=Wt[er][be]}},{key:"getSizeOfItem",value:function(It){var qt=this.cache,Wt=this.items,be=this.props,er=be.axis,cr=be.itemSizeGetter,pr=be.itemSizeEstimator,lt=be.type,Lr=this.state,br=Lr.from,Kr=Lr.itemSize,sr=Lr.size;if(Kr)return Kr;if(cr)return cr(It);if(It in qt)return qt[It];if(lt==="simple"&&It>=br&&It<br+sr&&Wt){var Hr=Wt.children[It-br];if(Hr)return Hr[ye[er]]}if(pr)return pr(It,qt)}},{key:"scrollTo",value:function(It){It!=null&&this.setScroll(this.getSpaceBefore(It))}},{key:"scrollAround",value:function(It){var qt=this.getScrollPosition(),Wt=this.getSpaceBefore(It),be=Wt-this.props.scrollParentViewportSizeGetter(this)+this.getSizeOfItem(It),er=Math.min(be,Wt),cr=Math.max(be,Wt);if(qt<=er)return this.setScroll(er);if(qt>cr)return this.setScroll(cr)}},{key:"getVisibleRange",value:function(){for(var It=this.state,qt=It.from,Wt=It.size,be=this.getStartAndEnd(0),er=be.start,cr=be.end,pr={},lt,Lr,br=qt;br<qt+Wt;++br){var Kr=this.getSpaceBefore(br,pr),sr=Kr+this.getSizeOfItem(br);lt==null&&sr>er&&(lt=br),lt!=null&&Kr<cr&&(Lr=br)}return[lt,Lr]}},{key:"renderItems",value:function(){for(var It=this,qt=this.props,Wt=qt.itemRenderer,be=qt.itemsRenderer,er=this.state,cr=er.from,pr=er.size,lt=[],Lr=0;Lr<pr;++Lr)lt.push(Wt(cr+Lr,Lr));return be(lt,function(br){return It.items=br})}},{key:"render",value:function(){var It=this,qt=this.props,Wt=qt.axis,be=qt.length,er=qt.type,cr=qt.useTranslate3d,pr=this.state,lt=pr.from,Lr=pr.itemsPerRow,br=this.renderItems();if(er==="simple")return br;var Kr={position:"relative"},sr={},Hr=Math.ceil(be/Lr)*Lr,mn=this.getSpaceBefore(Hr,sr);mn&&(Kr[yt[Wt]]=mn,Wt==="x"&&(Kr.overflowX="hidden"));var Er=this.getSpaceBefore(lt,sr),Gi=Wt==="x"?Er:0,ai=Wt==="y"?Er:0,hr=cr?"translate3d(".concat(Gi,"px, ").concat(ai,"px, 0)"):"translate(".concat(Gi,"px, ").concat(ai,"px)"),Po={msTransform:hr,WebkitTransform:hr,transform:hr};return l.default.createElement("div",{style:Kr,ref:function(so){return It.el=so}},l.default.createElement("div",{style:Po},br))}}]),Ht}(l.Component),Je(d,"displayName","ReactList"),Je(d,"propTypes",{axis:i.default.oneOf(["x","y"]),initialIndex:i.default.number,itemRenderer:i.default.func,itemSizeEstimator:i.default.func,itemSizeGetter:i.default.func,itemsRenderer:i.default.func,length:i.default.number,minSize:i.default.number,pageSize:i.default.number,scrollParentGetter:i.default.func,scrollParentViewportSizeGetter:i.default.func,threshold:i.default.number,type:i.default.oneOf(["simple","variable","uniform"]),useStaticSize:i.default.bool,useTranslate3d:i.default.bool}),Je(d,"defaultProps",{axis:"y",itemRenderer:function($t,Ht){return l.default.createElement("div",{key:Ht},$t)},itemsRenderer:function($t,Ht){return l.default.createElement("div",{ref:Ht},$t)},length:0,minSize:1,pageSize:10,scrollParentGetter:tr,scrollParentViewportSizeGetter:Vr,threshold:100,type:"simple",useStaticSize:!1,useTranslate3d:!1}),y)})})(cB);var f7=cB.exports;function p7(e,t){if(e===t)return!0;if(!e||!t)return!1;var i=Object.keys(e),l=Object.keys(t),d=i.length;if(l.length!==d)return!1;for(var y=0;y<d;y++){var S=i[y];if(e[S]!==t[S]||!Object.prototype.hasOwnProperty.call(t,S))return!1}return!0}function m7(e,t){if(e===t)return!0;if(!e||!t)return!1;var i=e.length;if(t.length!==i)return!1;for(var l=0;l<i;l++)if(e[l]!==t[l])return!1;return!0}const g7=Object.freeze(Object.defineProperty({__proto__:null,shallowEqualArrays:m7,shallowEqualObjects:p7},Symbol.toStringTag,{value:"Module"})),_7=rM(g7);var EC={},MC={};MC.formatDistance=void 0;const y7={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},v7=(e,t,i)=>{let l;const d=y7[e];return typeof d=="string"?l=d:t===1?l=d.one:l=d.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+l:l+" ago":l};MC.formatDistance=v7;var CC={},uB={};uB.buildFormatLongFn=x7;function x7(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}CC.formatLong=void 0;var hT=uB;const b7={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},w7={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},S7={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"};CC.formatLong={date:(0,hT.buildFormatLongFn)({formats:b7,defaultWidth:"full"}),time:(0,hT.buildFormatLongFn)({formats:w7,defaultWidth:"full"}),dateTime:(0,hT.buildFormatLongFn)({formats:S7,defaultWidth:"full"})};var IC={};IC.formatRelative=void 0;const T7={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},E7=(e,t,i,l)=>T7[e];IC.formatRelative=E7;var PC={},hB={};hB.buildLocalizeFn=M7;function M7(e){return(t,i)=>{const l=i!=null&&i.context?String(i.context):"standalone";let d;if(l==="formatting"&&e.formattingValues){const S=e.defaultFormattingWidth||e.defaultWidth,R=i!=null&&i.width?String(i.width):S;d=e.formattingValues[R]||e.formattingValues[S]}else{const S=e.defaultWidth,R=i!=null&&i.width?String(i.width):e.defaultWidth;d=e.values[R]||e.values[S]}const y=e.argumentCallback?e.argumentCallback(t):t;return d[y]}}PC.localize=void 0;var o_=hB;const C7={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},I7={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},P7={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},A7={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},D7={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},R7={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},k7=(e,t)=>{const i=Number(e),l=i%100;if(l>20||l<10)switch(l%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"};PC.localize={ordinalNumber:k7,era:(0,o_.buildLocalizeFn)({values:C7,defaultWidth:"wide"}),quarter:(0,o_.buildLocalizeFn)({values:I7,defaultWidth:"wide",argumentCallback:e=>e-1}),month:(0,o_.buildLocalizeFn)({values:P7,defaultWidth:"wide"}),day:(0,o_.buildLocalizeFn)({values:A7,defaultWidth:"wide"}),dayPeriod:(0,o_.buildLocalizeFn)({values:D7,defaultWidth:"wide",formattingValues:R7,defaultFormattingWidth:"wide"})};var AC={},dB={};dB.buildMatchFn=O7;function O7(e){return(t,i={})=>{const l=i.width,d=l&&e.matchPatterns[l]||e.matchPatterns[e.defaultMatchWidth],y=t.match(d);if(!y)return null;const S=y[0],R=l&&e.parsePatterns[l]||e.parsePatterns[e.defaultParseWidth],a=Array.isArray(R)?z7(R,q=>q.test(S)):L7(R,q=>q.test(S));let N;N=e.valueCallback?e.valueCallback(a):a,N=i.valueCallback?i.valueCallback(N):N;const G=t.slice(S.length);return{value:N,rest:G}}}function L7(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i}function z7(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i}var fB={};fB.buildMatchPatternFn=F7;function F7(e){return(t,i={})=>{const l=t.match(e.matchPattern);if(!l)return null;const d=l[0],y=t.match(e.parsePattern);if(!y)return null;let S=e.valueCallback?e.valueCallback(y[0]):y[0];S=i.valueCallback?i.valueCallback(S):S;const R=t.slice(d.length);return{value:S,rest:R}}}AC.match=void 0;var a_=dB,B7=fB;const N7=/^(\d+)(th|st|nd|rd)?/i,U7=/\d+/i,j7={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},V7={any:[/^b/i,/^(a|c)/i]},$7={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},W7={any:[/1/i,/2/i,/3/i,/4/i]},G7={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},H7={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},q7={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Z7={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Y7={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},X7={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}};AC.match={ordinalNumber:(0,B7.buildMatchPatternFn)({matchPattern:N7,parsePattern:U7,valueCallback:e=>parseInt(e,10)}),era:(0,a_.buildMatchFn)({matchPatterns:j7,defaultMatchWidth:"wide",parsePatterns:V7,defaultParseWidth:"any"}),quarter:(0,a_.buildMatchFn)({matchPatterns:$7,defaultMatchWidth:"wide",parsePatterns:W7,defaultParseWidth:"any",valueCallback:e=>e+1}),month:(0,a_.buildMatchFn)({matchPatterns:G7,defaultMatchWidth:"wide",parsePatterns:H7,defaultParseWidth:"any"}),day:(0,a_.buildMatchFn)({matchPatterns:q7,defaultMatchWidth:"wide",parsePatterns:Z7,defaultParseWidth:"any"}),dayPeriod:(0,a_.buildMatchFn)({matchPatterns:Y7,defaultMatchWidth:"any",parsePatterns:X7,defaultParseWidth:"any"})};EC.enUS=void 0;var K7=MC,J7=CC,Q7=IC,e9=PC,t9=AC;EC.enUS={code:"en-US",formatDistance:K7.formatDistance,formatLong:J7.formatLong,formatRelative:Q7.formatRelative,localize:e9.localize,match:t9.match,options:{weekStartsOn:0,firstWeekContainsDate:1}};var Id={};Object.defineProperty(Id,"__esModule",{value:!0});Id.default=void 0;Id.default={dateRangeWrapper:"rdrDateRangeWrapper",calendarWrapper:"rdrCalendarWrapper",dateDisplay:"rdrDateDisplay",dateDisplayItem:"rdrDateDisplayItem",dateDisplayItemActive:"rdrDateDisplayItemActive",monthAndYearWrapper:"rdrMonthAndYearWrapper",monthAndYearPickers:"rdrMonthAndYearPickers",nextPrevButton:"rdrNextPrevButton",month:"rdrMonth",weekDays:"rdrWeekDays",weekDay:"rdrWeekDay",days:"rdrDays",day:"rdrDay",dayNumber:"rdrDayNumber",dayPassive:"rdrDayPassive",dayToday:"rdrDayToday",dayStartOfWeek:"rdrDayStartOfWeek",dayEndOfWeek:"rdrDayEndOfWeek",daySelected:"rdrDaySelected",dayDisabled:"rdrDayDisabled",dayStartOfMonth:"rdrDayStartOfMonth",dayEndOfMonth:"rdrDayEndOfMonth",dayWeekend:"rdrDayWeekend",dayStartPreview:"rdrDayStartPreview",dayInPreview:"rdrDayInPreview",dayEndPreview:"rdrDayEndPreview",dayHovered:"rdrDayHovered",dayActive:"rdrDayActive",inRange:"rdrInRange",endEdge:"rdrEndEdge",startEdge:"rdrStartEdge",prevButton:"rdrPprevButton",nextButton:"rdrNextButton",selected:"rdrSelected",months:"rdrMonths",monthPicker:"rdrMonthPicker",yearPicker:"rdrYearPicker",dateDisplayWrapper:"rdrDateDisplayWrapper",definedRangesWrapper:"rdrDefinedRangesWrapper",staticRanges:"rdrStaticRanges",staticRange:"rdrStaticRange",inputRanges:"rdrInputRanges",inputRange:"rdrInputRange",inputRangeInput:"rdrInputRangeInput",dateRangePickerWrapper:"rdrDateRangePickerWrapper",staticRangeLabel:"rdrStaticRangeLabel",staticRangeSelected:"rdrStaticRangeSelected",monthName:"rdrMonthName",infiniteMonths:"rdrInfiniteMonths",monthsVertical:"rdrMonthsVertical",monthsHorizontal:"rdrMonthsHorizontal"};var ib={};Object.defineProperty(ib,"__esModule",{value:!0});ib.ariaLabelsShape=void 0;var tc=r9(Ya);function r9(e){return e&&e.__esModule?e:{default:e}}ib.ariaLabelsShape=tc.default.shape({dateInput:tc.default.objectOf(tc.default.shape({startDate:tc.default.string,endDate:tc.default.string})),monthPicker:tc.default.string,yearPicker:tc.default.string,prevButton:tc.default.string,nextButton:tc.default.string});Object.defineProperty(yy,"__esModule",{value:!0});yy.default=void 0;var Xn=c9(we),Wr=Kp(Ya),n9=pc,bk=Kp(rb),wk=Kp(nb),Gv=wc,Hh=Kp(Ed),i9=Kp(f7),o9=_7,gi=Cd,a9=EC,s9=Kp(Id),l9=ib;function Kp(e){return e&&e.__esModule?e:{default:e}}function pB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(pB=function(l){return l?i:t})(e)}function c9(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=pB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function a1(){return a1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},a1.apply(this,arguments)}function us(e,t,i){return t=u9(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u9(e){var t=h9(e,"string");return typeof t=="symbol"?t:String(t)}function h9(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var l=i.call(e,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class Bp extends Xn.PureComponent{constructor(t,i){var l;super(t,i),l=this,us(this,"focusToDate",function(d){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.props,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!y.scroll.enabled){if(S&&y.preventSnapRefocus){const N=(0,gi.differenceInCalendarMonths)(d,l.state.focusedDate),G=y.calendarFocus==="forwards"&&N>=0,q=y.calendarFocus==="backwards"&&N<=0;if((G||q)&&Math.abs(N)<y.months)return}l.setState({focusedDate:d});return}const R=(0,gi.differenceInCalendarMonths)(d,y.minDate,l.dateOptions),a=l.list.getVisibleRange();S&&a.includes(R)||(l.isFirstRender=!0,l.list.scrollTo(R),l.setState({focusedDate:d}))}),us(this,"updateShownDate",function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:l.props;const y=d.scroll.enabled?{...d,months:l.list.getVisibleRange().length}:d,S=(0,Gv.calcFocusDate)(l.state.focusedDate,y);l.focusToDate(S,y)}),us(this,"updatePreview",d=>{if(!d){this.setState({preview:null});return}const y={startDate:d,endDate:d,color:this.props.color};this.setState({preview:y})}),us(this,"changeShownDate",function(d){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"set";const{focusedDate:S}=l.state,{onShownDateChange:R,minDate:a,maxDate:N}=l.props,G={monthOffset:()=>(0,gi.addMonths)(S,d),setMonth:()=>(0,gi.setMonth)(S,d),setYear:()=>(0,gi.setYear)(S,d),set:()=>d},q=(0,gi.min)([(0,gi.max)([G[y](),a]),N]);l.focusToDate(q,l.props,!1),R&&R(q)}),us(this,"handleRangeFocusChange",(d,y)=>{this.props.onRangeFocusChange&&this.props.onRangeFocusChange([d,y])}),us(this,"handleScroll",()=>{const{onShownDateChange:d,minDate:y}=this.props,{focusedDate:S}=this.state,{isFirstRender:R}=this,a=this.list.getVisibleRange();if(a[0]===void 0)return;const N=(0,gi.addMonths)(y,a[0]||0);!(0,gi.isSameMonth)(N,S)&&!R&&(this.setState({focusedDate:N}),d&&d(N)),this.isFirstRender=!1}),us(this,"renderMonthAndYear",(d,y,S)=>{const{showMonthArrow:R,minDate:a,maxDate:N,showMonthAndYearPickers:G,ariaLabels:q}=S,X=(N||Bp.defaultProps.maxDate).getFullYear(),oe=(a||Bp.defaultProps.minDate).getFullYear(),te=this.styles;return Xn.default.createElement("div",{onMouseUp:ie=>ie.stopPropagation(),className:te.monthAndYearWrapper},R?Xn.default.createElement("button",{type:"button",className:(0,Hh.default)(te.nextPrevButton,te.prevButton),onClick:()=>y(-1,"monthOffset"),"aria-label":q.prevButton},Xn.default.createElement("i",null)):null,G?Xn.default.createElement("span",{className:te.monthAndYearPickers},Xn.default.createElement("span",{className:te.monthPicker},Xn.default.createElement("select",{value:d.getMonth(),onChange:ie=>y(ie.target.value,"setMonth"),"aria-label":q.monthPicker},this.state.monthNames.map((ie,pe)=>Xn.default.createElement("option",{key:pe,value:pe},ie)))),Xn.default.createElement("span",{className:te.monthAndYearDivider}),Xn.default.createElement("span",{className:te.yearPicker},Xn.default.createElement("select",{value:d.getFullYear(),onChange:ie=>y(ie.target.value,"setYear"),"aria-label":q.yearPicker},new Array(X-oe+1).fill(X).map((ie,pe)=>{const se=ie-pe;return Xn.default.createElement("option",{key:se,value:se},se)})))):Xn.default.createElement("span",{className:te.monthAndYearPickers},this.state.monthNames[d.getMonth()]," ",d.getFullYear()),R?Xn.default.createElement("button",{type:"button",className:(0,Hh.default)(te.nextPrevButton,te.nextButton),onClick:()=>y(1,"monthOffset"),"aria-label":q.nextButton},Xn.default.createElement("i",null)):null)}),us(this,"renderDateDisplay",()=>{const{focusedRange:d,color:y,ranges:S,rangeColors:R,dateDisplayFormat:a,editableDateInputs:N,startDatePlaceholder:G,endDatePlaceholder:q,ariaLabels:X}=this.props,oe=R[d[0]]||y,te=this.styles;return Xn.default.createElement("div",{className:te.dateDisplayWrapper},S.map((ie,pe)=>ie.showDateDisplay===!1||ie.disabled&&!ie.showDateDisplay?null:Xn.default.createElement("div",{className:te.dateDisplay,key:pe,style:{color:ie.color||oe}},Xn.default.createElement(wk.default,{className:(0,Hh.default)(te.dateDisplayItem,{[te.dateDisplayItemActive]:d[0]===pe&&d[1]===0}),readOnly:!N,disabled:ie.disabled,value:ie.startDate,placeholder:G,dateOptions:this.dateOptions,dateDisplayFormat:a,ariaLabel:X.dateInput&&X.dateInput[ie.key]&&X.dateInput[ie.key].startDate,onChange:this.onDragSelectionEnd,onFocus:()=>this.handleRangeFocusChange(pe,0)}),Xn.default.createElement(wk.default,{className:(0,Hh.default)(te.dateDisplayItem,{[te.dateDisplayItemActive]:d[0]===pe&&d[1]===1}),readOnly:!N,disabled:ie.disabled,value:ie.endDate,placeholder:q,dateOptions:this.dateOptions,dateDisplayFormat:a,ariaLabel:X.dateInput&&X.dateInput[ie.key]&&X.dateInput[ie.key].endDate,onChange:this.onDragSelectionEnd,onFocus:()=>this.handleRangeFocusChange(pe,1)}))))}),us(this,"onDragSelectionStart",d=>{const{onChange:y,dragSelectionEnabled:S}=this.props;S?this.setState({drag:{status:!0,range:{startDate:d,endDate:d},disablePreview:!0}}):y&&y(d)}),us(this,"onDragSelectionEnd",d=>{const{updateRange:y,displayMode:S,onChange:R,dragSelectionEnabled:a}=this.props;if(!a)return;if(S==="date"||!this.state.drag.status){R&&R(d);return}const N={startDate:this.state.drag.range.startDate,endDate:d};S!=="dateRange"||(0,gi.isSameDay)(N.startDate,d)?this.setState({drag:{status:!1,range:{}}},()=>R&&R(d)):this.setState({drag:{status:!1,range:{}}},()=>{y&&y(N)})}),us(this,"onDragSelectionMove",d=>{const{drag:y}=this.state;!y.status||!this.props.dragSelectionEnabled||this.setState({drag:{status:y.status,range:{startDate:y.range.startDate,endDate:d},disablePreview:!0}})}),us(this,"estimateMonthSize",(d,y)=>{const{direction:S,minDate:R}=this.props,{scrollArea:a}=this.state;if(y&&(this.listSizeCache=y,y[d]))return y[d];if(S==="horizontal")return a.monthWidth;const N=(0,gi.addMonths)(R,d),{start:G,end:q}=(0,Gv.getMonthDisplayRange)(N,this.dateOptions);return(0,gi.differenceInDays)(q,G,this.dateOptions)+1>7*5?a.longMonthHeight:a.monthHeight}),this.dateOptions={locale:t.locale},t.weekStartsOn!==void 0&&(this.dateOptions.weekStartsOn=t.weekStartsOn),this.styles=(0,Gv.generateStyles)([s9.default,t.classNames]),this.listSizeCache={},this.isFirstRender=!0,this.state={monthNames:this.getMonthNames(),focusedDate:(0,Gv.calcFocusDate)(null,t),drag:{status:!1,range:{startDate:null,endDate:null},disablePreview:!1},scrollArea:this.calcScrollArea(t)}}getMonthNames(){return[...Array(12).keys()].map(t=>this.props.locale.localize.month(t))}calcScrollArea(t){const{direction:i,months:l,scroll:d}=t;if(!d.enabled)return{enabled:!1};const y=d.longMonthHeight||d.monthHeight;return i==="vertical"?{enabled:!0,monthHeight:d.monthHeight||220,longMonthHeight:y||260,calendarWidth:"auto",calendarHeight:(d.calendarHeight||y||240)*l}:{enabled:!0,monthWidth:d.monthWidth||332,calendarWidth:(d.calendarWidth||d.monthWidth||332)*l,monthHeight:y||300,calendarHeight:y||300}}componentDidMount(){this.props.scroll.enabled&&setTimeout(()=>this.focusToDate(this.state.focusedDate))}componentDidUpdate(t){const l={dateRange:"ranges",date:"date"}[this.props.displayMode];this.props[l]!==t[l]&&this.updateShownDate(this.props),(t.locale!==this.props.locale||t.weekStartsOn!==this.props.weekStartsOn)&&(this.dateOptions={locale:this.props.locale},this.props.weekStartsOn!==void 0&&(this.dateOptions.weekStartsOn=this.props.weekStartsOn),this.setState({monthNames:this.getMonthNames()})),(0,o9.shallowEqualObjects)(t.scroll,this.props.scroll)||this.setState({scrollArea:this.calcScrollArea(this.props)})}renderWeekdays(){const t=new Date;return Xn.default.createElement("div",{className:this.styles.weekDays},(0,gi.eachDayOfInterval)({start:(0,gi.startOfWeek)(t,this.dateOptions),end:(0,gi.endOfWeek)(t,this.dateOptions)}).map((i,l)=>Xn.default.createElement("span",{className:this.styles.weekDay,key:l},(0,gi.format)(i,this.props.weekdayDisplayFormat,this.dateOptions))))}render(){const{showDateDisplay:t,onPreviewChange:i,scroll:l,direction:d,disabledDates:y,disabledDay:S,maxDate:R,minDate:a,rangeColors:N,color:G,navigatorRenderer:q,className:X,preview:oe}=this.props,{scrollArea:te,focusedDate:ie}=this.state,pe=d==="vertical",se=q||this.renderMonthAndYear,le=this.props.ranges.map((ce,Me)=>({...ce,color:ce.color||N[Me]||G}));return Xn.default.createElement("div",{className:(0,Hh.default)(this.styles.calendarWrapper,X),onMouseUp:()=>this.setState({drag:{status:!1,range:{}}}),onMouseLeave:()=>{this.setState({drag:{status:!1,range:{}}})}},t&&this.renderDateDisplay(),se(ie,this.changeShownDate,this.props),l.enabled?Xn.default.createElement("div",null,pe&&this.renderWeekdays(this.dateOptions),Xn.default.createElement("div",{className:(0,Hh.default)(this.styles.infiniteMonths,pe?this.styles.monthsVertical:this.styles.monthsHorizontal),onMouseLeave:()=>i&&i(),style:{width:te.calendarWidth+11,height:te.calendarHeight+11},onScroll:this.handleScroll},Xn.default.createElement(i9.default,{length:(0,gi.differenceInCalendarMonths)((0,gi.endOfMonth)(R),(0,gi.addDays)((0,gi.startOfMonth)(a),-1),this.dateOptions),treshold:500,type:"variable",ref:ce=>this.list=ce,itemSizeEstimator:this.estimateMonthSize,axis:pe?"y":"x",itemRenderer:(ce,Me)=>{const Le=(0,gi.addMonths)(a,ce);return Xn.default.createElement(bk.default,a1({},this.props,{onPreviewChange:i||this.updatePreview,preview:oe||this.state.preview,ranges:le,key:Me,drag:this.state.drag,dateOptions:this.dateOptions,disabledDates:y,disabledDay:S,month:Le,onDragSelectionStart:this.onDragSelectionStart,onDragSelectionEnd:this.onDragSelectionEnd,onDragSelectionMove:this.onDragSelectionMove,onMouseLeave:()=>i&&i(),styles:this.styles,style:pe?{height:this.estimateMonthSize(ce)}:{height:te.monthHeight,width:this.estimateMonthSize(ce)},showMonthName:!0,showWeekDays:!pe}))}}))):Xn.default.createElement("div",{className:(0,Hh.default)(this.styles.months,pe?this.styles.monthsVertical:this.styles.monthsHorizontal)},new Array(this.props.months).fill(null).map((ce,Me)=>{let Le=(0,gi.addMonths)(this.state.focusedDate,Me);return this.props.calendarFocus==="backwards"&&(Le=(0,gi.subMonths)(this.state.focusedDate,this.props.months-1-Me)),Xn.default.createElement(bk.default,a1({},this.props,{onPreviewChange:i||this.updatePreview,preview:oe||this.state.preview,ranges:le,key:Me,drag:this.state.drag,dateOptions:this.dateOptions,disabledDates:y,disabledDay:S,month:Le,onDragSelectionStart:this.onDragSelectionStart,onDragSelectionEnd:this.onDragSelectionEnd,onDragSelectionMove:this.onDragSelectionMove,onMouseLeave:()=>i&&i(),styles:this.styles,showWeekDays:!pe||Me===0,showMonthName:!pe||Me>0}))})))}}Bp.defaultProps={showMonthArrow:!0,showMonthAndYearPickers:!0,disabledDates:[],disabledDay:()=>{},classNames:{},locale:a9.enUS,ranges:[],focusedRange:[0,0],dateDisplayFormat:"MMM d, yyyy",monthDisplayFormat:"MMM yyyy",weekdayDisplayFormat:"E",dayDisplayFormat:"d",showDateDisplay:!0,showPreview:!0,displayMode:"date",months:1,color:"#3d91ff",scroll:{enabled:!1},direction:"vertical",maxDate:(0,gi.addYears)(new Date,20),minDate:(0,gi.addYears)(new Date,-100),rangeColors:["#3d91ff","#3ecf8e","#fed14c"],startDatePlaceholder:"Early",endDatePlaceholder:"Continuous",editableDateInputs:!1,dragSelectionEnabled:!0,fixedHeight:!1,calendarFocus:"forwards",preventSnapRefocus:!1,ariaLabels:{}};Bp.propTypes={showMonthArrow:Wr.default.bool,showMonthAndYearPickers:Wr.default.bool,disabledDates:Wr.default.array,disabledDay:Wr.default.func,minDate:Wr.default.object,maxDate:Wr.default.object,date:Wr.default.object,onChange:Wr.default.func,onPreviewChange:Wr.default.func,onRangeFocusChange:Wr.default.func,classNames:Wr.default.object,locale:Wr.default.object,shownDate:Wr.default.object,onShownDateChange:Wr.default.func,ranges:Wr.default.arrayOf(n9.rangeShape),preview:Wr.default.shape({startDate:Wr.default.object,endDate:Wr.default.object,color:Wr.default.string}),dateDisplayFormat:Wr.default.string,monthDisplayFormat:Wr.default.string,weekdayDisplayFormat:Wr.default.string,weekStartsOn:Wr.default.number,dayDisplayFormat:Wr.default.string,focusedRange:Wr.default.arrayOf(Wr.default.number),initialFocusedRange:Wr.default.arrayOf(Wr.default.number),months:Wr.default.number,className:Wr.default.string,showDateDisplay:Wr.default.bool,showPreview:Wr.default.bool,displayMode:Wr.default.oneOf(["dateRange","date"]),color:Wr.default.string,updateRange:Wr.default.func,scroll:Wr.default.shape({enabled:Wr.default.bool,monthHeight:Wr.default.number,longMonthHeight:Wr.default.number,monthWidth:Wr.default.number,calendarWidth:Wr.default.number,calendarHeight:Wr.default.number}),direction:Wr.default.oneOf(["vertical","horizontal"]),startDatePlaceholder:Wr.default.string,endDatePlaceholder:Wr.default.string,navigatorRenderer:Wr.default.func,rangeColors:Wr.default.arrayOf(Wr.default.string),editableDateInputs:Wr.default.bool,dragSelectionEnabled:Wr.default.bool,fixedHeight:Wr.default.bool,calendarFocus:Wr.default.string,preventSnapRefocus:Wr.default.bool,ariaLabels:l9.ariaLabelsShape};yy.default=Bp;Object.defineProperty(_y,"__esModule",{value:!0});_y.default=void 0;var Sk=m9(we),Zf=ob(Ya),mB=ob(yy),d9=pc,dT=wc,yl=Cd,f9=ob(Ed),p9=ob(Id);function ob(e){return e&&e.__esModule?e:{default:e}}function gB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(gB=function(l){return l?i:t})(e)}function m9(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=gB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function OE(){return OE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},OE.apply(this,arguments)}function Hv(e,t,i){return t=g9(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function g9(e){var t=_9(e,"string");return typeof t=="symbol"?t:String(t)}function _9(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var l=i.call(e,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class DC extends Sk.Component{constructor(t,i){var l;super(t,i),l=this,Hv(this,"calcNewSelection",function(d){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const S=l.props.focusedRange||l.state.focusedRange,{ranges:R,onChange:a,maxDate:N,moveRangeOnFirstSelection:G,retainEndDateOnFirstSelection:q,disabledDates:X}=l.props,oe=S[0],te=R[oe];if(!te||!a)return{};let{startDate:ie,endDate:pe}=te;const se=new Date;let le;if(!y)ie=d.startDate,pe=d.endDate;else if(S[1]===0){const Le=(0,yl.differenceInCalendarDays)(pe||se,ie),Je=()=>G?(0,yl.addDays)(d,Le):q?!pe||(0,yl.isBefore)(d,pe)?pe:d:d||se;ie=d,pe=Je(),N&&(pe=(0,yl.min)([pe,N])),le=[S[0],1]}else pe=d;let ce=S[1]===0;(0,yl.isBefore)(pe,ie)&&(ce=!ce,[ie,pe]=[pe,ie]);const Me=X.filter(Le=>(0,yl.isWithinInterval)(Le,{start:ie,end:pe}));return Me.length>0&&(ce?ie=(0,yl.addDays)((0,yl.max)(Me),1):pe=(0,yl.addDays)((0,yl.min)(Me),-1)),le||(le=[(0,dT.findNextRangeIndex)(l.props.ranges,S[0]),0]),{wasValid:!(Me.length>0),range:{startDate:ie,endDate:pe},nextFocusRange:le}}),Hv(this,"setSelection",(d,y)=>{const{onChange:S,ranges:R,onRangeFocusChange:a}=this.props,G=(this.props.focusedRange||this.state.focusedRange)[0],q=R[G];if(!q)return;const X=this.calcNewSelection(d,y);S({[q.key||`range${G+1}`]:{...q,...X.range}}),this.setState({focusedRange:X.nextFocusRange,preview:null}),a&&a(X.nextFocusRange)}),Hv(this,"handleRangeFocusChange",d=>{this.setState({focusedRange:d}),this.props.onRangeFocusChange&&this.props.onRangeFocusChange(d)}),Hv(this,"updatePreview",d=>{var N;if(!d){this.setState({preview:null});return}const{rangeColors:y,ranges:S}=this.props,R=this.props.focusedRange||this.state.focusedRange,a=((N=S[R[0]])==null?void 0:N.color)||y[R[0]]||a;this.setState({preview:{...d.range,color:a}})}),this.state={focusedRange:t.initialFocusedRange||[(0,dT.findNextRangeIndex)(t.ranges),0],preview:null},this.styles=(0,dT.generateStyles)([p9.default,t.classNames])}render(){return Sk.default.createElement(mB.default,OE({focusedRange:this.state.focusedRange,onRangeFocusChange:this.handleRangeFocusChange,preview:this.state.preview,onPreviewChange:t=>{this.updatePreview(t?this.calcNewSelection(t):null)}},this.props,{displayMode:"dateRange",className:(0,f9.default)(this.styles.dateRangeWrapper,this.props.className),onChange:this.setSelection,updateRange:t=>this.setSelection(t,!1),ref:t=>{this.calendar=t}}))}}DC.defaultProps={classNames:{},ranges:[],moveRangeOnFirstSelection:!1,retainEndDateOnFirstSelection:!1,rangeColors:["#3d91ff","#3ecf8e","#fed14c"],disabledDates:[]};DC.propTypes={...mB.default.propTypes,onChange:Zf.default.func,onRangeFocusChange:Zf.default.func,className:Zf.default.string,ranges:Zf.default.arrayOf(d9.rangeShape),moveRangeOnFirstSelection:Zf.default.bool,retainEndDateOnFirstSelection:Zf.default.bool};_y.default=DC;var ab={},wy={},Gu={};Object.defineProperty(Gu,"__esModule",{value:!0});Gu.createStaticRanges=_B;Gu.defaultStaticRanges=Gu.defaultInputRanges=void 0;var ci=Cd;const fo={startOfWeek:(0,ci.startOfWeek)(new Date),endOfWeek:(0,ci.endOfWeek)(new Date),startOfLastWeek:(0,ci.startOfWeek)((0,ci.addDays)(new Date,-7)),endOfLastWeek:(0,ci.endOfWeek)((0,ci.addDays)(new Date,-7)),startOfToday:(0,ci.startOfDay)(new Date),endOfToday:(0,ci.endOfDay)(new Date),startOfYesterday:(0,ci.startOfDay)((0,ci.addDays)(new Date,-1)),endOfYesterday:(0,ci.endOfDay)((0,ci.addDays)(new Date,-1)),startOfMonth:(0,ci.startOfMonth)(new Date),endOfMonth:(0,ci.endOfMonth)(new Date),startOfLastMonth:(0,ci.startOfMonth)((0,ci.addMonths)(new Date,-1)),endOfLastMonth:(0,ci.endOfMonth)((0,ci.addMonths)(new Date,-1))},y9={range:{},isSelected(e){const t=this.range();return(0,ci.isSameDay)(e.startDate,t.startDate)&&(0,ci.isSameDay)(e.endDate,t.endDate)}};function _B(e){return e.map(t=>({...y9,...t}))}Gu.defaultStaticRanges=_B([{label:"Today",range:()=>({startDate:fo.startOfToday,endDate:fo.endOfToday})},{label:"Yesterday",range:()=>({startDate:fo.startOfYesterday,endDate:fo.endOfYesterday})},{label:"This Week",range:()=>({startDate:fo.startOfWeek,endDate:fo.endOfWeek})},{label:"Last Week",range:()=>({startDate:fo.startOfLastWeek,endDate:fo.endOfLastWeek})},{label:"This Month",range:()=>({startDate:fo.startOfMonth,endDate:fo.endOfMonth})},{label:"Last Month",range:()=>({startDate:fo.startOfLastMonth,endDate:fo.endOfLastMonth})}]);Gu.defaultInputRanges=[{label:"days up to today",range(e){return{startDate:(0,ci.addDays)(fo.startOfToday,(Math.max(Number(e),1)-1)*-1),endDate:fo.endOfToday}},getCurrentValue(e){return(0,ci.isSameDay)(e.endDate,fo.endOfToday)?e.startDate?(0,ci.differenceInCalendarDays)(fo.endOfToday,e.startDate)+1:"∞":"-"}},{label:"days starting today",range(e){const t=new Date;return{startDate:t,endDate:(0,ci.addDays)(t,Math.max(Number(e),1)-1)}},getCurrentValue(e){return(0,ci.isSameDay)(e.startDate,fo.startOfToday)?e.endDate?(0,ci.differenceInCalendarDays)(e.endDate,fo.startOfToday)+1:"∞":"-"}}];var sb={};Object.defineProperty(sb,"__esModule",{value:!0});sb.default=void 0;var qv=x9(we),ga=v9(Ya);function v9(e){return e&&e.__esModule?e:{default:e}}function yB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(yB=function(l){return l?i:t})(e)}function x9(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=yB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function b9(e,t,i){return t=w9(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function w9(e){var t=S9(e,"string");return typeof t=="symbol"?t:String(t)}function S9(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var l=i.call(e,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}const Tk=0,Ek=99999;class RC extends qv.Component{constructor(t,i){super(t,i),b9(this,"onChange",l=>{const{onChange:d}=this.props;let y=parseInt(l.target.value,10);y=isNaN(y)?0:Math.max(Math.min(Ek,y),Tk),d(y)})}shouldComponentUpdate(t){const{value:i,label:l,placeholder:d}=this.props;return i!==t.value||l!==t.label||d!==t.placeholder}render(){const{label:t,placeholder:i,value:l,styles:d,onBlur:y,onFocus:S}=this.props;return qv.default.createElement("div",{className:d.inputRange},qv.default.createElement("input",{className:d.inputRangeInput,placeholder:i,value:l,min:Tk,max:Ek,onChange:this.onChange,onFocus:S,onBlur:y}),qv.default.createElement("span",{className:d.inputRangeLabel},t))}}RC.propTypes={value:ga.default.oneOfType([ga.default.string,ga.default.number]),label:ga.default.oneOfType([ga.default.element,ga.default.node]).isRequired,placeholder:ga.default.string,styles:ga.default.shape({inputRange:ga.default.string,inputRangeInput:ga.default.string,inputRangeLabel:ga.default.string}).isRequired,onBlur:ga.default.func.isRequired,onFocus:ga.default.func.isRequired,onChange:ga.default.func.isRequired};RC.defaultProps={value:"",placeholder:"-"};sb.default=RC;Object.defineProperty(wy,"__esModule",{value:!0});wy.default=void 0;var qh=M9(we),Na=lb(Ya),Zh=lb(Id),Mk=Gu,T9=pc,E9=lb(sb),Ck=lb(Ed);function lb(e){return e&&e.__esModule?e:{default:e}}function vB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(vB=function(l){return l?i:t})(e)}function M9(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=vB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function C9(e,t,i){return t=I9(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function I9(e){var t=P9(e,"string");return typeof t=="symbol"?t:String(t)}function P9(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var l=i.call(e,t||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class kC extends qh.Component{constructor(t){super(t),C9(this,"handleRangeChange",i=>{const{onChange:l,ranges:d,focusedRange:y}=this.props,S=d[y[0]];!l||!S||l({[S.key||`range${y[0]+1}`]:{...S,...i}})}),this.state={rangeOffset:0,focusedInput:-1}}getRangeOptionValue(t){const{ranges:i=[],focusedRange:l=[]}=this.props;if(typeof t.getCurrentValue!="function")return"";const d=i[l[0]]||{};return t.getCurrentValue(d)||""}getSelectedRange(t,i){const l=t.findIndex(y=>!y.startDate||!y.endDate||y.disabled?!1:i.isSelected(y));return{selectedRange:t[l],focusedRangeIndex:l}}render(){const{headerContent:t,footerContent:i,onPreviewChange:l,inputRanges:d,staticRanges:y,ranges:S,renderStaticRangeLabel:R,rangeColors:a,className:N}=this.props;return qh.default.createElement("div",{className:(0,Ck.default)(Zh.default.definedRangesWrapper,N)},t,qh.default.createElement("div",{className:Zh.default.staticRanges},y.map((G,q)=>{const{selectedRange:X,focusedRangeIndex:oe}=this.getSelectedRange(S,G);let te;return G.hasCustomRendering?te=R(G):te=G.label,qh.default.createElement("button",{type:"button",className:(0,Ck.default)(Zh.default.staticRange,{[Zh.default.staticRangeSelected]:!!X}),style:{color:X?X.color||a[oe]:null},key:q,onClick:()=>this.handleRangeChange(G.range(this.props)),onFocus:()=>l&&l(G.range(this.props)),onMouseOver:()=>l&&l(G.range(this.props)),onMouseLeave:()=>{l&&l()}},qh.default.createElement("span",{tabIndex:-1,className:Zh.default.staticRangeLabel},te))})),qh.default.createElement("div",{className:Zh.default.inputRanges},d.map((G,q)=>qh.default.createElement(E9.default,{key:q,styles:Zh.default,label:G.label,onFocus:()=>this.setState({focusedInput:q,rangeOffset:0}),onBlur:()=>this.setState({rangeOffset:0}),onChange:X=>this.handleRangeChange(G.range(X,this.props)),value:this.getRangeOptionValue(G)}))),i)}}kC.propTypes={inputRanges:Na.default.array,staticRanges:Na.default.array,ranges:Na.default.arrayOf(T9.rangeShape),focusedRange:Na.default.arrayOf(Na.default.number),onPreviewChange:Na.default.func,onChange:Na.default.func,footerContent:Na.default.any,headerContent:Na.default.any,rangeColors:Na.default.arrayOf(Na.default.string),className:Na.default.string,renderStaticRangeLabel:Na.default.func};kC.defaultProps={inputRanges:Mk.defaultInputRanges,staticRanges:Mk.defaultStaticRanges,ranges:[],rangeColors:["#3d91ff","#3ecf8e","#fed14c"],focusedRange:[0,0]};wy.default=kC;Object.defineProperty(ab,"__esModule",{value:!0});ab.default=void 0;var Zv=k9(we),A9=Sy(Ya),xB=Sy(_y),bB=Sy(wy),Ik=wc,D9=Sy(Ed),R9=Sy(Id);function Sy(e){return e&&e.__esModule?e:{default:e}}function wB(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(wB=function(l){return l?i:t})(e)}function k9(e,t){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=wB(t);if(i&&i.has(e))return i.get(e);var l={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in e)if(y!=="default"&&Object.prototype.hasOwnProperty.call(e,y)){var S=d?Object.getOwnPropertyDescriptor(e,y):null;S&&(S.get||S.set)?Object.defineProperty(l,y,S):l[y]=e[y]}return l.default=e,i&&i.set(e,l),l}function s1(){return s1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},s1.apply(this,arguments)}class OC extends Zv.Component{constructor(t){super(t),this.state={focusedRange:[(0,Ik.findNextRangeIndex)(t.ranges),0]},this.styles=(0,Ik.generateStyles)([R9.default,t.classNames])}render(){const{focusedRange:t}=this.state;return Zv.default.createElement("div",{className:(0,D9.default)(this.styles.dateRangePickerWrapper,this.props.className)},Zv.default.createElement(bB.default,s1({focusedRange:t,onPreviewChange:i=>this.dateRange.updatePreview(i?this.dateRange.calcNewSelection(i,typeof i=="string"):null)},this.props,{range:this.props.ranges[t[0]],className:void 0})),Zv.default.createElement(xB.default,s1({onRangeFocusChange:i=>this.setState({focusedRange:i}),focusedRange:t},this.props,{ref:i=>this.dateRange=i,className:void 0})))}}OC.defaultProps={};OC.propTypes={...xB.default.propTypes,...bB.default.propTypes,className:A9.default.string};ab.default=OC;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"Calendar",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"DateRange",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"DateRangePicker",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"DefinedRange",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"createStaticRanges",{enumerable:!0,get:function(){return y.createStaticRanges}}),Object.defineProperty(e,"defaultInputRanges",{enumerable:!0,get:function(){return y.defaultInputRanges}}),Object.defineProperty(e,"defaultStaticRanges",{enumerable:!0,get:function(){return y.defaultStaticRanges}});var t=S(_y),i=S(yy),l=S(ab),d=S(wy),y=Gu;function S(R){return R&&R.__esModule?R:{default:R}}})(Z4);function Il(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function SB(e){if(we.isValidElement(e)||!Il(e))return e;const t={};return Object.keys(e).forEach(i=>{t[i]=SB(e[i])}),t}function Vo(e,t,i={clone:!0}){const l=i.clone?{...e}:e;return Il(e)&&Il(t)&&Object.keys(t).forEach(d=>{we.isValidElement(t[d])?l[d]=t[d]:Il(t[d])&&Object.prototype.hasOwnProperty.call(e,d)&&Il(e[d])?l[d]=Vo(e[d],t[d],i):i.clone?l[d]=Il(t[d])?SB(t[d]):t[d]:l[d]=t[d]}),l}function _c(e,...t){const i=new URL(`https://mui.com/production-error/?code=${e}`);return t.forEach(l=>i.searchParams.append("args[]",l)),`Minified MUI error #${e}; visit ${i} for the full message.`}function nn(e){if(typeof e!="string")throw new Error(_c(7));return e.charAt(0).toUpperCase()+e.slice(1)}function Pk(...e){return e.reduce((t,i)=>i==null?t:function(...d){t.apply(this,d),i.apply(this,d)},()=>{})}function TB(e,t=166){let i;function l(...d){const y=()=>{e.apply(this,d)};clearTimeout(i),i=setTimeout(y,t)}return l.clear=()=>{clearTimeout(i)},l}function fT(e,t){var i,l,d;return we.isValidElement(e)&&t.indexOf(e.type.muiName??((d=(l=(i=e.type)==null?void 0:i._payload)==null?void 0:l.value)==null?void 0:d.muiName))!==-1}function Ys(e){return e&&e.ownerDocument||document}function yc(e){return Ys(e).defaultView||window}function LE(e,t){typeof e=="function"?e(t):e&&(e.current=t)}const vd=typeof window<"u"?we.useLayoutEffect:we.useEffect;let Ak=0;function O9(e){const[t,i]=we.useState(e),l=e||t;return we.useEffect(()=>{t==null&&(Ak+=1,i(`mui-${Ak}`))},[t]),l}const L9={...bx},Dk=L9.useId;function EB(e){if(Dk!==void 0){const t=Dk();return e??t}return O9(e)}function Rk({controlled:e,default:t,name:i,state:l="value"}){const{current:d}=we.useRef(e!==void 0),[y,S]=we.useState(t),R=d?e:y,a=we.useCallback(N=>{d||S(N)},[]);return[R,a]}function Mp(e){const t=we.useRef(e);return vd(()=>{t.current=e}),we.useRef((...i)=>(0,t.current)(...i)).current}function Wo(...e){return we.useMemo(()=>e.every(t=>t==null)?null:t=>{e.forEach(i=>{LE(i,t)})},e)}const kk={};function MB(e,t){const i=we.useRef(kk);return i.current===kk&&(i.current=e(t)),i}const z9=[];function F9(e){we.useEffect(e,z9)}class LC{constructor(){fr(this,"currentId",null);fr(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});fr(this,"disposeEffect",()=>this.clear)}static create(){return new LC}start(t,i){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,i()},t)}}function CB(){const e=MB(LC.create).current;return F9(e.disposeEffect),e}function Ok(e){try{return e.matches(":focus-visible")}catch{}return!1}function IB(e=window){const t=e.document.documentElement.clientWidth;return e.innerWidth-t}function l1(e,t){const i={...t};for(const l in e)if(Object.prototype.hasOwnProperty.call(e,l)){const d=l;if(d==="components"||d==="slots")i[d]={...e[d],...i[d]};else if(d==="componentsProps"||d==="slotProps"){const y=e[d],S=t[d];if(!S)i[d]=y||{};else if(!y)i[d]=S;else{i[d]={...S};for(const R in y)if(Object.prototype.hasOwnProperty.call(y,R)){const a=R;i[d][a]=l1(y[a],S[a])}}}else i[d]===void 0&&(i[d]=e[d])}return i}function Jn(e,t,i=void 0){const l={};for(const d in e){const y=e[d];let S="",R=!0;for(let a=0;a<y.length;a+=1){const N=y[a];N&&(S+=(R===!0?"":" ")+t(N),R=!1,i&&i[N]&&(S+=" "+i[N]))}l[d]=S}return l}const Lk=e=>e,B9=()=>{let e=Lk;return{configure(t){e=t},generate(t){return e(t)},reset(){e=Lk}}},PB=B9(),N9={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Gn(e,t,i="Mui"){const l=N9[t];return l?`${i}-${l}`:`${PB.generate(e)}-${t}`}function jn(e,t,i="Mui"){const l={};return t.forEach(d=>{l[d]=Gn(e,d,i)}),l}function U9(e,t=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER){return Math.max(t,Math.min(e,i))}function j9(e){return typeof e=="string"}function AB(e,t,i){return e===void 0||j9(e)?t:{...t,ownerState:{...t.ownerState,...i}}}function DB(e){var t,i,l="";if(typeof e=="string"||typeof e=="number")l+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(t=0;t<d;t++)e[t]&&(i=DB(e[t]))&&(l&&(l+=" "),l+=i)}else for(i in e)e[i]&&(l&&(l+=" "),l+=i);return l}function ln(){for(var e,t,i=0,l="",d=arguments.length;i<d;i++)(e=arguments[i])&&(t=DB(e))&&(l&&(l+=" "),l+=t);return l}function RB(e,t=[]){if(e===void 0)return{};const i={};return Object.keys(e).filter(l=>l.match(/^on[A-Z]/)&&typeof e[l]=="function"&&!t.includes(l)).forEach(l=>{i[l]=e[l]}),i}function zk(e){if(e===void 0)return{};const t={};return Object.keys(e).filter(i=>!(i.match(/^on[A-Z]/)&&typeof e[i]=="function")).forEach(i=>{t[i]=e[i]}),t}function kB(e){const{getSlotProps:t,additionalProps:i,externalSlotProps:l,externalForwardedProps:d,className:y}=e;if(!t){const oe=ln(i==null?void 0:i.className,y,d==null?void 0:d.className,l==null?void 0:l.className),te={...i==null?void 0:i.style,...d==null?void 0:d.style,...l==null?void 0:l.style},ie={...i,...d,...l};return oe.length>0&&(ie.className=oe),Object.keys(te).length>0&&(ie.style=te),{props:ie,internalRef:void 0}}const S=RB({...d,...l}),R=zk(l),a=zk(d),N=t(S),G=ln(N==null?void 0:N.className,i==null?void 0:i.className,y,d==null?void 0:d.className,l==null?void 0:l.className),q={...N==null?void 0:N.style,...i==null?void 0:i.style,...d==null?void 0:d.style,...l==null?void 0:l.style},X={...N,...i,...a,...R};return G.length>0&&(X.className=G),Object.keys(q).length>0&&(X.style=q),{props:X,internalRef:N.ref}}function OB(e,t,i){return typeof e=="function"?e(t,i):e}function Fk(e){var q;const{elementType:t,externalSlotProps:i,ownerState:l,skipResolvingSlotProps:d=!1,...y}=e,S=d?{}:OB(i,l),{props:R,internalRef:a}=kB({...y,externalSlotProps:S}),N=Wo(a,S==null?void 0:S.ref,(q=e.additionalProps)==null?void 0:q.ref);return AB(t,{...R,ref:N},l)}function Ty(e){var t;return parseInt(we.version,10)>=19?((t=e==null?void 0:e.props)==null?void 0:t.ref)||null:(e==null?void 0:e.ref)||null}function P_(e,t){return t?Vo(e,t,{clone:!1}):e}function V9(e,t){if(!e.containerQueries)return t;const i=Object.keys(t).filter(l=>l.startsWith("@container")).sort((l,d)=>{var S,R;const y=/min-width:\s*([0-9.]+)/;return+(((S=l.match(y))==null?void 0:S[1])||0)-+(((R=d.match(y))==null?void 0:R[1])||0)});return i.length?i.reduce((l,d)=>{const y=t[d];return delete l[d],l[d]=y,l},{...t}):t}function $9(e,t){return t==="@"||t.startsWith("@")&&(e.some(i=>t.startsWith(`@${i}`))||!!t.match(/^@\d/))}function W9(e,t){const i=t.match(/^@([^/]+)?\/?(.+)?$/);if(!i)return null;const[,l,d]=i,y=Number.isNaN(+l)?l||0:+l;return e.containerQueries(d).up(y)}function G9(e){const t=(y,S)=>y.replace("@media",S?`@container ${S}`:"@container");function i(y,S){y.up=(...R)=>t(e.breakpoints.up(...R),S),y.down=(...R)=>t(e.breakpoints.down(...R),S),y.between=(...R)=>t(e.breakpoints.between(...R),S),y.only=(...R)=>t(e.breakpoints.only(...R),S),y.not=(...R)=>{const a=t(e.breakpoints.not(...R),S);return a.includes("not all and")?a.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):a}}const l={},d=y=>(i(l,y),l);return i(d),{...e,containerQueries:d}}const cb={xs:0,sm:600,md:900,lg:1200,xl:1536},Bk={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${cb[e]}px)`},H9={containerQueries:e=>({up:t=>{let i=typeof t=="number"?t:cb[t]||t;return typeof i=="number"&&(i=`${i}px`),e?`@container ${e} (min-width:${i})`:`@container (min-width:${i})`}})};function vc(e,t,i){const l=e.theme||{};if(Array.isArray(t)){const y=l.breakpoints||Bk;return t.reduce((S,R,a)=>(S[y.up(y.keys[a])]=i(t[a]),S),{})}if(typeof t=="object"){const y=l.breakpoints||Bk;return Object.keys(t).reduce((S,R)=>{if($9(y.keys,R)){const a=W9(l.containerQueries?l:H9,R);a&&(S[a]=i(t[R],R))}else if(Object.keys(y.values||cb).includes(R)){const a=y.up(R);S[a]=i(t[R],R)}else{const a=R;S[a]=t[a]}return S},{})}return i(t)}function q9(e={}){var i;return((i=e.keys)==null?void 0:i.reduce((l,d)=>{const y=e.up(d);return l[y]={},l},{}))||{}}function Z9(e,t){return e.reduce((i,l)=>{const d=i[l];return(!d||Object.keys(d).length===0)&&delete i[l],i},t)}function ub(e,t,i=!0){if(!t||typeof t!="string")return null;if(e&&e.vars&&i){const l=`vars.${t}`.split(".").reduce((d,y)=>d&&d[y]?d[y]:null,e);if(l!=null)return l}return t.split(".").reduce((l,d)=>l&&l[d]!=null?l[d]:null,e)}function c1(e,t,i,l=i){let d;return typeof e=="function"?d=e(i):Array.isArray(e)?d=e[i]||l:d=ub(e,i)||l,t&&(d=t(d,l,e)),d}function Wi(e){const{prop:t,cssProperty:i=e.prop,themeKey:l,transform:d}=e,y=S=>{if(S[t]==null)return null;const R=S[t],a=S.theme,N=ub(a,l)||{};return vc(S,R,q=>{let X=c1(N,d,q);return q===X&&typeof q=="string"&&(X=c1(N,d,`${t}${q==="default"?"":nn(q)}`,q)),i===!1?X:{[i]:X}})};return y.propTypes={},y.filterProps=[t],y}function Y9(e){const t={};return i=>(t[i]===void 0&&(t[i]=e(i)),t[i])}const X9={m:"margin",p:"padding"},K9={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},Nk={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},J9=Y9(e=>{if(e.length>2)if(Nk[e])e=Nk[e];else return[e];const[t,i]=e.split(""),l=X9[t],d=K9[i]||"";return Array.isArray(d)?d.map(y=>l+y):[l+d]}),zC=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],FC=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...zC,...FC];function Ey(e,t,i,l){const d=ub(e,t,!0)??i;return typeof d=="number"||typeof d=="string"?y=>typeof y=="string"?y:typeof d=="string"?`calc(${y} * ${d})`:d*y:Array.isArray(d)?y=>{if(typeof y=="string")return y;const S=Math.abs(y),R=d[S];return y>=0?R:typeof R=="number"?-R:`-${R}`}:typeof d=="function"?d:()=>{}}function BC(e){return Ey(e,"spacing",8)}function My(e,t){return typeof t=="string"||t==null?t:e(t)}function Q9(e,t){return i=>e.reduce((l,d)=>(l[d]=My(t,i),l),{})}function eZ(e,t,i,l){if(!t.includes(i))return null;const d=J9(i),y=Q9(d,l),S=e[i];return vc(e,S,y)}function LB(e,t){const i=BC(e.theme);return Object.keys(e).map(l=>eZ(e,t,l,i)).reduce(P_,{})}function Li(e){return LB(e,zC)}Li.propTypes={};Li.filterProps=zC;function zi(e){return LB(e,FC)}zi.propTypes={};zi.filterProps=FC;function hb(...e){const t=e.reduce((l,d)=>(d.filterProps.forEach(y=>{l[y]=d}),l),{}),i=l=>Object.keys(l).reduce((d,y)=>t[y]?P_(d,t[y](l)):d,{});return i.propTypes={},i.filterProps=e.reduce((l,d)=>l.concat(d.filterProps),[]),i}function gs(e){return typeof e!="number"?e:`${e}px solid`}function ws(e,t){return Wi({prop:e,themeKey:"borders",transform:t})}const tZ=ws("border",gs),rZ=ws("borderTop",gs),nZ=ws("borderRight",gs),iZ=ws("borderBottom",gs),oZ=ws("borderLeft",gs),aZ=ws("borderColor"),sZ=ws("borderTopColor"),lZ=ws("borderRightColor"),cZ=ws("borderBottomColor"),uZ=ws("borderLeftColor"),hZ=ws("outline",gs),dZ=ws("outlineColor"),db=e=>{if(e.borderRadius!==void 0&&e.borderRadius!==null){const t=Ey(e.theme,"shape.borderRadius",4),i=l=>({borderRadius:My(t,l)});return vc(e,e.borderRadius,i)}return null};db.propTypes={};db.filterProps=["borderRadius"];hb(tZ,rZ,nZ,iZ,oZ,aZ,sZ,lZ,cZ,uZ,db,hZ,dZ);const fb=e=>{if(e.gap!==void 0&&e.gap!==null){const t=Ey(e.theme,"spacing",8),i=l=>({gap:My(t,l)});return vc(e,e.gap,i)}return null};fb.propTypes={};fb.filterProps=["gap"];const pb=e=>{if(e.columnGap!==void 0&&e.columnGap!==null){const t=Ey(e.theme,"spacing",8),i=l=>({columnGap:My(t,l)});return vc(e,e.columnGap,i)}return null};pb.propTypes={};pb.filterProps=["columnGap"];const mb=e=>{if(e.rowGap!==void 0&&e.rowGap!==null){const t=Ey(e.theme,"spacing",8),i=l=>({rowGap:My(t,l)});return vc(e,e.rowGap,i)}return null};mb.propTypes={};mb.filterProps=["rowGap"];const fZ=Wi({prop:"gridColumn"}),pZ=Wi({prop:"gridRow"}),mZ=Wi({prop:"gridAutoFlow"}),gZ=Wi({prop:"gridAutoColumns"}),_Z=Wi({prop:"gridAutoRows"}),yZ=Wi({prop:"gridTemplateColumns"}),vZ=Wi({prop:"gridTemplateRows"}),xZ=Wi({prop:"gridTemplateAreas"}),bZ=Wi({prop:"gridArea"});hb(fb,pb,mb,fZ,pZ,mZ,gZ,_Z,yZ,vZ,xZ,bZ);function Cp(e,t){return t==="grey"?t:e}const wZ=Wi({prop:"color",themeKey:"palette",transform:Cp}),SZ=Wi({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Cp}),TZ=Wi({prop:"backgroundColor",themeKey:"palette",transform:Cp});hb(wZ,SZ,TZ);function ja(e){return e<=1&&e!==0?`${e*100}%`:e}const EZ=Wi({prop:"width",transform:ja}),NC=e=>{if(e.maxWidth!==void 0&&e.maxWidth!==null){const t=i=>{var d,y,S,R,a;const l=((S=(y=(d=e.theme)==null?void 0:d.breakpoints)==null?void 0:y.values)==null?void 0:S[i])||cb[i];return l?((a=(R=e.theme)==null?void 0:R.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${l}${e.theme.breakpoints.unit}`}:{maxWidth:l}:{maxWidth:ja(i)}};return vc(e,e.maxWidth,t)}return null};NC.filterProps=["maxWidth"];const MZ=Wi({prop:"minWidth",transform:ja}),CZ=Wi({prop:"height",transform:ja}),IZ=Wi({prop:"maxHeight",transform:ja}),PZ=Wi({prop:"minHeight",transform:ja});Wi({prop:"size",cssProperty:"width",transform:ja});Wi({prop:"size",cssProperty:"height",transform:ja});const AZ=Wi({prop:"boxSizing"});hb(EZ,NC,MZ,CZ,IZ,PZ,AZ);const Cy={border:{themeKey:"borders",transform:gs},borderTop:{themeKey:"borders",transform:gs},borderRight:{themeKey:"borders",transform:gs},borderBottom:{themeKey:"borders",transform:gs},borderLeft:{themeKey:"borders",transform:gs},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:gs},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:db},color:{themeKey:"palette",transform:Cp},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Cp},backgroundColor:{themeKey:"palette",transform:Cp},p:{style:zi},pt:{style:zi},pr:{style:zi},pb:{style:zi},pl:{style:zi},px:{style:zi},py:{style:zi},padding:{style:zi},paddingTop:{style:zi},paddingRight:{style:zi},paddingBottom:{style:zi},paddingLeft:{style:zi},paddingX:{style:zi},paddingY:{style:zi},paddingInline:{style:zi},paddingInlineStart:{style:zi},paddingInlineEnd:{style:zi},paddingBlock:{style:zi},paddingBlockStart:{style:zi},paddingBlockEnd:{style:zi},m:{style:Li},mt:{style:Li},mr:{style:Li},mb:{style:Li},ml:{style:Li},mx:{style:Li},my:{style:Li},margin:{style:Li},marginTop:{style:Li},marginRight:{style:Li},marginBottom:{style:Li},marginLeft:{style:Li},marginX:{style:Li},marginY:{style:Li},marginInline:{style:Li},marginInlineStart:{style:Li},marginInlineEnd:{style:Li},marginBlock:{style:Li},marginBlockStart:{style:Li},marginBlockEnd:{style:Li},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:fb},rowGap:{style:mb},columnGap:{style:pb},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ja},maxWidth:{style:NC},minWidth:{transform:ja},height:{transform:ja},maxHeight:{transform:ja},minHeight:{transform:ja},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function DZ(...e){const t=e.reduce((l,d)=>l.concat(Object.keys(d)),[]),i=new Set(t);return e.every(l=>i.size===Object.keys(l).length)}function RZ(e,t){return typeof e=="function"?e(t):e}function kZ(){function e(i,l,d,y){const S={[i]:l,theme:d},R=y[i];if(!R)return{[i]:l};const{cssProperty:a=i,themeKey:N,transform:G,style:q}=R;if(l==null)return null;if(N==="typography"&&l==="inherit")return{[i]:l};const X=ub(d,N)||{};return q?q(S):vc(S,l,te=>{let ie=c1(X,G,te);return te===ie&&typeof te=="string"&&(ie=c1(X,G,`${i}${te==="default"?"":nn(te)}`,te)),a===!1?ie:{[a]:ie}})}function t(i){const{sx:l,theme:d={}}=i||{};if(!l)return null;const y=d.unstable_sxConfig??Cy;function S(R){let a=R;if(typeof R=="function")a=R(d);else if(typeof R!="object")return R;if(!a)return null;const N=q9(d.breakpoints),G=Object.keys(N);let q=N;return Object.keys(a).forEach(X=>{const oe=RZ(a[X],d);if(oe!=null)if(typeof oe=="object")if(y[X])q=P_(q,e(X,oe,d,y));else{const te=vc({theme:d},oe,ie=>({[X]:ie}));DZ(te,oe)?q[X]=t({sx:oe,theme:d}):q=P_(q,te)}else q=P_(q,e(X,oe,d,y))}),V9(d,Z9(G,q))}return Array.isArray(l)?l.map(S):S(l)}return t}const xd=kZ();xd.filterProps=["sx"];const OZ=e=>{var l;const t={systemProps:{},otherProps:{}},i=((l=e==null?void 0:e.theme)==null?void 0:l.unstable_sxConfig)??Cy;return Object.keys(e).forEach(d=>{i[d]?t.systemProps[d]=e[d]:t.otherProps[d]=e[d]}),t};function zB(e){const{sx:t,...i}=e,{systemProps:l,otherProps:d}=OZ(i);let y;return Array.isArray(t)?y=[l,...t]:typeof t=="function"?y=(...S)=>{const R=t(...S);return Il(R)?{...l,...R}:l}:y={...l,...t},{...d,sx:y}}function u1(){return u1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)({}).hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},u1.apply(null,arguments)}var LZ=!1;function zZ(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function FZ(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var BZ=function(){function e(i){var l=this;this._insertTag=function(d){var y;l.tags.length===0?l.insertionPoint?y=l.insertionPoint.nextSibling:l.prepend?y=l.container.firstChild:y=l.before:y=l.tags[l.tags.length-1].nextSibling,l.container.insertBefore(d,y),l.tags.push(d)},this.isSpeedy=i.speedy===void 0?!LZ:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(l){l.forEach(this._insertTag)},t.insert=function(l){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(FZ(this));var d=this.tags[this.tags.length-1];if(this.isSpeedy){var y=zZ(d);try{y.insertRule(l,y.cssRules.length)}catch{}}else d.appendChild(document.createTextNode(l));this.ctr++},t.flush=function(){this.tags.forEach(function(l){var d;return(d=l.parentNode)==null?void 0:d.removeChild(l)}),this.tags=[],this.ctr=0},e}(),No="-ms-",h1="-moz-",Fn="-webkit-",FB="comm",UC="rule",jC="decl",NZ="@import",BB="@keyframes",UZ="@layer",jZ=Math.abs,gb=String.fromCharCode,VZ=Object.assign;function $Z(e,t){return Eo(e,0)^45?(((t<<2^Eo(e,0))<<2^Eo(e,1))<<2^Eo(e,2))<<2^Eo(e,3):0}function NB(e){return e.trim()}function WZ(e,t){return(e=t.exec(e))?e[0]:e}function Bn(e,t,i){return e.replace(t,i)}function zE(e,t){return e.indexOf(t)}function Eo(e,t){return e.charCodeAt(t)|0}function ry(e,t,i){return e.slice(t,i)}function Sl(e){return e.length}function VC(e){return e.length}function Yv(e,t){return t.push(e),e}function GZ(e,t){return e.map(t).join("")}var _b=1,Np=1,UB=0,Ma=0,Yi=0,Jp="";function yb(e,t,i,l,d,y,S){return{value:e,root:t,parent:i,type:l,props:d,children:y,line:_b,column:Np,length:S,return:""}}function s_(e,t){return VZ(yb("",null,null,"",null,null,0),e,{length:-e.length},t)}function HZ(){return Yi}function qZ(){return Yi=Ma>0?Eo(Jp,--Ma):0,Np--,Yi===10&&(Np=1,_b--),Yi}function Ga(){return Yi=Ma<UB?Eo(Jp,Ma++):0,Np++,Yi===10&&(Np=1,_b++),Yi}function kl(){return Eo(Jp,Ma)}function _x(){return Ma}function Iy(e,t){return ry(Jp,e,t)}function ny(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function jB(e){return _b=Np=1,UB=Sl(Jp=e),Ma=0,[]}function VB(e){return Jp="",e}function yx(e){return NB(Iy(Ma-1,FE(e===91?e+2:e===40?e+1:e)))}function ZZ(e){for(;(Yi=kl())&&Yi<33;)Ga();return ny(e)>2||ny(Yi)>3?"":" "}function YZ(e,t){for(;--t&&Ga()&&!(Yi<48||Yi>102||Yi>57&&Yi<65||Yi>70&&Yi<97););return Iy(e,_x()+(t<6&&kl()==32&&Ga()==32))}function FE(e){for(;Ga();)switch(Yi){case e:return Ma;case 34:case 39:e!==34&&e!==39&&FE(Yi);break;case 40:e===41&&FE(e);break;case 92:Ga();break}return Ma}function XZ(e,t){for(;Ga()&&e+Yi!==57;)if(e+Yi===84&&kl()===47)break;return"/*"+Iy(t,Ma-1)+"*"+gb(e===47?e:Ga())}function KZ(e){for(;!ny(kl());)Ga();return Iy(e,Ma)}function JZ(e){return VB(vx("",null,null,null,[""],e=jB(e),0,[0],e))}function vx(e,t,i,l,d,y,S,R,a){for(var N=0,G=0,q=S,X=0,oe=0,te=0,ie=1,pe=1,se=1,le=0,ce="",Me=d,Le=y,Je=l,Qe=ce;pe;)switch(te=le,le=Ga()){case 40:if(te!=108&&Eo(Qe,q-1)==58){zE(Qe+=Bn(yx(le),"&","&\f"),"&\f")!=-1&&(se=-1);break}case 34:case 39:case 91:Qe+=yx(le);break;case 9:case 10:case 13:case 32:Qe+=ZZ(te);break;case 92:Qe+=YZ(_x()-1,7);continue;case 47:switch(kl()){case 42:case 47:Yv(QZ(XZ(Ga(),_x()),t,i),a);break;default:Qe+="/"}break;case 123*ie:R[N++]=Sl(Qe)*se;case 125*ie:case 59:case 0:switch(le){case 0:case 125:pe=0;case 59+G:se==-1&&(Qe=Bn(Qe,/\f/g,"")),oe>0&&Sl(Qe)-q&&Yv(oe>32?jk(Qe+";",l,i,q-1):jk(Bn(Qe," ","")+";",l,i,q-2),a);break;case 59:Qe+=";";default:if(Yv(Je=Uk(Qe,t,i,N,G,d,R,ce,Me=[],Le=[],q),y),le===123)if(G===0)vx(Qe,t,Je,Je,Me,y,q,R,Le);else switch(X===99&&Eo(Qe,3)===110?100:X){case 100:case 108:case 109:case 115:vx(e,Je,Je,l&&Yv(Uk(e,Je,Je,0,0,d,R,ce,d,Me=[],q),Le),d,Le,q,R,l?Me:Le);break;default:vx(Qe,Je,Je,Je,[""],Le,0,R,Le)}}N=G=oe=0,ie=se=1,ce=Qe="",q=S;break;case 58:q=1+Sl(Qe),oe=te;default:if(ie<1){if(le==123)--ie;else if(le==125&&ie++==0&&qZ()==125)continue}switch(Qe+=gb(le),le*ie){case 38:se=G>0?1:(Qe+="\f",-1);break;case 44:R[N++]=(Sl(Qe)-1)*se,se=1;break;case 64:kl()===45&&(Qe+=yx(Ga())),X=kl(),G=q=Sl(ce=Qe+=KZ(_x())),le++;break;case 45:te===45&&Sl(Qe)==2&&(ie=0)}}return y}function Uk(e,t,i,l,d,y,S,R,a,N,G){for(var q=d-1,X=d===0?y:[""],oe=VC(X),te=0,ie=0,pe=0;te<l;++te)for(var se=0,le=ry(e,q+1,q=jZ(ie=S[te])),ce=e;se<oe;++se)(ce=NB(ie>0?X[se]+" "+le:Bn(le,/&\f/g,X[se])))&&(a[pe++]=ce);return yb(e,t,i,d===0?UC:R,a,N,G)}function QZ(e,t,i){return yb(e,t,i,FB,gb(HZ()),ry(e,2,-2),0)}function jk(e,t,i,l){return yb(e,t,i,jC,ry(e,0,l),ry(e,l+1,-1),l)}function Ip(e,t){for(var i="",l=VC(e),d=0;d<l;d++)i+=t(e[d],d,e,t)||"";return i}function eY(e,t,i,l){switch(e.type){case UZ:if(e.children.length)break;case NZ:case jC:return e.return=e.return||e.value;case FB:return"";case BB:return e.return=e.value+"{"+Ip(e.children,l)+"}";case UC:e.value=e.props.join(",")}return Sl(i=Ip(e.children,l))?e.return=e.value+"{"+i+"}":""}function tY(e){var t=VC(e);return function(i,l,d,y){for(var S="",R=0;R<t;R++)S+=e[R](i,l,d,y)||"";return S}}function rY(e){return function(t){t.root||(t=t.return)&&e(t)}}function $B(e){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=e(i)),t[i]}}var nY=function(t,i,l){for(var d=0,y=0;d=y,y=kl(),d===38&&y===12&&(i[l]=1),!ny(y);)Ga();return Iy(t,Ma)},iY=function(t,i){var l=-1,d=44;do switch(ny(d)){case 0:d===38&&kl()===12&&(i[l]=1),t[l]+=nY(Ma-1,i,l);break;case 2:t[l]+=yx(d);break;case 4:if(d===44){t[++l]=kl()===58?"&\f":"",i[l]=t[l].length;break}default:t[l]+=gb(d)}while(d=Ga());return t},oY=function(t,i){return VB(iY(jB(t),i))},Vk=new WeakMap,aY=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var i=t.value,l=t.parent,d=t.column===l.column&&t.line===l.line;l.type!=="rule";)if(l=l.parent,!l)return;if(!(t.props.length===1&&i.charCodeAt(0)!==58&&!Vk.get(l))&&!d){Vk.set(t,!0);for(var y=[],S=oY(i,y),R=l.props,a=0,N=0;a<S.length;a++)for(var G=0;G<R.length;G++,N++)t.props[N]=y[a]?S[a].replace(/&\f/g,R[G]):R[G]+" "+S[a]}}},sY=function(t){if(t.type==="decl"){var i=t.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(t.return="",t.value="")}};function WB(e,t){switch($Z(e,t)){case 5103:return Fn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Fn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Fn+e+h1+e+No+e+e;case 6828:case 4268:return Fn+e+No+e+e;case 6165:return Fn+e+No+"flex-"+e+e;case 5187:return Fn+e+Bn(e,/(\w+).+(:[^]+)/,Fn+"box-$1$2"+No+"flex-$1$2")+e;case 5443:return Fn+e+No+"flex-item-"+Bn(e,/flex-|-self/,"")+e;case 4675:return Fn+e+No+"flex-line-pack"+Bn(e,/align-content|flex-|-self/,"")+e;case 5548:return Fn+e+No+Bn(e,"shrink","negative")+e;case 5292:return Fn+e+No+Bn(e,"basis","preferred-size")+e;case 6060:return Fn+"box-"+Bn(e,"-grow","")+Fn+e+No+Bn(e,"grow","positive")+e;case 4554:return Fn+Bn(e,/([^-])(transform)/g,"$1"+Fn+"$2")+e;case 6187:return Bn(Bn(Bn(e,/(zoom-|grab)/,Fn+"$1"),/(image-set)/,Fn+"$1"),e,"")+e;case 5495:case 3959:return Bn(e,/(image-set\([^]*)/,Fn+"$1$`$1");case 4968:return Bn(Bn(e,/(.+:)(flex-)?(.*)/,Fn+"box-pack:$3"+No+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Fn+e+e;case 4095:case 3583:case 4068:case 2532:return Bn(e,/(.+)-inline(.+)/,Fn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Sl(e)-1-t>6)switch(Eo(e,t+1)){case 109:if(Eo(e,t+4)!==45)break;case 102:return Bn(e,/(.+:)(.+)-([^]+)/,"$1"+Fn+"$2-$3$1"+h1+(Eo(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~zE(e,"stretch")?WB(Bn(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(Eo(e,t+1)!==115)break;case 6444:switch(Eo(e,Sl(e)-3-(~zE(e,"!important")&&10))){case 107:return Bn(e,":",":"+Fn)+e;case 101:return Bn(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Fn+(Eo(e,14)===45?"inline-":"")+"box$3$1"+Fn+"$2$3$1"+No+"$2box$3")+e}break;case 5936:switch(Eo(e,t+11)){case 114:return Fn+e+No+Bn(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Fn+e+No+Bn(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Fn+e+No+Bn(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Fn+e+No+e+e}return e}var lY=function(t,i,l,d){if(t.length>-1&&!t.return)switch(t.type){case jC:t.return=WB(t.value,t.length);break;case BB:return Ip([s_(t,{value:Bn(t.value,"@","@"+Fn)})],d);case UC:if(t.length)return GZ(t.props,function(y){switch(WZ(y,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Ip([s_(t,{props:[Bn(y,/:(read-\w+)/,":"+h1+"$1")]})],d);case"::placeholder":return Ip([s_(t,{props:[Bn(y,/:(plac\w+)/,":"+Fn+"input-$1")]}),s_(t,{props:[Bn(y,/:(plac\w+)/,":"+h1+"$1")]}),s_(t,{props:[Bn(y,/:(plac\w+)/,No+"input-$1")]})],d)}return""})}},cY=[lY],uY=function(t){var i=t.key;if(i==="css"){var l=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(l,function(ie){var pe=ie.getAttribute("data-emotion");pe.indexOf(" ")!==-1&&(document.head.appendChild(ie),ie.setAttribute("data-s",""))})}var d=t.stylisPlugins||cY,y={},S,R=[];S=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(ie){for(var pe=ie.getAttribute("data-emotion").split(" "),se=1;se<pe.length;se++)y[pe[se]]=!0;R.push(ie)});var a,N=[aY,sY];{var G,q=[eY,rY(function(ie){G.insert(ie)})],X=tY(N.concat(d,q)),oe=function(pe){return Ip(JZ(pe),X)};a=function(pe,se,le,ce){G=le,oe(pe?pe+"{"+se.styles+"}":se.styles),ce&&(te.inserted[se.name]=!0)}}var te={key:i,sheet:new BZ({key:i,container:S,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:y,registered:{},insert:a};return te.sheet.hydrate(R),te},GB={exports:{}},Hn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var go=typeof Symbol=="function"&&Symbol.for,$C=go?Symbol.for("react.element"):60103,WC=go?Symbol.for("react.portal"):60106,vb=go?Symbol.for("react.fragment"):60107,xb=go?Symbol.for("react.strict_mode"):60108,bb=go?Symbol.for("react.profiler"):60114,wb=go?Symbol.for("react.provider"):60109,Sb=go?Symbol.for("react.context"):60110,GC=go?Symbol.for("react.async_mode"):60111,Tb=go?Symbol.for("react.concurrent_mode"):60111,Eb=go?Symbol.for("react.forward_ref"):60112,Mb=go?Symbol.for("react.suspense"):60113,hY=go?Symbol.for("react.suspense_list"):60120,Cb=go?Symbol.for("react.memo"):60115,Ib=go?Symbol.for("react.lazy"):60116,dY=go?Symbol.for("react.block"):60121,fY=go?Symbol.for("react.fundamental"):60117,pY=go?Symbol.for("react.responder"):60118,mY=go?Symbol.for("react.scope"):60119;function Xa(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case $C:switch(e=e.type,e){case GC:case Tb:case vb:case bb:case xb:case Mb:return e;default:switch(e=e&&e.$$typeof,e){case Sb:case Eb:case Ib:case Cb:case wb:return e;default:return t}}case WC:return t}}}function HB(e){return Xa(e)===Tb}Hn.AsyncMode=GC;Hn.ConcurrentMode=Tb;Hn.ContextConsumer=Sb;Hn.ContextProvider=wb;Hn.Element=$C;Hn.ForwardRef=Eb;Hn.Fragment=vb;Hn.Lazy=Ib;Hn.Memo=Cb;Hn.Portal=WC;Hn.Profiler=bb;Hn.StrictMode=xb;Hn.Suspense=Mb;Hn.isAsyncMode=function(e){return HB(e)||Xa(e)===GC};Hn.isConcurrentMode=HB;Hn.isContextConsumer=function(e){return Xa(e)===Sb};Hn.isContextProvider=function(e){return Xa(e)===wb};Hn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===$C};Hn.isForwardRef=function(e){return Xa(e)===Eb};Hn.isFragment=function(e){return Xa(e)===vb};Hn.isLazy=function(e){return Xa(e)===Ib};Hn.isMemo=function(e){return Xa(e)===Cb};Hn.isPortal=function(e){return Xa(e)===WC};Hn.isProfiler=function(e){return Xa(e)===bb};Hn.isStrictMode=function(e){return Xa(e)===xb};Hn.isSuspense=function(e){return Xa(e)===Mb};Hn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===vb||e===Tb||e===bb||e===xb||e===Mb||e===hY||typeof e=="object"&&e!==null&&(e.$$typeof===Ib||e.$$typeof===Cb||e.$$typeof===wb||e.$$typeof===Sb||e.$$typeof===Eb||e.$$typeof===fY||e.$$typeof===pY||e.$$typeof===mY||e.$$typeof===dY)};Hn.typeOf=Xa;GB.exports=Hn;var gY=GB.exports,qB=gY,_Y={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},yY={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},ZB={};ZB[qB.ForwardRef]=_Y;ZB[qB.Memo]=yY;var vY=!0;function YB(e,t,i){var l="";return i.split(" ").forEach(function(d){e[d]!==void 0?t.push(e[d]+";"):d&&(l+=d+" ")}),l}var HC=function(t,i,l){var d=t.key+"-"+i.name;(l===!1||vY===!1)&&t.registered[d]===void 0&&(t.registered[d]=i.styles)},qC=function(t,i,l){HC(t,i,l);var d=t.key+"-"+i.name;if(t.inserted[i.name]===void 0){var y=i;do t.insert(i===y?"."+d:"",y,t.sheet,!0),y=y.next;while(y!==void 0)}};function xY(e){for(var t=0,i,l=0,d=e.length;d>=4;++l,d-=4)i=e.charCodeAt(l)&255|(e.charCodeAt(++l)&255)<<8|(e.charCodeAt(++l)&255)<<16|(e.charCodeAt(++l)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,t=(i&65535)*1540483477+((i>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(d){case 3:t^=(e.charCodeAt(l+2)&255)<<16;case 2:t^=(e.charCodeAt(l+1)&255)<<8;case 1:t^=e.charCodeAt(l)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var bY={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},wY=!1,SY=/[A-Z]|^ms/g,TY=/_EMO_([^_]+?)_([^]*?)_EMO_/g,XB=function(t){return t.charCodeAt(1)===45},$k=function(t){return t!=null&&typeof t!="boolean"},pT=$B(function(e){return XB(e)?e:e.replace(SY,"-$&").toLowerCase()}),Wk=function(t,i){switch(t){case"animation":case"animationName":if(typeof i=="string")return i.replace(TY,function(l,d,y){return Tl={name:d,styles:y,next:Tl},d})}return bY[t]!==1&&!XB(t)&&typeof i=="number"&&i!==0?i+"px":i},EY="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function iy(e,t,i){if(i==null)return"";var l=i;if(l.__emotion_styles!==void 0)return l;switch(typeof i){case"boolean":return"";case"object":{var d=i;if(d.anim===1)return Tl={name:d.name,styles:d.styles,next:Tl},d.name;var y=i;if(y.styles!==void 0){var S=y.next;if(S!==void 0)for(;S!==void 0;)Tl={name:S.name,styles:S.styles,next:Tl},S=S.next;var R=y.styles+";";return R}return MY(e,t,i)}case"function":{if(e!==void 0){var a=Tl,N=i(e);return Tl=a,iy(e,t,N)}break}}var G=i;if(t==null)return G;var q=t[G];return q!==void 0?q:G}function MY(e,t,i){var l="";if(Array.isArray(i))for(var d=0;d<i.length;d++)l+=iy(e,t,i[d])+";";else for(var y in i){var S=i[y];if(typeof S!="object"){var R=S;t!=null&&t[R]!==void 0?l+=y+"{"+t[R]+"}":$k(R)&&(l+=pT(y)+":"+Wk(y,R)+";")}else{if(y==="NO_COMPONENT_SELECTOR"&&wY)throw new Error(EY);if(Array.isArray(S)&&typeof S[0]=="string"&&(t==null||t[S[0]]===void 0))for(var a=0;a<S.length;a++)$k(S[a])&&(l+=pT(y)+":"+Wk(y,S[a])+";");else{var N=iy(e,t,S);switch(y){case"animation":case"animationName":{l+=pT(y)+":"+N+";";break}default:l+=y+"{"+N+"}"}}}}return l}var Gk=/label:\s*([^\s;{]+)\s*(;|$)/g,Tl;function Py(e,t,i){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var l=!0,d="";Tl=void 0;var y=e[0];if(y==null||y.raw===void 0)l=!1,d+=iy(i,t,y);else{var S=y;d+=S[0]}for(var R=1;R<e.length;R++)if(d+=iy(i,t,e[R]),l){var a=y;d+=a[R]}Gk.lastIndex=0;for(var N="",G;(G=Gk.exec(d))!==null;)N+="-"+G[1];var q=xY(d)+N;return{name:q,styles:d,next:Tl}}var CY=function(t){return t()},KB=bx.useInsertionEffect?bx.useInsertionEffect:!1,JB=KB||CY,Hk=KB||we.useLayoutEffect,IY=!1,QB=we.createContext(typeof HTMLElement<"u"?uY({key:"css"}):null);QB.Provider;var ZC=function(t){return we.forwardRef(function(i,l){var d=we.useContext(QB);return t(i,d,l)})},Pb=we.createContext({}),YC={}.hasOwnProperty,BE="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",PY=function(t,i){var l={};for(var d in i)YC.call(i,d)&&(l[d]=i[d]);return l[BE]=t,l},AY=function(t){var i=t.cache,l=t.serialized,d=t.isStringTag;return HC(i,l,d),JB(function(){return qC(i,l,d)}),null},DY=ZC(function(e,t,i){var l=e.css;typeof l=="string"&&t.registered[l]!==void 0&&(l=t.registered[l]);var d=e[BE],y=[l],S="";typeof e.className=="string"?S=YB(t.registered,y,e.className):e.className!=null&&(S=e.className+" ");var R=Py(y,void 0,we.useContext(Pb));S+=t.key+"-"+R.name;var a={};for(var N in e)YC.call(e,N)&&N!=="css"&&N!==BE&&!IY&&(a[N]=e[N]);return a.className=S,i&&(a.ref=i),we.createElement(we.Fragment,null,we.createElement(AY,{cache:t,serialized:R,isStringTag:typeof d=="string"}),we.createElement(d,a))}),RY=DY,qk=function(t,i){var l=arguments;if(i==null||!YC.call(i,"css"))return we.createElement.apply(void 0,l);var d=l.length,y=new Array(d);y[0]=RY,y[1]=PY(t,i);for(var S=2;S<d;S++)y[S]=l[S];return we.createElement.apply(null,y)};(function(e){var t;t||(t=e.JSX||(e.JSX={}))})(qk||(qk={}));var kY=ZC(function(e,t){var i=e.styles,l=Py([i],void 0,we.useContext(Pb)),d=we.useRef();return Hk(function(){var y=t.key+"-global",S=new t.sheet.constructor({key:y,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),R=!1,a=document.querySelector('style[data-emotion="'+y+" "+l.name+'"]');return t.sheet.tags.length&&(S.before=t.sheet.tags[0]),a!==null&&(R=!0,a.setAttribute("data-emotion",y),S.hydrate([a])),d.current=[S,R],function(){S.flush()}},[t]),Hk(function(){var y=d.current,S=y[0],R=y[1];if(R){y[1]=!1;return}if(l.next!==void 0&&qC(t,l.next,!0),S.tags.length){var a=S.tags[S.tags.length-1].nextElementSibling;S.before=a,S.flush()}t.insert("",l,S,!1)},[t,l.name]),null});function XC(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return Py(t)}function Ay(){var e=XC.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}var OY=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,LY=$B(function(e){return OY.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91}),zY=!1,FY=LY,BY=function(t){return t!=="theme"},Zk=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?FY:BY},Yk=function(t,i,l){var d;if(i){var y=i.shouldForwardProp;d=t.__emotion_forwardProp&&y?function(S){return t.__emotion_forwardProp(S)&&y(S)}:y}return typeof d!="function"&&l&&(d=t.__emotion_forwardProp),d},NY=function(t){var i=t.cache,l=t.serialized,d=t.isStringTag;return HC(i,l,d),JB(function(){return qC(i,l,d)}),null},UY=function e(t,i){var l=t.__emotion_real===t,d=l&&t.__emotion_base||t,y,S;i!==void 0&&(y=i.label,S=i.target);var R=Yk(t,i,l),a=R||Zk(d),N=!a("as");return function(){var G=arguments,q=l&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(y!==void 0&&q.push("label:"+y+";"),G[0]==null||G[0].raw===void 0)q.push.apply(q,G);else{var X=G[0];q.push(X[0]);for(var oe=G.length,te=1;te<oe;te++)q.push(G[te],X[te])}var ie=ZC(function(pe,se,le){var ce=N&&pe.as||d,Me="",Le=[],Je=pe;if(pe.theme==null){Je={};for(var Qe in pe)Je[Qe]=pe[Qe];Je.theme=we.useContext(Pb)}typeof pe.className=="string"?Me=YB(se.registered,Le,pe.className):pe.className!=null&&(Me=pe.className+" ");var je=Py(q.concat(Le),se.registered,Je);Me+=se.key+"-"+je.name,S!==void 0&&(Me+=" "+S);var Ct=N&&R===void 0?Zk(ce):a,ye={};for(var et in pe)N&&et==="as"||Ct(et)&&(ye[et]=pe[et]);return ye.className=Me,le&&(ye.ref=le),we.createElement(we.Fragment,null,we.createElement(NY,{cache:se,serialized:je,isStringTag:typeof ce=="string"}),we.createElement(ce,ye))});return ie.displayName=y!==void 0?y:"Styled("+(typeof d=="string"?d:d.displayName||d.name||"Component")+")",ie.defaultProps=t.defaultProps,ie.__emotion_real=ie,ie.__emotion_base=d,ie.__emotion_styles=q,ie.__emotion_forwardProp=R,Object.defineProperty(ie,"toString",{value:function(){return S===void 0&&zY?"NO_COMPONENT_SELECTOR":"."+S}}),ie.withComponent=function(pe,se){var le=e(pe,u1({},i,se,{shouldForwardProp:Yk(ie,se,!0)}));return le.apply(void 0,q)},ie}},jY=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],NE=UY.bind(null);jY.forEach(function(e){NE[e]=NE(e)});var e5={exports:{}},Ab={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VY=we,$Y=Symbol.for("react.element"),WY=Symbol.for("react.fragment"),GY=Object.prototype.hasOwnProperty,HY=VY.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qY={key:!0,ref:!0,__self:!0,__source:!0};function t5(e,t,i){var l,d={},y=null,S=null;i!==void 0&&(y=""+i),t.key!==void 0&&(y=""+t.key),t.ref!==void 0&&(S=t.ref);for(l in t)GY.call(t,l)&&!qY.hasOwnProperty(l)&&(d[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps,t)d[l]===void 0&&(d[l]=t[l]);return{$$typeof:$Y,type:e,key:y,ref:S,props:d,_owner:HY.current}}Ab.Fragment=WY;Ab.jsx=t5;Ab.jsxs=t5;e5.exports=Ab;var Kt=e5.exports;function ZY(e){return e==null||Object.keys(e).length===0}function YY(e){const{styles:t,defaultTheme:i={}}=e,l=typeof t=="function"?d=>t(ZY(d)?i:d):t;return Kt.jsx(kY,{styles:l})}/**
 * @mui/styled-engine v6.2.1
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function r5(e,t){return NE(e,t)}function XY(e,t){Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}const Xk=[];function Kk(e){return Xk[0]=e,Py(Xk)}const KY=e=>{const t=Object.keys(e).map(i=>({key:i,val:e[i]}))||[];return t.sort((i,l)=>i.val-l.val),t.reduce((i,l)=>({...i,[l.key]:l.val}),{})};function JY(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:i="px",step:l=5,...d}=e,y=KY(t),S=Object.keys(y);function R(X){return`@media (min-width:${typeof t[X]=="number"?t[X]:X}${i})`}function a(X){return`@media (max-width:${(typeof t[X]=="number"?t[X]:X)-l/100}${i})`}function N(X,oe){const te=S.indexOf(oe);return`@media (min-width:${typeof t[X]=="number"?t[X]:X}${i}) and (max-width:${(te!==-1&&typeof t[S[te]]=="number"?t[S[te]]:oe)-l/100}${i})`}function G(X){return S.indexOf(X)+1<S.length?N(X,S[S.indexOf(X)+1]):R(X)}function q(X){const oe=S.indexOf(X);return oe===0?R(S[1]):oe===S.length-1?a(S[oe]):N(X,S[S.indexOf(X)+1]).replace("@media","@media not all and")}return{keys:S,values:y,up:R,down:a,between:N,only:G,not:q,unit:i,...d}}const QY={borderRadius:4};function n5(e=8,t=BC({spacing:e})){if(e.mui)return e;const i=(...l)=>(l.length===0?[1]:l).map(y=>{const S=t(y);return typeof S=="number"?`${S}px`:S}).join(" ");return i.mui=!0,i}function eX(e,t){var l;const i=this;if(i.vars){if(!((l=i.colorSchemes)!=null&&l[e])||typeof i.getColorSchemeSelector!="function")return{};let d=i.getColorSchemeSelector(e);return d==="&"?t:((d.includes("data-")||d.includes("."))&&(d=`*:where(${d.replace(/\s*&$/,"")}) &`),{[d]:t})}return i.palette.mode===e?t:{}}function KC(e={},...t){const{breakpoints:i={},palette:l={},spacing:d,shape:y={},...S}=e,R=JY(i),a=n5(d);let N=Vo({breakpoints:R,direction:"ltr",components:{},palette:{mode:"light",...l},spacing:a,shape:{...QY,...y}},S);return N=G9(N),N.applyStyles=eX,N=t.reduce((G,q)=>Vo(G,q),N),N.unstable_sxConfig={...Cy,...S==null?void 0:S.unstable_sxConfig},N.unstable_sx=function(q){return xd({sx:q,theme:this})},N}function tX(e){return Object.keys(e).length===0}function rX(e=null){const t=we.useContext(Pb);return!t||tX(t)?e:t}const nX=KC();function JC(e=nX){return rX(e)}function iX({styles:e,themeId:t,defaultTheme:i={}}){const l=JC(i),d=typeof e=="function"?e(t&&l[t]||l):e;return Kt.jsx(YY,{styles:d})}function oX(e={}){const{themeId:t,defaultTheme:i,defaultClassName:l="MuiBox-root",generateClassName:d}=e,y=r5("div",{shouldForwardProp:R=>R!=="theme"&&R!=="sx"&&R!=="as"})(xd);return we.forwardRef(function(a,N){const G=JC(i),{className:q,component:X="div",...oe}=zB(a);return Kt.jsx(y,{as:X,ref:N,className:ln(q,d?d(l):l),theme:t&&G[t]||G,...oe})})}function i5(e){const{variants:t,...i}=e,l={variants:t,style:Kk(i),isProcessed:!0};return l.style===i||t&&t.forEach(d=>{typeof d.style!="function"&&(d.style=Kk(d.style))}),l}const aX=KC();function mT(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}function sX(e){return e?(t,i)=>i[e]:null}function lX(e,t,i){e.theme=hX(e.theme)?i:e.theme[t]||e.theme}function xx(e,t){const i=typeof t=="function"?t(e):t;if(Array.isArray(i))return i.flatMap(l=>xx(e,l));if(Array.isArray(i==null?void 0:i.variants)){let l;if(i.isProcessed)l=i.style;else{const{variants:d,...y}=i;l=y}return o5(e,i.variants,[l])}return i!=null&&i.isProcessed?i.style:i}function o5(e,t,i=[]){var d;let l;e:for(let y=0;y<t.length;y+=1){const S=t[y];if(typeof S.props=="function"){if(l??(l={...e,...e.ownerState,ownerState:e.ownerState}),!S.props(l))continue}else for(const R in S.props)if(e[R]!==S.props[R]&&((d=e.ownerState)==null?void 0:d[R])!==S.props[R])continue e;typeof S.style=="function"?(l??(l={...e,...e.ownerState,ownerState:e.ownerState}),i.push(S.style(l))):i.push(S.style)}return i}function cX(e={}){const{themeId:t,defaultTheme:i=aX,rootShouldForwardProp:l=mT,slotShouldForwardProp:d=mT}=e;function y(R){lX(R,t,i)}return(R,a={})=>{XY(R,Le=>Le.filter(Je=>Je!==xd));const{name:N,slot:G,skipVariantsResolver:q,skipSx:X,overridesResolver:oe=sX(fX(G)),...te}=a,ie=q!==void 0?q:G&&G!=="Root"&&G!=="root"||!1,pe=X||!1;let se=mT;G==="Root"||G==="root"?se=l:G?se=d:dX(R)&&(se=void 0);const le=r5(R,{shouldForwardProp:se,label:uX(),...te}),ce=Le=>{if(typeof Le=="function"&&Le.__emotion_real!==Le)return function(Qe){return xx(Qe,Le)};if(Il(Le)){const Je=i5(Le);return Je.variants?function(je){return xx(je,Je)}:Je.style}return Le},Me=(...Le)=>{const Je=[],Qe=Le.map(ce),je=[];if(Je.push(y),N&&oe&&je.push(function(dt){var gt,Ze;const Mt=(Ze=(gt=dt.theme.components)==null?void 0:gt[N])==null?void 0:Ze.styleOverrides;if(!Mt)return null;const yt={};for(const ht in Mt)yt[ht]=xx(dt,Mt[ht]);return oe(dt,yt)}),N&&!ie&&je.push(function(dt){var yt,gt;const Xt=dt.theme,Mt=(gt=(yt=Xt==null?void 0:Xt.components)==null?void 0:yt[N])==null?void 0:gt.variants;return Mt?o5(dt,Mt):null}),pe||je.push(xd),Array.isArray(Qe[0])){const et=Qe.shift(),dt=new Array(Je.length).fill(""),Xt=new Array(je.length).fill("");let Mt;Mt=[...dt,...et,...Xt],Mt.raw=[...dt,...et.raw,...Xt],Je.unshift(Mt)}const Ct=[...Je,...Qe,...je],ye=le(...Ct);return R.muiName&&(ye.muiName=R.muiName),ye};return le.withConfig&&(Me.withConfig=le.withConfig),Me}}function uX(e,t){return void 0}function hX(e){for(const t in e)return!1;return!0}function dX(e){return typeof e=="string"&&e.charCodeAt(0)>96}function fX(e){return e&&e.charAt(0).toLowerCase()+e.slice(1)}function QC(e,t=0,i=1){return U9(e,t,i)}function pX(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let i=e.match(t);return i&&i[0].length===1&&(i=i.map(l=>l+l)),i?`rgb${i.length===4?"a":""}(${i.map((l,d)=>d<3?parseInt(l,16):Math.round(parseInt(l,16)/255*1e3)/1e3).join(", ")})`:""}function Hu(e){if(e.type)return e;if(e.charAt(0)==="#")return Hu(pX(e));const t=e.indexOf("("),i=e.substring(0,t);if(!["rgb","rgba","hsl","hsla","color"].includes(i))throw new Error(_c(9,e));let l=e.substring(t+1,e.length-1),d;if(i==="color"){if(l=l.split(" "),d=l.shift(),l.length===4&&l[3].charAt(0)==="/"&&(l[3]=l[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(d))throw new Error(_c(10,d))}else l=l.split(",");return l=l.map(y=>parseFloat(y)),{type:i,values:l,colorSpace:d}}const mX=e=>{const t=Hu(e);return t.values.slice(0,3).map((i,l)=>t.type.includes("hsl")&&l!==0?`${i}%`:i).join(" ")},g_=(e,t)=>{try{return mX(e)}catch{return e}};function Db(e){const{type:t,colorSpace:i}=e;let{values:l}=e;return t.includes("rgb")?l=l.map((d,y)=>y<3?parseInt(d,10):d):t.includes("hsl")&&(l[1]=`${l[1]}%`,l[2]=`${l[2]}%`),t.includes("color")?l=`${i} ${l.join(" ")}`:l=`${l.join(", ")}`,`${t}(${l})`}function a5(e){e=Hu(e);const{values:t}=e,i=t[0],l=t[1]/100,d=t[2]/100,y=l*Math.min(d,1-d),S=(N,G=(N+i/30)%12)=>d-y*Math.max(Math.min(G-3,9-G,1),-1);let R="rgb";const a=[Math.round(S(0)*255),Math.round(S(8)*255),Math.round(S(4)*255)];return e.type==="hsla"&&(R+="a",a.push(t[3])),Db({type:R,values:a})}function UE(e){e=Hu(e);let t=e.type==="hsl"||e.type==="hsla"?Hu(a5(e)).values:e.values;return t=t.map(i=>(e.type!=="color"&&(i/=255),i<=.03928?i/12.92:((i+.055)/1.055)**2.4)),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function gX(e,t){const i=UE(e),l=UE(t);return(Math.max(i,l)+.05)/(Math.min(i,l)+.05)}function _s(e,t){return e=Hu(e),t=QC(t),(e.type==="rgb"||e.type==="hsl")&&(e.type+="a"),e.type==="color"?e.values[3]=`/${t}`:e.values[3]=t,Db(e)}function Xv(e,t,i){try{return _s(e,t)}catch{return e}}function Rb(e,t){if(e=Hu(e),t=QC(t),e.type.includes("hsl"))e.values[2]*=1-t;else if(e.type.includes("rgb")||e.type.includes("color"))for(let i=0;i<3;i+=1)e.values[i]*=1-t;return Db(e)}function ii(e,t,i){try{return Rb(e,t)}catch{return e}}function kb(e,t){if(e=Hu(e),t=QC(t),e.type.includes("hsl"))e.values[2]+=(100-e.values[2])*t;else if(e.type.includes("rgb"))for(let i=0;i<3;i+=1)e.values[i]+=(255-e.values[i])*t;else if(e.type.includes("color"))for(let i=0;i<3;i+=1)e.values[i]+=(1-e.values[i])*t;return Db(e)}function oi(e,t,i){try{return kb(e,t)}catch{return e}}function _X(e,t=.15){return UE(e)>.5?Rb(e,t):kb(e,t)}function Kv(e,t,i){try{return _X(e,t)}catch{return e}}const yX=we.createContext(),vX=()=>we.useContext(yX)??!1,xX=we.createContext(void 0);function bX(e){const{theme:t,name:i,props:l}=e;if(!t||!t.components||!t.components[i])return l;const d=t.components[i];return d.defaultProps?l1(d.defaultProps,l):!d.styleOverrides&&!d.variants?l1(d,l):l}function wX({props:e,name:t}){const i=we.useContext(xX);return bX({props:e,name:t,theme:{components:i}})}const Jk={theme:void 0};function SX(e){let t,i;return function(d){let y=t;return(y===void 0||d.theme!==i)&&(Jk.theme=d.theme,y=i5(e(Jk)),t=y,i=d.theme),y}}function TX(e=""){function t(...l){if(!l.length)return"";const d=l[0];return typeof d=="string"&&!d.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${e?`${e}-`:""}${d}${t(...l.slice(1))})`:`, ${d}`}return(l,...d)=>`var(--${e?`${e}-`:""}${l}${t(...d)})`}const Qk=(e,t,i,l=[])=>{let d=e;t.forEach((y,S)=>{S===t.length-1?Array.isArray(d)?d[Number(y)]=i:d&&typeof d=="object"&&(d[y]=i):d&&typeof d=="object"&&(d[y]||(d[y]=l.includes(y)?[]:{}),d=d[y])})},EX=(e,t,i)=>{function l(d,y=[],S=[]){Object.entries(d).forEach(([R,a])=>{(!i||i&&!i([...y,R]))&&a!=null&&(typeof a=="object"&&Object.keys(a).length>0?l(a,[...y,R],Array.isArray(a)?[...S,R]:S):t([...y,R],a,S))})}l(e)},MX=(e,t)=>typeof t=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(l=>e.includes(l))||e[e.length-1].toLowerCase().includes("opacity")?t:`${t}px`:t;function gT(e,t){const{prefix:i,shouldSkipGeneratingVar:l}=t||{},d={},y={},S={};return EX(e,(R,a,N)=>{if((typeof a=="string"||typeof a=="number")&&(!l||!l(R,a))){const G=`--${i?`${i}-`:""}${R.join("-")}`,q=MX(R,a);Object.assign(d,{[G]:q}),Qk(y,R,`var(${G})`,N),Qk(S,R,`var(${G}, ${q})`,N)}},R=>R[0]==="vars"),{css:d,vars:y,varsWithDefaults:S}}function CX(e,t={}){const{getSelector:i=pe,disableCssColorScheme:l,colorSchemeSelector:d}=t,{colorSchemes:y={},components:S,defaultColorScheme:R="light",...a}=e,{vars:N,css:G,varsWithDefaults:q}=gT(a,t);let X=q;const oe={},{[R]:te,...ie}=y;if(Object.entries(ie||{}).forEach(([ce,Me])=>{const{vars:Le,css:Je,varsWithDefaults:Qe}=gT(Me,t);X=Vo(X,Qe),oe[ce]={css:Je,vars:Le}}),te){const{css:ce,vars:Me,varsWithDefaults:Le}=gT(te,t);X=Vo(X,Le),oe[R]={css:ce,vars:Me}}function pe(ce,Me){var Je,Qe;let Le=d;if(d==="class"&&(Le=".%s"),d==="data"&&(Le="[data-%s]"),d!=null&&d.startsWith("data-")&&!d.includes("%s")&&(Le=`[${d}="%s"]`),ce){if(Le==="media")return e.defaultColorScheme===ce?":root":{[`@media (prefers-color-scheme: ${((Qe=(Je=y[ce])==null?void 0:Je.palette)==null?void 0:Qe.mode)||ce})`]:{":root":Me}};if(Le)return e.defaultColorScheme===ce?`:root, ${Le.replace("%s",String(ce))}`:Le.replace("%s",String(ce))}return":root"}return{vars:X,generateThemeVars:()=>{let ce={...N};return Object.entries(oe).forEach(([,{vars:Me}])=>{ce=Vo(ce,Me)}),ce},generateStyleSheets:()=>{var je,Ct;const ce=[],Me=e.defaultColorScheme||"light";function Le(ye,et){Object.keys(et).length&&ce.push(typeof ye=="string"?{[ye]:{...et}}:ye)}Le(i(void 0,{...G}),G);const{[Me]:Je,...Qe}=oe;if(Je){const{css:ye}=Je,et=(Ct=(je=y[Me])==null?void 0:je.palette)==null?void 0:Ct.mode,dt=!l&&et?{colorScheme:et,...ye}:{...ye};Le(i(Me,{...dt}),dt)}return Object.entries(Qe).forEach(([ye,{css:et}])=>{var Mt,yt;const dt=(yt=(Mt=y[ye])==null?void 0:Mt.palette)==null?void 0:yt.mode,Xt=!l&&dt?{colorScheme:dt,...et}:{...et};Le(i(ye,{...Xt}),Xt)}),ce}}}function IX(e){return function(i){return e==="media"?`@media (prefers-color-scheme: ${i})`:e?e.startsWith("data-")&&!e.includes("%s")?`[${e}="${i}"] &`:e==="class"?`.${i} &`:e==="data"?`[data-${i}] &`:`${e.replace("%s",i)} &`:"&"}}const oy={black:"#000",white:"#fff"},PX={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Yf={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},Xf={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},l_={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Kf={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},Jf={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},Qf={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"};function s5(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:oy.white,default:oy.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const AX=s5();function l5(){return{text:{primary:oy.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:oy.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const eO=l5();function tO(e,t,i,l){const d=l.light||l,y=l.dark||l*1.5;e[t]||(e.hasOwnProperty(i)?e[t]=e[i]:t==="light"?e.light=kb(e.main,d):t==="dark"&&(e.dark=Rb(e.main,y)))}function DX(e="light"){return e==="dark"?{main:Kf[200],light:Kf[50],dark:Kf[400]}:{main:Kf[700],light:Kf[400],dark:Kf[800]}}function RX(e="light"){return e==="dark"?{main:Yf[200],light:Yf[50],dark:Yf[400]}:{main:Yf[500],light:Yf[300],dark:Yf[700]}}function kX(e="light"){return e==="dark"?{main:Xf[500],light:Xf[300],dark:Xf[700]}:{main:Xf[700],light:Xf[400],dark:Xf[800]}}function OX(e="light"){return e==="dark"?{main:Jf[400],light:Jf[300],dark:Jf[700]}:{main:Jf[700],light:Jf[500],dark:Jf[900]}}function LX(e="light"){return e==="dark"?{main:Qf[400],light:Qf[300],dark:Qf[700]}:{main:Qf[800],light:Qf[500],dark:Qf[900]}}function zX(e="light"){return e==="dark"?{main:l_[400],light:l_[300],dark:l_[700]}:{main:"#ed6c02",light:l_[500],dark:l_[900]}}function eI(e){const{mode:t="light",contrastThreshold:i=3,tonalOffset:l=.2,...d}=e,y=e.primary||DX(t),S=e.secondary||RX(t),R=e.error||kX(t),a=e.info||OX(t),N=e.success||LX(t),G=e.warning||zX(t);function q(ie){return gX(ie,eO.text.primary)>=i?eO.text.primary:AX.text.primary}const X=({color:ie,name:pe,mainShade:se=500,lightShade:le=300,darkShade:ce=700})=>{if(ie={...ie},!ie.main&&ie[se]&&(ie.main=ie[se]),!ie.hasOwnProperty("main"))throw new Error(_c(11,pe?` (${pe})`:"",se));if(typeof ie.main!="string")throw new Error(_c(12,pe?` (${pe})`:"",JSON.stringify(ie.main)));return tO(ie,"light",le,l),tO(ie,"dark",ce,l),ie.contrastText||(ie.contrastText=q(ie.main)),ie};let oe;return t==="light"?oe=s5():t==="dark"&&(oe=l5()),Vo({common:{...oy},mode:t,primary:X({color:y,name:"primary"}),secondary:X({color:S,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:X({color:R,name:"error"}),warning:X({color:G,name:"warning"}),info:X({color:a,name:"info"}),success:X({color:N,name:"success"}),grey:PX,contrastThreshold:i,getContrastText:q,augmentColor:X,tonalOffset:l,...oe},d)}function FX(e){const t={};return Object.entries(e).forEach(l=>{const[d,y]=l;typeof y=="object"&&(t[d]=`${y.fontStyle?`${y.fontStyle} `:""}${y.fontVariant?`${y.fontVariant} `:""}${y.fontWeight?`${y.fontWeight} `:""}${y.fontStretch?`${y.fontStretch} `:""}${y.fontSize||""}${y.lineHeight?`/${y.lineHeight} `:""}${y.fontFamily||""}`)}),t}function BX(e,t){return{toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}},...t}}function NX(e){return Math.round(e*1e5)/1e5}const rO={textTransform:"uppercase"},nO='"Roboto", "Helvetica", "Arial", sans-serif';function UX(e,t){const{fontFamily:i=nO,fontSize:l=14,fontWeightLight:d=300,fontWeightRegular:y=400,fontWeightMedium:S=500,fontWeightBold:R=700,htmlFontSize:a=16,allVariants:N,pxToRem:G,...q}=typeof t=="function"?t(e):t,X=l/14,oe=G||(pe=>`${pe/a*X}rem`),te=(pe,se,le,ce,Me)=>({fontFamily:i,fontWeight:pe,fontSize:oe(se),lineHeight:le,...i===nO?{letterSpacing:`${NX(ce/se)}em`}:{},...Me,...N}),ie={h1:te(d,96,1.167,-1.5),h2:te(d,60,1.2,-.5),h3:te(y,48,1.167,0),h4:te(y,34,1.235,.25),h5:te(y,24,1.334,0),h6:te(S,20,1.6,.15),subtitle1:te(y,16,1.75,.15),subtitle2:te(S,14,1.57,.1),body1:te(y,16,1.5,.15),body2:te(y,14,1.43,.15),button:te(S,14,1.75,.4,rO),caption:te(y,12,1.66,.4),overline:te(y,12,2.66,1,rO),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Vo({htmlFontSize:a,pxToRem:oe,fontFamily:i,fontSize:l,fontWeightLight:d,fontWeightRegular:y,fontWeightMedium:S,fontWeightBold:R,...ie},q,{clone:!1})}const jX=.2,VX=.14,$X=.12;function xi(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,${jX})`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,${VX})`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,${$X})`].join(",")}const WX=["none",xi(0,2,1,-1,0,1,1,0,0,1,3,0),xi(0,3,1,-2,0,2,2,0,0,1,5,0),xi(0,3,3,-2,0,3,4,0,0,1,8,0),xi(0,2,4,-1,0,4,5,0,0,1,10,0),xi(0,3,5,-1,0,5,8,0,0,1,14,0),xi(0,3,5,-1,0,6,10,0,0,1,18,0),xi(0,4,5,-2,0,7,10,1,0,2,16,1),xi(0,5,5,-3,0,8,10,1,0,3,14,2),xi(0,5,6,-3,0,9,12,1,0,3,16,2),xi(0,6,6,-3,0,10,14,1,0,4,18,3),xi(0,6,7,-4,0,11,15,1,0,4,20,3),xi(0,7,8,-4,0,12,17,2,0,5,22,4),xi(0,7,8,-4,0,13,19,2,0,5,24,4),xi(0,7,9,-4,0,14,21,2,0,5,26,4),xi(0,8,9,-5,0,15,22,2,0,6,28,5),xi(0,8,10,-5,0,16,24,2,0,6,30,5),xi(0,8,11,-5,0,17,26,2,0,6,32,5),xi(0,9,11,-5,0,18,28,2,0,7,34,6),xi(0,9,12,-6,0,19,29,2,0,7,36,6),xi(0,10,13,-6,0,20,31,3,0,8,38,7),xi(0,10,13,-6,0,21,33,3,0,8,40,7),xi(0,10,14,-6,0,22,35,3,0,8,42,7),xi(0,11,14,-7,0,23,36,3,0,9,44,8),xi(0,11,15,-7,0,24,38,3,0,9,46,8)],GX={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},HX={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function iO(e){return`${Math.round(e)}ms`}function qX(e){if(!e)return 0;const t=e/36;return Math.min(Math.round((4+15*t**.25+t/5)*10),3e3)}function ZX(e){const t={...GX,...e.easing},i={...HX,...e.duration};return{getAutoHeightDuration:qX,create:(d=["all"],y={})=>{const{duration:S=i.standard,easing:R=t.easeInOut,delay:a=0,...N}=y;return(Array.isArray(d)?d:[d]).map(G=>`${G} ${typeof S=="string"?S:iO(S)} ${R} ${typeof a=="string"?a:iO(a)}`).join(",")},...e,easing:t,duration:i}}const YX={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function XX(e){return Il(e)||typeof e>"u"||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||Array.isArray(e)}function c5(e={}){const t={...e};function i(l){const d=Object.entries(l);for(let y=0;y<d.length;y++){const[S,R]=d[y];!XX(R)||S.startsWith("unstable_")?delete l[S]:Il(R)&&(l[S]={...R},i(l[S]))}}return i(t),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(t,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function jE(e={},...t){const{breakpoints:i,mixins:l={},spacing:d,palette:y={},transitions:S={},typography:R={},shape:a,...N}=e;if(e.vars)throw new Error(_c(20));const G=eI(y),q=KC(e);let X=Vo(q,{mixins:BX(q.breakpoints,l),palette:G,shadows:WX.slice(),typography:UX(G,R),transitions:ZX(S),zIndex:{...YX}});return X=Vo(X,N),X=t.reduce((oe,te)=>Vo(oe,te),X),X.unstable_sxConfig={...Cy,...N==null?void 0:N.unstable_sxConfig},X.unstable_sx=function(te){return xd({sx:te,theme:this})},X.toRuntimeSource=c5,X}function VE(e){let t;return e<1?t=5.11916*e**2:t=4.5*Math.log(e+1)+2,Math.round(t*10)/1e3}const KX=[...Array(25)].map((e,t)=>{if(t===0)return"none";const i=VE(t);return`linear-gradient(rgba(255 255 255 / ${i}), rgba(255 255 255 / ${i}))`});function u5(e){return{inputPlaceholder:e==="dark"?.5:.42,inputUnderline:e==="dark"?.7:.42,switchTrackDisabled:e==="dark"?.2:.12,switchTrack:e==="dark"?.3:.38}}function h5(e){return e==="dark"?KX:[]}function JX(e){const{palette:t={mode:"light"},opacity:i,overlays:l,...d}=e,y=eI(t);return{palette:y,opacity:{...u5(y.mode),...i},overlays:l||h5(y.mode),...d}}function QX(e){var t;return!!e[0].match(/(cssVarPrefix|colorSchemeSelector|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!e[0].match(/sxConfig$/)||e[0]==="palette"&&!!((t=e[1])!=null&&t.match(/(mode|contrastThreshold|tonalOffset)/))}const eK=e=>[...[...Array(25)].map((t,i)=>`--${e?`${e}-`:""}overlays-${i}`),`--${e?`${e}-`:""}palette-AppBar-darkBg`,`--${e?`${e}-`:""}palette-AppBar-darkColor`],tK=e=>(t,i)=>{const l=e.rootSelector||":root",d=e.colorSchemeSelector;let y=d;if(d==="class"&&(y=".%s"),d==="data"&&(y="[data-%s]"),d!=null&&d.startsWith("data-")&&!d.includes("%s")&&(y=`[${d}="%s"]`),e.defaultColorScheme===t){if(t==="dark"){const S={};return eK(e.cssVarPrefix).forEach(R=>{S[R]=i[R],delete i[R]}),y==="media"?{[l]:i,"@media (prefers-color-scheme: dark)":{[l]:S}}:y?{[y.replace("%s",t)]:S,[`${l}, ${y.replace("%s",t)}`]:i}:{[l]:{...i,...S}}}if(y&&y!=="media")return`${l}, ${y.replace("%s",String(t))}`}else if(t){if(y==="media")return{[`@media (prefers-color-scheme: ${String(t)})`]:{[l]:i}};if(y)return y.replace("%s",String(t))}return l};function rK(e,t){t.forEach(i=>{e[i]||(e[i]={})})}function Lt(e,t,i){!e[t]&&i&&(e[t]=i)}function __(e){return typeof e!="string"||!e.startsWith("hsl")?e:a5(e)}function rc(e,t){`${t}Channel`in e||(e[`${t}Channel`]=g_(__(e[t]),`MUI: Can't create \`palette.${t}Channel\` because \`palette.${t}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${t}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function nK(e){return typeof e=="number"?`${e}px`:typeof e=="string"||typeof e=="function"||Array.isArray(e)?e:"8px"}const vl=e=>{try{return e()}catch{}},iK=(e="mui")=>TX(e);function _T(e,t,i,l){if(!t)return;t=t===!0?{}:t;const d=l==="dark"?"dark":"light";if(!i){e[l]=JX({...t,palette:{mode:d,...t==null?void 0:t.palette}});return}const{palette:y,...S}=jE({...i,palette:{mode:d,...t==null?void 0:t.palette}});return e[l]={...t,palette:y,opacity:{...u5(d),...t==null?void 0:t.opacity},overlays:(t==null?void 0:t.overlays)||h5(d)},S}function oK(e={},...t){const{colorSchemes:i={light:!0},defaultColorScheme:l,disableCssColorScheme:d=!1,cssVarPrefix:y="mui",shouldSkipGeneratingVar:S=QX,colorSchemeSelector:R=i.light&&i.dark?"media":void 0,rootSelector:a=":root",...N}=e,G=Object.keys(i)[0],q=l||(i.light&&G!=="light"?"light":G),X=iK(y),{[q]:oe,light:te,dark:ie,...pe}=i,se={...pe};let le=oe;if((q==="dark"&&!("dark"in i)||q==="light"&&!("light"in i))&&(le=!0),!le)throw new Error(_c(21,q));const ce=_T(se,le,N,q);te&&!se.light&&_T(se,te,void 0,"light"),ie&&!se.dark&&_T(se,ie,void 0,"dark");let Me={defaultColorScheme:q,...ce,cssVarPrefix:y,colorSchemeSelector:R,rootSelector:a,getCssVar:X,colorSchemes:se,font:{...FX(ce.typography),...ce.font},spacing:nK(N.spacing)};Object.keys(Me.colorSchemes).forEach(Ct=>{const ye=Me.colorSchemes[Ct].palette,et=dt=>{const Xt=dt.split("-"),Mt=Xt[1],yt=Xt[2];return X(dt,ye[Mt][yt])};if(ye.mode==="light"&&(Lt(ye.common,"background","#fff"),Lt(ye.common,"onBackground","#000")),ye.mode==="dark"&&(Lt(ye.common,"background","#000"),Lt(ye.common,"onBackground","#fff")),rK(ye,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),ye.mode==="light"){Lt(ye.Alert,"errorColor",ii(ye.error.light,.6)),Lt(ye.Alert,"infoColor",ii(ye.info.light,.6)),Lt(ye.Alert,"successColor",ii(ye.success.light,.6)),Lt(ye.Alert,"warningColor",ii(ye.warning.light,.6)),Lt(ye.Alert,"errorFilledBg",et("palette-error-main")),Lt(ye.Alert,"infoFilledBg",et("palette-info-main")),Lt(ye.Alert,"successFilledBg",et("palette-success-main")),Lt(ye.Alert,"warningFilledBg",et("palette-warning-main")),Lt(ye.Alert,"errorFilledColor",vl(()=>ye.getContrastText(ye.error.main))),Lt(ye.Alert,"infoFilledColor",vl(()=>ye.getContrastText(ye.info.main))),Lt(ye.Alert,"successFilledColor",vl(()=>ye.getContrastText(ye.success.main))),Lt(ye.Alert,"warningFilledColor",vl(()=>ye.getContrastText(ye.warning.main))),Lt(ye.Alert,"errorStandardBg",oi(ye.error.light,.9)),Lt(ye.Alert,"infoStandardBg",oi(ye.info.light,.9)),Lt(ye.Alert,"successStandardBg",oi(ye.success.light,.9)),Lt(ye.Alert,"warningStandardBg",oi(ye.warning.light,.9)),Lt(ye.Alert,"errorIconColor",et("palette-error-main")),Lt(ye.Alert,"infoIconColor",et("palette-info-main")),Lt(ye.Alert,"successIconColor",et("palette-success-main")),Lt(ye.Alert,"warningIconColor",et("palette-warning-main")),Lt(ye.AppBar,"defaultBg",et("palette-grey-100")),Lt(ye.Avatar,"defaultBg",et("palette-grey-400")),Lt(ye.Button,"inheritContainedBg",et("palette-grey-300")),Lt(ye.Button,"inheritContainedHoverBg",et("palette-grey-A100")),Lt(ye.Chip,"defaultBorder",et("palette-grey-400")),Lt(ye.Chip,"defaultAvatarColor",et("palette-grey-700")),Lt(ye.Chip,"defaultIconColor",et("palette-grey-700")),Lt(ye.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),Lt(ye.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),Lt(ye.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),Lt(ye.LinearProgress,"primaryBg",oi(ye.primary.main,.62)),Lt(ye.LinearProgress,"secondaryBg",oi(ye.secondary.main,.62)),Lt(ye.LinearProgress,"errorBg",oi(ye.error.main,.62)),Lt(ye.LinearProgress,"infoBg",oi(ye.info.main,.62)),Lt(ye.LinearProgress,"successBg",oi(ye.success.main,.62)),Lt(ye.LinearProgress,"warningBg",oi(ye.warning.main,.62)),Lt(ye.Skeleton,"bg",`rgba(${et("palette-text-primaryChannel")} / 0.11)`),Lt(ye.Slider,"primaryTrack",oi(ye.primary.main,.62)),Lt(ye.Slider,"secondaryTrack",oi(ye.secondary.main,.62)),Lt(ye.Slider,"errorTrack",oi(ye.error.main,.62)),Lt(ye.Slider,"infoTrack",oi(ye.info.main,.62)),Lt(ye.Slider,"successTrack",oi(ye.success.main,.62)),Lt(ye.Slider,"warningTrack",oi(ye.warning.main,.62));const dt=Kv(ye.background.default,.8);Lt(ye.SnackbarContent,"bg",dt),Lt(ye.SnackbarContent,"color",vl(()=>ye.getContrastText(dt))),Lt(ye.SpeedDialAction,"fabHoverBg",Kv(ye.background.paper,.15)),Lt(ye.StepConnector,"border",et("palette-grey-400")),Lt(ye.StepContent,"border",et("palette-grey-400")),Lt(ye.Switch,"defaultColor",et("palette-common-white")),Lt(ye.Switch,"defaultDisabledColor",et("palette-grey-100")),Lt(ye.Switch,"primaryDisabledColor",oi(ye.primary.main,.62)),Lt(ye.Switch,"secondaryDisabledColor",oi(ye.secondary.main,.62)),Lt(ye.Switch,"errorDisabledColor",oi(ye.error.main,.62)),Lt(ye.Switch,"infoDisabledColor",oi(ye.info.main,.62)),Lt(ye.Switch,"successDisabledColor",oi(ye.success.main,.62)),Lt(ye.Switch,"warningDisabledColor",oi(ye.warning.main,.62)),Lt(ye.TableCell,"border",oi(Xv(ye.divider,1),.88)),Lt(ye.Tooltip,"bg",Xv(ye.grey[700],.92))}if(ye.mode==="dark"){Lt(ye.Alert,"errorColor",oi(ye.error.light,.6)),Lt(ye.Alert,"infoColor",oi(ye.info.light,.6)),Lt(ye.Alert,"successColor",oi(ye.success.light,.6)),Lt(ye.Alert,"warningColor",oi(ye.warning.light,.6)),Lt(ye.Alert,"errorFilledBg",et("palette-error-dark")),Lt(ye.Alert,"infoFilledBg",et("palette-info-dark")),Lt(ye.Alert,"successFilledBg",et("palette-success-dark")),Lt(ye.Alert,"warningFilledBg",et("palette-warning-dark")),Lt(ye.Alert,"errorFilledColor",vl(()=>ye.getContrastText(ye.error.dark))),Lt(ye.Alert,"infoFilledColor",vl(()=>ye.getContrastText(ye.info.dark))),Lt(ye.Alert,"successFilledColor",vl(()=>ye.getContrastText(ye.success.dark))),Lt(ye.Alert,"warningFilledColor",vl(()=>ye.getContrastText(ye.warning.dark))),Lt(ye.Alert,"errorStandardBg",ii(ye.error.light,.9)),Lt(ye.Alert,"infoStandardBg",ii(ye.info.light,.9)),Lt(ye.Alert,"successStandardBg",ii(ye.success.light,.9)),Lt(ye.Alert,"warningStandardBg",ii(ye.warning.light,.9)),Lt(ye.Alert,"errorIconColor",et("palette-error-main")),Lt(ye.Alert,"infoIconColor",et("palette-info-main")),Lt(ye.Alert,"successIconColor",et("palette-success-main")),Lt(ye.Alert,"warningIconColor",et("palette-warning-main")),Lt(ye.AppBar,"defaultBg",et("palette-grey-900")),Lt(ye.AppBar,"darkBg",et("palette-background-paper")),Lt(ye.AppBar,"darkColor",et("palette-text-primary")),Lt(ye.Avatar,"defaultBg",et("palette-grey-600")),Lt(ye.Button,"inheritContainedBg",et("palette-grey-800")),Lt(ye.Button,"inheritContainedHoverBg",et("palette-grey-700")),Lt(ye.Chip,"defaultBorder",et("palette-grey-700")),Lt(ye.Chip,"defaultAvatarColor",et("palette-grey-300")),Lt(ye.Chip,"defaultIconColor",et("palette-grey-300")),Lt(ye.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),Lt(ye.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),Lt(ye.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),Lt(ye.LinearProgress,"primaryBg",ii(ye.primary.main,.5)),Lt(ye.LinearProgress,"secondaryBg",ii(ye.secondary.main,.5)),Lt(ye.LinearProgress,"errorBg",ii(ye.error.main,.5)),Lt(ye.LinearProgress,"infoBg",ii(ye.info.main,.5)),Lt(ye.LinearProgress,"successBg",ii(ye.success.main,.5)),Lt(ye.LinearProgress,"warningBg",ii(ye.warning.main,.5)),Lt(ye.Skeleton,"bg",`rgba(${et("palette-text-primaryChannel")} / 0.13)`),Lt(ye.Slider,"primaryTrack",ii(ye.primary.main,.5)),Lt(ye.Slider,"secondaryTrack",ii(ye.secondary.main,.5)),Lt(ye.Slider,"errorTrack",ii(ye.error.main,.5)),Lt(ye.Slider,"infoTrack",ii(ye.info.main,.5)),Lt(ye.Slider,"successTrack",ii(ye.success.main,.5)),Lt(ye.Slider,"warningTrack",ii(ye.warning.main,.5));const dt=Kv(ye.background.default,.98);Lt(ye.SnackbarContent,"bg",dt),Lt(ye.SnackbarContent,"color",vl(()=>ye.getContrastText(dt))),Lt(ye.SpeedDialAction,"fabHoverBg",Kv(ye.background.paper,.15)),Lt(ye.StepConnector,"border",et("palette-grey-600")),Lt(ye.StepContent,"border",et("palette-grey-600")),Lt(ye.Switch,"defaultColor",et("palette-grey-300")),Lt(ye.Switch,"defaultDisabledColor",et("palette-grey-600")),Lt(ye.Switch,"primaryDisabledColor",ii(ye.primary.main,.55)),Lt(ye.Switch,"secondaryDisabledColor",ii(ye.secondary.main,.55)),Lt(ye.Switch,"errorDisabledColor",ii(ye.error.main,.55)),Lt(ye.Switch,"infoDisabledColor",ii(ye.info.main,.55)),Lt(ye.Switch,"successDisabledColor",ii(ye.success.main,.55)),Lt(ye.Switch,"warningDisabledColor",ii(ye.warning.main,.55)),Lt(ye.TableCell,"border",ii(Xv(ye.divider,1),.68)),Lt(ye.Tooltip,"bg",Xv(ye.grey[700],.92))}rc(ye.background,"default"),rc(ye.background,"paper"),rc(ye.common,"background"),rc(ye.common,"onBackground"),rc(ye,"divider"),Object.keys(ye).forEach(dt=>{const Xt=ye[dt];dt!=="tonalOffset"&&Xt&&typeof Xt=="object"&&(Xt.main&&Lt(ye[dt],"mainChannel",g_(__(Xt.main))),Xt.light&&Lt(ye[dt],"lightChannel",g_(__(Xt.light))),Xt.dark&&Lt(ye[dt],"darkChannel",g_(__(Xt.dark))),Xt.contrastText&&Lt(ye[dt],"contrastTextChannel",g_(__(Xt.contrastText))),dt==="text"&&(rc(ye[dt],"primary"),rc(ye[dt],"secondary")),dt==="action"&&(Xt.active&&rc(ye[dt],"active"),Xt.selected&&rc(ye[dt],"selected")))})}),Me=t.reduce((Ct,ye)=>Vo(Ct,ye),Me);const Le={prefix:y,disableCssColorScheme:d,shouldSkipGeneratingVar:S,getSelector:tK(Me)},{vars:Je,generateThemeVars:Qe,generateStyleSheets:je}=CX(Me,Le);return Me.vars=Je,Object.entries(Me.colorSchemes[Me.defaultColorScheme]).forEach(([Ct,ye])=>{Me[Ct]=ye}),Me.generateThemeVars=Qe,Me.generateStyleSheets=je,Me.generateSpacing=function(){return n5(N.spacing,BC(this))},Me.getColorSchemeSelector=IX(R),Me.spacing=Me.generateSpacing(),Me.shouldSkipGeneratingVar=S,Me.unstable_sxConfig={...Cy,...N==null?void 0:N.unstable_sxConfig},Me.unstable_sx=function(ye){return xd({sx:ye,theme:this})},Me.toRuntimeSource=c5,Me}function oO(e,t,i){e.colorSchemes&&i&&(e.colorSchemes[t]={...i!==!0&&i,palette:eI({...i===!0?{}:i.palette,mode:t})})}function d5(e={},...t){const{palette:i,cssVariables:l=!1,colorSchemes:d=i?void 0:{light:!0},defaultColorScheme:y=i==null?void 0:i.mode,...S}=e,R=y||"light",a=d==null?void 0:d[R],N={...d,...i?{[R]:{...typeof a!="boolean"&&a,palette:i}}:void 0};if(l===!1){if(!("colorSchemes"in e))return jE(e,...t);let G=i;"palette"in e||N[R]&&(N[R]!==!0?G=N[R].palette:R==="dark"&&(G={mode:"dark"}));const q=jE({...e,palette:G},...t);return q.defaultColorScheme=R,q.colorSchemes=N,q.palette.mode==="light"&&(q.colorSchemes.light={...N.light!==!0&&N.light,palette:q.palette},oO(q,"dark",N.dark)),q.palette.mode==="dark"&&(q.colorSchemes.dark={...N.dark!==!0&&N.dark,palette:q.palette},oO(q,"light",N.light)),q}return!i&&!("light"in N)&&R==="light"&&(N.light=!0),oK({...S,colorSchemes:N,defaultColorScheme:R,...typeof l!="boolean"&&l},...t)}const tI=d5(),Ob="$$material";function rI(){const e=JC(tI);return e[Ob]||e}function aK(e){return Kt.jsx(iX,{...e,defaultTheme:tI,themeId:Ob})}function f5(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const Ks=e=>f5(e)&&e!=="classes",jr=cX({themeId:Ob,defaultTheme:tI,rootShouldForwardProp:Ks});function sK(e){return function(i){return Kt.jsx(aK,{styles:typeof e=="function"?l=>e({theme:l,...i}):e})}}function lK(){return zB}const Ri=SX;function Qn(e){return wX(e)}function cK(e){return Gn("MuiSvgIcon",e)}jn("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const uK=e=>{const{color:t,fontSize:i,classes:l}=e,d={root:["root",t!=="inherit"&&`color${nn(t)}`,`fontSize${nn(i)}`]};return Jn(d,cK,l)},hK=jr("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.color!=="inherit"&&t[`color${nn(i.color)}`],t[`fontSize${nn(i.fontSize)}`]]}})(Ri(({theme:e})=>{var t,i,l,d,y,S,R,a,N,G,q,X,oe,te;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(d=(t=e.transitions)==null?void 0:t.create)==null?void 0:d.call(t,"fill",{duration:(l=(i=(e.vars??e).transitions)==null?void 0:i.duration)==null?void 0:l.shorter}),variants:[{props:ie=>!ie.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((S=(y=e.typography)==null?void 0:y.pxToRem)==null?void 0:S.call(y,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((a=(R=e.typography)==null?void 0:R.pxToRem)==null?void 0:a.call(R,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((G=(N=e.typography)==null?void 0:N.pxToRem)==null?void 0:G.call(N,35))||"2.1875rem"}},...Object.entries((e.vars??e).palette).filter(([,ie])=>ie&&ie.main).map(([ie])=>{var pe,se;return{props:{color:ie},style:{color:(se=(pe=(e.vars??e).palette)==null?void 0:pe[ie])==null?void 0:se.main}}}),{props:{color:"action"},style:{color:(X=(q=(e.vars??e).palette)==null?void 0:q.action)==null?void 0:X.active}},{props:{color:"disabled"},style:{color:(te=(oe=(e.vars??e).palette)==null?void 0:oe.action)==null?void 0:te.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),d1=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiSvgIcon"}),{children:d,className:y,color:S="inherit",component:R="svg",fontSize:a="medium",htmlColor:N,inheritViewBox:G=!1,titleAccess:q,viewBox:X="0 0 24 24",...oe}=l,te=we.isValidElement(d)&&d.type==="svg",ie={...l,color:S,component:R,fontSize:a,instanceFontSize:t.fontSize,inheritViewBox:G,viewBox:X,hasSvgAsChild:te},pe={};G||(pe.viewBox=X);const se=uK(ie);return Kt.jsxs(hK,{as:R,className:ln(se.root,y),focusable:"false",color:N,"aria-hidden":q?void 0:!0,role:q?"img":void 0,ref:i,...pe,...oe,...te&&d.props,ownerState:ie,children:[te?d.props.children:d,q?Kt.jsx("title",{children:q}):null]})});d1&&(d1.muiName="SvgIcon");function Dy(e,t){function i(l,d){return Kt.jsx(d1,{"data-testid":`${t}Icon`,ref:d,...l,children:e})}return i.muiName=d1.muiName,we.memo(we.forwardRef(i))}const dK=Dy(Kt.jsx("path",{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3m12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4"}),"Hotel"),fK=Dy(Kt.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),pK=Dy(Kt.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),mK="_HeaderWrapper_2gvns_3",gK="_Container_2gvns_15",_K="_inputWrapper_2gvns_83",aO={HeaderWrapper:mK,Container:gK,inputWrapper:_K};function yK(){const[e,t]=we.useState(""),[i,l]=we.useState(!1),[d,y]=we.useState([{startDate:new Date,endDate:new Date,key:"selection"}]),[S,R]=we.useState(!1),[a,N]=we.useState({adult:1,children:0,room:1}),[G,q]=we.useState([0,1e3]),X=Hp(),oe=(ie,pe)=>{N(se=>({...se,[ie]:pe==="i"?a[ie]+1:a[ie]-1}))},te=()=>{X("/HotelFltring",{state:{destination:e,date:d,options:a,priceRange:G}})};return ne.createElement("div",{className:`${aO.HeaderWrapper} section`,id:"home"},ne.createElement("div",{className:aO.Container},ne.createElement("h1",null,"Find Next Place To Trip"),ne.createElement("small",null,"Discover New Places at Exclusive Deals"),ne.createElement("div",{className:"headerSearch"},ne.createElement("div",{className:"headerSearchItem"},ne.createElement(dK,{className:"headerIcon"}),ne.createElement("input",{type:"text",placeholder:"Where are you going?",className:"headerSearchInput",onChange:ie=>t(ie.target.value)})),ne.createElement("div",{className:"headerSearchItem"},ne.createElement(fK,{className:"headerIcon"}),ne.createElement("span",{onClick:()=>l(!i),className:"headerSearchText"},`${ty(d[0].startDate,"MM/dd/yyyy")} to ${ty(d[0].endDate,"MM/dd/yyyy")}`),i&&ne.createElement(Z4.DateRange,{editableDateInputs:!0,onChange:ie=>{y([ie.selection]),l(!1)},moveRangeOnFirstSelection:!1,ranges:d,className:"date",minDate:new Date})),ne.createElement("div",{className:"headerSearchItem"},ne.createElement(pK,{className:"headerIcon"}),ne.createElement("span",{onClick:()=>R(!S),className:"headerSearchText"},`${a.adult} adult · ${a.children} children · ${a.room} room`),S&&ne.createElement("div",{className:"options"},ne.createElement("div",{className:"optionItem"},ne.createElement("span",{className:"optionText"},"Adult"),ne.createElement("div",{className:"optionCounter"},ne.createElement("button",{disabled:a.adult<=1,className:"optionCounterButton",onClick:()=>oe("adult","d")},"-"),ne.createElement("span",{className:"optionCounterNumber"},a.adult),ne.createElement("button",{className:"optionCounterButton",onClick:()=>oe("adult","i")},"+"))),ne.createElement("div",{className:"optionItem"},ne.createElement("span",{className:"optionText"},"Children"),ne.createElement("div",{className:"optionCounter"},ne.createElement("button",{disabled:a.children<=0,className:"optionCounterButton",onClick:()=>oe("children","d")},"-"),ne.createElement("span",{className:"optionCounterNumber"},a.children),ne.createElement("button",{className:"optionCounterButton",onClick:()=>oe("children","i")},"+"))),ne.createElement("div",{className:"optionItem"},ne.createElement("span",{className:"optionText"},"Room"),ne.createElement("div",{className:"optionCounter"},ne.createElement("button",{disabled:a.room<=1,className:"optionCounterButton",onClick:()=>oe("room","d")},"-"),ne.createElement("span",{className:"optionCounterNumber"},a.room),ne.createElement("button",{className:"optionCounterButton",onClick:()=>oe("room","i")},"+"))))),ne.createElement("div",{className:"headerSearchItem"},ne.createElement("span",{className:"headerSearchText"},"Price Range"),ne.createElement("input",{type:"range",min:"0",max:"1000",value:G[0],onChange:ie=>q([parseInt(ie.target.value),G[1]]),className:"price-range-input"}),ne.createElement("input",{type:"range",min:"0",max:"1000",value:G[1],onChange:ie=>q([G[0],parseInt(ie.target.value)]),className:"price-range-input"}),ne.createElement("div",{className:"price-display"},ne.createElement("p",null,`$${G[0]} - $${G[1]}`))),ne.createElement("div",{className:"headerSearchItem"},ne.createElement("button",{className:"headerBtn",onClick:te},"Search")))))}const vK=()=>ne.createElement("div",{className:"footer"},ne.createElement("div",{className:"fLists"},ne.createElement("ul",{className:"fList"},ne.createElement("li",{className:"fListItem"},"Countries"),ne.createElement("li",{className:"fListItem"},"Regions"),ne.createElement("li",{className:"fListItem"},"Cities"),ne.createElement("li",{className:"fListItem"},"Districts"),ne.createElement("li",{className:"fListItem"},"Airports"),ne.createElement("li",{className:"fListItem"},"Hotels")),ne.createElement("ul",{className:"fList"},ne.createElement("li",{className:"fListItem"},"Homes"),ne.createElement("li",{className:"fListItem"},"Apartments"),ne.createElement("li",{className:"fListItem"},"Resorts"),ne.createElement("li",{className:"fListItem"},"Villas"),ne.createElement("li",{className:"fListItem"},"Hostels"),ne.createElement("li",{className:"fListItem"},"Guest houses")),ne.createElement("ul",{className:"fList"},ne.createElement("li",{className:"fListItem"},"Unique places to stay"),ne.createElement("li",{className:"fListItem"},"Reviews"),ne.createElement("li",{className:"fListItem"},"Unpacked: Travel articles"),ne.createElement("li",{className:"fListItem"},"Travel communities"),ne.createElement("li",{className:"fListItem"},"Seasonal and holiday deals")),ne.createElement("ul",{className:"fList"},ne.createElement("li",{className:"fListItem"},"Car rental"),ne.createElement("li",{className:"fListItem"},"Flight Finder"),ne.createElement("li",{className:"fListItem"},"Restaurant reservations"),ne.createElement("li",{className:"fListItem"},"Travel Agents")),ne.createElement("ul",{className:"fList"},ne.createElement("li",{className:"fListItem"},"Customer Service"),ne.createElement("li",{className:"fListItem"},"Partner Help"),ne.createElement("li",{className:"fListItem"},"Careers"),ne.createElement("li",{className:"fListItem"},"Sustainability"),ne.createElement("li",{className:"fListItem"},"Press center"),ne.createElement("li",{className:"fListItem"},"Safety Resource Center"),ne.createElement("li",{className:"fListItem"},"Investor relations"),ne.createElement("li",{className:"fListItem"},"Terms & conditions"))),ne.createElement("div",{className:"fText"},"Copyright © 2022 Lamabooking."));function p5(e,t){if(e==null)return{};var i={};for(var l in e)if({}.hasOwnProperty.call(e,l)){if(t.includes(l))continue;i[l]=e[l]}return i}function $E(e,t){return $E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,l){return i.__proto__=l,i},$E(e,t)}function m5(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,$E(e,t)}const sO={disabled:!1},f1=ne.createContext(null);var xK=function(t){return t.scrollTop},y_="unmounted",Qh="exited",ed="entering",np="entered",WE="exiting",Ll=function(e){m5(t,e);function t(l,d){var y;y=e.call(this,l,d)||this;var S=d,R=S&&!S.isMounting?l.enter:l.appear,a;return y.appearStatus=null,l.in?R?(a=Qh,y.appearStatus=ed):a=np:l.unmountOnExit||l.mountOnEnter?a=y_:a=Qh,y.state={status:a},y.nextCallback=null,y}t.getDerivedStateFromProps=function(d,y){var S=d.in;return S&&y.status===y_?{status:Qh}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(d){var y=null;if(d!==this.props){var S=this.state.status;this.props.in?S!==ed&&S!==np&&(y=ed):(S===ed||S===np)&&(y=WE)}this.updateStatus(!1,y)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var d=this.props.timeout,y,S,R;return y=S=R=d,d!=null&&typeof d!="number"&&(y=d.exit,S=d.enter,R=d.appear!==void 0?d.appear:S),{exit:y,enter:S,appear:R}},i.updateStatus=function(d,y){if(d===void 0&&(d=!1),y!==null)if(this.cancelNextCallback(),y===ed){if(this.props.unmountOnExit||this.props.mountOnEnter){var S=this.props.nodeRef?this.props.nodeRef.current:Uv.findDOMNode(this);S&&xK(S)}this.performEnter(d)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Qh&&this.setState({status:y_})},i.performEnter=function(d){var y=this,S=this.props.enter,R=this.context?this.context.isMounting:d,a=this.props.nodeRef?[R]:[Uv.findDOMNode(this),R],N=a[0],G=a[1],q=this.getTimeouts(),X=R?q.appear:q.enter;if(!d&&!S||sO.disabled){this.safeSetState({status:np},function(){y.props.onEntered(N)});return}this.props.onEnter(N,G),this.safeSetState({status:ed},function(){y.props.onEntering(N,G),y.onTransitionEnd(X,function(){y.safeSetState({status:np},function(){y.props.onEntered(N,G)})})})},i.performExit=function(){var d=this,y=this.props.exit,S=this.getTimeouts(),R=this.props.nodeRef?void 0:Uv.findDOMNode(this);if(!y||sO.disabled){this.safeSetState({status:Qh},function(){d.props.onExited(R)});return}this.props.onExit(R),this.safeSetState({status:WE},function(){d.props.onExiting(R),d.onTransitionEnd(S.exit,function(){d.safeSetState({status:Qh},function(){d.props.onExited(R)})})})},i.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(d,y){y=this.setNextCallback(y),this.setState(d,y)},i.setNextCallback=function(d){var y=this,S=!0;return this.nextCallback=function(R){S&&(S=!1,y.nextCallback=null,d(R))},this.nextCallback.cancel=function(){S=!1},this.nextCallback},i.onTransitionEnd=function(d,y){this.setNextCallback(y);var S=this.props.nodeRef?this.props.nodeRef.current:Uv.findDOMNode(this),R=d==null&&!this.props.addEndListener;if(!S||R){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[S,this.nextCallback],N=a[0],G=a[1];this.props.addEndListener(N,G)}d!=null&&setTimeout(this.nextCallback,d)},i.render=function(){var d=this.state.status;if(d===y_)return null;var y=this.props,S=y.children;y.in,y.mountOnEnter,y.unmountOnExit,y.appear,y.enter,y.exit,y.timeout,y.addEndListener,y.onEnter,y.onEntering,y.onEntered,y.onExit,y.onExiting,y.onExited,y.nodeRef;var R=p5(y,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return ne.createElement(f1.Provider,{value:null},typeof S=="function"?S(d,R):ne.cloneElement(ne.Children.only(S),R))},t}(ne.Component);Ll.contextType=f1;Ll.propTypes={};function ep(){}Ll.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:ep,onEntering:ep,onEntered:ep,onExit:ep,onExiting:ep,onExited:ep};Ll.UNMOUNTED=y_;Ll.EXITED=Qh;Ll.ENTERING=ed;Ll.ENTERED=np;Ll.EXITING=WE;function bK(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nI(e,t){var i=function(y){return t&&we.isValidElement(y)?t(y):y},l=Object.create(null);return e&&we.Children.map(e,function(d){return d}).forEach(function(d){l[d.key]=i(d)}),l}function wK(e,t){e=e||{},t=t||{};function i(G){return G in t?t[G]:e[G]}var l=Object.create(null),d=[];for(var y in e)y in t?d.length&&(l[y]=d,d=[]):d.push(y);var S,R={};for(var a in t){if(l[a])for(S=0;S<l[a].length;S++){var N=l[a][S];R[l[a][S]]=i(N)}R[a]=i(a)}for(S=0;S<d.length;S++)R[d[S]]=i(d[S]);return R}function ld(e,t,i){return i[t]!=null?i[t]:e.props[t]}function SK(e,t){return nI(e.children,function(i){return we.cloneElement(i,{onExited:t.bind(null,i),in:!0,appear:ld(i,"appear",e),enter:ld(i,"enter",e),exit:ld(i,"exit",e)})})}function TK(e,t,i){var l=nI(e.children),d=wK(t,l);return Object.keys(d).forEach(function(y){var S=d[y];if(we.isValidElement(S)){var R=y in t,a=y in l,N=t[y],G=we.isValidElement(N)&&!N.props.in;a&&(!R||G)?d[y]=we.cloneElement(S,{onExited:i.bind(null,S),in:!0,exit:ld(S,"exit",e),enter:ld(S,"enter",e)}):!a&&R&&!G?d[y]=we.cloneElement(S,{in:!1}):a&&R&&we.isValidElement(N)&&(d[y]=we.cloneElement(S,{onExited:i.bind(null,S),in:N.props.in,exit:ld(S,"exit",e),enter:ld(S,"enter",e)}))}}),d}var EK=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},MK={component:"div",childFactory:function(t){return t}},iI=function(e){m5(t,e);function t(l,d){var y;y=e.call(this,l,d)||this;var S=y.handleExited.bind(bK(y));return y.state={contextValue:{isMounting:!0},handleExited:S,firstRender:!0},y}var i=t.prototype;return i.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},i.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(d,y){var S=y.children,R=y.handleExited,a=y.firstRender;return{children:a?SK(d,R):TK(d,S,R),firstRender:!1}},i.handleExited=function(d,y){var S=nI(this.props.children);d.key in S||(d.props.onExited&&d.props.onExited(y),this.mounted&&this.setState(function(R){var a=u1({},R.children);return delete a[d.key],{children:a}}))},i.render=function(){var d=this.props,y=d.component,S=d.childFactory,R=p5(d,["component","childFactory"]),a=this.state.contextValue,N=EK(this.state.children).map(S);return delete R.appear,delete R.enter,delete R.exit,y===null?ne.createElement(f1.Provider,{value:a},N):ne.createElement(f1.Provider,{value:a},ne.createElement(y,R,N))},t}(ne.Component);iI.propTypes={};iI.defaultProps=MK;const g5=e=>e.scrollTop;function p1(e,t){const{timeout:i,easing:l,style:d={}}=e;return{duration:d.transitionDuration??(typeof i=="number"?i:i[t.mode]||0),easing:d.transitionTimingFunction??(typeof l=="object"?l[t.mode]:l),delay:d.transitionDelay}}function CK(e){return Gn("MuiPaper",e)}jn("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const IK=e=>{const{square:t,elevation:i,variant:l,classes:d}=e,y={root:["root",l,!t&&"rounded",l==="elevation"&&`elevation${i}`]};return Jn(y,CK,d)},PK=jr("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],!i.square&&t.rounded,i.variant==="elevation"&&t[`elevation${i.elevation}`]]}})(Ri(({theme:e})=>({backgroundColor:(e.vars||e).palette.background.paper,color:(e.vars||e).palette.text.primary,transition:e.transitions.create("box-shadow"),variants:[{props:({ownerState:t})=>!t.square,style:{borderRadius:e.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(e.vars||e).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),_5=we.forwardRef(function(t,i){var oe;const l=Qn({props:t,name:"MuiPaper"}),d=rI(),{className:y,component:S="div",elevation:R=1,square:a=!1,variant:N="elevation",...G}=l,q={...l,component:S,elevation:R,square:a,variant:N},X=IK(q);return Kt.jsx(PK,{as:S,ownerState:q,className:ln(X.root,y),ref:i,...G,style:{...N==="elevation"&&{"--Paper-shadow":(d.vars||d).shadows[R],...d.vars&&{"--Paper-overlay":(oe=d.vars.overlays)==null?void 0:oe[R]},...!d.vars&&d.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${_s("#fff",VE(R))}, ${_s("#fff",VE(R))})`}},...G.style}})});function $s(e,t){const{className:i,elementType:l,ownerState:d,externalForwardedProps:y,internalForwardedProps:S,...R}=t,{component:a,slots:N={[e]:void 0},slotProps:G={[e]:void 0},...q}=y,X=N[e]||l,oe=OB(G[e],d),{props:{component:te,...ie},internalRef:pe}=kB({className:i,...R,externalForwardedProps:e==="root"?q:void 0,externalSlotProps:oe}),se=Wo(pe,oe==null?void 0:oe.ref,t.ref),le=e==="root"?te||a:te,ce=AB(X,{...e==="root"&&!a&&!N[e]&&S,...e!=="root"&&!N[e]&&S,...ie,...le&&{as:le},ref:se},d);return[X,ce]}class m1{constructor(){fr(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new m1}static use(){const t=MB(m1.create).current,[i,l]=we.useState(!1);return t.shouldMount=i,t.setShouldMount=l,we.useEffect(t.mountEffect,[i]),t}mount(){return this.mounted||(this.mounted=DK(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...t){this.mount().then(()=>{var i;return(i=this.ref.current)==null?void 0:i.start(...t)})}stop(...t){this.mount().then(()=>{var i;return(i=this.ref.current)==null?void 0:i.stop(...t)})}pulsate(...t){this.mount().then(()=>{var i;return(i=this.ref.current)==null?void 0:i.pulsate(...t)})}}function AK(){return m1.use()}function DK(){let e,t;const i=new Promise((l,d)=>{e=l,t=d});return i.resolve=e,i.reject=t,i}function RK(e){const{className:t,classes:i,pulsate:l=!1,rippleX:d,rippleY:y,rippleSize:S,in:R,onExited:a,timeout:N}=e,[G,q]=we.useState(!1),X=ln(t,i.ripple,i.rippleVisible,l&&i.ripplePulsate),oe={width:S,height:S,top:-(S/2)+y,left:-(S/2)+d},te=ln(i.child,G&&i.childLeaving,l&&i.childPulsate);return!R&&!G&&q(!0),we.useEffect(()=>{if(!R&&a!=null){const ie=setTimeout(a,N);return()=>{clearTimeout(ie)}}},[a,R,N]),Kt.jsx("span",{className:X,style:oe,children:Kt.jsx("span",{className:te})})}const ds=jn("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),GE=550,kK=80,OK=Ay`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,LK=Ay`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,zK=Ay`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,FK=jr("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),BK=jr(RK,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${ds.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${OK};
    animation-duration: ${GE}ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
  }

  &.${ds.ripplePulsate} {
    animation-duration: ${({theme:e})=>e.transitions.duration.shorter}ms;
  }

  & .${ds.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${ds.childLeaving} {
    opacity: 0;
    animation-name: ${LK};
    animation-duration: ${GE}ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
  }

  & .${ds.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${zK};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,NK=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTouchRipple"}),{center:d=!1,classes:y={},className:S,...R}=l,[a,N]=we.useState([]),G=we.useRef(0),q=we.useRef(null);we.useEffect(()=>{q.current&&(q.current(),q.current=null)},[a]);const X=we.useRef(!1),oe=CB(),te=we.useRef(null),ie=we.useRef(null),pe=we.useCallback(Me=>{const{pulsate:Le,rippleX:Je,rippleY:Qe,rippleSize:je,cb:Ct}=Me;N(ye=>[...ye,Kt.jsx(BK,{classes:{ripple:ln(y.ripple,ds.ripple),rippleVisible:ln(y.rippleVisible,ds.rippleVisible),ripplePulsate:ln(y.ripplePulsate,ds.ripplePulsate),child:ln(y.child,ds.child),childLeaving:ln(y.childLeaving,ds.childLeaving),childPulsate:ln(y.childPulsate,ds.childPulsate)},timeout:GE,pulsate:Le,rippleX:Je,rippleY:Qe,rippleSize:je},G.current)]),G.current+=1,q.current=Ct},[y]),se=we.useCallback((Me={},Le={},Je=()=>{})=>{const{pulsate:Qe=!1,center:je=d||Le.pulsate,fakeElement:Ct=!1}=Le;if((Me==null?void 0:Me.type)==="mousedown"&&X.current){X.current=!1;return}(Me==null?void 0:Me.type)==="touchstart"&&(X.current=!0);const ye=Ct?null:ie.current,et=ye?ye.getBoundingClientRect():{width:0,height:0,left:0,top:0};let dt,Xt,Mt;if(je||Me===void 0||Me.clientX===0&&Me.clientY===0||!Me.clientX&&!Me.touches)dt=Math.round(et.width/2),Xt=Math.round(et.height/2);else{const{clientX:yt,clientY:gt}=Me.touches&&Me.touches.length>0?Me.touches[0]:Me;dt=Math.round(yt-et.left),Xt=Math.round(gt-et.top)}if(je)Mt=Math.sqrt((2*et.width**2+et.height**2)/3),Mt%2===0&&(Mt+=1);else{const yt=Math.max(Math.abs((ye?ye.clientWidth:0)-dt),dt)*2+2,gt=Math.max(Math.abs((ye?ye.clientHeight:0)-Xt),Xt)*2+2;Mt=Math.sqrt(yt**2+gt**2)}Me!=null&&Me.touches?te.current===null&&(te.current=()=>{pe({pulsate:Qe,rippleX:dt,rippleY:Xt,rippleSize:Mt,cb:Je})},oe.start(kK,()=>{te.current&&(te.current(),te.current=null)})):pe({pulsate:Qe,rippleX:dt,rippleY:Xt,rippleSize:Mt,cb:Je})},[d,pe,oe]),le=we.useCallback(()=>{se({},{pulsate:!0})},[se]),ce=we.useCallback((Me,Le)=>{if(oe.clear(),(Me==null?void 0:Me.type)==="touchend"&&te.current){te.current(),te.current=null,oe.start(0,()=>{ce(Me,Le)});return}te.current=null,N(Je=>Je.length>0?Je.slice(1):Je),q.current=Le},[oe]);return we.useImperativeHandle(i,()=>({pulsate:le,start:se,stop:ce}),[le,se,ce]),Kt.jsx(FK,{className:ln(ds.root,y.root,S),ref:ie,...R,children:Kt.jsx(iI,{component:null,exit:!0,children:a})})});function UK(e){return Gn("MuiButtonBase",e)}const jK=jn("MuiButtonBase",["root","disabled","focusVisible"]),VK=e=>{const{disabled:t,focusVisible:i,focusVisibleClassName:l,classes:d}=e,S=Jn({root:["root",t&&"disabled",i&&"focusVisible"]},UK,d);return i&&l&&(S.root+=` ${l}`),S},$K=jr("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${jK.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),WK=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiButtonBase"}),{action:d,centerRipple:y=!1,children:S,className:R,component:a="button",disabled:N=!1,disableRipple:G=!1,disableTouchRipple:q=!1,focusRipple:X=!1,focusVisibleClassName:oe,LinkComponent:te="a",onBlur:ie,onClick:pe,onContextMenu:se,onDragLeave:le,onFocus:ce,onFocusVisible:Me,onKeyDown:Le,onKeyUp:Je,onMouseDown:Qe,onMouseLeave:je,onMouseUp:Ct,onTouchEnd:ye,onTouchMove:et,onTouchStart:dt,tabIndex:Xt=0,TouchRippleProps:Mt,touchRippleRef:yt,type:gt,...Ze}=l,ht=we.useRef(null),Dt=AK(),Tt=Wo(Dt.ref,yt),[tr,Vr]=we.useState(!1);N&&tr&&Vr(!1),we.useImperativeHandle(d,()=>({focusVisible:()=>{Vr(!0),ht.current.focus()}}),[]);const Nr=Dt.shouldMount&&!G&&!N;we.useEffect(()=>{tr&&X&&!G&&Dt.pulsate()},[G,X,tr,Dt]);const ct=nc(Dt,"start",Qe,q),$t=nc(Dt,"stop",se,q),Ht=nc(Dt,"stop",le,q),Bt=nc(Dt,"stop",Ct,q),It=nc(Dt,"stop",Er=>{tr&&Er.preventDefault(),je&&je(Er)},q),qt=nc(Dt,"start",dt,q),Wt=nc(Dt,"stop",ye,q),be=nc(Dt,"stop",et,q),er=nc(Dt,"stop",Er=>{Ok(Er.target)||Vr(!1),ie&&ie(Er)},!1),cr=Mp(Er=>{ht.current||(ht.current=Er.currentTarget),Ok(Er.target)&&(Vr(!0),Me&&Me(Er)),ce&&ce(Er)}),pr=()=>{const Er=ht.current;return a&&a!=="button"&&!(Er.tagName==="A"&&Er.href)},lt=Mp(Er=>{X&&!Er.repeat&&tr&&Er.key===" "&&Dt.stop(Er,()=>{Dt.start(Er)}),Er.target===Er.currentTarget&&pr()&&Er.key===" "&&Er.preventDefault(),Le&&Le(Er),Er.target===Er.currentTarget&&pr()&&Er.key==="Enter"&&!N&&(Er.preventDefault(),pe&&pe(Er))}),Lr=Mp(Er=>{X&&Er.key===" "&&tr&&!Er.defaultPrevented&&Dt.stop(Er,()=>{Dt.pulsate(Er)}),Je&&Je(Er),pe&&Er.target===Er.currentTarget&&pr()&&Er.key===" "&&!Er.defaultPrevented&&pe(Er)});let br=a;br==="button"&&(Ze.href||Ze.to)&&(br=te);const Kr={};br==="button"?(Kr.type=gt===void 0?"button":gt,Kr.disabled=N):(!Ze.href&&!Ze.to&&(Kr.role="button"),N&&(Kr["aria-disabled"]=N));const sr=Wo(i,ht),Hr={...l,centerRipple:y,component:a,disabled:N,disableRipple:G,disableTouchRipple:q,focusRipple:X,tabIndex:Xt,focusVisible:tr},mn=VK(Hr);return Kt.jsxs($K,{as:br,className:ln(mn.root,R),ownerState:Hr,onBlur:er,onClick:pe,onContextMenu:$t,onFocus:cr,onKeyDown:lt,onKeyUp:Lr,onMouseDown:ct,onMouseLeave:It,onMouseUp:Bt,onDragLeave:Ht,onTouchEnd:Wt,onTouchMove:be,onTouchStart:qt,ref:sr,tabIndex:N?-1:Xt,type:gt,...Kr,...Ze,children:[S,Nr?Kt.jsx(NK,{ref:Tt,center:y,...Mt}):null]})});function nc(e,t,i,l=!1){return Mp(d=>(i&&i(d),l||e[t](d),!0))}function GK(e){return typeof e.main=="string"}function HK(e,t=[]){if(!GK(e))return!1;for(const i of t)if(!e.hasOwnProperty(i)||typeof e[i]!="string")return!1;return!0}function Pd(e=[]){return([,t])=>t&&HK(t,e)}function qK(e){return Gn("MuiTypography",e)}jn("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const ZK={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},YK=lK(),XK=e=>{const{align:t,gutterBottom:i,noWrap:l,paragraph:d,variant:y,classes:S}=e,R={root:["root",y,e.align!=="inherit"&&`align${nn(t)}`,i&&"gutterBottom",l&&"noWrap",d&&"paragraph"]};return Jn(R,qK,S)},KK=jr("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.variant&&t[i.variant],i.align!=="inherit"&&t[`align${nn(i.align)}`],i.noWrap&&t.noWrap,i.gutterBottom&&t.gutterBottom,i.paragraph&&t.paragraph]}})(Ri(({theme:e})=>{var t;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(e.typography).filter(([i,l])=>i!=="inherit"&&l&&typeof l=="object").map(([i,l])=>({props:{variant:i},style:l})),...Object.entries(e.palette).filter(Pd()).map(([i])=>({props:{color:i},style:{color:(e.vars||e).palette[i].main}})),...Object.entries(((t=e.palette)==null?void 0:t.text)||{}).filter(([,i])=>typeof i=="string").map(([i])=>({props:{color:`text${nn(i)}`},style:{color:(e.vars||e).palette.text[i]}})),{props:({ownerState:i})=>i.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:i})=>i.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:i})=>i.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:i})=>i.paragraph,style:{marginBottom:16}}]}})),lO={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},A_=we.forwardRef(function(t,i){const{color:l,...d}=Qn({props:t,name:"MuiTypography"}),y=!ZK[l],S=YK({...d,...y&&{color:l}}),{align:R="inherit",className:a,component:N,gutterBottom:G=!1,noWrap:q=!1,paragraph:X=!1,variant:oe="body1",variantMapping:te=lO,...ie}=S,pe={...S,align:R,color:l,className:a,component:N,gutterBottom:G,noWrap:q,paragraph:X,variant:oe,variantMapping:te},se=N||(X?"p":te[oe]||lO[oe])||"span",le=XK(pe);return Kt.jsx(KK,{as:se,ref:i,className:ln(le.root,a),...ie,ownerState:pe,style:{...R!=="inherit"&&{"--Typography-textAlign":R},...ie.style}})});function JK(e){return typeof e=="function"?e():e}const QK=we.forwardRef(function(t,i){const{children:l,container:d,disablePortal:y=!1}=t,[S,R]=we.useState(null),a=Wo(we.isValidElement(l)?Ty(l):null,i);if(vd(()=>{y||R(JK(d)||document.body)},[d,y]),vd(()=>{if(S&&!y)return LE(i,S),()=>{LE(i,null)}},[i,S,y]),y){if(we.isValidElement(l)){const N={ref:a};return we.cloneElement(l,N)}return l}return S&&N1.createPortal(l,S)});function Jv(e){return parseInt(e,10)||0}const eJ={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function tJ(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflowing}const rJ=we.forwardRef(function(t,i){const{onChange:l,maxRows:d,minRows:y=1,style:S,value:R,...a}=t,{current:N}=we.useRef(R!=null),G=we.useRef(null),q=Wo(i,G),X=we.useRef(null),oe=we.useRef(null),te=we.useCallback(()=>{const se=G.current,ce=yc(se).getComputedStyle(se);if(ce.width==="0px")return{outerHeightStyle:0,overflowing:!1};const Me=oe.current;Me.style.width=ce.width,Me.value=se.value||t.placeholder||"x",Me.value.slice(-1)===`
`&&(Me.value+=" ");const Le=ce.boxSizing,Je=Jv(ce.paddingBottom)+Jv(ce.paddingTop),Qe=Jv(ce.borderBottomWidth)+Jv(ce.borderTopWidth),je=Me.scrollHeight;Me.value="x";const Ct=Me.scrollHeight;let ye=je;y&&(ye=Math.max(Number(y)*Ct,ye)),d&&(ye=Math.min(Number(d)*Ct,ye)),ye=Math.max(ye,Ct);const et=ye+(Le==="border-box"?Je+Qe:0),dt=Math.abs(ye-je)<=1;return{outerHeightStyle:et,overflowing:dt}},[d,y,t.placeholder]),ie=we.useCallback(()=>{const se=te();if(tJ(se))return;const le=se.outerHeightStyle,ce=G.current;X.current!==le&&(X.current=le,ce.style.height=`${le}px`),ce.style.overflow=se.overflowing?"hidden":""},[te]);vd(()=>{const se=()=>{ie()};let le;const ce=TB(se),Me=G.current,Le=yc(Me);Le.addEventListener("resize",ce);let Je;return typeof ResizeObserver<"u"&&(Je=new ResizeObserver(se),Je.observe(Me)),()=>{ce.clear(),cancelAnimationFrame(le),Le.removeEventListener("resize",ce),Je&&Je.disconnect()}},[te,ie]),vd(()=>{ie()});const pe=se=>{N||ie(),l&&l(se)};return Kt.jsxs(we.Fragment,{children:[Kt.jsx("textarea",{value:R,onChange:pe,ref:q,rows:y,style:S,...a}),Kt.jsx("textarea",{"aria-hidden":!0,className:t.className,readOnly:!0,ref:oe,tabIndex:-1,style:{...eJ.shadow,...S,paddingTop:0,paddingBottom:0}})]})});function HE(e){return typeof e=="string"}function Qp({props:e,states:t,muiFormControl:i}){return t.reduce((l,d)=>(l[d]=e[d],i&&typeof e[d]>"u"&&(l[d]=i[d]),l),{})}const oI=we.createContext(void 0);function em(){return we.useContext(oI)}function cO(e){return e!=null&&!(Array.isArray(e)&&e.length===0)}function g1(e,t=!1){return e&&(cO(e.value)&&e.value!==""||t&&cO(e.defaultValue)&&e.defaultValue!=="")}function nJ(e){return e.startAdornment}function iJ(e){return Gn("MuiInputBase",e)}const Up=jn("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var uO;const Lb=(e,t)=>{const{ownerState:i}=e;return[t.root,i.formControl&&t.formControl,i.startAdornment&&t.adornedStart,i.endAdornment&&t.adornedEnd,i.error&&t.error,i.size==="small"&&t.sizeSmall,i.multiline&&t.multiline,i.color&&t[`color${nn(i.color)}`],i.fullWidth&&t.fullWidth,i.hiddenLabel&&t.hiddenLabel]},zb=(e,t)=>{const{ownerState:i}=e;return[t.input,i.size==="small"&&t.inputSizeSmall,i.multiline&&t.inputMultiline,i.type==="search"&&t.inputTypeSearch,i.startAdornment&&t.inputAdornedStart,i.endAdornment&&t.inputAdornedEnd,i.hiddenLabel&&t.inputHiddenLabel]},oJ=e=>{const{classes:t,color:i,disabled:l,error:d,endAdornment:y,focused:S,formControl:R,fullWidth:a,hiddenLabel:N,multiline:G,readOnly:q,size:X,startAdornment:oe,type:te}=e,ie={root:["root",`color${nn(i)}`,l&&"disabled",d&&"error",a&&"fullWidth",S&&"focused",R&&"formControl",X&&X!=="medium"&&`size${nn(X)}`,G&&"multiline",oe&&"adornedStart",y&&"adornedEnd",N&&"hiddenLabel",q&&"readOnly"],input:["input",l&&"disabled",te==="search"&&"inputTypeSearch",G&&"inputMultiline",X==="small"&&"inputSizeSmall",N&&"inputHiddenLabel",oe&&"inputAdornedStart",y&&"inputAdornedEnd",q&&"readOnly"]};return Jn(ie,iJ,t)},Fb=jr("div",{name:"MuiInputBase",slot:"Root",overridesResolver:Lb})(Ri(({theme:e})=>({...e.typography.body1,color:(e.vars||e).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${Up.disabled}`]:{color:(e.vars||e).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:t})=>t.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:t,size:i})=>t.multiline&&i==="small",style:{paddingTop:1}},{props:({ownerState:t})=>t.fullWidth,style:{width:"100%"}}]}))),Bb=jr("input",{name:"MuiInputBase",slot:"Input",overridesResolver:zb})(Ri(({theme:e})=>{const t=e.palette.mode==="light",i={color:"currentColor",...e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:t?.42:.5},transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})},l={opacity:"0 !important"},d=e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:t?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${Up.formControl} &`]:{"&::-webkit-input-placeholder":l,"&::-moz-placeholder":l,"&::-ms-input-placeholder":l,"&:focus::-webkit-input-placeholder":d,"&:focus::-moz-placeholder":d,"&:focus::-ms-input-placeholder":d},[`&.${Up.disabled}`]:{opacity:1,WebkitTextFillColor:(e.vars||e).palette.text.disabled},variants:[{props:({ownerState:y})=>!y.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:y})=>y.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),hO=sK({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),aI=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiInputBase"}),{"aria-describedby":d,autoComplete:y,autoFocus:S,className:R,color:a,components:N={},componentsProps:G={},defaultValue:q,disabled:X,disableInjectingGlobalStyles:oe,endAdornment:te,error:ie,fullWidth:pe=!1,id:se,inputComponent:le="input",inputProps:ce={},inputRef:Me,margin:Le,maxRows:Je,minRows:Qe,multiline:je=!1,name:Ct,onBlur:ye,onChange:et,onClick:dt,onFocus:Xt,onKeyDown:Mt,onKeyUp:yt,placeholder:gt,readOnly:Ze,renderSuffix:ht,rows:Dt,size:Tt,slotProps:tr={},slots:Vr={},startAdornment:Nr,type:ct="text",value:$t,...Ht}=l,Bt=ce.value!=null?ce.value:$t,{current:It}=we.useRef(Bt!=null),qt=we.useRef(),Wt=we.useCallback(kn=>{},[]),be=Wo(qt,Me,ce.ref,Wt),[er,cr]=we.useState(!1),pr=em(),lt=Qp({props:l,muiFormControl:pr,states:["color","disabled","error","hiddenLabel","size","required","filled"]});lt.focused=pr?pr.focused:er,we.useEffect(()=>{!pr&&X&&er&&(cr(!1),ye&&ye())},[pr,X,er,ye]);const Lr=pr&&pr.onFilled,br=pr&&pr.onEmpty,Kr=we.useCallback(kn=>{g1(kn)?Lr&&Lr():br&&br()},[Lr,br]);vd(()=>{It&&Kr({value:Bt})},[Bt,Kr,It]);const sr=kn=>{Xt&&Xt(kn),ce.onFocus&&ce.onFocus(kn),pr&&pr.onFocus?pr.onFocus(kn):cr(!0)},Hr=kn=>{ye&&ye(kn),ce.onBlur&&ce.onBlur(kn),pr&&pr.onBlur?pr.onBlur(kn):cr(!1)},mn=(kn,...aa)=>{if(!It){const sa=kn.target||qt.current;if(sa==null)throw new Error(_c(1));Kr({value:sa.value})}ce.onChange&&ce.onChange(kn,...aa),et&&et(kn,...aa)};we.useEffect(()=>{Kr(qt.current)},[]);const Er=kn=>{qt.current&&kn.currentTarget===kn.target&&qt.current.focus(),dt&&dt(kn)};let Gi=le,ai=ce;je&&Gi==="input"&&(Dt?ai={type:void 0,minRows:Dt,maxRows:Dt,...ai}:ai={type:void 0,maxRows:Je,minRows:Qe,...ai},Gi=rJ);const hr=kn=>{Kr(kn.animationName==="mui-auto-fill-cancel"?qt.current:{value:"x"})};we.useEffect(()=>{pr&&pr.setAdornedStart(!!Nr)},[pr,Nr]);const Po={...l,color:lt.color||"primary",disabled:lt.disabled,endAdornment:te,error:lt.error,focused:lt.focused,formControl:pr,fullWidth:pe,hiddenLabel:lt.hiddenLabel,multiline:je,size:lt.size,startAdornment:Nr,type:ct},ao=oJ(Po),so=Vr.root||N.Root||Fb,hi=tr.root||G.root||{},wi=Vr.input||N.Input||Bb;return ai={...ai,...tr.input??G.input},Kt.jsxs(we.Fragment,{children:[!oe&&typeof hO=="function"&&(uO||(uO=Kt.jsx(hO,{}))),Kt.jsxs(so,{...hi,ref:i,onClick:Er,...Ht,...!HE(so)&&{ownerState:{...Po,...hi.ownerState}},className:ln(ao.root,hi.className,R,Ze&&"MuiInputBase-readOnly"),children:[Nr,Kt.jsx(oI.Provider,{value:null,children:Kt.jsx(wi,{"aria-invalid":lt.error,"aria-describedby":d,autoComplete:y,autoFocus:S,defaultValue:q,disabled:lt.disabled,id:se,onAnimationStart:hr,name:Ct,placeholder:gt,readOnly:Ze,required:lt.required,rows:Dt,value:Bt,onKeyDown:Mt,onKeyUp:yt,type:ct,...ai,...!HE(wi)&&{as:Gi,ownerState:{...Po,...ai.ownerState}},ref:be,className:ln(ao.input,ai.className,Ze&&"MuiInputBase-readOnly"),onBlur:Hr,onChange:mn,onFocus:sr})}),te,ht?ht({...lt,startAdornment:Nr}):null]})]})});function aJ(e){return Gn("MuiInput",e)}const c_={...Up,...jn("MuiInput",["root","underline","input"])};function sJ(e){return Gn("MuiOutlinedInput",e)}const xl={...Up,...jn("MuiOutlinedInput",["root","notchedOutline","input"])};function lJ(e){return Gn("MuiFilledInput",e)}const Yh={...Up,...jn("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},cJ=Dy(Kt.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),uJ={entering:{opacity:1},entered:{opacity:1}},hJ=we.forwardRef(function(t,i){const l=rI(),d={enter:l.transitions.duration.enteringScreen,exit:l.transitions.duration.leavingScreen},{addEndListener:y,appear:S=!0,children:R,easing:a,in:N,onEnter:G,onEntered:q,onEntering:X,onExit:oe,onExited:te,onExiting:ie,style:pe,timeout:se=d,TransitionComponent:le=Ll,...ce}=t,Me=we.useRef(null),Le=Wo(Me,Ty(R),i),Je=Mt=>yt=>{if(Mt){const gt=Me.current;yt===void 0?Mt(gt):Mt(gt,yt)}},Qe=Je(X),je=Je((Mt,yt)=>{g5(Mt);const gt=p1({style:pe,timeout:se,easing:a},{mode:"enter"});Mt.style.webkitTransition=l.transitions.create("opacity",gt),Mt.style.transition=l.transitions.create("opacity",gt),G&&G(Mt,yt)}),Ct=Je(q),ye=Je(ie),et=Je(Mt=>{const yt=p1({style:pe,timeout:se,easing:a},{mode:"exit"});Mt.style.webkitTransition=l.transitions.create("opacity",yt),Mt.style.transition=l.transitions.create("opacity",yt),oe&&oe(Mt)}),dt=Je(te),Xt=Mt=>{y&&y(Me.current,Mt)};return Kt.jsx(le,{appear:S,in:N,nodeRef:Me,onEnter:je,onEntered:Ct,onEntering:Qe,onExit:et,onExited:dt,onExiting:ye,addEndListener:Xt,timeout:se,...ce,children:(Mt,yt)=>we.cloneElement(R,{style:{opacity:0,visibility:Mt==="exited"&&!N?"hidden":void 0,...uJ[Mt],...pe,...R.props.style},ref:Le,...yt})})});function dJ(e){return Gn("MuiBackdrop",e)}jn("MuiBackdrop",["root","invisible"]);const fJ=e=>{const{ownerState:t,...i}=e;return i},pJ=e=>{const{classes:t,invisible:i}=e;return Jn({root:["root",i&&"invisible"]},dJ,t)},mJ=jr("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.invisible&&t.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),gJ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiBackdrop"}),{children:d,className:y,component:S="div",invisible:R=!1,open:a,components:N={},componentsProps:G={},slotProps:q={},slots:X={},TransitionComponent:oe,transitionDuration:te,...ie}=l,pe={...l,component:S,invisible:R},se=pJ(pe),le={transition:oe,root:N.Root,...X},ce={...G,...q},Me={slots:le,slotProps:ce},[Le,Je]=$s("root",{elementType:mJ,externalForwardedProps:Me,className:ln(se.root,y),ownerState:pe}),[Qe,je]=$s("transition",{elementType:hJ,externalForwardedProps:Me,ownerState:pe}),Ct=fJ(je);return Kt.jsx(Qe,{in:a,timeout:te,...ie,...Ct,children:Kt.jsx(Le,{"aria-hidden":!0,...Je,classes:se,ref:i,children:d})})}),_J=jn("MuiBox",["root"]),yJ=d5(),Pu=oX({themeId:Ob,defaultTheme:yJ,defaultClassName:_J.root,generateClassName:PB.generate});function vJ(e){return Gn("MuiButton",e)}const tp=jn("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),xJ=we.createContext({}),bJ=we.createContext(void 0),wJ=e=>{const{color:t,disableElevation:i,fullWidth:l,size:d,variant:y,classes:S}=e,R={root:["root",y,`${y}${nn(t)}`,`size${nn(d)}`,`${y}Size${nn(d)}`,`color${nn(t)}`,i&&"disableElevation",l&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${nn(d)}`],endIcon:["icon","endIcon",`iconSize${nn(d)}`]},a=Jn(R,vJ,S);return{...S,...a}},y5=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],SJ=jr(WK,{shouldForwardProp:e=>Ks(e)||e==="classes",name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],t[`${i.variant}${nn(i.color)}`],t[`size${nn(i.size)}`],t[`${i.variant}Size${nn(i.size)}`],i.color==="inherit"&&t.colorInherit,i.disableElevation&&t.disableElevation,i.fullWidth&&t.fullWidth]}})(Ri(({theme:e})=>{const t=e.palette.mode==="light"?e.palette.grey[300]:e.palette.grey[800],i=e.palette.mode==="light"?e.palette.grey.A100:e.palette.grey[700];return{...e.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${tp.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(e.vars||e).shadows[2],"&:hover":{boxShadow:(e.vars||e).shadows[4],"@media (hover: none)":{boxShadow:(e.vars||e).shadows[2]}},"&:active":{boxShadow:(e.vars||e).shadows[8]},[`&.${tp.focusVisible}`]:{boxShadow:(e.vars||e).shadows[6]},[`&.${tp.disabled}`]:{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${tp.disabled}`]:{border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(e.palette).filter(Pd()).map(([l])=>({props:{color:l},style:{"--variant-textColor":(e.vars||e).palette[l].main,"--variant-outlinedColor":(e.vars||e).palette[l].main,"--variant-outlinedBorder":e.vars?`rgba(${e.vars.palette[l].mainChannel} / 0.5)`:_s(e.palette[l].main,.5),"--variant-containedColor":(e.vars||e).palette[l].contrastText,"--variant-containedBg":(e.vars||e).palette[l].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(e.vars||e).palette[l].dark,"--variant-textBg":e.vars?`rgba(${e.vars.palette[l].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_s(e.palette[l].main,e.palette.action.hoverOpacity),"--variant-outlinedBorder":(e.vars||e).palette[l].main,"--variant-outlinedBg":e.vars?`rgba(${e.vars.palette[l].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_s(e.palette[l].main,e.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":e.vars?e.vars.palette.Button.inheritContainedBg:t,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":e.vars?e.vars.palette.Button.inheritContainedHoverBg:i,"--variant-textBg":e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:_s(e.palette.text.primary,e.palette.action.hoverOpacity),"--variant-outlinedBg":e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:_s(e.palette.text.primary,e.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:e.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:e.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:e.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${tp.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${tp.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}}]}})),TJ=jr("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.startIcon,t[`iconSize${nn(i.size)}`]]}})({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},...y5]}),EJ=jr("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.endIcon,t[`iconSize${nn(i.size)}`]]}})({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},...y5]}),v5=we.forwardRef(function(t,i){const l=we.useContext(xJ),d=we.useContext(bJ),y=l1(l,t),S=Qn({props:y,name:"MuiButton"}),{children:R,color:a="primary",component:N="button",className:G,disabled:q=!1,disableElevation:X=!1,disableFocusRipple:oe=!1,endIcon:te,focusVisibleClassName:ie,fullWidth:pe=!1,size:se="medium",startIcon:le,type:ce,variant:Me="text",...Le}=S,Je={...S,color:a,component:N,disabled:q,disableElevation:X,disableFocusRipple:oe,fullWidth:pe,size:se,type:ce,variant:Me},Qe=wJ(Je),je=le&&Kt.jsx(TJ,{className:Qe.startIcon,ownerState:Je,children:le}),Ct=te&&Kt.jsx(EJ,{className:Qe.endIcon,ownerState:Je,children:te}),ye=d||"";return Kt.jsxs(SJ,{ownerState:Je,className:ln(l.className,Qe.root,G,ye),component:N,disabled:q,focusRipple:!oe,focusVisibleClassName:ln(Qe.focusVisible,ie),ref:i,type:ce,...Le,classes:Qe,children:[je,R,Ct]})});function MJ(e){return Gn("MuiCircularProgress",e)}jn("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const xu=44,qE=Ay`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,ZE=Ay`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`,CJ=typeof qE!="string"?XC`
        animation: ${qE} 1.4s linear infinite;
      `:null,IJ=typeof ZE!="string"?XC`
        animation: ${ZE} 1.4s ease-in-out infinite;
      `:null,PJ=e=>{const{classes:t,variant:i,color:l,disableShrink:d}=e,y={root:["root",i,`color${nn(l)}`],svg:["svg"],circle:["circle",`circle${nn(i)}`,d&&"circleDisableShrink"]};return Jn(y,MJ,t)},AJ=jr("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],t[`color${nn(i.color)}`]]}})(Ri(({theme:e})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:e.transitions.create("transform")}},{props:{variant:"indeterminate"},style:CJ||{animation:`${qE} 1.4s linear infinite`}},...Object.entries(e.palette).filter(Pd()).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}}))]}))),DJ=jr("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),RJ=jr("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.circle,t[`circle${nn(i.variant)}`],i.disableShrink&&t.circleDisableShrink]}})(Ri(({theme:e})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:e.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:t})=>t.variant==="indeterminate"&&!t.disableShrink,style:IJ||{animation:`${ZE} 1.4s ease-in-out infinite`}}]}))),kJ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiCircularProgress"}),{className:d,color:y="primary",disableShrink:S=!1,size:R=40,style:a,thickness:N=3.6,value:G=0,variant:q="indeterminate",...X}=l,oe={...l,color:y,disableShrink:S,size:R,thickness:N,value:G,variant:q},te=PJ(oe),ie={},pe={},se={};if(q==="determinate"){const le=2*Math.PI*((xu-N)/2);ie.strokeDasharray=le.toFixed(3),se["aria-valuenow"]=Math.round(G),ie.strokeDashoffset=`${((100-G)/100*le).toFixed(3)}px`,pe.transform="rotate(-90deg)"}return Kt.jsx(AJ,{className:ln(te.root,d),style:{width:R,height:R,...pe,...a},ownerState:oe,ref:i,role:"progressbar",...se,...X,children:Kt.jsx(DJ,{className:te.svg,ownerState:oe,viewBox:`${xu/2} ${xu/2} ${xu} ${xu}`,children:Kt.jsx(RJ,{className:te.circle,style:ie,ownerState:oe,cx:xu,cy:xu,r:(xu-N)/2,fill:"none",strokeWidth:N})})})});function OJ(e){const t=Ys(e);return t.body===e?yc(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}function D_(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function dO(e){return parseInt(yc(e).getComputedStyle(e).paddingRight,10)||0}function LJ(e){const i=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(e.tagName),l=e.tagName==="INPUT"&&e.getAttribute("type")==="hidden";return i||l}function fO(e,t,i,l,d){const y=[t,i,...l];[].forEach.call(e.children,S=>{const R=!y.includes(S),a=!LJ(S);R&&a&&D_(S,d)})}function yT(e,t){let i=-1;return e.some((l,d)=>t(l)?(i=d,!0):!1),i}function zJ(e,t){const i=[],l=e.container;if(!t.disableScrollLock){if(OJ(l)){const S=IB(yc(l));i.push({value:l.style.paddingRight,property:"padding-right",el:l}),l.style.paddingRight=`${dO(l)+S}px`;const R=Ys(l).querySelectorAll(".mui-fixed");[].forEach.call(R,a=>{i.push({value:a.style.paddingRight,property:"padding-right",el:a}),a.style.paddingRight=`${dO(a)+S}px`})}let y;if(l.parentNode instanceof DocumentFragment)y=Ys(l).body;else{const S=l.parentElement,R=yc(l);y=(S==null?void 0:S.nodeName)==="HTML"&&R.getComputedStyle(S).overflowY==="scroll"?S:l}i.push({value:y.style.overflow,property:"overflow",el:y},{value:y.style.overflowX,property:"overflow-x",el:y},{value:y.style.overflowY,property:"overflow-y",el:y}),y.style.overflow="hidden"}return()=>{i.forEach(({value:y,el:S,property:R})=>{y?S.style.setProperty(R,y):S.style.removeProperty(R)})}}function FJ(e){const t=[];return[].forEach.call(e.children,i=>{i.getAttribute("aria-hidden")==="true"&&t.push(i)}),t}class BJ{constructor(){this.modals=[],this.containers=[]}add(t,i){let l=this.modals.indexOf(t);if(l!==-1)return l;l=this.modals.length,this.modals.push(t),t.modalRef&&D_(t.modalRef,!1);const d=FJ(i);fO(i,t.mount,t.modalRef,d,!0);const y=yT(this.containers,S=>S.container===i);return y!==-1?(this.containers[y].modals.push(t),l):(this.containers.push({modals:[t],container:i,restore:null,hiddenSiblings:d}),l)}mount(t,i){const l=yT(this.containers,y=>y.modals.includes(t)),d=this.containers[l];d.restore||(d.restore=zJ(d,i))}remove(t,i=!0){const l=this.modals.indexOf(t);if(l===-1)return l;const d=yT(this.containers,S=>S.modals.includes(t)),y=this.containers[d];if(y.modals.splice(y.modals.indexOf(t),1),this.modals.splice(l,1),y.modals.length===0)y.restore&&y.restore(),t.modalRef&&D_(t.modalRef,i),fO(y.container,t.mount,t.modalRef,y.hiddenSiblings,!1),this.containers.splice(d,1);else{const S=y.modals[y.modals.length-1];S.modalRef&&D_(S.modalRef,!1)}return l}isTopModal(t){return this.modals.length>0&&this.modals[this.modals.length-1]===t}}const NJ=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function UJ(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?e.contentEditable==="true"||(e.nodeName==="AUDIO"||e.nodeName==="VIDEO"||e.nodeName==="DETAILS")&&e.getAttribute("tabindex")===null?0:e.tabIndex:t}function jJ(e){if(e.tagName!=="INPUT"||e.type!=="radio"||!e.name)return!1;const t=l=>e.ownerDocument.querySelector(`input[type="radio"]${l}`);let i=t(`[name="${e.name}"]:checked`);return i||(i=t(`[name="${e.name}"]`)),i!==e}function VJ(e){return!(e.disabled||e.tagName==="INPUT"&&e.type==="hidden"||jJ(e))}function $J(e){const t=[],i=[];return Array.from(e.querySelectorAll(NJ)).forEach((l,d)=>{const y=UJ(l);y===-1||!VJ(l)||(y===0?t.push(l):i.push({documentOrder:d,tabIndex:y,node:l}))}),i.sort((l,d)=>l.tabIndex===d.tabIndex?l.documentOrder-d.documentOrder:l.tabIndex-d.tabIndex).map(l=>l.node).concat(t)}function WJ(){return!0}function GJ(e){const{children:t,disableAutoFocus:i=!1,disableEnforceFocus:l=!1,disableRestoreFocus:d=!1,getTabbable:y=$J,isEnabled:S=WJ,open:R}=e,a=we.useRef(!1),N=we.useRef(null),G=we.useRef(null),q=we.useRef(null),X=we.useRef(null),oe=we.useRef(!1),te=we.useRef(null),ie=Wo(Ty(t),te),pe=we.useRef(null);we.useEffect(()=>{!R||!te.current||(oe.current=!i)},[i,R]),we.useEffect(()=>{if(!R||!te.current)return;const ce=Ys(te.current);return te.current.contains(ce.activeElement)||(te.current.hasAttribute("tabIndex")||te.current.setAttribute("tabIndex","-1"),oe.current&&te.current.focus()),()=>{d||(q.current&&q.current.focus&&(a.current=!0,q.current.focus()),q.current=null)}},[R]),we.useEffect(()=>{if(!R||!te.current)return;const ce=Ys(te.current),Me=Qe=>{pe.current=Qe,!(l||!S()||Qe.key!=="Tab")&&ce.activeElement===te.current&&Qe.shiftKey&&(a.current=!0,G.current&&G.current.focus())},Le=()=>{var Ct,ye;const Qe=te.current;if(Qe===null)return;if(!ce.hasFocus()||!S()||a.current){a.current=!1;return}if(Qe.contains(ce.activeElement)||l&&ce.activeElement!==N.current&&ce.activeElement!==G.current)return;if(ce.activeElement!==X.current)X.current=null;else if(X.current!==null)return;if(!oe.current)return;let je=[];if((ce.activeElement===N.current||ce.activeElement===G.current)&&(je=y(te.current)),je.length>0){const et=!!((Ct=pe.current)!=null&&Ct.shiftKey&&((ye=pe.current)==null?void 0:ye.key)==="Tab"),dt=je[0],Xt=je[je.length-1];typeof dt!="string"&&typeof Xt!="string"&&(et?Xt.focus():dt.focus())}else Qe.focus()};ce.addEventListener("focusin",Le),ce.addEventListener("keydown",Me,!0);const Je=setInterval(()=>{ce.activeElement&&ce.activeElement.tagName==="BODY"&&Le()},50);return()=>{clearInterval(Je),ce.removeEventListener("focusin",Le),ce.removeEventListener("keydown",Me,!0)}},[i,l,d,S,R,y]);const se=ce=>{q.current===null&&(q.current=ce.relatedTarget),oe.current=!0,X.current=ce.target;const Me=t.props.onFocus;Me&&Me(ce)},le=ce=>{q.current===null&&(q.current=ce.relatedTarget),oe.current=!0};return Kt.jsxs(we.Fragment,{children:[Kt.jsx("div",{tabIndex:R?0:-1,onFocus:le,ref:N,"data-testid":"sentinelStart"}),we.cloneElement(t,{ref:ie,onFocus:se}),Kt.jsx("div",{tabIndex:R?0:-1,onFocus:le,ref:G,"data-testid":"sentinelEnd"})]})}function HJ(e){return typeof e=="function"?e():e}function qJ(e){return e?e.props.hasOwnProperty("in"):!1}const pO=()=>{},Qv=new BJ;function ZJ(e){const{container:t,disableEscapeKeyDown:i=!1,disableScrollLock:l=!1,closeAfterTransition:d=!1,onTransitionEnter:y,onTransitionExited:S,children:R,onClose:a,open:N,rootRef:G}=e,q=we.useRef({}),X=we.useRef(null),oe=we.useRef(null),te=Wo(oe,G),[ie,pe]=we.useState(!N),se=qJ(R);let le=!0;(e["aria-hidden"]==="false"||e["aria-hidden"]===!1)&&(le=!1);const ce=()=>Ys(X.current),Me=()=>(q.current.modalRef=oe.current,q.current.mount=X.current,q.current),Le=()=>{Qv.mount(Me(),{disableScrollLock:l}),oe.current&&(oe.current.scrollTop=0)},Je=Mp(()=>{const yt=HJ(t)||ce().body;Qv.add(Me(),yt),oe.current&&Le()}),Qe=()=>Qv.isTopModal(Me()),je=Mp(yt=>{X.current=yt,yt&&(N&&Qe()?Le():oe.current&&D_(oe.current,le))}),Ct=we.useCallback(()=>{Qv.remove(Me(),le)},[le]);we.useEffect(()=>()=>{Ct()},[Ct]),we.useEffect(()=>{N?Je():(!se||!d)&&Ct()},[N,Ct,se,d,Je]);const ye=yt=>gt=>{var Ze;(Ze=yt.onKeyDown)==null||Ze.call(yt,gt),!(gt.key!=="Escape"||gt.which===229||!Qe())&&(i||(gt.stopPropagation(),a&&a(gt,"escapeKeyDown")))},et=yt=>gt=>{var Ze;(Ze=yt.onClick)==null||Ze.call(yt,gt),gt.target===gt.currentTarget&&a&&a(gt,"backdropClick")};return{getRootProps:(yt={})=>{const gt=RB(e);delete gt.onTransitionEnter,delete gt.onTransitionExited;const Ze={...gt,...yt};return{role:"presentation",...Ze,onKeyDown:ye(Ze),ref:te}},getBackdropProps:(yt={})=>{const gt=yt;return{"aria-hidden":!0,...gt,onClick:et(gt),open:N}},getTransitionProps:()=>{const yt=()=>{pe(!1),y&&y()},gt=()=>{pe(!0),S&&S(),d&&Ct()};return{onEnter:Pk(yt,(R==null?void 0:R.props.onEnter)??pO),onExited:Pk(gt,(R==null?void 0:R.props.onExited)??pO)}},rootRef:te,portalRef:je,isTopModal:Qe,exited:ie,hasTransition:se}}function YJ(e){return Gn("MuiModal",e)}jn("MuiModal",["root","hidden","backdrop"]);const XJ=e=>{const{open:t,exited:i,classes:l}=e;return Jn({root:["root",!t&&i&&"hidden"],backdrop:["backdrop"]},YJ,l)},KJ=jr("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,!i.open&&i.exited&&t.hidden]}})(Ri(({theme:e})=>({position:"fixed",zIndex:(e.vars||e).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:t})=>!t.open&&t.exited,style:{visibility:"hidden"}}]}))),JJ=jr(gJ,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),QJ=we.forwardRef(function(t,i){const l=Qn({name:"MuiModal",props:t}),{BackdropComponent:d=JJ,BackdropProps:y,classes:S,className:R,closeAfterTransition:a=!1,children:N,container:G,component:q,components:X={},componentsProps:oe={},disableAutoFocus:te=!1,disableEnforceFocus:ie=!1,disableEscapeKeyDown:pe=!1,disablePortal:se=!1,disableRestoreFocus:le=!1,disableScrollLock:ce=!1,hideBackdrop:Me=!1,keepMounted:Le=!1,onBackdropClick:Je,onClose:Qe,onTransitionEnter:je,onTransitionExited:Ct,open:ye,slotProps:et={},slots:dt={},theme:Xt,...Mt}=l,yt={...l,closeAfterTransition:a,disableAutoFocus:te,disableEnforceFocus:ie,disableEscapeKeyDown:pe,disablePortal:se,disableRestoreFocus:le,disableScrollLock:ce,hideBackdrop:Me,keepMounted:Le},{getRootProps:gt,getBackdropProps:Ze,getTransitionProps:ht,portalRef:Dt,isTopModal:Tt,exited:tr,hasTransition:Vr}=ZJ({...yt,rootRef:i}),Nr={...yt,exited:tr},ct=XJ(Nr),$t={};if(N.props.tabIndex===void 0&&($t.tabIndex="-1"),Vr){const{onEnter:er,onExited:cr}=ht();$t.onEnter=er,$t.onExited=cr}const Ht={...Mt,slots:{root:X.Root,backdrop:X.Backdrop,...dt},slotProps:{...oe,...et}},[Bt,It]=$s("root",{elementType:KJ,externalForwardedProps:Ht,getSlotProps:gt,additionalProps:{ref:i,as:q},ownerState:Nr,className:ln(R,ct==null?void 0:ct.root,!Nr.open&&Nr.exited&&(ct==null?void 0:ct.hidden))}),[qt,Wt]=$s("backdrop",{elementType:d,externalForwardedProps:Ht,additionalProps:y,getSlotProps:er=>Ze({...er,onClick:cr=>{Je&&Je(cr),er!=null&&er.onClick&&er.onClick(cr)}}),className:ln(y==null?void 0:y.className,ct==null?void 0:ct.backdrop),ownerState:Nr}),be=Wo(y==null?void 0:y.ref,Wt.ref);return!Le&&!ye&&(!Vr||tr)?null:Kt.jsx(QK,{ref:Dt,container:G,disablePortal:se,children:Kt.jsxs(Bt,{...It,children:[!Me&&d?Kt.jsx(qt,{...Wt,ref:be}):null,Kt.jsx(GJ,{disableEnforceFocus:ie,disableAutoFocus:te,disableRestoreFocus:le,isEnabled:Tt,open:ye,children:we.cloneElement(N,$t)})]})})}),eQ=e=>{const{classes:t,disableUnderline:i,startAdornment:l,endAdornment:d,size:y,hiddenLabel:S,multiline:R}=e,a={root:["root",!i&&"underline",l&&"adornedStart",d&&"adornedEnd",y==="small"&&`size${nn(y)}`,S&&"hiddenLabel",R&&"multiline"],input:["input"]},N=Jn(a,lJ,t);return{...t,...N}},tQ=jr(Fb,{shouldForwardProp:e=>Ks(e)||e==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[...Lb(e,t),!i.disableUnderline&&t.underline]}})(Ri(({theme:e})=>{const t=e.palette.mode==="light",i=t?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",l=t?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",d=t?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",y=t?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:e.vars?e.vars.palette.FilledInput.bg:l,borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),"&:hover":{backgroundColor:e.vars?e.vars.palette.FilledInput.hoverBg:d,"@media (hover: none)":{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:l}},[`&.${Yh.focused}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:l},[`&.${Yh.disabled}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.disabledBg:y},variants:[{props:({ownerState:S})=>!S.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Yh.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Yh.error}`]:{"&::before, &::after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`:i}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Yh.disabled}, .${Yh.error}):before`]:{borderBottom:`1px solid ${(e.vars||e).palette.text.primary}`},[`&.${Yh.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(e.palette).filter(Pd()).map(([S])=>{var R;return{props:{disableUnderline:!1,color:S},style:{"&::after":{borderBottom:`2px solid ${(R=(e.vars||e).palette[S])==null?void 0:R.main}`}}}}),{props:({ownerState:S})=>S.startAdornment,style:{paddingLeft:12}},{props:({ownerState:S})=>S.endAdornment,style:{paddingRight:12}},{props:({ownerState:S})=>S.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:S,size:R})=>S.multiline&&R==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:S})=>S.multiline&&S.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:S})=>S.multiline&&S.hiddenLabel&&S.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),rQ=jr(Bb,{name:"MuiFilledInput",slot:"Input",overridesResolver:zb})(Ri(({theme:e})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!e.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:e.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:e.palette.mode==="light"?null:"#fff",caretColor:e.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...e.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[e.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:t})=>t.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:0}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:0}},{props:({ownerState:t})=>t.hiddenLabel&&t.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:t})=>t.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),_1=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiFilledInput"}),{disableUnderline:d=!1,components:y={},componentsProps:S,fullWidth:R=!1,hiddenLabel:a,inputComponent:N="input",multiline:G=!1,slotProps:q,slots:X={},type:oe="text",...te}=l,ie={...l,disableUnderline:d,fullWidth:R,inputComponent:N,multiline:G,type:oe},pe=eQ(l),se={root:{ownerState:ie},input:{ownerState:ie}},le=q??S?Vo(se,q??S):se,ce=X.root??y.Root??tQ,Me=X.input??y.Input??rQ;return Kt.jsx(aI,{slots:{root:ce,input:Me},slotProps:le,fullWidth:R,inputComponent:N,multiline:G,ref:i,type:oe,...te,classes:pe})});_1&&(_1.muiName="Input");function nQ(e){return Gn("MuiFormControl",e)}jn("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const iQ=e=>{const{classes:t,margin:i,fullWidth:l}=e,d={root:["root",i!=="none"&&`margin${nn(i)}`,l&&"fullWidth"]};return Jn(d,nQ,t)},oQ=jr("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[`margin${nn(i.margin)}`],i.fullWidth&&t.fullWidth]}})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),aQ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiFormControl"}),{children:d,className:y,color:S="primary",component:R="div",disabled:a=!1,error:N=!1,focused:G,fullWidth:q=!1,hiddenLabel:X=!1,margin:oe="none",required:te=!1,size:ie="medium",variant:pe="outlined",...se}=l,le={...l,color:S,component:R,disabled:a,error:N,fullWidth:q,hiddenLabel:X,margin:oe,required:te,size:ie,variant:pe},ce=iQ(le),[Me,Le]=we.useState(()=>{let Xt=!1;return d&&we.Children.forEach(d,Mt=>{if(!fT(Mt,["Input","Select"]))return;const yt=fT(Mt,["Select"])?Mt.props.input:Mt;yt&&nJ(yt.props)&&(Xt=!0)}),Xt}),[Je,Qe]=we.useState(()=>{let Xt=!1;return d&&we.Children.forEach(d,Mt=>{fT(Mt,["Input","Select"])&&(g1(Mt.props,!0)||g1(Mt.props.inputProps,!0))&&(Xt=!0)}),Xt}),[je,Ct]=we.useState(!1);a&&je&&Ct(!1);const ye=G!==void 0&&!a?G:je;let et;we.useRef(!1);const dt=we.useMemo(()=>({adornedStart:Me,setAdornedStart:Le,color:S,disabled:a,error:N,filled:Je,focused:ye,fullWidth:q,hiddenLabel:X,size:ie,onBlur:()=>{Ct(!1)},onEmpty:()=>{Qe(!1)},onFilled:()=>{Qe(!0)},onFocus:()=>{Ct(!0)},registerEffect:et,required:te,variant:pe}),[Me,S,a,N,Je,ye,q,X,et,te,ie,pe]);return Kt.jsx(oI.Provider,{value:dt,children:Kt.jsx(oQ,{as:R,ownerState:le,className:ln(ce.root,y),ref:i,...se,children:d})})});function sQ(e){return Gn("MuiFormHelperText",e)}const mO=jn("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var gO;const lQ=e=>{const{classes:t,contained:i,size:l,disabled:d,error:y,filled:S,focused:R,required:a}=e,N={root:["root",d&&"disabled",y&&"error",l&&`size${nn(l)}`,i&&"contained",R&&"focused",S&&"filled",a&&"required"]};return Jn(N,sQ,t)},cQ=jr("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.size&&t[`size${nn(i.size)}`],i.contained&&t.contained,i.filled&&t.filled]}})(Ri(({theme:e})=>({color:(e.vars||e).palette.text.secondary,...e.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${mO.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${mO.error}`]:{color:(e.vars||e).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:t})=>t.contained,style:{marginLeft:14,marginRight:14}}]}))),uQ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiFormHelperText"}),{children:d,className:y,component:S="p",disabled:R,error:a,filled:N,focused:G,margin:q,required:X,variant:oe,...te}=l,ie=em(),pe=Qp({props:l,muiFormControl:ie,states:["variant","size","disabled","error","filled","focused","required"]}),se={...l,component:S,contained:pe.variant==="filled"||pe.variant==="outlined",variant:pe.variant,size:pe.size,disabled:pe.disabled,error:pe.error,filled:pe.filled,focused:pe.focused,required:pe.required};delete se.ownerState;const le=lQ(se);return Kt.jsx(cQ,{as:S,className:ln(le.root,y),ref:i,...te,ownerState:se,children:d===" "?gO||(gO=Kt.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):d})});function hQ(e){return Gn("MuiFormLabel",e)}const R_=jn("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),dQ=e=>{const{classes:t,color:i,focused:l,disabled:d,error:y,filled:S,required:R}=e,a={root:["root",`color${nn(i)}`,d&&"disabled",y&&"error",S&&"filled",l&&"focused",R&&"required"],asterisk:["asterisk",y&&"error"]};return Jn(a,hQ,t)},fQ=jr("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.color==="secondary"&&t.colorSecondary,i.filled&&t.filled]}})(Ri(({theme:e})=>({color:(e.vars||e).palette.text.secondary,...e.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(e.palette).filter(Pd()).map(([t])=>({props:{color:t},style:{[`&.${R_.focused}`]:{color:(e.vars||e).palette[t].main}}})),{props:{},style:{[`&.${R_.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${R_.error}`]:{color:(e.vars||e).palette.error.main}}}]}))),pQ=jr("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})(Ri(({theme:e})=>({[`&.${R_.error}`]:{color:(e.vars||e).palette.error.main}}))),mQ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiFormLabel"}),{children:d,className:y,color:S,component:R="label",disabled:a,error:N,filled:G,focused:q,required:X,...oe}=l,te=em(),ie=Qp({props:l,muiFormControl:te,states:["color","required","focused","disabled","error","filled"]}),pe={...l,color:ie.color||"primary",component:R,disabled:ie.disabled,error:ie.error,filled:ie.filled,focused:ie.focused,required:ie.required},se=dQ(pe);return Kt.jsxs(fQ,{as:R,ownerState:pe,className:ln(se.root,y),ref:i,...oe,children:[d,ie.required&&Kt.jsxs(pQ,{ownerState:pe,"aria-hidden":!0,className:se.asterisk,children:[" ","*"]})]})});function YE(e){return`scale(${e}, ${e**2})`}const gQ={entering:{opacity:1,transform:YE(1)},entered:{opacity:1,transform:"none"}},vT=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),XE=we.forwardRef(function(t,i){const{addEndListener:l,appear:d=!0,children:y,easing:S,in:R,onEnter:a,onEntered:N,onEntering:G,onExit:q,onExited:X,onExiting:oe,style:te,timeout:ie="auto",TransitionComponent:pe=Ll,...se}=t,le=CB(),ce=we.useRef(),Me=rI(),Le=we.useRef(null),Je=Wo(Le,Ty(y),i),Qe=yt=>gt=>{if(yt){const Ze=Le.current;gt===void 0?yt(Ze):yt(Ze,gt)}},je=Qe(G),Ct=Qe((yt,gt)=>{g5(yt);const{duration:Ze,delay:ht,easing:Dt}=p1({style:te,timeout:ie,easing:S},{mode:"enter"});let Tt;ie==="auto"?(Tt=Me.transitions.getAutoHeightDuration(yt.clientHeight),ce.current=Tt):Tt=Ze,yt.style.transition=[Me.transitions.create("opacity",{duration:Tt,delay:ht}),Me.transitions.create("transform",{duration:vT?Tt:Tt*.666,delay:ht,easing:Dt})].join(","),a&&a(yt,gt)}),ye=Qe(N),et=Qe(oe),dt=Qe(yt=>{const{duration:gt,delay:Ze,easing:ht}=p1({style:te,timeout:ie,easing:S},{mode:"exit"});let Dt;ie==="auto"?(Dt=Me.transitions.getAutoHeightDuration(yt.clientHeight),ce.current=Dt):Dt=gt,yt.style.transition=[Me.transitions.create("opacity",{duration:Dt,delay:Ze}),Me.transitions.create("transform",{duration:vT?Dt:Dt*.666,delay:vT?Ze:Ze||Dt*.333,easing:ht})].join(","),yt.style.opacity=0,yt.style.transform=YE(.75),q&&q(yt)}),Xt=Qe(X),Mt=yt=>{ie==="auto"&&le.start(ce.current||0,yt),l&&l(Le.current,yt)};return Kt.jsx(pe,{appear:d,in:R,nodeRef:Le,onEnter:Ct,onEntered:ye,onEntering:je,onExit:dt,onExited:Xt,onExiting:et,addEndListener:Mt,timeout:ie==="auto"?null:ie,...se,children:(yt,gt)=>we.cloneElement(y,{style:{opacity:0,transform:YE(.75),visibility:yt==="exited"&&!R?"hidden":void 0,...gQ[yt],...te,...y.props.style},ref:Je,...gt})})});XE&&(XE.muiSupportAuto=!0);const _Q=e=>{const{classes:t,disableUnderline:i}=e,d=Jn({root:["root",!i&&"underline"],input:["input"]},aJ,t);return{...t,...d}},yQ=jr(Fb,{shouldForwardProp:e=>Ks(e)||e==="classes",name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[...Lb(e,t),!i.disableUnderline&&t.underline]}})(Ri(({theme:e})=>{let i=e.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return e.vars&&(i=`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:l})=>l.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:l})=>!l.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${c_.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${c_.error}`]:{"&::before, &::after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${i}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${c_.disabled}, .${c_.error}):before`]:{borderBottom:`2px solid ${(e.vars||e).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${i}`}},[`&.${c_.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(e.palette).filter(Pd()).map(([l])=>({props:{color:l,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(e.vars||e).palette[l].main}`}}}))]}})),vQ=jr(Bb,{name:"MuiInput",slot:"Input",overridesResolver:zb})({}),y1=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiInput"}),{disableUnderline:d=!1,components:y={},componentsProps:S,fullWidth:R=!1,inputComponent:a="input",multiline:N=!1,slotProps:G,slots:q={},type:X="text",...oe}=l,te=_Q(l),pe={root:{ownerState:{disableUnderline:d}}},se=G??S?Vo(G??S,pe):pe,le=q.root??y.Root??yQ,ce=q.input??y.Input??vQ;return Kt.jsx(aI,{slots:{root:le,input:ce},slotProps:se,fullWidth:R,inputComponent:a,multiline:N,ref:i,type:X,...oe,classes:te})});y1&&(y1.muiName="Input");function xQ(e){return Gn("MuiInputLabel",e)}jn("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const bQ=e=>{const{classes:t,formControl:i,size:l,shrink:d,disableAnimation:y,variant:S,required:R}=e,a={root:["root",i&&"formControl",!y&&"animated",d&&"shrink",l&&l!=="normal"&&`size${nn(l)}`,S],asterisk:[R&&"asterisk"]},N=Jn(a,xQ,t);return{...t,...N}},wQ=jr(mQ,{shouldForwardProp:e=>Ks(e)||e==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[{[`& .${R_.asterisk}`]:t.asterisk},t.root,i.formControl&&t.formControl,i.size==="small"&&t.sizeSmall,i.shrink&&t.shrink,!i.disableAnimation&&t.animated,i.focused&&t.focused,t[i.variant]]}})(Ri(({theme:e})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:t})=>t.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:t})=>t.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:t})=>!t.disableAnimation,style:{transition:e.transitions.create(["color","transform","max-width"],{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:t,ownerState:i})=>t==="filled"&&i.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:t,ownerState:i,size:l})=>t==="filled"&&i.shrink&&l==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:t,ownerState:i})=>t==="outlined"&&i.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),SQ=we.forwardRef(function(t,i){const l=Qn({name:"MuiInputLabel",props:t}),{disableAnimation:d=!1,margin:y,shrink:S,variant:R,className:a,...N}=l,G=em();let q=S;typeof q>"u"&&G&&(q=G.filled||G.focused||G.adornedStart);const X=Qp({props:l,muiFormControl:G,states:["size","variant","required","focused"]}),oe={...l,disableAnimation:d,formControl:G,shrink:q,size:X.size,variant:X.variant,required:X.required,focused:X.focused},te=bQ(oe);return Kt.jsx(wQ,{"data-shrink":q,ref:i,className:ln(te.root,a),...N,ownerState:oe,classes:te})}),TQ=we.createContext({});function EQ(e){return Gn("MuiList",e)}jn("MuiList",["root","padding","dense","subheader"]);const MQ=e=>{const{classes:t,disablePadding:i,dense:l,subheader:d}=e;return Jn({root:["root",!i&&"padding",l&&"dense",d&&"subheader"]},EQ,t)},CQ=jr("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,!i.disablePadding&&t.padding,i.dense&&t.dense,i.subheader&&t.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:e})=>!e.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:e})=>e.subheader,style:{paddingTop:0}}]}),IQ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiList"}),{children:d,className:y,component:S="ul",dense:R=!1,disablePadding:a=!1,subheader:N,...G}=l,q=we.useMemo(()=>({dense:R}),[R]),X={...l,component:S,dense:R,disablePadding:a},oe=MQ(X);return Kt.jsx(TQ.Provider,{value:q,children:Kt.jsxs(CQ,{as:S,className:ln(oe.root,y),ref:i,ownerState:X,...G,children:[N,d]})})});function xT(e,t,i){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:i?null:e.firstChild}function _O(e,t,i){return e===t?i?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:i?null:e.lastChild}function x5(e,t){if(t===void 0)return!0;let i=e.innerText;return i===void 0&&(i=e.textContent),i=i.trim().toLowerCase(),i.length===0?!1:t.repeating?i[0]===t.keys[0]:i.startsWith(t.keys.join(""))}function u_(e,t,i,l,d,y){let S=!1,R=d(e,t,t?i:!1);for(;R;){if(R===e.firstChild){if(S)return!1;S=!0}const a=l?!1:R.disabled||R.getAttribute("aria-disabled")==="true";if(!R.hasAttribute("tabindex")||!x5(R,y)||a)R=d(e,R,i);else return R.focus(),!0}return!1}const PQ=we.forwardRef(function(t,i){const{actions:l,autoFocus:d=!1,autoFocusItem:y=!1,children:S,className:R,disabledItemsFocusable:a=!1,disableListWrap:N=!1,onKeyDown:G,variant:q="selectedMenu",...X}=t,oe=we.useRef(null),te=we.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});vd(()=>{d&&oe.current.focus()},[d]),we.useImperativeHandle(l,()=>({adjustStyleForScrollbar:(ce,{direction:Me})=>{const Le=!oe.current.style.width;if(ce.clientHeight<oe.current.clientHeight&&Le){const Je=`${IB(yc(ce))}px`;oe.current.style[Me==="rtl"?"paddingLeft":"paddingRight"]=Je,oe.current.style.width=`calc(100% + ${Je})`}return oe.current}}),[]);const ie=ce=>{const Me=oe.current,Le=ce.key;if(ce.ctrlKey||ce.metaKey||ce.altKey){G&&G(ce);return}const Qe=Ys(Me).activeElement;if(Le==="ArrowDown")ce.preventDefault(),u_(Me,Qe,N,a,xT);else if(Le==="ArrowUp")ce.preventDefault(),u_(Me,Qe,N,a,_O);else if(Le==="Home")ce.preventDefault(),u_(Me,null,N,a,xT);else if(Le==="End")ce.preventDefault(),u_(Me,null,N,a,_O);else if(Le.length===1){const je=te.current,Ct=Le.toLowerCase(),ye=performance.now();je.keys.length>0&&(ye-je.lastTime>500?(je.keys=[],je.repeating=!0,je.previousKeyMatched=!0):je.repeating&&Ct!==je.keys[0]&&(je.repeating=!1)),je.lastTime=ye,je.keys.push(Ct);const et=Qe&&!je.repeating&&x5(Qe,je);je.previousKeyMatched&&(et||u_(Me,Qe,!1,a,xT,je))?ce.preventDefault():je.previousKeyMatched=!1}G&&G(ce)},pe=Wo(oe,i);let se=-1;we.Children.forEach(S,(ce,Me)=>{if(!we.isValidElement(ce)){se===Me&&(se+=1,se>=S.length&&(se=-1));return}ce.props.disabled||(q==="selectedMenu"&&ce.props.selected||se===-1)&&(se=Me),se===Me&&(ce.props.disabled||ce.props.muiSkipListHighlight||ce.type.muiSkipListHighlight)&&(se+=1,se>=S.length&&(se=-1))});const le=we.Children.map(S,(ce,Me)=>{if(Me===se){const Le={};return y&&(Le.autoFocus=!0),ce.props.tabIndex===void 0&&q==="selectedMenu"&&(Le.tabIndex=0),we.cloneElement(ce,Le)}return ce});return Kt.jsx(IQ,{role:"menu",ref:pe,className:R,onKeyDown:ie,tabIndex:d?0:-1,...X,children:le})});function AQ(e){return Gn("MuiPopover",e)}jn("MuiPopover",["root","paper"]);function yO(e,t){let i=0;return typeof t=="number"?i=t:t==="center"?i=e.height/2:t==="bottom"&&(i=e.height),i}function vO(e,t){let i=0;return typeof t=="number"?i=t:t==="center"?i=e.width/2:t==="right"&&(i=e.width),i}function xO(e){return[e.horizontal,e.vertical].map(t=>typeof t=="number"?`${t}px`:t).join(" ")}function bT(e){return typeof e=="function"?e():e}const DQ=e=>{const{classes:t}=e;return Jn({root:["root"],paper:["paper"]},AQ,t)},RQ=jr(QJ,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),b5=jr(_5,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),kQ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiPopover"}),{action:d,anchorEl:y,anchorOrigin:S={vertical:"top",horizontal:"left"},anchorPosition:R,anchorReference:a="anchorEl",children:N,className:G,container:q,elevation:X=8,marginThreshold:oe=16,open:te,PaperProps:ie={},slots:pe={},slotProps:se={},transformOrigin:le={vertical:"top",horizontal:"left"},TransitionComponent:ce=XE,transitionDuration:Me="auto",TransitionProps:{onEntering:Le,...Je}={},disableScrollLock:Qe=!1,...je}=l,Ct=(se==null?void 0:se.paper)??ie,ye=we.useRef(),et={...l,anchorOrigin:S,anchorReference:a,elevation:X,marginThreshold:oe,externalPaperSlotProps:Ct,transformOrigin:le,TransitionComponent:ce,transitionDuration:Me,TransitionProps:Je},dt=DQ(et),Xt=we.useCallback(()=>{if(a==="anchorPosition")return R;const Wt=bT(y),er=(Wt&&Wt.nodeType===1?Wt:Ys(ye.current).body).getBoundingClientRect();return{top:er.top+yO(er,S.vertical),left:er.left+vO(er,S.horizontal)}},[y,S.horizontal,S.vertical,R,a]),Mt=we.useCallback(Wt=>({vertical:yO(Wt,le.vertical),horizontal:vO(Wt,le.horizontal)}),[le.horizontal,le.vertical]),yt=we.useCallback(Wt=>{const be={width:Wt.offsetWidth,height:Wt.offsetHeight},er=Mt(be);if(a==="none")return{top:null,left:null,transformOrigin:xO(er)};const cr=Xt();let pr=cr.top-er.vertical,lt=cr.left-er.horizontal;const Lr=pr+be.height,br=lt+be.width,Kr=yc(bT(y)),sr=Kr.innerHeight-oe,Hr=Kr.innerWidth-oe;if(oe!==null&&pr<oe){const mn=pr-oe;pr-=mn,er.vertical+=mn}else if(oe!==null&&Lr>sr){const mn=Lr-sr;pr-=mn,er.vertical+=mn}if(oe!==null&&lt<oe){const mn=lt-oe;lt-=mn,er.horizontal+=mn}else if(br>Hr){const mn=br-Hr;lt-=mn,er.horizontal+=mn}return{top:`${Math.round(pr)}px`,left:`${Math.round(lt)}px`,transformOrigin:xO(er)}},[y,a,Xt,Mt,oe]),[gt,Ze]=we.useState(te),ht=we.useCallback(()=>{const Wt=ye.current;if(!Wt)return;const be=yt(Wt);be.top!==null&&Wt.style.setProperty("top",be.top),be.left!==null&&(Wt.style.left=be.left),Wt.style.transformOrigin=be.transformOrigin,Ze(!0)},[yt]);we.useEffect(()=>(Qe&&window.addEventListener("scroll",ht),()=>window.removeEventListener("scroll",ht)),[y,Qe,ht]);const Dt=(Wt,be)=>{Le&&Le(Wt,be),ht()},Tt=()=>{Ze(!1)};we.useEffect(()=>{te&&ht()}),we.useImperativeHandle(d,()=>te?{updatePosition:()=>{ht()}}:null,[te,ht]),we.useEffect(()=>{if(!te)return;const Wt=TB(()=>{ht()}),be=yc(y);return be.addEventListener("resize",Wt),()=>{Wt.clear(),be.removeEventListener("resize",Wt)}},[y,te,ht]);let tr=Me;Me==="auto"&&!ce.muiSupportAuto&&(tr=void 0);const Vr=q||(y?Ys(bT(y)).body:void 0),Nr={slots:pe,slotProps:{...se,paper:Ct}},[ct,$t]=$s("paper",{elementType:b5,externalForwardedProps:Nr,additionalProps:{elevation:X,className:ln(dt.paper,Ct==null?void 0:Ct.className),style:gt?Ct.style:{...Ct.style,opacity:0}},ownerState:et}),[Ht,{slotProps:Bt,...It}]=$s("root",{elementType:RQ,externalForwardedProps:Nr,additionalProps:{slotProps:{backdrop:{invisible:!0}},container:Vr,open:te},ownerState:et,className:ln(dt.root,G)}),qt=Wo(ye,$t.ref);return Kt.jsx(Ht,{...It,...!HE(Ht)&&{slotProps:Bt,disableScrollLock:Qe},...je,ref:i,children:Kt.jsx(ce,{appear:!0,in:te,onEntering:Dt,onExited:Tt,timeout:tr,...Je,children:Kt.jsx(ct,{...$t,ref:qt,children:N})})})});function OQ(e){return Gn("MuiMenu",e)}jn("MuiMenu",["root","paper","list"]);const LQ={vertical:"top",horizontal:"right"},zQ={vertical:"top",horizontal:"left"},FQ=e=>{const{classes:t}=e;return Jn({root:["root"],paper:["paper"],list:["list"]},OQ,t)},BQ=jr(kQ,{shouldForwardProp:e=>Ks(e)||e==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),NQ=jr(b5,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),UQ=jr(PQ,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),jQ=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiMenu"}),{autoFocus:d=!0,children:y,className:S,disableAutoFocusItem:R=!1,MenuListProps:a={},onClose:N,open:G,PaperProps:q={},PopoverClasses:X,transitionDuration:oe="auto",TransitionProps:{onEntering:te,...ie}={},variant:pe="selectedMenu",slots:se={},slotProps:le={},...ce}=l,Me=vX(),Le={...l,autoFocus:d,disableAutoFocusItem:R,MenuListProps:a,onEntering:te,PaperProps:q,transitionDuration:oe,TransitionProps:ie,variant:pe},Je=FQ(Le),Qe=d&&!R&&G,je=we.useRef(null),Ct=(gt,Ze)=>{je.current&&je.current.adjustStyleForScrollbar(gt,{direction:Me?"rtl":"ltr"}),te&&te(gt,Ze)},ye=gt=>{gt.key==="Tab"&&(gt.preventDefault(),N&&N(gt,"tabKeyDown"))};let et=-1;we.Children.map(y,(gt,Ze)=>{we.isValidElement(gt)&&(gt.props.disabled||(pe==="selectedMenu"&&gt.props.selected||et===-1)&&(et=Ze))});const dt=se.paper??NQ,Xt=le.paper??q,Mt=Fk({elementType:se.root,externalSlotProps:le.root,ownerState:Le,className:[Je.root,S]}),yt=Fk({elementType:dt,externalSlotProps:Xt,ownerState:Le,className:Je.paper});return Kt.jsx(BQ,{onClose:N,anchorOrigin:{vertical:"bottom",horizontal:Me?"right":"left"},transformOrigin:Me?LQ:zQ,slots:{paper:dt,root:se.root},slotProps:{root:Mt,paper:yt},open:G,ref:i,transitionDuration:oe,TransitionProps:{onEntering:Ct,...ie},ownerState:Le,...ce,classes:X,children:Kt.jsx(UQ,{onKeyDown:ye,actions:je,autoFocus:d&&(et===-1||R),autoFocusItem:Qe,variant:pe,...a,className:ln(Je.list,a.className),children:y})})});function VQ(e){return Gn("MuiNativeSelect",e)}const sI=jn("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),$Q=e=>{const{classes:t,variant:i,disabled:l,multiple:d,open:y,error:S}=e,R={select:["select",i,l&&"disabled",d&&"multiple",S&&"error"],icon:["icon",`icon${nn(i)}`,y&&"iconOpen",l&&"disabled"]};return Jn(R,VQ,t)},w5=jr("select")(({theme:e})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${sI.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(e.vars||e).palette.background.paper},variants:[{props:({ownerState:t})=>t.variant!=="filled"&&t.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(e.vars||e).shape.borderRadius,"&:focus":{borderRadius:(e.vars||e).shape.borderRadius},"&&&":{paddingRight:32}}}]})),WQ=jr(w5,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Ks,overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.select,t[i.variant],i.error&&t.error,{[`&.${sI.multiple}`]:t.multiple}]}})({}),S5=jr("svg")(({theme:e})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(e.vars||e).palette.action.active,[`&.${sI.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:({ownerState:t})=>t.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),GQ=jr(S5,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.icon,i.variant&&t[`icon${nn(i.variant)}`],i.open&&t.iconOpen]}})({}),HQ=we.forwardRef(function(t,i){const{className:l,disabled:d,error:y,IconComponent:S,inputRef:R,variant:a="standard",...N}=t,G={...t,disabled:d,variant:a,error:y},q=$Q(G);return Kt.jsxs(we.Fragment,{children:[Kt.jsx(WQ,{ownerState:G,className:ln(q.select,l),disabled:d,ref:R||i,...N}),t.multiple?null:Kt.jsx(GQ,{as:S,ownerState:G,className:q.icon})]})});var bO;const qQ=jr("fieldset",{shouldForwardProp:Ks})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),ZQ=jr("legend",{shouldForwardProp:Ks})(Ri(({theme:e})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:t})=>!t.withLabel,style:{padding:0,lineHeight:"11px",transition:e.transitions.create("width",{duration:150,easing:e.transitions.easing.easeOut})}},{props:({ownerState:t})=>t.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:e.transitions.create("max-width",{duration:50,easing:e.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:t})=>t.withLabel&&t.notched,style:{maxWidth:"100%",transition:e.transitions.create("max-width",{duration:100,easing:e.transitions.easing.easeOut,delay:50})}}]})));function YQ(e){const{children:t,classes:i,className:l,label:d,notched:y,...S}=e,R=d!=null&&d!=="",a={...e,notched:y,withLabel:R};return Kt.jsx(qQ,{"aria-hidden":!0,className:l,ownerState:a,...S,children:Kt.jsx(ZQ,{ownerState:a,children:R?Kt.jsx("span",{children:d}):bO||(bO=Kt.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"}))})})}const XQ=e=>{const{classes:t}=e,l=Jn({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},sJ,t);return{...t,...l}},KQ=jr(Fb,{shouldForwardProp:e=>Ks(e)||e==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:Lb})(Ri(({theme:e})=>{const t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(e.vars||e).shape.borderRadius,[`&:hover .${xl.notchedOutline}`]:{borderColor:(e.vars||e).palette.text.primary},"@media (hover: none)":{[`&:hover .${xl.notchedOutline}`]:{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:t}},[`&.${xl.focused} .${xl.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(e.palette).filter(Pd()).map(([i])=>({props:{color:i},style:{[`&.${xl.focused} .${xl.notchedOutline}`]:{borderColor:(e.vars||e).palette[i].main}}})),{props:{},style:{[`&.${xl.error} .${xl.notchedOutline}`]:{borderColor:(e.vars||e).palette.error.main},[`&.${xl.disabled} .${xl.notchedOutline}`]:{borderColor:(e.vars||e).palette.action.disabled}}},{props:({ownerState:i})=>i.startAdornment,style:{paddingLeft:14}},{props:({ownerState:i})=>i.endAdornment,style:{paddingRight:14}},{props:({ownerState:i})=>i.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:i,size:l})=>i.multiline&&l==="small",style:{padding:"8.5px 14px"}}]}})),JQ=jr(YQ,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})(Ri(({theme:e})=>{const t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:t}})),QQ=jr(Bb,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:zb})(Ri(({theme:e})=>({padding:"16.5px 14px",...!e.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:e.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:e.palette.mode==="light"?null:"#fff",caretColor:e.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...e.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[e.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:t})=>t.multiline,style:{padding:0}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:0}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:0}}]}))),v1=we.forwardRef(function(t,i){var l;const d=Qn({props:t,name:"MuiOutlinedInput"}),{components:y={},fullWidth:S=!1,inputComponent:R="input",label:a,multiline:N=!1,notched:G,slots:q={},type:X="text",...oe}=d,te=XQ(d),ie=em(),pe=Qp({props:d,muiFormControl:ie,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),se={...d,color:pe.color||"primary",disabled:pe.disabled,error:pe.error,focused:pe.focused,formControl:ie,fullWidth:S,hiddenLabel:pe.hiddenLabel,multiline:N,size:pe.size,type:X},le=q.root??y.Root??KQ,ce=q.input??y.Input??QQ;return Kt.jsx(aI,{slots:{root:le,input:ce},renderSuffix:Me=>Kt.jsx(JQ,{ownerState:se,className:te.notchedOutline,label:a!=null&&a!==""&&pe.required?l||(l=Kt.jsxs(we.Fragment,{children:[a," ","*"]})):a,notched:typeof G<"u"?G:!!(Me.startAdornment||Me.filled||Me.focused)}),fullWidth:S,inputComponent:R,multiline:N,ref:i,type:X,...oe,classes:{...te,notchedOutline:null}})});v1&&(v1.muiName="Input");function eee(e){return Gn("MuiSelect",e)}const h_=jn("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var wO;const tee=jr(w5,{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[{[`&.${h_.select}`]:t.select},{[`&.${h_.select}`]:t[i.variant]},{[`&.${h_.error}`]:t.error},{[`&.${h_.multiple}`]:t.multiple}]}})({[`&.${h_.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),ree=jr(S5,{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.icon,i.variant&&t[`icon${nn(i.variant)}`],i.open&&t.iconOpen]}})({}),nee=jr("input",{shouldForwardProp:e=>f5(e)&&e!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function SO(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}function iee(e){return e==null||typeof e=="string"&&!e.trim()}const oee=e=>{const{classes:t,variant:i,disabled:l,multiple:d,open:y,error:S}=e,R={select:["select",i,l&&"disabled",d&&"multiple",S&&"error"],icon:["icon",`icon${nn(i)}`,y&&"iconOpen",l&&"disabled"],nativeInput:["nativeInput"]};return Jn(R,eee,t)},aee=we.forwardRef(function(t,i){var la;const{"aria-describedby":l,"aria-label":d,autoFocus:y,autoWidth:S,children:R,className:a,defaultOpen:N,defaultValue:G,disabled:q,displayEmpty:X,error:oe=!1,IconComponent:te,inputRef:ie,labelId:pe,MenuProps:se={},multiple:le,name:ce,onBlur:Me,onChange:Le,onClose:Je,onFocus:Qe,onOpen:je,open:Ct,readOnly:ye,renderValue:et,required:dt,SelectDisplayProps:Xt={},tabIndex:Mt,type:yt,value:gt,variant:Ze="standard",...ht}=t,[Dt,Tt]=Rk({controlled:gt,default:G,name:"Select"}),[tr,Vr]=Rk({controlled:Ct,default:N,name:"Select"}),Nr=we.useRef(null),ct=we.useRef(null),[$t,Ht]=we.useState(null),{current:Bt}=we.useRef(Ct!=null),[It,qt]=we.useState(),Wt=Wo(i,ie),be=we.useCallback(kr=>{ct.current=kr,kr&&Ht(kr)},[]),er=$t==null?void 0:$t.parentNode;we.useImperativeHandle(Wt,()=>({focus:()=>{ct.current.focus()},node:Nr.current,value:Dt}),[Dt]),we.useEffect(()=>{N&&tr&&$t&&!Bt&&(qt(S?null:er.clientWidth),ct.current.focus())},[$t,S]),we.useEffect(()=>{y&&ct.current.focus()},[y]),we.useEffect(()=>{if(!pe)return;const kr=Ys(ct.current).getElementById(pe);if(kr){const Mn=()=>{getSelection().isCollapsed&&ct.current.focus()};return kr.addEventListener("click",Mn),()=>{kr.removeEventListener("click",Mn)}}},[pe]);const cr=(kr,Mn)=>{kr?je&&je(Mn):Je&&Je(Mn),Bt||(qt(S?null:er.clientWidth),Vr(kr))},pr=kr=>{kr.button===0&&(kr.preventDefault(),ct.current.focus(),cr(!0,kr))},lt=kr=>{cr(!1,kr)},Lr=we.Children.toArray(R),br=kr=>{const Mn=Lr.find(On=>On.props.value===kr.target.value);Mn!==void 0&&(Tt(Mn.props.value),Le&&Le(kr,Mn))},Kr=kr=>Mn=>{let On;if(Mn.currentTarget.hasAttribute("tabindex")){if(le){On=Array.isArray(Dt)?Dt.slice():[];const ca=Dt.indexOf(kr.props.value);ca===-1?On.push(kr.props.value):On.splice(ca,1)}else On=kr.props.value;if(kr.props.onClick&&kr.props.onClick(Mn),Dt!==On&&(Tt(On),Le)){const ca=Mn.nativeEvent||Mn,Gr=new ca.constructor(ca.type,ca);Object.defineProperty(Gr,"target",{writable:!0,value:{value:On,name:ce}}),Le(Gr,kr)}le||cr(!1,Mn)}},sr=kr=>{ye||[" ","ArrowUp","ArrowDown","Enter"].includes(kr.key)&&(kr.preventDefault(),cr(!0,kr))},Hr=$t!==null&&tr,mn=kr=>{!Hr&&Me&&(Object.defineProperty(kr,"target",{writable:!0,value:{value:Dt,name:ce}}),Me(kr))};delete ht["aria-invalid"];let Er,Gi;const ai=[];let hr=!1;(g1({value:Dt})||X)&&(et?Er=et(Dt):hr=!0);const Po=Lr.map(kr=>{if(!we.isValidElement(kr))return null;let Mn;if(le){if(!Array.isArray(Dt))throw new Error(_c(2));Mn=Dt.some(On=>SO(On,kr.props.value)),Mn&&hr&&ai.push(kr.props.children)}else Mn=SO(Dt,kr.props.value),Mn&&hr&&(Gi=kr.props.children);return we.cloneElement(kr,{"aria-selected":Mn?"true":"false",onClick:Kr(kr),onKeyUp:On=>{On.key===" "&&On.preventDefault(),kr.props.onKeyUp&&kr.props.onKeyUp(On)},role:"option",selected:Mn,value:void 0,"data-value":kr.props.value})});hr&&(le?ai.length===0?Er=null:Er=ai.reduce((kr,Mn,On)=>(kr.push(Mn),On<ai.length-1&&kr.push(", "),kr),[]):Er=Gi);let ao=It;!S&&Bt&&$t&&(ao=er.clientWidth);let so;typeof Mt<"u"?so=Mt:so=q?null:0;const hi=Xt.id||(ce?`mui-component-select-${ce}`:void 0),wi={...t,variant:Ze,value:Dt,open:Hr,error:oe},kn=oee(wi),aa={...se.PaperProps,...(la=se.slotProps)==null?void 0:la.paper},sa=EB();return Kt.jsxs(we.Fragment,{children:[Kt.jsx(tee,{as:"div",ref:be,tabIndex:so,role:"combobox","aria-controls":sa,"aria-disabled":q?"true":void 0,"aria-expanded":Hr?"true":"false","aria-haspopup":"listbox","aria-label":d,"aria-labelledby":[pe,hi].filter(Boolean).join(" ")||void 0,"aria-describedby":l,"aria-required":dt?"true":void 0,"aria-invalid":oe?"true":void 0,onKeyDown:sr,onMouseDown:q||ye?null:pr,onBlur:mn,onFocus:Qe,...Xt,ownerState:wi,className:ln(Xt.className,kn.select,a),id:hi,children:iee(Er)?wO||(wO=Kt.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):Er}),Kt.jsx(nee,{"aria-invalid":oe,value:Array.isArray(Dt)?Dt.join(","):Dt,name:ce,ref:Nr,"aria-hidden":!0,onChange:br,tabIndex:-1,disabled:q,className:kn.nativeInput,autoFocus:y,required:dt,...ht,ownerState:wi}),Kt.jsx(ree,{as:te,className:kn.icon,ownerState:wi}),Kt.jsx(jQ,{id:`menu-${ce||""}`,anchorEl:er,open:Hr,onClose:lt,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...se,MenuListProps:{"aria-labelledby":pe,role:"listbox","aria-multiselectable":le?"true":void 0,disableListWrap:!0,id:sa,...se.MenuListProps},slotProps:{...se.slotProps,paper:{...aa,style:{minWidth:ao,...aa!=null?aa.style:null}}},children:Po})]})}),see=e=>{const{classes:t}=e;return t},lI={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>Ks(e)&&e!=="variant",slot:"Root"},lee=jr(y1,lI)(""),cee=jr(v1,lI)(""),uee=jr(_1,lI)(""),T5=we.forwardRef(function(t,i){const l=Qn({name:"MuiSelect",props:t}),{autoWidth:d=!1,children:y,classes:S={},className:R,defaultOpen:a=!1,displayEmpty:N=!1,IconComponent:G=cJ,id:q,input:X,inputProps:oe,label:te,labelId:ie,MenuProps:pe,multiple:se=!1,native:le=!1,onClose:ce,onOpen:Me,open:Le,renderValue:Je,SelectDisplayProps:Qe,variant:je="outlined",...Ct}=l,ye=le?HQ:aee,et=em(),dt=Qp({props:l,muiFormControl:et,states:["variant","error"]}),Xt=dt.variant||je,Mt={...l,variant:Xt,classes:S},yt=see(Mt),{root:gt,...Ze}=yt,ht=X||{standard:Kt.jsx(lee,{ownerState:Mt}),outlined:Kt.jsx(cee,{label:te,ownerState:Mt}),filled:Kt.jsx(uee,{ownerState:Mt})}[Xt],Dt=Wo(i,Ty(ht));return Kt.jsx(we.Fragment,{children:we.cloneElement(ht,{inputComponent:ye,inputProps:{children:y,error:dt.error,IconComponent:G,variant:Xt,type:void 0,multiple:se,...le?{id:q}:{autoWidth:d,defaultOpen:a,displayEmpty:N,labelId:ie,MenuProps:pe,onClose:ce,onOpen:Me,open:Le,renderValue:Je,SelectDisplayProps:{id:q,...Qe}},...oe,classes:oe?Vo(Ze,oe.classes):Ze,...X?X.props.inputProps:{}},...(se&&le||N)&&Xt==="outlined"?{notched:!0}:{},ref:Dt,className:ln(ht.props.className,R,yt.root),...!X&&{variant:Xt},...Ct})})});T5.muiName="Select";const E5=we.createContext();function hee(e){return Gn("MuiTable",e)}jn("MuiTable",["root","stickyHeader"]);const dee=e=>{const{classes:t,stickyHeader:i}=e;return Jn({root:["root",i&&"stickyHeader"]},hee,t)},fee=jr("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.stickyHeader&&t.stickyHeader]}})(Ri(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),TO="table",pee=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTable"}),{className:d,component:y=TO,padding:S="normal",size:R="medium",stickyHeader:a=!1,...N}=l,G={...l,component:y,padding:S,size:R,stickyHeader:a},q=dee(G),X=we.useMemo(()=>({padding:S,size:R,stickyHeader:a}),[S,R,a]);return Kt.jsx(E5.Provider,{value:X,children:Kt.jsx(fee,{as:y,role:y===TO?null:"table",ref:i,className:ln(q.root,d),ownerState:G,...N})})}),Nb=we.createContext();function mee(e){return Gn("MuiTableBody",e)}jn("MuiTableBody",["root"]);const gee=e=>{const{classes:t}=e;return Jn({root:["root"]},mee,t)},_ee=jr("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-row-group"}),yee={variant:"body"},EO="tbody",vee=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTableBody"}),{className:d,component:y=EO,...S}=l,R={...l,component:y},a=gee(R);return Kt.jsx(Nb.Provider,{value:yee,children:Kt.jsx(_ee,{className:ln(a.root,d),as:y,ref:i,role:y===EO?null:"rowgroup",ownerState:R,...S})})});function xee(e){return Gn("MuiTableCell",e)}const bee=jn("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),wee=e=>{const{classes:t,variant:i,align:l,padding:d,size:y,stickyHeader:S}=e,R={root:["root",i,S&&"stickyHeader",l!=="inherit"&&`align${nn(l)}`,d!=="normal"&&`padding${nn(d)}`,`size${nn(y)}`]};return Jn(R,xee,t)},See=jr("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],t[`size${nn(i.size)}`],i.padding!=="normal"&&t[`padding${nn(i.padding)}`],i.align!=="inherit"&&t[`align${nn(i.align)}`],i.stickyHeader&&t.stickyHeader]}})(Ri(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?kb(_s(e.palette.divider,1),.88):Rb(_s(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${bee.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),_a=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTableCell"}),{align:d="inherit",className:y,component:S,padding:R,scope:a,size:N,sortDirection:G,variant:q,...X}=l,oe=we.useContext(E5),te=we.useContext(Nb),ie=te&&te.variant==="head";let pe;S?pe=S:pe=ie?"th":"td";let se=a;pe==="td"?se=void 0:!se&&ie&&(se="col");const le=q||te&&te.variant,ce={...l,align:d,component:pe,padding:R||(oe&&oe.padding?oe.padding:"normal"),size:N||(oe&&oe.size?oe.size:"medium"),sortDirection:G,stickyHeader:le==="head"&&oe&&oe.stickyHeader,variant:le},Me=wee(ce);let Le=null;return G&&(Le=G==="asc"?"ascending":"descending"),Kt.jsx(See,{as:pe,ref:i,className:ln(Me.root,y),"aria-sort":Le,scope:se,ownerState:ce,...X})});function Tee(e){return Gn("MuiTableContainer",e)}jn("MuiTableContainer",["root"]);const Eee=e=>{const{classes:t}=e;return Jn({root:["root"]},Tee,t)},Mee=jr("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),Cee=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTableContainer"}),{className:d,component:y="div",...S}=l,R={...l,component:y},a=Eee(R);return Kt.jsx(Mee,{ref:i,as:y,className:ln(a.root,d),ownerState:R,...S})});function Iee(e){return Gn("MuiTableHead",e)}jn("MuiTableHead",["root"]);const Pee=e=>{const{classes:t}=e;return Jn({root:["root"]},Iee,t)},Aee=jr("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),Dee={variant:"head"},MO="thead",Ree=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTableHead"}),{className:d,component:y=MO,...S}=l,R={...l,component:y},a=Pee(R);return Kt.jsx(Nb.Provider,{value:Dee,children:Kt.jsx(Aee,{as:y,className:ln(a.root,d),ref:i,role:y===MO?null:"rowgroup",ownerState:R,...S})})});function kee(e){return Gn("MuiTableRow",e)}const CO=jn("MuiTableRow",["root","selected","hover","head","footer"]),Oee=e=>{const{classes:t,selected:i,hover:l,head:d,footer:y}=e;return Jn({root:["root",i&&"selected",l&&"hover",d&&"head",y&&"footer"]},kee,t)},Lee=jr("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.head&&t.head,i.footer&&t.footer]}})(Ri(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${CO.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${CO.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_s(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:_s(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}}))),IO="tr",PO=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTableRow"}),{className:d,component:y=IO,hover:S=!1,selected:R=!1,...a}=l,N=we.useContext(Nb),G={...l,component:y,hover:S,selected:R,head:N&&N.variant==="head",footer:N&&N.variant==="footer"},q=Oee(G);return Kt.jsx(Lee,{as:y,ref:i,className:ln(q.root,d),role:y===IO?null:"row",ownerState:G,...a})});function zee(e){return Gn("MuiTextField",e)}jn("MuiTextField",["root"]);const Fee={standard:y1,filled:_1,outlined:v1},Bee=e=>{const{classes:t}=e;return Jn({root:["root"]},zee,t)},Nee=jr(aQ,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),M5=we.forwardRef(function(t,i){const l=Qn({props:t,name:"MuiTextField"}),{autoComplete:d,autoFocus:y=!1,children:S,className:R,color:a="primary",defaultValue:N,disabled:G=!1,error:q=!1,FormHelperTextProps:X,fullWidth:oe=!1,helperText:te,id:ie,InputLabelProps:pe,inputProps:se,InputProps:le,inputRef:ce,label:Me,maxRows:Le,minRows:Je,multiline:Qe=!1,name:je,onBlur:Ct,onChange:ye,onFocus:et,placeholder:dt,required:Xt=!1,rows:Mt,select:yt=!1,SelectProps:gt,slots:Ze={},slotProps:ht={},type:Dt,value:Tt,variant:tr="outlined",...Vr}=l,Nr={...l,autoFocus:y,color:a,disabled:G,error:q,fullWidth:oe,multiline:Qe,required:Xt,select:yt,variant:tr},ct=Bee(Nr),$t=EB(ie),Ht=te&&$t?`${$t}-helper-text`:void 0,Bt=Me&&$t?`${$t}-label`:void 0,It=Fee[tr],qt={slots:Ze,slotProps:{input:le,inputLabel:pe,htmlInput:se,formHelperText:X,select:gt,...ht}},Wt={},be=qt.slotProps.inputLabel;tr==="outlined"&&(be&&typeof be.shrink<"u"&&(Wt.notched=be.shrink),Wt.label=Me),yt&&((!gt||!gt.native)&&(Wt.id=void 0),Wt["aria-describedby"]=void 0);const[er,cr]=$s("input",{elementType:It,externalForwardedProps:qt,additionalProps:Wt,ownerState:Nr}),[pr,lt]=$s("inputLabel",{elementType:SQ,externalForwardedProps:qt,ownerState:Nr}),[Lr,br]=$s("htmlInput",{elementType:"input",externalForwardedProps:qt,ownerState:Nr}),[Kr,sr]=$s("formHelperText",{elementType:uQ,externalForwardedProps:qt,ownerState:Nr}),[Hr,mn]=$s("select",{elementType:T5,externalForwardedProps:qt,ownerState:Nr}),Er=Kt.jsx(er,{"aria-describedby":Ht,autoComplete:d,autoFocus:y,defaultValue:N,fullWidth:oe,multiline:Qe,name:je,rows:Mt,maxRows:Le,minRows:Je,type:Dt,value:Tt,id:$t,inputRef:ce,onBlur:Ct,onChange:ye,onFocus:et,placeholder:dt,inputProps:br,slots:{input:Ze.htmlInput?Lr:void 0},...cr});return Kt.jsxs(Nee,{className:ln(ct.root,R),disabled:G,error:q,fullWidth:oe,ref:i,required:Xt,color:a,variant:tr,ownerState:Nr,...Vr,children:[Me!=null&&Me!==""&&Kt.jsx(pr,{htmlFor:$t,id:Bt,...lt,children:Me}),yt?Kt.jsx(Hr,{"aria-describedby":Ht,id:$t,labelId:Bt,value:Tt,input:Er,...mn,children:S}):Er,te&&Kt.jsx(Kr,{id:Ht,...sr,children:te})]})}),Uee=async e=>(await Rn.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${e}.json`,{params:{access_token:"pk.eyJ1IjoiYWJkdWxsYWgyMi0yMiIsImEiOiJjbTJvaHZ5dnYwNzB4MmxzaWFvcGJxbGVsIn0.jxfAbPp1oJn1sChxn32nQA"}})).data.features[0],jee=async e=>(await Rn.get("http://localhost:5000/api/hotels/map",{params:{query:e}})).data;var C5={exports:{}};(function(e,t){var i={};(function(l,d){e.exports=d()})(BO,function(){var l,d,y;function S(a,N){if(!l)l=N;else if(!d)d=N;else{var G="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",q={};l(q),y=N(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}S(["exports"],function(a){function N(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var G,q={},X={};function oe(){if(G)return X;G=1,Object.defineProperty(X,"__esModule",{value:!0}),X.setMatrixArrayType=function(m){X.ARRAY_TYPE=r=m},X.toRadian=function(m){return m*u},X.equals=function(m,h){return Math.abs(m-h)<=c*Math.max(1,Math.abs(m),Math.abs(h))},X.RANDOM=X.ARRAY_TYPE=X.EPSILON=void 0;var c=1e-6;X.EPSILON=c;var r=typeof Float32Array<"u"?Float32Array:Array;X.ARRAY_TYPE=r;var o=Math.random;X.RANDOM=o;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,h=arguments.length;h--;)m+=arguments[h]*arguments[h];return Math.sqrt(m)}),X}var te,ie={};function pe(){if(te)return ie;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}te=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.create=function(){var h=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},ie.clone=function(h){var g=new r.ARRAY_TYPE(4);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g},ie.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h},ie.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},ie.fromValues=function(h,g,b,M){var P=new r.ARRAY_TYPE(4);return P[0]=h,P[1]=g,P[2]=b,P[3]=M,P},ie.set=function(h,g,b,M,P){return h[0]=g,h[1]=b,h[2]=M,h[3]=P,h},ie.transpose=function(h,g){if(h===g){var b=g[1];h[1]=g[2],h[2]=b}else h[0]=g[0],h[1]=g[2],h[2]=g[1],h[3]=g[3];return h},ie.invert=function(h,g){var b=g[0],M=g[1],P=g[2],v=g[3],T=b*v-P*M;return T?(h[0]=v*(T=1/T),h[1]=-M*T,h[2]=-P*T,h[3]=b*T,h):null},ie.adjoint=function(h,g){var b=g[0];return h[0]=g[3],h[1]=-g[1],h[2]=-g[2],h[3]=b,h},ie.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},ie.multiply=u,ie.rotate=function(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=Math.sin(b),E=Math.cos(b);return h[0]=M*E+v*I,h[1]=P*E+T*I,h[2]=M*-I+v*E,h[3]=P*-I+T*E,h},ie.scale=function(h,g,b){var M=g[1],P=g[2],v=g[3],T=b[0],I=b[1];return h[0]=g[0]*T,h[1]=M*T,h[2]=P*I,h[3]=v*I,h},ie.fromRotation=function(h,g){var b=Math.sin(g),M=Math.cos(g);return h[0]=M,h[1]=b,h[2]=-b,h[3]=M,h},ie.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h},ie.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},ie.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},ie.LDU=function(h,g,b,M){return h[2]=M[2]/M[0],b[0]=M[0],b[1]=M[1],b[3]=M[3]-h[2]*b[1],[h,g,b]},ie.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h},ie.subtract=m,ie.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]},ie.equals=function(h,g){var b=h[0],M=h[1],P=h[2],v=h[3],T=g[0],I=g[1],E=g[2],C=g[3];return Math.abs(b-T)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(T))&&Math.abs(M-I)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(I))&&Math.abs(P-E)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(E))&&Math.abs(v-C)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(C))},ie.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h},ie.multiplyScalarAndAdd=function(h,g,b,M){return h[0]=g[0]+b[0]*M,h[1]=g[1]+b[1]*M,h[2]=g[2]+b[2]*M,h[3]=g[3]+b[3]*M,h},ie.sub=ie.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=o(void 0);if(b&&b.has(h))return b.get(h);var M={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var T=P?Object.getOwnPropertyDescriptor(h,v):null;T&&(T.get||T.set)?Object.defineProperty(M,v,T):M[v]=h[v]}return M.default=h,b&&b.set(h,M),M}(oe());function o(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(o=function(M){return M?b:g})(h)}function u(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=b[0],E=b[1],C=b[2],D=b[3];return h[0]=M*I+v*E,h[1]=P*I+T*E,h[2]=M*C+v*D,h[3]=P*C+T*D,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h}return ie.mul=u,ie.sub=m,ie}var se,le={};function ce(){if(se)return le;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}se=1,Object.defineProperty(le,"__esModule",{value:!0}),le.create=function(){var h=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},le.clone=function(h){var g=new r.ARRAY_TYPE(6);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g},le.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h},le.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},le.fromValues=function(h,g,b,M,P,v){var T=new r.ARRAY_TYPE(6);return T[0]=h,T[1]=g,T[2]=b,T[3]=M,T[4]=P,T[5]=v,T},le.set=function(h,g,b,M,P,v,T){return h[0]=g,h[1]=b,h[2]=M,h[3]=P,h[4]=v,h[5]=T,h},le.invert=function(h,g){var b=g[0],M=g[1],P=g[2],v=g[3],T=g[4],I=g[5],E=b*v-M*P;return E?(h[0]=v*(E=1/E),h[1]=-M*E,h[2]=-P*E,h[3]=b*E,h[4]=(P*I-v*T)*E,h[5]=(M*T-b*I)*E,h):null},le.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},le.multiply=u,le.rotate=function(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=g[4],E=g[5],C=Math.sin(b),D=Math.cos(b);return h[0]=M*D+v*C,h[1]=P*D+T*C,h[2]=M*-C+v*D,h[3]=P*-C+T*D,h[4]=I,h[5]=E,h},le.scale=function(h,g,b){var M=g[1],P=g[2],v=g[3],T=g[4],I=g[5],E=b[0],C=b[1];return h[0]=g[0]*E,h[1]=M*E,h[2]=P*C,h[3]=v*C,h[4]=T,h[5]=I,h},le.translate=function(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=g[4],E=g[5],C=b[0],D=b[1];return h[0]=M,h[1]=P,h[2]=v,h[3]=T,h[4]=M*C+v*D+I,h[5]=P*C+T*D+E,h},le.fromRotation=function(h,g){var b=Math.sin(g),M=Math.cos(g);return h[0]=M,h[1]=b,h[2]=-b,h[3]=M,h[4]=0,h[5]=0,h},le.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h[4]=0,h[5]=0,h},le.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=g[0],h[5]=g[1],h},le.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},le.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},le.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h[4]=g[4]+b[4],h[5]=g[5]+b[5],h},le.subtract=m,le.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h[4]=g[4]*b,h[5]=g[5]*b,h},le.multiplyScalarAndAdd=function(h,g,b,M){return h[0]=g[0]+b[0]*M,h[1]=g[1]+b[1]*M,h[2]=g[2]+b[2]*M,h[3]=g[3]+b[3]*M,h[4]=g[4]+b[4]*M,h[5]=g[5]+b[5]*M,h},le.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]},le.equals=function(h,g){var b=h[0],M=h[1],P=h[2],v=h[3],T=h[4],I=h[5],E=g[0],C=g[1],D=g[2],O=g[3],F=g[4],V=g[5];return Math.abs(b-E)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(M-C)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(C))&&Math.abs(P-D)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(D))&&Math.abs(v-O)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(T-F)<=r.EPSILON*Math.max(1,Math.abs(T),Math.abs(F))&&Math.abs(I-V)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(V))},le.sub=le.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=o(void 0);if(b&&b.has(h))return b.get(h);var M={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var T=P?Object.getOwnPropertyDescriptor(h,v):null;T&&(T.get||T.set)?Object.defineProperty(M,v,T):M[v]=h[v]}return M.default=h,b&&b.set(h,M),M}(oe());function o(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(o=function(M){return M?b:g})(h)}function u(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=g[4],E=g[5],C=b[0],D=b[1],O=b[2],F=b[3],V=b[4],W=b[5];return h[0]=M*C+v*D,h[1]=P*C+T*D,h[2]=M*O+v*F,h[3]=P*O+T*F,h[4]=M*V+v*W+I,h[5]=P*V+T*W+E,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h[4]=g[4]-b[4],h[5]=g[5]-b[5],h}return le.mul=u,le.sub=m,le}var Me,Le={};function Je(){if(Me)return Le;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}Me=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.create=function(){var h=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},Le.fromMat4=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[4],h[4]=g[5],h[5]=g[6],h[6]=g[8],h[7]=g[9],h[8]=g[10],h},Le.clone=function(h){var g=new r.ARRAY_TYPE(9);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=h[7],g[8]=h[8],g},Le.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},Le.fromValues=function(h,g,b,M,P,v,T,I,E){var C=new r.ARRAY_TYPE(9);return C[0]=h,C[1]=g,C[2]=b,C[3]=M,C[4]=P,C[5]=v,C[6]=T,C[7]=I,C[8]=E,C},Le.set=function(h,g,b,M,P,v,T,I,E,C){return h[0]=g,h[1]=b,h[2]=M,h[3]=P,h[4]=v,h[5]=T,h[6]=I,h[7]=E,h[8]=C,h},Le.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Le.transpose=function(h,g){if(h===g){var b=g[1],M=g[2],P=g[5];h[1]=g[3],h[2]=g[6],h[3]=b,h[5]=g[7],h[6]=M,h[7]=P}else h[0]=g[0],h[1]=g[3],h[2]=g[6],h[3]=g[1],h[4]=g[4],h[5]=g[7],h[6]=g[2],h[7]=g[5],h[8]=g[8];return h},Le.invert=function(h,g){var b=g[0],M=g[1],P=g[2],v=g[3],T=g[4],I=g[5],E=g[6],C=g[7],D=g[8],O=D*T-I*C,F=-D*v+I*E,V=C*v-T*E,W=b*O+M*F+P*V;return W?(h[0]=O*(W=1/W),h[1]=(-D*M+P*C)*W,h[2]=(I*M-P*T)*W,h[3]=F*W,h[4]=(D*b-P*E)*W,h[5]=(-I*b+P*v)*W,h[6]=V*W,h[7]=(-C*b+M*E)*W,h[8]=(T*b-M*v)*W,h):null},Le.adjoint=function(h,g){var b=g[0],M=g[1],P=g[2],v=g[3],T=g[4],I=g[5],E=g[6],C=g[7],D=g[8];return h[0]=T*D-I*C,h[1]=P*C-M*D,h[2]=M*I-P*T,h[3]=I*E-v*D,h[4]=b*D-P*E,h[5]=P*v-b*I,h[6]=v*C-T*E,h[7]=M*E-b*C,h[8]=b*T-M*v,h},Le.determinant=function(h){var g=h[3],b=h[4],M=h[5],P=h[6],v=h[7],T=h[8];return h[0]*(T*b-M*v)+h[1]*(-T*g+M*P)+h[2]*(v*g-b*P)},Le.multiply=u,Le.translate=function(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=g[4],E=g[5],C=g[6],D=g[7],O=g[8],F=b[0],V=b[1];return h[0]=M,h[1]=P,h[2]=v,h[3]=T,h[4]=I,h[5]=E,h[6]=F*M+V*T+C,h[7]=F*P+V*I+D,h[8]=F*v+V*E+O,h},Le.rotate=function(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=g[4],E=g[5],C=g[6],D=g[7],O=g[8],F=Math.sin(b),V=Math.cos(b);return h[0]=V*M+F*T,h[1]=V*P+F*I,h[2]=V*v+F*E,h[3]=V*T-F*M,h[4]=V*I-F*P,h[5]=V*E-F*v,h[6]=C,h[7]=D,h[8]=O,h},Le.scale=function(h,g,b){var M=b[0],P=b[1];return h[0]=M*g[0],h[1]=M*g[1],h[2]=M*g[2],h[3]=P*g[3],h[4]=P*g[4],h[5]=P*g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},Le.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=g[0],h[7]=g[1],h[8]=1,h},Le.fromRotation=function(h,g){var b=Math.sin(g),M=Math.cos(g);return h[0]=M,h[1]=b,h[2]=0,h[3]=-b,h[4]=M,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Le.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=0,h[4]=g[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Le.fromMat2d=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=0,h[3]=g[2],h[4]=g[3],h[5]=0,h[6]=g[4],h[7]=g[5],h[8]=1,h},Le.fromQuat=function(h,g){var b=g[0],M=g[1],P=g[2],v=g[3],T=b+b,I=M+M,E=P+P,C=b*T,D=M*T,O=M*I,F=P*T,V=P*I,W=P*E,B=v*T,H=v*I,Z=v*E;return h[0]=1-O-W,h[3]=D-Z,h[6]=F+H,h[1]=D+Z,h[4]=1-C-W,h[7]=V-B,h[2]=F-H,h[5]=V+B,h[8]=1-C-O,h},Le.normalFromMat4=function(h,g){var b=g[0],M=g[1],P=g[2],v=g[3],T=g[4],I=g[5],E=g[6],C=g[7],D=g[8],O=g[9],F=g[10],V=g[11],W=g[12],B=g[13],H=g[14],Z=g[15],re=b*I-M*T,de=b*E-P*T,me=b*C-v*T,ue=M*E-P*I,Te=M*C-v*I,_e=P*C-v*E,Ce=D*B-O*W,Oe=D*H-F*W,Fe=D*Z-V*W,Be=O*H-F*B,Ne=O*Z-V*B,qe=F*Z-V*H,Ve=re*qe-de*Ne+me*Be+ue*Fe-Te*Oe+_e*Ce;return Ve?(h[0]=(I*qe-E*Ne+C*Be)*(Ve=1/Ve),h[1]=(E*Fe-T*qe-C*Oe)*Ve,h[2]=(T*Ne-I*Fe+C*Ce)*Ve,h[3]=(P*Ne-M*qe-v*Be)*Ve,h[4]=(b*qe-P*Fe+v*Oe)*Ve,h[5]=(M*Fe-b*Ne-v*Ce)*Ve,h[6]=(B*_e-H*Te+Z*ue)*Ve,h[7]=(H*me-W*_e-Z*de)*Ve,h[8]=(W*Te-B*me+Z*re)*Ve,h):null},Le.projection=function(h,g,b){return h[0]=2/g,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/b,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},Le.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},Le.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},Le.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h[4]=g[4]+b[4],h[5]=g[5]+b[5],h[6]=g[6]+b[6],h[7]=g[7]+b[7],h[8]=g[8]+b[8],h},Le.subtract=m,Le.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h[4]=g[4]*b,h[5]=g[5]*b,h[6]=g[6]*b,h[7]=g[7]*b,h[8]=g[8]*b,h},Le.multiplyScalarAndAdd=function(h,g,b,M){return h[0]=g[0]+b[0]*M,h[1]=g[1]+b[1]*M,h[2]=g[2]+b[2]*M,h[3]=g[3]+b[3]*M,h[4]=g[4]+b[4]*M,h[5]=g[5]+b[5]*M,h[6]=g[6]+b[6]*M,h[7]=g[7]+b[7]*M,h[8]=g[8]+b[8]*M,h},Le.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]&&h[6]===g[6]&&h[7]===g[7]&&h[8]===g[8]},Le.equals=function(h,g){var b=h[0],M=h[1],P=h[2],v=h[3],T=h[4],I=h[5],E=h[6],C=h[7],D=h[8],O=g[0],F=g[1],V=g[2],W=g[3],B=g[4],H=g[5],Z=g[6],re=g[7],de=g[8];return Math.abs(b-O)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(O))&&Math.abs(M-F)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(P-V)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(V))&&Math.abs(v-W)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(W))&&Math.abs(T-B)<=r.EPSILON*Math.max(1,Math.abs(T),Math.abs(B))&&Math.abs(I-H)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(E-Z)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(C-re)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(re))&&Math.abs(D-de)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(de))},Le.sub=Le.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=o(void 0);if(b&&b.has(h))return b.get(h);var M={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var T=P?Object.getOwnPropertyDescriptor(h,v):null;T&&(T.get||T.set)?Object.defineProperty(M,v,T):M[v]=h[v]}return M.default=h,b&&b.set(h,M),M}(oe());function o(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(o=function(M){return M?b:g})(h)}function u(h,g,b){var M=g[0],P=g[1],v=g[2],T=g[3],I=g[4],E=g[5],C=g[6],D=g[7],O=g[8],F=b[0],V=b[1],W=b[2],B=b[3],H=b[4],Z=b[5],re=b[6],de=b[7],me=b[8];return h[0]=F*M+V*T+W*C,h[1]=F*P+V*I+W*D,h[2]=F*v+V*E+W*O,h[3]=B*M+H*T+Z*C,h[4]=B*P+H*I+Z*D,h[5]=B*v+H*E+Z*O,h[6]=re*M+de*T+me*C,h[7]=re*P+de*I+me*D,h[8]=re*v+de*E+me*O,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h[4]=g[4]-b[4],h[5]=g[5]-b[5],h[6]=g[6]-b[6],h[7]=g[7]-b[7],h[8]=g[8]-b[8],h}return Le.mul=u,Le.sub=m,Le}var Qe,je={};function Ct(){if(Qe)return je;function c(v){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},c(v)}Qe=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var v=new r.ARRAY_TYPE(16);return r.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},je.clone=function(v){var T=new r.ARRAY_TYPE(16);return T[0]=v[0],T[1]=v[1],T[2]=v[2],T[3]=v[3],T[4]=v[4],T[5]=v[5],T[6]=v[6],T[7]=v[7],T[8]=v[8],T[9]=v[9],T[10]=v[10],T[11]=v[11],T[12]=v[12],T[13]=v[13],T[14]=v[14],T[15]=v[15],T},je.copy=function(v,T){return v[0]=T[0],v[1]=T[1],v[2]=T[2],v[3]=T[3],v[4]=T[4],v[5]=T[5],v[6]=T[6],v[7]=T[7],v[8]=T[8],v[9]=T[9],v[10]=T[10],v[11]=T[11],v[12]=T[12],v[13]=T[13],v[14]=T[14],v[15]=T[15],v},je.fromValues=function(v,T,I,E,C,D,O,F,V,W,B,H,Z,re,de,me){var ue=new r.ARRAY_TYPE(16);return ue[0]=v,ue[1]=T,ue[2]=I,ue[3]=E,ue[4]=C,ue[5]=D,ue[6]=O,ue[7]=F,ue[8]=V,ue[9]=W,ue[10]=B,ue[11]=H,ue[12]=Z,ue[13]=re,ue[14]=de,ue[15]=me,ue},je.set=function(v,T,I,E,C,D,O,F,V,W,B,H,Z,re,de,me,ue){return v[0]=T,v[1]=I,v[2]=E,v[3]=C,v[4]=D,v[5]=O,v[6]=F,v[7]=V,v[8]=W,v[9]=B,v[10]=H,v[11]=Z,v[12]=re,v[13]=de,v[14]=me,v[15]=ue,v},je.identity=u,je.transpose=function(v,T){if(v===T){var I=T[1],E=T[2],C=T[3],D=T[6],O=T[7],F=T[11];v[1]=T[4],v[2]=T[8],v[3]=T[12],v[4]=I,v[6]=T[9],v[7]=T[13],v[8]=E,v[9]=D,v[11]=T[14],v[12]=C,v[13]=O,v[14]=F}else v[0]=T[0],v[1]=T[4],v[2]=T[8],v[3]=T[12],v[4]=T[1],v[5]=T[5],v[6]=T[9],v[7]=T[13],v[8]=T[2],v[9]=T[6],v[10]=T[10],v[11]=T[14],v[12]=T[3],v[13]=T[7],v[14]=T[11],v[15]=T[15];return v},je.invert=function(v,T){var I=T[0],E=T[1],C=T[2],D=T[3],O=T[4],F=T[5],V=T[6],W=T[7],B=T[8],H=T[9],Z=T[10],re=T[11],de=T[12],me=T[13],ue=T[14],Te=T[15],_e=I*F-E*O,Ce=I*V-C*O,Oe=I*W-D*O,Fe=E*V-C*F,Be=E*W-D*F,Ne=C*W-D*V,qe=B*me-H*de,Ve=B*ue-Z*de,ot=B*Te-re*de,mt=H*ue-Z*me,tt=H*Te-re*me,Nt=Z*Te-re*ue,Ot=_e*Nt-Ce*tt+Oe*mt+Fe*ot-Be*Ve+Ne*qe;return Ot?(v[0]=(F*Nt-V*tt+W*mt)*(Ot=1/Ot),v[1]=(C*tt-E*Nt-D*mt)*Ot,v[2]=(me*Ne-ue*Be+Te*Fe)*Ot,v[3]=(Z*Be-H*Ne-re*Fe)*Ot,v[4]=(V*ot-O*Nt-W*Ve)*Ot,v[5]=(I*Nt-C*ot+D*Ve)*Ot,v[6]=(ue*Oe-de*Ne-Te*Ce)*Ot,v[7]=(B*Ne-Z*Oe+re*Ce)*Ot,v[8]=(O*tt-F*ot+W*qe)*Ot,v[9]=(E*ot-I*tt-D*qe)*Ot,v[10]=(de*Be-me*Oe+Te*_e)*Ot,v[11]=(H*Oe-B*Be-re*_e)*Ot,v[12]=(F*Ve-O*mt-V*qe)*Ot,v[13]=(I*mt-E*Ve+C*qe)*Ot,v[14]=(me*Ce-de*Fe-ue*_e)*Ot,v[15]=(B*Fe-H*Ce+Z*_e)*Ot,v):null},je.adjoint=function(v,T){var I=T[0],E=T[1],C=T[2],D=T[3],O=T[4],F=T[5],V=T[6],W=T[7],B=T[8],H=T[9],Z=T[10],re=T[11],de=T[12],me=T[13],ue=T[14],Te=T[15];return v[0]=F*(Z*Te-re*ue)-H*(V*Te-W*ue)+me*(V*re-W*Z),v[1]=-(E*(Z*Te-re*ue)-H*(C*Te-D*ue)+me*(C*re-D*Z)),v[2]=E*(V*Te-W*ue)-F*(C*Te-D*ue)+me*(C*W-D*V),v[3]=-(E*(V*re-W*Z)-F*(C*re-D*Z)+H*(C*W-D*V)),v[4]=-(O*(Z*Te-re*ue)-B*(V*Te-W*ue)+de*(V*re-W*Z)),v[5]=I*(Z*Te-re*ue)-B*(C*Te-D*ue)+de*(C*re-D*Z),v[6]=-(I*(V*Te-W*ue)-O*(C*Te-D*ue)+de*(C*W-D*V)),v[7]=I*(V*re-W*Z)-O*(C*re-D*Z)+B*(C*W-D*V),v[8]=O*(H*Te-re*me)-B*(F*Te-W*me)+de*(F*re-W*H),v[9]=-(I*(H*Te-re*me)-B*(E*Te-D*me)+de*(E*re-D*H)),v[10]=I*(F*Te-W*me)-O*(E*Te-D*me)+de*(E*W-D*F),v[11]=-(I*(F*re-W*H)-O*(E*re-D*H)+B*(E*W-D*F)),v[12]=-(O*(H*ue-Z*me)-B*(F*ue-V*me)+de*(F*Z-V*H)),v[13]=I*(H*ue-Z*me)-B*(E*ue-C*me)+de*(E*Z-C*H),v[14]=-(I*(F*ue-V*me)-O*(E*ue-C*me)+de*(E*V-C*F)),v[15]=I*(F*Z-V*H)-O*(E*Z-C*H)+B*(E*V-C*F),v},je.determinant=function(v){var T=v[0],I=v[1],E=v[2],C=v[3],D=v[4],O=v[5],F=v[6],V=v[7],W=v[8],B=v[9],H=v[10],Z=v[11],re=v[12],de=v[13],me=v[14],ue=v[15];return(T*O-I*D)*(H*ue-Z*me)-(T*F-E*D)*(B*ue-Z*de)+(T*V-C*D)*(B*me-H*de)+(I*F-E*O)*(W*ue-Z*re)-(I*V-C*O)*(W*me-H*re)+(E*V-C*F)*(W*de-B*re)},je.multiply=m,je.translate=function(v,T,I){var E,C,D,O,F,V,W,B,H,Z,re,de,me=I[0],ue=I[1],Te=I[2];return T===v?(v[12]=T[0]*me+T[4]*ue+T[8]*Te+T[12],v[13]=T[1]*me+T[5]*ue+T[9]*Te+T[13],v[14]=T[2]*me+T[6]*ue+T[10]*Te+T[14],v[15]=T[3]*me+T[7]*ue+T[11]*Te+T[15]):(C=T[1],D=T[2],O=T[3],F=T[4],V=T[5],W=T[6],B=T[7],H=T[8],Z=T[9],re=T[10],de=T[11],v[0]=E=T[0],v[1]=C,v[2]=D,v[3]=O,v[4]=F,v[5]=V,v[6]=W,v[7]=B,v[8]=H,v[9]=Z,v[10]=re,v[11]=de,v[12]=E*me+F*ue+H*Te+T[12],v[13]=C*me+V*ue+Z*Te+T[13],v[14]=D*me+W*ue+re*Te+T[14],v[15]=O*me+B*ue+de*Te+T[15]),v},je.scale=function(v,T,I){var E=I[0],C=I[1],D=I[2];return v[0]=T[0]*E,v[1]=T[1]*E,v[2]=T[2]*E,v[3]=T[3]*E,v[4]=T[4]*C,v[5]=T[5]*C,v[6]=T[6]*C,v[7]=T[7]*C,v[8]=T[8]*D,v[9]=T[9]*D,v[10]=T[10]*D,v[11]=T[11]*D,v[12]=T[12],v[13]=T[13],v[14]=T[14],v[15]=T[15],v},je.rotate=function(v,T,I,E){var C,D,O,F,V,W,B,H,Z,re,de,me,ue,Te,_e,Ce,Oe,Fe,Be,Ne,qe,Ve,ot,mt,tt=E[0],Nt=E[1],Ot=E[2],St=Math.hypot(tt,Nt,Ot);return St<r.EPSILON?null:(tt*=St=1/St,Nt*=St,Ot*=St,C=Math.sin(I),D=Math.cos(I),V=T[1],W=T[2],B=T[3],Z=T[5],re=T[6],de=T[7],ue=T[9],Te=T[10],_e=T[11],Ce=tt*tt*(O=1-D)+D,Be=tt*Nt*O-Ot*C,Ne=Nt*Nt*O+D,qe=Ot*Nt*O+tt*C,Ve=tt*Ot*O+Nt*C,ot=Nt*Ot*O-tt*C,mt=Ot*Ot*O+D,v[0]=(F=T[0])*Ce+(H=T[4])*(Oe=Nt*tt*O+Ot*C)+(me=T[8])*(Fe=Ot*tt*O-Nt*C),v[1]=V*Ce+Z*Oe+ue*Fe,v[2]=W*Ce+re*Oe+Te*Fe,v[3]=B*Ce+de*Oe+_e*Fe,v[4]=F*Be+H*Ne+me*qe,v[5]=V*Be+Z*Ne+ue*qe,v[6]=W*Be+re*Ne+Te*qe,v[7]=B*Be+de*Ne+_e*qe,v[8]=F*Ve+H*ot+me*mt,v[9]=V*Ve+Z*ot+ue*mt,v[10]=W*Ve+re*ot+Te*mt,v[11]=B*Ve+de*ot+_e*mt,T!==v&&(v[12]=T[12],v[13]=T[13],v[14]=T[14],v[15]=T[15]),v)},je.rotateX=function(v,T,I){var E=Math.sin(I),C=Math.cos(I),D=T[4],O=T[5],F=T[6],V=T[7],W=T[8],B=T[9],H=T[10],Z=T[11];return T!==v&&(v[0]=T[0],v[1]=T[1],v[2]=T[2],v[3]=T[3],v[12]=T[12],v[13]=T[13],v[14]=T[14],v[15]=T[15]),v[4]=D*C+W*E,v[5]=O*C+B*E,v[6]=F*C+H*E,v[7]=V*C+Z*E,v[8]=W*C-D*E,v[9]=B*C-O*E,v[10]=H*C-F*E,v[11]=Z*C-V*E,v},je.rotateY=function(v,T,I){var E=Math.sin(I),C=Math.cos(I),D=T[0],O=T[1],F=T[2],V=T[3],W=T[8],B=T[9],H=T[10],Z=T[11];return T!==v&&(v[4]=T[4],v[5]=T[5],v[6]=T[6],v[7]=T[7],v[12]=T[12],v[13]=T[13],v[14]=T[14],v[15]=T[15]),v[0]=D*C-W*E,v[1]=O*C-B*E,v[2]=F*C-H*E,v[3]=V*C-Z*E,v[8]=D*E+W*C,v[9]=O*E+B*C,v[10]=F*E+H*C,v[11]=V*E+Z*C,v},je.rotateZ=function(v,T,I){var E=Math.sin(I),C=Math.cos(I),D=T[0],O=T[1],F=T[2],V=T[3],W=T[4],B=T[5],H=T[6],Z=T[7];return T!==v&&(v[8]=T[8],v[9]=T[9],v[10]=T[10],v[11]=T[11],v[12]=T[12],v[13]=T[13],v[14]=T[14],v[15]=T[15]),v[0]=D*C+W*E,v[1]=O*C+B*E,v[2]=F*C+H*E,v[3]=V*C+Z*E,v[4]=W*C-D*E,v[5]=B*C-O*E,v[6]=H*C-F*E,v[7]=Z*C-V*E,v},je.fromTranslation=function(v,T){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=T[0],v[13]=T[1],v[14]=T[2],v[15]=1,v},je.fromScaling=function(v,T){return v[0]=T[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=T[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=T[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},je.fromRotation=function(v,T,I){var E,C,D,O=I[0],F=I[1],V=I[2],W=Math.hypot(O,F,V);return W<r.EPSILON?null:(O*=W=1/W,F*=W,V*=W,E=Math.sin(T),C=Math.cos(T),v[0]=O*O*(D=1-C)+C,v[1]=F*O*D+V*E,v[2]=V*O*D-F*E,v[3]=0,v[4]=O*F*D-V*E,v[5]=F*F*D+C,v[6]=V*F*D+O*E,v[7]=0,v[8]=O*V*D+F*E,v[9]=F*V*D-O*E,v[10]=V*V*D+C,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v)},je.fromXRotation=function(v,T){var I=Math.sin(T),E=Math.cos(T);return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=E,v[6]=I,v[7]=0,v[8]=0,v[9]=-I,v[10]=E,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},je.fromYRotation=function(v,T){var I=Math.sin(T),E=Math.cos(T);return v[0]=E,v[1]=0,v[2]=-I,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=I,v[9]=0,v[10]=E,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},je.fromZRotation=function(v,T){var I=Math.sin(T),E=Math.cos(T);return v[0]=E,v[1]=I,v[2]=0,v[3]=0,v[4]=-I,v[5]=E,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},je.fromRotationTranslation=h,je.fromQuat2=function(v,T){var I=new r.ARRAY_TYPE(3),E=-T[0],C=-T[1],D=-T[2],O=T[3],F=T[4],V=T[5],W=T[6],B=T[7],H=E*E+C*C+D*D+O*O;return H>0?(I[0]=2*(F*O+B*E+V*D-W*C)/H,I[1]=2*(V*O+B*C+W*E-F*D)/H,I[2]=2*(W*O+B*D+F*C-V*E)/H):(I[0]=2*(F*O+B*E+V*D-W*C),I[1]=2*(V*O+B*C+W*E-F*D),I[2]=2*(W*O+B*D+F*C-V*E)),h(v,T,I),v},je.getTranslation=function(v,T){return v[0]=T[12],v[1]=T[13],v[2]=T[14],v},je.getScaling=g,je.getRotation=function(v,T){var I=new r.ARRAY_TYPE(3);g(I,T);var E=1/I[0],C=1/I[1],D=1/I[2],O=T[0]*E,F=T[1]*C,V=T[2]*D,W=T[4]*E,B=T[5]*C,H=T[6]*D,Z=T[8]*E,re=T[9]*C,de=T[10]*D,me=O+B+de,ue=0;return me>0?(ue=2*Math.sqrt(me+1),v[3]=.25*ue,v[0]=(H-re)/ue,v[1]=(Z-V)/ue,v[2]=(F-W)/ue):O>B&&O>de?(ue=2*Math.sqrt(1+O-B-de),v[3]=(H-re)/ue,v[0]=.25*ue,v[1]=(F+W)/ue,v[2]=(Z+V)/ue):B>de?(ue=2*Math.sqrt(1+B-O-de),v[3]=(Z-V)/ue,v[0]=(F+W)/ue,v[1]=.25*ue,v[2]=(H+re)/ue):(ue=2*Math.sqrt(1+de-O-B),v[3]=(F-W)/ue,v[0]=(Z+V)/ue,v[1]=(H+re)/ue,v[2]=.25*ue),v},je.fromRotationTranslationScale=function(v,T,I,E){var C=T[0],D=T[1],O=T[2],F=T[3],V=C+C,W=D+D,B=O+O,H=C*V,Z=C*W,re=C*B,de=D*W,me=D*B,ue=O*B,Te=F*V,_e=F*W,Ce=F*B,Oe=E[0],Fe=E[1],Be=E[2];return v[0]=(1-(de+ue))*Oe,v[1]=(Z+Ce)*Oe,v[2]=(re-_e)*Oe,v[3]=0,v[4]=(Z-Ce)*Fe,v[5]=(1-(H+ue))*Fe,v[6]=(me+Te)*Fe,v[7]=0,v[8]=(re+_e)*Be,v[9]=(me-Te)*Be,v[10]=(1-(H+de))*Be,v[11]=0,v[12]=I[0],v[13]=I[1],v[14]=I[2],v[15]=1,v},je.fromRotationTranslationScaleOrigin=function(v,T,I,E,C){var D=T[0],O=T[1],F=T[2],V=T[3],W=D+D,B=O+O,H=F+F,Z=D*W,re=D*B,de=D*H,me=O*B,ue=O*H,Te=F*H,_e=V*W,Ce=V*B,Oe=V*H,Fe=E[0],Be=E[1],Ne=E[2],qe=C[0],Ve=C[1],ot=C[2],mt=(1-(me+Te))*Fe,tt=(re+Oe)*Fe,Nt=(de-Ce)*Fe,Ot=(re-Oe)*Be,St=(1-(Z+Te))*Be,vt=(ue+_e)*Be,or=(de+Ce)*Ne,Ft=(ue-_e)*Ne,Gt=(1-(Z+me))*Ne;return v[0]=mt,v[1]=tt,v[2]=Nt,v[3]=0,v[4]=Ot,v[5]=St,v[6]=vt,v[7]=0,v[8]=or,v[9]=Ft,v[10]=Gt,v[11]=0,v[12]=I[0]+qe-(mt*qe+Ot*Ve+or*ot),v[13]=I[1]+Ve-(tt*qe+St*Ve+Ft*ot),v[14]=I[2]+ot-(Nt*qe+vt*Ve+Gt*ot),v[15]=1,v},je.fromQuat=function(v,T){var I=T[0],E=T[1],C=T[2],D=T[3],O=I+I,F=E+E,V=C+C,W=I*O,B=E*O,H=E*F,Z=C*O,re=C*F,de=C*V,me=D*O,ue=D*F,Te=D*V;return v[0]=1-H-de,v[1]=B+Te,v[2]=Z-ue,v[3]=0,v[4]=B-Te,v[5]=1-W-de,v[6]=re+me,v[7]=0,v[8]=Z+ue,v[9]=re-me,v[10]=1-W-H,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},je.frustum=function(v,T,I,E,C,D,O){var F=1/(I-T),V=1/(C-E),W=1/(D-O);return v[0]=2*D*F,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=2*D*V,v[6]=0,v[7]=0,v[8]=(I+T)*F,v[9]=(C+E)*V,v[10]=(O+D)*W,v[11]=-1,v[12]=0,v[13]=0,v[14]=O*D*2*W,v[15]=0,v},je.perspectiveNO=b,je.perspectiveZO=function(v,T,I,E,C){var D,O=1/Math.tan(T/2);return v[0]=O/I,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=O,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,C!=null&&C!==1/0?(v[10]=C*(D=1/(E-C)),v[14]=C*E*D):(v[10]=-1,v[14]=-E),v},je.perspectiveFromFieldOfView=function(v,T,I,E){var C=Math.tan(T.upDegrees*Math.PI/180),D=Math.tan(T.downDegrees*Math.PI/180),O=Math.tan(T.leftDegrees*Math.PI/180),F=Math.tan(T.rightDegrees*Math.PI/180),V=2/(O+F),W=2/(C+D);return v[0]=V,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=W,v[6]=0,v[7]=0,v[8]=-(O-F)*V*.5,v[9]=(C-D)*W*.5,v[10]=E/(I-E),v[11]=-1,v[12]=0,v[13]=0,v[14]=E*I/(I-E),v[15]=0,v},je.orthoNO=M,je.orthoZO=function(v,T,I,E,C,D,O){var F=1/(T-I),V=1/(E-C),W=1/(D-O);return v[0]=-2*F,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*V,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=W,v[11]=0,v[12]=(T+I)*F,v[13]=(C+E)*V,v[14]=D*W,v[15]=1,v},je.lookAt=function(v,T,I,E){var C,D,O,F,V,W,B,H,Z,re,de=T[0],me=T[1],ue=T[2],Te=E[0],_e=E[1],Ce=E[2],Oe=I[0],Fe=I[1],Be=I[2];return Math.abs(de-Oe)<r.EPSILON&&Math.abs(me-Fe)<r.EPSILON&&Math.abs(ue-Be)<r.EPSILON?u(v):(B=de-Oe,H=me-Fe,Z=ue-Be,C=_e*(Z*=re=1/Math.hypot(B,H,Z))-Ce*(H*=re),D=Ce*(B*=re)-Te*Z,O=Te*H-_e*B,(re=Math.hypot(C,D,O))?(C*=re=1/re,D*=re,O*=re):(C=0,D=0,O=0),F=H*O-Z*D,V=Z*C-B*O,W=B*D-H*C,(re=Math.hypot(F,V,W))?(F*=re=1/re,V*=re,W*=re):(F=0,V=0,W=0),v[0]=C,v[1]=F,v[2]=B,v[3]=0,v[4]=D,v[5]=V,v[6]=H,v[7]=0,v[8]=O,v[9]=W,v[10]=Z,v[11]=0,v[12]=-(C*de+D*me+O*ue),v[13]=-(F*de+V*me+W*ue),v[14]=-(B*de+H*me+Z*ue),v[15]=1,v)},je.targetTo=function(v,T,I,E){var C=T[0],D=T[1],O=T[2],F=E[0],V=E[1],W=E[2],B=C-I[0],H=D-I[1],Z=O-I[2],re=B*B+H*H+Z*Z;re>0&&(B*=re=1/Math.sqrt(re),H*=re,Z*=re);var de=V*Z-W*H,me=W*B-F*Z,ue=F*H-V*B;return(re=de*de+me*me+ue*ue)>0&&(de*=re=1/Math.sqrt(re),me*=re,ue*=re),v[0]=de,v[1]=me,v[2]=ue,v[3]=0,v[4]=H*ue-Z*me,v[5]=Z*de-B*ue,v[6]=B*me-H*de,v[7]=0,v[8]=B,v[9]=H,v[10]=Z,v[11]=0,v[12]=C,v[13]=D,v[14]=O,v[15]=1,v},je.str=function(v){return"mat4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+", "+v[6]+", "+v[7]+", "+v[8]+", "+v[9]+", "+v[10]+", "+v[11]+", "+v[12]+", "+v[13]+", "+v[14]+", "+v[15]+")"},je.frob=function(v){return Math.hypot(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])},je.add=function(v,T,I){return v[0]=T[0]+I[0],v[1]=T[1]+I[1],v[2]=T[2]+I[2],v[3]=T[3]+I[3],v[4]=T[4]+I[4],v[5]=T[5]+I[5],v[6]=T[6]+I[6],v[7]=T[7]+I[7],v[8]=T[8]+I[8],v[9]=T[9]+I[9],v[10]=T[10]+I[10],v[11]=T[11]+I[11],v[12]=T[12]+I[12],v[13]=T[13]+I[13],v[14]=T[14]+I[14],v[15]=T[15]+I[15],v},je.subtract=P,je.multiplyScalar=function(v,T,I){return v[0]=T[0]*I,v[1]=T[1]*I,v[2]=T[2]*I,v[3]=T[3]*I,v[4]=T[4]*I,v[5]=T[5]*I,v[6]=T[6]*I,v[7]=T[7]*I,v[8]=T[8]*I,v[9]=T[9]*I,v[10]=T[10]*I,v[11]=T[11]*I,v[12]=T[12]*I,v[13]=T[13]*I,v[14]=T[14]*I,v[15]=T[15]*I,v},je.multiplyScalarAndAdd=function(v,T,I,E){return v[0]=T[0]+I[0]*E,v[1]=T[1]+I[1]*E,v[2]=T[2]+I[2]*E,v[3]=T[3]+I[3]*E,v[4]=T[4]+I[4]*E,v[5]=T[5]+I[5]*E,v[6]=T[6]+I[6]*E,v[7]=T[7]+I[7]*E,v[8]=T[8]+I[8]*E,v[9]=T[9]+I[9]*E,v[10]=T[10]+I[10]*E,v[11]=T[11]+I[11]*E,v[12]=T[12]+I[12]*E,v[13]=T[13]+I[13]*E,v[14]=T[14]+I[14]*E,v[15]=T[15]+I[15]*E,v},je.exactEquals=function(v,T){return v[0]===T[0]&&v[1]===T[1]&&v[2]===T[2]&&v[3]===T[3]&&v[4]===T[4]&&v[5]===T[5]&&v[6]===T[6]&&v[7]===T[7]&&v[8]===T[8]&&v[9]===T[9]&&v[10]===T[10]&&v[11]===T[11]&&v[12]===T[12]&&v[13]===T[13]&&v[14]===T[14]&&v[15]===T[15]},je.equals=function(v,T){var I=v[0],E=v[1],C=v[2],D=v[3],O=v[4],F=v[5],V=v[6],W=v[7],B=v[8],H=v[9],Z=v[10],re=v[11],de=v[12],me=v[13],ue=v[14],Te=v[15],_e=T[0],Ce=T[1],Oe=T[2],Fe=T[3],Be=T[4],Ne=T[5],qe=T[6],Ve=T[7],ot=T[8],mt=T[9],tt=T[10],Nt=T[11],Ot=T[12],St=T[13],vt=T[14],or=T[15];return Math.abs(I-_e)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(_e))&&Math.abs(E-Ce)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ce))&&Math.abs(C-Oe)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(Oe))&&Math.abs(D-Fe)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(Fe))&&Math.abs(O-Be)<=r.EPSILON*Math.max(1,Math.abs(O),Math.abs(Be))&&Math.abs(F-Ne)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(Ne))&&Math.abs(V-qe)<=r.EPSILON*Math.max(1,Math.abs(V),Math.abs(qe))&&Math.abs(W-Ve)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ve))&&Math.abs(B-ot)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(ot))&&Math.abs(H-mt)<=r.EPSILON*Math.max(1,Math.abs(H),Math.abs(mt))&&Math.abs(Z-tt)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(tt))&&Math.abs(re-Nt)<=r.EPSILON*Math.max(1,Math.abs(re),Math.abs(Nt))&&Math.abs(de-Ot)<=r.EPSILON*Math.max(1,Math.abs(de),Math.abs(Ot))&&Math.abs(me-St)<=r.EPSILON*Math.max(1,Math.abs(me),Math.abs(St))&&Math.abs(ue-vt)<=r.EPSILON*Math.max(1,Math.abs(ue),Math.abs(vt))&&Math.abs(Te-or)<=r.EPSILON*Math.max(1,Math.abs(Te),Math.abs(or))},je.sub=je.mul=je.ortho=je.perspective=void 0;var r=function(v,T){if(v&&v.__esModule)return v;if(v===null||c(v)!=="object"&&typeof v!="function")return{default:v};var I=o(void 0);if(I&&I.has(v))return I.get(v);var E={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in v)if(D!=="default"&&Object.prototype.hasOwnProperty.call(v,D)){var O=C?Object.getOwnPropertyDescriptor(v,D):null;O&&(O.get||O.set)?Object.defineProperty(E,D,O):E[D]=v[D]}return E.default=v,I&&I.set(v,E),E}(oe());function o(v){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(o=function(E){return E?I:T})(v)}function u(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function m(v,T,I){var E=T[0],C=T[1],D=T[2],O=T[3],F=T[4],V=T[5],W=T[6],B=T[7],H=T[8],Z=T[9],re=T[10],de=T[11],me=T[12],ue=T[13],Te=T[14],_e=T[15],Ce=I[0],Oe=I[1],Fe=I[2],Be=I[3];return v[0]=Ce*E+Oe*F+Fe*H+Be*me,v[1]=Ce*C+Oe*V+Fe*Z+Be*ue,v[2]=Ce*D+Oe*W+Fe*re+Be*Te,v[3]=Ce*O+Oe*B+Fe*de+Be*_e,v[4]=(Ce=I[4])*E+(Oe=I[5])*F+(Fe=I[6])*H+(Be=I[7])*me,v[5]=Ce*C+Oe*V+Fe*Z+Be*ue,v[6]=Ce*D+Oe*W+Fe*re+Be*Te,v[7]=Ce*O+Oe*B+Fe*de+Be*_e,v[8]=(Ce=I[8])*E+(Oe=I[9])*F+(Fe=I[10])*H+(Be=I[11])*me,v[9]=Ce*C+Oe*V+Fe*Z+Be*ue,v[10]=Ce*D+Oe*W+Fe*re+Be*Te,v[11]=Ce*O+Oe*B+Fe*de+Be*_e,v[12]=(Ce=I[12])*E+(Oe=I[13])*F+(Fe=I[14])*H+(Be=I[15])*me,v[13]=Ce*C+Oe*V+Fe*Z+Be*ue,v[14]=Ce*D+Oe*W+Fe*re+Be*Te,v[15]=Ce*O+Oe*B+Fe*de+Be*_e,v}function h(v,T,I){var E=T[0],C=T[1],D=T[2],O=T[3],F=E+E,V=C+C,W=D+D,B=E*F,H=E*V,Z=E*W,re=C*V,de=C*W,me=D*W,ue=O*F,Te=O*V,_e=O*W;return v[0]=1-(re+me),v[1]=H+_e,v[2]=Z-Te,v[3]=0,v[4]=H-_e,v[5]=1-(B+me),v[6]=de+ue,v[7]=0,v[8]=Z+Te,v[9]=de-ue,v[10]=1-(B+re),v[11]=0,v[12]=I[0],v[13]=I[1],v[14]=I[2],v[15]=1,v}function g(v,T){var I=T[4],E=T[5],C=T[6],D=T[8],O=T[9],F=T[10];return v[0]=Math.hypot(T[0],T[1],T[2]),v[1]=Math.hypot(I,E,C),v[2]=Math.hypot(D,O,F),v}function b(v,T,I,E,C){var D,O=1/Math.tan(T/2);return v[0]=O/I,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=O,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,C!=null&&C!==1/0?(v[10]=(C+E)*(D=1/(E-C)),v[14]=2*C*E*D):(v[10]=-1,v[14]=-2*E),v}function M(v,T,I,E,C,D,O){var F=1/(T-I),V=1/(E-C),W=1/(D-O);return v[0]=-2*F,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*V,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*W,v[11]=0,v[12]=(T+I)*F,v[13]=(C+E)*V,v[14]=(O+D)*W,v[15]=1,v}function P(v,T,I){return v[0]=T[0]-I[0],v[1]=T[1]-I[1],v[2]=T[2]-I[2],v[3]=T[3]-I[3],v[4]=T[4]-I[4],v[5]=T[5]-I[5],v[6]=T[6]-I[6],v[7]=T[7]-I[7],v[8]=T[8]-I[8],v[9]=T[9]-I[9],v[10]=T[10]-I[10],v[11]=T[11]-I[11],v[12]=T[12]-I[12],v[13]=T[13]-I[13],v[14]=T[14]-I[14],v[15]=T[15]-I[15],v}return je.perspective=b,je.ortho=M,je.mul=m,je.sub=P,je}var ye,et={},dt={};function Xt(){if(ye)return dt;function c(C){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},c(C)}ye=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.create=u,dt.clone=function(C){var D=new r.ARRAY_TYPE(3);return D[0]=C[0],D[1]=C[1],D[2]=C[2],D},dt.length=m,dt.fromValues=function(C,D,O){var F=new r.ARRAY_TYPE(3);return F[0]=C,F[1]=D,F[2]=O,F},dt.copy=function(C,D){return C[0]=D[0],C[1]=D[1],C[2]=D[2],C},dt.set=function(C,D,O,F){return C[0]=D,C[1]=O,C[2]=F,C},dt.add=function(C,D,O){return C[0]=D[0]+O[0],C[1]=D[1]+O[1],C[2]=D[2]+O[2],C},dt.subtract=h,dt.multiply=g,dt.divide=b,dt.ceil=function(C,D){return C[0]=Math.ceil(D[0]),C[1]=Math.ceil(D[1]),C[2]=Math.ceil(D[2]),C},dt.floor=function(C,D){return C[0]=Math.floor(D[0]),C[1]=Math.floor(D[1]),C[2]=Math.floor(D[2]),C},dt.min=function(C,D,O){return C[0]=Math.min(D[0],O[0]),C[1]=Math.min(D[1],O[1]),C[2]=Math.min(D[2],O[2]),C},dt.max=function(C,D,O){return C[0]=Math.max(D[0],O[0]),C[1]=Math.max(D[1],O[1]),C[2]=Math.max(D[2],O[2]),C},dt.round=function(C,D){return C[0]=Math.round(D[0]),C[1]=Math.round(D[1]),C[2]=Math.round(D[2]),C},dt.scale=function(C,D,O){return C[0]=D[0]*O,C[1]=D[1]*O,C[2]=D[2]*O,C},dt.scaleAndAdd=function(C,D,O,F){return C[0]=D[0]+O[0]*F,C[1]=D[1]+O[1]*F,C[2]=D[2]+O[2]*F,C},dt.distance=M,dt.squaredDistance=P,dt.squaredLength=v,dt.negate=function(C,D){return C[0]=-D[0],C[1]=-D[1],C[2]=-D[2],C},dt.inverse=function(C,D){return C[0]=1/D[0],C[1]=1/D[1],C[2]=1/D[2],C},dt.normalize=function(C,D){var O=D[0],F=D[1],V=D[2],W=O*O+F*F+V*V;return W>0&&(W=1/Math.sqrt(W)),C[0]=D[0]*W,C[1]=D[1]*W,C[2]=D[2]*W,C},dt.dot=T,dt.cross=function(C,D,O){var F=D[0],V=D[1],W=D[2],B=O[0],H=O[1],Z=O[2];return C[0]=V*Z-W*H,C[1]=W*B-F*Z,C[2]=F*H-V*B,C},dt.lerp=function(C,D,O,F){var V=D[0],W=D[1],B=D[2];return C[0]=V+F*(O[0]-V),C[1]=W+F*(O[1]-W),C[2]=B+F*(O[2]-B),C},dt.hermite=function(C,D,O,F,V,W){var B=W*W,H=B*(2*W-3)+1,Z=B*(W-2)+W,re=B*(W-1),de=B*(3-2*W);return C[0]=D[0]*H+O[0]*Z+F[0]*re+V[0]*de,C[1]=D[1]*H+O[1]*Z+F[1]*re+V[1]*de,C[2]=D[2]*H+O[2]*Z+F[2]*re+V[2]*de,C},dt.bezier=function(C,D,O,F,V,W){var B=1-W,H=B*B,Z=W*W,re=H*B,de=3*W*H,me=3*Z*B,ue=Z*W;return C[0]=D[0]*re+O[0]*de+F[0]*me+V[0]*ue,C[1]=D[1]*re+O[1]*de+F[1]*me+V[1]*ue,C[2]=D[2]*re+O[2]*de+F[2]*me+V[2]*ue,C},dt.random=function(C,D){D=D||1;var O=2*r.RANDOM()*Math.PI,F=2*r.RANDOM()-1,V=Math.sqrt(1-F*F)*D;return C[0]=Math.cos(O)*V,C[1]=Math.sin(O)*V,C[2]=F*D,C},dt.transformMat4=function(C,D,O){var F=D[0],V=D[1],W=D[2],B=O[3]*F+O[7]*V+O[11]*W+O[15];return C[0]=(O[0]*F+O[4]*V+O[8]*W+O[12])/(B=B||1),C[1]=(O[1]*F+O[5]*V+O[9]*W+O[13])/B,C[2]=(O[2]*F+O[6]*V+O[10]*W+O[14])/B,C},dt.transformMat3=function(C,D,O){var F=D[0],V=D[1],W=D[2];return C[0]=F*O[0]+V*O[3]+W*O[6],C[1]=F*O[1]+V*O[4]+W*O[7],C[2]=F*O[2]+V*O[5]+W*O[8],C},dt.transformQuat=function(C,D,O){var F=O[0],V=O[1],W=O[2],B=D[0],H=D[1],Z=D[2],re=V*Z-W*H,de=W*B-F*Z,me=F*H-V*B,ue=V*me-W*de,Te=W*re-F*me,_e=F*de-V*re,Ce=2*O[3];return de*=Ce,me*=Ce,Te*=2,_e*=2,C[0]=B+(re*=Ce)+(ue*=2),C[1]=H+de+Te,C[2]=Z+me+_e,C},dt.rotateX=function(C,D,O,F){var V=[],W=[];return V[0]=D[0]-O[0],V[1]=D[1]-O[1],V[2]=D[2]-O[2],W[0]=V[0],W[1]=V[1]*Math.cos(F)-V[2]*Math.sin(F),W[2]=V[1]*Math.sin(F)+V[2]*Math.cos(F),C[0]=W[0]+O[0],C[1]=W[1]+O[1],C[2]=W[2]+O[2],C},dt.rotateY=function(C,D,O,F){var V=[],W=[];return V[0]=D[0]-O[0],V[1]=D[1]-O[1],V[2]=D[2]-O[2],W[0]=V[2]*Math.sin(F)+V[0]*Math.cos(F),W[1]=V[1],W[2]=V[2]*Math.cos(F)-V[0]*Math.sin(F),C[0]=W[0]+O[0],C[1]=W[1]+O[1],C[2]=W[2]+O[2],C},dt.rotateZ=function(C,D,O,F){var V=[],W=[];return V[0]=D[0]-O[0],V[1]=D[1]-O[1],V[2]=D[2]-O[2],W[0]=V[0]*Math.cos(F)-V[1]*Math.sin(F),W[1]=V[0]*Math.sin(F)+V[1]*Math.cos(F),W[2]=V[2],C[0]=W[0]+O[0],C[1]=W[1]+O[1],C[2]=W[2]+O[2],C},dt.angle=function(C,D){var O=C[0],F=C[1],V=C[2],W=D[0],B=D[1],H=D[2],Z=Math.sqrt(O*O+F*F+V*V)*Math.sqrt(W*W+B*B+H*H),re=Z&&T(C,D)/Z;return Math.acos(Math.min(Math.max(re,-1),1))},dt.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C},dt.str=function(C){return"vec3("+C[0]+", "+C[1]+", "+C[2]+")"},dt.exactEquals=function(C,D){return C[0]===D[0]&&C[1]===D[1]&&C[2]===D[2]},dt.equals=function(C,D){var O=C[0],F=C[1],V=C[2],W=D[0],B=D[1],H=D[2];return Math.abs(O-W)<=r.EPSILON*Math.max(1,Math.abs(O),Math.abs(W))&&Math.abs(F-B)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(B))&&Math.abs(V-H)<=r.EPSILON*Math.max(1,Math.abs(V),Math.abs(H))},dt.forEach=dt.sqrLen=dt.len=dt.sqrDist=dt.dist=dt.div=dt.mul=dt.sub=void 0;var r=function(C,D){if(C&&C.__esModule)return C;if(C===null||c(C)!=="object"&&typeof C!="function")return{default:C};var O=o(void 0);if(O&&O.has(C))return O.get(C);var F={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in C)if(W!=="default"&&Object.prototype.hasOwnProperty.call(C,W)){var B=V?Object.getOwnPropertyDescriptor(C,W):null;B&&(B.get||B.set)?Object.defineProperty(F,W,B):F[W]=C[W]}return F.default=C,O&&O.set(C,F),F}(oe());function o(C){if(typeof WeakMap!="function")return null;var D=new WeakMap,O=new WeakMap;return(o=function(F){return F?O:D})(C)}function u(){var C=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0),C}function m(C){return Math.hypot(C[0],C[1],C[2])}function h(C,D,O){return C[0]=D[0]-O[0],C[1]=D[1]-O[1],C[2]=D[2]-O[2],C}function g(C,D,O){return C[0]=D[0]*O[0],C[1]=D[1]*O[1],C[2]=D[2]*O[2],C}function b(C,D,O){return C[0]=D[0]/O[0],C[1]=D[1]/O[1],C[2]=D[2]/O[2],C}function M(C,D){return Math.hypot(D[0]-C[0],D[1]-C[1],D[2]-C[2])}function P(C,D){var O=D[0]-C[0],F=D[1]-C[1],V=D[2]-C[2];return O*O+F*F+V*V}function v(C){var D=C[0],O=C[1],F=C[2];return D*D+O*O+F*F}function T(C,D){return C[0]*D[0]+C[1]*D[1]+C[2]*D[2]}dt.sub=h,dt.mul=g,dt.div=b,dt.dist=M,dt.sqrDist=P,dt.len=m,dt.sqrLen=v;var I,E=(I=u(),function(C,D,O,F,V,W){var B,H;for(D||(D=3),O||(O=0),H=F?Math.min(F*D+O,C.length):C.length,B=O;B<H;B+=D)I[0]=C[B],I[1]=C[B+1],I[2]=C[B+2],V(I,I,W),C[B]=I[0],C[B+1]=I[1],C[B+2]=I[2];return C});return dt.forEach=E,dt}var Mt,yt,gt={};function Ze(){if(Mt)return gt;function c(E){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(E)}Mt=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=u,gt.clone=function(E){var C=new r.ARRAY_TYPE(4);return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C},gt.fromValues=function(E,C,D,O){var F=new r.ARRAY_TYPE(4);return F[0]=E,F[1]=C,F[2]=D,F[3]=O,F},gt.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3],E},gt.set=function(E,C,D,O,F){return E[0]=C,E[1]=D,E[2]=O,E[3]=F,E},gt.add=function(E,C,D){return E[0]=C[0]+D[0],E[1]=C[1]+D[1],E[2]=C[2]+D[2],E[3]=C[3]+D[3],E},gt.subtract=m,gt.multiply=h,gt.divide=g,gt.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E[2]=Math.ceil(C[2]),E[3]=Math.ceil(C[3]),E},gt.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E[2]=Math.floor(C[2]),E[3]=Math.floor(C[3]),E},gt.min=function(E,C,D){return E[0]=Math.min(C[0],D[0]),E[1]=Math.min(C[1],D[1]),E[2]=Math.min(C[2],D[2]),E[3]=Math.min(C[3],D[3]),E},gt.max=function(E,C,D){return E[0]=Math.max(C[0],D[0]),E[1]=Math.max(C[1],D[1]),E[2]=Math.max(C[2],D[2]),E[3]=Math.max(C[3],D[3]),E},gt.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E[2]=Math.round(C[2]),E[3]=Math.round(C[3]),E},gt.scale=function(E,C,D){return E[0]=C[0]*D,E[1]=C[1]*D,E[2]=C[2]*D,E[3]=C[3]*D,E},gt.scaleAndAdd=function(E,C,D,O){return E[0]=C[0]+D[0]*O,E[1]=C[1]+D[1]*O,E[2]=C[2]+D[2]*O,E[3]=C[3]+D[3]*O,E},gt.distance=b,gt.squaredDistance=M,gt.length=P,gt.squaredLength=v,gt.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E[2]=-C[2],E[3]=-C[3],E},gt.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E[2]=1/C[2],E[3]=1/C[3],E},gt.normalize=function(E,C){var D=C[0],O=C[1],F=C[2],V=C[3],W=D*D+O*O+F*F+V*V;return W>0&&(W=1/Math.sqrt(W)),E[0]=D*W,E[1]=O*W,E[2]=F*W,E[3]=V*W,E},gt.dot=function(E,C){return E[0]*C[0]+E[1]*C[1]+E[2]*C[2]+E[3]*C[3]},gt.cross=function(E,C,D,O){var F=D[0]*O[1]-D[1]*O[0],V=D[0]*O[2]-D[2]*O[0],W=D[0]*O[3]-D[3]*O[0],B=D[1]*O[2]-D[2]*O[1],H=D[1]*O[3]-D[3]*O[1],Z=D[2]*O[3]-D[3]*O[2],re=C[0],de=C[1],me=C[2],ue=C[3];return E[0]=de*Z-me*H+ue*B,E[1]=-re*Z+me*W-ue*V,E[2]=re*H-de*W+ue*F,E[3]=-re*B+de*V-me*F,E},gt.lerp=function(E,C,D,O){var F=C[0],V=C[1],W=C[2],B=C[3];return E[0]=F+O*(D[0]-F),E[1]=V+O*(D[1]-V),E[2]=W+O*(D[2]-W),E[3]=B+O*(D[3]-B),E},gt.random=function(E,C){var D,O,F,V,W,B;C=C||1;do W=(D=2*r.RANDOM()-1)*D+(O=2*r.RANDOM()-1)*O;while(W>=1);do B=(F=2*r.RANDOM()-1)*F+(V=2*r.RANDOM()-1)*V;while(B>=1);var H=Math.sqrt((1-W)/B);return E[0]=C*D,E[1]=C*O,E[2]=C*F*H,E[3]=C*V*H,E},gt.transformMat4=function(E,C,D){var O=C[0],F=C[1],V=C[2],W=C[3];return E[0]=D[0]*O+D[4]*F+D[8]*V+D[12]*W,E[1]=D[1]*O+D[5]*F+D[9]*V+D[13]*W,E[2]=D[2]*O+D[6]*F+D[10]*V+D[14]*W,E[3]=D[3]*O+D[7]*F+D[11]*V+D[15]*W,E},gt.transformQuat=function(E,C,D){var O=C[0],F=C[1],V=C[2],W=D[0],B=D[1],H=D[2],Z=D[3],re=Z*O+B*V-H*F,de=Z*F+H*O-W*V,me=Z*V+W*F-B*O,ue=-W*O-B*F-H*V;return E[0]=re*Z+ue*-W+de*-H-me*-B,E[1]=de*Z+ue*-B+me*-W-re*-H,E[2]=me*Z+ue*-H+re*-B-de*-W,E[3]=C[3],E},gt.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},gt.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},gt.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]&&E[3]===C[3]},gt.equals=function(E,C){var D=E[0],O=E[1],F=E[2],V=E[3],W=C[0],B=C[1],H=C[2],Z=C[3];return Math.abs(D-W)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(W))&&Math.abs(O-B)<=r.EPSILON*Math.max(1,Math.abs(O),Math.abs(B))&&Math.abs(F-H)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(H))&&Math.abs(V-Z)<=r.EPSILON*Math.max(1,Math.abs(V),Math.abs(Z))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var r=function(E,C){if(E&&E.__esModule)return E;if(E===null||c(E)!=="object"&&typeof E!="function")return{default:E};var D=o(void 0);if(D&&D.has(E))return D.get(E);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in E)if(V!=="default"&&Object.prototype.hasOwnProperty.call(E,V)){var W=F?Object.getOwnPropertyDescriptor(E,V):null;W&&(W.get||W.set)?Object.defineProperty(O,V,W):O[V]=E[V]}return O.default=E,D&&D.set(E,O),O}(oe());function o(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,D=new WeakMap;return(o=function(O){return O?D:C})(E)}function u(){var E=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function m(E,C,D){return E[0]=C[0]-D[0],E[1]=C[1]-D[1],E[2]=C[2]-D[2],E[3]=C[3]-D[3],E}function h(E,C,D){return E[0]=C[0]*D[0],E[1]=C[1]*D[1],E[2]=C[2]*D[2],E[3]=C[3]*D[3],E}function g(E,C,D){return E[0]=C[0]/D[0],E[1]=C[1]/D[1],E[2]=C[2]/D[2],E[3]=C[3]/D[3],E}function b(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1],C[2]-E[2],C[3]-E[3])}function M(E,C){var D=C[0]-E[0],O=C[1]-E[1],F=C[2]-E[2],V=C[3]-E[3];return D*D+O*O+F*F+V*V}function P(E){return Math.hypot(E[0],E[1],E[2],E[3])}function v(E){var C=E[0],D=E[1],O=E[2],F=E[3];return C*C+D*D+O*O+F*F}gt.sub=m,gt.mul=h,gt.div=g,gt.dist=b,gt.sqrDist=M,gt.len=P,gt.sqrLen=v;var T,I=(T=u(),function(E,C,D,O,F,V){var W,B;for(C||(C=4),D||(D=0),B=O?Math.min(O*C+D,E.length):E.length,W=D;W<B;W+=C)T[0]=E[W],T[1]=E[W+1],T[2]=E[W+2],T[3]=E[W+3],F(T,T,V),E[W]=T[0],E[W+1]=T[1],E[W+2]=T[2],E[W+3]=T[3];return E});return gt.forEach=I,gt}function ht(){if(yt)return et;function c(_e){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ce){return typeof Ce}:function(Ce){return Ce&&typeof Symbol=="function"&&Ce.constructor===Symbol&&Ce!==Symbol.prototype?"symbol":typeof Ce},c(_e)}yt=1,Object.defineProperty(et,"__esModule",{value:!0}),et.create=b,et.identity=function(_e){return _e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e},et.setAxisAngle=M,et.getAxisAngle=function(_e,Ce){var Oe=2*Math.acos(Ce[3]),Fe=Math.sin(Oe/2);return Fe>r.EPSILON?(_e[0]=Ce[0]/Fe,_e[1]=Ce[1]/Fe,_e[2]=Ce[2]/Fe):(_e[0]=1,_e[1]=0,_e[2]=0),Oe},et.getAngle=function(_e,Ce){var Oe=D(_e,Ce);return Math.acos(2*Oe*Oe-1)},et.multiply=P,et.rotateX=function(_e,Ce,Oe){Oe*=.5;var Fe=Ce[0],Be=Ce[1],Ne=Ce[2],qe=Ce[3],Ve=Math.sin(Oe),ot=Math.cos(Oe);return _e[0]=Fe*ot+qe*Ve,_e[1]=Be*ot+Ne*Ve,_e[2]=Ne*ot-Be*Ve,_e[3]=qe*ot-Fe*Ve,_e},et.rotateY=function(_e,Ce,Oe){Oe*=.5;var Fe=Ce[0],Be=Ce[1],Ne=Ce[2],qe=Ce[3],Ve=Math.sin(Oe),ot=Math.cos(Oe);return _e[0]=Fe*ot-Ne*Ve,_e[1]=Be*ot+qe*Ve,_e[2]=Ne*ot+Fe*Ve,_e[3]=qe*ot-Be*Ve,_e},et.rotateZ=function(_e,Ce,Oe){Oe*=.5;var Fe=Ce[0],Be=Ce[1],Ne=Ce[2],qe=Ce[3],Ve=Math.sin(Oe),ot=Math.cos(Oe);return _e[0]=Fe*ot+Be*Ve,_e[1]=Be*ot-Fe*Ve,_e[2]=Ne*ot+qe*Ve,_e[3]=qe*ot-Ne*Ve,_e},et.calculateW=function(_e,Ce){var Oe=Ce[0],Fe=Ce[1],Be=Ce[2];return _e[0]=Oe,_e[1]=Fe,_e[2]=Be,_e[3]=Math.sqrt(Math.abs(1-Oe*Oe-Fe*Fe-Be*Be)),_e},et.exp=v,et.ln=T,et.pow=function(_e,Ce,Oe){return T(_e,Ce),C(_e,_e,Oe),v(_e,_e),_e},et.slerp=I,et.random=function(_e){var Ce=r.RANDOM(),Oe=r.RANDOM(),Fe=r.RANDOM(),Be=Math.sqrt(1-Ce),Ne=Math.sqrt(Ce);return _e[0]=Be*Math.sin(2*Math.PI*Oe),_e[1]=Be*Math.cos(2*Math.PI*Oe),_e[2]=Ne*Math.sin(2*Math.PI*Fe),_e[3]=Ne*Math.cos(2*Math.PI*Fe),_e},et.invert=function(_e,Ce){var Oe=Ce[0],Fe=Ce[1],Be=Ce[2],Ne=Ce[3],qe=Oe*Oe+Fe*Fe+Be*Be+Ne*Ne,Ve=qe?1/qe:0;return _e[0]=-Oe*Ve,_e[1]=-Fe*Ve,_e[2]=-Be*Ve,_e[3]=Ne*Ve,_e},et.conjugate=function(_e,Ce){return _e[0]=-Ce[0],_e[1]=-Ce[1],_e[2]=-Ce[2],_e[3]=Ce[3],_e},et.fromMat3=E,et.fromEuler=function(_e,Ce,Oe,Fe){var Be=.5*Math.PI/180;Ce*=Be,Oe*=Be,Fe*=Be;var Ne=Math.sin(Ce),qe=Math.cos(Ce),Ve=Math.sin(Oe),ot=Math.cos(Oe),mt=Math.sin(Fe),tt=Math.cos(Fe);return _e[0]=Ne*ot*tt-qe*Ve*mt,_e[1]=qe*Ve*tt+Ne*ot*mt,_e[2]=qe*ot*mt-Ne*Ve*tt,_e[3]=qe*ot*tt+Ne*Ve*mt,_e},et.str=function(_e){return"quat("+_e[0]+", "+_e[1]+", "+_e[2]+", "+_e[3]+")"},et.setAxes=et.sqlerp=et.rotationTo=et.equals=et.exactEquals=et.normalize=et.sqrLen=et.squaredLength=et.len=et.length=et.lerp=et.dot=et.scale=et.mul=et.add=et.set=et.copy=et.fromValues=et.clone=void 0;var r=g(oe()),o=g(Je()),u=g(Xt()),m=g(Ze());function h(_e){if(typeof WeakMap!="function")return null;var Ce=new WeakMap,Oe=new WeakMap;return(h=function(Fe){return Fe?Oe:Ce})(_e)}function g(_e,Ce){if(_e&&_e.__esModule)return _e;if(_e===null||c(_e)!=="object"&&typeof _e!="function")return{default:_e};var Oe=h(Ce);if(Oe&&Oe.has(_e))return Oe.get(_e);var Fe={},Be=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ne in _e)if(Ne!=="default"&&Object.prototype.hasOwnProperty.call(_e,Ne)){var qe=Be?Object.getOwnPropertyDescriptor(_e,Ne):null;qe&&(qe.get||qe.set)?Object.defineProperty(Fe,Ne,qe):Fe[Ne]=_e[Ne]}return Fe.default=_e,Oe&&Oe.set(_e,Fe),Fe}function b(){var _e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0),_e[3]=1,_e}function M(_e,Ce,Oe){Oe*=.5;var Fe=Math.sin(Oe);return _e[0]=Fe*Ce[0],_e[1]=Fe*Ce[1],_e[2]=Fe*Ce[2],_e[3]=Math.cos(Oe),_e}function P(_e,Ce,Oe){var Fe=Ce[0],Be=Ce[1],Ne=Ce[2],qe=Ce[3],Ve=Oe[0],ot=Oe[1],mt=Oe[2],tt=Oe[3];return _e[0]=Fe*tt+qe*Ve+Be*mt-Ne*ot,_e[1]=Be*tt+qe*ot+Ne*Ve-Fe*mt,_e[2]=Ne*tt+qe*mt+Fe*ot-Be*Ve,_e[3]=qe*tt-Fe*Ve-Be*ot-Ne*mt,_e}function v(_e,Ce){var Oe=Ce[0],Fe=Ce[1],Be=Ce[2],Ne=Ce[3],qe=Math.sqrt(Oe*Oe+Fe*Fe+Be*Be),Ve=Math.exp(Ne),ot=qe>0?Ve*Math.sin(qe)/qe:0;return _e[0]=Oe*ot,_e[1]=Fe*ot,_e[2]=Be*ot,_e[3]=Ve*Math.cos(qe),_e}function T(_e,Ce){var Oe=Ce[0],Fe=Ce[1],Be=Ce[2],Ne=Ce[3],qe=Math.sqrt(Oe*Oe+Fe*Fe+Be*Be),Ve=qe>0?Math.atan2(qe,Ne)/qe:0;return _e[0]=Oe*Ve,_e[1]=Fe*Ve,_e[2]=Be*Ve,_e[3]=.5*Math.log(Oe*Oe+Fe*Fe+Be*Be+Ne*Ne),_e}function I(_e,Ce,Oe,Fe){var Be,Ne,qe,Ve,ot,mt=Ce[0],tt=Ce[1],Nt=Ce[2],Ot=Ce[3],St=Oe[0],vt=Oe[1],or=Oe[2],Ft=Oe[3];return(Ne=mt*St+tt*vt+Nt*or+Ot*Ft)<0&&(Ne=-Ne,St=-St,vt=-vt,or=-or,Ft=-Ft),1-Ne>r.EPSILON?(Be=Math.acos(Ne),qe=Math.sin(Be),Ve=Math.sin((1-Fe)*Be)/qe,ot=Math.sin(Fe*Be)/qe):(Ve=1-Fe,ot=Fe),_e[0]=Ve*mt+ot*St,_e[1]=Ve*tt+ot*vt,_e[2]=Ve*Nt+ot*or,_e[3]=Ve*Ot+ot*Ft,_e}function E(_e,Ce){var Oe,Fe=Ce[0]+Ce[4]+Ce[8];if(Fe>0)Oe=Math.sqrt(Fe+1),_e[3]=.5*Oe,_e[0]=(Ce[5]-Ce[7])*(Oe=.5/Oe),_e[1]=(Ce[6]-Ce[2])*Oe,_e[2]=(Ce[1]-Ce[3])*Oe;else{var Be=0;Ce[4]>Ce[0]&&(Be=1),Ce[8]>Ce[3*Be+Be]&&(Be=2);var Ne=(Be+1)%3,qe=(Be+2)%3;Oe=Math.sqrt(Ce[3*Be+Be]-Ce[3*Ne+Ne]-Ce[3*qe+qe]+1),_e[Be]=.5*Oe,_e[3]=(Ce[3*Ne+qe]-Ce[3*qe+Ne])*(Oe=.5/Oe),_e[Ne]=(Ce[3*Ne+Be]+Ce[3*Be+Ne])*Oe,_e[qe]=(Ce[3*qe+Be]+Ce[3*Be+qe])*Oe}return _e}et.clone=m.clone,et.fromValues=m.fromValues,et.copy=m.copy,et.set=m.set,et.add=m.add,et.mul=P;var C=m.scale;et.scale=C;var D=m.dot;et.dot=D,et.lerp=m.lerp;var O=m.length;et.length=O,et.len=O;var F=m.squaredLength;et.squaredLength=F,et.sqrLen=F;var V=m.normalize;et.normalize=V,et.exactEquals=m.exactEquals,et.equals=m.equals;var W,B,H,Z=(W=u.create(),B=u.fromValues(1,0,0),H=u.fromValues(0,1,0),function(_e,Ce,Oe){var Fe=u.dot(Ce,Oe);return Fe<-.999999?(u.cross(W,B,Ce),u.len(W)<1e-6&&u.cross(W,H,Ce),u.normalize(W,W),M(_e,W,Math.PI),_e):Fe>.999999?(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e):(u.cross(W,Ce,Oe),_e[0]=W[0],_e[1]=W[1],_e[2]=W[2],_e[3]=1+Fe,V(_e,_e))});et.rotationTo=Z;var re,de,me=(re=b(),de=b(),function(_e,Ce,Oe,Fe,Be,Ne){return I(re,Ce,Be,Ne),I(de,Oe,Fe,Ne),I(_e,re,de,2*Ne*(1-Ne)),_e});et.sqlerp=me;var ue,Te=(ue=o.create(),function(_e,Ce,Oe,Fe){return ue[0]=Oe[0],ue[3]=Oe[1],ue[6]=Oe[2],ue[1]=Fe[0],ue[4]=Fe[1],ue[7]=Fe[2],ue[2]=-Ce[0],ue[5]=-Ce[1],ue[8]=-Ce[2],V(_e,E(_e,ue))});return et.setAxes=Te,et}var Dt,Tt={};function tr(){if(Dt)return Tt;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},c(I)}Dt=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=function(){var I=new r.ARRAY_TYPE(8);return r.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},Tt.clone=function(I){var E=new r.ARRAY_TYPE(8);return E[0]=I[0],E[1]=I[1],E[2]=I[2],E[3]=I[3],E[4]=I[4],E[5]=I[5],E[6]=I[6],E[7]=I[7],E},Tt.fromValues=function(I,E,C,D,O,F,V,W){var B=new r.ARRAY_TYPE(8);return B[0]=I,B[1]=E,B[2]=C,B[3]=D,B[4]=O,B[5]=F,B[6]=V,B[7]=W,B},Tt.fromRotationTranslationValues=function(I,E,C,D,O,F,V){var W=new r.ARRAY_TYPE(8);W[0]=I,W[1]=E,W[2]=C,W[3]=D;var B=.5*O,H=.5*F,Z=.5*V;return W[4]=B*D+H*C-Z*E,W[5]=H*D+Z*I-B*C,W[6]=Z*D+B*E-H*I,W[7]=-B*I-H*E-Z*C,W},Tt.fromRotationTranslation=g,Tt.fromTranslation=function(I,E){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*E[0],I[5]=.5*E[1],I[6]=.5*E[2],I[7]=0,I},Tt.fromRotation=function(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},Tt.fromMat4=function(I,E){var C=o.create();u.getRotation(C,E);var D=new r.ARRAY_TYPE(3);return u.getTranslation(D,E),g(I,C,D),I},Tt.copy=b,Tt.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},Tt.set=function(I,E,C,D,O,F,V,W,B){return I[0]=E,I[1]=C,I[2]=D,I[3]=O,I[4]=F,I[5]=V,I[6]=W,I[7]=B,I},Tt.getDual=function(I,E){return I[0]=E[4],I[1]=E[5],I[2]=E[6],I[3]=E[7],I},Tt.setDual=function(I,E){return I[4]=E[0],I[5]=E[1],I[6]=E[2],I[7]=E[3],I},Tt.getTranslation=function(I,E){var C=E[4],D=E[5],O=E[6],F=E[7],V=-E[0],W=-E[1],B=-E[2],H=E[3];return I[0]=2*(C*H+F*V+D*B-O*W),I[1]=2*(D*H+F*W+O*V-C*B),I[2]=2*(O*H+F*B+C*W-D*V),I},Tt.translate=function(I,E,C){var D=E[0],O=E[1],F=E[2],V=E[3],W=.5*C[0],B=.5*C[1],H=.5*C[2],Z=E[4],re=E[5],de=E[6],me=E[7];return I[0]=D,I[1]=O,I[2]=F,I[3]=V,I[4]=V*W+O*H-F*B+Z,I[5]=V*B+F*W-D*H+re,I[6]=V*H+D*B-O*W+de,I[7]=-D*W-O*B-F*H+me,I},Tt.rotateX=function(I,E,C){var D=-E[0],O=-E[1],F=-E[2],V=E[3],W=E[4],B=E[5],H=E[6],Z=E[7],re=W*V+Z*D+B*F-H*O,de=B*V+Z*O+H*D-W*F,me=H*V+Z*F+W*O-B*D,ue=Z*V-W*D-B*O-H*F;return o.rotateX(I,E,C),I[4]=re*(V=I[3])+ue*(D=I[0])+de*(F=I[2])-me*(O=I[1]),I[5]=de*V+ue*O+me*D-re*F,I[6]=me*V+ue*F+re*O-de*D,I[7]=ue*V-re*D-de*O-me*F,I},Tt.rotateY=function(I,E,C){var D=-E[0],O=-E[1],F=-E[2],V=E[3],W=E[4],B=E[5],H=E[6],Z=E[7],re=W*V+Z*D+B*F-H*O,de=B*V+Z*O+H*D-W*F,me=H*V+Z*F+W*O-B*D,ue=Z*V-W*D-B*O-H*F;return o.rotateY(I,E,C),I[4]=re*(V=I[3])+ue*(D=I[0])+de*(F=I[2])-me*(O=I[1]),I[5]=de*V+ue*O+me*D-re*F,I[6]=me*V+ue*F+re*O-de*D,I[7]=ue*V-re*D-de*O-me*F,I},Tt.rotateZ=function(I,E,C){var D=-E[0],O=-E[1],F=-E[2],V=E[3],W=E[4],B=E[5],H=E[6],Z=E[7],re=W*V+Z*D+B*F-H*O,de=B*V+Z*O+H*D-W*F,me=H*V+Z*F+W*O-B*D,ue=Z*V-W*D-B*O-H*F;return o.rotateZ(I,E,C),I[4]=re*(V=I[3])+ue*(D=I[0])+de*(F=I[2])-me*(O=I[1]),I[5]=de*V+ue*O+me*D-re*F,I[6]=me*V+ue*F+re*O-de*D,I[7]=ue*V-re*D-de*O-me*F,I},Tt.rotateByQuatAppend=function(I,E,C){var D=C[0],O=C[1],F=C[2],V=C[3],W=E[0],B=E[1],H=E[2],Z=E[3];return I[0]=W*V+Z*D+B*F-H*O,I[1]=B*V+Z*O+H*D-W*F,I[2]=H*V+Z*F+W*O-B*D,I[3]=Z*V-W*D-B*O-H*F,I[4]=(W=E[4])*V+(Z=E[7])*D+(B=E[5])*F-(H=E[6])*O,I[5]=B*V+Z*O+H*D-W*F,I[6]=H*V+Z*F+W*O-B*D,I[7]=Z*V-W*D-B*O-H*F,I},Tt.rotateByQuatPrepend=function(I,E,C){var D=E[0],O=E[1],F=E[2],V=E[3],W=C[0],B=C[1],H=C[2],Z=C[3];return I[0]=D*Z+V*W+O*H-F*B,I[1]=O*Z+V*B+F*W-D*H,I[2]=F*Z+V*H+D*B-O*W,I[3]=V*Z-D*W-O*B-F*H,I[4]=D*(Z=C[7])+V*(W=C[4])+O*(H=C[6])-F*(B=C[5]),I[5]=O*Z+V*B+F*W-D*H,I[6]=F*Z+V*H+D*B-O*W,I[7]=V*Z-D*W-O*B-F*H,I},Tt.rotateAroundAxis=function(I,E,C,D){if(Math.abs(D)<r.EPSILON)return b(I,E);var O=Math.hypot(C[0],C[1],C[2]);D*=.5;var F=Math.sin(D),V=F*C[0]/O,W=F*C[1]/O,B=F*C[2]/O,H=Math.cos(D),Z=E[0],re=E[1],de=E[2],me=E[3];I[0]=Z*H+me*V+re*B-de*W,I[1]=re*H+me*W+de*V-Z*B,I[2]=de*H+me*B+Z*W-re*V,I[3]=me*H-Z*V-re*W-de*B;var ue=E[4],Te=E[5],_e=E[6],Ce=E[7];return I[4]=ue*H+Ce*V+Te*B-_e*W,I[5]=Te*H+Ce*W+_e*V-ue*B,I[6]=_e*H+Ce*B+ue*W-Te*V,I[7]=Ce*H-ue*V-Te*W-_e*B,I},Tt.add=function(I,E,C){return I[0]=E[0]+C[0],I[1]=E[1]+C[1],I[2]=E[2]+C[2],I[3]=E[3]+C[3],I[4]=E[4]+C[4],I[5]=E[5]+C[5],I[6]=E[6]+C[6],I[7]=E[7]+C[7],I},Tt.multiply=M,Tt.scale=function(I,E,C){return I[0]=E[0]*C,I[1]=E[1]*C,I[2]=E[2]*C,I[3]=E[3]*C,I[4]=E[4]*C,I[5]=E[5]*C,I[6]=E[6]*C,I[7]=E[7]*C,I},Tt.lerp=function(I,E,C,D){var O=1-D;return P(E,C)<0&&(D=-D),I[0]=E[0]*O+C[0]*D,I[1]=E[1]*O+C[1]*D,I[2]=E[2]*O+C[2]*D,I[3]=E[3]*O+C[3]*D,I[4]=E[4]*O+C[4]*D,I[5]=E[5]*O+C[5]*D,I[6]=E[6]*O+C[6]*D,I[7]=E[7]*O+C[7]*D,I},Tt.invert=function(I,E){var C=T(E);return I[0]=-E[0]/C,I[1]=-E[1]/C,I[2]=-E[2]/C,I[3]=E[3]/C,I[4]=-E[4]/C,I[5]=-E[5]/C,I[6]=-E[6]/C,I[7]=E[7]/C,I},Tt.conjugate=function(I,E){return I[0]=-E[0],I[1]=-E[1],I[2]=-E[2],I[3]=E[3],I[4]=-E[4],I[5]=-E[5],I[6]=-E[6],I[7]=E[7],I},Tt.normalize=function(I,E){var C=T(E);if(C>0){C=Math.sqrt(C);var D=E[0]/C,O=E[1]/C,F=E[2]/C,V=E[3]/C,W=E[4],B=E[5],H=E[6],Z=E[7],re=D*W+O*B+F*H+V*Z;I[0]=D,I[1]=O,I[2]=F,I[3]=V,I[4]=(W-D*re)/C,I[5]=(B-O*re)/C,I[6]=(H-F*re)/C,I[7]=(Z-V*re)/C}return I},Tt.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},Tt.exactEquals=function(I,E){return I[0]===E[0]&&I[1]===E[1]&&I[2]===E[2]&&I[3]===E[3]&&I[4]===E[4]&&I[5]===E[5]&&I[6]===E[6]&&I[7]===E[7]},Tt.equals=function(I,E){var C=I[0],D=I[1],O=I[2],F=I[3],V=I[4],W=I[5],B=I[6],H=I[7],Z=E[0],re=E[1],de=E[2],me=E[3],ue=E[4],Te=E[5],_e=E[6],Ce=E[7];return Math.abs(C-Z)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(Z))&&Math.abs(D-re)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(re))&&Math.abs(O-de)<=r.EPSILON*Math.max(1,Math.abs(O),Math.abs(de))&&Math.abs(F-me)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(me))&&Math.abs(V-ue)<=r.EPSILON*Math.max(1,Math.abs(V),Math.abs(ue))&&Math.abs(W-Te)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(Te))&&Math.abs(B-_e)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(_e))&&Math.abs(H-Ce)<=r.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ce))},Tt.sqrLen=Tt.squaredLength=Tt.len=Tt.length=Tt.dot=Tt.mul=Tt.setReal=Tt.getReal=void 0;var r=h(oe()),o=h(ht()),u=h(Ct());function m(I){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(m=function(D){return D?C:E})(I)}function h(I,E){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var C=m(E);if(C&&C.has(I))return C.get(I);var D={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in I)if(F!=="default"&&Object.prototype.hasOwnProperty.call(I,F)){var V=O?Object.getOwnPropertyDescriptor(I,F):null;V&&(V.get||V.set)?Object.defineProperty(D,F,V):D[F]=I[F]}return D.default=I,C&&C.set(I,D),D}function g(I,E,C){var D=.5*C[0],O=.5*C[1],F=.5*C[2],V=E[0],W=E[1],B=E[2],H=E[3];return I[0]=V,I[1]=W,I[2]=B,I[3]=H,I[4]=D*H+O*B-F*W,I[5]=O*H+F*V-D*B,I[6]=F*H+D*W-O*V,I[7]=-D*V-O*W-F*B,I}function b(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=E[4],I[5]=E[5],I[6]=E[6],I[7]=E[7],I}function M(I,E,C){var D=E[0],O=E[1],F=E[2],V=E[3],W=C[4],B=C[5],H=C[6],Z=C[7],re=E[4],de=E[5],me=E[6],ue=E[7],Te=C[0],_e=C[1],Ce=C[2],Oe=C[3];return I[0]=D*Oe+V*Te+O*Ce-F*_e,I[1]=O*Oe+V*_e+F*Te-D*Ce,I[2]=F*Oe+V*Ce+D*_e-O*Te,I[3]=V*Oe-D*Te-O*_e-F*Ce,I[4]=D*Z+V*W+O*H-F*B+re*Oe+ue*Te+de*Ce-me*_e,I[5]=O*Z+V*B+F*W-D*H+de*Oe+ue*_e+me*Te-re*Ce,I[6]=F*Z+V*H+D*B-O*W+me*Oe+ue*Ce+re*_e-de*Te,I[7]=V*Z-D*W-O*B-F*H+ue*Oe-re*Te-de*_e-me*Ce,I}Tt.getReal=o.copy,Tt.setReal=o.copy,Tt.mul=M;var P=o.dot;Tt.dot=P;var v=o.length;Tt.length=v,Tt.len=v;var T=o.squaredLength;return Tt.squaredLength=T,Tt.sqrLen=T,Tt}var Vr,Nr,ct={};function $t(){if(Vr)return ct;function c(E){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(E)}Vr=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.create=u,ct.clone=function(E){var C=new r.ARRAY_TYPE(2);return C[0]=E[0],C[1]=E[1],C},ct.fromValues=function(E,C){var D=new r.ARRAY_TYPE(2);return D[0]=E,D[1]=C,D},ct.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E},ct.set=function(E,C,D){return E[0]=C,E[1]=D,E},ct.add=function(E,C,D){return E[0]=C[0]+D[0],E[1]=C[1]+D[1],E},ct.subtract=m,ct.multiply=h,ct.divide=g,ct.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E},ct.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E},ct.min=function(E,C,D){return E[0]=Math.min(C[0],D[0]),E[1]=Math.min(C[1],D[1]),E},ct.max=function(E,C,D){return E[0]=Math.max(C[0],D[0]),E[1]=Math.max(C[1],D[1]),E},ct.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E},ct.scale=function(E,C,D){return E[0]=C[0]*D,E[1]=C[1]*D,E},ct.scaleAndAdd=function(E,C,D,O){return E[0]=C[0]+D[0]*O,E[1]=C[1]+D[1]*O,E},ct.distance=b,ct.squaredDistance=M,ct.length=P,ct.squaredLength=v,ct.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E},ct.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E},ct.normalize=function(E,C){var D=C[0],O=C[1],F=D*D+O*O;return F>0&&(F=1/Math.sqrt(F)),E[0]=C[0]*F,E[1]=C[1]*F,E},ct.dot=function(E,C){return E[0]*C[0]+E[1]*C[1]},ct.cross=function(E,C,D){var O=C[0]*D[1]-C[1]*D[0];return E[0]=E[1]=0,E[2]=O,E},ct.lerp=function(E,C,D,O){var F=C[0],V=C[1];return E[0]=F+O*(D[0]-F),E[1]=V+O*(D[1]-V),E},ct.random=function(E,C){C=C||1;var D=2*r.RANDOM()*Math.PI;return E[0]=Math.cos(D)*C,E[1]=Math.sin(D)*C,E},ct.transformMat2=function(E,C,D){var O=C[0],F=C[1];return E[0]=D[0]*O+D[2]*F,E[1]=D[1]*O+D[3]*F,E},ct.transformMat2d=function(E,C,D){var O=C[0],F=C[1];return E[0]=D[0]*O+D[2]*F+D[4],E[1]=D[1]*O+D[3]*F+D[5],E},ct.transformMat3=function(E,C,D){var O=C[0],F=C[1];return E[0]=D[0]*O+D[3]*F+D[6],E[1]=D[1]*O+D[4]*F+D[7],E},ct.transformMat4=function(E,C,D){var O=C[0],F=C[1];return E[0]=D[0]*O+D[4]*F+D[12],E[1]=D[1]*O+D[5]*F+D[13],E},ct.rotate=function(E,C,D,O){var F=C[0]-D[0],V=C[1]-D[1],W=Math.sin(O),B=Math.cos(O);return E[0]=F*B-V*W+D[0],E[1]=F*W+V*B+D[1],E},ct.angle=function(E,C){var D=E[0],O=E[1],F=C[0],V=C[1],W=Math.sqrt(D*D+O*O)*Math.sqrt(F*F+V*V);return Math.acos(Math.min(Math.max(W&&(D*F+O*V)/W,-1),1))},ct.zero=function(E){return E[0]=0,E[1]=0,E},ct.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},ct.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]},ct.equals=function(E,C){var D=E[0],O=E[1],F=C[0],V=C[1];return Math.abs(D-F)<=r.EPSILON*Math.max(1,Math.abs(D),Math.abs(F))&&Math.abs(O-V)<=r.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))},ct.forEach=ct.sqrLen=ct.sqrDist=ct.dist=ct.div=ct.mul=ct.sub=ct.len=void 0;var r=function(E,C){if(E&&E.__esModule)return E;if(E===null||c(E)!=="object"&&typeof E!="function")return{default:E};var D=o(void 0);if(D&&D.has(E))return D.get(E);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in E)if(V!=="default"&&Object.prototype.hasOwnProperty.call(E,V)){var W=F?Object.getOwnPropertyDescriptor(E,V):null;W&&(W.get||W.set)?Object.defineProperty(O,V,W):O[V]=E[V]}return O.default=E,D&&D.set(E,O),O}(oe());function o(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,D=new WeakMap;return(o=function(O){return O?D:C})(E)}function u(){var E=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function m(E,C,D){return E[0]=C[0]-D[0],E[1]=C[1]-D[1],E}function h(E,C,D){return E[0]=C[0]*D[0],E[1]=C[1]*D[1],E}function g(E,C,D){return E[0]=C[0]/D[0],E[1]=C[1]/D[1],E}function b(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1])}function M(E,C){var D=C[0]-E[0],O=C[1]-E[1];return D*D+O*O}function P(E){return Math.hypot(E[0],E[1])}function v(E){var C=E[0],D=E[1];return C*C+D*D}ct.len=P,ct.sub=m,ct.mul=h,ct.div=g,ct.dist=b,ct.sqrDist=M,ct.sqrLen=v;var T,I=(T=u(),function(E,C,D,O,F,V){var W,B;for(C||(C=2),D||(D=0),B=O?Math.min(O*C+D,E.length):E.length,W=D;W<B;W+=C)T[0]=E[W],T[1]=E[W+1],F(T,T,V),E[W]=T[0],E[W+1]=T[1];return E});return ct.forEach=I,ct}function Ht(){if(Nr)return q;function c(E){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(E)}Nr=1,Object.defineProperty(q,"__esModule",{value:!0}),q.vec4=q.vec3=q.vec2=q.quat2=q.quat=q.mat4=q.mat3=q.mat2d=q.mat2=q.glMatrix=void 0;var r=I(oe());q.glMatrix=r;var o=I(pe());q.mat2=o;var u=I(ce());q.mat2d=u;var m=I(Je());q.mat3=m;var h=I(Ct());q.mat4=h;var g=I(ht());q.quat=g;var b=I(tr());q.quat2=b;var M=I($t());q.vec2=M;var P=I(Xt());q.vec3=P;var v=I(Ze());function T(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,D=new WeakMap;return(T=function(O){return O?D:C})(E)}function I(E,C){if(E&&E.__esModule)return E;if(E===null||c(E)!=="object"&&typeof E!="function")return{default:E};var D=T(C);if(D&&D.has(E))return D.get(E);var O={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in E)if(V!=="default"&&Object.prototype.hasOwnProperty.call(E,V)){var W=F?Object.getOwnPropertyDescriptor(E,V):null;W&&(W.get||W.set)?Object.defineProperty(O,V,W):O[V]=E[V]}return O.default=E,D&&D.set(E,O),O}return q.vec4=v,q}var Bt,It,qt,Wt,be=Ht(),er=function(){if(It)return Bt;function c(r,o,u,m){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(m-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=u,this.p2y=m}return It=1,Bt=c,c.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,m=0;m<8;m++){var h=this.sampleCurveX(u)-r;if(Math.abs(h)<o)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=h/g}var b=0,M=1;for(u=r,m=0;m<20&&(h=this.sampleCurveX(u),!(Math.abs(h-r)<o));m++)r>h?b=u:M=u,u=.5*(M-b)+b;return u},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},Bt}(),cr=N(er);function pr(){if(Wt)return qt;function c(r,o){this.x=r,this.y=o}return Wt=1,qt=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,o){return this.clone()._rotateAround(r,o)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var o=r.x-this.x,u=r.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,o){return Math.atan2(this.x*o-this.y*r,this.x*r+this.y*o)},_matMult:function(r){var o=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=o,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var o=Math.cos(r),u=Math.sin(r),m=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=m,this},_rotateAround:function(r,o){var u=Math.cos(r),m=Math.sin(r),h=o.y+m*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-m*(this.y-o.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(r){return r instanceof c?r:Array.isArray(r)?new c(r[0],r[1]):r},qt}var lt=N(pr());function Lr(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let o=0;o<c.length;o++)if(!Lr(c[o],r[o]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const o in c)if(!Lr(c[o],r[o]))return!1;return!0}return c===r}const br=Math.PI/180,Kr=180/Math.PI;function sr(c){return c*br}function Hr(c){return c*Kr}const mn=[[0,0],[1,0],[1,1],[0,1]];function Er(c){if(c<=0)return 0;if(c>=1)return 1;const r=c*c,o=r*c;return 4*(c<.5?o:3*(c-r)+o-.75)}function Gi(c,r,o,u){const m=new cr(c,r,o,u);return function(h){return m.solve(h)}}const ai=Gi(.25,.1,.25,1);function hr(c,r,o){return Math.min(o,Math.max(r,c))}function Po(c,r,o){return(o=hr((o-c)/(r-c),0,1))*o*(3-2*o)}function ao(c,r,o){const u=o-r,m=((c-r)%u+u)%u+r;return m===r?o:m}function so(c,r,o){if(!c.length)return o(null,[]);let u=c.length;const m=new Array(c.length);let h=null;c.forEach((g,b)=>{r(g,(M,P)=>{M&&(h=M),m[b]=P,--u==0&&o(h,m)})})}function hi(c,...r){for(const o of r)for(const u in o)c[u]=o[u];return c}let wi=1;function kn(){return wi++}function aa(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function sa(c,r){c.forEach(o=>{r[o]&&(r[o]=r[o].bind(r))})}function la(c,r){return c.indexOf(r,c.length-r.length)!==-1}function kr(c,r,o){const u={};for(const m in c)u[m]=r.call(this,c[m],m,c);return u}function Mn(c,r,o){const u={};for(const m in c)r.call(this,c[m],m,c)&&(u[m]=c[m]);return u}function On(c){return Array.isArray(c)?c.map(On):typeof c=="object"&&c?kr(c,On):c}const ca={};function Gr(c){ca[c]||(typeof console<"u"&&console.warn(c),ca[c]=!0)}function Ka(c,r,o){return(o.y-c.y)*(r.x-c.x)>(r.y-c.y)*(o.x-c.x)}function Ad(c){let r=0;for(let o,u,m=0,h=c.length,g=h-1;m<h;g=m++)o=c[m],u=c[g],r+=(u.x-o.x)*(o.y+u.y);return r}function Go([c,r,o]){const u=sr(r+90),m=sr(o);return{x:c*Math.cos(u)*Math.sin(m),y:c*Math.sin(u)*Math.sin(m),z:c*Math.cos(m),azimuthal:r,polar:o}}function zl(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function th(c){const r={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,m,h)=>{const g=m||h;return r[u]=!g||g.toLowerCase(),""}),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r}let Sc,rh=null;function Fl(c,r){return[c[4*r],c[4*r+1],c[4*r+2],c[4*r+3]]}function Ke(c,r,o,u){for(;r<o;){const m=r+o>>1;c[m]<u?r=m+1:o=m}return r}function ee(c,r,o,u){for(;r<o;){const m=r+o>>1;c[m]<=u?r=m+1:o=m}return r}function ae(c){return c>0?1/(1.001-c):1+c}function Se(c){return c>0?1-1/(1.001-c):-c}const Re={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Sc==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Sc=i.API_URL_REGEX!=null?new RegExp(i.API_URL_REGEX):c}catch{Sc=c}}return Sc},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Re.API_URL)return null;try{const c=new URL(Re.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ae(c){return Re.API_URL_REGEX.test(c)}function Ue(c){return Re.API_SPRITE_REGEX.test(c)}let Ye,Ge,Xe,st,it,bt;function Ut(){return Ye==null&&(Ye=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ye}const jt={now:()=>st!==void 0?st:performance.now(),setNow(c){st=c},restoreNow(){st=void 0},frame(c){const r=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(c,r=0){const{width:o,height:u}=c;it||(it=document.createElement("canvas"));const m=it.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(o>it.width||u>it.height)&&(it.width=o,it.height=u),m.clearRect(-r,-r,o+2*r,u+2*r),m.drawImage(c,0,0,o,u),m.getImageData(-r,-r,o+2*r,u+2*r)},resolveURL:c=>(Ge||(Ge=document.createElement("a")),Ge.href=c,Ge.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xe==null&&(Xe=window.matchMedia("(prefers-reduced-motion: reduce)")),Xe.matches)},hasCanvasFingerprintNoise(){if(bt!==void 0)return bt;if(!Ut())return bt=!1,!1;const c=new OffscreenCanvas(85,1),r=c.getContext("2d",{willReadFrequently:!0});let o=0;for(let m=0;m<c.width;++m)r.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,r.fillRect(m,0,1,1);const u=r.getImageData(0,0,c.width,c.height);o=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&o++!==u.data[m])return bt=!0,!0;return bt=!1,!1}};function _r(c,r){const o=c.indexOf("?");if(o<0)return`${c}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(c.slice(o));for(const m in r)u.set(m,r[m]);return`${c.slice(0,o)}?${u.toString()}`}function vr(c,r={persistentParams:[]}){const o=c.indexOf("?");if(o<0)return c;const u=new URLSearchParams,m=new URLSearchParams(c.slice(o));for(const g of r.persistentParams){const b=m.get(g);b&&u.set(g,b)}const h=u.toString();return`${c.slice(0,o)}${h.length>0?`?${h}`:""}`}const wr="mapbox-tiles";let xr=500,cn=50;const gn=["language","worldview","jobid"];let Ir,fn;function Un(){try{return caches}catch{}}function yi(){const c=Un();c&&Ir==null&&(Ir=c.open(wr))}let Si=1/0;const Hi={supported:!1,testSupport:function(c){!Dd&&Ss&&(nh?Rd(c):Ca=c)}};let Ca,Ss,Dd=!1,nh=!1;const Tc=typeof self<"u"?self:{};function Rd(c){const r=c.createTexture();c.bindTexture(c.TEXTURE_2D,r);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Ss),c.isContextLost())return;Hi.supported=!0}catch{}c.deleteTexture(r),Dd=!0}Tc.document&&(Ss=Tc.document.createElement("img"),Ss.onload=function(){Ca&&Rd(Ca),Ca=null,nh=!0},Ss.onerror=function(){Dd=!0,Ca=null},Ss.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ec={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ec);class nm extends Error{constructor(r,o,u){o===401&&Ae(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const im=zl()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ih=function(c,r){if(!(/^file:/.test(o=c.url)||/^file:/.test(im())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){const h=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:im(),referrerPolicy:u.referrerPolicy,signal:h.signal});let b=!1,M=!1;const P=(v=g.url).indexOf("sku=")>0&&Ae(v);var v;u.type==="json"&&g.headers.set("Accept","application/json");const T=(E,C,D)=>{if(M)return;if(E&&E.message!=="SecurityError"&&Gr(E.toString()),C&&D)return I(C);const O=Date.now();fetch(g).then(F=>{if(F.ok){const V=P?F.clone():null;return I(F,V,O)}return m(new nm(F.statusText,F.status,u.url))}).catch(F=>{F.name!=="AbortError"&&m(new Error(`${F.message} ${u.url}`))})},I=(E,C,D)=>{(u.type==="arrayBuffer"?E.arrayBuffer():u.type==="json"?E.json():E.text()).then(O=>{M||(C&&D&&function(F,V,W){if(yi(),Ir==null)return;const B=th(V.headers.get("Cache-Control")||"");if(B["no-store"])return;const H={status:V.status,statusText:V.statusText,headers:new Headers};V.headers.forEach((de,me)=>H.headers.set(me,de)),B["max-age"]&&H.headers.set("Expires",new Date(W+1e3*B["max-age"]).toUTCString());const Z=H.headers.get("Expires");if(!Z||new Date(Z).getTime()-W<42e4)return;let re=vr(F.url,{persistentParams:gn});if(V.status===206){const de=F.headers.get("Range");if(!de)return;H.status=200,re=_r(re,{range:de})}(function(de,me){if(fn===void 0)try{new Response(new ReadableStream),fn=!0}catch{fn=!1}fn?me(de.body):de.blob().then(me)})(V,de=>{const me=new Response((ue=V.status)!==200&&ue!==404&&[101,103,204,205,304].includes(ue)?null:de,H);var ue;yi(),Ir!=null&&Ir.then(Te=>Te.put(re,me)).catch(Te=>Gr(Te.message))})}(g,C,D),b=!0,m(null,O,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(O=>{M||m(new Error(O.message))})};return P?function(E,C){if(yi(),Ir==null)return C(null);Ir.then(D=>{let O=vr(E.url,{persistentParams:gn});const F=E.headers.get("Range");F&&(O=_r(O,{range:F})),D.match(O).then(V=>{const W=function(B){if(!B)return!1;const H=new Date(B.headers.get("Expires")||0),Z=th(B.headers.get("Cache-Control")||"");return H>Date.now()&&!Z["no-cache"]}(V);D.delete(O),W&&D.put(O,V.clone()),C(null,V,W)}).catch(C)}).catch(C)}(g,T):T(null,null),{cancel:()=>{M=!0,b||h.abort()}}}(c,r);if(zl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,r,void 0,!0)}var o;return function(u,m){const h=new XMLHttpRequest;h.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const g in u.headers)h.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=u.credentials==="include",h.onerror=()=>{m(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let g=h.response;if(u.type==="json")try{g=JSON.parse(h.response)}catch(b){return m(b)}m(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else m(new nm(h.statusText,h.status,u.url))},h.send(u.body),{cancel:()=>h.abort()}}(c,r)},Mc=function(c,r){return ih(hi(c,{type:"arrayBuffer"}),r)};function ua(c){const r=document.createElement("a");return r.href=c,r.protocol===location.protocol&&r.host===location.host}const Ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pa,Ao;Pa=[],Ao=0;const Ja=function(c,r){if(Hi.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Ao>=Re.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Pa.push(h),h}Ao++;let o=!1;const u=()=>{if(!o)for(o=!0,Ao--;Pa.length&&Ao<Re.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Pa.shift(),{requestParameters:g,callback:b,cancelled:M}=h;M||(h.cancel=Ja(g,b).cancel)}},m=Mc(c,(h,g,b,M)=>{u(),h?r(h):g&&(self.createImageBitmap?function(P,v){const T=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(T).then(I=>{v(null,I)}).catch(I=>{v(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(P,v)=>r(P,v,b,M)):function(P,v){const T=new Image;T.onload=()=>{v(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Ia})},T.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(P)],{type:"image/png"});T.src=P.byteLength?URL.createObjectURL(I):Ia}(g,(P,v)=>r(P,v,b,M)))});return{cancel:()=>{m.cancel(),u()}}};var oh,om,am,Qa={exports:{}},kd={exports:{}},Oy={exports:{}},jb=function(){if(am)return Qa.exports;am=1;var c=(oh||(oh=1,kd.exports=function(o,u){var m,h,g,b,M,P,v,T;for(h=o.length-(m=3&o.length),g=u,M=3432918353,P=461845907,T=0;T<h;)v=255&o.charCodeAt(T)|(255&o.charCodeAt(++T))<<8|(255&o.charCodeAt(++T))<<16|(255&o.charCodeAt(++T))<<24,++T,g=27492+(65535&(b=5*(65535&(g=(g^=v=(65535&(v=(v=(65535&v)*M+(((v>>>16)*M&65535)<<16)&4294967295)<<15|v>>>17))*P+(((v>>>16)*P&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(v=0,m){case 3:v^=(255&o.charCodeAt(T+2))<<16;case 2:v^=(255&o.charCodeAt(T+1))<<8;case 1:g^=v=(65535&(v=(v=(65535&(v^=255&o.charCodeAt(T)))*M+(((v>>>16)*M&65535)<<16)&4294967295)<<15|v>>>17))*P+(((v>>>16)*P&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),kd.exports),r=(om||(om=1,Oy.exports=function(o,u){for(var m,h=o.length,g=u^h,b=0;h>=4;)m=1540483477*(65535&(m=255&o.charCodeAt(b)|(255&o.charCodeAt(++b))<<8|(255&o.charCodeAt(++b))<<16|(255&o.charCodeAt(++b))<<24))+((1540483477*(m>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),h-=4,++b;switch(h){case 3:g^=(255&o.charCodeAt(b+2))<<16;case 2:g^=(255&o.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Oy.exports);return Qa.exports=c,Qa.exports.murmur3=c,Qa.exports.murmur2=r,Qa.exports}(),Do=N(jb);class el{constructor(r,...o){hi(this,o[0]||{}),this.type=r}}class ah extends el{constructor(r,o={}){super("error",hi({error:r},o))}}function Cc(c,r,o){o[c]&&o[c].indexOf(r)!==-1||(o[c]=o[c]||[],o[c].push(r))}function sm(c,r,o){if(o&&o[c]){const u=o[c].indexOf(r);u!==-1&&o[c].splice(u,1)}}class Ic{on(r,o){return this._listeners=this._listeners||{},Cc(r,o,this._listeners),this}off(r,o){return sm(r,o,this._listeners),sm(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Cc(r,o,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,o){const u=typeof r=="string"?new el(r,o):r,m=u.type;if(this.listens(m)){u.target=this;const h=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of h)M.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of g)sm(m,M,this._oneTimeListeners),M.call(this,u);const b=this._eventedParent;b&&(hi(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof ah&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}var lm,Qr={},cm=function(){if(lm)return Qr;lm=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(h){return(h=Math.round(h))<0?0:h>255?255:h}function o(h){return r(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function u(h){return(g=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:g>1?1:g;var g}function m(h,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?h+(g-h)*b*6:2*b<1?g:3*b<2?h+(g-h)*(2/3-b)*6:h}try{Qr.parseCSSColor=function(h){var g,b=h.replace(/ /g,"").toLowerCase();if(b in c)return c[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var M=b.indexOf("("),P=b.indexOf(")");if(M!==-1&&P+1===b.length){var v=b.substr(0,M),T=b.substr(M+1,P-(M+1)).split(","),I=1;switch(v){case"rgba":if(T.length!==4)return null;I=u(T.pop());case"rgb":return T.length!==3?null:[o(T[0]),o(T[1]),o(T[2]),I];case"hsla":if(T.length!==4)return null;I=u(T.pop());case"hsl":if(T.length!==3)return null;var E=(parseFloat(T[0])%360+360)%360/360,C=u(T[1]),D=u(T[2]),O=D<=.5?D*(C+1):D+C-D*C,F=2*D-O;return[r(255*m(F,O,E+1/3)),r(255*m(F,O,E)),r(255*m(F,O,E-1/3)),I];default:return null}}return null}}catch{}return Qr}();class un{constructor(r,o,u,m=1){this.r=r,this.g=o,this.b=u,this.a=m}static parse(r){if(!r)return;if(r instanceof un)return r;if(typeof r!="string")return;const o=cm.parseCSSColor(r);return o?new un(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[r,o,u,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(r)},${Math.round(o)},${Math.round(u)},${m})`}toRenderColor(r){const{r:o,g:u,b:m,a:h}=this;return new Vb(r,o,u,m,h)}}class Vb{constructor(r,o,u,m,h){if(r){const g=r.image.height,b=g*g;o=h===0?0:o/h*(g-1),u=h===0?0:u/h*(g-1),m=h===0?0:m/h*(g-1);const M=Math.floor(o),P=Math.floor(u),v=Math.floor(m),T=Math.ceil(o),I=Math.ceil(u),E=Math.ceil(m),C=o-M,D=u-P,O=m-v,F=r.image.data,V=4*(M+P*b+v*g),W=4*(M+P*b+E*g),B=4*(M+I*b+v*g),H=4*(M+I*b+E*g),Z=4*(T+P*b+v*g),re=4*(T+P*b+E*g),de=4*(T+I*b+v*g),me=4*(T+I*b+E*g);if(V<0||me>=F.length)throw new Error("out of range");this.r=ur(ur(ur(F[V],F[W],O),ur(F[B],F[H],O),D),ur(ur(F[Z],F[re],O),ur(F[de],F[me],O),D),C)/255*h,this.g=ur(ur(ur(F[V+1],F[W+1],O),ur(F[B+1],F[H+1],O),D),ur(ur(F[Z+1],F[re+1],O),ur(F[de+1],F[me+1],O),D),C)/255*h,this.b=ur(ur(ur(F[V+2],F[W+2],O),ur(F[B+2],F[H+2],O),D),ur(ur(F[Z+2],F[re+2],O),ur(F[de+2],F[me+2],O),D),C)/255*h,this.a=h}else this.r=o,this.g=u,this.b=m,this.a=h}toArray(){const{r,g:o,b:u,a:m}=this;return m===0?[0,0,0,0]:[255*r/m,255*o/m,255*u/m,m]}toArray01(){const{r,g:o,b:u,a:m}=this;return m===0?[0,0,0,0]:[r/m,o/m,u/m,m]}toArray01Scaled(r){const{r:o,g:u,b:m,a:h}=this;return h===0?[0,0,0]:[o/h*r,u/h*r,m/h*r]}toArray01PremultipliedAlpha(){const{r,g:o,b:u,a:m}=this;return[r,o,u,m]}toArray01Linear(){const{r,g:o,b:u,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(r/m,2.2),Math.pow(o/m,2.2),Math.pow(u/m,2.2),m]}}function ur(c,r,o){return c*(1-o)+r*o}function sh(c,r,o){return c.map((u,m)=>ur(u,r[m],o))}un.black=new un(0,0,0,1),un.white=new un(1,1,1,1),un.transparent=new un(0,0,0,0),un.red=new un(1,0,0,1),un.blue=new un(0,0,1,1);var Bl=Object.freeze({__proto__:null,array:sh,color:function(c,r,o){return new un(ur(c.r,r.r,o),ur(c.g,r.g,o),ur(c.b,r.b,o),ur(c.a,r.a,o))},number:ur});function Pc(c,...r){for(const o of r)for(const u in o)c[u]=o[u];return c}class es extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}class Od{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[u,m]of o)this.bindings[u]=m}concat(r){return new Od(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Aa={kind:"null"},Yt={kind:"number"},qr={kind:"string"},Zr={kind:"boolean"},Ro={kind:"color"},lo={kind:"object"},Jr={kind:"value"},Ld={kind:"collator"},Ac={kind:"formatted"},Dc={kind:"resolvedImage"};function _o(c,r){return{kind:"array",itemType:c,N:r}}function ei(c){if(c.kind==="array"){const r=ei(c.itemType);return typeof c.N=="number"?`array<${r}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${r}>`}return c.kind}const Ly=[Aa,Yt,qr,Zr,Ro,Ac,lo,_o(Jr),Dc];function Rc(c,r){if(r.kind==="error")return null;if(c.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Rc(c.itemType,r.itemType))&&(typeof c.N!="number"||c.N===r.N))return null}else{if(c.kind===r.kind)return null;if(c.kind==="value"){for(const o of Ly)if(!Rc(o,r))return null}}return`Expected ${ei(c)} but found ${ei(r)} instead.`}function kc(c,r){return r.some(o=>o.kind===c.kind)}function ts(c,r){return r.some(o=>o==="null"?c===null:o==="array"?Array.isArray(c):o==="object"?c&&!Array.isArray(c)&&typeof c=="object":o===typeof c)}class zd{constructor(r,o,u){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ho{constructor(r,o,u,m,h){this.text=r.normalize?r.normalize():r,this.image=o,this.scale=u,this.fontStack=m,this.textColor=h}}class co{constructor(r){this.sections=r}static fromString(r){return new co([new Ho(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.namePrimary.length!==0)}static factory(r){return r instanceof co?r:co.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const o of this.sections){if(o.image){r.push(["image",o.image.namePrimary]);continue}r.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),r.push(u)}return r}}class yo{constructor(r){this.namePrimary=r.namePrimary,r.nameSecondary&&(this.nameSecondary=r.nameSecondary),this.available=r.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(r,o){return r?new yo({namePrimary:r,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function zy(c,r,o,u){return typeof c=="number"&&c>=0&&c<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,r,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,r,o,u]:[c,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function tl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof un||c instanceof zd||c instanceof co||c instanceof yo)return!0;if(Array.isArray(c)){for(const r of c)if(!tl(r))return!1;return!0}if(typeof c=="object"){for(const r in c)if(!tl(c[r]))return!1;return!0}return!1}function di(c){if(c===null)return Aa;if(typeof c=="string")return qr;if(typeof c=="boolean")return Zr;if(typeof c=="number")return Yt;if(c instanceof un)return Ro;if(c instanceof zd)return Ld;if(c instanceof co)return Ac;if(c instanceof yo)return Dc;if(Array.isArray(c)){const r=c.length;let o;for(const u of c){const m=di(u);if(o){if(o===m)continue;o=Jr;break}o=m}return _o(o||Jr,r)}return lo}function vo(c){const r=typeof c;return c===null?"":r==="string"||r==="number"||r==="boolean"?String(c):c instanceof un||c instanceof co||c instanceof yo?c.toString():JSON.stringify(c)}class Da{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!tl(r[1]))return o.error("invalid value");const u=r[1];let m=di(u);const h=o.expectedType;return m.kind!=="array"||m.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(m=h),new Da(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof un?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof co?this.value.serialize():this.value}}class ki{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const um={string:qr,number:Yt,boolean:Zr,object:lo};class Ra{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let u,m=1;const h=r[0];if(h==="array"){let b,M;if(r.length>2){const P=r[1];if(typeof P!="string"||!(P in um)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=um[P],m++}else b=Jr;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);M=r[2],m++}u=_o(b,M)}else u=um[h];const g=[];for(;m<r.length;m++){const b=o.parse(r[m],m,Jr);if(!b)return null;g.push(b)}return new Ra(u,g)}evaluate(r){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(r);if(!Rc(this.type,di(u)))return u;if(o===this.args.length-1)throw new ki(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${ei(di(u))} but was expected to be of type ${ei(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,o=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&o.push(m)}}return o.concat(this.args.map(u=>u.serialize()))}}class Oc{constructor(r){this.type=Ac,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const m=[];let h=!1;for(let g=1;g<=r.length-1;++g){const b=r[g];if(h&&typeof b=="object"&&!Array.isArray(b)){h=!1;let M=null;if(b["font-scale"]&&(M=o.parseObjectValue(b["font-scale"],g,"font-scale",Yt),!M))return null;let P=null;if(b["text-font"]&&(P=o.parseObjectValue(b["text-font"],g,"text-font",_o(qr)),!P))return null;let v=null;if(b["text-color"]&&(v=o.parseObjectValue(b["text-color"],g,"text-color",Ro),!v))return null;const T=m[m.length-1];T.scale=M,T.font=P,T.textColor=v}else{const M=o.parse(r[g],g,Jr);if(!M)return null;const P=M.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,m.push({content:M,scale:null,font:null,textColor:null})}}return new Oc(m)}evaluate(r){return new co(this.sections.map(o=>{const u=o.content.evaluate(r);return di(u)===Dc?new Ho("",u,null,null,null):new Ho(vo(u),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null)}))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const o of this.sections){r.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),r.push(u)}return r}}class Nl{constructor(r,o){this.type=Dc,this.inputPrimary=r,this.inputSecondary=o}static parse(r,o){if(r.length<2)return o.error("Expected two or more arguments.");const u=o.parse(r[1],1,qr);if(!u)return o.error("No image name provided.");if(r.length===2)return new Nl(u);const m=o.parse(r[2],1,qr);return m?new Nl(u,m):o.error("Secondary image variant is not a string.")}evaluate(r){const o=yo.fromString(this.inputPrimary.evaluate(r),this.inputSecondary?this.inputSecondary.evaluate(r):void 0);return o&&r.availableImages&&(o.available=r.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&r.availableImages&&(o.available=r.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(r){r(this.inputPrimary),this.inputSecondary&&r(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ul(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const Fd={"to-boolean":Zr,"to-color":Ro,"to-number":Yt,"to-string":qr};class Ts{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[0],m=[];let h=Aa;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const g=r[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);h=_o(o.expectedType.itemType,g)}else{if(!(g>0&&tl(r[1][0])))return null;h=_o(di(r[1][0]),g)}for(let b=0;b<g;b++){const M=r[1][b];let P;if(Ul(M)==="array")P=o.parse(M,void 0,h.itemType);else{const v=Ul(M);if(v!==h.itemType.kind)return o.error(`Expected ${h.itemType.kind} but found ${v}.`);P=o.registry.literal.parse(["literal",M===void 0?null:M],o)}if(!P)return null;m.push(P)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return o.error("Expected one argument.");h=Fd[u];for(let g=1;g<r.length;g++){const b=o.parse(r[g],g,Jr);if(!b)return null;m.push(b)}}return new Ts(h,m)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let o,u;for(const m of this.args){if(o=m.evaluate(r),u=null,o instanceof un)return o;if(typeof o=="string"){const h=r.parseColor(o);if(h)return h}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:zy(o[0],o[1],o[2],o[3]),!u))return new un(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ki(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(r),o===null)return 0;const m=Number(o);if(!isNaN(m))return m}throw new ki(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?co.fromString(vo(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?yo.fromString(vo(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(o=>o.evaluate(r)):vo(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Oc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Nl(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{r.push(o.serialize())}),r}}const $b=["Unknown","Point","LineString","Polygon"];class Fy{constructor(r,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$b[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-r[0])+this.featureDistanceData.bearing[1]*(m*o-r[1])}return 0}parseColor(r){let o=this._parseColorCache[r];return o||(o=this._parseColorCache[r]=un.parse(r)),o}getConfig(r){return this.options?this.options.get(r):null}}class ko{constructor(r,o,u,m,h){this.name=r,this.type=o,this._evaluate=u,this.args=m,this._overloadIndex=h}evaluate(r){if(!this._evaluate){const o=ko.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,o){const u=r[0],m=ko.definitions[u];if(!m)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,b=[];let M=null,P=-1;for(const[v,T]of g){if(Array.isArray(v)&&v.length!==r.length-1)continue;b.push(v),P++,M=new Yy(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const I=[];let E=!1;for(let C=1;C<r.length;C++){const D=r[C],O=Array.isArray(v)?v[C-1]:v.type,F=M.parse(D,1+I.length,O);if(!F){E=!0;break}I.push(F)}if(!E)if(Array.isArray(v)&&v.length!==I.length)M.error(`Expected ${v.length} arguments, but found ${I.length} instead.`);else{for(let C=0;C<I.length;C++){const D=Array.isArray(v)?v[C]:v.type,O=I[C];M.concat(C+1).checkSubtype(D,O.type)}if(M.errors.length===0)return new ko(u,h,T,I,P)}}if(b.length===1)o.errors.push(...M.errors);else{const v=(b.length?b:g.map(([I])=>I)).map(Wb).join(" | "),T=[];for(let I=1;I<r.length;I++){const E=o.parse(r[I],1+T.length);if(!E)return null;T.push(ei(E.type))}o.error(`Expected arguments of type ${v}, but found (${T.join(", ")}) instead.`)}return null}static register(r,o){ko.definitions=o;for(const u in o)r[u]=ko}}function Wb(c){return Array.isArray(c)?`(${c.map(ei).join(", ")})`:`(${ei(c.type)}...)`}class Bd{constructor(r,o,u){this.type=Ld,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const m=u["case-sensitive"]===void 0?o.parse(!1,1,Zr):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Zr);if(!m)return null;const h=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Zr):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Zr);if(!h)return null;let g=null;return u.locale&&(g=o.parseObjectValue(u.locale,1,"locale",qr),!g)?null:new Bd(m,h,g)}evaluate(r){return new zd(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function By(c,r,o=0,u=c.length-1,m=zc){for(;u>o;){if(u-o>600){const M=u-o+1,P=r-o+1,v=Math.log(M),T=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*T*(M-T)/M)*(P-M/2<0?-1:1);By(c,r,Math.max(o,Math.floor(r-P*T/M+I)),Math.min(u,Math.floor(r+(M-P)*T/M+I)),m)}const h=c[r];let g=o,b=u;for(Lc(c,o,r),m(c[u],h)>0&&Lc(c,o,u);g<b;){for(Lc(c,g,b),g++,b--;m(c[g],h)<0;)g++;for(;m(c[b],h)>0;)b--}m(c[o],h)===0?Lc(c,o,b):(b++,Lc(c,b,u)),b<=r&&(o=b+1),r<=b&&(u=b-1)}}function Lc(c,r,o){const u=c[r];c[r]=c[o],c[o]=u}function zc(c,r){return c<r?-1:c>r?1:0}function Gb(c){let r=0;for(let o,u,m=0,h=c.length,g=h-1;m<h;g=m++)o=c[m],u=c[g],r+=(u.x-o.x)*(o.y+u.y);return r}function lh(c,r){c[0]=Math.min(c[0],r[0]),c[1]=Math.min(c[1],r[1]),c[2]=Math.max(c[2],r[0]),c[3]=Math.max(c[3],r[1])}function jl(c,r){return!(c[0]<=r[0]||c[2]>=r[2]||c[1]<=r[1]||c[3]>=r[3])}function Hb(c,r,o){const u=c[0]-r[0],m=c[1]-r[1],h=c[0]-o[0],g=c[1]-o[1];return u*g-h*m==0&&u*h<=0&&m*g<=0}function Fc(c,r,o=!1){let u=!1;for(let b=0,M=r.length;b<M;b++){const P=r[b];for(let v=0,T=P.length,I=T-1;v<T;I=v++){const E=P[I],C=P[v];if(Hb(c,E,C))return o;(h=E)[1]>(m=c)[1]!=(g=C)[1]>m[1]&&m[0]<(g[0]-h[0])*(m[1]-h[1])/(g[1]-h[1])+h[0]&&(u=!u)}}var m,h,g;return u}function Ny(c,r,o,u){const m=u[0]-o[0],h=u[1]-o[1],g=(c[0]-o[0])*h-m*(c[1]-o[1]),b=(r[0]-o[0])*h-m*(r[1]-o[1]);return g>0&&b<0||g<0&&b>0}function Nd(c,r,o,u){return(m=[u[0]-o[0],u[1]-o[1]])[0]*(h=[r[0]-c[0],r[1]-c[1]])[1]-m[1]*h[0]!=0&&!(!Ny(c,r,o,u)||!Ny(o,u,c,r));var m,h}const qo=8192;function Ur(c,r){const o=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(o*m*qo),Math.round(u*m*qo)]}function ar(c,r){for(let o=0;o<r.length;o++)if(Fc(c,r[o]))return!0;return!1}function hm(c,r,o){for(const u of o)for(let m=0,h=u.length,g=h-1;m<h;g=m++)if(Nd(c,r,u[g],u[m]))return!0;return!1}function Tr(c,r){for(let o=0;o<c.length;++o)if(!Fc(c[o],r))return!1;for(let o=0;o<c.length-1;++o)if(hm(c[o],c[o+1],r))return!1;return!0}function dm(c,r){for(let o=0;o<r.length;o++)if(Tr(c,r[o]))return!0;return!1}function ch(c,r,o){const u=[];for(let m=0;m<c.length;m++){const h=[];for(let g=0;g<c[m].length;g++){const b=Ur(c[m][g],o);lh(r,b),h.push(b)}u.push(h)}return u}function mr(c,r,o){const u=[];for(let m=0;m<c.length;m++){const h=ch(c[m],r,o);u.push(h)}return u}function fm(c,r,o,u){if(c[0]<o[0]||c[0]>o[2]){const m=.5*u;let h=c[0]-o[0]>m?-u:o[0]-c[0]>m?u:0;h===0&&(h=c[0]-o[2]>m?-u:o[2]-c[0]>m?u:0),c[0]+=h}lh(r,c)}function Ud(c,r,o,u){const m=Math.pow(2,u.z)*qo,h=[u.x*qo,u.y*qo],g=[];if(!c)return g;for(const b of c)for(const M of b){const P=[M.x+h[0],M.y+h[1]];fm(P,r,o,m),g.push(P)}return g}function pm(c,r,o,u){const m=Math.pow(2,u.z)*qo,h=[u.x*qo,u.y*qo],g=[];if(!c)return g;for(const M of c){const P=[];for(const v of M){const T=[v.x+h[0],v.y+h[1]];lh(r,T),P.push(T)}g.push(P)}if(r[2]-r[0]<=m/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const M of g)for(const P of M)fm(P,r,o,m)}var b;return g}class rl{constructor(r,o){this.type=Zr,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(tl(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const h=u.features[m].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new rl(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new rl(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new rl(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(o,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=ch(u.coordinates,h,g),M=Ud(o.geometry(),m,h,g);if(!jl(m,h))return!1;for(const P of M)if(!Fc(P,b))return!1}if(u.type==="MultiPolygon"){const b=mr(u.coordinates,h,g),M=Ud(o.geometry(),m,h,g);if(!jl(m,h))return!1;for(const P of M)if(!ar(P,b))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(o,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=ch(u.coordinates,h,g),M=pm(o.geometry(),m,h,g);if(!jl(m,h))return!1;for(const P of M)if(!Tr(P,b))return!1}if(u.type==="MultiPolygon"){const b=mr(u.coordinates,h,g),M=pm(o.geometry(),m,h,g);if(!jl(m,h))return!1;for(const P of M)if(!dm(P,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Vl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},to=1/298.257223563,jd=to*(2-to),Bc=Math.PI/180;class Nc{static fromTile(r,o,u){const m=Math.PI*(1-2*(r+.5)/Math.pow(2,o)),h=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/Bc;return new Nc(h,u)}static get units(){return Vl}constructor(r,o){if(r===void 0)throw new Error("No latitude given.");if(o&&!Vl[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Vl).join(", ")}`);const u=6378.137*Bc*(o?Vl[o]:1),m=Math.cos(r*Bc),h=1/(1-jd*(1-m*m)),g=Math.sqrt(h);this.kx=u*g*m,this.ky=u*g*h*(1-jd)}distance(r,o){const u=Vn(r[0]-o[0])*this.kx,m=(r[1]-o[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(r,o){const u=Vn(o[0]-r[0])*this.kx;return Math.atan2(u,(o[1]-r[1])*this.ky)/Bc}destination(r,o,u){const m=u*Bc;return this.offset(r,Math.sin(m)*o,Math.cos(m)*o)}offset(r,o,u){return[r[0]+o/this.kx,r[1]+u/this.ky]}lineDistance(r){let o=0;for(let u=0;u<r.length-1;u++)o+=this.distance(r[u],r[u+1]);return o}area(r){let o=0;for(let u=0;u<r.length;u++){const m=r[u];for(let h=0,g=m.length,b=g-1;h<g;b=h++)o+=Vn(m[h][0]-m[b][0])*(m[h][1]+m[b][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(r,o){let u=0;if(o<=0)return r[0];for(let m=0;m<r.length-1;m++){const h=r[m],g=r[m+1],b=this.distance(h,g);if(u+=b,u>o)return Es(h,g,(o-(u-b))/b)}return r[r.length-1]}pointToSegmentDistance(r,o,u){let[m,h]=o,g=Vn(u[0]-m)*this.kx,b=(u[1]-h)*this.ky;if(g!==0||b!==0){const M=(Vn(r[0]-m)*this.kx*g+(r[1]-h)*this.ky*b)/(g*g+b*b);M>1?(m=u[0],h=u[1]):M>0&&(m+=g/this.kx*M,h+=b/this.ky*M)}return g=Vn(r[0]-m)*this.kx,b=(r[1]-h)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(r,o){let u=1/0,m=r[0][0],h=r[0][1],g=0,b=0;for(let M=0;M<r.length-1;M++){let P=r[M][0],v=r[M][1],T=Vn(r[M+1][0]-P)*this.kx,I=(r[M+1][1]-v)*this.ky,E=0;T===0&&I===0||(E=(Vn(o[0]-P)*this.kx*T+(o[1]-v)*this.ky*I)/(T*T+I*I),E>1?(P=r[M+1][0],v=r[M+1][1]):E>0&&(P+=T/this.kx*E,v+=I/this.ky*E)),T=Vn(o[0]-P)*this.kx,I=(o[1]-v)*this.ky;const C=T*T+I*I;C<u&&(u=C,m=P,h=v,g=M,b=E)}return{point:[m,h],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(r,o,u){let m=this.pointOnLine(u,r),h=this.pointOnLine(u,o);if(m.index>h.index||m.index===h.index&&m.t>h.t){const P=m;m=h,h=P}const g=[m.point],b=m.index+1,M=h.index;!Vd(u[b],g[0])&&b<=M&&g.push(u[b]);for(let P=b+1;P<=M;P++)g.push(u[P]);return Vd(u[M],h.point)||g.push(h.point),g}lineSliceAlong(r,o,u){let m=0;const h=[];for(let g=0;g<u.length-1;g++){const b=u[g],M=u[g+1],P=this.distance(b,M);if(m+=P,m>r&&h.length===0&&h.push(Es(b,M,(r-(m-P))/P)),m>=o)return h.push(Es(b,M,(o-(m-P))/P)),h;m>r&&h.push(M)}return h}bufferPoint(r,o){const u=o/this.ky,m=o/this.kx;return[r[0]-m,r[1]-u,r[0]+m,r[1]+u]}bufferBBox(r,o){const u=o/this.ky,m=o/this.kx;return[r[0]-m,r[1]-u,r[2]+m,r[3]+u]}insideBBox(r,o){return Vn(r[0]-o[0])>=0&&Vn(r[0]-o[2])<=0&&r[1]>=o[1]&&r[1]<=o[3]}}function Vd(c,r){return c[0]===r[0]&&c[1]===r[1]}function Es(c,r,o){const u=Vn(r[0]-c[0]);return[c[0]+u*o,c[1]+(r[1]-c[1])*o]}function Vn(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class mm{constructor(r=[],o=(u,m)=>u<m?-1:u>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:u}=this,m=o[r];for(;r>0;){const h=r-1>>1,g=o[h];if(u(m,g)>=0)break;o[r]=g,r=h}o[r]=m}_down(r){const{data:o,compare:u}=this,m=this.length>>1,h=o[r];for(;r<m;){let g=1+(r<<1);const b=g+1;if(b<this.length&&u(o[b],o[g])<0&&(g=b),u(o[g],h)>=0)break;o[r]=o[g],r=g}o[r]=h}}var zt=8192;function Uy(c,r){return r.dist-c.dist}const Uc=100,$d=50;function Wd(c){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==c.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==c[o])return!1;return!0}function Gd(c){return c[1]-c[0]+1}function Ms(c,r){const o=c[1]>=c[0]&&c[1]<r;return o||console.warn("Distance Expression: Index is out of range"),o}function gm(c,r){if(c[0]>c[1])return[null,null];const o=Gd(c);if(r){if(o===2)return[c,null];const u=Math.floor(o/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(o===1)return[c,null];const u=Math.floor(o/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Zo(c,r){const o=[1/0,1/0,-1/0,-1/0];if(!Ms(r,c.length))return o;for(let u=r[0];u<=r[1];++u)lh(o,c[u]);return o}function Hd(c){const r=[1/0,1/0,-1/0,-1/0];for(let o=0;o<c.length;++o)for(let u=0;u<c[o].length;++u)lh(r,c[o][u]);return r}function jc(c,r,o){if(Wd(c)||Wd(r))return NaN;let u=0,m=0;return c[2]<r[0]&&(u=r[0]-c[2]),c[0]>r[2]&&(u=c[0]-r[2]),c[1]>r[3]&&(m=c[1]-r[3]),c[3]<r[1]&&(m=r[1]-c[3]),o.distance([0,0],[u,m])}function jy(c){return 360*c-180}function Vy(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Yo(c,r){const o=Math.pow(2,r.z),u=(c.y/zt+r.y)/o;return[jy((c.x/zt+r.x)/o),Vy(u)]}function $y(c,r){const o=[];for(let u=0;u<c.length;++u)o.push(Yo(c[u],r));return o}function _m(c,r,o){const u=o.pointOnLine(r,c).point;return o.distance(c,u)}function ym(c,r,o,u,m){const h=o.slice(u[0],u[1]+1);let g=1/0;for(let b=r[0];b<=r[1];++b)if((g=Math.min(g,_m(c[b],h,m)))===0)return 0;return g}function qd(c,r,o,u,m){const h=Math.min(m.pointToSegmentDistance(c,o,u),m.pointToSegmentDistance(r,o,u)),g=Math.min(m.pointToSegmentDistance(o,c,r),m.pointToSegmentDistance(u,c,r));return Math.min(h,g)}function Wy(c,r,o,u,m){if(!Ms(r,c.length)||!Ms(u,o.length))return NaN;let h=1/0;for(let g=r[0];g<r[1];++g)for(let b=u[0];b<u[1];++b){if(Nd(c[g],c[g+1],o[b],o[b+1]))return 0;h=Math.min(h,qd(c[g],c[g+1],o[b],o[b+1],m))}return h}function Gy(c,r,o,u,m){if(!Ms(r,c.length)||!Ms(u,o.length))return NaN;let h=1/0;for(let g=r[0];g<=r[1];++g)for(let b=u[0];b<=u[1];++b)if((h=Math.min(h,m.distance(c[g],o[b])))===0)return h;return h}function Hy(c,r,o){if(Fc(c,r,!0))return 0;let u=1/0;for(const m of r){const h=m.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[h-1]&&(u=Math.min(u,o.pointToSegmentDistance(c,m[h-1],m[0])))===0||(u=Math.min(u,_m(c,m,o)))===0)return u}return u}function qy(c,r,o,u){if(!Ms(r,c.length))return NaN;for(let h=r[0];h<=r[1];++h)if(Fc(c[h],o,!0))return 0;let m=1/0;for(let h=r[0];h<r[1];++h)for(const g of o)for(let b=0,M=g.length,P=M-1;b<M;P=b++){if(Nd(c[h],c[h+1],g[P],g[b]))return 0;m=Math.min(m,qd(c[h],c[h+1],g[P],g[b],u))}return m}function vm(c,r){for(const o of c)for(let u=0;u<=o.length-1;++u)if(Fc(o[u],r,!0))return!0;return!1}function Zy(c,r,o,u=1/0){const m=Hd(c),h=Hd(r);if(u!==1/0&&jc(m,h,o)>=u)return u;if(jl(m,h)){if(vm(c,r))return 0}else if(vm(r,c))return 0;let g=u;for(const b of c)for(let M=0,P=b.length,v=P-1;M<P;v=M++)for(const T of r)for(let I=0,E=T.length,C=E-1;I<E;C=I++){if(Nd(b[v],b[M],T[C],T[I]))return 0;g=Math.min(g,qd(b[v],b[M],T[C],T[I],o))}return g}function uh(c,r,o,u,m,h,g){if(h===null||g===null)return;const b=jc(Zo(u,h),Zo(m,g),o);b<r&&c.push({dist:b,range1:h,range2:g})}function Zd(c,r,o,u,m=1/0){let h=Math.min(u.distance(c[0],o[0][0]),m);if(h===0)return h;const g=new mm([{dist:0,range1:[0,c.length-1],range2:[0,0]}],Uy),b=r?$d:Uc,M=Hd(o);for(;g.length;){const P=g.pop();if(P.dist>=h)continue;const v=P.range1;if(Gd(v)<=b){if(!Ms(v,c.length))return NaN;if(r){const T=qy(c,v,o,u);if((h=Math.min(h,T))===0)return h}else for(let T=v[0];T<=v[1];++T){const I=Hy(c[T],o,u);if((h=Math.min(h,I))===0)return h}}else{const T=gm(v,r);if(T[0]!==null){const I=jc(Zo(c,T[0]),M,u);I<h&&g.push({dist:I,range1:T[0],range2:[0,0]})}if(T[1]!==null){const I=jc(Zo(c,T[1]),M,u);I<h&&g.push({dist:I,range1:T[1],range2:[0,0]})}}}return h}function hh(c,r,o,u,m,h=1/0){let g=Math.min(h,m.distance(c[0],o[0]));if(g===0)return g;const b=new mm([{dist:0,range1:[0,c.length-1],range2:[0,o.length-1]}],Uy),M=r?$d:Uc,P=u?$d:Uc;for(;b.length;){const v=b.pop();if(v.dist>=g)continue;const T=v.range1,I=v.range2;if(Gd(T)<=M&&Gd(I)<=P){if(!Ms(T,c.length)||!Ms(I,o.length))return NaN;if(r&&u?g=Math.min(g,Wy(c,T,o,I,m)):r||u?r&&!u?g=Math.min(g,ym(o,I,c,T,m)):!r&&u&&(g=Math.min(g,ym(c,T,o,I,m))):g=Math.min(g,Gy(c,T,o,I,m)),g===0)return g}else{const E=gm(T,r),C=gm(I,u);uh(b,g,m,c,o,E[0],C[0]),uh(b,g,m,c,o,E[0],C[1]),uh(b,g,m,c,o,E[1],C[0]),uh(b,g,m,c,o,E[1],C[1])}}return g}function Vc(c,r,o,u,m=1/0){let h=m;const g=Zo(c,[0,c.length-1]);for(const b of o)if(!(h!==1/0&&jc(g,Zo(b,[0,b.length-1]),u)>=h)&&(h=Math.min(h,hh(c,r,b,!0,u,h)),h===0))return h;return h}function dh(c,r,o,u,m=1/0){let h=m;const g=Zo(c,[0,c.length-1]);for(const b of o){if(h!==1/0&&jc(g,Hd(b),u)>=h)continue;const M=Zd(c,r,b,u,h);if(isNaN(M))return M;if((h=Math.min(h,M))===0)return h}return h}function Yd(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class nl{constructor(r,o){this.type=Yt,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(tl(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let m=0;m<u.features.length;++m)if(Yd(u.features[m].geometry.type))return new nl(u,u.features[m].geometry)}else if(u.type==="Feature"){if(Yd(u.geometry.type))return new nl(u,u.geometry)}else if(Yd(u.type))return new nl(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const o=r.geometry(),u=r.canonicalID();if(o!=null&&u!=null){if(r.geometryType()==="Point")return function(m,h,g){const b=[];for(const P of m)for(const v of P)b.push(Yo(v,h));const M=new Nc(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?hh(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",M):g.type==="MultiLineString"?Vc(b,!1,g.coordinates,M):g.type==="Polygon"||g.type==="MultiPolygon"?dh(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,M):null}(o,u,this.geometries);if(r.geometryType()==="LineString")return function(m,h,g){const b=[];for(const P of m){const v=[];for(const T of P)v.push(Yo(T,h));b.push(v)}const M=new Nc(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Vc(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,M);if(g.type==="MultiLineString"){let P=1/0;for(let v=0;v<g.coordinates.length;v++){const T=Vc(g.coordinates[v],!0,b,M,P);if(isNaN(T))return T;if((P=Math.min(P,T))===0)return P}return P}if(g.type==="Polygon"||g.type==="MultiPolygon"){let P=1/0;for(let v=0;v<b.length;v++){const T=dh(b[v],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,M,P);if(isNaN(T))return T;if((P=Math.min(P,T))===0)return P}return P}return null}(o,u,this.geometries);if(r.geometryType()==="Polygon")return function(m,h,g){const b=[];for(const P of function(v,T){const I=v.length;if(I<=1)return[v];const E=[];let C,D;for(let O=0;O<I;O++){const F=Gb(v[O]);F!==0&&(v[O].area=Math.abs(F),D===void 0&&(D=F<0),D===F<0?(C&&E.push(C),C=[v[O]]):C.push(v[O]))}return C&&E.push(C),E}(m)){const v=[];for(let T=0;T<P.length;++T)v.push($y(P[T],h));b.push(v)}const M=new Nc(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return dh(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,M);if(g.type==="MultiLineString"){let P=1/0;for(let v=0;v<g.coordinates.length;v++){const T=dh(g.coordinates[v],!0,b,M,P);if(isNaN(T))return T;if((P=Math.min(P,T))===0)return P}return P}return g.type==="Polygon"||g.type==="MultiPolygon"?function(P,v,T){let I=1/0;for(const E of P)for(const C of v){const D=Zy(E,C,T,I);if(isNaN(D))return D;if((I=Math.min(I,D))===0)return I}return I}(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,M):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function il(c,r){switch(c){case"string":return vo(r);case"number":return+r;case"boolean":return!!r;case"color":return un.parse(r);case"formatted":return co.fromString(vo(r));case"resolvedImage":return yo.fromString(vo(r))}return r}function Yr(c,r,o,u){return u!==void 0&&(c=u*Math.round(c/u)),r!==void 0&&c<r&&(c=r),o!==void 0&&c>o&&(c=o),c}class $c{constructor(r,o,u){this.type=r,this.key=o,this.scope=u}static parse(r,o){let u=o.expectedType;if(u==null&&(u=Jr),r.length<2||r.length>3)return o.error("Invalid number of arguments for 'config' expression.");const m=o.parse(r[1],1);if(!(m instanceof Da))return o.error("Key name of 'config' expression must be a string literal.");if(r.length>=3){const h=o.parse(r[2],2);return h instanceof Da?new $c(u,vo(m.value),vo(h.value)):o.error("Scope of 'config' expression must be a string literal.")}return new $c(u,vo(m.value))}evaluate(r){const o=[this.key,this.scope,r.scope].filter(Boolean).join(""),u=r.getConfig(o);if(!u)return null;const{type:m,value:h,values:g,minValue:b,maxValue:M,stepValue:P}=u,v=u.default.evaluate(r);let T=v;if(h){const I=r.scope;r.scope=(I||"").split("").slice(1).join(""),T=h.evaluate(r),r.scope=I}return m&&(T=il(m,T)),T===void 0||b===void 0&&M===void 0&&P===void 0||(typeof T=="number"?T=Yr(T,b,M,P):Array.isArray(T)&&(T=T.map(I=>typeof I=="number"?Yr(I,b,M,P):I))),h!==void 0&&T!==void 0&&g&&!g.includes(T)&&(T=v,m&&(T=il(m,T))),(m&&m!==this.type||T!==void 0&&di(T)!==this.type)&&(T=il(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.key),r}}function fh(c){if(c instanceof ko&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof rl||c instanceof nl)return!1;let r=!0;return c.eachChild(o=>{r&&!fh(o)&&(r=!1)}),r}function Xd(c){if(c instanceof ko&&c.name==="feature-state")return!1;let r=!0;return c.eachChild(o=>{r&&!Xd(o)&&(r=!1)}),r}function Kd(c){if(c instanceof $c)return new Set([c.key]);let r=new Set;return c.eachChild(o=>{r=new Set([...r,...Kd(o)])}),r}function ph(c,r){if(c instanceof ko&&r.indexOf(c.name)>=0)return!1;let o=!0;return c.eachChild(u=>{o&&!ph(u,r)&&(o=!1)}),o}class vn{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=r[1];return o.scope.has(u)?new vn(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class xm{constructor(r,o=[],u,m=new Od,h=[],g,b){this.registry=r,this.path=o,this.key=o.map(M=>typeof M=="string"?`['${M}']`:`[${M}]`).join(""),this.scope=m,this.errors=h,this.expectedType=u,this._scope=g,this.options=b}parse(r,o,u,m,h={}){return o||u?this.concat(o,null,u,m)._parse(r,h):this._parse(r,h)}parseObjectValue(r,o,u,m,h,g={}){return this.concat(o,u,m,h)._parse(r,g)}_parse(r,o){function u(m,h,g){return g==="assert"?new Ra(h,[m]):g==="coerce"?new Ts(h,[m]):m}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(m){let h=m.parse(r,this);if(!h)return null;if(this.expectedType){const g=this.expectedType,b=h.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else h=u(h,g,o.typeAnnotation||"coerce");else h=u(h,g,o.typeAnnotation||"assert")}if(!(h instanceof Da)&&h.type.kind!=="resolvedImage"&&bm(h)){const g=new Fy(this._scope,this.options);try{h=new Da(h.type,h.evaluate(g))}catch(b){return this.error(b.message),null}}return h}return Ts.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,u,m){let h=typeof r=="number"?this.path.concat(r):this.path;h=typeof o=="string"?h.concat(o):h;const g=m?this.scope.concat(m):this.scope;return new xm(this.registry,h,u||null,g,this.errors,this._scope,this.options)}error(r,...o){const u=`${this.key}${o.map(m=>`[${m}]`).join("")}`;this.errors.push(new es(u,r))}checkSubtype(r,o){const u=Rc(r,o);return u&&this.error(u),u}}var Yy=xm;function bm(c){if(c instanceof vn)return bm(c.boundExpression);if(c instanceof ko&&c.name==="error"||c instanceof Bd||c instanceof rl||c instanceof nl||c instanceof $c)return!1;const r=c instanceof Ts||c instanceof Ra;let o=!0;return c.eachChild(u=>{o=r?o&&bm(u):o&&u instanceof Da}),!!o&&fh(c)&&ph(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Jd(c,r){const o=c.length-1;let u,m,h=0,g=o,b=0;for(;h<=g;)if(b=Math.floor((h+g)/2),u=c[b],m=c[b+1],u<=r){if(b===o||r<m)return b;h=b+1}else{if(!(u>r))throw new ki("Input is not a number.");g=b-1}return 0}class mh{constructor(r,o,u){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[m,h]of u)this.labels.push(m),this.outputs.push(h)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(r[1],1,Yt);if(!u)return null;const m=[];let h=null;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(let g=1;g<r.length;g+=2){const b=g===1?-1/0:r[g],M=r[g+1],P=g,v=g+1;if(typeof b!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=b)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const T=o.parse(M,v,h);if(!T)return null;h=h||T.type,m.push([b,T])}return new mh(h,u,m)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=o[0])return u[0].evaluate(r);const h=o.length;return m>=o[h-1]?u[h-1].evaluate(r):u[Jd(o,m)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&r.push(this.labels[o]),r.push(this.outputs[o].serialize());return r}}const Xy=.95047,Ky=1.08883,Jy=4/29,Wc=6/29,Qy=3*Wc*Wc,qb=Wc*Wc*Wc,Zb=Math.PI/180,Yb=180/Math.PI;function wm(c){return c>qb?Math.pow(c,1/3):c/Qy+Jy}function Sm(c){return c>Wc?c*c*c:Qy*(c-Jy)}function Tm(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Em(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function e0(c){const r=Em(c.r),o=Em(c.g),u=Em(c.b),m=wm((.4124564*r+.3575761*o+.1804375*u)/Xy),h=wm((.2126729*r+.7151522*o+.072175*u)/1);return{l:116*h-16,a:500*(m-h),b:200*(h-wm((.0193339*r+.119192*o+.9503041*u)/Ky)),alpha:c.a}}function t0(c){let r=(c.l+16)/116,o=isNaN(c.a)?r:r+c.a/500,u=isNaN(c.b)?r:r-c.b/200;return r=1*Sm(r),o=Xy*Sm(o),u=Ky*Sm(u),new un(Tm(3.2404542*o-1.5371385*r-.4985314*u),Tm(-.969266*o+1.8760108*r+.041556*u),Tm(.0556434*o-.2040259*r+1.0572252*u),c.alpha)}function Xb(c,r,o){const u=r-c;return c+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const gh={forward:e0,reverse:t0,interpolate:function(c,r,o){return{l:ur(c.l,r.l,o),a:ur(c.a,r.a,o),b:ur(c.b,r.b,o),alpha:ur(c.alpha,r.alpha,o)}}},_h={forward:function(c){const{l:r,a:o,b:u}=e0(c),m=Math.atan2(u,o)*Yb;return{h:m<0?m+360:m,c:Math.sqrt(o*o+u*u),l:r,alpha:c.a}},reverse:function(c){const r=c.h*Zb,o=c.c;return t0({l:c.l,a:Math.cos(r)*o,b:Math.sin(r)*o,alpha:c.alpha})},interpolate:function(c,r,o){return{h:Xb(c.h,r.h,o),c:ur(c.c,r.c,o),l:ur(c.l,r.l,o),alpha:ur(c.alpha,r.alpha,o)}}};var r0=Object.freeze({__proto__:null,hcl:_h,lab:gh});class Xo{constructor(r,o,u,m,h){this.type=r,this.operator=o,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[g,b]of h)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(r,o,u,m){let h=0;if(r.name==="exponential")h=Mm(o,r.base,u,m);else if(r.name==="linear")h=Mm(o,1,u,m);else if(r.name==="cubic-bezier"){const g=r.controlPoints;h=new cr(g[0],g[1],g[2],g[3]).solve(Mm(o,1,u,m))}return h}static parse(r,o){let[u,m,h,...g]=r;if(!Array.isArray(m)||m.length===0)return o.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const P=m[1];if(typeof P!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if(m[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(P.length!==4||P.some(v=>typeof v!="number"||v<0||v>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(h=o.parse(h,2,Yt),!h)return null;const b=[];let M=null;u==="interpolate-hcl"||u==="interpolate-lab"?M=Ro:o.expectedType&&o.expectedType.kind!=="value"&&(M=o.expectedType);for(let P=0;P<g.length;P+=2){const v=g[P],T=g[P+1],I=P+3,E=P+4;if(typeof v!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(b.length&&b[b.length-1][0]>=v)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const C=o.parse(T,E,M);if(!C)return null;M=M||C.type,b.push([v,C])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new Xo(M,u,m,h,b):o.error(`Type ${ei(M)} is not interpolatable.`)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=o[0])return u[0].evaluate(r);const h=o.length;if(m>=o[h-1])return u[h-1].evaluate(r);const g=Jd(o,m),b=Xo.interpolationFactor(this.interpolation,m,o[g],o[g+1]),M=u[g].evaluate(r),P=u[g+1].evaluate(r);return this.operator==="interpolate"?Bl[this.type.kind.toLowerCase()](M,P,b):this.operator==="interpolate-hcl"?_h.reverse(_h.interpolate(_h.forward(M),_h.forward(P),b)):gh.reverse(gh.interpolate(gh.forward(M),gh.forward(P),b))}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function Mm(c,r,o,u){const m=u-o,h=c-o;return m===0?0:r===1?h/m:(Math.pow(r,h)-1)/(Math.pow(r,m)-1)}class Qd{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expectected at least one argument.");let u=null;const m=o.expectedType;m&&m.kind!=="value"&&(u=m);const h=[];for(const b of r.slice(1)){const M=o.parse(b,1+h.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,h.push(M)}const g=m&&h.some(b=>Rc(m,b.type));return new Qd(g?Jr:u,h)}evaluate(r){let o,u=null,m=0;for(const h of this.args){if(m++,u=h.evaluate(r),u&&u instanceof yo&&!u.available&&(o||(o=u),u=null,m===this.args.length))return o;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(o=>{r.push(o.serialize())}),r}}class ef{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let h=1;h<r.length-1;h+=2){const g=r[h];if(typeof g!="string")return o.error(`Expected string, but found ${typeof g} instead.`,h);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);const b=o.parse(r[h+1],h+1);if(!b)return null;u.push([g,b])}const m=o.parse(r[r.length-1],r.length-1,o.expectedType,u);return m?new ef(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[o,u]of this.bindings)r.push(o,u.serialize());return r.push(this.result.serialize()),r}}class Cm{constructor(r,o,u){this.type=r,this.index=o,this.input=u}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,Yt),m=o.parse(r[2],2,_o(o.expectedType||Jr));return u&&m?new Cm(m.type.itemType,u,m):null}evaluate(r){const o=this.index.evaluate(r),u=this.input.evaluate(r);if(o<0)throw new ki(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new ki(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new ki(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Im{constructor(r,o){this.type=Zr,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,Jr),m=o.parse(r[2],2,Jr);return u&&m?kc(u.type,[Zr,qr,Yt,Aa,Jr])?new Im(u,m):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(u.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!ts(o,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${ei(di(o))} instead.`);if(!ts(u,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${ei(di(u))} instead.`);return u.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class tf{constructor(r,o,u){this.type=Yt,this.needle=r,this.haystack=o,this.fromIndex=u}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,Jr),m=o.parse(r[2],2,Jr);if(!u||!m)return null;if(!kc(u.type,[Zr,qr,Yt,Aa,Jr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(u.type)} instead`);if(r.length===4){const h=o.parse(r[3],3,Yt);return h?new tf(u,m,h):null}return new tf(u,m)}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!ts(o,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${ei(di(o))} instead.`);if(!ts(u,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${ei(di(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return u.indexOf(o,m)}return u.indexOf(o)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Pm{constructor(r,o,u,m,h,g){this.inputType=r,this.type=o,this.input=u,this.cases=m,this.outputs=h,this.otherwise=g}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let u,m;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);const h={},g=[];for(let P=2;P<r.length-1;P+=2){let v=r[P];const T=r[P+1];Array.isArray(v)||(v=[v]);const I=o.concat(P);if(v.length===0)return I.error("Expected at least one branch label.");for(const C of v){if(typeof C!="number"&&typeof C!="string")return I.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return I.error("Numeric branch labels must be integer values.");if(u){if(I.checkSubtype(u,di(C)))return null}else u=di(C);if(h[String(C)]!==void 0)return I.error("Branch labels must be unique.");h[String(C)]=g.length}const E=o.parse(T,P,m);if(!E)return null;m=m||E.type,g.push(E)}const b=o.parse(r[1],1,Jr);if(!b)return null;const M=o.parse(r[r.length-1],r.length-1,m);return M?b.type.kind!=="value"&&o.concat(1).checkSubtype(u,b.type)?null:new Pm(u,m,b,h,g,M):null}evaluate(r){const o=this.input.evaluate(r);return(di(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],m={};for(const g of o){const b=m[this.cases[g]];b===void 0?(m[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[b][1].push(g)}const h=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of u)r.push(b.length===1?h(b[0]):b.map(h)),r.push(this.outputs[g].serialize());return r.push(this.otherwise.serialize()),r}}class yh{constructor(r,o,u){this.type=r,this.branches=o,this.otherwise=u}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const m=[];for(let g=1;g<r.length-1;g+=2){const b=o.parse(r[g],g,Zr);if(!b)return null;const M=o.parse(r[g+1],g+1,u);if(!M)return null;m.push([b,M]),u=u||M.type}const h=o.parse(r[r.length-1],r.length-1,u);return h?new yh(u,m,h):null}evaluate(r){for(const[o,u]of this.branches)if(o.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,u]of this.branches)r(o),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(o=>{r.push(o.serialize())}),r}}class rf{constructor(r,o,u,m){this.type=r,this.input=o,this.beginIndex=u,this.endIndex=m}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,Jr),m=o.parse(r[2],2,Yt);if(!u||!m)return null;if(!kc(u.type,[_o(Jr),qr,Jr]))return o.error(`Expected first argument to be of type array or string, but found ${ei(u.type)} instead`);if(r.length===4){const h=o.parse(r[3],3,Yt);return h?new rf(u.type,u,m,h):null}return new rf(u.type,u,m)}evaluate(r){const o=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!ts(o,["string","array"]))throw new ki(`Expected first argument to be of type array or string, but found ${ei(di(o))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return o.slice(u,m)}return o.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Am(c,r){return c==="=="||c==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function n0(c,r,o,u){return u.compare(r,o)===0}function Gc(c,r,o){const u=c!=="=="&&c!=="!=";return class I5{constructor(h,g,b){this.type=Zr,this.lhs=h,this.rhs=g,this.collator=b,this.hasUntypedArgument=h.type.kind==="value"||g.type.kind==="value"}static parse(h,g){if(h.length!==3&&h.length!==4)return g.error("Expected two or three arguments.");const b=h[0];let M=g.parse(h[1],1,Jr);if(!M)return null;if(!Am(b,M.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${ei(M.type)}'.`);let P=g.parse(h[2],2,Jr);if(!P)return null;if(!Am(b,P.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${ei(P.type)}'.`);if(M.type.kind!==P.type.kind&&M.type.kind!=="value"&&P.type.kind!=="value")return g.error(`Cannot compare types '${ei(M.type)}' and '${ei(P.type)}'.`);u&&(M.type.kind==="value"&&P.type.kind!=="value"?M=new Ra(P.type,[M]):M.type.kind!=="value"&&P.type.kind==="value"&&(P=new Ra(M.type,[P])));let v=null;if(h.length===4){if(M.type.kind!=="string"&&P.type.kind!=="string"&&M.type.kind!=="value"&&P.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(v=g.parse(h[3],3,Ld),!v)return null}return new I5(M,P,v)}evaluate(h){const g=this.lhs.evaluate(h),b=this.rhs.evaluate(h);if(u&&this.hasUntypedArgument){const M=di(g),P=di(b);if(M.kind!==P.kind||M.kind!=="string"&&M.kind!=="number")throw new ki(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${M.kind}, ${P.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const M=di(g),P=di(b);if(M.kind!=="string"||P.kind!=="string")return r(h,g,b)}return this.collator?o(h,g,b,this.collator.evaluate(h)):r(h,g,b)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(g=>{h.push(g.serialize())}),h}}}const Kb=Gc("==",function(c,r,o){return r===o},n0),i0=Gc("!=",function(c,r,o){return r!==o},function(c,r,o,u){return!n0(0,r,o,u)}),o0=Gc("<",function(c,r,o){return r<o},function(c,r,o,u){return u.compare(r,o)<0}),Hc=Gc(">",function(c,r,o){return r>o},function(c,r,o,u){return u.compare(r,o)>0}),a0=Gc("<=",function(c,r,o){return r<=o},function(c,r,o,u){return u.compare(r,o)<=0}),s0=Gc(">=",function(c,r,o){return r>=o},function(c,r,o,u){return u.compare(r,o)>=0});class Dm{constructor(r,o,u,m,h,g){this.type=qr,this.number=r,this.locale=o,this.currency=u,this.unit=m,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const u=o.parse(r[1],1,Yt);if(!u)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return o.error("NumberFormat options argument must be an object.");let h=null;if(m.locale&&(h=o.parseObjectValue(m.locale,2,"locale",qr),!h))return null;let g=null;if(m.currency&&(g=o.parseObjectValue(m.currency,2,"currency",qr),!g))return null;let b=null;if(m.unit&&(b=o.parseObjectValue(m.unit,2,"unit",qr),!b))return null;let M=null;if(m["min-fraction-digits"]&&(M=o.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",Yt),!M))return null;let P=null;return m["max-fraction-digits"]&&(P=o.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",Yt),!P)?null:new Dm(u,h,g,b,M,P)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class vh{constructor(r){this.type=Yt,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=o.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ei(u.type)} instead.`):new vh(u):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ki(`Expected value to be of type string or array, but found ${ei(di(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(o=>{r.push(o.serialize())}),r}}function nf(c){return function(){c=1831565813+(c|=0)|0;let r=Math.imul(c^c>>>15,1|c);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const qc={"==":Kb,"!=":i0,">":Hc,"<":o0,">=":s0,"<=":a0,array:Ra,at:Cm,boolean:Ra,case:yh,coalesce:Qd,collator:Bd,format:Oc,image:Nl,in:Im,"index-of":tf,interpolate:Xo,"interpolate-hcl":Xo,"interpolate-lab":Xo,length:vh,let:ef,literal:Da,match:Pm,number:Ra,"number-format":Dm,object:Ra,slice:rf,step:mh,string:Ra,"to-boolean":Ts,"to-color":Ts,"to-number":Ts,"to-string":Ts,var:vn,within:rl,distance:nl,config:$c};function l0(c,[r,o,u,m]){r=r.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=zy(r,o,u,h);if(g)throw new ki(g);return new un(r/255*h,o/255*h,u/255*h,h)}function Rm(c,[r,o,u,m]){r=r.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=function(P,v,T,I){return typeof P=="number"&&P>=0&&P<=360?typeof v=="number"&&v>=0&&v<=100&&typeof T=="number"&&T>=0&&T<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[P,v,T,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[P,v,T,I]:[P,v,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[P,v,T,I]:[P,v,T]).join(", ")}]: 'h' must be between 0 and 360.`}(r,o,u,h);if(g)throw new ki(g);const b=`hsla(${r}, ${o}%, ${u}%, ${h})`,M=un.parse(b);if(!M)throw new ki(`Failed to parse HSLA color: ${b}`);return M}function km(c,r){return c in r}function Om(c,r){const o=r[c];return o===void 0?null:o}function $l(c){return{type:c}}function c0(c){return{result:"success",value:c}}function ol(c){return{result:"error",value:c}}function Lm(c,r){return!!c&&!!c.parameters&&c.parameters.indexOf(r)>-1}function of(c){return c["property-type"]==="data-driven"}function zm(c){return Lm(c.expression,"measure-light")}function u0(c){return Lm(c.expression,"zoom")}function Fm(c){return!!c.expression&&c.expression.interpolated}function af(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function h0(c){return c}function d0(c,r){const o=r.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",m=u||!(u||c.property!==void 0),h=c.type||(Fm(r)?"exponential":"interval");if(o&&((c=Pc({},c)).stops&&(c.stops=c.stops.map(P=>[P[0],un.parse(P[1])])),c.default=un.parse(c.default?c.default:r.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!r0[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let g,b,M;if(h==="exponential")g=p0;else if(h==="interval")g=f0;else if(h==="categorical"){g=Jb,b=Object.create(null);for(const P of c.stops)b[P[0]]=P[1];M=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=Qb}if(u){const P={},v=[];for(let E=0;E<c.stops.length;E++){const C=c.stops[E],D=C[0].zoom;P[D]===void 0&&(P[D]={zoom:D,type:c.type,property:c.property,default:c.default,stops:[]},v.push(D)),P[D].stops.push([C[0].value,C[1]])}const T=[];for(const E of v)T.push([P[E].zoom,d0(P[E],r)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Xo.interpolationFactor.bind(void 0,I),zoomStops:T.map(E=>E[0]),evaluate:({zoom:E},C)=>p0({stops:T,base:c.base},r,E).evaluate(E,C)}}if(m){const P=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Xo.interpolationFactor.bind(void 0,P),zoomStops:c.stops.map(v=>v[0]),evaluate:({zoom:v})=>g(c,r,v,b,M)}}return{kind:"source",evaluate(P,v){const T=v&&v.properties?v.properties[c.property]:void 0;return T===void 0?xh(c.default,r.default):g(c,r,T,b,M)}}}function xh(c,r,o){return c!==void 0?c:r!==void 0?r:o!==void 0?o:void 0}function Jb(c,r,o,u,m){return xh(typeof o===m?u[o]:void 0,c.default,r.default)}function f0(c,r,o){if(Ul(o)!=="number")return xh(c.default,r.default);const u=c.stops.length;if(u===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[u-1][0])return c.stops[u-1][1];const m=Jd(c.stops.map(h=>h[0]),o);return c.stops[m][1]}function p0(c,r,o){const u=c.base!==void 0?c.base:1;if(Ul(o)!=="number")return xh(c.default,r.default);const m=c.stops.length;if(m===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[m-1][0])return c.stops[m-1][1];const h=Jd(c.stops.map(v=>v[0]),o),g=function(v,T,I,E){const C=E-I,D=v-I;return C===0?0:T===1?D/C:(Math.pow(T,D)-1)/(Math.pow(T,C)-1)}(o,u,c.stops[h][0],c.stops[h+1][0]),b=c.stops[h][1],M=c.stops[h+1][1];let P=Bl[r.type]||h0;if(c.colorSpace&&c.colorSpace!=="rgb"){const v=r0[c.colorSpace];P=(T,I)=>v.reverse(v.interpolate(v.forward(T),v.forward(I),g))}return typeof b.evaluate=="function"?{evaluate(...v){const T=b.evaluate.apply(void 0,v),I=M.evaluate.apply(void 0,v);if(T!==void 0&&I!==void 0)return P(T,I,g)}}:P(b,M,g)}function Qb(c,r,o){return r.type==="color"?o=un.parse(o):r.type==="formatted"?o=co.fromString(o.toString()):r.type==="resolvedImage"?o=yo.fromString(o.toString()):Ul(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0),xh(o,c.default,r.default)}ko.register(qc,{error:[{kind:"error"},[qr],(c,[r])=>{throw new ki(r.evaluate(c))}],typeof:[qr,[Jr],(c,[r])=>ei(di(r.evaluate(c)))],"to-rgba":[_o(Yt,4),[Ro],(c,[r])=>r.evaluate(c).toRenderColor(null).toArray()],rgb:[Ro,[Yt,Yt,Yt],l0],rgba:[Ro,[Yt,Yt,Yt,Yt],l0],hsl:[Ro,[Yt,Yt,Yt],Rm],hsla:[Ro,[Yt,Yt,Yt,Yt],Rm],has:{type:Zr,overloads:[[[qr],(c,[r])=>km(r.evaluate(c),c.properties())],[[qr,lo],(c,[r,o])=>km(r.evaluate(c),o.evaluate(c))]]},get:{type:Jr,overloads:[[[qr],(c,[r])=>Om(r.evaluate(c),c.properties())],[[qr,lo],(c,[r,o])=>Om(r.evaluate(c),o.evaluate(c))]]},"feature-state":[Jr,[qr],(c,[r])=>Om(r.evaluate(c),c.featureState||{})],properties:[lo,[],c=>c.properties()],"geometry-type":[qr,[],c=>c.geometryType()],id:[Jr,[],c=>c.id()],zoom:[Yt,[],c=>c.globals.zoom],pitch:[Yt,[],c=>c.globals.pitch||0],"distance-from-center":[Yt,[],c=>c.distanceFromCenter()],"measure-light":[Yt,[qr],(c,[r])=>c.measureLight(r.evaluate(c))],"heatmap-density":[Yt,[],c=>c.globals.heatmapDensity||0],"line-progress":[Yt,[],c=>c.globals.lineProgress||0],"raster-value":[Yt,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[Yt,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[Yt,[],c=>c.globals.skyRadialProgress||0],accumulated:[Jr,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Yt,$l(Yt),(c,r)=>{let o=0;for(const u of r)o+=u.evaluate(c);return o}],"*":[Yt,$l(Yt),(c,r)=>{let o=1;for(const u of r)o*=u.evaluate(c);return o}],"-":{type:Yt,overloads:[[[Yt,Yt],(c,[r,o])=>r.evaluate(c)-o.evaluate(c)],[[Yt],(c,[r])=>-r.evaluate(c)]]},"/":[Yt,[Yt,Yt],(c,[r,o])=>r.evaluate(c)/o.evaluate(c)],"%":[Yt,[Yt,Yt],(c,[r,o])=>r.evaluate(c)%o.evaluate(c)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(c,[r,o])=>Math.pow(r.evaluate(c),o.evaluate(c))],sqrt:[Yt,[Yt],(c,[r])=>Math.sqrt(r.evaluate(c))],log10:[Yt,[Yt],(c,[r])=>Math.log(r.evaluate(c))/Math.LN10],ln:[Yt,[Yt],(c,[r])=>Math.log(r.evaluate(c))],log2:[Yt,[Yt],(c,[r])=>Math.log(r.evaluate(c))/Math.LN2],sin:[Yt,[Yt],(c,[r])=>Math.sin(r.evaluate(c))],cos:[Yt,[Yt],(c,[r])=>Math.cos(r.evaluate(c))],tan:[Yt,[Yt],(c,[r])=>Math.tan(r.evaluate(c))],asin:[Yt,[Yt],(c,[r])=>Math.asin(r.evaluate(c))],acos:[Yt,[Yt],(c,[r])=>Math.acos(r.evaluate(c))],atan:[Yt,[Yt],(c,[r])=>Math.atan(r.evaluate(c))],min:[Yt,$l(Yt),(c,r)=>Math.min(...r.map(o=>o.evaluate(c)))],max:[Yt,$l(Yt),(c,r)=>Math.max(...r.map(o=>o.evaluate(c)))],abs:[Yt,[Yt],(c,[r])=>Math.abs(r.evaluate(c))],round:[Yt,[Yt],(c,[r])=>{const o=r.evaluate(c);return o<0?-Math.round(-o):Math.round(o)}],floor:[Yt,[Yt],(c,[r])=>Math.floor(r.evaluate(c))],ceil:[Yt,[Yt],(c,[r])=>Math.ceil(r.evaluate(c))],"filter-==":[Zr,[qr,Jr],(c,[r,o])=>c.properties()[r.value]===o.value],"filter-id-==":[Zr,[Jr],(c,[r])=>c.id()===r.value],"filter-type-==":[Zr,[qr],(c,[r])=>c.geometryType()===r.value],"filter-<":[Zr,[qr,Jr],(c,[r,o])=>{const u=c.properties()[r.value],m=o.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Zr,[Jr],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o<u}],"filter->":[Zr,[qr,Jr],(c,[r,o])=>{const u=c.properties()[r.value],m=o.value;return typeof u==typeof m&&u>m}],"filter-id->":[Zr,[Jr],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o>u}],"filter-<=":[Zr,[qr,Jr],(c,[r,o])=>{const u=c.properties()[r.value],m=o.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Zr,[Jr],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o<=u}],"filter->=":[Zr,[qr,Jr],(c,[r,o])=>{const u=c.properties()[r.value],m=o.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Zr,[Jr],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o>=u}],"filter-has":[Zr,[Jr],(c,[r])=>r.value in c.properties()],"filter-has-id":[Zr,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Zr,[_o(qr)],(c,[r])=>r.value.indexOf(c.geometryType())>=0],"filter-id-in":[Zr,[_o(Jr)],(c,[r])=>r.value.indexOf(c.id())>=0],"filter-in-small":[Zr,[qr,_o(Jr)],(c,[r,o])=>o.value.indexOf(c.properties()[r.value])>=0],"filter-in-large":[Zr,[qr,_o(Jr)],(c,[r,o])=>function(u,m,h,g){for(;h<=g;){const b=h+g>>1;if(m[b]===u)return!0;m[b]>u?g=b-1:h=b+1}return!1}(c.properties()[r.value],o.value,0,o.value.length-1)],all:{type:Zr,overloads:[[[Zr,Zr],(c,[r,o])=>r.evaluate(c)&&o.evaluate(c)],[$l(Zr),(c,r)=>{for(const o of r)if(!o.evaluate(c))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],(c,[r,o])=>r.evaluate(c)||o.evaluate(c)],[$l(Zr),(c,r)=>{for(const o of r)if(o.evaluate(c))return!0;return!1}]]},"!":[Zr,[Zr],(c,[r])=>!r.evaluate(c)],"is-supported-script":[Zr,[qr],(c,[r])=>{const o=c.globals&&c.globals.isSupportedScript;return!o||o(r.evaluate(c))}],upcase:[qr,[qr],(c,[r])=>r.evaluate(c).toUpperCase()],downcase:[qr,[qr],(c,[r])=>r.evaluate(c).toLowerCase()],concat:[qr,$l(Jr),(c,r)=>r.map(o=>vo(o.evaluate(c))).join("")],"resolved-locale":[qr,[Ld],(c,[r])=>r.evaluate(c).resolvedLocale()],random:[Yt,[Yt,Yt,Jr],(c,r)=>{const[o,u,m]=r.map(g=>g.evaluate(c));if(o>u||o===u)return o;let h;if(typeof m=="string")h=function(g){let b=0;if(g.length===0)return b;for(let M=0;M<g.length;M++)b=(b<<5)-b+g.charCodeAt(M),b|=0;return b}(m);else{if(typeof m!="number")throw new ki(`Invalid seed input: ${m}`);h=m}return o+nf(h)()*(u-o)}]});class sf{constructor(r,o,u,m){this.expression=r,this._warningHistory={},this._evaluator=new Fy(u,m),this._defaultValue=o?function(h){return h.type==="color"&&(af(h.default)||Array.isArray(h.default))?new un(0,0,0,0):h.type==="color"?un.parse(h.default)||null:h.default===void 0?null:h.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,u,m,h,g,b,M){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(r,o,u,m,h,g,b,M){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=M||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new ki(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function lf(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in qc}function bh(c,r,o,u){const m=new Yy(qc,[],r?function(g){const b={color:Ro,string:qr,number:Yt,enum:qr,boolean:Zr,formatted:Ac,resolvedImage:Dc};return g.type==="array"?_o(b[g.value]||Jr,g.length):b[g.type]}(r):void 0,void 0,void 0,o,u),h=m.parse(c,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?c0(new sf(h,r,o,u)):ol(m.errors)}class Bm{constructor(r,o,u){this.kind=r,this._styleExpression=o,this.isLightConstant=u,this.isStateDependent=r!=="constant"&&!Xd(o.expression),this.configDependencies=Kd(o.expression)}evaluateWithoutErrorHandling(r,o,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,m,h,g)}evaluate(r,o,u,m,h,g){return this._styleExpression.evaluate(r,o,u,m,h,g)}}class rs{constructor(r,o,u,m,h){this.kind=r,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!Xd(o.expression),this.isLightConstant=h,this.configDependencies=Kd(o.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,o,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,m,h,g)}evaluate(r,o,u,m,h,g){return this._styleExpression.evaluate(r,o,u,m,h,g)}interpolationFactor(r,o,u){return this.interpolationType?Xo.interpolationFactor(this.interpolationType,r,o,u):0}}function m0(c,r,o,u){if((c=bh(c,r,o,u)).result==="error")return c;const m=c.value.expression,h=fh(m);if(!h&&!of(r))return ol([new es("","data expressions not supported")]);const g=ph(m,["zoom","pitch","distance-from-center"]);if(!g&&!u0(r))return ol([new es("","zoom expressions not supported")]);const b=ph(m,["measure-light"]);if(!b&&!zm(r))return ol([new es("","measure-light expression not supported")]);const M=r.expression&&r.expression.relaxZoomRestriction,P=uf(m);return P||g||M?P instanceof es?ol([P]):P instanceof Xo&&!Fm(r)?ol([new es("",'"interpolate" expressions cannot be used with this property')]):c0(P?new rs(h?"camera":"composite",c.value,P.labels,P instanceof Xo?P.interpolation:void 0,b):new Bm(h?"constant":"source",c.value,b)):ol([new es("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class cf{constructor(r,o){this._parameters=r,this._specification=o,Pc(this,d0(this._parameters,this._specification))}static deserialize(r){return new cf(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function uf(c){let r=null;if(c instanceof ef)r=uf(c.result);else if(c instanceof Qd){for(const o of c.args)if(r=uf(o),r)break}else(c instanceof mh||c instanceof Xo)&&c.input instanceof ko&&c.input.name==="zoom"&&(r=c);return r instanceof es||c.eachChild(o=>{const u=uf(o);u instanceof es?r=u:r&&u&&r!==u&&(r=new es("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var hf,Nm,g0=function(){if(Nm)return hf;Nm=1,hf=r;var c=3;function r(o,u,m){var h=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var g=new Int32Array(this.arrayBuffer);o=g[0],this.d=(u=g[1])+2*(m=g[2]);for(var b=0;b<this.d*this.d;b++){var M=g[c+b],P=g[c+b+1];h.push(M===P?null:g.subarray(M,P))}var v=g[c+h.length+1];this.keys=g.subarray(g[c+h.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var T=0;T<this.d*this.d;T++)h.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=m,this.scale=u/o,this.uid=0;var I=m/u*o;this.min=-I,this.max=o+I}return r.prototype.insert=function(o,u,m,h,g){this._forEachCell(u,m,h,g,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(h),this.bboxes.push(g)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(o,u,m,h,g,b){this.cells[g].push(b)},r.prototype.query=function(o,u,m,h,g){var b=this.min,M=this.max;if(o<=b&&u<=b&&M<=m&&M<=h&&!g)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(o,u,m,h,this._queryCell,P,{},g),P},r.prototype._queryCell=function(o,u,m,h,g,b,M,P){var v=this.cells[g];if(v!==null)for(var T=this.keys,I=this.bboxes,E=0;E<v.length;E++){var C=v[E];if(M[C]===void 0){var D=4*C;(P?P(I[D+0],I[D+1],I[D+2],I[D+3]):o<=I[D+2]&&u<=I[D+3]&&m>=I[D+0]&&h>=I[D+1])?(M[C]=!0,b.push(T[C])):M[C]=!1}}},r.prototype._forEachCell=function(o,u,m,h,g,b,M,P){for(var v=this._convertToCellCoord(o),T=this._convertToCellCoord(u),I=this._convertToCellCoord(m),E=this._convertToCellCoord(h),C=v;C<=I;C++)for(var D=T;D<=E;D++){var O=this.d*D+C;if((!P||P(this._convertFromCellCoord(C),this._convertFromCellCoord(D),this._convertFromCellCoord(C+1),this._convertFromCellCoord(D+1)))&&g.call(this,o,u,m,h,O,b,M,P))return}},r.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},r.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=c+this.cells.length+1+1,m=0,h=0;h<this.cells.length;h++)m+=this.cells[h].length;var g=new Int32Array(u+m+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=u,M=0;M<o.length;M++){var P=o[M];g[c+M]=b,g.set(P,b),b+=P.length}return g[c+o.length]=b,g.set(this.keys,b),g[c+o.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},hf}(),Wl=N(g0);const Zc={};function Zt(c,r,o={}){Object.defineProperty(c,"_classRegistryKey",{value:r,writable:!1}),Zc[r]={klass:c,omit:o.omit||[]}}Zt(Object,"Object"),Wl.serialize=function(c,r){const o=c.toArrayBuffer();return r&&r.add(o),{buffer:o}},Wl.deserialize=function(c){return new Wl(c.buffer)},Object.defineProperty(Wl,"name",{value:"Grid"}),Zt(Wl,"Grid"),Zt(un,"Color"),Zt(Error,"Error"),Zt(co,"Formatted"),Zt(Ho,"FormattedSection"),Zt(nm,"AJAXError"),Zt(yo,"ResolvedImage"),Zt(cf,"StylePropertyFunction"),Zt(sf,"StyleExpression",{omit:["_evaluator"]}),Zt(rs,"ZoomDependentExpression"),Zt(Bm,"ZoomConstantExpression"),Zt(ko,"CompoundExpression",{omit:["_evaluate"]});for(const c in qc)Zc[qc[c]._classRegistryKey]||Zt(qc[c],`Expression${c}`);function Um(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function _0(c){return self.ImageBitmap&&c instanceof ImageBitmap}function Oo(c,r){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Um(c)||_0(c))return r&&r.add(c),c;if(ArrayBuffer.isView(c)){const o=c;return r&&r.add(o.buffer),o}if(c instanceof ImageData)return r&&r.add(c.data.buffer),c;if(Array.isArray(c)){const o=[];for(const u of c)o.push(Oo(u,r));return o}if(c instanceof Map){const o={$name:"Map"};for(const[u,m]of c.entries())o[u]=Oo(m);return o}if(c instanceof Set){const o={$name:"Set"};let u=0;for(const m of c.values())o[++u]=Oo(m);return o}if(typeof c=="object"){const o=c.constructor,u=o._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const m=o.serialize?o.serialize(c,r):{};if(!o.serialize){for(const h in c)c.hasOwnProperty(h)&&(Zc[u].omit.indexOf(h)>=0||(m[h]=Oo(c[h],r)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof c)}function Gl(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Um(c)||_0(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Gl);if(typeof c=="object"){const r=c.$name||"Object";if(r==="Map"){const m=new Map;for(const h of Object.keys(c))h!=="$name"&&m.set(h,Gl(c[h]));return m}if(r==="Set"){const m=new Set;for(const h of Object.keys(c))h!=="$name"&&m.add(Gl(c[h]));return m}const{klass:o}=Zc[r];if(!o)throw new Error(`can't deserialize unregistered class ${r}`);if(o.deserialize)return o.deserialize(c);const u=Object.create(o.prototype);for(const m of Object.keys(c))m!=="$name"&&(u[m]=Gl(c[m]));return u}throw new Error("can't deserialize object of type "+typeof c)}const rr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function df(c){for(const r of c)if(pf(r.charCodeAt(0)))return!0;return!1}function ew(c){for(const r of c)if(!ff(r.charCodeAt(0)))return!1;return!0}function ff(c){return!(rr.Arabic(c)||rr["Arabic Supplement"](c)||rr["Arabic Extended-A"](c)||rr["Arabic Presentation Forms-A"](c)||rr["Arabic Presentation Forms-B"](c))}function pf(c){return!(c!==746&&c!==747&&(c<4352||!(rr["Bopomofo Extended"](c)||rr.Bopomofo(c)||rr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||rr["CJK Compatibility Ideographs"](c)||rr["CJK Compatibility"](c)||rr["CJK Radicals Supplement"](c)||rr["CJK Strokes"](c)||!(!rr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||rr["CJK Unified Ideographs Extension A"](c)||rr["CJK Unified Ideographs"](c)||rr["Enclosed CJK Letters and Months"](c)||rr["Hangul Compatibility Jamo"](c)||rr["Hangul Jamo Extended-A"](c)||rr["Hangul Jamo Extended-B"](c)||rr["Hangul Jamo"](c)||rr["Hangul Syllables"](c)||rr.Hiragana(c)||rr["Ideographic Description Characters"](c)||rr.Kanbun(c)||rr["Kangxi Radicals"](c)||rr["Katakana Phonetic Extensions"](c)||rr.Katakana(c)&&c!==12540||!(!rr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!rr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||rr["Unified Canadian Aboriginal Syllabics"](c)||rr["Unified Canadian Aboriginal Syllabics Extended"](c)||rr["Vertical Forms"](c)||rr["Yijing Hexagram Symbols"](c)||rr["Yi Syllables"](c)||rr["Yi Radicals"](c))))}function wh(c){return!(pf(c)||function(r){return!!(rr["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||rr["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||rr["Letterlike Symbols"](r)||rr["Number Forms"](r)||rr["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||rr["Control Pictures"](r)&&r!==9251||rr["Optical Character Recognition"](r)||rr["Enclosed Alphanumerics"](r)||rr["Geometric Shapes"](r)||rr["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||rr["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||rr["CJK Symbols and Punctuation"](r)||rr.Katakana(r)||rr["Private Use Area"](r)||rr["CJK Compatibility Forms"](r)||rr["Small Form Variants"](r)||rr["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(c))}function jm(c){return c>=1424&&c<=2303||rr["Arabic Presentation Forms-A"](c)||rr["Arabic Presentation Forms-B"](c)}function tw(c,r){return!(!r&&jm(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||rr.Khmer(c))}function rw(c){for(const r of c)if(jm(r.charCodeAt(0)))return!0;return!1}const Sh="deferred",Th="loading",mf="loaded";let Yc=null,Ni="unavailable",al=null;const y0=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Ni="error"),Yc&&Yc(c)};function Vm(){$m.fire(new el("pluginStateChange",{pluginStatus:Ni,pluginURL:al}))}const $m=new Ic,Wm=function(){return Ni},Gm=function(){if(Ni!==Sh||!al)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ni=Th,Vm(),al&&Mc({url:al},c=>{c?y0(c):(Ni=mf,Vm())})},Lo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ni===mf||Lo.applyArabicShaping!=null,isLoading:()=>Ni===Th,setState(c){Ni=c.pluginStatus,al=c.pluginURL},isParsed:()=>Lo.applyArabicShaping!=null&&Lo.processBidirectionalText!=null&&Lo.processStyledBidirectionalText!=null,getPluginURL:()=>al};class qn{constructor(r,o){this.zoom=r,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(o,u){for(const m of o)if(!tw(m.charCodeAt(0),u))return!1;return!0}(r,Lo.isLoaded())}}class gf{constructor(r,o,u,m){this.property=r,this.value=o,this.expression=function(h,g,b,M){if(af(h))return new cf(h,g);if(lf(h)||Array.isArray(h)&&h.length>0){const P=m0(h,g,b,M);if(P.result==="error")throw new Error(P.value.map(v=>`${v.key}: ${v.message}`).join(", "));return P.value}{let P=h;return typeof h=="string"&&g.type==="color"&&(P=un.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(o===void 0?r.specification.default:o,r.specification,u,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,o,u){return this.property.possiblyEvaluate(this,r,o,u)}}class Hm{constructor(r,o,u){this.property=r,this.value=new gf(r,void 0,o,u)}transitioned(r,o){return new x0(this.property,this.value,o,hi({},r.transition,this.transition),r.now)}untransitioned(){return new x0(this.property,this.value,null,{},0)}}class v0{constructor(r,o,u){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(r){return On(this._values[r].value.value)}setValue(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new Hm(this._values[r].property,this._scope,this._options)),this._values[r].value=new gf(this._values[r].property,o===null?void 0:On(o),this._scope,this._options),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,o){o&&(this._options=o);const u=this._properties.properties;if(r)for(const m in r){const h=r[m];if(la(m,"-transition")){const g=m.slice(0,-11);u[g]&&this.setTransition(g,h)}else u.hasOwnProperty(m)&&this.setValue(m,h)}}getTransition(r){return On(this._values[r].transition)}setTransition(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new Hm(this._values[r].property)),this._values[r].transition=On(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u);const m=this.getTransition(o);m!==void 0&&(r[`${o}-transition`]=m)}return r}transitioned(r,o){const u=new b0(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(r,o._values[m]);return u}untransitioned(){const r=new b0(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class x0{constructor(r,o,u,m,h){const g=m.delay||0,b=m.duration||0;h=h||0,this.property=r,this.value=o,this.begin=h+g,this.end=this.begin+b,r.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(r,o,u){const m=r.now||0,h=this.value.possiblyEvaluate(r,o,u),g=this.prior;if(g){if(m>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(m<this.begin)return g.possiblyEvaluate(r,o,u);{const b=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(r,o,u),h,Er(b))}}return h}}class b0{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,u){const m=new Kc(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(r,o,u);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class nw{constructor(r,o,u){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(r){return On(this._values[r].value)}setValue(r,o){this._values[r]=new gf(this._values[r].property,o===null?void 0:On(o),this._scope,this._options),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u)}return r}possiblyEvaluate(r,o,u){const m=new Kc(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(r,o,u);return m}}class Xc{constructor(r,o,u){this.property=r,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,u,m){return this.property.evaluate(this.value,this.parameters,r,o,u,m)}}class Kc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Pt{constructor(r){this.specification=r}possiblyEvaluate(r,o){return r.expression.evaluate(o)}interpolate(r,o,u){const m=Bl[this.specification.type];return m?m(r,o,u):r}}class nr{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,u,m){return new Xc(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},u,m)}:r.expression,o)}interpolate(r,o,u){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new Xc(this,{kind:"constant",value:void 0},r.parameters);const m=Bl[this.specification.type];return m?new Xc(this,{kind:"constant",value:m(r.value.value,o.value.value,u)},r.parameters):r}evaluate(r,o,u,m,h,g){return r.kind==="constant"?r.value:r.evaluate(o,u,m,h,g)}}class ka{constructor(r){this.specification=r}possiblyEvaluate(r,o,u,m){return!!r.expression.evaluate(o,null,{},u,m)}interpolate(){return!1}}class Ln{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new qn(0,{});for(const u in r){const m=r[u];m.specification.overridable&&this.overridableProperties.push(u);const h=this.defaultPropertyValues[u]=new gf(m,void 0),g=this.defaultTransitionablePropertyValues[u]=new Hm(m);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=h.possiblyEvaluate(o)}}}Zt(nr,"DataDrivenProperty"),Zt(Pt,"DataConstantProperty"),Zt(ka,"ColorRampProperty");var He=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Eh(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function _f(c){if(Array.isArray(c))return c.map(_f);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const r={};for(const o in c)r[o]=_f(c[o]);return r}return Eh(c)}function qm(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const r of c.slice(1))if(!qm(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Oa(c,r="",o=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qm(c)||(c=yf(c));const m=c;let h=!0;try{h=function(T){if(!Jc(T))return T;let I=_f(T);return Hl(I),I=Zm(I),I}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}const g=He[`filter_${u}`],b=bh(h,g,r,o);let M=null;if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));M=(T,I,E)=>b.value.evaluate(T,I,{},E);let P=null,v=null;if(h!==m){const T=bh(m,g,r,o);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));P=(I,E,C,D,O)=>T.value.evaluate(I,E,{},C,void 0,void 0,D,O),v=!fh(T.value.expression)}return{filter:M,dynamicFilter:P||void 0,needGeometry:w0(h),needFeature:!!v}}function Zm(c){if(!Array.isArray(c))return c;const r=function(o){if(iw.has(o[0])){for(let u=1;u<o.length;u++)if(Jc(o[u]))return!0}return o}(c);return r===!0?r:r.map(o=>Zm(o))}function Hl(c){let r=!1;const o=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)r=r||Jc(c[u]),o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="match"){r=r||Jc(c[1]);for(let u=2;u<c.length-1;u+=2)o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="step"){r=r||Jc(c[1]);for(let u=1;u<c.length-1;u+=2)o.push(c[u+1])}r&&(c.length=0,c.push("any",...o));for(let u=1;u<c.length;u++)Hl(c[u])}function Jc(c){if(!Array.isArray(c))return!1;if((r=c[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let o=1;o<c.length;o++)if(Jc(c[o]))return!0;return!1}const iw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ow(c,r){return c<r?-1:c>r?1:0}function w0(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let r=1;r<c.length;r++)if(w0(c[r]))return!0;return!1}function yf(c){if(!c)return!0;const r=c[0];return c.length<=1?r!=="any":r==="=="?vf(c[1],c[2],"=="):r==="!="?Ch(vf(c[1],c[2],"==")):r==="<"||r===">"||r==="<="||r===">="?vf(c[1],c[2],r):r==="any"?(o=c.slice(1),["any"].concat(o.map(yf))):r==="all"?["all"].concat(c.slice(1).map(yf)):r==="none"?["all"].concat(c.slice(1).map(yf).map(Ch)):r==="in"?xf(c[1],c.slice(2)):r==="!in"?Ch(xf(c[1],c.slice(2))):r==="has"?Mh(c[1]):r!=="!has"||Ch(Mh(c[1]));var o}function vf(c,r,o){switch(c){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,c,r]}}function xf(c,r){if(r.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(o=>typeof o!=typeof r[0])?["filter-in-large",c,["literal",r.sort(ow)]]:["filter-in-small",c,["literal",r]]}}function Mh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ch(c){return["!",c]}const Qc="";function S0(c,r){return r?`${c}${Qc}${r}`:c}const La="-transition",aw=new Set(["fill","line","background","hillshade","raster"]);class uo extends Ic{constructor(r,o,u,m,h){if(super(),this.id=r.id,this.fqid=S0(this.id,u),this.type=r.type,this.scope=u,this.lut=m,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),r.slot&&(this.slot=r.slot),o.layout&&(this._unevaluatedLayout=new nw(o.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint)){this._transitionablePaint=new v0(o.paint,this.scope,h);for(const g in r.paint)this.setPaintProperty(g,r.paint[g]);for(const g in r.layout)this.setLayoutProperty(g,r.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Kc(o.paint)}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D()&&aw.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,o){if(this.type==="custom"&&r==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(r){return la(r,La)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o){const u=this._transitionablePaint,m=u._properties.properties;if(la(r,La)){const T=r.slice(0,-11);return m[T]&&u.setTransition(T,o||void 0),!1}if(!m[r])return!1;const h=u._values[r],g=h.value.isDataDriven(),b=h.value;u.setValue(r,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const M=u._values[r].value,P=M.isDataDriven(),v=la(r,"pattern")||r==="line-dasharray";return P||g||v||this._handleOverridablePaintPropertyUpdate(r,b,M)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,o,u){return null}_handleOverridablePaintPropertyUpdate(r,o,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){return Mn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof Xc&&of(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Oa(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(r){}queryIntersectsFeature(r,o,u,m,h,g,b,M,P){}queryIntersectsMatchingFeature(r,o,u,m){}}const sw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ih{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.add(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function en(c,r=1){let o=0,u=0;return{members:c.map(m=>{const h=sw[m.type].BYTES_PER_ELEMENT,g=o=T0(o,Math.max(r,h)),b=m.components||1;return u=Math.max(u,h),o+=h*b,{name:m.name,type:m.type,components:b,offset:g}}),size:T0(o,Math.max(u,r)),alignment:r}}function T0(c,r){return Math.ceil(c/r)*r}class sl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const m=2*r;return this.int16[m+0]=o,this.int16[m+1]=u,r}}sl.prototype.bytesPerElement=4,Zt(sl,"StructArrayLayout2i4");class bf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u)}emplace(r,o,u,m){const h=3*r;return this.int16[h+0]=o,this.int16[h+1]=u,this.int16[h+2]=m,r}}bf.prototype.bytesPerElement=6,Zt(bf,"StructArrayLayout3i6");class ll extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,m)}emplace(r,o,u,m,h){const g=4*r;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=m,this.int16[g+3]=h,r}}ll.prototype.bytesPerElement=8,Zt(ll,"StructArrayLayout4i8");class wf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,m,h)}emplace(r,o,u,m,h,g){const b=5*r;return this.int16[b+0]=o,this.int16[b+1]=u,this.int16[b+2]=m,this.int16[b+3]=h,this.int16[b+4]=g,r}}wf.prototype.bytesPerElement=10,Zt(wf,"StructArrayLayout5i10");class Ym extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b){const M=this.length;return this.resize(M+1),this.emplace(M,r,o,u,m,h,g,b)}emplace(r,o,u,m,h,g,b,M){const P=6*r,v=12*r,T=3*r;return this.int16[P+0]=o,this.int16[P+1]=u,this.uint8[v+4]=m,this.uint8[v+5]=h,this.uint8[v+6]=g,this.uint8[v+7]=b,this.float32[T+2]=M,r}}Ym.prototype.bytesPerElement=12,Zt(Ym,"StructArrayLayout2i4ub1f12");class Cs extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,m)}emplace(r,o,u,m,h){const g=4*r;return this.float32[g+0]=o,this.float32[g+1]=u,this.float32[g+2]=m,this.float32[g+3]=h,r}}Cs.prototype.bytesPerElement=16,Zt(Cs,"StructArrayLayout4f16");class cl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u)}emplace(r,o,u,m){const h=3*r;return this.float32[h+0]=o,this.float32[h+1]=u,this.float32[h+2]=m,r}}cl.prototype.bytesPerElement=12,Zt(cl,"StructArrayLayout3f12");class Is extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,m,h)}emplace(r,o,u,m,h,g){const b=6*r,M=3*r;return this.uint16[b+0]=o,this.uint16[b+1]=u,this.uint16[b+2]=m,this.uint16[b+3]=h,this.float32[M+2]=g,r}}Is.prototype.bytesPerElement=12,Zt(Is,"StructArrayLayout4ui1f12");class ql extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,m)}emplace(r,o,u,m,h){const g=4*r;return this.uint16[g+0]=o,this.uint16[g+1]=u,this.uint16[g+2]=m,this.uint16[g+3]=h,r}}ql.prototype.bytesPerElement=8,Zt(ql,"StructArrayLayout4ui8");class Sf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,m,h,g)}emplace(r,o,u,m,h,g,b){const M=6*r;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=h,this.int16[M+4]=g,this.int16[M+5]=b,r}}Sf.prototype.bytesPerElement=12,Zt(Sf,"StructArrayLayout6i12");class Xm extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b,M,P,v,T,I){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,m,h,g,b,M,P,v,T,I)}emplace(r,o,u,m,h,g,b,M,P,v,T,I,E){const C=12*r;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=m,this.int16[C+3]=h,this.uint16[C+4]=g,this.uint16[C+5]=b,this.uint16[C+6]=M,this.uint16[C+7]=P,this.int16[C+8]=v,this.int16[C+9]=T,this.int16[C+10]=I,this.int16[C+11]=E,r}}Xm.prototype.bytesPerElement=24,Zt(Xm,"StructArrayLayout4i4ui4i24");class Km extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,m,h,g)}emplace(r,o,u,m,h,g,b){const M=10*r,P=5*r;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=m,this.float32[P+2]=h,this.float32[P+3]=g,this.float32[P+4]=b,r}}Km.prototype.bytesPerElement=20,Zt(Km,"StructArrayLayout3i3f20");class Jm extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}Jm.prototype.bytesPerElement=4,Zt(Jm,"StructArrayLayout1ul4");class ul extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const m=2*r;return this.uint16[m+0]=o,this.uint16[m+1]=u,r}}ul.prototype.bytesPerElement=4,Zt(ul,"StructArrayLayout2ui4");class eu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b,M,P,v,T,I,E){const C=this.length;return this.resize(C+1),this.emplace(C,r,o,u,m,h,g,b,M,P,v,T,I,E)}emplace(r,o,u,m,h,g,b,M,P,v,T,I,E,C){const D=20*r,O=10*r;return this.int16[D+0]=o,this.int16[D+1]=u,this.int16[D+2]=m,this.int16[D+3]=h,this.int16[D+4]=g,this.float32[O+3]=b,this.float32[O+4]=M,this.float32[O+5]=P,this.float32[O+6]=v,this.int16[D+14]=T,this.uint32[O+8]=I,this.uint16[D+18]=E,this.uint16[D+19]=C,r}}eu.prototype.bytesPerElement=40,Zt(eu,"StructArrayLayout5i4f1i1ul2ui40");class Zl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b){const M=this.length;return this.resize(M+1),this.emplace(M,r,o,u,m,h,g,b)}emplace(r,o,u,m,h,g,b,M){const P=8*r;return this.int16[P+0]=o,this.int16[P+1]=u,this.int16[P+2]=m,this.int16[P+4]=h,this.int16[P+5]=g,this.int16[P+6]=b,this.int16[P+7]=M,r}}Zl.prototype.bytesPerElement=16,Zt(Zl,"StructArrayLayout3i2i2i16");class xo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,m,h)}emplace(r,o,u,m,h,g){const b=4*r,M=8*r;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=m,this.int16[M+6]=h,this.int16[M+7]=g,r}}xo.prototype.bytesPerElement=16,Zt(xo,"StructArrayLayout2f1f2i16");class tu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,m,h,g)}emplace(r,o,u,m,h,g,b){const M=20*r,P=5*r;return this.uint8[M+0]=o,this.uint8[M+1]=u,this.float32[P+1]=m,this.float32[P+2]=h,this.float32[P+3]=g,this.float32[P+4]=b,r}}tu.prototype.bytesPerElement=20,Zt(tu,"StructArrayLayout2ub4f20");class qi extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u)}emplace(r,o,u,m){const h=3*r;return this.uint16[h+0]=o,this.uint16[h+1]=u,this.uint16[h+2]=m,r}}qi.prototype.bytesPerElement=6,Zt(qi,"StructArrayLayout3ui6");class Qm extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F,V,W,B,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F,V,W,B,H)}emplace(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F,V,W,B,H,Z){const re=30*r,de=15*r,me=60*r;return this.int16[re+0]=o,this.int16[re+1]=u,this.int16[re+2]=m,this.float32[de+2]=h,this.float32[de+3]=g,this.uint16[re+8]=b,this.uint16[re+9]=M,this.uint32[de+5]=P,this.uint32[de+6]=v,this.uint32[de+7]=T,this.uint16[re+16]=I,this.uint16[re+17]=E,this.uint16[re+18]=C,this.float32[de+10]=D,this.float32[de+11]=O,this.uint8[me+48]=F,this.uint8[me+49]=V,this.uint8[me+50]=W,this.uint32[de+13]=B,this.int16[re+28]=H,this.uint8[me+58]=Z,r}}Qm.prototype.bytesPerElement=60,Zt(Qm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class eg extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F,V,W,B,H,Z,re,de,me,ue,Te,_e,Ce,Oe,Fe,Be){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F,V,W,B,H,Z,re,de,me,ue,Te,_e,Ce,Oe,Fe,Be)}emplace(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F,V,W,B,H,Z,re,de,me,ue,Te,_e,Ce,Oe,Fe,Be,Ne){const qe=20*r,Ve=40*r,ot=80*r;return this.float32[qe+0]=o,this.float32[qe+1]=u,this.int16[Ve+4]=m,this.int16[Ve+5]=h,this.int16[Ve+6]=g,this.int16[Ve+7]=b,this.int16[Ve+8]=M,this.int16[Ve+9]=P,this.int16[Ve+10]=v,this.int16[Ve+11]=T,this.int16[Ve+12]=I,this.uint16[Ve+13]=E,this.uint16[Ve+14]=C,this.uint16[Ve+15]=D,this.uint16[Ve+16]=O,this.uint16[Ve+17]=F,this.uint16[Ve+18]=V,this.uint16[Ve+19]=W,this.uint16[Ve+20]=B,this.uint16[Ve+21]=H,this.uint16[Ve+22]=Z,this.uint16[Ve+23]=re,this.uint16[Ve+24]=de,this.uint16[Ve+25]=me,this.uint16[Ve+26]=ue,this.uint16[Ve+27]=Te,this.uint32[qe+14]=_e,this.float32[qe+15]=Ce,this.float32[qe+16]=Oe,this.float32[qe+17]=Fe,this.float32[qe+18]=Be,this.uint8[ot+76]=Ne,r}}eg.prototype.bytesPerElement=80,Zt(eg,"StructArrayLayout2f9i15ui1ul4f1ub80");class ru extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}ru.prototype.bytesPerElement=4,Zt(ru,"StructArrayLayout1f4");class Ps extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,m,h)}emplace(r,o,u,m,h,g){const b=5*r;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=m,this.float32[b+3]=h,this.float32[b+4]=g,r}}Ps.prototype.bytesPerElement=20,Zt(Ps,"StructArrayLayout5f20");class tg extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b){const M=this.length;return this.resize(M+1),this.emplace(M,r,o,u,m,h,g,b)}emplace(r,o,u,m,h,g,b,M){const P=7*r;return this.float32[P+0]=o,this.float32[P+1]=u,this.float32[P+2]=m,this.float32[P+3]=h,this.float32[P+4]=g,this.float32[P+5]=b,this.float32[P+6]=M,r}}tg.prototype.bytesPerElement=28,Zt(tg,"StructArrayLayout7f28");class Ph extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,m)}emplace(r,o,u,m,h){const g=6*r;return this.uint32[3*r+0]=o,this.uint16[g+2]=u,this.uint16[g+3]=m,this.uint16[g+4]=h,r}}Ph.prototype.bytesPerElement=12,Zt(Ph,"StructArrayLayout1ul3ui12");class rg extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}rg.prototype.bytesPerElement=2,Zt(rg,"StructArrayLayout1ui2");class Ah extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const m=2*r;return this.float32[m+0]=o,this.float32[m+1]=u,r}}Ah.prototype.bytesPerElement=8,Zt(Ah,"StructArrayLayout2f8");class Dh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O){const F=this.length;return this.resize(F+1),this.emplace(F,r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O)}emplace(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F){const V=16*r;return this.float32[V+0]=o,this.float32[V+1]=u,this.float32[V+2]=m,this.float32[V+3]=h,this.float32[V+4]=g,this.float32[V+5]=b,this.float32[V+6]=M,this.float32[V+7]=P,this.float32[V+8]=v,this.float32[V+9]=T,this.float32[V+10]=I,this.float32[V+11]=E,this.float32[V+12]=C,this.float32[V+13]=D,this.float32[V+14]=O,this.float32[V+15]=F,r}}Dh.prototype.bytesPerElement=64,Zt(Dh,"StructArrayLayout16f64");class Tf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,m,h,g,b){const M=this.length;return this.resize(M+1),this.emplace(M,r,o,u,m,h,g,b)}emplace(r,o,u,m,h,g,b,M){const P=10*r,v=5*r;return this.uint16[P+0]=o,this.uint16[P+1]=u,this.uint16[P+2]=m,this.uint16[P+3]=h,this.float32[v+2]=g,this.float32[v+3]=b,this.float32[v+4]=M,r}}Tf.prototype.bytesPerElement=20,Zt(Tf,"StructArrayLayout4ui3f20");class Ef extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.int16[1*r+0]=o,r}}Ef.prototype.bytesPerElement=2,Zt(Ef,"StructArrayLayout1i2");class Mf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint8[1*r+0]=o,r}}Mf.prototype.bytesPerElement=1,Zt(Mf,"StructArrayLayout1ub1");class E0 extends Ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}E0.prototype.size=40;class Cf extends eu{get(r){return new E0(this,r)}}Zt(Cf,"CollisionBoxArray");class Rh extends Ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Rh.prototype.size=60;class ng extends Qm{get(r){return new Rh(this,r)}}Zt(ng,"PlacedSymbolArray");class M0 extends Ih{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}M0.prototype.size=80;class ig extends eg{get(r){return new M0(this,r)}}Zt(ig,"SymbolInstanceArray");class C0 extends ru{getoffsetX(r){return this.float32[1*r+0]}}Zt(C0,"GlyphOffsetArray");class If extends sl{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Zt(If,"SymbolLineVertexArray");class I0 extends Ih{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}I0.prototype.size=12;class P0 extends Ph{get(r){return new I0(this,r)}}Zt(P0,"FeatureIndexArray");class A0 extends ul{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Zt(A0,"FillExtrusionCentroidArray");class D0 extends Ih{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}D0.prototype.size=6;class og extends bf{get(r){return new D0(this,r)}}Zt(og,"FillExtrusionWallArray");const lw=en([{name:"a_pos",components:2,type:"Int16"}],4),cw=en([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Zn{constructor(r=[]){this.segments=r}_prepareSegment(r,o,u,m){let h=this.segments[this.segments.length-1];return r>Zn.MAX_VERTEX_ARRAY_LENGTH&&Gr(`Max vertices per segment is ${Zn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!h||h.vertexLength+r>Zn.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==m)&&(h={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},m!==void 0&&(h.sortKey=m),this.segments.push(h)),h}prepareSegment(r,o,u,m){return this._prepareSegment(r,o.length,u.length,m)}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,u,m){return new Zn([{vertexOffset:r,primitiveOffset:o,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function R0(c,r){return 256*(c=hr(Math.floor(c),0,255))+hr(Math.floor(r),0,255)}Zn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(Zn,"SegmentVector");const uw=en([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hw=en([{name:"a_dash",components:4,type:"Uint16"}]);class kh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,o,u,m){this.ids.push(k0(r)),this.positions.push(o,u,m)}eachPosition(r,o){const u=k0(r);let m=0,h=this.ids.length-1;for(;m<h;){const g=m+h>>1;this.ids[g]>=u?h=g:m=g+1}for(;this.ids[m]===u;)o(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(r,o){const u=new Float64Array(r.ids),m=new Uint32Array(r.positions);return nu(u,m,0,u.length-1),o&&(o.add(u.buffer),o.add(m.buffer)),{ids:u,positions:m}}static deserialize(r){const o=new kh;let u;o.ids=r.ids,o.positions=r.positions;for(const m of o.ids)m!==u&&o.uniqueIds.push(m),u=m;return o.indexed=!0,o}}function k0(c){const r=+c;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Do(String(c))}function nu(c,r,o,u){for(;o<u;){const m=c[o+u>>1];let h=o-1,g=u+1;for(;;){do h++;while(c[h]<m);do g--;while(c[g]>m);if(h>=g)break;Pf(c,h,g),Pf(r,3*h,3*g),Pf(r,3*h+1,3*g+1),Pf(r,3*h+2,3*g+2)}g-o<u-g?(nu(c,r,o,g),o=g+1):(nu(c,r,g+1,u),u=g)}}function Pf(c,r,o){const u=c[r];c[r]=c[o],c[o]=u}Zt(kh,"FeaturePositionMap");class As{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,o),this.initialized=!0),!!this.location}set(r,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Yl extends As{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class ho extends As{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ns extends As{constructor(r){super(r),this.current=[0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class ag extends As{constructor(r){super(r),this.current=[0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Af extends As{constructor(r){super(r),this.current=[0,0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class sg extends As{constructor(r){super(r),this.current=un.transparent.toRenderColor(null)}set(r,o,u){this.fetchUniformLocation(r,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const O0=new Float32Array(16);class Oh extends As{constructor(r){super(r),this.current=O0}set(r,o,u){if(this.fetchUniformLocation(r,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const dw=new Float32Array(9),fw=new Float32Array(4);class lg extends As{constructor(r){super(r),this.current=fw}set(r,o,u){if(this.fetchUniformLocation(r,o)){for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function cg(c){return[R0(255*c.r,255*c.g),R0(255*c.b,255*c.a)]}class Lh{constructor(r,o,u,m){this.value=r,this.uniformNames=o.map(h=>`u_${h}`),this.type=u,this.context=m}setUniform(r,o,u,m,h){const g=m.constantOr(this.value);o.set(r,h,g instanceof un?g.toRenderColor(this.context.lut):g)}getBinding(r,o){return this.type==="color"?new sg(r):new ho(r)}}class iu{constructor(r,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,o,u,m,h){const g=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;g&&o.set(r,h,g)}getBinding(r,o){return o==="u_pattern"||o==="u_dash"?new Af(r):new ho(r)}}class is{constructor(r,o,u,m){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(h=>({name:`a_${h}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,o,u,m,h,g,b){const M=this.paintVertexArray.length,P=this.expression.evaluate(new qn(0,{brightness:g}),o,{},h,m,b);this.paintVertexArray.resize(r),this._setPaintValue(M,r,P,this.context)}updatePaintArray(r,o,u,m,h,g,b){const M=this.expression.evaluate({zoom:0,brightness:b},u,m,void 0,h);this._setPaintValue(r,o,M,this.context)}_setPaintValue(r,o,u,m){if(this.type==="color"){const h=cg(u.toRenderColor(m.lut));for(let g=r;g<o;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=r;h<o;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ko{constructor(r,o,u,m,h,g){this.expression=r,this.uniformNames=o.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=m,this.context=h,this.maxValue=0,this.paintVertexAttributes=o.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,o,u,m,h,g,b){const M=this.expression.evaluate(new qn(this.context.zoom,{brightness:g}),o,{},h,m,b),P=this.expression.evaluate(new qn(this.context.zoom+1,{brightness:g}),o,{},h,m,b),v=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(v,r,M,P,this.context)}updatePaintArray(r,o,u,m,h,g,b){const M=this.expression.evaluate({zoom:this.context.zoom,brightness:b},u,m,void 0,h),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},u,m,void 0,h);this._setPaintValue(r,o,M,P,this.context)}_setPaintValue(r,o,u,m,h){if(this.type==="color"){const g=cg(u.toRenderColor(h.lut)),b=cg(u.toRenderColor(h.lut));for(let M=r;M<o;M++)this.paintVertexArray.emplace(M,g[0],g[1],b[0],b[1])}else{for(let g=r;g<o;g++)this.paintVertexArray.emplace(g,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o,u,m,h){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=hr(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);o.set(r,h,b)}getBinding(r,o){return new ho(r)}}class os{constructor(r,o,u,m,h){this.expression=r,this.layerId=h,this.paintVertexAttributes=(u==="array"?hw:uw).members;for(let g=0;g<o.length;++g);this.paintVertexArray=new m}populatePaintArray(r,o,u,m){const h=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(h,r,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(r,o,u,m,h,g,b){this._setPaintValues(r,o,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(r,o,u,m){if(!m||!u)return;const h=m[u];if(!h)return;const{tl:g,br:b,pixelRatio:M}=h;for(let P=r;P<o;P++)this.paintVertexArray.emplace(P,g[0],g[1],b[0],b[1],M)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xl{constructor(r,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const m=[];for(const h in r.paint._values){const g=r.paint.get(h);if(!u(h)||!(g instanceof Xc&&of(g.property.specification)))continue;const b=mw(h,r.type),M=g.value,P=g.property.specification.type,v=!!g.property.useIntegerZoom,T=h==="line-dasharray"||h.endsWith("pattern"),I=h==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(M.kind!=="constant"||I)if(M.kind==="source"||I||T){const E=f(h,P,"source");this.binders[h]=T?new os(M,b,P,E,r.id):new is(M,b,P,E),m.push(`/a_${h}`)}else{const E=f(h,P,"composite");this.binders[h]=new Ko(M,b,P,v,o,E),m.push(`/z_${h}`)}else this.binders[h]=T?new iu(M.value,b):new Lh(M.value,b,P,o),m.push(`/u_${h}`)}this.cacheKey=m.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof is||o instanceof Ko?o.maxValue:0}populatePaintArrays(r,o,u,m,h,g,b){for(const M in this.binders){const P=this.binders[M];P.context=this.context,(P instanceof is||P instanceof Ko||P instanceof os)&&P.populatePaintArray(r,o,u,m,h,g,b)}}setConstantPatternPositions(r){for(const o in this.binders){const u=this.binders[o];u instanceof iu&&u.setConstantPatternPositions(r)}}updatePaintArrays(r,o,u,m,h,g,b,M){let P=!1;const v=Object.keys(r),T=v.length!==0,I=T?v:o.uniqueIds;this.context.lut=h.lut;for(const E in this.binders){const C=this.binders[E];if(C.context=this.context,(C instanceof is||C instanceof Ko||C instanceof os)&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){const D=h.paint.get(E);C.expression=D.value;for(const O of I){const F=r[O.toString()];o.eachPosition(O,(V,W,B)=>{const H=m.feature(V);C.updatePaintArray(W,B,H,F,g,b,M)})}if(!T)for(const O of u.uniqueIds){const F=r[O.toString()];u.eachPosition(O,(V,W,B)=>{const H=m.feature(V);C.updatePaintArray(W,B,H,F,g,b,M)})}P=!0}}return P}defines(){const r=[];for(const o in this.binders){const u=this.binders[o];(u instanceof Lh||u instanceof iu)&&r.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof is||u instanceof Ko||u instanceof os)for(let m=0;m<u.paintVertexAttributes.length;m++)r.push(u.paintVertexAttributes[m].name)}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Lh||u instanceof iu||u instanceof Ko)for(const m of u.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const o=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Lh||m instanceof iu||m instanceof Ko)for(const h of m.uniformNames)o.push({name:h,property:u,binding:m.getBinding(r,h)})}return o}setUniforms(r,o,u,m,h){for(const{name:g,property:b,binding:M}of u)this.binders[b].setUniform(r,M,h,m.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const o=this.binders[r];(o instanceof is||o instanceof Ko||o instanceof os)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(r){for(const o in this.binders){const u=this.binders[o];(u instanceof is||u instanceof Ko||u instanceof os)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof is||o instanceof Ko||o instanceof os)&&o.destroy()}}}class hl{constructor(r,o,u=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new Xl(m,o,u);this.needsUpload=!1,this._featureMap=new kh,this._featureMapWithoutIds=new kh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,o,u,m,h,g,b,M){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,o,m,h,g,b,M);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,u,m,h,g){for(const b of u)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,o,b,m,h,g||0)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const pw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function mw(c,r){return pw[c]||[c.replace(`${r}-`,"").replace(/-/g,"_")]}const gw={"line-pattern":{source:Is,composite:Is},"fill-pattern":{source:Is,composite:Is},"fill-extrusion-pattern":{source:Is,composite:Is},"line-dasharray":{source:ql,composite:ql}},L0={color:{source:Ah,composite:Cs},number:{source:ru,composite:Ah}};function f(c,r,o){const u=gw[c];return u&&u[o]||L0[r][o]}Zt(Lh,"ConstantBinder"),Zt(iu,"PatternConstantBinder"),Zt(is,"SourceExpressionBinder"),Zt(os,"PatternCompositeBinder"),Zt(Ko,"CompositeExpressionBinder"),Zt(Xl,"ProgramConfiguration",{omit:["_buffers"]}),Zt(hl,"ProgramConfigurationSet");const n=zt/Math.PI/2,s=5,p=6,_=16383,x=64,w=[x,32,16],A=-n,k=n;function L(c,r,o,u=n){return o=sr(o),[c*Math.sin(o)*u,-r*u,c*Math.cos(o)*u]}function z(c,r,o){return L(Math.cos(sr(c)),Math.sin(sr(c)),r,o)}const U=63710088e-1,j=2*Math.PI*U;class ${constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $(ao(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,u=this.lat*o,m=r.lat*o,h=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((r.lng-this.lng)*o);return U*Math.acos(Math.min(h,1))}toBounds(r=0){const o=360*r/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Y({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(r){return z(this.lat,this.lng,n+r*n/U)}static convert(r){if(r instanceof $)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new $(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new $(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Y{constructor(r,o){if(r)if(o)this.setSouthWest(r).setNorthEast(o);else if(r.length===4){const u=r;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=r;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(r){return this._ne=r instanceof $?new $(r.lng,r.lat):$.convert(r),this}setSouthWest(r){return this._sw=r instanceof $?new $(r.lng,r.lat):$.convert(r),this}extend(r){const o=this._sw,u=this._ne;let m,h;if(r instanceof $)m=r,h=r;else{if(!(r instanceof Y))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Y.convert(r)):this.extend($.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend($.convert(r)):this;if(m=r._sw,h=r._ne,!m||!h)return this}return o||u?(o.lng=Math.min(m.lng,o.lng),o.lat=Math.min(m.lat,o.lat),u.lng=Math.max(h.lng,u.lng),u.lat=Math.max(h.lat,u.lat)):(this._sw=new $(m.lng,m.lat),this._ne=new $(h.lng,h.lat)),this}getCenter(){return new $((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new $(this.getWest(),this.getNorth())}getSouthEast(){return new $(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:o,lat:u}=$.convert(r);let m=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(r){if(r)return r instanceof Y?r:new Y(r)}}const K=0,J=25.5;function Q(c){return j*Math.cos(c*Math.PI/180)}function fe(c){return(180+c)/360}function ge(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function he(c,r){return c/Q(r)}function xe(c){return 360*c-180}function ve(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Ie(c,r){return c*Q(ve(r))}const Ee=85.051129;function Pe(c){return Math.cos(sr(hr(c,-Ee,Ee)))}function ze(c,r){const o=hr(r,K,J),u=Math.pow(2,o);return Pe(c)*j/(512*u)}function ke(c){return 1/Math.cos(c*Math.PI/180)}function De(c,r=0){const o=Math.exp(Math.PI*(1-(c.y+r/zt)/(1<<c.z)*2));return 80150034*o/(o*o+1)/zt/(1<<c.z)}class $e{constructor(r,o,u=0){this.x=+r,this.y=+o,this.z=+u}static fromLngLat(r,o=0){const u=$.convert(r);return new $e(fe(u.lng),ge(u.lat),he(o,u.lat))}toLngLat(){return new $(xe(this.x),ve(this.y))}toAltitude(){return Ie(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/j*ke(ve(this.y))}}function nt(c,r,o,u,m,h,g,b,M){const P=(r+u)/2,v=(o+m)/2,T=new lt(P,v);b(T),function(I,E,C,D,O,F){const V=C-O,W=D-F;return Math.abs((D-E)*V-(C-I)*W)/Math.hypot(V,W)}(T.x,T.y,h.x,h.y,g.x,g.y)>=M?(nt(c,r,o,P,v,h,T,b,M),nt(c,P,v,u,m,T,g,b,M)):c.push(g)}function pt(c,r,o){let u=c[0],m=u.x,h=u.y;r(u);const g=[u];for(let b=1;b<c.length;b++){const M=c[b],{x:P,y:v}=M;r(M),nt(g,m,h,P,v,u,M,r,o),m=P,h=v,u=M}return g}function rt(c,r,o,u){if(u(r,o)){const m=r.add(o)._mult(.5);rt(c,r,m,u),rt(c,m,o,u)}else c.push(o)}function xt(c,r){let o=c[0];const u=[o];for(let m=1;m<c.length;m++){const h=c[m];rt(u,o,h,r),o=h}return u}const We=Math.pow(2,14)-1,ut=-We-1;function at(c,r){const o=Math.round(c.x*r),u=Math.round(c.y*r);return c.x=hr(o,ut,We),c.y=hr(u,ut,We),(o<c.x||o>c.x+1||u<c.y||u>c.y+1)&&Gr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function wt(c,r,o){const u=c.loadGeometry(),m=c.extent,h=zt/m;if(r&&o&&o.projection.isReprojectedInTileSpace){const g=1<<r.z,{scale:b,x:M,y:P,projection:v}=o,T=I=>{const E=xe((r.x+I.x/m)/g),C=ve((r.y+I.y/m)/g),D=v.project(E,C);I.x=(D.x*b-M)*m,I.y=(D.y*b-P)*m};for(let I=0;I<u.length;I++)if(c.type!==1)u[I]=pt(u[I],T,1);else{const E=[];for(const C of u[I])C.x<0||C.x>=m||C.y<0||C.y>=m||(T(C),E.push(C));u[I]=E}}for(const g of u)for(const b of g)at(b,h);return u}function Et(c,r){return{type:c.type,id:c.id,properties:c.properties,geometry:r?wt(c):[]}}function ft(c,r,o,u,m){c.emplaceBack(2*r+(u+1)/2,2*o+(m+1)/2)}function _t(c,r,o){c.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class ir{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new sl,this.indexArray=new qi,this.segments=new Zn,this.programConfigurations=new hl(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(r,o){}populate(r,o,u,m){const h=this.layers[0],g=[];let b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(const{feature:P,id:v,index:T,sourceLayerIndex:I}of r){const E=this.layers[0]._featureFilter.needGeometry,C=Et(P,E);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),C,u))continue;const D=b?b.evaluate(C,{},u):void 0,O={id:v,properties:P.properties,type:P.type,sourceLayerIndex:I,index:T,geometry:E?C.geometry:wt(P,u,m),patterns:{},sortKey:D};g.push(O)}b&&g.sort((P,v)=>P.sortKey-v.sortKey);let M=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Sf,M=m.projection);for(const P of g){const{geometry:v,index:T,sourceLayerIndex:I}=P,E=r[T].feature;this.addFeature(P,v,T,o.availableImages,u,M,o.brightness),o.featureIndex.insert(E,v,T,I,this.index)}}update(r,o,u,m,h){const g=Object.keys(r).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(r,o,g?this.stateDependentLayers:this.layers,u,m,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,lw.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,cw.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,o,u,m,h,g,b){for(const M of o)for(const P of M){const v=P.x,T=P.y;if(v<0||v>=zt||T<0||T>=zt)continue;if(g){const C=g.projectTilePoint(v,T,h),D=g.upVector(h,v,T),O=this.globeExtVertexArray;_t(O,C,D),_t(O,C,D),_t(O,C,D),_t(O,C,D)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),E=I.vertexLength;ft(this.layoutVertexArray,v,T,-1,-1),ft(this.layoutVertexArray,v,T,1,-1),ft(this.layoutVertexArray,v,T,1,1),ft(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},m,h,b)}}function kt(c,r){for(let o=0;o<c.length;o++)if(Cn(r,c[o]))return!0;for(let o=0;o<r.length;o++)if(Cn(c,r[o]))return!0;return!!lr(c,r)}function Vt(c,r,o){return!!Cn(c,r)||!!Pr(r,c,o)}function dr(c,r){if(c.length===1)return xn(r,c[0]);for(let o=0;o<r.length;o++){const u=r[o];for(let m=0;m<u.length;m++)if(Cn(c,u[m]))return!0}for(let o=0;o<c.length;o++)if(xn(r,c[o]))return!0;for(let o=0;o<r.length;o++)if(lr(c,r[o]))return!0;return!1}function Jt(c,r,o){if(c.length>1){if(lr(c,r))return!0;for(let u=0;u<r.length;u++)if(Pr(r[u],c,o))return!0}for(let u=0;u<c.length;u++)if(Pr(c[u],r,o))return!0;return!1}function lr(c,r){if(c.length===0||r.length===0)return!1;for(let o=0;o<c.length-1;o++){const u=c[o],m=c[o+1];for(let h=0;h<r.length-1;h++)if(Or(u,m,r[h],r[h+1]))return!0}return!1}function Or(c,r,o,u){return Ka(c,o,u)!==Ka(r,o,u)&&Ka(c,r,o)!==Ka(c,r,u)}function Pr(c,r,o){const u=o*o;if(r.length===1)return c.distSqr(r[0])<u;for(let m=1;m<r.length;m++)if(pn(c,r[m-1],r[m])<u)return!0;return!1}function pn(c,r,o){const u=r.distSqr(o);if(u===0)return c.distSqr(r);const m=((c.x-r.x)*(o.x-r.x)+(c.y-r.y)*(o.y-r.y))/u;return c.distSqr(m<0?r:m>1?o:o.sub(r)._mult(m)._add(r))}function xn(c,r){let o,u,m,h=!1;for(let g=0;g<c.length;g++){o=c[g];for(let b=0,M=o.length-1;b<o.length;M=b++)u=o[b],m=o[M],u.y>r.y!=m.y>r.y&&r.x<(m.x-u.x)*(r.y-u.y)/(m.y-u.y)+u.x&&(h=!h)}return h}function Cn(c,r){let o=!1;for(let u=0,m=c.length-1;u<c.length;m=u++){const h=c[u],g=c[m];h.y>r.y!=g.y>r.y&&r.x<(g.x-h.x)*(r.y-h.y)/(g.y-h.y)+h.x&&(o=!o)}return o}function ha(c,r,o,u,m){for(const g of c)if(r<=g.x&&o<=g.y&&u>=g.x&&m>=g.y)return!0;const h=[new lt(r,o),new lt(r,m),new lt(u,m),new lt(u,o)];if(c.length>2){for(const g of h)if(Cn(c,g))return!0}for(let g=0;g<c.length-1;g++)if(si(c[g],c[g+1],h))return!0;return!1}function si(c,r,o){const u=o[0],m=o[2];if(c.x<u.x&&r.x<u.x||c.x>m.x&&r.x>m.x||c.y<u.y&&r.y<u.y||c.y>m.y&&r.y>m.y)return!1;const h=Ka(c,r,o[0]);return h!==Ka(c,r,o[1])||h!==Ka(c,r,o[2])||h!==Ka(c,r,o[3])}function $r(c,r,o,u,m,h){let g=r.y-c.y,b=c.x-r.x;if(h=h||0){const M=g*g+b*b;if(M===0)return!0;const P=Math.sqrt(M);g/=P,b/=P}return!((o.x-c.x)*g+(o.y-c.y)*b-h<0||(u.x-c.x)*g+(u.y-c.y)*b-h<0||(m.x-c.x)*g+(m.y-c.y)*b-h<0)}function yn(c,r,o,u,m,h,g){return!($r(c,r,u,m,h,g)||$r(r,o,u,m,h,g)||$r(o,c,u,m,h,g)||$r(u,m,c,r,o,g)||$r(m,h,c,r,o,g)||$r(h,u,c,r,o,g))}function zn(c,r,o){const u=r.paint.get(c).value;return u.kind==="constant"?u.value:o.programConfigurations.get(r.id).getMaxValue(c)}function _n(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Ar(c,r,o,u,m){if(!r[0]&&!r[1])return c;const h=lt.convert(r)._mult(m);o==="viewport"&&h._rotate(-u);const g=[];for(let b=0;b<c.length;b++)g.push(c[b].sub(h));return g}function tn(c,r,o,u){const m=lt.convert(c)._mult(u);return r==="viewport"&&m._rotate(-o),m}let hn,Yn;Zt(ir,"CircleBucket",{omit:["layers"]});var li,Xr={exports:{}},Ti=(li||(li=1,function(c,r){(function(o){function u(h,g,b){var M=m(256*h,256*(g=Math.pow(2,b)-g-1),b),P=m(256*(h+1),256*(g+1),b);return M[0]+","+M[1]+","+P[0]+","+P[1]}function m(h,g,b){var M=2*Math.PI*6378137/256/Math.pow(2,b);return[h*M-2*Math.PI*6378137/2,g*M-2*Math.PI*6378137/2]}o.getURL=function(h,g,b,M,P,v){return v=v||{},h+"?"+["bbox="+u(b,M,P),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+g].join("&")},o.getTileBBox=u,o.getMercCoords=m,Object.defineProperty(o,"__esModule",{value:!0})})(r)}(0,Xr.exports)),Xr.exports);class Oi{constructor(r,o,u){this.z=r,this.x=o,this.y=u,this.key=bo(0,r,r,o,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o){const u=Ti.getTileBBox(this.x,this.y,this.z),m=function(h,g,b){let M,P="";for(let v=h;v>0;v--)M=1<<v-1,P+=(g&M?1:0)+(b&M?2:0);return P}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ei{constructor(r,o){this.wrap=r,this.canonical=o,this.key=bo(r,o.z,o.z,o.x,o.y)}}class Sn{constructor(r,o,u,m,h){this.overscaledZ=r,this.wrap=o,this.canonical=new Oi(u,+m,+h),this.key=o===0&&r===u?this.canonical.key:bo(o,r,u,m,h)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const o=this.canonical.z-r;return r>this.canonical.z?new Sn(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sn(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o=!0){if(this.overscaledZ===r&&o)return this.key;if(r>this.canonical.z)return bo(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return bo(this.wrap*+o,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new Sn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Sn(o,this.wrap,o,u,m),new Sn(o,this.wrap,o,u+1,m),new Sn(o,this.wrap,o,u,m+1),new Sn(o,this.wrap,o,u+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Sn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Sn(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ei(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bo(c,r,o,u,m){const h=1<<Math.min(o,22);let g=h*(m%h)+u%h;return c&&o<22&&(g+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-o)))),16*(32*g+o)+(r-o)}const wo=[c=>{let r=c.canonical.x-1,o=c.wrap;return r<0&&(r=(1<<c.canonical.z)-1,o--),new Sn(c.overscaledZ,o,c.canonical.z,r,c.canonical.y)},c=>{let r=c.canonical.x+1,o=c.wrap;return r===1<<c.canonical.z&&(r=0,o++),new Sn(c.overscaledZ,o,c.canonical.z,r,c.canonical.y)},c=>new Sn(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Sn(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Zt(Oi,"CanonicalTileID"),Zt(Sn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const da=en([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Jo}=da,zo=en([{name:"a_pos_3",components:3,type:"Int16"}]);var fa=en([{name:"a_pos",type:"Int16",components:2}]);class Ds{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,u){const m=be.vec3.dot(o,this.dir);if(Math.abs(m)<1e-6)return!1;const h=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1]+(r[2]-this.pos[2])*o[2])/m;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,u[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(r,o,u){if(be.vec3.equals(this.pos,r)||o===0)return u[0]=u[1]=u[2]=0,!1;const[m,h,g]=this.dir,b=this.pos[0]-r[0],M=this.pos[1]-r[1],P=this.pos[2]-r[2],v=m*m+h*h+g*g,T=2*(b*m+M*h+P*g),I=T*T-4*v*(b*b+M*M+P*P-o*o);if(I<0){const E=Math.max(-T/2,0),C=b+m*E,D=M+h*E,O=P+g*E,F=Math.hypot(C,D,O);return u[0]=C*o/F,u[1]=D*o/F,u[2]=O*o/F,!1}{const E=(-T-Math.sqrt(I))/(2*v);if(E<0){const C=Math.hypot(b,M,P);return u[0]=b*o/C,u[1]=M*o/C,u[2]=P*o/C,!1}return u[0]=b+m*E,u[1]=M+h*E,u[2]=P+g*E,!0}}}class dl{constructor(r,o,u,m,h){this.TL=r,this.TR=o,this.BR=u,this.BL=m,this.horizon=h}static fromInvProjectionMatrix(r,o,u){const m=[-1,1,1],h=[1,1,1],g=[1,-1,1],b=[-1,-1,1],M=be.vec3.transformMat4(m,m,r),P=be.vec3.transformMat4(h,h,r),v=be.vec3.transformMat4(g,g,r),T=be.vec3.transformMat4(b,b,r);return new dl(M,P,v,T,o/u)}}function as(c,r,o){let u=1/0,m=-1/0;const h=[];for(const g of c){be.vec3.sub(h,g,r);const b=be.vec3.dot(h,o);u=Math.min(u,b),m=Math.max(m,b)}return[u,m]}function ou(c,r){let o=!0;for(let u=0;u<c.planes.length;u++){const m=c.planes[u];let h=0;for(let g=0;g<r.length;g++)h+=be.vec3.dot(m,r[g])+m[3]>=0;if(h===0)return 0;h!==r.length&&(o=!1)}return o?2:1}function au(c,r){for(const o of c.projections){const u=as(r,c.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function Df(c,r){let o=0;const u=[0,0,0,0];for(let m=0;m<c.length;m++)u[0]=c[m][0],u[1]=c[m][1],u[2]=c[m][2],u[3]=1,be.vec4.dot(u,r)>=0&&o++;return o}class su{constructor(r,o){this.points=r||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Tn.fromPoints(this.points),this.projections=[],this.frustumEdges=[be.vec3.sub([],this.points[2],this.points[3]),be.vec3.sub([],this.points[0],this.points[3]),be.vec3.sub([],this.points[4],this.points[0]),be.vec3.sub([],this.points[5],this.points[1]),be.vec3.sub([],this.points[6],this.points[2]),be.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const m=[0,-u[2],u[1]],h=[u[2],0,-u[0]];this.projections.push({axis:m,projection:as(this.points,this.points[0],m)}),this.projections.push({axis:h,projection:as(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(r,o,u,m){const h=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const v=be.vec4.transformMat4([],P,r),T=1/v[3]/o*h;return be.vec4.mul(v,v,[T,T,m?1/v[3]:T,T])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const v=be.vec3.sub([],g[P[0]],g[P[1]]),T=be.vec3.sub([],g[P[2]],g[P[1]]),I=be.vec3.normalize([],be.vec3.cross([],v,T)),E=-be.vec3.dot(I,g[P[1]]);return I.concat(E)}),M=[];for(let P=0;P<g.length;P++)M.push([g[P][0],g[P][1],g[P][2]]);return new su(M,b)}intersectsPrecise(r,o,u){for(let m=0;m<o.length;m++)if(!Df(r,o[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!Df(r,this.planes[m]))return 0;for(const m of u)for(const h of this.frustumEdges){const g=be.vec3.cross([],m,h),b=be.vec3.length(g);if(b===0)continue;be.vec3.scale(g,g,1/b);const M=as(this.points,this.points[0],g),P=as(r,this.points[0],g);if(M[0]>P[1]||P[0]>M[1])return 0}return 1}containsPoint(r){for(const o of this.planes){const u=o[3];if(be.vec3.dot([o[0],o[1],o[2]],r)+u<0)return!1}return!0}}class Tn{static fromPoints(r){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of r)be.vec3.min(o,o,m),be.vec3.max(u,u,m);return new Tn(o,u)}static fromTileIdAndHeight(r,o,u){const m=1<<r.canonical.z,h=r.canonical.x,g=r.canonical.y;return new Tn([h/m,g/m,o],[(h+1)/m,(g+1)/m,u])}static applyTransform(r,o){const u=r.getCorners();for(let m=0;m<u.length;++m)be.vec3.transformMat4(u[m],u[m],o);return Tn.fromPoints(u)}static applyTransformFast(r,o){const u=[o[12],o[13],o[14]],m=[...u];for(let h=0;h<3;h++)for(let g=0;g<3;g++){const b=o[4*g+h],M=b*r.min[g],P=b*r.max[g];u[h]+=Math.min(M,P),m[h]+=Math.max(M,P)}return new Tn(u,m)}static projectAabbCorners(r,o){const u=r.getCorners();for(let m=0;m<u.length;++m)be.vec3.transformMat4(u[m],u[m],o);return u}constructor(r,o){this.min=r,this.max=o,this.center=be.vec3.scale([],be.vec3.add([],this.min,this.max),.5)}quadrant(r){const o=[r%2==0,r<2],u=be.vec3.clone(this.min),m=be.vec3.clone(this.max);for(let h=0;h<o.length;h++)u[h]=o[h]?this.min[h]:this.center[h],m[h]=o[h]?this.center[h]:this.max[h];return m[2]=this.max[2],new Tn(u,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,o=this.max;return[[r[0],r[1],r[2]],[o[0],r[1],r[2]],[o[0],o[1],r[2]],[r[0],o[1],r[2]],[r[0],r[1],o[2]],[o[0],r[1],o[2]],[o[0],o[1],o[2]],[r[0],o[1],o[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?ou(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?ou(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,o){return o||this.intersects(r)?au(r,this.getCorners()):0}intersectsPreciseFlat(r,o){return o||this.intersectsFlat(r)?au(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let o=0;o<3;++o)if(this.min[o]>r.max[o]||r.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],r.min[o]),this.max[o]=Math.max(this.max[o],r.max[o])}encapsulatePoint(r){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],r[o]),this.max[o]=Math.max(this.max[o],r[o])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}function Kl(c){return c*n/U}Zt(Tn,"Aabb");const _w=[new Tn([A,A,A],[k,k,k]),new Tn([A,A,A],[0,0,k]),new Tn([0,A,A],[k,0,k]),new Tn([A,0,A],[0,k,k]),new Tn([0,0,A],[k,k,k])];function z0(c,r,o,u=!0){const m=be.vec3.scale([],c._camera.position,c.worldSize),h=[r,o,1,1];be.vec4.transformMat4(h,h,c.pixelMatrixInverse),be.vec4.scale(h,h,1/h[3]);const g=be.vec3.sub([],h,m),b=be.vec3.normalize([],g),M=c.globeMatrix,P=[M[12],M[13],M[14]],v=be.vec3.sub([],P,m),T=be.vec3.length(v),I=be.vec3.normalize([],v),E=c.worldSize/(2*Math.PI),C=be.vec3.dot(I,b),D=Math.asin(E/T);if(D<Math.acos(C)){if(!u)return null;const Te=[],_e=[];be.vec3.scale(Te,b,T/C),be.vec3.normalize(_e,be.vec3.sub(_e,Te,v)),be.vec3.normalize(b,be.vec3.add(b,v,be.vec3.scale(b,_e,Math.tan(D)*T)))}const O=[];new Ds(m,b).closestPointOnSphere(P,E,O);const F=be.vec3.normalize([],Fl(M,0)),V=be.vec3.normalize([],Fl(M,1)),W=be.vec3.normalize([],Fl(M,2)),B=be.vec3.dot(F,O),H=be.vec3.dot(V,O),Z=be.vec3.dot(W,O),re=Hr(Math.asin(-H/E));let de=Hr(Math.atan2(B,Z));de=c.center.lng+function(Te,_e){const Ce=(_e-Te+180)%360-180;return Ce<-180?Ce+360:Ce}(c.center.lng,de);const me=fe(de),ue=hr(ge(re),0,1);return new $e(me,ue)}class U5{constructor(r,o,u){this.a=be.vec3.sub([],r,u),this.b=be.vec3.sub([],o,u),this.center=u;const m=be.vec3.normalize([],this.a),h=be.vec3.normalize([],this.b);this.angle=Math.acos(be.vec3.dot(m,h))}}function yw(c,r){if(c.angle===0)return null;let o;return o=c.a[r]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[r]/c.a[r]/Math.sin(c.angle)-1/Math.tan(c.angle)),o<0||o>1?null:function(u,m,h,g){const b=Math.sin(h);return u*(Math.sin((1-g)*h)/b)+m*(Math.sin(g*h)/b)}(c.a[r],c.b[r],c.angle,hr(o,0,1))+c.center[r]}function fl(c){if(c.z<=1)return _w[c.z+2*c.y+c.x];const r=vw(F0(c));return Tn.fromPoints(r)}function Jl(c,r,o){return be.vec3.scale(c,c,1-o),be.vec3.scaleAndAdd(c,c,r,o)}function dI(c,r,o){for(const u of c)be.vec3.transformMat4(u,u,r),be.vec3.scale(u,u,o)}function fI(c,r,o,u){const m=r/c.worldSize,h=c.globeMatrix;if(o.z<=1){const me=fl(o).getCorners();return dI(me,h,m),Tn.fromPoints(me)}const g=F0(o,u),b=vw(g,n+Kl(c._tileCoverLift));dI(b,h,m);const M=Number.MAX_VALUE,P=[-M,-M,-M],v=[M,M,M];if(g.contains(c.center)){for(const Te of b)be.vec3.min(v,v,Te),be.vec3.max(P,P,Te);P[2]=0;const me=c.point,ue=[me.x*m,me.y*m,0];return be.vec3.min(v,v,ue),be.vec3.max(P,P,ue),new Tn(v,P)}if(c._tileCoverLift>0){for(const me of b)be.vec3.min(v,v,me),be.vec3.max(P,P,me);return new Tn(v,P)}const T=[h[12]*m,h[13]*m,h[14]*m],I=g.getCenter(),E=hr(c.center.lat,-Ee,Ee),C=hr(I.lat,-Ee,Ee),D=fe(c.center.lng),O=ge(E);let F=D-fe(I.lng);const V=O-ge(C);F>.5?F-=1:F<-.5&&(F+=1);let W=0;if(Math.abs(F)>Math.abs(V))W=F>=0?1:3;else{W=V>=0?0:2;const me=[h[4]*m,h[5]*m,h[6]*m],ue=-Math.sin(sr(V>=0?g.getSouth():g.getNorth()))*n;be.vec3.scaleAndAdd(T,T,me,ue)}const B=b[W],H=b[(W+1)%4],Z=new U5(B,H,T),re=[yw(Z,0)||B[0],yw(Z,1)||B[1],yw(Z,2)||B[2]],de=lu(c.zoom);if(de>0){const me=function({x:Te,y:_e,z:Ce},Oe,Fe,Be,Ne){const qe=1/(1<<Ce);let Ve=Te*qe,ot=Ve+qe,mt=_e*qe,tt=mt+qe,Nt=0;const Ot=(Ve+ot)/2-Be;return Ot>.5?Nt=-1:Ot<-.5&&(Nt=1),Ve=((Ve+Nt)*Oe-(Be*=Oe))*Fe+Be,ot=((ot+Nt)*Oe-Be)*Fe+Be,mt=(mt*Oe-(Ne*=Oe))*Fe+Ne,tt=(tt*Oe-Ne)*Fe+Ne,[[Ve,tt,0],[ot,tt,0],[ot,mt,0],[Ve,mt,0]]}(o,r,c._pixelsPerMercatorPixel,D,O);for(let Te=0;Te<b.length;Te++)Jl(b[Te],me[Te],de);const ue=be.vec3.add([],me[W],me[(W+1)%4]);be.vec3.scale(ue,ue,.5),Jl(re,ue,de)}for(const me of b)be.vec3.min(v,v,me),be.vec3.max(P,P,me);return v[2]=Math.min(B[2],H[2]),be.vec3.min(v,v,re),be.vec3.max(P,P,re),new Tn(v,P)}function F0({x:c,y:r,z:o},u=!1){const m=1/(1<<o),h=new $(xe(c*m),r===(1<<o)-1&&u?-90:ve((r+1)*m)),g=new $(xe((c+1)*m),r===0&&u?90:ve(r*m));return new Y(h,g)}function vw(c,r=n){const o=sr(c.getNorth()),u=sr(c.getSouth()),m=Math.cos(o),h=Math.cos(u),g=Math.sin(o),b=Math.sin(u),M=c.getWest(),P=c.getEast();return[L(h,b,M,r),L(h,b,P,r),L(m,g,P,r),L(m,g,M,r)]}function ug(c,r,o,u){const m=1<<o.z,h=(c/zt+o.x)/m;return z(ve((r/zt+o.y)/m),xe(h),u)}function B0({min:c,max:r}){return _/Math.max(r[0]-c[0],r[1]-c[1],r[2]-c[2])}const pI=new Float64Array(16);function N0(c){const r=B0(c),o=be.mat4.fromScaling(pI,[r,r,r]);return be.mat4.translate(o,o,be.vec3.negate([],c.min))}function xw(c){const r=be.mat4.fromTranslation(pI,c.min),o=1/B0(c);return be.mat4.scale(r,r,[o,o,o])}function bw(c){const r=zt/(2*Math.PI);return c/(2*Math.PI)/r}function mI(c,r){return zt/(512*Math.pow(2,c))*B0(fl(r))}function gI(c,r,o,u,m){const h=bw(o),g=[c,r,-o/(2*Math.PI)],b=be.mat4.identity(new Float64Array(16));return be.mat4.translate(b,b,g),be.mat4.scale(b,b,[h,h,h]),be.mat4.rotateX(b,b,sr(-m)),be.mat4.rotateY(b,b,sr(-u)),b}function lu(c){return Po(s,p,c)}function _I(c,r){const o=z(r.lat,r.lng),u=function(h){const g=z(h._center.lat,h._center.lng),b=be.vec3.fromValues(0,1,0);let M=be.vec3.cross([],b,g);const P=be.mat4.fromRotation([],-h.angle,g);M=be.vec3.transformMat4(M,M,P),be.mat4.fromRotation(P,-h._pitch,M);const v=be.vec3.normalize([],g);return be.vec3.scale(v,v,Kl(h.cameraToCenterDistance/h.pixelsPerMeter)),be.vec3.transformMat4(v,v,P),be.vec3.add([],g,v)}(c),m=be.vec3.subtract([],u,o);return be.vec3.angle(m,o)}function ww(c,r){return _I(c,r)>Math.PI/2*1.01}const yI=sr(85),j5=Math.cos(yI),V5=Math.sin(yI),$5=be.mat4.create(),vI=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function xI(c,r,o,u,m,h,g,b,M){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(M*=c.pixelToTileUnitsFactor);const P=c.tileID.canonical,v=o.projection.upVectorScale(P,o.center.lat,o.worldSize).metersToTile;for(const T of r)for(const I of T){const E=I.add(b),C=m&&o.elevation?o.elevation.exaggeration()*m.getElevationAt(E.x,E.y,!0):0,D=o.projection.projectTilePoint(E.x,E.y,P);if(C>0){const W=o.projection.upVector(P,E.x,E.y);D.x+=W[0]*v*C,D.y+=W[1]*v*C,D.z+=W[2]*v*C}const O=h?E:W5(D.x,D.y,D.z,u),F=h?c.tilespaceRays.map(W=>H5(W,C)):c.queryGeometry.screenGeometry,V=be.vec4.transformMat4([],[D.x,D.y,D.z,1],u);if(!g&&h?M*=V[3]/o.cameraToCenterDistance:g&&!h&&(M*=o.cameraToCenterDistance/V[3]),h){const W=ve((I.y/zt+P.y)/(1<<P.z));M/=o.projection.pixelsPerMeter(W,1)/he(1,W)}if(Vt(F,O,M))return!0}return!1}function W5(c,r,o,u){const m=be.vec4.transformMat4([],[c,r,o,1],u);return new lt(m[0]/m[3],m[1]/m[3])}const bI=be.vec3.fromValues(0,0,0),G5=be.vec3.fromValues(0,0,1);function H5(c,r){const o=be.vec3.create();return bI[2]=r,c.intersectsPlane(bI,G5,o),new lt(o[0],o[1])}class wI extends ir{}let SI,TI,EI,MI;function CI(c,{width:r,height:o},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*o*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(r*o*u);return c.width=r,c.height=o,c.data=m,c}function II(c,r,o){const{width:u,height:m}=r;u===c.width&&m===c.height||(Sw(c,r,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,m)},o,null),c.width=u,c.height=m,c.data=r.data)}function Sw(c,r,o,u,m,h,g,b){if(m.width===0||m.height===0)return r;if(m.width>c.width||m.height>c.height||o.x>c.width-m.width||o.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||u.x>r.width-m.width||u.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const M=c.data,P=r.data,v=h===4&&b;for(let T=0;T<m.height;T++){const I=((o.y+T)*c.width+o.x)*h,E=((u.y+T)*r.width+u.x)*h;if(v)for(let C=0;C<m.width;C++){const D=I+C*h+3,O=E+C*h;P[O+0]=255,P[O+1]=255,P[O+2]=255,P[O+3]=M[D]}else if(g)for(let C=0;C<m.width;C++){const D=I+C*h,O=E+C*h,F=M[D+3],V=new un(M[D+0]/255*F,M[D+1]/255*F,M[D+2]/255*F,F).toRenderColor(g).toArray();P[O+0]=V[0],P[O+1]=V[1],P[O+2]=V[2],P[O+3]=V[3]}else for(let C=0;C<m.width*h;C++)P[E+C]=M[I+C]}return r}Zt(wI,"HeatmapBucket",{omit:["layers"]});class cu{constructor(r,o){CI(this,r,1,o)}resize(r){II(this,new cu(r),1)}clone(){return new cu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,m,h){Sw(r,o,u,m,h,1,null)}}class So{constructor(r,o){CI(this,r,4,o)}resize(r){II(this,new So(r),4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,m,h,g,b){Sw(r,o,u,m,h,4,g,b)}}class PI{constructor(r,o){this.width=r.width,this.height=r.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function hg(c){const r={},o=c.resolution||256,u=c.clips?c.clips.length:1,m=c.image||new So({width:o,height:u}),h=(g,b,M)=>{r[c.evaluationKey]=M;const P=c.expression.evaluate(r);P&&(m.data[g+b+0]=Math.floor(255*P.r/P.a),m.data[g+b+1]=Math.floor(255*P.g/P.a),m.data[g+b+2]=Math.floor(255*P.b/P.a),m.data[g+b+3]=Math.floor(255*P.a))};if(c.clips)for(let g=0,b=0;g<u;++g,b+=4*o)for(let M=0,P=0;M<o;M++,P+=4){const v=M/(o-1),{start:T,end:I}=c.clips[g];h(b,P,T*(1-v)+I*v)}else for(let g=0,b=0;g<o;g++,b+=4)h(0,b,g/(o-1));return m}Zt(cu,"AlphaImage"),Zt(So,"RGBAImage");const q5=en([{name:"a_pos",components:2,type:"Int16"}],4),{members:Z5}=q5;function dg(c,r,o=2){const u=r&&r.length,m=u?r[0]*o:c.length;let h=AI(c,0,m,o,!0);const g=[];if(!h||h.next===h.prev)return g;let b,M,P;if(u&&(h=function(v,T,I,E){const C=[];for(let D=0,O=T.length;D<O;D++){const F=AI(v,T[D]*E,D<O-1?T[D+1]*E:v.length,E,!1);F===F.next&&(F.steiner=!0),C.push(rN(F))}C.sort(Q5);for(let D=0;D<C.length;D++)I=eN(C[D],I);return I}(c,r,h,o)),c.length>80*o){b=1/0,M=1/0;let v=-1/0,T=-1/0;for(let I=o;I<m;I+=o){const E=c[I],C=c[I+1];E<b&&(b=E),C<M&&(M=C),E>v&&(v=E),C>T&&(T=C)}P=Math.max(v-b,T-M),P=P!==0?32767/P:0}return fg(h,g,o,b,M,P,0),g}function AI(c,r,o,u,m){let h;if(m===function(g,b,M,P){let v=0;for(let T=b,I=M-P;T<M;T+=P)v+=(g[I]-g[T])*(g[T+1]+g[I+1]),I=T;return v}(c,r,o,u)>0)for(let g=r;g<o;g+=u)h=kI(g/u|0,c[g],c[g+1],h);else for(let g=o-u;g>=r;g-=u)h=kI(g/u|0,c[g],c[g+1],h);return h&&U0(h,h.next)&&(mg(h),h=h.next),h}function zh(c,r){if(!c)return c;r||(r=c);let o,u=c;do if(o=!1,u.steiner||!U0(u,u.next)&&Mi(u.prev,u,u.next)!==0)u=u.next;else{if(mg(u),u=r=u.prev,u===u.next)break;o=!0}while(o||u!==r);return r}function fg(c,r,o,u,m,h,g){if(!c)return;!g&&h&&function(M,P,v,T){let I=M;do I.z===0&&(I.z=Tw(I.x,I.y,P,v,T)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==M);I.prevZ.nextZ=null,I.prevZ=null,function(E){let C,D=1;do{let O,F=E;E=null;let V=null;for(C=0;F;){C++;let W=F,B=0;for(let Z=0;Z<D&&(B++,W=W.nextZ,W);Z++);let H=D;for(;B>0||H>0&&W;)B!==0&&(H===0||!W||F.z<=W.z)?(O=F,F=F.nextZ,B--):(O=W,W=W.nextZ,H--),V?V.nextZ=O:E=O,O.prevZ=V,V=O;F=W}V.nextZ=null,D*=2}while(C>1)}(I)}(c,u,m,h);let b=c;for(;c.prev!==c.next;){const M=c.prev,P=c.next;if(h?X5(c,u,m,h):Y5(c))r.push(M.i,c.i,P.i),mg(c),c=P.next,b=P.next;else if((c=P)===b){g?g===1?fg(c=K5(zh(c),r),r,o,u,m,h,2):g===2&&J5(c,r,o,u,m,h):fg(zh(c),r,o,u,m,h,1);break}}}function Y5(c){const r=c.prev,o=c,u=c.next;if(Mi(r,o,u)>=0)return!1;const m=r.x,h=o.x,g=u.x,b=r.y,M=o.y,P=u.y,v=m<h?m<g?m:g:h<g?h:g,T=b<M?b<P?b:P:M<P?M:P,I=m>h?m>g?m:g:h>g?h:g,E=b>M?b>P?b:P:M>P?M:P;let C=u.next;for(;C!==r;){if(C.x>=v&&C.x<=I&&C.y>=T&&C.y<=E&&Rf(m,b,h,M,g,P,C.x,C.y)&&Mi(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function X5(c,r,o,u){const m=c.prev,h=c,g=c.next;if(Mi(m,h,g)>=0)return!1;const b=m.x,M=h.x,P=g.x,v=m.y,T=h.y,I=g.y,E=b<M?b<P?b:P:M<P?M:P,C=v<T?v<I?v:I:T<I?T:I,D=b>M?b>P?b:P:M>P?M:P,O=v>T?v>I?v:I:T>I?T:I,F=Tw(E,C,r,o,u),V=Tw(D,O,r,o,u);let W=c.prevZ,B=c.nextZ;for(;W&&W.z>=F&&B&&B.z<=V;){if(W.x>=E&&W.x<=D&&W.y>=C&&W.y<=O&&W!==m&&W!==g&&Rf(b,v,M,T,P,I,W.x,W.y)&&Mi(W.prev,W,W.next)>=0||(W=W.prevZ,B.x>=E&&B.x<=D&&B.y>=C&&B.y<=O&&B!==m&&B!==g&&Rf(b,v,M,T,P,I,B.x,B.y)&&Mi(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;W&&W.z>=F;){if(W.x>=E&&W.x<=D&&W.y>=C&&W.y<=O&&W!==m&&W!==g&&Rf(b,v,M,T,P,I,W.x,W.y)&&Mi(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;B&&B.z<=V;){if(B.x>=E&&B.x<=D&&B.y>=C&&B.y<=O&&B!==m&&B!==g&&Rf(b,v,M,T,P,I,B.x,B.y)&&Mi(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function K5(c,r){let o=c;do{const u=o.prev,m=o.next.next;!U0(u,m)&&DI(u,o,o.next,m)&&pg(u,m)&&pg(m,u)&&(r.push(u.i,o.i,m.i),mg(o),mg(o.next),o=c=m),o=o.next}while(o!==c);return zh(o)}function J5(c,r,o,u,m,h){let g=c;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&nN(g,b)){let M=RI(g,b);return g=zh(g,g.next),M=zh(M,M.next),fg(g,r,o,u,m,h,0),void fg(M,r,o,u,m,h,0)}b=b.next}g=g.next}while(g!==c)}function Q5(c,r){return c.x-r.x}function eN(c,r){const o=function(m,h){let g=h;const b=m.x,M=m.y;let P,v=-1/0;do{if(M<=g.y&&M>=g.next.y&&g.next.y!==g.y){const D=g.x+(M-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(D<=b&&D>v&&(v=D,P=g.x<g.next.x?g:g.next,D===b))return P}g=g.next}while(g!==h);if(!P)return null;const T=P,I=P.x,E=P.y;let C=1/0;g=P;do{if(b>=g.x&&g.x>=I&&b!==g.x&&Rf(M<E?b:v,M,I,E,M<E?v:b,M,g.x,g.y)){const D=Math.abs(M-g.y)/(b-g.x);pg(g,m)&&(D<C||D===C&&(g.x>P.x||g.x===P.x&&tN(P,g)))&&(P=g,C=D)}g=g.next}while(g!==T);return P}(c,r);if(!o)return r;const u=RI(o,c);return zh(u,u.next),zh(o,o.next)}function tN(c,r){return Mi(c.prev,c,r.prev)<0&&Mi(r.next,c,c.next)<0}function Tw(c,r,o,u,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-o)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function rN(c){let r=c,o=c;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==c);return o}function Rf(c,r,o,u,m,h,g,b){return(m-g)*(r-b)>=(c-g)*(h-b)&&(c-g)*(u-b)>=(o-g)*(r-b)&&(o-g)*(h-b)>=(m-g)*(u-b)}function nN(c,r){return c.next.i!==r.i&&c.prev.i!==r.i&&!function(o,u){let m=o;do{if(m.i!==o.i&&m.next.i!==o.i&&m.i!==u.i&&m.next.i!==u.i&&DI(m,m.next,o,u))return!0;m=m.next}while(m!==o);return!1}(c,r)&&(pg(c,r)&&pg(r,c)&&function(o,u){let m=o,h=!1;const g=(o.x+u.x)/2,b=(o.y+u.y)/2;do m.y>b!=m.next.y>b&&m.next.y!==m.y&&g<(m.next.x-m.x)*(b-m.y)/(m.next.y-m.y)+m.x&&(h=!h),m=m.next;while(m!==o);return h}(c,r)&&(Mi(c.prev,c,r.prev)||Mi(c,r.prev,r))||U0(c,r)&&Mi(c.prev,c,c.next)>0&&Mi(r.prev,r,r.next)>0)}function Mi(c,r,o){return(r.y-c.y)*(o.x-r.x)-(r.x-c.x)*(o.y-r.y)}function U0(c,r){return c.x===r.x&&c.y===r.y}function DI(c,r,o,u){const m=V0(Mi(c,r,o)),h=V0(Mi(c,r,u)),g=V0(Mi(o,u,c)),b=V0(Mi(o,u,r));return m!==h&&g!==b||!(m!==0||!j0(c,o,r))||!(h!==0||!j0(c,u,r))||!(g!==0||!j0(o,c,u))||!(b!==0||!j0(o,r,u))}function j0(c,r,o){return r.x<=Math.max(c.x,o.x)&&r.x>=Math.min(c.x,o.x)&&r.y<=Math.max(c.y,o.y)&&r.y>=Math.min(c.y,o.y)}function V0(c){return c>0?1:c<0?-1:0}function pg(c,r){return Mi(c.prev,c,c.next)<0?Mi(c,r,c.next)>=0&&Mi(c,c.prev,r)>=0:Mi(c,r,c.prev)<0||Mi(c,c.next,r)<0}function RI(c,r){const o=Ew(c.i,c.x,c.y),u=Ew(r.i,r.x,r.y),m=c.next,h=r.prev;return c.next=r,r.prev=c,o.next=m,m.prev=o,u.next=o,o.prev=u,h.next=u,u.prev=h,u}function kI(c,r,o,u){const m=Ew(c,r,o);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function mg(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Ew(c,r,o){return{i:c,x:r,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $0(c,r){const o=c.length;if(o<=1)return[c];const u=[];let m,h;for(let g=0;g<o;g++){const b=Ad(c[g]);b!==0&&(c[g].area=Math.abs(b),h===void 0&&(h=b<0),h===b<0?(m&&u.push(m),m=[c[g]]):m.push(c[g]))}if(m&&u.push(m),r>1)for(let g=0;g<u.length;g++)u[g].length<=r||(By(u[g],r,1,u[g].length-1,iN),u[g]=u[g].slice(0,r));return u}function iN(c,r){return r.area-c.area}function Mw(c,r,o){const u=o.patternDependencies;let m=!1;for(const h of r){const g=h.paint.get(`${c}-pattern`);g.isConstant()||(m=!0);const b=g.constantOr(null);b&&(m=!0,u[b]=!0)}return m}function Cw(c,r,o,u,m){const h=m.patternDependencies;for(const g of r){const b=g.paint.get(`${c}-pattern`).value;if(b.kind!=="constant"){let M=b.evaluate({zoom:u},o,{},m.availableImages);M=M&&M.name?M.name:M,h[M]=!0,o.patterns[g.id]=M}}return o}class Iw{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new sl,this.indexArray=new qi,this.indexArray2=new ul,this.programConfigurations=new hl(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Zn,this.segments2=new Zn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=r.projection}updateFootprints(r,o){}populate(r,o,u,m){this.hasPattern=Mw("fill",this.layers,o);const h=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:M,index:P,sourceLayerIndex:v}of r){const T=this.layers[0]._featureFilter.needGeometry,I=Et(b,T);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),I,u))continue;const E=h?h.evaluate(I,{},u,o.availableImages):void 0,C={id:M,properties:b.properties,type:b.type,sourceLayerIndex:v,index:P,geometry:T?I.geometry:wt(b,u,m),patterns:{},sortKey:E};g.push(C)}h&&g.sort((b,M)=>b.sortKey-M.sortKey);for(const b of g){const{geometry:M,index:P,sourceLayerIndex:v}=b;if(this.hasPattern){const T=Cw("fill",this.layers,b,this.zoom,o);this.patternFeatures.push(T)}else this.addFeature(b,M,P,u,{},o.availableImages,o.brightness);o.featureIndex.insert(r[P].feature,M,P,v,this.index)}}update(r,o,u,m,h){const g=Object.keys(r).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(r,o,g?this.stateDependentLayers:this.layers,u,m,h)}addFeatures(r,o,u,m,h,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Z5),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,o,u,m,h,g=[],b){for(const M of $0(o,500)){let P=0;for(const D of M)P+=D.length;const v=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),T=v.vertexLength,I=[],E=[];for(const D of M){if(D.length===0)continue;D!==M[0]&&E.push(I.length/2);const O=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),F=O.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(F+D.length-1,F),I.push(D[0].x),I.push(D[0].y);for(let V=1;V<D.length;V++)this.layoutVertexArray.emplaceBack(D[V].x,D[V].y),this.indexArray2.emplaceBack(F+V-1,F+V),I.push(D[V].x),I.push(D[V].y);O.vertexLength+=D.length,O.primitiveLength+=D.length}const C=dg(I,E);for(let D=0;D<C.length;D+=3)this.indexArray.emplaceBack(T+C[D],T+C[D+1],T+C[D+2]);v.vertexLength+=P,v.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,b)}}let OI,LI,zI,FI;Zt(Iw,"FillBucket",{omit:["layers","patternFeatures"]});class Pw{constructor(r,o,u,m){if(this.triangleCount=o.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[h,g]=[r[0].clone(),r[0].clone()];for(let T=1;T<r.length;++T){const I=r[T];h.x=Math.min(h.x,I.x),h.y=Math.min(h.y,I.y),g.x=Math.max(g.x,I.x),g.y=Math.max(g.y,I.y)}if(m){const T=Math.ceil(Math.max(g.x-h.x,g.y-h.y)/m);u=Math.max(u,T)}if(u===0)return;this.min=h,this.max=g;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const M=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/M)),this.cellsY=Math.max(1,Math.ceil(b.y/M)),this.xScale=1/M,this.yScale=1/M;const P=[];for(let T=0;T<this.triangleCount;T++){const I=r[o[3*T+0]].sub(this.min),E=r[o[3*T+1]].sub(this.min),C=r[o[3*T+2]].sub(this.min),D=pl(Math.floor(Math.min(I.x,E.x,C.x)),this.xScale,this.cellsX),O=pl(Math.floor(Math.max(I.x,E.x,C.x)),this.xScale,this.cellsX),F=pl(Math.floor(Math.min(I.y,E.y,C.y)),this.yScale,this.cellsY),V=pl(Math.floor(Math.max(I.y,E.y,C.y)),this.yScale,this.cellsY),W=new lt(0,0),B=new lt(0,0),H=new lt(0,0),Z=new lt(0,0);for(let re=F;re<=V;++re){W.y=B.y=re*M,H.y=Z.y=(re+1)*M;for(let de=D;de<=O;++de)W.x=H.x=de*M,B.x=Z.x=(de+1)*M,(yn(I,E,C,W,B,Z)||yn(I,E,C,W,Z,H))&&P.push({cellIdx:re*this.cellsX+de,triIdx:T})}}if(P.length===0)return;P.sort((T,I)=>T.cellIdx-I.cellIdx||T.triIdx-I.triIdx);let v=0;for(;v<P.length;){const T=P[v].cellIdx,I={start:this.payload.length,len:0};for(;v<P.length&&P[v].cellIdx===T;)++I.len,this.payload.push(P[v++].triIdx);this.cells[T]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,o){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=pl(r.x-this.min.x,this.xScale,this.cellsX),m=pl(r.y-this.min.y,this.yScale,this.cellsY),h=this.cells[m*this.cellsX+u];if(h){this._lazyInitLookup();for(let g=0;g<h.len;g++){const b=this.payload[h.start+g],M=Math.floor(b/8),P=1<<b%8;if(!(this.lookup[M]&P)&&(this.lookup[M]|=P,o.push(b),o.length===this.triangleCount))return}}}query(r,o,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>o.x||r.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const m=pl(r.x-this.min.x,this.xScale,this.cellsX),h=pl(o.x-this.min.x,this.xScale,this.cellsX),g=pl(r.y-this.min.y,this.yScale,this.cellsY),b=pl(o.y-this.min.y,this.yScale,this.cellsY);for(let M=g;M<=b;M++)for(let P=m;P<=h;P++){const v=this.cells[M*this.cellsX+P];if(v)for(let T=0;T<v.len;T++){const I=this.payload[v.start+T],E=Math.floor(I/8),C=1<<I%8;if(!(this.lookup[E]&C)&&(this.lookup[E]|=C,u.push(I),u.length===this.triangleCount))return}}}}function pl(c,r,o){return Math.max(0,Math.min(o-1,Math.floor(c*r)))}Zt(Pw,"TriangleGridIndex");class BI{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(r,o){for(const u of this.footprints)o.push({footprint:u,id:r})}populate(r,o,u,m){const h=[];for(const{feature:g,id:b,index:M,sourceLayerIndex:P}of r){const v=this.layers[0]._featureFilter.needGeometry,T=Et(g,v);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),T,u))continue;const I={id:b,properties:g.properties,type:g.type,sourceLayerIndex:P,index:M,geometry:v?T.geometry:wt(g,u,m),patterns:{}};h.push(I)}for(const g of h){const{geometry:b,index:M,sourceLayerIndex:P}=g;this.addFeature(g,b,M,u,{},o.availableImages,o.brightness),o.featureIndex.insert(r[M].feature,b,M,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,o,u,m,h){}destroy(){}addFeature(r,o,u,m,h,g=[],b){for(const M of $0(o,2)){const P=[],v=[],T=[],I=new lt(1/0,1/0),E=new lt(-1/0,-1/0);for(const O of M)if(O.length!==0){O!==M[0]&&T.push(v.length/2);for(let F=0;F<O.length;F++)v.push(O[F].x),v.push(O[F].y),P.push(O[F]),I.x=Math.min(I.x,O[F].x),I.y=Math.min(I.y,O[F].y),E.x=Math.max(E.x,O[F].x),E.y=Math.max(E.y,O[F].y)}const C=dg(v,T),D=new Pw(P,C,8,256);this.footprints.push({vertices:P,indices:C,grid:D,min:I,max:E})}}}Zt(BI,"ClipBucket",{omit:["layers"]});const oN=en([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aN=en([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),sN=en([{name:"a_centroid_pos",components:2,type:"Uint16"}]),lN=en([{name:"a_join_normal_inside",components:3,type:"Int16"}]),cN=en([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),uN=en([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:hN}=oN;var Aw,NI,Dw,UI,Rw,jI,VI,W0={};function $I(){if(NI)return Aw;NI=1;var c=pr();function r(m,h,g,b,M){this.properties={},this.extent=g,this.type=0,this._pbf=m,this._geometry=-1,this._keys=b,this._values=M,m.readFields(o,this,h)}function o(m,h,g){m==1?h.id=g.readVarint():m==2?function(b,M){for(var P=b.readVarint()+b.pos;b.pos<P;){var v=M._keys[b.readVarint()],T=M._values[b.readVarint()];M.properties[v]=T}}(g,h):m==3?h.type=g.readVarint():m==4&&(h._geometry=g.pos)}function u(m){for(var h,g,b=0,M=0,P=m.length,v=P-1;M<P;v=M++)b+=((g=m[v]).x-(h=m[M]).x)*(h.y+g.y);return b}return Aw=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var h,g=m.readVarint()+m.pos,b=1,M=0,P=0,v=0,T=[];m.pos<g;){if(M<=0){var I=m.readVarint();b=7&I,M=I>>3}if(M--,b===1||b===2)P+=m.readSVarint(),v+=m.readSVarint(),b===1&&(h&&T.push(h),h=[]),h.push(new c(P,v));else{if(b!==7)throw new Error("unknown command "+b);h&&h.push(h[0].clone())}}return h&&T.push(h),T},r.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var h=m.readVarint()+m.pos,g=1,b=0,M=0,P=0,v=1/0,T=-1/0,I=1/0,E=-1/0;m.pos<h;){if(b<=0){var C=m.readVarint();g=7&C,b=C>>3}if(b--,g===1||g===2)(M+=m.readSVarint())<v&&(v=M),M>T&&(T=M),(P+=m.readSVarint())<I&&(I=P),P>E&&(E=P);else if(g!==7)throw new Error("unknown command "+g)}return[v,I,T,E]},r.prototype.toGeoJSON=function(m,h,g){var b,M,P=this.extent*Math.pow(2,g),v=this.extent*m,T=this.extent*h,I=this.loadGeometry(),E=r.types[this.type];function C(F){for(var V=0;V<F.length;V++){var W=F[V];F[V]=[360*(W.x+v)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+T)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(b=0;b<I.length;b++)D[b]=I[b][0];C(I=D);break;case 2:for(b=0;b<I.length;b++)C(I[b]);break;case 3:for(I=function(F){var V=F.length;if(V<=1)return[F];for(var W,B,H=[],Z=0;Z<V;Z++){var re=u(F[Z]);re!==0&&(B===void 0&&(B=re<0),B===re<0?(W&&H.push(W),W=[F[Z]]):W.push(F[Z]))}return W&&H.push(W),H}(I),b=0;b<I.length;b++)for(M=0;M<I[b].length;M++)C(I[b][M])}I.length===1?I=I[0]:E="Multi"+E;var O={type:"Feature",geometry:{type:E,coordinates:I},properties:this.properties};return"id"in this&&(O.id=this.id),O},Aw}function WI(){if(UI)return Dw;UI=1;var c=$I();function r(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,m),this.length=this._features.length}function o(u,m,h){u===15?m.version=h.readVarint():u===1?m.name=h.readString():u===5?m.extent=h.readVarint():u===2?m._features.push(h.pos):u===3?m._keys.push(h.readString()):u===4&&m._values.push(function(g){for(var b=null,M=g.readVarint()+g.pos;g.pos<M;){var P=g.readVarint()>>3;b=P===1?g.readString():P===2?g.readFloat():P===3?g.readDouble():P===4?g.readVarint64():P===5?g.readVarint():P===6?g.readSVarint():P===7?g.readBoolean():null}return b}(h))}return Dw=r,r.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,m,this.extent,this._keys,this._values)},Dw}function GI(){return VI||(VI=1,W0.VectorTile=function(){if(jI)return Rw;jI=1;var c=WI();function r(o,u,m){if(o===3){var h=new c(m,m.readVarint()+m.pos);h.length&&(u[h.name]=h)}}return Rw=function(o,u){this.layers=o.readFields(r,{},u)},Rw}(),W0.VectorTileFeature=$I(),W0.VectorTileLayer=WI()),W0}var kf=GI();class Fh extends lt{constructor(r,o,u){super(r,o),this.z=u}}class HI extends Fh{constructor(r,o,u,m){super(r,o,u),this.w=m}}function G0(c,r,o,u){const m=[],h=u===0?(g,b,M,P,v,T)=>{g.push(new lt(T,M+(T-b)/(P-b)*(v-M)))}:(g,b,M,P,v,T)=>{g.push(new lt(b+(T-M)/(v-M)*(P-b),T))};for(const g of c){const b=[];for(const M of g){if(M.length<=2)continue;const P=[];for(let I=0;I<M.length-1;I++){const E=M[I].x,C=M[I].y,D=M[I+1].x,O=M[I+1].y,F=u===0?E:C,V=u===0?D:O;F<r?V>r&&h(P,E,C,D,O,r):F>o?V<o&&h(P,E,C,D,O,o):P.push(M[I]),V<r&&F>=r&&h(P,E,C,D,O,r),V>o&&F<=o&&h(P,E,C,D,O,o)}let v=M[M.length-1];const T=u===0?v.x:v.y;T>=r&&T<=o&&P.push(v),P.length&&(v=P[P.length-1],P[0].x===v.x&&P[0].y===v.y||P.push(P[0]),b.push(P))}b.length&&m.push(b)}return m}function qI(c,r,o,u){const m=o==="x"?"y":"x",h=(u-c[o])/(r[o]-c[o]);c[m]=c[m]+(r[m]-c[m])*h,c[o]=u,c.hasOwnProperty("z")&&(c.z=ur(c.z,r.z,h)),c.hasOwnProperty("w")&&(c.w=ur(c.w,r.w,h))}function ZI(c,r,o,u){const m=o,h=u;for(const g of["x","y"]){let b=c,M=r;b[g]>=M[g]&&(b=r,M=c),b[g]<m&&M[g]>m&&qI(b,M,g,m),b[g]<h&&M[g]>h&&qI(M,b,g,h)}}const H0=Number.MAX_SAFE_INTEGER;function YI(c,r,o,u){return c.order<r||c.order===H0||!(c.clipMask&o)||function(m,h){return h.length!==0&&h.find(g=>g===m)===void 0}(u,c.clipScope)}function q0(c,r){return c.x-r.x||c.y-r.y}function XI(c,r){return q0(c.min,r.min)===0&&q0(c.max,r.max)===0}function kw(c,r){return!(c.min.x>r.max.x||c.max.x<r.min.x||c.min.y>r.max.y||c.max.y<r.min.y)}function Ow(c,r){if(c.length!==r.length)return!1;for(let o=0;o<c.length;o++)if(c[o].sourceId!==r[o].sourceId||!XI(c[o],r[o])||c[o].order!==r[o].order||c[o].clipMask!==r[o].clipMask||!Lr(c[o].clipScope,r[o].clipScope))return!1;return!0}function KI(c,r,o){const u=1/zt,m=1/(1<<o.canonical.z),h=(r.x*u+o.canonical.x)*m+o.wrap,g=(r.y*u+o.canonical.y)*m;return{min:new lt((c.x*u+o.canonical.x)*m+o.wrap,(c.y*u+o.canonical.y)*m),max:new lt(h,g)}}function dN(c,r,o){const u=1<<o.canonical.z,m=((r.x-o.wrap)*u-o.canonical.x)*zt,h=(r.y*u-o.canonical.y)*zt;return{min:new lt(((c.x-o.wrap)*u-o.canonical.x)*zt,(c.y*u-o.canonical.y)*zt),max:new lt(m,h)}}function JI(c,r,o,u,m,h,g){const b=c.indices,M=c.vertices,P=[];for(let v=u;v<u+m;v+=3){const T=r[o[v+0]+h],I=r[o[v+1]+h],E=r[o[v+2]+h],C=Math.min(T.x,I.x,E.x),D=Math.max(T.x,I.x,E.x),O=Math.min(T.y,I.y,E.y),F=Math.max(T.y,I.y,E.y);P.length=0,c.grid.query(new lt(C,O),new lt(D,F),P);for(let V=0;V<P.length;V++){const W=P[V];if(yn(M[b[3*W+0]],M[b[3*W+1]],M[b[3*W+2]],T,I,E,g))return!0}}return!1}function QI(c,r,o,u){if(!c||!o)return!1;let m=c.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(o.vertices.length<c.vertices.length)return QI(o,u,c,r);const h=r.canonical,g=u.canonical,b=Math.pow(2,g.z-h.z);m=c.vertices.map(M=>new lt((M.x+h.x*zt)*b-g.x*zt,(M.y+h.y*zt)*b-g.y*zt))}return JI(o,m,c.indices,0,c.indices.length,0,0)}function eP(c,r,o,u){const m=Math.pow(2,u.z-o.z);return new lt((c+o.x*zt)*m-u.x*zt,(r+o.y*zt)*m-u.y*zt)}function tP(c,r){const o=[];r.grid.queryPoint(c,o);const u=r.indices,m=r.vertices;for(let h=0;h<o.length;h++){const g=o[h];if(Cn([m[u[3*g+0]],m[u[3*g+1]],m[u[3*g+2]]],c))return!0}return!1}const Lw=[new lt(0,0),new lt(zt,0),new lt(zt,zt),new lt(0,zt)];function rP(c,r){const o=[];let u=[];if(!r||c.length<2)return[c];if(c.length===2)return si(c[0],c[1],Lw)?[c]:[];for(let m=0;m<c.length+2;m++){const h=c[m%c.length],g=c[(m+1)%c.length],b=si(m===0?c[c.length-1]:c[(m-1)%c.length],h,Lw),M=si(h,g,Lw),P=b||M;P&&u.push(h),P&&M||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const zw=kf.VectorTileFeature.types,fN=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],pN=["fill-extrusion-flood-light-ground-radius"],mN=Math.pow(2,13),gN=Math.pow(2,15)-1,nP=new lt(0,1),uu=2147483648;function gg(c,r,o,u,m,h,g,b){c.emplaceBack((r<<1)+g,(o<<1)+h,(Math.floor(u*mN)<<1)+m,Math.round(b))}function _g(c,r,o){c.emplaceBack(r.x*zt,r.y*zt,o?1:0)}function Z0(c,r,o,u,m,h){c.emplaceBack(r.x,r.y,(o.x<<1)+u,(o.y<<1)+m,h)}function yg(c,r,o){c.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class iP{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class oP{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class aP{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,o){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=o.x,r.min.y=r.max.y=o.y)}appendEdge(r,o,u){this.accCount++,this.acc._add(o);let m=!!this.borders;o.x<r.min.x?(r.min.x=o.x,m=!0):o.x>r.max.x&&(r.max.x=o.x,m=!0),o.y<r.min.y?(r.min.y=o.y,m=!0):o.y>r.max.y&&(r.max.y=o.y,m=!0),((o.x===0||o.x===zt)&&o.x===u.x)!=((o.y===0||o.y===zt)&&o.y===u.y)&&this.processBorderOverlap(o,u),m&&this.checkBorderIntersection(o,u)}checkBorderIntersection(r,o){o.x<0!=r.x<0&&this.addBorderIntersection(0,ur(o.y,r.y,(0-o.x)/(r.x-o.x))),o.x>zt!=r.x>zt&&this.addBorderIntersection(1,ur(o.y,r.y,(zt-o.x)/(r.x-o.x))),o.y<0!=r.y<0&&this.addBorderIntersection(2,ur(o.x,r.x,(0-o.y)/(r.y-o.y))),o.y>zt!=r.y>zt&&this.addBorderIntersection(3,ur(o.x,r.x,(zt-o.y)/(r.y-o.y)))}addBorderIntersection(r,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(r,o){if(r.x===o.x){if(r.y===o.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,o)=>r+ +(o[0]!==Number.MAX_VALUE),0):0}}function sP(c,r){const o=c.add(r)._unit(),u=hr(c.x*o.x+c.y*o.y,-1,1);var m,h,g;return g=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(g)))/4*gN*((m=c).x*(h=r).y-m.y*h.x<0?-1:1)}const _N=[c=>c.x<0,c=>c.x>zt,c=>c.y<0,c=>c.y>zt];function yN(c,r,o,u){const m=[4];if(u===0)return m;o._mult(u);const h=c.sub(o),g=r.sub(o),b=[c,r,h,g];for(let M=0;M<4;M++)for(const P of b)if(_N[M](P)){m.push(M);break}return m}class lP{constructor(r){this.vertexArray=new wf,this.indexArray=new qi,this.programConfigurations=new hl(r.layers,{zoom:r.zoom,lut:r.lut},o=>pN.includes(o)),this._segments=new Zn,this.hiddenByLandmarkVertexArray=new Mf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Zn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,o,u,m=!1){const h=r.length;if(h>2){let g=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let M;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const P=r[0],v=r[1];M=sP(P.sub(r[h-1])._perp()._unit(),v.sub(P)._perp()._unit())}for(let P=0;P<h;P++){const v=P===h-1?0:P+1,T=r[P],I=r[v],E=r[v===h-1?0:v+1],C=I.sub(T)._perp()._unit(),D=sP(C,E.sub(I)._perp()._unit()),O=M,F=D;if(Fw(T,I,o)||m&&hP(T,o)&&hP(I,o)){M=D;continue}const V=b.vertexLength;Z0(this.vertexArray,T,I,1,1,O),Z0(this.vertexArray,T,I,1,0,O),Z0(this.vertexArray,T,I,0,1,F),Z0(this.vertexArray,T,I,0,0,F),b.vertexLength+=4;const W=yN(T,I,C,u);for(const B of W)this._segmentToGroundQuads[g].push({id:V,region:B}),this._segmentToRegionTriCounts[g][B]+=2,b.primitiveLength+=2;M=D}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),o=r.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((m,h)=>m.region-h.region);for(let u=0;u<o;u++){const m=this._segmentToGroundQuads[u],h=r[u],g=this._segmentToRegionTriCounts[u];g.reduce((M,P)=>M+P,0);let b=0;for(let M=0;M<=4;M++){const P=g[M];if(P!==0){let v=this.regionSegments[M];v||(v=this.regionSegments[M]=new Zn);const T={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+b,vertexLength:h.vertexLength,primitiveLength:P};v.get().push(T)}b+=P}for(let M=0;M<m.length;M++){const P=m[M].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,o,u,m,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,o,u,m,h,g)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,aN.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,o,u,m,h,g){this.hasData()&&this.programConfigurations.updatePaintArrays(r,o,u,m,h,g)}updateHiddenByLandmark(r){if(!this.hasData())return;const o=r.groundVertexCount+r.groundVertexArrayOffset;if(r.groundVertexCount===0)return;const u=r.flags&uu?1:0;for(let m=r.groundVertexArrayOffset;m<o;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,cN.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const o=this.regionSegments[r];o&&o.destroy()}}}}class Y0{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qi,this.footprintVertices=new sl,this.footprintSegments=[],this.layoutVertexArray=new ll,this.centroidVertexArray=new A0,this.wallVertexArray=new og,this.indexArray=new qi,this.programConfigurations=new hl(r.layers,{zoom:r.zoom,lut:r.lut},o=>fN.includes(o)),this.segments=new Zn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new lP(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(r,o){}populate(r,o,u,m){this.features=[],this.hasPattern=Mw("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=De(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:g,index:b,sourceLayerIndex:M}of r){const P=this.layers[0]._featureFilter.needGeometry,v=Et(h,P);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),v,u))continue;const T={id:g,sourceLayerIndex:M,index:b,geometry:P?v.geometry:wt(h,u,m),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length,E=zw[T.type]==="Polygon";if(this.hasPattern)this.features.push(Cw("fill-extrusion",this.layers,T,this.zoom,o));else if(this.wallMode)for(const C of T.geometry)for(const D of rP(C,E))this.addFeature(T,[D],b,u,{},o.availableImages,m,o.brightness);else this.addFeature(T,T.geometry,b,u,{},o.availableImages,m,o.brightness);o.featureIndex.insert(h,T.geometry,b,M,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,o,u,m,h,g){for(const b of this.features){const M=zw[b.type]==="Polygon",{geometry:P}=b;if(this.wallMode)for(const v of P)for(const T of rP(v,M))this.addFeature(b,[T],b.index,o,u,m,h,g);else this.addFeature(b,P,b.index,o,u,m,h,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,o,u,m,h){const g=Object.keys(r).length!==0;if(g&&!this.stateDependentLayers.length)return;const b=g?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(r,o,b,u,m,h),this.groundEffect.update(r,o,b,u,m,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hN),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,lN.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,uN.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,sN.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,u,m,h,g,b,M){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,v=[new lt(0,0),new lt(zt,zt)],T=b.projection,I=T.name==="globe",E=this.wallMode||zw[r.type]==="Polygon",C=new aP;C.centroidDataIndex=this.centroidData.length;const D=new oP,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},m)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},m);let V;if(D.height=F,D.vertexArrayOffset=this.layoutVertexArray.length,D.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Sf),this.wallMode){if(I)return void Gr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;V=function(ue){const Te=ue[0].x===ue[ue.length-1].x&&ue[0].y===ue[ue.length-1].y;(function(St){let vt=0;const or=St.length;for(let Ft=0;Ft<or;Ft++)vt+=(St[(Ft+1)%or].x-St[Ft].x)*(St[(Ft+1)%or].y+St[Ft].y);return vt>=0})(ue)||(ue=ue.reverse());const Ce={geometry:[],joinNormals:[],indices:[]},Oe=[],Fe=[],Be=[];let Ne=ue.length;if(Ne<(Te?3:2))return Ce;for(;Ne>=2&&ue[Ne-1].equals(ue[Ne-2]);)Ne--;let qe,Ve,ot,mt,tt,Nt=0;for(;Nt<Ne-1&&ue[Nt].equals(ue[Nt+1]);)Nt++;Te&&(qe=ue[Ne-2],tt=ue[Nt].sub(qe)._unit()._perp());for(let St=Nt;St<Ne;St++){if(ot=St===Ne-1?Te?ue[Nt+1]:void 0:ue[St+1],ot&&ue[St].equals(ot))continue;tt&&(mt=tt),qe&&(Ve=qe),qe=ue[St],tt=ot?ot.sub(qe)._unit()._perp():mt,mt=mt||tt;let vt=mt.add(tt);vt.x===0&&vt.y===0||vt._unit();const or=vt.x*tt.x+vt.y*tt.y,Ft=or!==0?1/or:1/0,Gt=mt.x*tt.y-mt.y*tt.x>0;let gr="miter";const Dr=2;gr==="miter"&&Ft>Dr&&(gr="bevel"),gr==="bevel"&&(Ft>100&&(gr="flipbevel"),Ft<Dr&&(gr="miter"));const Mr=(Cr,zr,Fr,bn)=>{const dn=new lt(Cr.x,Cr.y),yr=new lt(Cr.x,Cr.y);dn.x+=zr.x*bn,dn.y+=zr.y*bn,yr.x-=zr.x*Math.max(Fr,1),yr.y-=zr.y*Math.max(Fr,1),Be.push(zr),Oe.push(dn),Fe.push(yr)};if(gr==="miter")vt._mult(Ft),Mr(qe,vt,0,0);else if(gr==="flipbevel")vt=tt.mult(-1),Mr(qe,vt,0,0),Mr(qe,vt.mult(-1),0,0);else{const Cr=-Math.sqrt(Ft*Ft-1),zr=Gt?Cr:0,Fr=Gt?0:Cr;Ve&&Mr(qe,mt,zr,Fr),ot&&Mr(qe,tt,zr,Fr)}}Ce.geometry=[...Oe,...Fe.reverse(),Oe[0]],Ce.joinNormals=[...Be,...Be.reverse(),Be[Be.length-1]];const Ot=Ce.geometry.length-1;for(let St=0;St<Ot/2;St++)if(St+1<Ot/2){let vt=St,or=St+1,Ft=Ot-1-St,Gt=Ot-2-St;vt=vt===0?Ot-1:vt-1,or=or===0?Ot-1:or-1,Ft=Ft===0?Ot-1:Ft-1,Gt=Gt===0?Ot-1:Gt-1,Ce.indices.push(Ft),Ce.indices.push(or),Ce.indices.push(vt),Ce.indices.push(Ft),Ce.indices.push(Gt),Ce.indices.push(or)}return Ce}(o[0]),o=[V.geometry]}const W=(ue,Te)=>ue<(Te.length-1)/2||ue===Te.length-1,B=this.wallMode?[o]:$0(o,500);for(let ue=B.length-1;ue>=0;ue--){const Te=B[ue];(Te.length===0||(H=Te[0]).every(_e=>_e.x<=0)||H.every(_e=>_e.x>=zt)||H.every(_e=>_e.y<=0)||H.every(_e=>_e.y>=zt))&&B.splice(ue,1)}var H;let Z;if(I)Z=mP(B,v,m);else{Z=[];for(const ue of B)Z.push({polygon:ue,bounds:v})}const re=E?this.edgeRadius:0,de=re>0&&this.zoom<17,me=(ue,Te)=>{if(ue.length===0)return!1;const _e=ue[ue.length-1];return Te.x===_e.x&&Te.y===_e.y};for(const{polygon:ue,bounds:Te}of Z){let _e=0,Ce=0;for(const Ne of ue)E&&!Ne[0].equals(Ne[Ne.length-1])&&Ne.push(Ne[0]),Ce+=E?Ne.length-1:Ne.length;const Oe=this.segments.prepareSegment((E?5:4)*Ce,this.layoutVertexArray,this.indexArray);D.footprintSegIdx<0&&(D.footprintSegIdx=this.footprintSegments.length),D.polygonSegIdx<0&&(D.polygonSegIdx=this.polygonSegments.length);const Fe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Be=new iP;if(Be.vertexOffset=this.footprintVertices.length,Be.indexOffset=3*this.footprintIndices.length,Be.ringIndices=[],E){const Ne=[],qe=[];_e=Oe.vertexLength;for(let ot=0;ot<ue.length;ot++){const mt=ue[ot];mt.length&&ot!==0&&qe.push(Ne.length/2);const tt=[];let Nt,Ot;Nt=mt[1].sub(mt[0])._perp()._unit(),Be.ringIndices.push(mt.length-1);for(let St=1;St<mt.length;St++){const vt=mt[St],or=mt[St===mt.length-1?1:St+1],Ft=vt.clone();if(re){Ot=or.sub(vt)._perp()._unit();const Gt=Nt.add(Ot)._unit(),gr=re*Math.min(4,1/(Nt.x*Gt.x+Nt.y*Gt.y));Ft.x+=gr*Gt.x,Ft.y+=gr*Gt.y,Ft.x=Math.round(Ft.x),Ft.y=Math.round(Ft.y),Nt=Ot}if(!O||re!==0&&!de||me(tt,Ft)||tt.push(Ft),gg(this.layoutVertexArray,Ft.x,Ft.y,0,0,1,1,0),this.wallMode){const Gt=W(St,mt);_g(this.wallVertexArray,V.joinNormals[St],!Gt)}Oe.vertexLength++,this.footprintVertices.emplaceBack(vt.x,vt.y),Ne.push(vt.x,vt.y),I&&yg(this.layoutVertexExtArray,T.projectTilePoint(Ft.x,Ft.y,m),T.upVector(m,Ft.x,Ft.y))}O&&(re===0||de)&&(tt.length!==0&&me(tt,tt[0])&&tt.pop(),this.groundEffect.addData(tt,Te,P))}const Ve=this.wallMode?V.indices:dg(Ne,qe);for(let ot=0;ot<Ve.length;ot+=3)this.footprintIndices.emplaceBack(Be.vertexOffset+Ve[ot+0],Be.vertexOffset+Ve[ot+1],Be.vertexOffset+Ve[ot+2]),this.indexArray.emplaceBack(_e+Ve[ot],_e+Ve[ot+2],_e+Ve[ot+1]),Oe.primitiveLength++;Be.indexCount+=Ve.length,Be.vertexCount+=this.footprintVertices.length-Be.vertexOffset}for(let Ne=0;Ne<ue.length;Ne++){const qe=ue[Ne];C.startRing(D,qe[0]);let Ve=qe.length>4&&dP(qe[qe.length-2],qe[0],qe[1]),ot=re?vN(qe[qe.length-2],qe[0],qe[1],re):0;const mt=[];let tt,Nt,Ot;Nt=qe[1].sub(qe[0])._perp()._unit();let St=!0;for(let vt=1,or=0;vt<qe.length;vt++){let Ft=qe[vt-1],Gt=qe[vt];const gr=qe[vt===qe.length-1?1:vt+1];if(C.appendEdge(D,Gt,Ft),Fw(Gt,Ft,Te)){re&&(Nt=gr.sub(Gt)._perp()._unit(),St=!St);continue}const Dr=Gt.sub(Ft)._perp(),Mr=Dr.x/(Math.abs(Dr.x)+Math.abs(Dr.y)),Cr=Dr.y>0?1:0,zr=Ft.dist(Gt);if(or+zr>32768&&(or=0),re){Ot=gr.sub(Gt)._perp()._unit();let yr=uP(Ft,Gt,gr,cP(Nt,Ot),re);isNaN(yr)&&(yr=0);const on=Gt.sub(Ft)._unit();Ft=Ft.add(on.mult(ot))._round(),Gt=Gt.add(on.mult(-yr))._round(),ot=yr,Nt=Ot,O&&this.zoom>=17&&(me(mt,Ft)||mt.push(Ft),me(mt,Gt)||mt.push(Gt))}const Fr=Oe.vertexLength,bn=qe.length>4&&dP(Ft,Gt,gr);let dn=fP(or,Ve,St);if(gg(this.layoutVertexArray,Ft.x,Ft.y,Mr,Cr,0,0,dn),gg(this.layoutVertexArray,Ft.x,Ft.y,Mr,Cr,0,1,dn),this.wallMode){const yr=W(vt-1,qe),on=V.joinNormals[vt-1];_g(this.wallVertexArray,on,yr),_g(this.wallVertexArray,on,yr)}if(or+=zr,dn=fP(or,bn,!St),Ve=bn,gg(this.layoutVertexArray,Gt.x,Gt.y,Mr,Cr,0,0,dn),gg(this.layoutVertexArray,Gt.x,Gt.y,Mr,Cr,0,1,dn),this.wallMode){const yr=W(vt,qe),on=V.joinNormals[vt];_g(this.wallVertexArray,on,yr),_g(this.wallVertexArray,on,yr)}if(Oe.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),Oe.primitiveLength+=2,re){const yr=_e+(vt===1?qe.length-2:vt-2),on=vt===1?_e:yr+1;if(this.indexArray.emplaceBack(Fr+1,yr,Fr+3),this.indexArray.emplaceBack(yr,on,Fr+3),Oe.primitiveLength+=2,tt===void 0&&(tt=Fr),!Fw(gr,qe[vt],Te)){const an=vt===qe.length-1?tt:Oe.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,an),this.indexArray.emplaceBack(Fr+3,an+1,an),this.indexArray.emplaceBack(Fr+3,on,an+1),Oe.primitiveLength+=3}St=!St}if(I){const yr=this.layoutVertexExtArray,on=T.projectTilePoint(Ft.x,Ft.y,m),an=T.projectTilePoint(Gt.x,Gt.y,m),In=T.upVector(m,Ft.x,Ft.y),ti=T.upVector(m,Gt.x,Gt.y);yg(yr,on,In),yg(yr,on,In),yg(yr,an,ti),yg(yr,an,ti)}}E&&(_e+=qe.length-1),O&&re&&this.zoom>=17&&(mt.length!==0&&me(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,Te,P,re>0))}this.footprintSegments.push(Be),Fe.triangleCount=this.indexArray.length-Fe.triangleArrayOffset,this.polygonSegments.push(Fe),++D.footprintSegLen,++D.polygonSegLen}if(D.vertexCount=this.layoutVertexArray.length-D.vertexArrayOffset,D.groundVertexCount=this.groundEffect.vertexArray.length-D.groundVertexArrayOffset,D.vertexCount!==0){if(D.centroidXY=C.borders?nP:this.encodeCentroid(C,D),this.centroidData.push(D),C.borders){this.featuresOnBorder.push(C);const ue=this.featuresOnBorder.length-1;for(let Te=0;Te<C.borders.length;Te++)C.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,M),this.groundEffect.addPaintPropertiesData(r,u,h,g,m,M),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((o,u)=>this.featuresOnBorder[o].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let b=0;b<this.centroidData.length;b++){const M=this.centroidData[b],P=+(M.min.y+M.max.y>zt),v=2*P+(+(M.min.x+M.max.x>zt)^P);for(let T=0;T<M.polygonSegLen;T++){const I=M.polygonSegIdx+T;r.push({centroidIdx:b,subtile:v,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const o=new qi;r.sort((b,M)=>b.triangleSegmentIdx===M.triangleSegmentIdx?b.subtile-M.subtile:b.triangleSegmentIdx-M.triangleSegmentIdx);let u=0,m=0,h=0;for(const b of r){if(b.triangleSegmentIdx!==u)break;h++}const g=r.length;for(;m!==r.length;){u=r[m].triangleSegmentIdx;let b=0,M=m,P=m;for(let v=M;v<h&&r[v].subtile===b;v++)P++;for(;M!==h;){const v=r[M];b=v.subtile;const T=this.centroidData[v.centroidIdx].min.clone(),I=this.centroidData[v.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let C=M;C<P;C++){const D=r[C],O=this.polygonSegments[D.polygonSegmentIdx],F=this.centroidData[D.centroidIdx].min,V=this.centroidData[D.centroidIdx].max,W=this.indexArray.uint16;for(let B=O.triangleArrayOffset;B<O.triangleArrayOffset+O.triangleCount;B++)o.emplaceBack(W[3*B],W[3*B+1],W[3*B+2]);E.primitiveLength+=O.triangleCount,T.x=Math.min(T.x,F.x),T.y=Math.min(T.y,F.y),I.x=Math.max(I.x,V.x),I.y=Math.max(I.y,V.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:T,max:I}),M=P;for(let C=M;C<h&&r[C].subtile===r[M].subtile;C++)P++}m=h;for(let v=m;v<g&&r[v].triangleSegmentIdx===r[m].triangleSegmentIdx;v++)h++}o._trim(),this.indexArray=o}getVisibleSegments(r,o,u){const m=new Zn;if(this.wallMode){for(const D of this.triangleSubSegments)m.segments.push(D.segment);return m}let h=0,g=0;const b=1<<r.canonical.z;if(o){const D=o.getMinMaxForTile(r);D&&(h=D.min,g=D.max)}g+=this.maxHeight;const M=r.toUnwrapped();let P;const v=[M.canonical.x/b+M.wrap,M.canonical.y/b],T=[(M.canonical.x+1)/b+M.wrap,(M.canonical.y+1)/b],I=(D,O,F)=>[D[0]*(1-F[0])+O[0]*F[0],D[1]*(1-F[1])+O[1]*F[1]],E=[],C=[];for(const D of this.triangleSubSegments){E[0]=D.min.x/zt,E[1]=D.min.y/zt,C[0]=D.max.x/zt,C[1]=D.max.y/zt;const O=I(v,T,E),F=I(v,T,C);if(new Tn([O[0],O[1],h],[F[0],F[1],g]).intersectsPrecise(u)===0){P&&(m.segments.push(P),P=void 0);continue}const V=D.segment;P&&P.vertexOffset!==V.vertexOffset&&(m.segments.push(P),P=void 0),P?(P.vertexLength+=V.vertexLength,P.primitiveLength+=V.primitiveLength):P={vertexOffset:V.vertexOffset,primitiveLength:V.primitiveLength,vertexLength:V.vertexLength,primitiveOffset:V.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&m.segments.push(P),m}encodeCentroid(r,o){const u=r.centroid(),m=o.span(),h=Math.min(7,Math.round(m.x*this.tileToMeter/10)),g=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new lt(hr(u.x,1,zt-1)<<3|h,hr(u.y,1,zt-1)<<3|g)}encodeBorderCentroid(r){if(!r.borders)return new lt(0,0);const o=r.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const m=o[0][0]!==u?0:1;return new lt(6|(o[0][0]!==u?0:65528),(o[m][0]+o[m][1])/2<<3|6)}{const m=o[2][0]!==u?2:3;return new lt((o[m][0]+o[m][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(r){const o=this.centroidData[r.centroidDataIndex];o.flags&=uu,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const o=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,m=r.flags&uu?nP:r.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==m.y||h!==m.x){for(let g=o;g<u;++g)this.centroidVertexArray.emplace(g,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const m=o.getReplacementRegionsForTile(r.toUnwrapped());if(Ow(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const h=[];for(const g of this.activeReplacements){if(g.order<u)continue;const b=Math.pow(2,g.footprintTileId.canonical.z-r.canonical.z);for(const M of this.centroidData)if(!(M.flags&uu||g.min.x>M.max.x||M.min.x>g.max.x||g.min.y>M.max.y||M.min.y>g.max.y))for(let P=0;P<M.footprintSegLen;P++){const v=this.footprintSegments[M.footprintSegIdx+P];if(h.length=0,xN(this.footprintVertices,v.vertexOffset,v.vertexCount,g.footprintTileId.canonical,r.canonical,h),JI(g.footprint,h,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-b)){M.flags|=uu;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,o,u){let m=!1;for(let h=0;h<u.footprintSegLen;h++){const g=this.footprintSegments[u.footprintSegIdx+h];let b=0;for(const M of g.ringIndices){for(let P=b,v=M+b-1;P<M+b;v=P++){const T=this.footprintVertices.int16[2*(P+g.vertexOffset)+0],I=this.footprintVertices.int16[2*(P+g.vertexOffset)+1],E=this.footprintVertices.int16[2*(v+g.vertexOffset)+1];I>o!=E>o&&r<(this.footprintVertices.int16[2*(v+g.vertexOffset)+0]-T)*(o-I)/(E-I)+T&&(m=!m)}b=M}}return m}getHeightAtTileCoord(r,o){let u=Number.NEGATIVE_INFINITY,m=!0;const h=4*(r+zt)*zt+(o+zt);if(this.partLookup.hasOwnProperty(h)){const g=this.partLookup[h];return g?{height:g.height,hidden:!!(g.flags&uu)}:void 0}for(const g of this.centroidData)r>g.max.x||g.min.x>r||o>g.max.y||g.min.y>o||this.footprintContainsPoint(r,o,g)&&g&&g.height>u&&(u=g.height,this.partLookup[h]=g,m=!!(g.flags&uu));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[h]=void 0}}function cP(c,r){const o=c.add(r)._unit();return c.x*o.x+c.y*o.y}function vN(c,r,o,u){const m=r.sub(c)._perp()._unit(),h=o.sub(r)._perp()._unit();return uP(c,r,o,cP(m,h),u)}function uP(c,r,o,u,m){const h=Math.sqrt(1-u*u);return Math.min(c.dist(r)/3,r.dist(o)/3,m*h/u)}function Fw(c,r,o){return c.x<o[0].x&&r.x<o[0].x||c.x>o[1].x&&r.x>o[1].x||c.y<o[0].y&&r.y<o[0].y||c.y>o[1].y&&r.y>o[1].y}function hP(c,r){return c.x<r[0].x||c.x>r[1].x||c.y<r[0].y||c.y>r[1].y}function dP(c,r,o){if(c.x<0||c.x>=zt||r.x<0||r.x>=zt||o.x<0||o.x>=zt)return!1;const u=o.sub(r),m=u.perp(),h=c.sub(r);return(u.x*h.x+u.y*h.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(h.x*h.x+h.y*h.y))>-.866&&m.x*h.x+m.y*h.y<0}function fP(c,r,o){const u=r?2|c:-3&c;return o?1|u:-2&u}function pP(){const c=Math.PI/32,r=Math.tan(c),o=U;return o*Math.sqrt(1+2*r*r)-o}function mP(c,r,o){const u=1<<o.z,m=xe(o.x/u),h=xe((o.x+1)/u),g=ve(o.y/u),b=ve((o.y+1)/u);return function(M,P,v,T,I=0,E){const C=[];if(!M.length||!v||!T)return C;const D=(Z,re)=>{for(const de of Z)C.push({polygon:de,bounds:re})},O=Math.ceil(Math.log2(v)),F=Math.ceil(Math.log2(T)),V=O-F,W=[];for(let Z=0;Z<Math.abs(V);Z++)W.push(V>0?0:1);for(let Z=0;Z<Math.min(O,F);Z++)W.push(0),W.push(1);let B=M;if(B=G0(B,P[0].y-I,P[1].y+I,1),B=G0(B,P[0].x-I,P[1].x+I,0),!B.length)return C;const H=[];for(W.length?H.push({polygons:B,bounds:P,depth:0}):D(B,P);H.length;){const Z=H.pop(),re=Z.depth,de=W[re],me=Z.bounds[0],ue=Z.bounds[1],Te=de===0?me.x:me.y,_e=de===0?ue.x:ue.y,Ce=E?E(de,Te,_e):.5*(Te+_e),Oe=G0(Z.polygons,Te-I,Ce+I,de),Fe=G0(Z.polygons,Ce-I,_e+I,de);if(Oe.length){const Be=[me,new lt(de===0?Ce:ue.x,de===1?Ce:ue.y)];W.length>re+1?H.push({polygons:Oe,bounds:Be,depth:re+1}):D(Oe,Be)}if(Fe.length){const Be=[new lt(de===0?Ce:me.x,de===1?Ce:me.y),ue];W.length>re+1?H.push({polygons:Fe,bounds:Be,depth:re+1}):D(Fe,Be)}}return C}(c,r,Math.ceil((h-m)/11.25),Math.ceil((g-b)/11.25),1,(M,P,v)=>{if(M===0)return .5*(P+v);{const T=ve((o.y+P/zt)/u);return(ge(.5*(ve((o.y+v/zt)/u)+T))*u-o.y)*zt}})}function xN(c,r,o,u,m,h){const g=Math.pow(2,u.z-m.z);for(let b=0;b<o;b++){let M=c.int16[2*(b+r)+0],P=c.int16[2*(b+r)+1];M=(M+m.x*zt)*g-u.x*zt,P=(P+m.y*zt)*g-u.y*zt,h.push(new lt(M,P))}}let gP,_P;function vg(c,r){return c.x*r.x+c.y*r.y}function yP(c,r){if(c.length===1){let o=0;const u=r[o++];let m;for(;!m||u.equals(m);)if(m=r[o++],!m)return 1/0;for(;o<r.length;o++){const h=r[o],g=c[0],b=m.sub(u),M=h.sub(u),P=g.sub(u),v=vg(b,b),T=vg(b,M),I=vg(M,M),E=vg(P,b),C=vg(P,M),D=v*I-T*T,O=(I*E-T*C)/D,F=(v*C-T*E)/D,V=u.z*(1-O-F)+m.z*O+h.z*F;if(isFinite(V))return V}return 1/0}{let o=1/0;for(const u of r)o=Math.min(o,u.z);return o}}function vP(c,r,o,u,m,h,g,b){const M=g*m.getElevationAt(c,r,!0,!0),P=h[0]!==0,v=P?h[1]===0?g*(h[0]/7-450):g*function(T,I,E){const C=Math.floor(I[0]/8),D=Math.floor(I[1]/8),O=10*(I[0]-8*C),F=10*(I[1]-8*D),V=T.getElevationAt(C,D,!0,!0),W=T.getMeterToDEM(E),B=Math.floor(.5*(O*W-1)),H=Math.floor(.5*(F*W-1)),Z=T.tileCoordToPixel(C,D),re=2*B+1,de=2*H+1,me=function(Fe,Be,Ne,qe,Ve){return[Fe.getElevationAtPixel(Be,Ne,!0),Fe.getElevationAtPixel(Be+Ve,Ne,!0),Fe.getElevationAtPixel(Be,Ne+Ve,!0),Fe.getElevationAtPixel(Be+qe,Ne+Ve,!0)]}(T,Z.x-B,Z.y-H,re,de),ue=Math.abs(me[0]-me[1]),Te=Math.abs(me[2]-me[3]),_e=Math.abs(me[0]-me[2])+Math.abs(me[1]-me[3]),Ce=Math.min(.25,.5*W*(ue+Te)/re),Oe=Math.min(.25,.5*W*_e/de);return V+Math.max(Ce*O,Oe*F)}(m,h,b):M;return{base:M+(o===0)?-1:o,top:P?Math.max(v+u,M+o+2):M+u}}Zt(Y0,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(oP,"PartData"),Zt(iP,"FootprintSegment"),Zt(aP,"BorderCentroidData"),Zt(lP,"GroundEffect");const bN=en([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),wN=en([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:SN}=bN,TN=en([{name:"a_packed",components:4,type:"Float32"}]),{members:EN}=TN,MN=en([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:CN}=MN;class xP{constructor(r,o){this.width=r,this.height=o,this.nextRow=0,this.image=new cu({width:r,height:o}),this.positions={},this.uploaded=!1}getDash(r,o){const u=this.getKey(r,o);return this.positions[u]}trim(){const r=this.width,o=this.height=aa(this.nextRow);this.image.resize({width:r,height:o})}getKey(r,o){return r.join(",")+o}getDashRanges(r,o,u){const m=[];let h=r.length%2==1?-r[r.length-1]*u:0,g=r[0]*u,b=!0;m.push({left:h,right:g,isDash:b,zeroLength:r[0]===0});let M=r[0];for(let P=1;P<r.length;P++){b=!b;const v=r[P];h=M*u,M+=v,g=M*u,m.push({left:h,right:g,isDash:b,zeroLength:v===0})}return m}addRoundDash(r,o,u){const m=o/2;for(let h=-u;h<=u;h++){const g=this.width*(this.nextRow+u+h);let b=0,M=r[b];for(let P=0;P<this.width;P++){P/M.right>1&&(M=r[++b]);const v=Math.abs(P-M.left),T=Math.abs(P-M.right),I=Math.min(v,T);let E;const C=h/u*(m+1);if(M.isDash){const D=m-Math.abs(C);E=Math.sqrt(I*I+D*D)}else E=m-Math.sqrt(I*I+C*C);this.image.data[g+P]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(r,o){for(let M=r.length-1;M>=0;--M){const P=r[M],v=r[M+1];P.zeroLength?r.splice(M,1):v&&v.isDash===P.isDash&&(v.left=P.left,r.splice(M,1))}const u=r[0],m=r[r.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const h=this.width*this.nextRow;let g=0,b=r[g];for(let M=0;M<this.width;M++){M/b.right>1&&(b=r[++g]);const P=Math.abs(M-b.left),v=Math.abs(M-b.right),T=Math.min(P,v);this.image.data[h+M]=Math.max(0,Math.min(255,(b.isDash?T:-T)+o+128))}}addDash(r,o){const u=this.getKey(r,o);if(this.positions[u])return this.positions[u];const m=o==="round",h=m?7:0,g=2*h+1;if(this.nextRow+g>this.height)return Gr("LineAtlas out of space"),null;r.length===0&&r.push(1);let b=0;for(let v=0;v<r.length;v++)r[v]<0&&(Gr("Negative value is found in line dasharray, replacing values with 0"),r[v]=0),b+=r[v];if(b!==0){const v=this.width/b,T=this.getDashRanges(r,this.width,v);m?this.addRoundDash(T,v,h):this.addRegularDash(T,o==="square"?.5*v:0)}const M=this.nextRow+h;this.nextRow+=g;const P={tl:[M,h],br:[b,0]};return this.positions[u]=P,P}}Zt(xP,"LineAtlas");const IN=kf.VectorTileFeature.types,PN=Math.cos(Math.PI/180*37.5),AN=Math.cos(Math.PI/180*5);class Bw{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Ym,this.layoutVertexArray2=new Cs,this.patternVertexArray=new cl,this.indexArray=new qi,this.programConfigurations=new hl(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Zn,this.maxLineLength=0,this.zOffsetVertexArray=new ru,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:zt/64}updateFootprints(r,o){}populate(r,o,u,m){this.hasPattern=Mw("line",this.layers,o);const h=this.layers[0].layout.get("line-sort-key"),g=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!g.isConstant()||!!g.constantOr(0);const b=[];for(const{feature:T,id:I,index:E,sourceLayerIndex:C}of r){const D=this.layers[0]._featureFilter.needGeometry,O=Et(T,D);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),O,u))continue;const F=h?h.evaluate(O,{},u):void 0,V={id:I,properties:T.properties,type:T.type,sourceLayerIndex:C,index:E,geometry:D?O.geometry:wt(T,u,m),patterns:{},sortKey:F};b.push(V)}h&&b.sort((T,I)=>T.sortKey-I.sortKey);const{lineAtlas:M,featureIndex:P}=o,v=this.addConstantDashes(M);for(const T of b){const{geometry:I,index:E,sourceLayerIndex:C}=T;if(v&&this.addFeatureDashes(T,M),this.hasPattern){const D=Cw("line",this.layers,T,this.zoom,o);this.patternFeatures.push(D)}else this.addFeature(T,I,E,u,M.positions,o.availableImages,o.brightness);P.insert(r[E].feature,I,E,C,this.index)}}addConstantDashes(r){let o=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(m.kind!=="constant"||h.kind!=="constant")o=!0;else{const g=h.value,b=m.value;if(!b)continue;r.addDash(b,g)}}return o}addFeatureDashes(r,o){const u=this.zoom;for(const m of this.layers){const h=m.paint.get("line-dasharray").value,g=m.layout.get("line-cap").value;if(h.kind==="constant"&&g.kind==="constant")continue;let b,M;if(h.kind==="constant"){if(b=h.value,!b)continue}else b=h.evaluate({zoom:u},r);M=g.kind==="constant"?g.value:g.evaluate({zoom:u},r),o.addDash(b,M),r.patterns[m.id]=o.getKey(b,M)}}update(r,o,u,m,h){const g=Object.keys(r).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(r,o,g?this.stateDependentLayers:this.layers,u,m,h)}addFeatures(r,o,u,m,h,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,EN)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,CN)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,wN.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,SN),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,u,m,h,g,b){const M=this.layers[0].layout,P=M.get("line-join").evaluate(r,{}),v=M.get("line-cap").evaluate(r,{}),T=M.get("line-miter-limit"),I=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const E of o)this.addLine(E,r,m,P,v,T,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,b)}addLine(r,o,u,m,h,g,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const M={zoom:this.zoom,lineProgress:void 0},P=this.layers[0].layout,v=m==="none";if(this.patternJoinNone=this.hasPattern&&v,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Z=0;Z<r.length-1;Z++)this.totalDistance+=r[Z].dist(r[Z+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=IN[o.type]==="Polygon";let I=r.length;for(;I>=2&&r[I-1].equals(r[I-2]);)I--;let E=0;for(;E<I-1&&r[E].equals(r[E+1]);)E++;if(I<(T?3:2))return;m==="bevel"&&(g=1.05);const C=this.overscaling<=16?15*zt/(512*this.overscaling):0,D=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let O,F,V,W,B,H;this.e1=this.e2=-1,T&&(O=r[I-2],B=r[E].sub(O)._unit()._perp());for(let Z=E;Z<I;Z++){if(V=Z===I-1?T?r[E+1]:void 0:r[Z+1],V&&r[Z].equals(V))continue;if(B&&(W=B),O&&(F=O),O=r[Z],this.hasZOffset){const Be=P.get("line-z-offset").value;if(Be.kind==="constant")H=Be.value;else{if(this.lineClips){const Ne=this.totalDistance/(this.lineClips.end-this.lineClips.start);M.lineProgress=(Ne*this.lineClips.start+this.distance+(F?F.dist(O):0))/Ne}else Gr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),M.lineProgress=0;H=Be.evaluate(M,o)}H=H||0}B=V?V.sub(O)._unit()._perp():W,W=W||B;const re=F&&V;let de=re?m:T||v?"butt":h;const me=W.x*B.x+W.y*B.y;if(v){const Be=function(Ne){if(Ne.patternJoinNone){const qe=Ne.segmentPoints.length/2,Ve=Ne.lineSoFar-Ne.segmentStart;for(let ot=0;ot<qe;++ot){const mt=Ne.segmentPoints[2*ot+1],tt=Math.round(Ne.segmentPoints[2*ot])+.5+.25*mt;Ne.patternVertexArray.emplaceBack(tt,Ve,Ne.segmentStart),Ne.patternVertexArray.emplaceBack(tt,Ve,Ne.segmentStart)}Ne.segmentPoints.length=0}Ne.e1=Ne.e2=-1};if(re&&me<AN){this.updateDistance(F,O),this.addCurrentVertex(O,W,1,1,D,H),Be(this),this.addCurrentVertex(O,B,-1,-1,D,H);continue}if(F){if(!V){this.updateDistance(F,O),this.addCurrentVertex(O,W,1,1,D,H),Be(this);continue}de="miter"}}let ue=W.add(B);ue.x===0&&ue.y===0||ue._unit();const Te=ue.x*B.x+ue.y*B.y,_e=Te!==0?1/Te:1/0,Ce=2*Math.sqrt(2-2*Te),Oe=Te<PN&&F&&V,Fe=W.x*B.y-W.y*B.x>0;if(Oe&&Z>E){const Be=O.dist(F);if(Be>2*C){const Ne=O.sub(O.sub(F)._mult(C/Be)._round());this.updateDistance(F,Ne),this.addCurrentVertex(Ne,W,0,0,D,H),F=Ne}}if(re&&de==="round"&&(_e<b?de="miter":_e<=2&&(de="fakeround")),de==="miter"&&_e>g&&(de="bevel"),de==="bevel"&&(_e>2&&(de="flipbevel"),_e<g&&(de="miter")),F&&this.updateDistance(F,O),de==="miter")ue._mult(_e),this.addCurrentVertex(O,ue,0,0,D,H);else if(de==="flipbevel"){if(_e>100)ue=B.mult(-1);else{const Be=_e*W.add(B).mag()/W.sub(B).mag();ue._perp()._mult(Be*(Fe?-1:1))}this.addCurrentVertex(O,ue,0,0,D,H),this.addCurrentVertex(O,ue.mult(-1),0,0,D,H)}else if(de==="bevel"||de==="fakeround"){const Be=-Math.sqrt(_e*_e-1),Ne=Fe?Be:0,qe=Fe?0:Be;if(F&&this.addCurrentVertex(O,W,Ne,qe,D,H),de==="fakeround"){const Ve=Math.round(180*Ce/Math.PI/20);for(let ot=1;ot<Ve;ot++){let mt=ot/Ve;if(mt!==.5){const Nt=mt-.5;mt+=mt*Nt*(mt-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Nt*Nt+(.848013+me*(.215638*me-1.06021)))}const tt=B.sub(W)._mult(mt)._add(W)._unit()._mult(Fe?-1:1);this.addHalfVertex(O,tt.x,tt.y,!1,Fe,0,D,H)}}V&&this.addCurrentVertex(O,B,-Ne,-qe,D,H)}else de==="butt"?this.addCurrentVertex(O,ue,0,0,D,H):de==="square"?(F||this.addCurrentVertex(O,ue,-1,-1,D,H),this.addCurrentVertex(O,ue,0,0,D,H),F&&this.addCurrentVertex(O,ue,1,1,D,H)):de==="round"&&(F&&(this.addCurrentVertex(O,W,0,0,D,H),this.addCurrentVertex(O,W,1,1,D,H,!0)),V&&(this.addCurrentVertex(O,B,-1,-1,D,H,!0),this.addCurrentVertex(O,B,0,0,D,H)));if(Oe&&Z<I-1){const Be=O.dist(V);if(Be>2*C){const Ne=O.add(V.sub(O)._mult(C/Be)._round());this.updateDistance(O,Ne),this.addCurrentVertex(Ne,B,0,0,D,H),O=Ne}}}}addVerticesTo(r,o,u,m,h,g,b,M,P,v){const T=(o.w-r.w)/this.tessellationStep|0;if(T>1){this.lineSoFar=r.w;const I=(o.x-r.x)/T,E=(o.y-r.y)/T,C=(o.z-r.z)/T,D=(o.w-r.w)/T;for(let O=1;O<T;++O)r.x+=I,r.y+=E,r.z+=C,this.lineSoFar+=D,this.addHalfVertex(r,u,m,v,!1,b,P,r.z),this.addHalfVertex(r,h,g,v,!0,-M,P,r.z)}this.lineSoFar=o.w,this.addHalfVertex(o,u,m,v,!1,b,P,o.z),this.addHalfVertex(o,h,g,v,!0,-M,P,o.z)}addCurrentVertex(r,o,u,m,h,g,b=!1){const M=o.x+o.y*u,P=o.y-o.x*u,v=o.y*m-o.x,T=-o.y-o.x*m;if(g!=null){const E=zt+10,C=g,D=new HI(r.x,r.y,C,this.lineSoFar),O=bP(r,-10,E),F=this.lineSoFar;if(this.currentVertex)if(O){const V=this.currentVertexIsOutside,W=this.currentVertex,B=new HI(r.x,r.y,C,this.lineSoFar);ZI(W,B,-10,E),bP(B,-10,E)||(V&&(this.e1=this.e2=-1,this.lineSoFar=W.w,this.addHalfVertex(W,M,P,b,!1,u,h,W.z),this.addHalfVertex(W,v,T,b,!0,-m,h,W.z)),this.addVerticesTo(W,B,M,P,v,T,u,m,h,b))}else{const V=this.currentVertex;this.currentVertexIsOutside&&(ZI(V,D,-10,E),this.e1=this.e2=-1,this.lineSoFar=V.w,this.addHalfVertex(V,M,P,b,!1,u,h,V.z),this.addHalfVertex(V,v,T,b,!0,-m,h,V.z)),this.addVerticesTo(V,D,M,P,v,T,u,m,h,b)}else O||(this.addHalfVertex(r,M,P,b,!1,u,h,g),this.addHalfVertex(r,v,T,b,!0,-m,h,g));this.currentVertex=D,this.currentVertexIsOutside=O,this.lineSoFar=F}else this.addHalfVertex(r,M,P,b,!1,u,h,g),this.addHalfVertex(r,v,T,b,!0,-m,h,g)}addHalfVertex({x:r,y:o},u,m,h,g,b,M,P){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((r<<1)+(h?1:0),(o<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),M.primitiveLength++),g?this.e2=v:this.e1=v,P!=null&&this.zOffsetVertexArray.emplaceBack(P)}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,o){this.distance+=r.dist(o),this.updateScaledDistance()}}function bP(c,r,o){return c.x<r||c.x>o||c.y<r||c.y>o}let wP,SP;function TP(c,r,o){return r*(zt/(c.tileSize*Math.pow(2,o-c.tileID.overscaledZ)))}function EP(c,r){return 1/TP(c,1,r.tileZoom)}function MP(c,r,o,u){return c.translatePosMatrix(u||r.tileID.projMatrix,r,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}Zt(Bw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const CP=c=>{const r=[];IP(c)&&r.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const o=c.paint.get("line-trim-offset");o[0]===0&&o[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return u&&m&&r.push("LINE_JOIN_NONE"),r};function IP(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}let Nw;const PP=()=>Nw||(Nw={layout:wP||(wP=new Ln({"line-cap":new nr(He.layout_line["line-cap"]),"line-join":new nr(He.layout_line["line-join"]),"line-miter-limit":new Pt(He.layout_line["line-miter-limit"]),"line-round-limit":new Pt(He.layout_line["line-round-limit"]),"line-sort-key":new nr(He.layout_line["line-sort-key"]),"line-z-offset":new nr(He.layout_line["line-z-offset"]),visibility:new Pt(He.layout_line.visibility)})),paint:SP||(SP=new Ln({"line-opacity":new nr(He.paint_line["line-opacity"]),"line-color":new nr(He.paint_line["line-color"]),"line-translate":new Pt(He.paint_line["line-translate"]),"line-translate-anchor":new Pt(He.paint_line["line-translate-anchor"]),"line-width":new nr(He.paint_line["line-width"]),"line-gap-width":new nr(He.paint_line["line-gap-width"]),"line-offset":new nr(He.paint_line["line-offset"]),"line-blur":new nr(He.paint_line["line-blur"]),"line-dasharray":new nr(He.paint_line["line-dasharray"]),"line-pattern":new nr(He.paint_line["line-pattern"]),"line-gradient":new ka(He.paint_line["line-gradient"]),"line-trim-offset":new Pt(He.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pt(He.paint_line["line-trim-fade-range"]),"line-trim-color":new Pt(He.paint_line["line-trim-color"]),"line-emissive-strength":new Pt(He.paint_line["line-emissive-strength"]),"line-border-width":new nr(He.paint_line["line-border-width"]),"line-border-color":new nr(He.paint_line["line-border-color"]),"line-occlusion-opacity":new Pt(He.paint_line["line-occlusion-opacity"])}))},Nw);class DN extends nr{possiblyEvaluate(r,o){return o=new qn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(r,o)}evaluate(r,o,u,m){return o=hi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(r,o,u,m)}}let xg;function AP(c,r){return r>0?r+2*c:c}const RN=en([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kN=en([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ON=en([{name:"a_projected_pos",components:4,type:"Float32"}],4);en([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const LN=en([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),zN=en([{name:"a_texb",components:2,type:"Uint16"}]),FN=en([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),BN=en([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);en([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const DP=en([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),NN=en([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);en([{name:"triangle",components:3,type:"Uint16"}]),en([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),en([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),en([{type:"Float32",name:"offsetX"}]),en([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ro=24;const Rs=128;function Uw(c,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new qn(c+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=o;let h=0;for(;h<u.length&&u[h]<=c;)h++;h=Math.max(0,h-1);let g=h;for(;g<u.length&&u[g]<c+1;)g++;g=Math.min(u.length-1,g);const b=u[h],M=u[g];return o.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:M,minSize:o.evaluate(new qn(b)),maxSize:o.evaluate(new qn(M)),interpolationType:m}}}function X0(c,{uSize:r,uSizeT:o},{lowerSize:u,upperSize:m}){return c.kind==="source"?u/Rs:c.kind==="composite"?ur(u/Rs,m/Rs,o):r}function Of(c,r){let o=0,u=0;if(c.kind==="constant")u=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:m,minZoom:h,maxZoom:g}=c,b=m?hr(Xo.interpolationFactor(m,r,h,g),0,1):0;c.kind==="camera"?u=ur(c.minSize,c.maxSize,b):o=b}return{uSizeT:o,uSize:u}}var UN=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Rs,evaluateSizeForFeature:X0,evaluateSizeForZoom:Of,getSizeData:Uw});function jN(c,r,o){return c.sections.forEach(u=>{u.text=function(m,h,g){const b=h.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),Lo.applyArabicShaping&&(m=Lo.applyArabicShaping(m)),m}(u.text,r,o)}),c}const bg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function VN(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function $N(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var RP,jw,kP,Vw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function WN(){return RP||(RP=1,Vw.read=function(c,r,o,u,m){var h,g,b=8*m-u-1,M=(1<<b)-1,P=M>>1,v=-7,T=o?m-1:0,I=o?-1:1,E=c[r+T];for(T+=I,h=E&(1<<-v)-1,E>>=-v,v+=b;v>0;h=256*h+c[r+T],T+=I,v-=8);for(g=h&(1<<-v)-1,h>>=-v,v+=u;v>0;g=256*g+c[r+T],T+=I,v-=8);if(h===0)h=1-P;else{if(h===M)return g?NaN:1/0*(E?-1:1);g+=Math.pow(2,u),h-=P}return(E?-1:1)*g*Math.pow(2,h-u)},Vw.write=function(c,r,o,u,m,h){var g,b,M,P=8*h-m-1,v=(1<<P)-1,T=v>>1,I=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=u?0:h-1,C=u?1:-1,D=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(b=isNaN(r)?1:0,g=v):(g=Math.floor(Math.log(r)/Math.LN2),r*(M=Math.pow(2,-g))<1&&(g--,M*=2),(r+=g+T>=1?I/M:I*Math.pow(2,1-T))*M>=2&&(g++,M/=2),g+T>=v?(b=0,g=v):g+T>=1?(b=(r*M-1)*Math.pow(2,m),g+=T):(b=r*Math.pow(2,T-1)*Math.pow(2,m),g=0));m>=8;c[o+E]=255&b,E+=C,b/=256,m-=8);for(g=g<<m|b,P+=m;P>0;c[o+E]=255&g,E+=C,g/=256,P-=8);c[o+E-C]|=128*D}),Vw}function OP(){if(kP)return jw;kP=1,jw=r;var c=WN();function r(B){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(B)?B:new Uint8Array(B||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var o=4294967296,u=1/o,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(B){return B.type===r.Bytes?B.readVarint()+B.pos:B.pos+1}function g(B,H,Z){return Z?4294967296*H+(B>>>0):4294967296*(H>>>0)+(B>>>0)}function b(B,H,Z){var re=H<=16383?1:H<=2097151?2:H<=268435455?3:Math.floor(Math.log(H)/(7*Math.LN2));Z.realloc(re);for(var de=Z.pos-1;de>=B;de--)Z.buf[de+re]=Z.buf[de]}function M(B,H){for(var Z=0;Z<B.length;Z++)H.writeVarint(B[Z])}function P(B,H){for(var Z=0;Z<B.length;Z++)H.writeSVarint(B[Z])}function v(B,H){for(var Z=0;Z<B.length;Z++)H.writeFloat(B[Z])}function T(B,H){for(var Z=0;Z<B.length;Z++)H.writeDouble(B[Z])}function I(B,H){for(var Z=0;Z<B.length;Z++)H.writeBoolean(B[Z])}function E(B,H){for(var Z=0;Z<B.length;Z++)H.writeFixed32(B[Z])}function C(B,H){for(var Z=0;Z<B.length;Z++)H.writeSFixed32(B[Z])}function D(B,H){for(var Z=0;Z<B.length;Z++)H.writeFixed64(B[Z])}function O(B,H){for(var Z=0;Z<B.length;Z++)H.writeSFixed64(B[Z])}function F(B,H){return(B[H]|B[H+1]<<8|B[H+2]<<16)+16777216*B[H+3]}function V(B,H,Z){B[Z]=H,B[Z+1]=H>>>8,B[Z+2]=H>>>16,B[Z+3]=H>>>24}function W(B,H){return(B[H]|B[H+1]<<8|B[H+2]<<16)+(B[H+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(B,H,Z){for(Z=Z||this.length;this.pos<Z;){var re=this.readVarint(),de=re>>3,me=this.pos;this.type=7&re,B(de,H,this),this.pos===me&&this.skip(re)}return H},readMessage:function(B,H){return this.readFields(B,H,this.readVarint()+this.pos)},readFixed32:function(){var B=F(this.buf,this.pos);return this.pos+=4,B},readSFixed32:function(){var B=W(this.buf,this.pos);return this.pos+=4,B},readFixed64:function(){var B=F(this.buf,this.pos)+F(this.buf,this.pos+4)*o;return this.pos+=8,B},readSFixed64:function(){var B=F(this.buf,this.pos)+W(this.buf,this.pos+4)*o;return this.pos+=8,B},readFloat:function(){var B=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,B},readDouble:function(){var B=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,B},readVarint:function(B){var H,Z,re=this.buf;return H=127&(Z=re[this.pos++]),Z<128?H:(H|=(127&(Z=re[this.pos++]))<<7,Z<128?H:(H|=(127&(Z=re[this.pos++]))<<14,Z<128?H:(H|=(127&(Z=re[this.pos++]))<<21,Z<128?H:function(de,me,ue){var Te,_e,Ce=ue.buf;if(Te=(112&(_e=Ce[ue.pos++]))>>4,_e<128||(Te|=(127&(_e=Ce[ue.pos++]))<<3,_e<128)||(Te|=(127&(_e=Ce[ue.pos++]))<<10,_e<128)||(Te|=(127&(_e=Ce[ue.pos++]))<<17,_e<128)||(Te|=(127&(_e=Ce[ue.pos++]))<<24,_e<128)||(Te|=(1&(_e=Ce[ue.pos++]))<<31,_e<128))return g(de,Te,me);throw new Error("Expected varint not more than 10 bytes")}(H|=(15&(Z=re[this.pos]))<<28,B,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var B=this.readVarint();return B%2==1?(B+1)/-2:B/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var B=this.readVarint()+this.pos,H=this.pos;return this.pos=B,B-H>=12&&m?function(Z,re,de){return m.decode(Z.subarray(re,de))}(this.buf,H,B):function(Z,re,de){for(var me="",ue=re;ue<de;){var Te,_e,Ce,Oe=Z[ue],Fe=null,Be=Oe>239?4:Oe>223?3:Oe>191?2:1;if(ue+Be>de)break;Be===1?Oe<128&&(Fe=Oe):Be===2?(192&(Te=Z[ue+1]))==128&&(Fe=(31&Oe)<<6|63&Te)<=127&&(Fe=null):Be===3?(_e=Z[ue+2],(192&(Te=Z[ue+1]))==128&&(192&_e)==128&&((Fe=(15&Oe)<<12|(63&Te)<<6|63&_e)<=2047||Fe>=55296&&Fe<=57343)&&(Fe=null)):Be===4&&(_e=Z[ue+2],Ce=Z[ue+3],(192&(Te=Z[ue+1]))==128&&(192&_e)==128&&(192&Ce)==128&&((Fe=(15&Oe)<<18|(63&Te)<<12|(63&_e)<<6|63&Ce)<=65535||Fe>=1114112)&&(Fe=null)),Fe===null?(Fe=65533,Be=1):Fe>65535&&(Fe-=65536,me+=String.fromCharCode(Fe>>>10&1023|55296),Fe=56320|1023&Fe),me+=String.fromCharCode(Fe),ue+=Be}return me}(this.buf,H,B)},readBytes:function(){var B=this.readVarint()+this.pos,H=this.buf.subarray(this.pos,B);return this.pos=B,H},readPackedVarint:function(B,H){if(this.type!==r.Bytes)return B.push(this.readVarint(H));var Z=h(this);for(B=B||[];this.pos<Z;)B.push(this.readVarint(H));return B},readPackedSVarint:function(B){if(this.type!==r.Bytes)return B.push(this.readSVarint());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readSVarint());return B},readPackedBoolean:function(B){if(this.type!==r.Bytes)return B.push(this.readBoolean());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readBoolean());return B},readPackedFloat:function(B){if(this.type!==r.Bytes)return B.push(this.readFloat());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readFloat());return B},readPackedDouble:function(B){if(this.type!==r.Bytes)return B.push(this.readDouble());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readDouble());return B},readPackedFixed32:function(B){if(this.type!==r.Bytes)return B.push(this.readFixed32());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readFixed32());return B},readPackedSFixed32:function(B){if(this.type!==r.Bytes)return B.push(this.readSFixed32());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readSFixed32());return B},readPackedFixed64:function(B){if(this.type!==r.Bytes)return B.push(this.readFixed64());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readFixed64());return B},readPackedSFixed64:function(B){if(this.type!==r.Bytes)return B.push(this.readSFixed64());var H=h(this);for(B=B||[];this.pos<H;)B.push(this.readSFixed64());return B},skip:function(B){var H=7&B;if(H===r.Varint)for(;this.buf[this.pos++]>127;);else if(H===r.Bytes)this.pos=this.readVarint()+this.pos;else if(H===r.Fixed32)this.pos+=4;else{if(H!==r.Fixed64)throw new Error("Unimplemented type: "+H);this.pos+=8}},writeTag:function(B,H){this.writeVarint(B<<3|H)},realloc:function(B){for(var H=this.length||16;H<this.pos+B;)H*=2;if(H!==this.length){var Z=new Uint8Array(H);Z.set(this.buf),this.buf=Z,this.length=H}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(B){this.realloc(4),V(this.buf,B,this.pos),this.pos+=4},writeSFixed32:function(B){this.realloc(4),V(this.buf,B,this.pos),this.pos+=4},writeFixed64:function(B){this.realloc(8),V(this.buf,-1&B,this.pos),V(this.buf,Math.floor(B*u),this.pos+4),this.pos+=8},writeSFixed64:function(B){this.realloc(8),V(this.buf,-1&B,this.pos),V(this.buf,Math.floor(B*u),this.pos+4),this.pos+=8},writeVarint:function(B){(B=+B||0)>268435455||B<0?function(H,Z){var re,de;if(H>=0?(re=H%4294967296|0,de=H/4294967296|0):(de=~(-H/4294967296),4294967295^(re=~(-H%4294967296))?re=re+1|0:(re=0,de=de+1|0)),H>=18446744073709552e3||H<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),function(me,ue,Te){Te.buf[Te.pos++]=127&me|128,me>>>=7,Te.buf[Te.pos++]=127&me|128,me>>>=7,Te.buf[Te.pos++]=127&me|128,me>>>=7,Te.buf[Te.pos++]=127&me|128,Te.buf[Te.pos]=127&(me>>>=7)}(re,0,Z),function(me,ue){var Te=(7&me)<<4;ue.buf[ue.pos++]|=Te|((me>>>=3)?128:0),me&&(ue.buf[ue.pos++]=127&me|((me>>>=7)?128:0),me&&(ue.buf[ue.pos++]=127&me|((me>>>=7)?128:0),me&&(ue.buf[ue.pos++]=127&me|((me>>>=7)?128:0),me&&(ue.buf[ue.pos++]=127&me|((me>>>=7)?128:0),me&&(ue.buf[ue.pos++]=127&me)))))}(de,Z)}(B,this):(this.realloc(4),this.buf[this.pos++]=127&B|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=B>>>7&127))))},writeSVarint:function(B){this.writeVarint(B<0?2*-B-1:2*B)},writeBoolean:function(B){this.writeVarint(!!B)},writeString:function(B){B=String(B),this.realloc(4*B.length),this.pos++;var H=this.pos;this.pos=function(re,de,me){for(var ue,Te,_e=0;_e<de.length;_e++){if((ue=de.charCodeAt(_e))>55295&&ue<57344){if(!Te){ue>56319||_e+1===de.length?(re[me++]=239,re[me++]=191,re[me++]=189):Te=ue;continue}if(ue<56320){re[me++]=239,re[me++]=191,re[me++]=189,Te=ue;continue}ue=Te-55296<<10|ue-56320|65536,Te=null}else Te&&(re[me++]=239,re[me++]=191,re[me++]=189,Te=null);ue<128?re[me++]=ue:(ue<2048?re[me++]=ue>>6|192:(ue<65536?re[me++]=ue>>12|224:(re[me++]=ue>>18|240,re[me++]=ue>>12&63|128),re[me++]=ue>>6&63|128),re[me++]=63&ue|128)}return me}(this.buf,B,this.pos);var Z=this.pos-H;Z>=128&&b(H,Z,this),this.pos=H-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(B){this.realloc(4),c.write(this.buf,B,this.pos,!0,23,4),this.pos+=4},writeDouble:function(B){this.realloc(8),c.write(this.buf,B,this.pos,!0,52,8),this.pos+=8},writeBytes:function(B){var H=B.length;this.writeVarint(H),this.realloc(H);for(var Z=0;Z<H;Z++)this.buf[this.pos++]=B[Z]},writeRawMessage:function(B,H){this.pos++;var Z=this.pos;B(H,this);var re=this.pos-Z;re>=128&&b(Z,re,this),this.pos=Z-1,this.writeVarint(re),this.pos+=re},writeMessage:function(B,H,Z){this.writeTag(B,r.Bytes),this.writeRawMessage(H,Z)},writePackedVarint:function(B,H){H.length&&this.writeMessage(B,M,H)},writePackedSVarint:function(B,H){H.length&&this.writeMessage(B,P,H)},writePackedBoolean:function(B,H){H.length&&this.writeMessage(B,I,H)},writePackedFloat:function(B,H){H.length&&this.writeMessage(B,v,H)},writePackedDouble:function(B,H){H.length&&this.writeMessage(B,T,H)},writePackedFixed32:function(B,H){H.length&&this.writeMessage(B,E,H)},writePackedSFixed32:function(B,H){H.length&&this.writeMessage(B,C,H)},writePackedFixed64:function(B,H){H.length&&this.writeMessage(B,D,H)},writePackedSFixed64:function(B,H){H.length&&this.writeMessage(B,O,H)},writeBytesField:function(B,H){this.writeTag(B,r.Bytes),this.writeBytes(H)},writeFixed32Field:function(B,H){this.writeTag(B,r.Fixed32),this.writeFixed32(H)},writeSFixed32Field:function(B,H){this.writeTag(B,r.Fixed32),this.writeSFixed32(H)},writeFixed64Field:function(B,H){this.writeTag(B,r.Fixed64),this.writeFixed64(H)},writeSFixed64Field:function(B,H){this.writeTag(B,r.Fixed64),this.writeSFixed64(H)},writeVarintField:function(B,H){this.writeTag(B,r.Varint),this.writeVarint(H)},writeSVarintField:function(B,H){this.writeTag(B,r.Varint),this.writeSVarint(H)},writeStringField:function(B,H){this.writeTag(B,r.Bytes),this.writeString(H)},writeFloatField:function(B,H){this.writeTag(B,r.Fixed32),this.writeFloat(H)},writeDoubleField:function(B,H){this.writeTag(B,r.Fixed64),this.writeDouble(H)},writeBooleanField:function(B,H){this.writeVarintField(B,!!H)}},jw}var K0=N(OP());const $w=3;function GN(c,r,o){r.glyphs=[],c===1&&o.readMessage(HN,r)}function HN(c,r,o){if(c===3){const{id:u,bitmap:m,width:h,height:g,left:b,top:M,advance:P}=o.readMessage(qN,{});r.glyphs.push({id:u,bitmap:new cu({width:h+2*$w,height:g+2*$w},m),metrics:{width:h,height:g,left:b,top:M,advance:P}})}else c===4?r.ascender=o.readSVarint():c===5&&(r.descender=o.readSVarint())}function qN(c,r,o){c===1?r.id=o.readVarint():c===2?r.bitmap=o.readBytes():c===3?r.width=o.readVarint():c===4?r.height=o.readVarint():c===5?r.left=o.readSVarint():c===6?r.top=o.readSVarint():c===7&&(r.advance=o.readVarint())}const LP=$w,za={horizontal:1,vertical:2,horizontalOnly:3};class wg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,o){const u=new wg;return u.scale=r||1,u.fontStack=o,u}static forImage(r){const o=new wg;return o.imageName=r,o}}class Lf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o){const u=new Lf;for(let m=0;m<r.sections.length;m++){const h=r.sections[m];h.image?u.addImageSection(h):u.addTextSection(h,o)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(o,u){let m="";for(let h=0;h<o.length;h++){const g=o.charCodeAt(h+1)||null,b=o.charCodeAt(h-1)||null;m+=!u&&(g&&wh(g)&&!bg[o[h+1]]||b&&wh(b)&&!bg[o[h-1]])||!bg[o[h]]?o[h]:bg[o[h]]}return m}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&J0[this.text.charCodeAt(u)];u++)r++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&J0[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const u=new Lf;return u.text=this.text.substring(r,o),u.sectionIndex=this.sectionIndex.slice(r,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,o)=>Math.max(r,this.sections[o].scale),0)}addTextSection(r,o){this.text+=r.text,this.sections.push(wg.forText(r.scale,r.fontStack||o));const u=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(u)}addImageSection(r){const o=r.image?r.image.namePrimary:"";if(o.length===0)return void Gr("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(wg.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Gr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ww(c,r,o,u,m,h,g,b,M,P,v,T,I,E,C){const D=Lf.fromFeature(c,m);T===za.vertical&&D.verticalizePunctuation(I);let O=[];const F=function(Z,re,de,me,ue,Te){if(!Z)return[];const _e=[],Ce=function(Ne,qe,Ve,ot,mt,tt){let Nt=0;for(let Ot=0;Ot<Ne.length();Ot++){const St=Ne.getSection(Ot);Nt+=zP(Ne.getCodePoint(Ot),St,ot,mt,qe,tt)}return Nt/Math.max(1,Math.ceil(Nt/Ve))}(Z,re,de,me,ue,Te),Oe=Z.text.indexOf("​")>=0;let Fe=0;for(let Ne=0;Ne<Z.length();Ne++){const qe=Z.getSection(Ne),Ve=Z.getCodePoint(Ne);if(J0[Ve]||(Fe+=zP(Ve,qe,me,ue,re,Te)),Ne<Z.length()-1){const ot=!((Be=Ve)<11904||!(rr["Bopomofo Extended"](Be)||rr.Bopomofo(Be)||rr["CJK Compatibility Forms"](Be)||rr["CJK Compatibility Ideographs"](Be)||rr["CJK Compatibility"](Be)||rr["CJK Radicals Supplement"](Be)||rr["CJK Strokes"](Be)||rr["CJK Symbols and Punctuation"](Be)||rr["CJK Unified Ideographs Extension A"](Be)||rr["CJK Unified Ideographs"](Be)||rr["Enclosed CJK Letters and Months"](Be)||rr["Halfwidth and Fullwidth Forms"](Be)||rr.Hiragana(Be)||rr["Ideographic Description Characters"](Be)||rr["Kangxi Radicals"](Be)||rr["Katakana Phonetic Extensions"](Be)||rr.Katakana(Be)||rr["Vertical Forms"](Be)||rr["Yi Radicals"](Be)||rr["Yi Syllables"](Be)));(ZN[Ve]||ot||qe.imageName)&&_e.push(BP(Ne+1,Fe,Ce,_e,YN(Ve,Z.getCodePoint(Ne+1),ot&&Oe),!1))}}var Be;return NP(BP(Z.length(),Fe,Ce,_e,0,!0))}(D,P,h,r,u,E),{processBidirectionalText:V,processStyledBidirectionalText:W}=Lo;if(V&&D.sections.length===1){const Z=V(D.toString(),F);for(const re of Z){const de=new Lf;de.text=re,de.sections=D.sections;for(let me=0;me<re.length;me++)de.sectionIndex.push(0);O.push(de)}}else if(W){const Z=W(D.text,D.sectionIndex,F);for(const re of Z){const de=new Lf;de.text=re[0],de.sectionIndex=re[1],de.sections=D.sections,O.push(de)}}else O=function(Z,re){const de=[],me=Z.text;let ue=0;for(const Te of re)de.push(Z.substring(ue,Te)),ue=Te;return ue<me.length&&de.push(Z.substring(ue,me.length)),de}(D,F);const B=[],H={positionedLines:B,text:D.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Z,re,de,me,ue,Te,_e,Ce,Oe,Fe,Be,Ne){let qe=0,Ve=0,ot=0;const mt=Ce==="right"?1:Ce==="left"?0:.5;let tt=!1;for(const Ft of ue){const Gt=Ft.getSections();for(const gr of Gt){if(gr.imageName)continue;const Dr=re[gr.fontStack];if(Dr&&(tt=Dr.ascender!==void 0&&Dr.descender!==void 0,!tt))break}if(!tt)break}let Nt=0;for(const Ft of ue){Ft.trim();const Gt=Ft.getMaxScale(),gr=(Gt-1)*ro,Dr={positionedGlyphs:[],lineOffset:0};Z.positionedLines[Nt]=Dr;const Mr=Dr.positionedGlyphs;let Cr=0;if(!Ft.length()){Ve+=Te,++Nt;continue}let zr=0,Fr=0;for(let dn=0;dn<Ft.length();dn++){const yr=Ft.getSection(dn),on=Ft.getSectionIndex(dn),an=Ft.getCodePoint(dn);let In=yr.scale,ti=null,pi=null,ri=null,$n=ro,Ui=0;const vi=!(Oe===za.horizontal||!Be&&!pf(an)||Be&&(J0[an]||(Ot=an,rr.Arabic(Ot)||rr["Arabic Supplement"](Ot)||rr["Arabic Extended-A"](Ot)||rr["Arabic Presentation Forms-A"](Ot)||rr["Arabic Presentation Forms-B"](Ot))));if(yr.imageName){const no=me[yr.imageName];if(!no)continue;ri=yr.imageName,Z.iconsInText=Z.iconsInText||!0,pi=no.paddedRect;const En=no.displaySize;In=In*ro/Ne,ti={width:En[0],height:En[1],left:0,top:-LP,advance:vi?En[1]:En[0],localGlyph:!1},Ui=tt?-ti.height*In:Gt*ro-17-En[1]*In,$n=ti.advance;const Qo=(vi?En[0]:En[1])*In-ro*Gt;Qo>0&&Qo>Cr&&(Cr=Qo)}else{const no=de[yr.fontStack];if(!no)continue;no[an]&&(pi=no[an]);const En=re[yr.fontStack];if(!En)continue;const Qo=En.glyphs[an];if(!Qo)continue;if(ti=Qo.metrics,$n=an!==8203?ro:0,tt){const Fs=En.ascender!==void 0?Math.abs(En.ascender):0,ls=En.descender!==void 0?Math.abs(En.descender):0,cs=(Fs+ls)*In;zr<cs&&(zr=cs,Fr=(Fs-ls)/2*In),Ui=-Fs*In}else Ui=(Gt-In)*ro-17}vi?(Z.verticalizable=!0,Mr.push({glyph:an,imageName:ri,x:qe,y:Ve+Ui,vertical:vi,scale:In,localGlyph:ti.localGlyph,fontStack:yr.fontStack,sectionIndex:on,metrics:ti,rect:pi}),qe+=$n*In+Fe):(Mr.push({glyph:an,imageName:ri,x:qe,y:Ve+Ui,vertical:vi,scale:In,localGlyph:ti.localGlyph,fontStack:yr.fontStack,sectionIndex:on,metrics:ti,rect:pi}),qe+=ti.advance*In+Fe)}Mr.length!==0&&(ot=Math.max(qe-Fe,ot),tt?UP(Mr,mt,Cr,Fr,Te*Gt/2):UP(Mr,mt,Cr,0,Te/2)),qe=0;const bn=Te*Gt+Cr;Dr.lineOffset=Math.max(Cr,gr),Ve+=bn,++Nt}var Ot;const St=Ve,{horizontalAlign:vt,verticalAlign:or}=Gw(_e);(function(Ft,Gt,gr,Dr,Mr,Cr){const zr=(Gt-gr)*Mr,Fr=-Cr*Dr;for(const bn of Ft)for(const dn of bn.positionedGlyphs)dn.x+=zr,dn.y+=Fr})(Z.positionedLines,mt,vt,or,ot,St),Z.top+=-or*St,Z.bottom=Z.top+St,Z.left+=-vt*ot,Z.right=Z.left+ot,Z.hasBaseline=tt}(H,r,o,u,O,g,b,M,T,P,I,C),!function(Z){for(const re of Z)if(re.positionedGlyphs.length!==0)return!1;return!0}(B)&&H}const J0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ZN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zP(c,r,o,u,m,h){if(r.imageName){const g=u[r.imageName];return g?g.displaySize[0]*r.scale*ro/h+m:0}{const g=o[r.fontStack],b=g&&g.glyphs[c];return b?b.metrics.advance*r.scale+m:0}}function FP(c,r,o,u){const m=Math.pow(c-r,2);return u?c<r?m/2:2*m:m+Math.abs(o)*o}function YN(c,r,o){let u=0;return c===10&&(u-=1e4),o&&(u+=150),c!==40&&c!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function BP(c,r,o,u,m,h){let g=null,b=FP(r,o,m,h);for(const M of u){const P=FP(r-M.x,o,m,h)+M.badness;P<=b&&(g=M,b=P)}return{index:c,x:r,priorBreak:g,badness:b}}function NP(c){return c?NP(c.priorBreak).concat(c.index):[]}function Gw(c){let r=.5,o=.5;switch(c){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function UP(c,r,o,u,m){if(!(r||o||u||m))return;const h=c.length-1,g=c[h],b=(g.x+g.metrics.advance*g.scale)*r;for(let M=0;M<=h;M++)c[M].x-=b,c[M].y+=o+u+m}function XN(c,r,o,u){const{horizontalAlign:m,verticalAlign:h}=Gw(u),g=o[0]-c.displaySize[0]*m,b=o[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:r,top:b,bottom:b+c.displaySize[1],left:g,right:g+c.displaySize[0]}}function jP(c,r,o,u,m,h){const g=c.imagePrimary;let b;if(g.content){const O=g.content,F=g.pixelRatio||1;b=[O[0]/F,O[1]/F,g.displaySize[0]-O[2]/F,g.displaySize[1]-O[3]/F]}const M=r.left*h,P=r.right*h;let v,T,I,E;o==="width"||o==="both"?(E=m[0]+M-u[3],T=m[0]+P+u[1]):(E=m[0]+(M+P-g.displaySize[0])/2,T=E+g.displaySize[0]);const C=r.top*h,D=r.bottom*h;return o==="height"||o==="both"?(v=m[1]+C-u[0],I=m[1]+D+u[2]):(v=m[1]+(C+D-g.displaySize[1])/2,I=v+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:v,right:T,bottom:I,left:E,collisionPadding:b}}class Ql extends lt{constructor(r,o,u,m,h){super(r,o),this.angle=m,this.z=u,h!==void 0&&(this.segment=h)}clone(){return new Ql(this.x,this.y,this.z,this.angle,this.segment)}}function VP(c,r,o,u,m){if(r.segment===void 0)return!0;let h=r,g=r.segment+1,b=0;for(;b>-o/2;){if(g--,g<0)return!1;b-=c[g].dist(h),h=c[g]}b+=c[g].dist(c[g+1]),g++;const M=[];let P=0;for(;b<o/2;){const v=c[g],T=c[g+1];if(!T)return!1;let I=c[g-1].angleTo(v)-v.angleTo(T);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:b,angleDelta:I}),P+=I;b-M[0].distance>u;)P-=M.shift().angleDelta;if(P>m)return!1;g++,b+=v.dist(T)}return!0}function $P(c){let r=0;for(let o=0;o<c.length-1;o++)r+=c[o].dist(c[o+1]);return r}function WP(c,r,o){return c?.6*r*o:0}function GP(c,r){return Math.max(c?c.right-c.left:0,r?r.right-r.left:0)}function KN(c,r,o,u,m,h){const g=WP(o,m,h),b=GP(o,u)*h;let M=0;const P=$P(c)/2;for(let v=0;v<c.length-1;v++){const T=c[v],I=c[v+1],E=T.dist(I);if(M+E>P){const C=(P-M)/E,D=ur(T.x,I.x,C),O=ur(T.y,I.y,C),F=new Ql(D,O,0,I.angleTo(T),v);return!g||VP(c,F,b,g,r)?F:void 0}M+=E}}function JN(c,r,o,u,m,h,g,b,M){const P=WP(u,h,g),v=GP(u,m),T=v*g,I=c[0].x===0||c[0].x===M||c[0].y===0||c[0].y===M;return r-T<r/4&&(r=T+r/4),HP(c,I?r/2*b%r:(v/2+2*h)*g*b%r,r,P,o,T,I,!1,M)}function HP(c,r,o,u,m,h,g,b,M){const P=h/2,v=$P(c);let T=0,I=r-o,E=[];for(let C=0;C<c.length-1;C++){const D=c[C],O=c[C+1],F=D.dist(O),V=O.angleTo(D);for(;I+o<T+F;){I+=o;const W=(I-T)/F,B=ur(D.x,O.x,W),H=ur(D.y,O.y,W);if(B>=0&&B<M&&H>=0&&H<M&&I-P>=0&&I+P<=v){const Z=new Ql(B,H,0,V,C);u&&!VP(c,Z,h,u,m)||E.push(Z)}}T+=F}return b||E.length||g||(E=HP(c,T/2,o,u,m,h,g,!0,M)),E}function qP(c,r,o,u,m){const h=[];for(let g=0;g<c.length;g++){const b=c[g];let M;for(let P=0;P<b.length-1;P++){let v=b[P],T=b[P+1];v.x<r&&T.x<r||(v.x<r?v=new lt(r,v.y+(r-v.x)/(T.x-v.x)*(T.y-v.y))._round():T.x<r&&(T=new lt(r,v.y+(r-v.x)/(T.x-v.x)*(T.y-v.y))._round()),v.y<o&&T.y<o||(v.y<o?v=new lt(v.x+(o-v.y)/(T.y-v.y)*(T.x-v.x),o)._round():T.y<o&&(T=new lt(v.x+(o-v.y)/(T.y-v.y)*(T.x-v.x),o)._round()),v.x>=u&&T.x>=u||(v.x>=u?v=new lt(u,v.y+(u-v.x)/(T.x-v.x)*(T.y-v.y))._round():T.x>=u&&(T=new lt(u,v.y+(u-v.x)/(T.x-v.x)*(T.y-v.y))._round()),v.y>=m&&T.y>=m||(v.y>=m?v=new lt(v.x+(m-v.y)/(T.y-v.y)*(T.x-v.x),m)._round():T.y>=m&&(T=new lt(v.x+(m-v.y)/(T.y-v.y)*(T.x-v.x),m)._round()),M&&v.equals(M[M.length-1])||(M=[v],h.push(M)),M.push(T)))))}}return h}function ZP(c){let r=0,o=0;for(const g of c)r+=g.w*g.h,o=Math.max(o,g.w);c.sort((g,b)=>b.h-g.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let m=0,h=0;for(const g of c)for(let b=u.length-1;b>=0;b--){const M=u[b];if(!(g.w>M.w||g.h>M.h)){if(g.x=M.x,g.y=M.y,h=Math.max(h,g.y+g.h),m=Math.max(m,g.x+g.w),g.w===M.w&&g.h===M.h){const P=u.pop();b<u.length&&(u[b]=P)}else g.h===M.h?(M.x+=g.w,M.w-=g.w):g.w===M.w?(M.y+=g.h,M.h-=g.h):(u.push({x:M.x+g.w,y:M.y,w:M.w-g.w,h:g.h}),M.y+=g.h,M.h-=g.h);break}}return{w:m,h,fill:r/(m*h)||0}}Zt(Ql,"Anchor");const Sg=1;class Hw{constructor(r,{pixelRatio:o,version:u,stretchX:m,stretchY:h,content:g},b){this.paddedRect=r,this.pixelRatio=o,this.stretchX=m,this.stretchY=h,this.content=g,this.version=u,this.padding=b}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class YP{constructor(r,o,u){const m={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,m,Sg,g),this.addImages(o,h,2,g);const{w:b,h:M}=ZP(g),P=new So({width:b||1,height:M||1});for(const v in r){const T=r[v],I=m[v].paddedRect;So.copy(T.data,P,{x:0,y:0},{x:I.x+Sg,y:I.y+Sg},T.data,u,T.sdf)}for(const v in o){const T=o[v],I=h[v].paddedRect;let E=h[v].padding;const C=I.x+E,D=I.y+E,O=T.data.width,F=T.data.height;E=E>1?E-1:E,So.copy(T.data,P,{x:0,y:0},{x:C,y:D},T.data,u),So.copy(T.data,P,{x:0,y:F-E},{x:C,y:D-E},{width:O,height:E},u),So.copy(T.data,P,{x:0,y:0},{x:C,y:D+F},{width:O,height:E},u),So.copy(T.data,P,{x:O-E,y:0},{x:C-E,y:D},{width:E,height:F},u),So.copy(T.data,P,{x:0,y:0},{x:C+O,y:D},{width:E,height:F},u),So.copy(T.data,P,{x:O-E,y:F-E},{x:C-E,y:D-E},{width:E,height:E},u),So.copy(T.data,P,{x:0,y:F-E},{x:C+O,y:D-E},{width:E,height:E},u),So.copy(T.data,P,{x:0,y:0},{x:C+O,y:D+F},{width:E,height:E},u),So.copy(T.data,P,{x:O-E,y:0},{x:C-E,y:D+F},{width:E,height:E},u)}this.image=P,this.iconPositions=m,this.patternPositions=h}addImages(r,o,u,m){for(const h in r){const g=r[h],b={x:0,y:0,w:g.data.width+2*u,h:g.data.height+2*u};m.push(b),o[h]=new Hw(b,g,u),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>r.hasImage(m,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const m in r.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[m],r.getImage(m,u),o),this.patchUpdatedImage(this.patternPositions[m],r.getImage(m,u),o)}patchUpdatedImage(r,o,u){if(!r||!o||r.version===o.version)return;r.version=o.version;const[m,h]=r.tl;u.update(o.data,{position:{x:m,y:h}})}}Zt(Hw,"ImagePosition"),Zt(YP,"ImageAtlas");const Tg=1e20;function XP(c,r,o,u,m,h,g,b,M){for(let P=r;P<r+u;P++)KP(c,o*h+P,h,m,g,b,M);for(let P=o;P<o+m;P++)KP(c,P*h+r,1,u,g,b,M)}function KP(c,r,o,u,m,h,g){h[0]=0,g[0]=-Tg,g[1]=Tg,m[0]=c[r];for(let b=1,M=0,P=0;b<u;b++){m[b]=c[r+b*o];const v=b*b;do{const T=h[M];P=(m[b]-m[T]+v-T*T)/(b-T)/2}while(P<=g[M]&&--M>-1);M++,h[M]=b,g[M]=P,g[M+1]=Tg}for(let b=0,M=0;b<u;b++){for(;g[M+1]<b;)M++;const P=h[M],v=b-P;c[r+b*o]=m[P]+v*v}}const ks=2,qw={none:0,ideographs:1,all:2};class zf{constructor(r,o,u){this.requestManager=r,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r,o){this.urls[o]=r}getGlyphs(r,o,u){const m=[],h=this.urls[o]||Re.GLYPHS_URL;for(const g in r)for(const b of r[g])m.push({stack:g,id:b});so(m,({stack:g,id:b},M)=>{let P=this.entries[g];P||(P=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=P.glyphs[b];if(v!==void 0)return void M(null,{stack:g,id:b,glyph:v});if(v=this._tinySDF(P,g,b),v)return P.glyphs[b]=v,void M(null,{stack:g,id:b,glyph:v});const T=Math.floor(b/256);if(256*T>65535)return void M(new Error("glyphs > 65535 not supported"));if(P.ranges[T])return void M(null,{stack:g,id:b,glyph:v});let I=P.requests[T];I||(I=P.requests[T]=[],zf.loadGlyphRange(g,T,h,this.requestManager,(E,C)=>{if(C){P.ascender=C.ascender,P.descender=C.descender;for(const D in C.glyphs)this._doesCharSupportLocalGlyph(+D)||(P.glyphs[+D]=C.glyphs[+D]);P.ranges[T]=!0}for(const D of I)D(E,C);delete P.requests[T]})),I.push((E,C)=>{E?M(E):C&&M(null,{stack:g,id:b,glyph:C.glyphs[b]||null})})},(g,b)=>{if(g)u(g);else if(b){const M={};for(const{stack:P,id:v,glyph:T}of b)M[P]===void 0&&(M[P]={}),M[P].glyphs===void 0&&(M[P].glyphs={}),M[P].glyphs[v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},M[P].ascender=this.entries[P].ascender,M[P].descender=this.entries[P].descender;u(null,M)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==qw.none&&(this.localGlyphMode===qw.all?!!this.localFontFamily:!!this.localFontFamily&&(rr["CJK Unified Ideographs"](r)||rr["Hangul Syllables"](r)||rr.Hiragana(r)||rr.Katakana(r)||rr["CJK Symbols and Punctuation"](r)||rr["CJK Unified Ideographs Extension A"](r)||rr["CJK Unified Ideographs Extension B"](r)))}_tinySDF(r,o,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let h=r.tinySDF;if(!h){let D="400";/bold/i.test(o)?D="900":/medium/i.test(o)?D="500":/light/i.test(o)&&(D="200"),h=r.tinySDF=new zf.TinySDF({fontFamily:m,fontWeight:D,fontSize:24*ks,buffer:3*ks,radius:8*ks}),h.fontWeight=D}if(this.localGlyphs[h.fontWeight][u])return this.localGlyphs[h.fontWeight][u];const g=String.fromCodePoint(u),{data:b,width:M,height:P,glyphWidth:v,glyphHeight:T,glyphLeft:I,glyphTop:E,glyphAdvance:C}=h.draw(g);return this.localGlyphs[h.fontWeight][u]={id:u,bitmap:new cu({width:M,height:P},b),metrics:{width:v/ks,height:T/ks,left:I/ks,top:E/ks-27,advance:C/ks,localGlyph:!0}}}}zf.loadGlyphRange=function(c,r,o,u,m){const h=256*r,g=h+255,b=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",c).replace("{range}",`${h}-${g}`),Ec.Glyphs);Mc(b,(M,P)=>{if(M)m(M);else if(P){const v={},T=function(I){return new K0(I).readFields(GN,{})}(P);for(const I of T.glyphs)v[I.id]=I;m(null,{glyphs:v,ascender:T.ascender,descender:T.descender})}})},zf.TinySDF=class{constructor({fontSize:c=24,buffer:r=3,radius:o=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=o;const b=this.size=c+4*r,M=this._createCanvas(b),P=this.ctx=M.getContext("2d",{willReadFrequently:!0});P.font=`${g} ${h} ${c}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(c){const r=document.createElement("canvas");return r.width=r.height=c,r}draw(c){const{width:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:h}=this.ctx.measureText(c),g=Math.ceil(o),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-m))),M=Math.min(this.size-this.buffer,g+Math.ceil(u)),P=b+2*this.buffer,v=M+2*this.buffer,T=Math.max(P*v,0),I=new Uint8ClampedArray(T),E={data:I,width:P,height:v,glyphWidth:b,glyphHeight:M,glyphTop:g,glyphLeft:0,glyphAdvance:r};if(b===0||M===0)return E;const{ctx:C,buffer:D,gridInner:O,gridOuter:F}=this;C.clearRect(D,D,b,M),C.fillText(c,D,D+g);const V=C.getImageData(D,D,b,M);F.fill(Tg,0,T),O.fill(0,0,T);for(let W=0;W<M;W++)for(let B=0;B<b;B++){const H=V.data[4*(W*b+B)+3]/255;if(H===0)continue;const Z=(W+D)*P+B+D;if(H===1)F[Z]=0,O[Z]=Tg;else{const re=.5-H;F[Z]=re>0?re*re:0,O[Z]=re<0?re*re:0}}XP(F,0,0,P,v,P,this.f,this.v,this.z),XP(O,D,D,b,M,P,this.f,this.v,this.z);for(let W=0;W<T;W++){const B=Math.sqrt(F[W])-Math.sqrt(O[W]);I[W]=Math.round(255-255*(B/this.radius+this.cutoff))}return E}};const hu=Sg;function JP(c,r,o,u){const m=[],h=c.imagePrimary,g=h.pixelRatio,b=h.paddedRect.w-2*hu,M=h.paddedRect.h-2*hu,P=c.right-c.left,v=c.bottom-c.top,T=h.stretchX||[[0,b]],I=h.stretchY||[[0,M]],E=(Te,_e)=>Te+_e[1]-_e[0],C=T.reduce(E,0),D=I.reduce(E,0),O=b-C,F=M-D;let V=0,W=C,B=0,H=D,Z=0,re=O,de=0,me=F;if(h.content&&u){const Te=h.content;V=Q0(T,0,Te[0]),B=Q0(I,0,Te[1]),W=Q0(T,Te[0],Te[2]),H=Q0(I,Te[1],Te[3]),Z=Te[0]-V,de=Te[1]-B,re=Te[2]-Te[0]-W,me=Te[3]-Te[1]-H}const ue=(Te,_e,Ce,Oe)=>{const Fe=ev(Te.stretch-V,W,P,c.left),Be=tv(Te.fixed-Z,re,Te.stretch,C),Ne=ev(_e.stretch-B,H,v,c.top),qe=tv(_e.fixed-de,me,_e.stretch,D),Ve=ev(Ce.stretch-V,W,P,c.left),ot=tv(Ce.fixed-Z,re,Ce.stretch,C),mt=ev(Oe.stretch-B,H,v,c.top),tt=tv(Oe.fixed-de,me,Oe.stretch,D),Nt=new lt(Fe,Ne),Ot=new lt(Ve,Ne),St=new lt(Ve,mt),vt=new lt(Fe,mt),or=new lt(Be/g,qe/g),Ft=new lt(ot/g,tt/g),Gt=r*Math.PI/180;if(Gt){const Fr=Math.sin(Gt),bn=Math.cos(Gt),dn=[bn,-Fr,Fr,bn];Nt._matMult(dn),Ot._matMult(dn),vt._matMult(dn),St._matMult(dn)}const gr=Te.stretch+Te.fixed,Dr=Ce.stretch+Ce.fixed,Mr=_e.stretch+_e.fixed,Cr=Oe.stretch+Oe.fixed,zr=c.imageSecondary;return{tl:Nt,tr:Ot,bl:vt,br:St,texPrimary:{x:h.paddedRect.x+hu+gr,y:h.paddedRect.y+hu+Mr,w:Dr-gr,h:Cr-Mr},texSecondary:zr?{x:zr.paddedRect.x+hu+gr,y:zr.paddedRect.y+hu+Mr,w:Dr-gr,h:Cr-Mr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:or,pixelOffsetBR:Ft,minFontScaleX:re/g/P,minFontScaleY:me/g/v,isSDF:o}};if(u&&(h.stretchX||h.stretchY)){const Te=QP(T,O,C),_e=QP(I,F,D);for(let Ce=0;Ce<Te.length-1;Ce++){const Oe=Te[Ce],Fe=Te[Ce+1];for(let Be=0;Be<_e.length-1;Be++)m.push(ue(Oe,_e[Be],Fe,_e[Be+1]))}}else m.push(ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:M+1}));return m}function Q0(c,r,o){let u=0;for(const m of c)u+=Math.max(r,Math.min(o,m[1]))-Math.max(r,Math.min(o,m[0]));return u}function QP(c,r,o){const u=[{fixed:-hu,stretch:0}];for(const[m,h]of c){const g=u[u.length-1];u.push({fixed:m-g.stretch,stretch:g.stretch}),u.push({fixed:m-g.stretch,stretch:g.stretch+(h-m)})}return u.push({fixed:r+hu,stretch:o}),u}function ev(c,r,o,u){return c/r*o+u}function tv(c,r,o,u){return c-r*o/u}function QN(c,r,o,u){const m=r+c.positionedLines[u].lineOffset;return u===0?o+m/2:o+(m+(r+c.positionedLines[u-1].lineOffset))/2}function e2(c,r=1,o=!1){let u=1/0,m=1/0,h=-1/0,g=-1/0;const b=c[0];for(let E=0;E<b.length;E++){const C=b[E];(!E||C.x<u)&&(u=C.x),(!E||C.y<m)&&(m=C.y),(!E||C.x>h)&&(h=C.x),(!E||C.y>g)&&(g=C.y)}const M=Math.min(h-u,g-m);let P=M/2;const v=new mm([],t2);if(M===0)return new lt(u,m);for(let E=u;E<h;E+=M)for(let C=m;C<g;C+=M)v.push(new Ff(E+P,C+P,P,c));let T=function(E){let C=0,D=0,O=0;const F=E[0];for(let V=0,W=F.length,B=W-1;V<W;B=V++){const H=F[V],Z=F[B],re=H.x*Z.y-Z.x*H.y;D+=(H.x+Z.x)*re,O+=(H.y+Z.y)*re,C+=3*re}return new Ff(D/C,O/C,0,E)}(c),I=v.length;for(;v.length;){const E=v.pop();(E.d>T.d||!T.d)&&(T=E,o&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,I)),E.max-T.d<=r||(P=E.h/2,v.push(new Ff(E.p.x-P,E.p.y-P,P,c)),v.push(new Ff(E.p.x+P,E.p.y-P,P,c)),v.push(new Ff(E.p.x-P,E.p.y+P,P,c)),v.push(new Ff(E.p.x+P,E.p.y+P,P,c)),I+=4)}return o&&(console.log(`num probes: ${I}`),console.log(`best distance: ${T.d}`)),T.p}function t2(c,r){return r.max-c.max}class Ff{constructor(r,o,u,m){this.p=new lt(r,o),this.h=u,this.d=function(h,g){let b=!1,M=1/0;for(let P=0;P<g.length;P++){const v=g[P];for(let T=0,I=v.length,E=I-1;T<I;E=T++){const C=v[T],D=v[E];C.y>h.y!=D.y>h.y&&h.x<(D.x-C.x)*(h.y-C.y)/(D.y-C.y)+C.x&&(b=!b),M=Math.min(M,pn(h,C,D))}}return(b?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const Zw=Number.POSITIVE_INFINITY,r2=Math.sqrt(2);function eA(c,[r,o]){let u=0,m=0;if(o===Zw){r<0&&(r=0);const h=r/r2;switch(c){case"top-right":case"top-left":m=h-7;break;case"bottom-right":case"bottom-left":m=7-h;break;case"bottom":m=7-r;break;case"top":m=r-7}switch(c){case"top-right":case"bottom-right":u=-h;break;case"top-left":case"bottom-left":u=h;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),o=Math.abs(o),c){case"top-right":case"top-left":case"top":m=o-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-o}switch(c){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,m]}function Yw(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function n2(c,r,o,u,m,h,g,b,M,P,v,T,I,E,C){let D=h.textMaxSize.evaluate(r,{},T);D===void 0&&(D=g);const O=c.layers[0].layout,F=O.get("icon-offset").evaluate(r,{},T),V=rA(o.horizontal)||o.vertical,W=I.name==="globe",B=ro,H=g/B,Z=c.tilePixelRatio*D/B,re=(Fe=c.overscaling,c.zoom>18&&Fe>2&&(Fe>>=1),Math.max(zt/(512*Fe),1)*O.get("symbol-spacing")),de=O.get("text-padding")*c.tilePixelRatio,me=O.get("icon-padding")*c.tilePixelRatio,ue=sr(O.get("text-max-angle")),Te=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",_e=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Ce=O.get("symbol-placement"),Oe=re/2;var Fe;const Be=O.get("icon-text-fit").evaluate(r,{},T),Ne=O.get("icon-text-fit-padding").evaluate(r,{},T),qe=Be!=="none";let Ve;c.hasAnyIconTextFit===!1&&qe&&(c.hasAnyIconTextFit=!0),u&&qe&&(c.allowVerticalPlacement&&o.vertical&&(Ve=jP(u,o.vertical,Be,Ne,F,H)),V&&(u=jP(u,V,Be,Ne,F,H)));const ot=(mt,tt,Nt)=>{if(tt.x<0||tt.x>=zt||tt.y<0||tt.y>=zt)return;let Ot=null;if(W){const{x:St,y:vt,z:or}=I.projectTilePoint(tt.x,tt.y,Nt);Ot={anchor:new Ql(St,vt,or,0,void 0),up:I.upVector(Nt,tt.x,tt.y)}}(function(St,vt,or,Ft,Gt,gr,Dr,Mr,Cr,zr,Fr,bn,dn,yr,on,an,In,ti,pi,ri,$n,Ui,vi,no,En,Qo,Fs){const ls=St.addToLineVertexArray(vt,Ft);let cs,jh,gu,Vh,Vg,SD,TD,ED=0,MD=0,CD=0,ID=0,TS=-1,ES=-1;const ml={};let PD=Do("");const $h=or?or.anchor:vt,MS=Cr.layout.get("icon-text-fit").evaluate($n,{},En)!=="none";let CS=0,IS=0;if(Cr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[CS,IS]=Cr.layout.get("text-offset").evaluate($n,{},En).map(pa=>pa*ro):(CS=Cr.layout.get("text-radial-offset").evaluate($n,{},En)*ro,IS=Zw),St.allowVerticalPlacement&&Gt.vertical){const pa=Gt.vertical;if(on)SD=Xw(pa),Mr&&(TD=Xw(Mr));else{const ma=Cr.layout.get("text-rotate").evaluate($n,{},En)+90;gu=rv(zr,$h,vt,Fr,bn,dn,pa,yr,ma,an),Mr&&(Vh=rv(zr,$h,vt,Fr,bn,dn,Mr,ti,ma))}}if(gr){const pa=Cr.layout.get("icon-rotate").evaluate($n,{},En),ma=JP(gr,pa,vi,MS),Gf=Mr?JP(Mr,pa,vi,MS):void 0;jh=rv(zr,$h,vt,Fr,bn,dn,gr,ti,pa),ED=4*ma.length;const AD=St.iconSizeData;let Wh=null;AD.kind==="source"?(Wh=[Rs*Cr.layout.get("icon-size").evaluate($n,{},En)],Wh[0]>du&&Gr(`${St.layerIds[0]}: Value for "icon-size" is >= ${Eg}. Reduce your "icon-size".`)):AD.kind==="composite"&&(Wh=[Rs*Ui.compositeIconSizes[0].evaluate($n,{},En),Rs*Ui.compositeIconSizes[1].evaluate($n,{},En)],(Wh[0]>du||Wh[1]>du)&&Gr(`${St.layerIds[0]}: Value for "icon-size" is >= ${Eg}. Reduce your "icon-size".`)),St.addSymbols(St.icon,ma,Wh,ri,pi,$n,!1,or,vt,ls.lineStartIndex,ls.lineLength,-1,no,En,Qo,Fs),TS=St.icon.placedSymbolArray.length-1,Gf&&(MD=4*Gf.length,St.addSymbols(St.icon,Gf,Wh,ri,pi,$n,za.vertical,or,vt,ls.lineStartIndex,ls.lineLength,-1,no,En,Qo,Fs),ES=St.icon.placedSymbolArray.length-1)}for(const pa in Gt.horizontal){const ma=Gt.horizontal[pa];cs||(PD=Do(ma.text),on?Vg=Xw(ma):cs=rv(zr,$h,vt,Fr,bn,dn,ma,yr,Cr.layout.get("text-rotate").evaluate($n,{},En),an));const Gf=ma.positionedLines.length===1;if(CD+=tA(St,or,vt,ma,Dr,Cr,on,$n,an,ls,Gt.vertical?za.horizontal:za.horizontalOnly,Gf?Object.keys(Gt.horizontal):[pa],ml,TS,Ui,no,En,Qo),Gf)break}Gt.vertical&&(ID+=tA(St,or,vt,Gt.vertical,Dr,Cr,on,$n,an,ls,za.vertical,["vertical"],ml,ES,Ui,no,En,Qo));let _u=-1;const PS=(pa,ma)=>pa?Math.max(pa,ma):ma;_u=PS(Vg,_u),_u=PS(SD,_u),_u=PS(TD,_u);const y6=_u>-1?1:0;St.glyphOffsetArray.length>=65535&&Gr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$n.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,$n.sortKey),St.symbolInstances.emplaceBack(vt.x,vt.y,$h.x,$h.y,$h.z,ml.right>=0?ml.right:-1,ml.center>=0?ml.center:-1,ml.left>=0?ml.left:-1,ml.vertical>=0?ml.vertical:-1,TS,ES,PD,cs!==void 0?cs:St.collisionBoxArray.length,cs!==void 0?cs+1:St.collisionBoxArray.length,gu!==void 0?gu:St.collisionBoxArray.length,gu!==void 0?gu+1:St.collisionBoxArray.length,jh!==void 0?jh:St.collisionBoxArray.length,jh!==void 0?jh+1:St.collisionBoxArray.length,Vh||St.collisionBoxArray.length,Vh?Vh+1:St.collisionBoxArray.length,Fr,CD,ID,ED,MD,y6,0,CS,IS,_u,0,MS?1:0)})(c,tt,Ot,mt,o,u,m,Ve,c.layers[0],c.collisionBoxArray,r.index,r.sourceLayerIndex,c.index,de,Te,M,0,me,_e,F,r,h,P,v,T,E,C)};if(Ce==="line")for(const mt of qP(r.geometry,0,0,zt,zt)){const tt=JN(mt,re,ue,o.vertical||V,u,B,Z,c.overscaling,zt);for(const Nt of tt)V&&i2(c,V.text,Oe,Nt)||ot(mt,Nt,T)}else if(Ce==="line-center"){for(const mt of r.geometry)if(mt.length>1){const tt=KN(mt,ue,o.vertical||V,u,B,Z);tt&&ot(mt,tt,T)}}else if(r.type==="Polygon")for(const mt of $0(r.geometry,0)){const tt=e2(mt,16);ot(mt[0],new Ql(tt.x,tt.y,0,0,void 0),T)}else if(r.type==="LineString")for(const mt of r.geometry)ot(mt,new Ql(mt[0].x,mt[0].y,0,0,void 0),T);else if(r.type==="Point")for(const mt of r.geometry)for(const tt of mt)ot([tt],new Ql(tt.x,tt.y,0,0,void 0),T)}const Eg=255,du=Eg*Rs;function tA(c,r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O,F){const V=function(H,Z,re,de,me,ue,Te,_e){const Ce=[];if(Z.positionedLines.length===0)return Ce;const Oe=de.layout.get("text-rotate").evaluate(ue,{})*Math.PI/180,Fe=function(ot){const mt=ot[0],tt=ot[1],Nt=mt*tt;return Nt>0?[mt,-tt]:Nt<0?[-mt,tt]:mt===0?[tt,mt]:[tt,-mt]}(re);let Be=Math.abs(Z.top-Z.bottom);for(const ot of Z.positionedLines)Be-=ot.lineOffset;const Ne=Z.positionedLines.length,qe=Be/Ne;let Ve=Z.top-re[1];for(let ot=0;ot<Ne;++ot){const mt=Z.positionedLines[ot];Ve=QN(Z,qe,Ve,ot);for(const tt of mt.positionedGlyphs){if(!tt.rect)continue;const Nt=tt.rect||{};let Ot=LP+1,St=!0,vt=1,or=0;if(tt.imageName){const ri=Te[tt.imageName];if(!ri)continue;if(ri.sdf){Gr("SDF images are not supported in formatted text and will be ignored.");continue}St=!1,vt=ri.pixelRatio,Ot=Sg/vt}const Ft=(me||_e)&&tt.vertical,Gt=tt.metrics.advance*tt.scale/2,gr=tt.metrics,Dr=tt.rect;if(Dr===null)continue;_e&&Z.verticalizable&&(or=tt.imageName?Gt-tt.metrics.width*tt.scale/2:0);const Mr=me?[tt.x+Gt,tt.y]:[0,0];let Cr=[0,0],zr=[0,0],Fr=!1;me||(Ft?(zr=[tt.x+Gt+Fe[0],tt.y+Fe[1]-or],Fr=!0):Cr=[tt.x+Gt+re[0],tt.y+re[1]-or]);const bn=Dr.w*tt.scale/(vt*(tt.localGlyph?ks:1)),dn=Dr.h*tt.scale/(vt*(tt.localGlyph?ks:1));let yr,on,an,In;if(Ft){const ri=tt.y-Ve,$n=new lt(-Gt,Gt-ri),Ui=-Math.PI/2,vi=new lt(...zr);yr=new lt(-Gt+Cr[0],Cr[1]),yr._rotateAround(Ui,$n)._add(vi),yr.x+=-ri+Gt,yr.y-=(gr.left-Ot)*tt.scale;const no=tt.imageName?gr.advance*tt.scale:ro*tt.scale,En=String.fromCodePoint(tt.glyph);VN(En)?yr.x+=(1-Ot)*tt.scale:$N(En)?yr.x+=no-gr.height*tt.scale+(-Ot-1)*tt.scale:yr.x+=tt.imageName||gr.width+2*Ot===Dr.w&&gr.height+2*Ot===Dr.h?(no-dn)/2:(no-(gr.height+2*Ot)*tt.scale)/2,on=new lt(yr.x,yr.y-bn),an=new lt(yr.x+dn,yr.y),In=new lt(yr.x+dn,yr.y-bn)}else{const ri=(gr.left-Ot)*tt.scale-Gt+Cr[0],$n=(-gr.top-Ot)*tt.scale+Cr[1],Ui=ri+bn,vi=$n+dn;yr=new lt(ri,$n),on=new lt(Ui,$n),an=new lt(ri,vi),In=new lt(Ui,vi)}if(Oe){let ri;ri=me?new lt(0,0):Fr?new lt(Fe[0],Fe[1]):new lt(re[0],re[1]),yr._rotateAround(Oe,ri),on._rotateAround(Oe,ri),an._rotateAround(Oe,ri),In._rotateAround(Oe,ri)}const ti=new lt(0,0),pi=new lt(0,0);Ce.push({tl:yr,tr:on,bl:an,br:In,texPrimary:Nt,texSecondary:void 0,writingMode:Z.writingMode,glyphOffset:Mr,sectionIndex:tt.sectionIndex,isSDF:St,pixelOffsetTL:ti,pixelOffsetBR:pi,minFontScaleX:0,minFontScaleY:0})}}return Ce}(0,u,M,h,g,b,m,c.allowVerticalPlacement),W=c.textSizeData;let B=null;W.kind==="source"?(B=[Rs*h.layout.get("text-size").evaluate(b,{},O)],B[0]>du&&Gr(`${c.layerIds[0]}: Value for "text-size" is >= ${Eg}. Reduce your "text-size".`)):W.kind==="composite"&&(B=[Rs*C.compositeTextSizes[0].evaluate(b,{},O),Rs*C.compositeTextSizes[1].evaluate(b,{},O)],(B[0]>du||B[1]>du)&&Gr(`${c.layerIds[0]}: Value for "text-size" is >= ${Eg}. Reduce your "text-size".`)),c.addSymbols(c.text,V,B,M,g,b,v,r,o,P.lineStartIndex,P.lineLength,E,D,O,F,!1);for(const H of T)I[H]=c.text.placedSymbolArray.length-1;return 4*V.length}function rA(c){for(const r in c)return c[r];return null}function rv(c,r,o,u,m,h,g,b,M,P){let v=g.top,T=g.bottom,I=g.left,E=g.right;const C=g.collisionPadding;if(C&&(I-=C[0],v-=C[1],E+=C[2],T+=C[3]),M){const D=new lt(I,v),O=new lt(E,v),F=new lt(I,T),V=new lt(E,T),W=sr(M);let B=new lt(0,0);P&&(B=new lt(P[0],P[1])),D._rotateAround(W,B),O._rotateAround(W,B),F._rotateAround(W,B),V._rotateAround(W,B),I=Math.min(D.x,O.x,F.x,V.x),E=Math.max(D.x,O.x,F.x,V.x),v=Math.min(D.y,O.y,F.y,V.y),T=Math.max(D.y,O.y,F.y,V.y)}return c.emplaceBack(r.x,r.y,r.z,o.x,o.y,I,v,E,T,b,u,m,h),c.length-1}function Xw(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const r=c.bottom-c.top;return r>0?Math.max(10,r):null}function i2(c,r,o,u){const m=c.compareText;if(r in m){const h=m[r];for(let g=h.length-1;g>=0;g--)if(u.dist(h[g])<o)return!0}else m[r]=[];return m[r].push(u),!1}function nA(c,r){const o=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*r:0,m=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),h=Math.sin(o)*m/Math.sin(Math.max(Math.PI/2-c._pitch-o,.01));let g=Math.sin(c._pitch)*h+m;const b=m*(1/c._horizonShift);return c.elevation&&c.elevation.exaggeration()!==0||(g*=1+Math.max(c.zoom-17,0)),Math.min(1.01*g,b)}function Mg(c,r){if(!r.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:r};const o=Math.pow(2,-c.z),u=c.x*o,m=(c.x+1)*o,h=c.y*o,g=(c.y+1)*o,b=xe(u),M=xe(m),P=ve(h),v=ve(g),T=r.project(b,P),I=r.project(M,P),E=r.project(M,v),C=r.project(b,v);let D=Math.min(T.x,I.x,E.x,C.x),O=Math.min(T.y,I.y,E.y,C.y),F=Math.max(T.x,I.x,E.x,C.x),V=Math.max(T.y,I.y,E.y,C.y);const W=o/16;function B(Z,re,de,me,ue,Te){const _e=(de+ue)/2,Ce=(me+Te)/2,Oe=r.project(xe(_e),ve(Ce)),Fe=Math.max(0,D-Oe.x,O-Oe.y,Oe.x-F,Oe.y-V);D=Math.min(D,Oe.x),F=Math.max(F,Oe.x),O=Math.min(O,Oe.y),V=Math.max(V,Oe.y),Fe>W&&(B(Z,Oe,de,me,_e,Ce),B(Oe,re,_e,Ce,ue,Te))}B(T,I,u,h,m,h),B(I,E,m,h,m,g),B(E,C,m,g,u,g),B(C,T,u,g,u,h),D-=W,O-=W,F+=W,V+=W;const H=1/Math.max(F-D,V-O);return{scale:H,x:D*H,y:O*H,x2:F*H,y2:V*H,projection:r}}function iA(c,{x:r,y:o},u=0){return new lt(((r-u)*c.scale-c.x)*zt,(o*c.scale-c.y)*zt)}const o2=be.mat4.identity(new Float32Array(16));class fu{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,o){return{x:0,y:0,z:0}}unproject(r,o){return new $(0,0)}projectTilePoint(r,o,u){return{x:r,y:o,z:0}}locationPoint(r,o,u=!0){return r._coordinatePoint(r.locationCoordinate(o),u)}pixelsPerMeter(r,o){return he(1,r)*o}pixelSpaceConversion(r,o,u){return 1}farthestPixelDistance(r){return nA(r,r.pixelsPerMeter)}pointCoordinate(r,o,u,m){const h=r.horizonLineFromTop(!1),g=new lt(o,Math.max(h,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(g,m))}pointCoordinate3D(r,o,u){const m=new lt(o,u);if(r.elevation)return r.elevation.pointCoordinate(m);{const h=this.pointCoordinate(r,m.x,m.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(r,o){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,o.x,o.y);const u=r.horizonLineFromTop();return o.y<u}createInversionMatrix(r,o){return o2}createTileMatrix(r,o,u){let m,h,g;const b=u.canonical,M=be.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=Mg(b,this);m=1,h=P.x+u.wrap*P.scale,g=P.y,be.mat4.scale(M,M,[m/P.scale,m/P.scale,r.pixelsPerMeter/o])}else m=o/r.zoomScale(b.z),h=(b.x+Math.pow(2,b.z)*u.wrap)*m,g=b.y*m;return be.mat4.translate(M,M,[h,g,0]),be.mat4.scale(M,M,[m/zt,m/zt,1]),M}upVector(r,o,u){return[0,0,1]}upVectorScale(r,o,u){return{metersToTile:1}}}class a2 extends fu{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[o,u]=this.parallels=r.parallels||[29.5,45.5],m=Math.sin(sr(o));this.n=(m+Math.sin(sr(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(r,o){const{n:u,c:m,r0:h}=this,g=sr(r-this.center[0]),b=sr(o),M=Math.sqrt(m-2*u*Math.sin(b))/u;return{x:M*Math.sin(g*u),y:M*Math.cos(g*u)-h,z:0}}unproject(r,o){const{n:u,c:m,r0:h}=this,g=h+o;let b=Math.atan2(r,Math.abs(g))*Math.sign(g);g*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(g));const M=sr(this.center[0])*u;b=ao(b,-Math.PI-M,Math.PI-M);const P=hr(Hr(b/u)+this.center[0],-180,180),v=Math.asin(hr((m-(r*r+g*g)*u*u)/(2*u),-1,1)),T=hr(Hr(v),-Ee,Ee);return new $(P,T)}}const Cg=1.340264,Ig=-.081106,Pg=893e-6,Ag=.003796,nv=Math.sqrt(3)/2;class s2 extends fu{project(r,o){o=o/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(nv*Math.sin(o)),m=u*u,h=m*m*m;return{x:.5*(r*Math.cos(u)/(nv*(Cg+3*Ig*m+h*(7*Pg+9*Ag*m)))/Math.PI+.5),y:1-.5*(u*(Cg+Ig*m+h*(Pg+Ag*m))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,m=u*u,h=m*m*m;for(let v,T,I,E=0;E<12&&(T=u*(Cg+Ig*m+h*(Pg+Ag*m))-o,I=Cg+3*Ig*m+h*(7*Pg+9*Ag*m),v=T/I,u=hr(u-v,-Math.PI/3,Math.PI/3),m=u*u,h=m*m*m,!(Math.abs(v)<1e-12));++E);const g=nv*r*(Cg+3*Ig*m+h*(7*Pg+9*Ag*m))/Math.cos(u),b=Math.asin(Math.sin(u)/nv),M=hr(180*g/Math.PI,-180,180),P=hr(180*b/Math.PI,-Ee,Ee);return new $(M,P)}}class l2 extends fu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){return{x:.5+r/360,y:.5-o/360,z:0}}unproject(r,o){const u=360*(r-.5),m=hr(360*(.5-o),-Ee,Ee);return new $(u,m)}}const Bf=Math.PI/2;function iv(c){return Math.tan((Bf+c)/2)}class c2 extends fu{constructor(r){super(r),this.center=r.center||[0,30];const[o,u]=this.parallels=r.parallels||[30,30];let m=sr(o),h=sr(u);this.southernCenter=m+h<0,this.southernCenter&&(m=-m,h=-h);const g=Math.cos(m),b=iv(m);this.n=m===h?Math.sin(m):Math.log(g/Math.cos(h))/Math.log(iv(h)/b),this.f=g*Math.pow(iv(m),this.n)/this.n}project(r,o){o=sr(o),this.southernCenter&&(o=-o),r=sr(r-this.center[0]);const u=1e-6,{n:m,f:h}=this;h>0?o<-Bf+u&&(o=-Bf+u):o>Bf-u&&(o=Bf-u);const g=h/Math.pow(iv(o),m);let b=g*Math.sin(m*r),M=h-g*Math.cos(m*r);return b=.5*(b/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:b,y:this.southernCenter?M:1-M,z:0}}unproject(r,o){r=(2*r-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:m}=this,h=m-o,g=Math.sign(h),b=Math.sign(u)*Math.sqrt(r*r+h*h);let M=Math.atan2(r,Math.abs(h))*g;h*u<0&&(M-=Math.PI*Math.sign(r)*g);const P=hr(Hr(M/u)+this.center[0],-180,180),v=hr(Hr(2*Math.atan(Math.pow(m/b,1/u))-Bf),-Ee,Ee);return new $(P,this.southernCenter?-v:v)}}class oA extends fu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,o){return{x:fe(r),y:ge(o),z:0}}unproject(r,o){const u=xe(r),m=ve(o);return new $(u,m)}}const aA=sr(Ee);class u2 extends fu{project(r,o){const u=(o=sr(o))*o,m=u*u;return{x:.5*((r=sr(r))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,m=25,h=0,g=u*u;do{g=u*u;const P=g*g;h=(u*(1.007226+g*(.015085+P*(.028874*g-.044475-.005916*P)))-o)/(1.007226+g*(.045255+P*(.259866*g-.311325-.005916*11*P))),u=hr(u-h,-aA,aA)}while(Math.abs(h)>1e-6&&--m>0);g=u*u;const b=hr(Hr(r/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),M=Hr(u);return new $(b,M)}}const sA=sr(Ee);class h2 extends fu{project(r,o){o=sr(o),r=sr(r);const u=Math.cos(o),m=2/Math.PI,h=Math.acos(u*Math.cos(r/2)),g=Math.sin(h)/h,b=.5*(r*m+2*u*Math.sin(r/2)/g)||0,M=.5*(o+Math.sin(o)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(r,o){let u=r=(2*r-.5)*Math.PI,m=o=(2*(1-o)-1)*Math.PI,h=25;const g=1e-6;let b=0,M=0;do{const P=Math.cos(m),v=Math.sin(m),T=2*v*P,I=v*v,E=P*P,C=Math.cos(u/2),D=Math.sin(u/2),O=2*C*D,F=D*D,V=1-E*C*C,W=V?1/V:0,B=V?Math.acos(P*C)*Math.sqrt(1/V):0,H=.5*(2*B*P*D+2*u/Math.PI)-r,Z=.5*(B*v+m)-o,re=.5*W*(E*F+B*P*C*I)+1/Math.PI,de=W*(O*T/4-B*v*D),me=.125*W*(T*D-B*v*E*O),ue=.5*W*(I*C+B*F*P)+.5,Te=de*me-ue*re;b=(Z*de-H*ue)/Te,M=(H*me-Z*re)/Te,u=hr(u-b,-Math.PI,Math.PI),m=hr(m-M,-sA,sA)}while((Math.abs(b)>g||Math.abs(M)>g)&&--h>0);return new $(Hr(u),Hr(m))}}class lA extends fu{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(sr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){const{scale:u,cosPhi:m}=this;return{x:sr(r)*m*u+.5,y:-Math.sin(sr(o))/m*u+.5,z:0}}unproject(r,o){const{scale:u,cosPhi:m}=this,h=-(o-.5)/u,g=hr(Hr((r-.5)/u)/m,-180,180),b=Math.asin(hr(h*m,-1,1)),M=hr(Hr(b),-Ee,Ee);return new $(g,M)}}class d2 extends oA{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,o,u){const m=ug(r,o,u),h=N0(fl(u));return be.vec3.transformMat4(m,m,h),{x:m[0],y:m[1],z:m[2]}}locationPoint(r,o){const u=z(o.lat,o.lng),m=be.vec3.normalize([],u),h=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(o),r._centerAltitude):r._centerAltitude,g=he(1,0)*zt*h;be.vec3.scaleAndAdd(u,u,m,g);const b=be.mat4.identity(new Float64Array(16));return be.mat4.multiply(b,r.pixelMatrix,r.globeMatrix),be.vec3.transformMat4(u,u,b),new lt(u[0],u[1])}pixelsPerMeter(r,o){return he(1,0)*o}pixelSpaceConversion(r,o,u){const m=he(1,r)*o,h=ur(he(1,45)*o,m,u);return this.pixelsPerMeter(r,o)/h}createTileMatrix(r,o,u){const m=xw(fl(u.canonical));return be.mat4.multiply(new Float64Array(16),r.globeMatrix,m)}createInversionMatrix(r,o){const{center:u}=r,m=N0(fl(o));return be.mat4.rotateY(m,m,sr(u.lng)),be.mat4.rotateX(m,m,sr(u.lat)),be.mat4.scale(m,m,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(r,o,u,m){return z0(r,o,u,!0)||new $e(0,0)}pointCoordinate3D(r,o,u){const m=this.pointCoordinate(r,o,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(r,o){return!z0(r,o.x,o.y,!1)}farthestPixelDistance(r){const o=function(m,h){const g=m.cameraToCenterDistance,b=m._centerAltitude*h,M=m._camera,P=m._camera.forward(),v=be.vec3.add([],be.vec3.scale([],P,-g),[0,0,b]),T=m.worldSize/(2*Math.PI),I=[0,0,-T],E=m.width/m.height,C=Math.tan(m.fovAboveCenter),D=be.vec3.scale([],M.up(),C),O=be.vec3.scale([],M.right(),C*E),F=be.vec3.normalize([],be.vec3.add([],be.vec3.add([],P,D),O)),V=[];let W;if(new Ds(v,F).closestPointOnSphere(I,T,V)){const B=be.vec3.add([],V,I),H=be.vec3.sub([],B,v);W=Math.cos(m.fovAboveCenter)*be.vec3.length(H)}else{const B=be.vec3.sub([],v,I),H=be.vec3.sub([],I,v);be.vec3.normalize(H,H);const Z=be.vec3.length(B)-T;W=Math.sqrt(Z*(Z+2*T));const re=Math.acos(W/(T+Z))-Math.acos(be.vec3.dot(P,H));W*=Math.cos(re)}return 1.01*W}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=lu(r.zoom);if(u>0){const m=nA(r,he(1,r.center.lat)*r.worldSize),h=r.worldSize/(2*Math.PI),g=Math.max(r.width,r.height)/r.worldSize*Math.PI;return ur(o,m+h*(1-Math.cos(g)),Math.pow(u,10))}return o}upVector(r,o,u){return ug(o,u,r,1)}upVectorScale(r){return{metersToTile:Kl(B0(fl(r)))}}}function cA(c){const r=c.parallels,o=!!r&&Math.abs(r[0]+r[1])<.01;switch(c.name){case"mercator":return new oA(c);case"equirectangular":return new l2(c);case"naturalEarth":return new u2(c);case"equalEarth":return new s2(c);case"winkelTripel":return new h2(c);case"albers":return o?new lA(c):new a2(c);case"lambertConformalConic":return o?new lA(c):new c2(c);case"globe":return new d2(c)}throw new Error(`Invalid projection name: ${c.name}`)}const f2=kf.VectorTileFeature.types,p2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ov(c,r,o,u,m,h,g,b,M,P,v,T,I){const E=b?Math.min(du,Math.round(b[0])):0,C=b?Math.min(du,Math.round(b[1])):0;c.emplaceBack(r,o,Math.round(32*u),Math.round(32*m),h,g,(E<<1)+(M?1:0),C,16*P,16*v,256*T,256*I)}function av(c,r,o){c.emplaceBack(r,o)}function sv(c,r,o,u,m,h,g){c.emplaceBack(r,o,u,m,h,g)}function lv(c,r,o,u,m){c.emplaceBack(r,o,u,m),c.emplaceBack(r,o,u,m),c.emplaceBack(r,o,u,m),c.emplaceBack(r,o,u,m)}function m2(c){for(const r of c.sections)if(rw(r.text))return!0;return!1}class Kw{constructor(r){this.layoutVertexArray=new Xm,this.indexArray=new qi,this.programConfigurations=r,this.segments=new Zn,this.dynamicLayoutVertexArray=new Cs,this.opacityVertexArray=new Jm,this.placedSymbolArray=new ng,this.iconTransitioningVertexArray=new ul,this.globeExtVertexArray=new Km,this.zOffsetVertexArray=new ru}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,o,u,m,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,RN.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,ON.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,p2,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,zN.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,kN.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,LN.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Zt(Kw,"SymbolBuffers");class Jw{constructor(r,o,u){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Zn,this.collisionVertexArray=new tu,this.collisionVertexArrayExt=new Cs}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,FN.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,BN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(Jw,"CollisionBuffers");class cv{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.lut=r.lut,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=be.mat4.identity([]),this.placementViewportMatrix=be.mat4.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Uw(this.zoom,o["text-size"]),this.iconSizeData=Uw(this.zoom,o["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),h=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>za[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Kw(new hl(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new Kw(new hl(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new C0,this.lineVertexArray=new If,this.symbolInstances=new ig}calculateGlyphDependencies(r,o,u,m,h){for(let g=0;g<r.length;g++){const b=r.codePointAt(g);if(b===void 0)break;if(o[b]=!0,m&&h&&b<=65535){const M=bg[r.charAt(g)];M&&(o[M.charCodeAt(0)]=!0)}}}updateFootprints(r,o){}updateReplacement(r,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!Ow(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(r,o,u,m){const h=this.layers[0],g=h.layout,b=this.projection.name==="globe",M=g.get("text-font"),P=g.get("text-field"),v=g.get("icon-image"),T=(P.value.kind!=="constant"||P.value.value instanceof co&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),I=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,E=g.get("symbol-sort-key");if(this.features=[],!T&&!I)return;const C=o.iconDependencies,D=o.glyphDependencies,O=o.availableImages,F=new qn(this.zoom);for(const{feature:V,id:W,index:B,sourceLayerIndex:H}of r){const Z=h._featureFilter.needGeometry,re=Et(V,Z);if(!h._featureFilter.filter(F,re,u))continue;if(Z||(re.geometry=wt(V,u,m)),b&&V.type!==1&&u.z<=5){const Te=re.geometry,_e=.98078528056,Ce=(Oe,Fe)=>{const Be=ug(Oe.x,Oe.y,u,1),Ne=ug(Fe.x,Fe.y,u,1);return be.vec3.dot(Be,Ne)<_e};for(let Oe=0;Oe<Te.length;Oe++)Te[Oe]=xt(Te[Oe],Ce)}let de,me;if(T){const Te=h.getValueAndResolveTokens("text-field",re,u,O),_e=co.factory(Te);m2(_e)&&(this.hasRTLText=!0),(!this.hasRTLText||Wm()==="unavailable"||this.hasRTLText&&Lo.isParsed())&&(de=jN(_e,h,re))}if(I){const Te=h.getValueAndResolveTokens("icon-image",re,u,O);me=Te instanceof yo?Te:yo.fromString(Te)}if(!de&&!me)continue;const ue=this.sortFeaturesByKey?E.evaluate(re,{},u):void 0;if(this.features.push({id:W,text:de,icon:me,index:B,sourceLayerIndex:H,geometry:re.geometry,properties:V.properties,type:f2[V.type],sortKey:ue}),me&&(C[me.namePrimary]=!0,me.nameSecondary&&(C[me.nameSecondary]=!0)),de){const Te=M.evaluate(re,{},u).join(","),_e=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(za.vertical)>=0;for(const Ce of de.sections)if(Ce.image)C[Ce.image.namePrimary]=!0;else{const Oe=df(de.toString()),Fe=Ce.fontStack||Te,Be=D[Fe]=D[Fe]||{};this.calculateGlyphDependencies(Ce.text,Be,_e,this.allowVerticalPlacement,Oe)}}}g.get("symbol-placement")==="line"&&(this.features=function(V){const W={},B={},H=[];let Z=0;function re(Te){H.push(V[Te]),Z++}function de(Te,_e,Ce){const Oe=B[Te];return delete B[Te],B[_e]=Oe,H[Oe].geometry[0].pop(),H[Oe].geometry[0]=H[Oe].geometry[0].concat(Ce[0]),Oe}function me(Te,_e,Ce){const Oe=W[_e];return delete W[_e],W[Te]=Oe,H[Oe].geometry[0].shift(),H[Oe].geometry[0]=Ce[0].concat(H[Oe].geometry[0]),Oe}function ue(Te,_e,Ce){const Oe=Ce?_e[0][_e[0].length-1]:_e[0][0];return`${Te}:${Oe.x}:${Oe.y}`}for(let Te=0;Te<V.length;Te++){const _e=V[Te],Ce=_e.geometry,Oe=_e.text?_e.text.toString():null;if(!Oe){re(Te);continue}const Fe=ue(Oe,Ce),Be=ue(Oe,Ce,!0);if(Fe in B&&Be in W&&B[Fe]!==W[Be]){const Ne=me(Fe,Be,Ce),qe=de(Fe,Be,H[Ne].geometry);delete W[Fe],delete B[Be],B[ue(Oe,H[qe].geometry,!0)]=qe,H[Ne].geometry=null}else Fe in B?de(Fe,Be,Ce):Be in W?me(Fe,Be,Ce):(re(Te),W[Fe]=Z-1,B[Be]=Z-1)}return H.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,W)=>V.sortKey-W.sortKey)}update(r,o,u,m,h){const g=Object.keys(r).length!==0;if(g&&!this.stateDependentLayers.length)return;const b=g?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(r,o,b,u,m,h),this.icon.programConfigurations.updatePaintArrays(r,o,b,u,m,h)}updateZOffset(){const r=(h,g,b)=>{u+=g,u>h.length&&h.resize(u);for(let M=-g;M<0;M++)h.emplace(M+u,b)},o=(h,g,b)=>{m+=g,m>h.length&&h.resize(m);for(let M=-g;M<0;M++)h.emplace(M+m,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:M,numIconVertices:P}=g,v=g.zOffset,T=P>0;if((b>0||M>0)&&(r(this.text.zOffsetVertexArray,b,v),r(this.text.zOffsetVertexArray,M,v)),T){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:E}=g;I>=0&&o(this.icon.zOffsetVertexArray,P,v),E>=0&&o(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=cA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:m,y:h}of o)this.lineVertexArray.emplaceBack(m,h);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,o,u,m,h,g,b,M,P,v,T,I,E,C,D,O){const F=r.indexArray,V=r.layoutVertexArray,W=r.globeExtVertexArray,B=r.segments.prepareSegment(4*o.length,V,F,this.canOverlap?g.sortKey:void 0),H=this.glyphOffsetArray.length,Z=B.vertexLength,re=this.allowVerticalPlacement&&b===za.vertical?Math.PI/2:0,de=g.text&&g.text.sections;for(let ue=0;ue<o.length;ue++){const{tl:Te,tr:_e,bl:Ce,br:Oe,texPrimary:Fe,texSecondary:Be,pixelOffsetTL:Ne,pixelOffsetBR:qe,minFontScaleX:Ve,minFontScaleY:ot,glyphOffset:mt,isSDF:tt,sectionIndex:Nt}=o[ue],Ot=B.vertexLength,St=mt[1];if(ov(V,P.x,P.y,Te.x,St+Te.y,Fe.x,Fe.y,u,tt,Ne.x,Ne.y,Ve,ot),ov(V,P.x,P.y,_e.x,St+_e.y,Fe.x+Fe.w,Fe.y,u,tt,qe.x,Ne.y,Ve,ot),ov(V,P.x,P.y,Ce.x,St+Ce.y,Fe.x,Fe.y+Fe.h,u,tt,Ne.x,qe.y,Ve,ot),ov(V,P.x,P.y,Oe.x,St+Oe.y,Fe.x+Fe.w,Fe.y+Fe.h,u,tt,qe.x,qe.y,Ve,ot),M){const{x:vt,y:or,z:Ft}=M.anchor,[Gt,gr,Dr]=M.up;sv(W,vt,or,Ft,Gt,gr,Dr),sv(W,vt,or,Ft,Gt,gr,Dr),sv(W,vt,or,Ft,Gt,gr,Dr),sv(W,vt,or,Ft,Gt,gr,Dr),lv(r.dynamicLayoutVertexArray,vt,or,Ft,re)}else lv(r.dynamicLayoutVertexArray,P.x,P.y,P.z,re);if(O){const vt=Be||Fe;av(r.iconTransitioningVertexArray,vt.x,vt.y),av(r.iconTransitioningVertexArray,vt.x+vt.w,vt.y),av(r.iconTransitioningVertexArray,vt.x,vt.y+vt.h),av(r.iconTransitioningVertexArray,vt.x+vt.w,vt.y+vt.h)}F.emplaceBack(Ot,Ot+1,Ot+2),F.emplaceBack(Ot+1,Ot+2,Ot+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),ue!==o.length-1&&Nt===o[ue+1].sectionIndex||r.programConfigurations.populatePaintArrays(V.length,g,g.index,{},E,C,D,de&&de[Nt])}const me=M?M.anchor:P;r.placedSymbolArray.emplaceBack(me.x,me.y,me.z,P.x,P.y,H,this.glyphOffsetArray.length-H,Z,v,T,P.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],b,0,!1,0,I,0)}_commitLayoutVertex(r,o,u,m,h,g,b){r.emplaceBack(o,u,m,h,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,o,u,m,h,g,b){const M=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),P=M.vertexLength,v=b.tileAnchorX,T=b.tileAnchorY;for(let E=0;E<4;E++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,r.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,T,new lt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,T,new lt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,T,new lt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,T,new lt(r.x1,r.y2)),M.vertexLength+=4;const I=u.indexArray;I.emplaceBack(P,P+1),I.emplaceBack(P+1,P+2),I.emplaceBack(P+2,P+3),I.emplaceBack(P+3,P),M.primitiveLength+=4}_addTextDebugCollisionBoxes(r,o,u,m,h,g){for(let b=m;b<h;b++){const M=u.get(b),P=this.getSymbolInstanceTextSize(r,g,o,b);this._addCollisionDebugVertices(M,P,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(r,o,u,m,h,g){for(let b=m;b<h;b++){const M=u.get(b),P=this.getSymbolInstanceIconSize(r,o,g.placedIconSymbolIndex);this._addCollisionDebugVertices(M,P,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,g)}}generateCollisionDebugBuffers(r,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jw(Zl,DP.members,ul),this.iconCollisionBox=new Jw(Zl,DP.members,ul);const u=Of(this.iconSizeData,r),m=Of(this.textSizeData,r);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(m,r,o,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(m,r,o,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,r,o,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,r,o,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(r,o,u,m){const h=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:m),g=X0(this.textSizeData,r,h)/ro;return this.tilePixelRatio*g}getSymbolInstanceIconSize(r,o,u){const m=this.icon.placedSymbolArray.get(u),h=X0(this.iconSizeData,r,m);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(r,o,u,m){r.emplaceBack(o,-u,-u,m),r.emplaceBack(o,u,-u,m),r.emplaceBack(o,u,u,m),r.emplaceBack(o,-u,u,m)}_updateTextDebugCollisionBoxes(r,o,u,m,h,g){for(let b=m;b<h;b++){const M=u.get(b),P=this.getSymbolInstanceTextSize(r,g,o,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,M.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(r,o,u,m,h,g){for(let b=m;b<h;b++){const M=u.get(b),P=this.getSymbolInstanceIconSize(r,o,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,M.padding,g.zOffset)}}updateCollisionDebugBuffers(r,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Of(this.iconSizeData,r),m=Of(this.textSizeData,r);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(m,r,o,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(m,r,o,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(u,r,o,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._updateIconDebugCollisionBoxes(u,r,o,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,o,u,m,h,g,b,M,P){const v={};if(o<u){const{x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B,featureIndex:H}=r.get(o);v.textBox={x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B},v.textFeatureIndex=H}if(m<h){const{x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B,featureIndex:H}=r.get(m);v.verticalTextBox={x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B},v.verticalTextFeatureIndex=H}if(g<b){const{x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B,featureIndex:H}=r.get(g);v.iconBox={x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B},v.iconFeatureIndex=H}if(M<P){const{x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B,featureIndex:H}=r.get(M);v.verticalIconBox={x1:T,y1:I,x2:E,y2:C,padding:D,projectedAnchorX:O,projectedAnchorY:F,projectedAnchorZ:V,tileAnchorX:W,tileAnchorY:B},v.verticalIconFeatureIndex=H}return v}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,o){const u=r.placedSymbolArray.get(o),m=u.vertexStartIndex+4*u.numGlyphs;for(let h=u.vertexStartIndex;h<m;h+=4)r.indexArray.emplaceBack(h,h+1,h+2),r.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),u=Math.cos(r),m=[],h=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const M=this.symbolInstances.get(b);m.push(0|Math.round(o*M.tileAnchorX+u*M.tileAnchorY)),h.push(M.featureIndex)}return g.sort((b,M)=>m[b]-m[M]||h[M]-h[b]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:P}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),h>=0&&h!==m&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&g!==m&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let uA,hA,Qw;Zt(cv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cv.addDynamicAttributes=lv;class dA{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Aa,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(dA,"FormatSectionOverride",{omit:["defaultValue"]});const eS=()=>Qw||(Qw={layout:uA||(uA=new Ln({"symbol-placement":new Pt(He.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new nr(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(He.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pt(He.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Pt(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pt(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new nr(He.layout_symbol["icon-size"]),"icon-text-fit":new nr(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nr(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new nr(He.layout_symbol["icon-image"]),"icon-rotate":new nr(He.layout_symbol["icon-rotate"]),"icon-padding":new Pt(He.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(He.layout_symbol["icon-keep-upright"]),"icon-offset":new nr(He.layout_symbol["icon-offset"]),"icon-anchor":new nr(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(He.layout_symbol["text-rotation-alignment"]),"text-field":new nr(He.layout_symbol["text-field"]),"text-font":new nr(He.layout_symbol["text-font"]),"text-size":new nr(He.layout_symbol["text-size"]),"text-max-width":new nr(He.layout_symbol["text-max-width"]),"text-line-height":new nr(He.layout_symbol["text-line-height"]),"text-letter-spacing":new nr(He.layout_symbol["text-letter-spacing"]),"text-justify":new nr(He.layout_symbol["text-justify"]),"text-radial-offset":new nr(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(He.layout_symbol["text-variable-anchor"]),"text-anchor":new nr(He.layout_symbol["text-anchor"]),"text-max-angle":new Pt(He.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(He.layout_symbol["text-writing-mode"]),"text-rotate":new nr(He.layout_symbol["text-rotate"]),"text-padding":new Pt(He.layout_symbol["text-padding"]),"text-keep-upright":new Pt(He.layout_symbol["text-keep-upright"]),"text-transform":new nr(He.layout_symbol["text-transform"]),"text-offset":new nr(He.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pt(He.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(He.layout_symbol["text-optional"]),visibility:new Pt(He.layout_symbol.visibility)})),paint:hA||(hA=new Ln({"icon-opacity":new nr(He.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new nr(He.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new nr(He.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new nr(He.paint_symbol["text-emissive-strength"]),"icon-color":new nr(He.paint_symbol["icon-color"]),"icon-halo-color":new nr(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new nr(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new nr(He.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(He.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new nr(He.paint_symbol["icon-image-cross-fade"]),"text-opacity":new nr(He.paint_symbol["text-opacity"]),"text-occlusion-opacity":new nr(He.paint_symbol["text-occlusion-opacity"]),"text-color":new nr(He.paint_symbol["text-color"],{runtimeType:Ro,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new nr(He.paint_symbol["text-halo-color"]),"text-halo-width":new nr(He.paint_symbol["text-halo-width"]),"text-halo-blur":new nr(He.paint_symbol["text-halo-blur"]),"text-translate":new Pt(He.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(He.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pt(He.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pt(He.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pt(He.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pt(He.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new nr(He.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new Pt(He.paint_symbol["symbol-elevation-reference"])}))},Qw);class uv extends uo{constructor(r,o,u,m){super(r,eS(),o,u,m),this._colorAdjustmentMatrix=be.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}recalculate(r,o){super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const h of u)m.indexOf(h)<0&&m.push(h);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,o,u,m){return this._saturation===r&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(h,g,b,M){h=Se(h),g=ae(g);const P=be.mat4.create(),v=h/3,T=1-2*v,I=[T,v,v,0,v,T,v,0,v,v,T,0,0,0,0,1],E=.5-.5*g,C=M-b;return be.mat4.multiply(P,[C,0,0,0,0,C,0,0,0,0,C,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,E,E,E,1]),be.mat4.multiply(P,P,I),P}(r,o,u,m),this._saturation=r,this._contrast=o,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,o,u,m){const h=this.layout.get(r).evaluate(o,{},u,m),g=this._unevaluatedLayout._values[r];return g.isDataDriven()||lf(g.value)||!h?h:function(b,M){return M.replace(/{([^{}]+)}/g,(P,v)=>v in b?String(b[v]):"")}(o.properties,h)}createBucket(r){return new cv(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of eS().paint.overridableProperties){if(!uv.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),u=new dA(o),m=new sf(u,o.property.specification,this.scope,this.options);let h=null;h=o.value.kind==="constant"||o.value.kind==="source"?new Bm("source",m):new rs("composite",m,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new Xc(o.property,h,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&uv.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const u=r.get("text-field"),m=eS().paint.properties[o];let h=!1;const g=b=>{for(const M of b)if(m.overrides&&m.overrides.hasOverride(M))return void(h=!0)};if(u.value.kind==="constant"&&u.value.value instanceof co)g(u.value.value.sections);else if(u.value.kind==="source"){const b=P=>{h||(P instanceof Da&&di(P.value)===Ac?g(P.value.sections):P instanceof Oc?g(P.sections):P.eachChild(b))},M=u.value;M._styleExpression&&b(M._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,o,u){return{config:new Xl(this,{zoom:o,lut:u}),overrideFog:!1}}}let fA,pA,mA,gA;var tS=en([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function rS(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function nS(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class iS{constructor(r,o,u,m){this.context=r,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=r.gl.createTexture(),this.update(o,{premultiply:m&&m.premultiply})}update(r,o){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,m=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:h}=this,{gl:g}=h,{x:b,y:M}=o&&o.position?o.position:{x:0,y:0},P=Math.max(b+u,this.size?this.size[0]:0),v=Math.max(M+m,this.size?this.size[1]:0);!this.size||this.size[0]===P&&this.size[1]===v||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!o||o.premultiply!==!1));const T=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&P>0&&v>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(P,v)))+1:1;g.texStorage2D(g.TEXTURE_2D,I,this.format,P,v),this.size=[P,v]}if(this.size)if(T)g.texSubImage2D(g.TEXTURE_2D,0,b,M,rS(this.format),nS(this.format),r);else{const I=r.data;I&&g.texSubImage2D(g.TEXTURE_2D,0,b,M,u,m,rS(this.format),nS(this.format),I)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(r,o,u=!1){const{context:m}=this,{gl:h}=m;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(r,o,u,m){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),o!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,o),this.magFilter=o),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class hv{constructor(r,o){this.context=r,this.texture=o}bind(r,o){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,r),this.minFilter=r),o!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrapS=o)}}function dv(c,r,o,u,m,h,g,b){const M=[c,r,1,o,u,1,m,h,1],P=[g,b,1],v=be.mat3.adjoint([],M),[T,I,E]=be.vec3.transformMat3(P,P,v);return be.mat3.multiply(M,M,[T,0,0,0,I,0,0,0,E])}function _A(c,r,o,u,m,h,g,b){const M=function(P,v,T,I,E,C,D,O){const F=dv(0,0,1,0,1,1,0,1),V=dv(P,v,T,I,E,C,D,O),W=be.mat3.adjoint([],F);return be.mat3.multiply(V,V,W)}(c,r,o,u,m,h,g,b);return[M[2]/M[8]/zt,M[5]/M[8]/zt]}function fv(c){return[c[0],Math.min(Math.max(c[1],-Ee),Ee)]}class yA extends Ic{constructor(r,o,u,m){super(),this.id=r,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=o,this._dirty=!1}load(r,o){if(this._loaded=o||!1,this.fire(new el("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=Ja(this.map._requestManager.transformRequest(this.url,Ec.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ah(u)):m&&(this.image=m instanceof HTMLImageElement?jt.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new hv(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new el("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof hv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=r[0][1],u=r[0][1];for(const h of r)h[1]>u&&(u=h[1]),h[1]<o&&(o=h[1]);const m=(u+o)/2;if(m>Ee?this.onNorthPole=!0:m<-Ee&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=r.map($e.fromLngLat);this.tileID=function(g){let b=1/0,M=1/0,P=-1/0,v=-1/0;for(const D of g)b=Math.min(b,D.x),M=Math.min(M,D.y),P=Math.max(P,D.x),v=Math.max(v,D.y);const T=Math.max(P-b,v-M),I=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),E=Math.pow(2,I);let C=Math.floor((b+P)/2*E);return C>1&&(C-=1),new Oi(I,C,Math.floor((M+v)/2*E))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new el("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const F in this.tiles){const V=this.tiles[F];V.state!=="loaded"&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Mg(new Oi(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){const V=F[1].x-F[0].x,W=F[1].y-F[0].y,B=F[2].x-F[1].x,H=F[2].y-F[1].y,Z=F[3].x-F[2].x,re=F[3].y-F[2].y,de=F[0].x-F[3].x,me=F[0].y-F[3].y,ue=V*H-B*W,Te=B*re-Z*H,_e=Z*me-de*re,Ce=de*W-V*me;return ue>0&&Te>0&&_e>0&&Ce>0||ue<0&&Te<0&&_e<0&&Ce<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=Mg(this.tileID,this.map.transform.projection),[h,g,b,M]=this.coordinates.map(F=>{const V=m.projection.project(F[0],F[1]);return iA(m,V)._round()});this.perspectiveTransform=_A(h.x,h.y,g.x,g.y,b.x,b.y,M.x,M.y);const P=this._boundsArray=new ll;P.emplaceBack(h.x,h.y,0,0),P.emplaceBack(g.x,g.y,zt,0),P.emplaceBack(M.x,M.y,0,zt),P.emplaceBack(b.x,b.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(P,tS.members),this.boundsSegments=Zn.simpleSegment(0,0,4,2);const v=[],T=[fv((I=this.coordinates)[0]),fv(I[1]),fv(I[2]),fv(I[3])];var I;const[E,C,D,O]=function(F){let V=F[0][0],W=V,B=F[0][1],H=B;for(let Z=1;Z<F.length;Z++)F[Z][0]<V?V=F[Z][0]:F[Z][0]>W&&(W=F[Z][0]),F[Z][1]<B?B=F[Z][1]:F[Z][1]>H&&(H=F[Z][1]);return[V,B,W-V,H-B]}(T);{const F=new ll,[V,W,B,H]=function(Ne){let qe=Ne[0].x,Ve=qe,ot=Ne[0].y,mt=ot;for(let tt=1;tt<Ne.length;tt++)Ne[tt].x<qe?qe=Ne[tt].x:Ne[tt].x>Ve&&(Ve=Ne[tt].x),Ne[tt].y<ot?ot=Ne[tt].y:Ne[tt].y>mt&&(mt=Ne[tt].y);return[qe,ot,Ve-qe,mt-ot]}(u),Z=Ne=>[(Ne.x-V)/B,(Ne.y-W)/H],[re,de,me,ue]=u.map(Z),Te=function(Ne,qe,Ve,ot,mt,tt,Nt,Ot){const St=dv(0,0,1,0,1,1,0,1),vt=dv(Ne,qe,Ve,ot,mt,tt,Nt,Ot),or=be.mat3.adjoint([],vt);return be.mat3.multiply(St,St,or)}(re[0],re[1],de[0],de[1],me[0],me[1],ue[0],ue[1]);this.elevatedGlobePerspectiveTransform=_A(re[0],re[1],de[0],de[1],me[0],me[1],ue[0],ue[1]);const _e=(Ne,qe)=>{v.push(Ne.lng);const Ve=Math.round((Ne.lng-E)/D*zt),ot=Math.round((Ne.lat-C)/O*zt),mt=Z(qe),tt=be.vec3.transformMat3([],[mt[0],mt[1],1],Te),Nt=Math.round(tt[0]/tt[2]*zt),Ot=Math.round(tt[1]/tt[2]*zt);F.emplaceBack(Ve,ot,Nt,Ot)},Ce=u[3].x-u[0].x,Oe=u[3].y-u[0].y,Fe=u[2].x-u[1].x,Be=u[2].y-u[1].y;for(let Ne=0;Ne<65;Ne++){const qe=Ne/64,Ve=[u[0].x+qe*Ce,u[0].y+qe*Oe],ot=[u[1].x+qe*Fe,u[1].y+qe*Be],mt=ot[0]-Ve[0],tt=ot[1]-Ve[1];for(let Nt=0;Nt<65;Nt++){const Ot=Nt/64,St={x:Ve[0]+mt*Ot,y:Ve[1]+tt*Ot,z:0};_e(o.projection.unproject(St.x,St.y),St)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(F,tS.members)}{this.maxLongitudeTriangleSize=0;let F=[],V=new qi;const W=(B,H,Z)=>{V.emplaceBack(B,H,Z);const re=v[B],de=v[H],me=v[Z],ue=Math.min(Math.min(re,de),me),Te=Math.max(Math.max(re,de),me)-ue;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),F.push(ue+Te/2)};for(let B=0;B<64;B++)for(let H=0;H<64;H++){const Z=65*B+H,re=Z+1,de=Z+65,me=de+1;W(Z,de,re),W(re,de,me)}[F,V]=function(B,H){const Z=Array.from({length:B.length},(me,ue)=>ue);Z.sort((me,ue)=>B[me]-B[ue]);const re=[],de=new qi;for(let me=0;me<Z.length;me++){const ue=Z[me];re.push(B[ue]);const Te=3*ue,_e=Te+1;de.emplaceBack(H.uint16[Te],H.uint16[_e],H.uint16[_e+1])}return[re,de]}(F,V),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(V)}this.elevatedGlobeSegments=Zn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,D/zt,0,O/zt,0,0,C,E,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof hv||(this.texture?this.texture.update(this.image):(this.texture=new iS(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(o)}loadTile(r,o){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},o(null)):(r.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let m=(h=r+180)+360*Math.round((u[0]-h)/360);var h;const g=new Zn,b=(T,I)=>{g.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:o.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},M=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=M){const T=ee(u,0,u.length,m+M);return T===u.length||b(T,Ke(u,T+1,u.length,m+360-M)-T),g}m<u[0]&&(m+=360);const P=Ke(u,0,u.length,m-M);if(P===u.length)return b(0,u.length),g;b(0,P-0);const v=ee(u,P+1,u.length,m+M);return v!==u.length&&b(v,u.length-v),g}}const g2=(Math.pow(256,2)-1)/16907520;class vA extends uo{constructor(r,o,u,m){super(r,{layout:mA||(mA=new Ln({visibility:new Pt(He.layout_raster.visibility)})),paint:gA||(gA=new Ln({"raster-opacity":new Pt(He.paint_raster["raster-opacity"]),"raster-color":new ka(He.paint_raster["raster-color"]),"raster-color-mix":new Pt(He.paint_raster["raster-color-mix"]),"raster-color-range":new Pt(He.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pt(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(He.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(He.paint_raster["raster-saturation"]),"raster-contrast":new Pt(He.paint_raster["raster-contrast"]),"raster-resampling":new Pt(He.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(He.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pt(He.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pt(He.paint_raster["raster-array-band"]),"raster-elevation":new Pt(He.paint_raster["raster-elevation"])}))},o,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof yA&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=hg({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let xA,bA,wA,SA,TA;class EA extends uo{constructor(r,o,u,m){super(r,{layout:xA||(xA=new Ln({visibility:new Pt(He["layout_raster-particle"].visibility)})),paint:bA||(bA=new Ln({"raster-particle-array-band":new Pt(He["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pt(He["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ka(He["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pt(He["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pt(He["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pt(He["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pt(He["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pt(He["paint_raster-particle"]["raster-particle-elevation"])}))},o,u,m),this._updateColorRamp(),this.lastInvalidatedAt=jt.now()}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=hg({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=jt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class _2 extends uo{constructor(r,o){super(r,{},o,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function oS(c,r,o){const u=[0,0,1],m=be.quat.identity([]);return be.quat.rotateY(m,m,o?-sr(c)+Math.PI:sr(c)),be.quat.rotateX(m,m,-sr(r)),be.vec3.transformQuat(u,u,m),be.vec3.normalize(u,u)}function MA(c,r){const o=pv(c.projection,c.zoom,c.width,c.height),u=function(h,g,b,M,P){const v=new $(b.lng-180*pu,b.lat),T=new $(b.lng+180*pu,b.lat),I=h.project(v.lng,v.lat),E=h.project(T.lng,T.lat),C=-Math.atan2(E.y-I.y,E.x-I.x),D=$e.fromLngLat(b);D.y=hr(D.y,-1+pu,1-pu);const O=D.toLngLat(),F=h.project(O.lng,O.lat),V=$e.fromLngLat(O);V.x+=pu;const W=V.toLngLat(),B=h.project(W.lng,W.lat),H=IA(B.x-F.x,B.y-F.y,C),Z=$e.fromLngLat(O);Z.y+=pu;const re=Z.toLngLat(),de=h.project(re.lng,re.lat),me=IA(de.x-F.x,de.y-F.y,C),ue=Math.abs(H.x)/Math.abs(me.y),Te=be.mat4.identity([]);be.mat4.rotateZ(Te,Te,-C*(1-(P?0:M)));const _e=be.mat4.identity([]);return be.mat4.scale(_e,_e,[1,1-(1-ue)*M,1]),_e[4]=-me.x/me.y*M,be.mat4.rotateZ(_e,_e,C),be.mat4.multiply(_e,Te,_e),_e}(c.projection,0,c.center,o,r),m=CA(c);return be.mat4.scale(u,u,[m,m,1]),u}function CA(c){const r=c.projection,o=pv(c.projection,c.zoom,c.width,c.height),u=aS(r,c.center),m=aS(r,$.convert(r.center));return Math.pow(2,u*o+(1-o)*m)}function pv(c,r,o,u,m=1/0){const h=c.range;if(!h)return 0;const g=Math.min(m,Math.max(o,u)),b=Math.log(g/1024)/Math.LN2;return Po(h[0]+b,h[1]+b,r)}const pu=1/4e4;function aS(c,r){const o=hr(r.lat,-Ee,Ee),u=new $(r.lng-180*pu,o),m=new $(r.lng+180*pu,o),h=c.project(u.lng,o),g=c.project(m.lng,o),b=$e.fromLngLat(u),M=$e.fromLngLat(m),P=g.x-h.x,v=g.y-h.y,T=M.x-b.x,I=M.y-b.y,E=Math.sqrt((T*T+I*I)/(P*P+v*v));return Math.log(E)/Math.LN2}function IA(c,r,o){const u=Math.cos(o),m=Math.sin(o);return{x:c*u-r*m,y:c*m+r*u}}function PA(c,r,o){be.mat4.identity(c),be.mat4.rotateZ(c,c,sr(r[2])),be.mat4.rotateX(c,c,sr(r[0])),be.mat4.rotateY(c,c,sr(r[1])),be.mat4.scale(c,c,o),be.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function mv(c,r,o,u,m,h,g,b){const M=[o[0]-r[0],o[1]-r[1],0],P=[u[0]-r[0],u[1]-r[1],0];if(be.vec3.length(M)<1e-12||be.vec3.length(P)<1e-12)return be.quat.identity(c);const v=be.vec3.cross([],M,P);be.vec3.normalize(v,v),be.vec3.subtract(P,u,r),M[2]=(h-m)*b,P[2]=(g-m)*b;const T=M;return be.vec3.cross(T,M,P),be.vec3.normalize(T,T),be.quat.rotationTo(c,v,T)}function sS(c,r,o=!1){const u=lu(r.zoom),m=function(h,g,b){const M=g.worldSize,P=[h[12],h[13],h[14]],v=ve(P[1]/M),T=xe(P[0]/M),I=be.mat4.identity([]),E=he(1,v)*M,C=he(1,0)*M*ze(v,g.zoom),D=1/bw(M);let O=C*D;if(b){const B=pv(g.projection,g.zoom,g.width,g.height,1024);O=D*g.projection.pixelSpaceConversion(g.center.lat,M,B)}const F=z(v,T);be.vec3.add(F,F,be.vec3.scale([],be.vec3.normalize([],F),E*O*P[2]));const V=function(B){const H=[B[0],B[1],B[2]];let Z=[0,1,0];const re=be.vec3.cross([],Z,H);return be.vec3.cross(Z,H,re),be.vec3.squaredLength(Z)===0&&(Z=[0,1,0],be.vec3.cross(re,H,Z)),be.vec3.normalize(re,re),be.vec3.normalize(Z,Z),be.vec3.normalize(H,H),[re[0],re[1],re[2],0,Z[0],Z[1],Z[2],0,H[0],H[1],H[2],0,B[0],B[1],B[2],1]}(F);be.mat4.scale(I,I,[O,O,O*E]),be.mat4.translate(I,I,[-P[0],-P[1],-P[2]]);const W=be.mat4.multiply([],g.globeMatrix,V);return be.mat4.multiply(W,W,I),be.mat4.multiply(W,W,h),W}(c,r,o);if(u>0){const h=function(g,b){const M=b.worldSize,P=he(1,0)*M*ze(b.center.lat,b.zoom)/bw(M),v=he(1,b.center.lat)*M,T=be.mat4.identity([]);return be.mat4.rotateY(T,T,sr(b.center.lng)),be.mat4.rotateX(T,T,sr(b.center.lat)),be.mat4.translate(T,T,[0,0,n]),be.mat4.scale(T,T,[P,P,P*v]),be.mat4.translate(T,T,[b.point.x-.5*M,b.point.y-.5*M,0]),be.mat4.multiply(T,T,g),be.mat4.multiply(T,b.globeMatrix,T)}(c,r);return function(g,b,M){const P=(C,D,O)=>{const F=be.vec3.length(C),V=be.vec3.length(D),W=Jl(C,D,O);return be.vec3.scale(W,W,1/be.vec3.length(W)*ur(F,V,O))},v=P([g[0],g[1],g[2]],[b[0],b[1],b[2]],M),T=P([g[4],g[5],g[6]],[b[4],b[5],b[6]],M),I=P([g[8],g[9],g[10]],[b[8],b[9],b[10]],M),E=Jl([g[12],g[13],g[14]],[b[12],b[13],b[14]],M);return[v[0],v[1],v[2],0,T[0],T[1],T[2],0,I[0],I[1],I[2],0,E[0],E[1],E[2],1]}(m,h,u)}return m}function AA(c,r,o,u){const m=Tn.projectAabbCorners(u,o);let h=Number.MAX_VALUE,g=-1;for(let P=0;P<m.length;++P){const v=m[P];v[0]=(.5*v[0]+.5)*r.width,v[1]=(.5-.5*v[1])*r.height,v[2]<h&&(g=P,h=v[2])}const b=P=>new lt(m[P][0],m[P][1]);let M;switch(g){case 0:case 6:M=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:M=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:M=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:M=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(kt(c,M))return h}const y2=en([{name:"a_pos_3f",components:3,type:"Float32"}]),v2=en([{name:"a_color_3f",components:3,type:"Float32"}]),x2=en([{name:"a_color_4f",components:4,type:"Float32"}]),b2=en([{name:"a_uv_2f",components:2,type:"Float32"}]),w2=en([{name:"a_normal_3f",components:3,type:"Float32"}]),S2=en([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),T2=en([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),DA={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class gv{constructor(r,o,u,m){this.message=(r?`${r}: `:"")+u,m&&(this.identifier=m),o!=null&&o.__line__&&(this.line=o.__line__)}}function RA(c,r){const o=c.indexOf("://")===-1;try{return new URL(c,o&&r?"http://example.com":void 0),!0}catch{return!1}}class kA{constructor(r,o){this.feature=r,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class OA{constructor(){this.instancedDataArray=new Dh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class lS{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=r.projection,this.index=r.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(r,o){}populate(r,o,u,m){this.tileToMeter=De(u);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:b,index:M,sourceLayerIndex:P}of r){const v=b??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),T=Et(g,h);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),T,u))continue;const I={id:v,sourceLayerIndex:P,index:M,geometry:h?T.geometry:wt(g,u,m),properties:g.properties,type:g.type,patterns:{}},E=this.addFeature(I,I.geometry,T);E&&o.featureIndex.insert(g,I.geometry,M,P,this.index,this.instancesPerModel[E].instancedDataArray.length,zt/32)}this.lookup=null}update(r,o,u,m){for(const h in this.instancesPerModel){const g=this.instancesPerModel[h];for(const b in r)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],r[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const m of u.features){const h=this.layers[0],g=m.feature,b=this.canonical,M=h.paint.get("model-rotation").evaluate(g,{},b),P=h.paint.get("model-scale").evaluate(g,{},b),v=h.paint.get("model-translation").evaluate(g,{},b);be.vec3.exactEquals(m.rotation,M)&&be.vec3.exactEquals(m.scale,P)&&be.vec3.exactEquals(m.translation,v)||(this.evaluate(m,m.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,o,u,m){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(Ow(this.activeReplacements,h))return!1;this.activeReplacements=h;let g=!1;for(const b in this.instancesPerModel){const M=this.instancesPerModel[b],P=M.instancedDataArray;for(const v of M.features){const T=v.instancedDataOffset,I=v.instancedDataCount;for(let E=0;E<I;E++){const C=16*(E+T);let D=P.float32[C+0];const O=D>zt;D=O?D-zt:D;const F=Math.floor(D),V=P.float32[C+1];let W=!1;for(const B of this.activeReplacements)if(!YI(B,u,DA.Model,m)&&!(B.min.x>F||F>B.max.x||B.min.y>V||V>B.max.y)&&(W=tP(eP(F,V,r.canonical,B.footprintTileId.canonical),B.footprint),W))break;P.float32[C]=W?D+zt:D,g=g||W!==O}}}return g}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,S2.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris)for(const o of this.modelUris)r.removeModel(o,"")}addFeature(r,o,u){const m=this.layers[0],h=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!h)return Gr(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),h;RA(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new OA);const g=this.instancesPerModel[h],b=g.instancedDataArray,M=new kA(u,b.length);for(const P of o)for(const v of P){if(v.x<0||v.x>=zt||v.y<0||v.y>=zt)continue;const T=(this.lookupDim-1)/zt,I=this.lookupDim*(v.y*T|0)+v.x*T|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const E=b.length;b.resize(E+1),g.instancesEvaluatedElevation.push(0),b.float32[16*E]=v.x,b.float32[16*E+1]=v.y}return M.instancedDataCount=g.instancedDataArray.length-M.instancedDataOffset,M.instancedDataCount>0&&(r.id&&(g.idToFeaturesIndex[r.id]=g.features.length),g.features.push(M),this.evaluate(M,{},g,!1)),h}getModelUris(){return this.modelUris}evaluate(r,o,u,m){const h=this.layers[0],g=r.feature,b=this.canonical,M=r.rotation=h.paint.get("model-rotation").evaluate(g,o,b),P=r.scale=h.paint.get("model-scale").evaluate(g,o,b),v=r.translation=h.paint.get("model-translation").evaluate(g,o,b),T=h.paint.get("model-color").evaluate(g,o,b);T.a=h.paint.get("model-color-mix-intensity").evaluate(g,o,b);const I=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),PA(I,M,P);const E=Math.round(100*T.a)+T.b/1.05;for(let C=0;C<r.instancedDataCount;++C){const D=r.instancedDataOffset+C,O=16*D,F=u.instancedDataArray.float32;let V=0;m&&(V=F[O+6]-u.instancesEvaluatedElevation[D]);const W=0|F[O+1];F[O]=(0|F[O])+T.r/1.05,F[O+1]=W+T.g/1.05,F[O+2]=E,F[O+3]=1/(b.z>10?this.tileToMeter:De(b,W)),F[O+4]=v[0],F[O+5]=v[1],F[O+6]=v[2]+V,F[O+7]=I[0],F[O+8]=I[1],F[O+9]=I[2],F[O+10]=I[4],F[O+11]=I[5],F[O+12]=I[6],F[O+13]=I[8],F[O+14]=I[9],F[O+15]=I[10],u.instancesEvaluatedElevation[D]=v[2]}}}let LA,zA;Zt(lS,"ModelBucket",{omit:["layers"]}),Zt(OA,"PerModelAttributes"),Zt(kA,"ModelFeature");const Bh=64,Nf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function FA(c,r,o,u,m,h,g,b,M,P=!1){const v=o.zoom,T=o.project(u),I=ze(u.lat,v),E=1/I;be.mat4.identity(c),be.mat4.translate(c,c,[T.x+g[0]*E,T.y+g[1]*E,g[2]]);let C=1,D=1;const O=o.worldSize;if(P){if(o.projection.name==="mercator"){let B=0;o.elevation&&(B=o.elevation.getAtPointOrZero(new $e(T.x/O,T.y/O),0));const H=be.vec4.transformMat4([],[T.x,T.y,B,1],o.projMatrix)[3]/o.cameraToCenterDistance;C=H,D=H*ze(o.center.lat,v)}else if(o.projection.name==="globe"){const B=sS(c,o),H=be.mat4.multiply([],o.projMatrix,B),Z=[0,0,0,1];be.vec4.transformMat4(Z,Z,H);const re=Z[3]/o.cameraToCenterDistance,de=lu(v),me=o.projection.pixelsPerMeter(u.lat,O)*ze(u.lat,v),ue=o.projection.pixelsPerMeter(o.center.lat,O)*ze(o.center.lat,v);C=re/ur(me,Pe(o.center.lat),de),D=re*I/me,C*=ue,D*=ue}}else C=E;be.mat4.scale(c,c,[C,C,D]);const F=[...c],V=r.orientation,W=[];if(PA(W,[V[0]+m[0],V[1]+m[1],V[2]+m[2]],h),be.mat4.multiply(c,F,W),b&&o.elevation){let B=0;const H=[];if(M&&o.elevation){B=function(de,me,ue,Te,_e){const Ce=me.elevation;if(!Ce)return 0;const Oe=Tn.projectAabbCorners(ue,Te),Fe=he(1,_e.lat)*me.worldSize,Be=function(or,Ft){const Gt=[0,0,1],gr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Dr of gr){const Mr=or[Dr.corners[0]],Cr=or[Dr.corners[1]],zr=or[Dr.corners[2]],Fr=[Cr[0]-Mr[0],Cr[1]-Mr[1],Ft*(Cr[2]-Mr[2])],bn=be.vec3.cross(Fr,Fr,[zr[0]-Mr[0],zr[1]-Mr[1],Ft*(zr[2]-Mr[2])]);be.vec3.normalize(bn,bn),Dr.dotProductWithUp=be.vec3.dot(bn,Gt)}return gr.sort((Dr,Mr)=>Dr.dotProductWithUp-Mr.dotProductWithUp),gr[0].corners}(Oe,Fe),Ne=Oe[Be[0]],qe=Oe[Be[1]],Ve=Oe[Be[2]],ot=Oe[Be[3]],mt=Ce.getAtPointOrZero(new $e(Ne[0]/me.worldSize,Ne[1]/me.worldSize),0),tt=Ce.getAtPointOrZero(new $e(qe[0]/me.worldSize,qe[1]/me.worldSize),0),Nt=Ce.getAtPointOrZero(new $e(Ve[0]/me.worldSize,Ve[1]/me.worldSize),0),Ot=Ce.getAtPointOrZero(new $e(ot[0]/me.worldSize,ot[1]/me.worldSize),0),St=(mt+Ot)/2,vt=(tt+Nt)/2;return St>vt?tt<Nt?mv(de,qe,ot,Ne,tt,Ot,mt,Fe):mv(de,Ve,Ne,ot,Nt,mt,Ot,Fe):mt<Ot?mv(de,Ne,qe,Ve,mt,tt,Nt,Fe):mv(de,ot,Ve,qe,Ot,Nt,tt,Fe),Math.max(St,vt)}(H,o,r.aabb,c,u);const Z=be.mat4.fromQuat([],H),re=be.mat4.multiply([],Z,W);be.mat4.multiply(c,F,re)}else B=o.elevation.getAtPointOrZero(new $e(T.x/O,T.y/O),0);B!==0&&(c[14]+=B)}}function Dg(c,r,o=!1){c.uploaded||(c.gfxTexture=new iS(r,c.image,o?r.gl.R8:r.gl.RGBA8,{useMipmap:c.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function E2(c,r,o){c.indexBuffer=r.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=r.createVertexBuffer(c.vertexArray,y2.members,!1,!0),c.normalArray&&(c.normalBuffer=r.createVertexBuffer(c.normalArray,w2.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=r.createVertexBuffer(c.texcoordArray,b2.members,!1,!0)),c.colorArray&&(c.colorBuffer=r.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?v2:x2).members,!1,!0)),c.featureArray&&(c.pbrBuffer=r.createVertexBuffer(c.featureArray,T2.members,!0)),c.segments=Zn.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&Dg(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Dg(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Dg(u.normalTexture,r),u.occlusionTexture&&Dg(u.occlusionTexture,r,o),u.emissionTexture&&Dg(u.emissionTexture,r)}function cS(c,r,o){if(c.meshes)for(const u of c.meshes)E2(u,r,o);if(c.children)for(const u of c.children)cS(u,r,o)}function _v(c){if(c.meshes)for(const r of c.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(c.children)for(const r of c.children)_v(r)}function uS(c){if(c.meshes)for(const o of c.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((r=o.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(c.children)for(const o of c.children)uS(o)}class Uf{constructor(r,o,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(r,o,u){const m=u||r.findDEMTileFor(o);if(!m||!m.dem)return;const h=m.dem,g=m.tileID,b=1<<o.canonical.z-g.canonical.z;return new Uf(m,h.dim/zt/b,[(o.canonical.x/b-g.canonical.x)*h.dim,(o.canonical.y/b-g.canonical.y)*h.dim])}tileCoordToPixel(r,o){const u=o*this._scale+this._offset[1],m=Math.floor(r*this._scale+this._offset[0]),h=Math.floor(u);return new lt(m,h)}getElevationAt(r,o,u,m){const h=r*this._scale+this._offset[0],g=o*this._scale+this._offset[1],b=Math.floor(h),M=Math.floor(g),P=this._dem;return m=!!m,u?ur(ur(P.get(b,M,m),P.get(b,M+1,m),g-M),ur(P.get(b+1,M,m),P.get(b+1,M+1,m),g-M),h-b):P.get(b,M,m)}getElevationAtPixel(r,o,u){return this._dem.get(r,o,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*he(1,r)*this._dem.stride}}const hS=new Float32Array(262144),Nh=new Uint8Array(262144);function BA(c){let r=0;if(c.meshes)for(const o of c.meshes)r=Math.max(r,o.aabb.max[2]);if(c.children)for(const o of c.children)r=Math.max(r,BA(o));return r}function NA(c,r,o){if(c.meshes)for(const u of c.meshes)u.aabb.min[0]!==1/0&&o.insert(r,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(c.children)for(const u of c.children)NA(u,r,o)}const UA=["","wall","door","roof","window","lamp","logo"];class jA{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:BA(r)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const o=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=Tn.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),r++;this.aabb=o}return this.aabb}}class yv{constructor(r,o,u,m,h,g){this.id=o,this.modelTraits|=Nf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Nf.HasMapboxMeshFeatures),m&&(this.modelTraits|=Nf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const b of r)this.nodesInfo.push(new jA(b)),NA(b,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0)}updateFootprints(r,o){for(const u of this.getNodesInfo()){const m=u.node;m.footprint&&o.push({footprint:m.footprint,id:r})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const m=u.node;this.uploaded?this.updatePbrBuffer(m):cS(m,r,!0)}for(const u of o)_v(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let o=!1;if(!r.meshes)return o;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(r,o,u){const m=r.transform.projectionOptions,h=r.style.getBrightness(),g=this.brightness!==h;return!!(!this.uploaded||this.dirty||m.name!==this.projection.name||Rg(u.paint.get("model-color").value,g)||Rg(u.paint.get("model-color-mix-intensity").value,g)||Rg(u.paint.get("model-roughness").value,g)||Rg(u.paint.get("model-emissive-strength").value,g)||Rg(u.paint.get("model-height-based-emissive-strength-multiplier").value,g))&&(this.projection=m,this.brightness=h,!0)}evaluateScale(r,o){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),m=this.id.canonical;for(const h of u){const g=h.feature;h.evaluatedScale=o.paint.get("model-scale").evaluate(g,{},m)}}evaluate(r){const o=this.getNodesInfo();for(const u of o){if(!u.node.meshes)continue;const m=u.feature,h=u.node.meshes&&u.node.meshes[0].featureData,g=u.evaluatedColor[2],b=u.evaluatedRMEA[2],M=this.id.canonical;if(u.hasTranslucentParts=!1,h){for(let P=0;P<UA.length;P++){const v=UA[P];v.length&&(m.properties.part=v);const T=r.paint.get("model-color").evaluate(m,{},M).toRenderColor(null),I=r.paint.get("model-color-mix-intensity").evaluate(m,{},M);u.evaluatedColor[P]=[T.r,T.g,T.b,I],u.evaluatedRMEA[P][0]=r.paint.get("model-roughness").evaluate(m,{},M),u.evaluatedRMEA[P][2]=r.paint.get("model-emissive-strength").evaluate(m,{},M),u.evaluatedRMEA[P][3]=T.a,u.emissionHeightBasedParams[P]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,{},M),!u.hasTranslucentParts&&T.a<1&&(u.hasTranslucentParts=!0)}delete m.properties.part,C2(u,g!==u.evaluatedColor[2]||b!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(m,{},M);u.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},M),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,o,u,m){const h=r.findDEMTileFor(u);if(h&&(h.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const g=Uf.create(r,u,h);if(!g)return;this.modelTraits&Nf.HasMapboxMeshFeatures&&this.updateDEM(r,g,u,m);for(const b of this.getNodesInfo()){const M=b.node;if(!M.footprint||!M.footprint.vertices||!M.footprint.vertices.length)continue;const P=M.footprint.vertices;let v=g.getElevationAt(P[0].x,P[0].y,!0,!0);for(let T=1;T<P.length;T++)v=Math.min(v,g.getElevationAt(P[T].x,P[T].y,!0,!0));M.elevation=v}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=o}}updateDEM(r,o,u,m){let h=o._dem._modifiedForSources[m];if(h===void 0&&(o._dem._modifiedForSources[m]=[],h=o._dem._modifiedForSources[m]),h.includes(u.canonical))return;const g=o._dem.dim;h.push(u.canonical);let b=!1;for(const M of this.getNodesInfo()){const P=M.node;if(!P.footprint||!P.footprint.grid)continue;const v=P.footprint.grid,T=o.tileCoordToPixel(v.min.x,v.min.y),I=o.tileCoordToPixel(v.max.x,v.max.y),E=Math.min(Math.min(g-I.y,T.x),Math.min(T.y,g-I.x));if(E<0)continue;const C=hr(E,2,5);let D=Math.max(0,T.x-C),O=Math.max(0,T.y-C),F=Math.min(I.x+C,g-1),V=Math.min(I.y+C,g-1);for(let Z=O;Z<=V;++Z)for(let re=D;re<=F;++re)Nh[Z*g+re]=255;let W=0,B=0;for(let Z=0;Z<v.cellsY;++Z)for(let re=0;re<v.cellsX;++re){if(!v.cells[Z*v.cellsX+re])continue;const de=o.tileCoordToPixel(v.min.x+re/v.xScale,v.min.y+Z/v.yScale),me=o.tileCoordToPixel(v.min.x+(re+1)/v.xScale,v.min.y+(Z+1)/v.yScale);for(let ue=de.y;ue<=Math.min(me.y+1,g-1);++ue)for(let Te=de.x;Te<=Math.min(me.x+1,g-1);++Te)Nh[ue*g+Te]===255&&(Nh[ue*g+Te]=0,W+=o.getElevationAtPixel(Te,ue),B++)}const H=W/B;D=Math.max(1,T.x-C),O=Math.max(1,T.y-C),F=Math.min(I.x+C,g-2),V=Math.min(I.y+C,g-2),b=!0;for(let Z=O;Z<=V;++Z)for(let re=D;re<=F;++re)Nh[Z*g+re]===0&&(hS[Z*g+re]=o._dem.set(re,Z,H));for(let Z=1;Z<C;++Z){D=Math.max(1,T.x-Z),O=Math.max(1,T.y-Z),F=Math.min(I.x+Z,g-2),V=Math.min(I.y+Z,g-2);for(let re=O;re<=V;++re)for(let de=D;de<=F;++de){const me=re*g+de;if(Nh[me]===255){let ue=0,Te=0,_e=-1,Ce=-1;for(let Oe=-1;Oe<=1;++Oe)for(let Fe=-1;Fe<=1;++Fe){const Be=(re+Oe)*g+de+Fe;if(Nh[Be]>=Z)continue;const Ne=hS[Be],qe=Math.abs(Ne);qe>Te&&(ue=Ne,Te=qe,_e=Fe,Ce=Oe)}if(Te>.1){const Oe=1-(Z+.5*Math.abs(_e*Ce))/C;let Fe=o._dem.get(de,re)+ue*Oe;const Be=o._dem.get(de+_e,re+Ce),Ne=o._dem.get(de-_e,re-Ce,!0);(Fe-Be)*(Fe-Ne)>0&&(Fe=(Be+Ne)/2),hS[me]=o._dem.set(de,re,Fe),Nh[me]=Z}}}}}b&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=jt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const o of r)_v(o.node),uS(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(r.toUnwrapped()),m=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const g=m[h].node;m[h].hiddenByReplacement=!!g.footprint&&!u.find(b=>b.footprint===g.footprint)}}getHeightAtTileCoord(r,o){const u=this.getNodesInfo(),m=[],h=[0,0,0],g=be.mat4.identity([]);for(let b=0;b<this.nodesInfo.length;b++){const M=u[b],P=M.node.meshes[0],v=P.transformedAabb;if(r<v.min[0]||o<v.min[1]||r>v.max[0]||o>v.max[1])continue;if(M.node.hidden===!0)return{height:1/0,maxHeight:M.feature.properties.height,hidden:!1,verticalScale:M.evaluatedScale[2]};be.mat4.invert(g,M.node.matrix),h[0]=r,h[1]=o,be.vec3.transformMat4(h,h,g);const T=(h[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*Bh|0,I=Math.min(63,(h[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*Bh|0)*Bh+Math.min(63,T),E=P.heightmap[I];if(!(E<0&&M.node.footprint))return M.hiddenByReplacement?void 0:{height:E,maxHeight:M.feature.properties.height,hidden:!1,verticalScale:M.evaluatedScale[2]};if(M.node.footprint.grid.query(new lt(r,o),new lt(r,o),m),m.length>0)return{height:void 0,maxHeight:M.feature.properties.height,hidden:M.hiddenByReplacement,verticalScale:M.evaluatedScale[2]}}}}function Rg(c,r){return!c.isLightConstant&&r}function M2(c,r,o,u,m,h,g,b){let M=(61440&r|(61440&r)>>4)>>8,P=(3840&r|(3840&r)>>4)>>4,v=240&r|(240&r)>>4;o[3]>0&&(M=ur(M,255*o[0],o[3]),P=ur(P,255*o[1],o[3]),v=ur(v,255*o[2],o[3]));const T=M<<8|P,I=v<<8|Math.floor(255*u[3]),E=function(Z){const re=hr(Z,0,2);return Math.min(Math.round(.5*re*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],C=hr(m[0],0,1),D=hr(m[1],0,1),O=hr(m[2],0,1),F=hr(m[3],0,1);let V,W,B,H;if(C!==D&&g!==h&&D!==C){const Z=g-h;W=1/(Z*(D-C)),B=-(h+Z*C)/(Z*(D-C));const re=hr(m[4],-1,1);H=Math.pow(10,re),V=255*O<<8|255*F}else V=65535,W=0,B=1,H=1;if(c.emplaceBack(T,I,E,V,W,B,H),b){const Z=b.length;b.clear();for(let re=0;re<Z;re++)b.emplaceBack(T,I,E,V,W,B,H)}}function C2(c,r,o){const u=c.node;let m=0;const h=o&Nf.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===m||!g.featureData)continue;g.featureArray=new Tf,g.featureArray.reserve(g.featureData.length);let b=r;for(const M of g.featureData){const P=h?65535&M:M>>16&65535,v=h?M>>16&65535:65535&M,T=(15&v)<8?15&v:0,I=c.evaluatedRMEA[T],E=c.evaluatedColor[T],C=c.emissionHeightBasedParams[T];let D;if(b&&T===2&&u.lights&&(D=new Tf,D.resize(10*u.lights.length)),M2(g.featureArray,P,E,I,C,g.aabb.min[2],g.aabb.max[2],D),D&&b){b=!1;const O=u.meshes[u.lightMeshIndex];O.featureArray=D,O.featureArray._trim()}}g.featureArray._trim(),m++}}function VA(c,r,o,u){const m=1<<c.z;r.lat=ve((u/zt+c.y)/m),r.lng=xe((o/zt+c.x)/m)}Zt(yv,"Tiled3dModelBucket",{omit:["layers"]}),Zt(jA,"Tiled3dModelFeature");const I2={circle:class extends uo{constructor(c,r,o,u){super(c,{layout:hn||(hn=new Ln({"circle-sort-key":new nr(He.layout_circle["circle-sort-key"]),visibility:new Pt(He.layout_circle.visibility)})),paint:Yn||(Yn=new Ln({"circle-radius":new nr(He.paint_circle["circle-radius"]),"circle-color":new nr(He.paint_circle["circle-color"]),"circle-blur":new nr(He.paint_circle["circle-blur"]),"circle-opacity":new nr(He.paint_circle["circle-opacity"]),"circle-translate":new Pt(He.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new nr(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new nr(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new nr(He.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pt(He.paint_circle["circle-emissive-strength"])}))},r,o,u)}createBucket(c){return new ir(c)}queryRadius(c){const r=c;return zn("circle-radius",this,r)+zn("circle-stroke-width",this,r)+_n(this.paint.get("circle-translate"))}queryIntersectsFeature(c,r,o,u,m,h,g,b){const M=tn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o);return xI(c,u,h,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",M,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,r,o){const u=vI(this);return{config:new Xl(this,{zoom:r,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends uo{createBucket(c){return new wI(c)}constructor(c,r,o,u){super(c,{layout:SI||(SI=new Ln({visibility:new Pt(He.layout_heatmap.visibility)})),paint:TI||(TI=new Ln({"heatmap-radius":new nr(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new nr(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ka(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(He.paint_heatmap["heatmap-opacity"])}))},r,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return zn("heatmap-radius",this,c)}queryIntersectsFeature(c,r,o,u,m,h,g,b){const M=this.paint.get("heatmap-radius").evaluate(r,o);return xI(c,u,h,g,b,!0,!0,new lt(0,0),M)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,r,o){return c==="heatmap"?{config:new Xl(this,{zoom:r,lut:o}),overrideFog:!1}:{}}},hillshade:class extends uo{constructor(c,r,o,u){super(c,{layout:EI||(EI=new Ln({visibility:new Pt(He.layout_hillshade.visibility)})),paint:MI||(MI=new Ln({"hillshade-illumination-direction":new Pt(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(He.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pt(He.paint_hillshade["hillshade-emissive-strength"])}))},r,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,r,o){return{overrideFog:!1}}},fill:class extends uo{constructor(c,r,o,u){super(c,{layout:OI||(OI=new Ln({"fill-sort-key":new nr(He.layout_fill["fill-sort-key"]),visibility:new Pt(He.layout_fill.visibility)})),paint:LI||(LI=new Ln({"fill-antialias":new Pt(He.paint_fill["fill-antialias"]),"fill-opacity":new nr(He.paint_fill["fill-opacity"]),"fill-color":new nr(He.paint_fill["fill-color"]),"fill-outline-color":new nr(He.paint_fill["fill-outline-color"]),"fill-translate":new Pt(He.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new nr(He.paint_fill["fill-pattern"]),"fill-emissive-strength":new Pt(He.paint_fill["fill-emissive-strength"]),"fill-z-offset":new nr(He.paint_fill["fill-z-offset"])}))},r,o,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),r=c&&c.constantOr(1),o=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(c,r,o){return{config:new Xl(this,{zoom:r,lut:o}),overrideFog:!1}}recalculate(c,r){super.recalculate(c,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Iw(c)}queryRadius(){return _n(this.paint.get("fill-translate"))}queryIntersectsFeature(c,r,o,u,m,h){return!c.queryGeometry.isAboveHorizon&&dr(Ar(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends uo{constructor(c,r,o,u){super(c,{layout:gP||(gP=new Ln({visibility:new Pt(He["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pt(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:_P||(_P=new Ln({"fill-extrusion-opacity":new Pt(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new nr(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nr(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new nr(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new nr(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new nr(He["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new nr(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pt(He["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pt(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pt(He["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new nr(He["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new nr(He["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Pt(He["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Y0(c)}queryRadius(){return _n(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,r,o,u,m,h,g,b,M){const P=tn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(r,o),T=this.paint.get("fill-extrusion-base").evaluate(r,o),I=[0,0],E=b&&h.elevation,C=h.elevation?h.elevation.exaggeration():1,D=c.tile.getBucket(this);if(E&&D instanceof Y0){const B=D.centroidVertexArray,H=M+1;H<B.length&&(I[0]=B.geta_centroid_pos0(H),I[1]=B.geta_centroid_pos1(H))}if(I[0]===0&&I[1]===1)return!1;h.projection.name==="globe"&&(u=mP([u],[new lt(0,0),new lt(zt,zt)],c.tileID.canonical).map(B=>B.polygon).flat());const O=E?b:null,[F,V]=function(B,H,Z,re,de,me,ue,Te,_e,Ce,Oe){return B.projection.name==="globe"?function(Fe,Be,Ne,qe,Ve,ot,mt,tt,Nt,Ot,St){const vt=[],or=[],Ft=Fe.projection.upVectorScale(St,Fe.center.lat,Fe.worldSize).metersToTile,Gt=[0,0,0,1],gr=[0,0,0,1],Dr=(Cr,zr,Fr,bn)=>{Cr[0]=zr,Cr[1]=Fr,Cr[2]=bn,Cr[3]=1},Mr=pP();Ne>0&&(Ne+=Mr),qe+=Mr;for(const Cr of Be){const zr=[],Fr=[];for(const bn of Cr){const dn=bn.x+Ve.x,yr=bn.y+Ve.y,on=Fe.projection.projectTilePoint(dn,yr,St),an=Fe.projection.upVector(St,bn.x,bn.y);let In=Ne,ti=qe;if(mt){const pi=vP(dn,yr,Ne,qe,mt,tt,Nt,Ot);In+=pi.base,ti+=pi.top}Ne!==0?Dr(Gt,on.x+an[0]*Ft*In,on.y+an[1]*Ft*In,on.z+an[2]*Ft*In):Dr(Gt,on.x,on.y,on.z),Dr(gr,on.x+an[0]*Ft*ti,on.y+an[1]*Ft*ti,on.z+an[2]*Ft*ti),be.vec3.transformMat4(Gt,Gt,ot),be.vec3.transformMat4(gr,gr,ot),zr.push(new Fh(Gt[0],Gt[1],Gt[2])),Fr.push(new Fh(gr[0],gr[1],gr[2]))}vt.push(zr),or.push(Fr)}return[vt,or]}(B,H,Z,re,de,me,ue,Te,_e,Ce,Oe):ue?function(Fe,Be,Ne,qe,Ve,ot,mt,tt,Nt){const Ot=[],St=[],vt=[0,0,0,1];for(const or of Fe){const Ft=[],Gt=[];for(const gr of or){const Dr=gr.x+qe.x,Mr=gr.y+qe.y,Cr=vP(Dr,Mr,Be,Ne,ot,mt,tt,Nt);vt[0]=Dr,vt[1]=Mr,vt[2]=Cr.base,vt[3]=1,be.vec4.transformMat4(vt,vt,Ve),vt[3]=Math.max(vt[3],1e-5);const zr=new Fh(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);vt[0]=Dr,vt[1]=Mr,vt[2]=Cr.top,vt[3]=1,be.vec4.transformMat4(vt,vt,Ve),vt[3]=Math.max(vt[3],1e-5);const Fr=new Fh(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);Ft.push(zr),Gt.push(Fr)}Ot.push(Ft),St.push(Gt)}return[Ot,St]}(H,Z,re,de,me,ue,Te,_e,Ce):function(Fe,Be,Ne,qe,Ve){const ot=[],mt=[],tt=Ve[8]*Be,Nt=Ve[9]*Be,Ot=Ve[10]*Be,St=Ve[11]*Be,vt=Ve[8]*Ne,or=Ve[9]*Ne,Ft=Ve[10]*Ne,Gt=Ve[11]*Ne;for(const gr of Fe){const Dr=[],Mr=[];for(const Cr of gr){const zr=Cr.x+qe.x,Fr=Cr.y+qe.y,bn=Ve[0]*zr+Ve[4]*Fr+Ve[12],dn=Ve[1]*zr+Ve[5]*Fr+Ve[13],yr=Ve[2]*zr+Ve[6]*Fr+Ve[14],on=Ve[3]*zr+Ve[7]*Fr+Ve[15],an=bn+tt,In=dn+Nt,ti=yr+Ot,pi=Math.max(on+St,1e-5),ri=bn+vt,$n=dn+or,Ui=yr+Ft,vi=Math.max(on+Gt,1e-5);Dr.push(new Fh(an/pi,In/pi,ti/pi)),Mr.push(new Fh(ri/vi,$n/vi,Ui/vi))}ot.push(Dr),mt.push(Mr)}return[ot,mt]}(H,Z,re,de,me)}(h,u,T,v,P,g,O,I,C,h.center.lat,c.tileID.canonical),W=c.queryGeometry;return function(B,H,Z){let re=1/0;dr(Z,H)&&(re=yP(Z,H[0]));for(let de=0;de<H.length;de++){const me=H[de],ue=B[de];for(let Te=0;Te<me.length-1;Te++){const _e=me[Te],Ce=[_e,me[Te+1],ue[Te+1],ue[Te],_e];kt(Z,Ce)&&(re=Math.min(re,yP(Z,Ce)))}}return re!==1/0&&re}(F,V,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends uo{constructor(c,r,o,u){const m=PP();super(c,m,r,o,u),m.layout&&(this.layout=new Kc(m.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof mh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,r){super.recalculate(c,r),this.paint._values["line-floorwidth"]=(()=>{if(xg)return xg;const o=PP();return xg=new DN(o.paint.properties["line-width"].specification),xg.useIntegerZoom=!0,xg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Bw(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,r,o){const u=CP(this);return{config:new Xl(this,{zoom:r,lut:o}),defines:u,overrideFog:!1}}queryRadius(c){const r=c,o=AP(zn("line-width",this,r),zn("line-gap-width",this,r)),u=zn("line-offset",this,r);return o/2+Math.abs(u)+_n(this.paint.get("line-translate"))}queryIntersectsFeature(c,r,o,u,m,h){if(c.queryGeometry.isAboveHorizon)return!1;const g=Ar(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),b=c.pixelToTileUnitsFactor/2*AP(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),M=this.paint.get("line-offset").evaluate(r,o);return M&&(u=function(P,v){const T=[],I=new lt(0,0);for(let E=0;E<P.length;E++){const C=P[E],D=[];for(let O=0;O<C.length;O++){const F=C[O],V=C[O+1],W=O===0?I:F.sub(C[O-1])._unit()._perp(),B=O===C.length-1?I:V.sub(F)._unit()._perp(),H=W._add(B)._unit();H._mult(1/(H.x*B.x+H.y*B.y)),D.push(H._mult(v)._add(F))}T.push(D)}return T}(u,M*c.pixelToTileUnitsFactor)),function(P,v,T){for(let I=0;I<v.length;I++){const E=v[I];if(P.length>=3){for(let C=0;C<E.length;C++)if(Cn(P,E[C]))return!0}if(Jt(P,E,T))return!0}return!1}(g,u,b)}isTileClipped(){return!0}isDraped(c){const r=this.layout.get("line-z-offset");return r.isConstant()&&!r.constantOr(0)}},symbol:uv,background:class extends uo{constructor(c,r,o,u){super(c,{layout:fA||(fA=new Ln({visibility:new Pt(He.layout_background.visibility)})),paint:pA||(pA=new Ln({"background-pitch-alignment":new Pt(He.paint_background["background-pitch-alignment"]),"background-color":new Pt(He.paint_background["background-color"]),"background-pattern":new Pt(He.paint_background["background-pattern"]),"background-opacity":new Pt(He.paint_background["background-opacity"]),"background-emissive-strength":new Pt(He.paint_background["background-emissive-strength"])}))},r,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,r,o){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:vA,"raster-particle":EA,sky:class extends uo{constructor(c,r,o,u){super(c,{layout:wA||(wA=new Ln({visibility:new Pt(He.layout_sky.visibility)})),paint:SA||(SA=new Ln({"sky-type":new Pt(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pt(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pt(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pt(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pt(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new ka(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pt(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pt(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pt(He.paint_sky["sky-opacity"])}))},r,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(c,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),m=!u,h=c.style.light,g=h.properties.get("position");return m&&h.properties.get("anchor")==="viewport"&&Gr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?oS(g.azimuthal,90-g.polar,r):oS(u[0],90-u[1],r)}const o=this.paint.get("sky-gradient-center");return oS(o[0],90-o[1],r)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends uo{constructor(c,r,o,u){super(c,{paint:TA||(TA=new Ln({}))},r,null)}},model:class extends uo{constructor(c,r,o,u){super(c,{layout:LA||(LA=new Ln({visibility:new Pt(He.layout_model.visibility),"model-id":new nr(He.layout_model["model-id"])})),paint:zA||(zA=new Ln({"model-opacity":new Pt(He.paint_model["model-opacity"]),"model-rotation":new nr(He.paint_model["model-rotation"]),"model-scale":new nr(He.paint_model["model-scale"]),"model-translation":new nr(He.paint_model["model-translation"]),"model-color":new nr(He.paint_model["model-color"]),"model-color-mix-intensity":new nr(He.paint_model["model-color-mix-intensity"]),"model-type":new Pt(He.paint_model["model-type"]),"model-cast-shadows":new Pt(He.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pt(He.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pt(He.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new nr(He.paint_model["model-emissive-strength"]),"model-roughness":new nr(He.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new nr(He.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pt(He.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pt(He.paint_model["model-front-cutoff"])}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new lS(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof yv?zt-1:0}queryIntersectsFeature(c,r,o,u,m,h){if(!this.modelManager)return!1;const g=this.modelManager,b=c.tile.getBucket(this);if(!(b&&b instanceof lS))return!1;const M=b;for(const P in M.instancesPerModel){const v=M.instancesPerModel[P],T=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(v.idToFeaturesIndex.hasOwnProperty(T)){const I=v.features[v.idToFeaturesIndex[T]],E=g.getModel(P,this.scope);if(!E)return!1;let C=be.mat4.create();const D=new $(0,0),O=M.canonical;let F=Number.MAX_VALUE;for(let V=0;V<I.instancedDataCount;++V){const W=16*(I.instancedDataOffset+V),B=v.instancedDataArray.float32,H=[B[W+4],B[W+5],B[W+6]];VA(O,D,B[W],0|B[W+1]),FA(C,E,h,D,I.rotation,I.scale,H,!1,!1,!1),h.projection.name==="globe"&&(C=sS(C,h));const Z=be.mat4.multiply([],h.projMatrix,C),re=c.queryGeometry,de=AA(re.isPointQuery()?re.screenBounds:re.screenGeometry,h,Z,E.aabb);de!=null&&(F=Math.min(de,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(c,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const r=this._transitionablePaint._values[c];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof rs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(c,r,o,u){const m=c.tile,h=m.getBucket(this);let g=null,b=Number.MAX_VALUE;if(!(h&&h instanceof yv))return{queryFeature:g,intersectionZ:b};const M=h.getNodesInfo()[r];if(M.hiddenByReplacement||!M.node.meshes||!o.filter(new qn(m.tileID.overscaledZ),M.feature,m.tileID.canonical))return{queryFeature:g,intersectionZ:b};const P=M.node,v=u.calculatePosMatrix(m.tileID.toUnwrapped(),u.worldSize),T=M.evaluatedScale;let I=0;u.elevation&&P.elevation&&(I=P.elevation*u.elevation.exaggeration()),be.mat4.translate(v,v,[(P.anchor?P.anchor[0]:0)*(T[0]-1),(P.anchor?P.anchor[1]:0)*(T[1]-1),I]),be.mat4.scale(v,v,T),be.mat4.multiply(v,v,P.matrix);const E=c.queryGeometry,C=E.isPointQuery()?E.screenBounds:E.screenGeometry,D=function(F){const V=be.mat4.multiply([],v,F.matrix),W=be.mat4.multiply(V,u.expandedFarZProjMatrix,V);for(let B=0;B<F.meshes.length;++B){const H=F.meshes[B];if(B===F.lightMeshIndex)continue;const Z=AA(C,u,W,H.aabb);Z!=null&&(b=Math.min(Z,b))}if(F.children)for(const B of F.children)D(B)};if(D(P),b===Number.MAX_VALUE)return{queryFeature:g,intersectionZ:b};const O=new $(0,0);return VA(m.tileID.canonical,O,M.node.anchor[0],M.node.anchor[1]),g={type:"Feature",geometry:{type:"Point",coordinates:[O.lng,O.lat]},properties:M.feature.properties,id:M.feature.id,state:{},layer:this.serialize()},{queryFeature:g,intersectionZ:b}}},clip:class extends uo{constructor(c,r,o,u){super(c,{layout:zI||(zI=new Ln({"clip-layer-types":new Pt(He.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pt(He.layout_clip["clip-layer-scope"])})),paint:FI||(FI=new Ln({}))},r,o,u)}recalculate(c,r){super.recalculate(c,r)}createBucket(c){return new BI(c)}isTileClipped(){return!0}is3D(){return!0}}};class P2{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A2{constructor(){this.tasks={},this.taskQueue=[],sa(["process"],this),this.invoker=new P2(this.process),this.nextId=0}add(r,o){const u=this.nextId++,m=function({type:h,isSymbolTile:g,zoom:b}){return b=b||0,h==="message"?0:h!=="maybePrepare"||g?h!=="parseTile"||g?h==="parseTile"&&g?300-b:h==="maybePrepare"&&g?400-b:500:200-b:100-b}(o);if(m===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:o,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const o=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let r=null,o=1/0;for(let m=0;m<this.taskQueue.length;m++){const h=this.tasks[this.taskQueue[m]];h.priority<o&&(o=h.priority,r=m)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class $A{constructor(r,o,u){this.target=r,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},sa(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new A2}send(r,o,u,m,h=!1,g){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[b]=u);const M=new Set;return this.target.postMessage({id:b,type:r,hasCallback:!!u,targetMapId:m,mustQueue:h,sourceMapId:this.mapId,data:Oo(o,M)},M),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(r){const o=r.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(o.mustQueue||zl()){const m=this.callbacks[u],h=this.scheduler.add(()=>this.processTask(u,o),m&&m.metadata||{type:"message"});h&&(this.cancelCallbacks[u]=h)}else this.processTask(u,o)}processTask(r,o){if(delete this.cancelCallbacks[r],o.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(o.error?u(Gl(o.error)):u(null,Gl(o.data)))}else{const u=new Set,m=o.hasCallback?(g,b)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:g?Oo(g):null,data:Oo(b,u)},u)}:g=>{},h=Gl(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,h,m);else if(this.parent.getWorkerSource){const g=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,g[0],h.source,h.scope)[g[1]](h,m)}else m(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class jf{constructor(r,o){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=kn();const u=this.workerPool.acquire(this.id);for(let m=0;m<u.length;m++){const h=new jf.Actor(u[m],o,this.id);h.name=`Worker ${m}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,o,u){so(this.actors,(m,h)=>{m.send(r,o,h)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}jf.Actor=$A;class WA{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,o){const u=this.toIdx(r,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,o){return this.leaves[this.toIdx(r,o)]}toIdx(r,o){return o*this.size+r}}function GA(c,r,o,u){let m=0,h=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(o[g]<c[g]||o[g]>r[g])return null}else{const b=1/u[g];let M=(c[g]-o[g])*b,P=(r[g]-o[g])*b;if(M>P){const v=M;M=P,P=v}if(M>m&&(m=M),P<h&&(h=P),m>h)return null}return m}function HA(c,r,o,u,m,h,g,b,M,P,v){const T=u-c,I=m-r,E=h-o,C=g-c,D=b-r,O=M-o,F=v[1]*O-v[2]*D,V=v[2]*C-v[0]*O,W=v[0]*D-v[1]*C,B=T*F+I*V+E*W;if(Math.abs(B)<1e-15)return null;const H=1/B,Z=P[0]-c,re=P[1]-r,de=P[2]-o,me=(Z*F+re*V+de*W)*H;if(me<0||me>1)return null;const ue=re*E-de*I,Te=de*T-Z*E,_e=Z*I-re*T,Ce=(v[0]*ue+v[1]*Te+v[2]*_e)*H;return Ce<0||me+Ce>1?null:(C*ue+D*Te+O*_e)*H}function qA(c,r,o){return(c-r)/(o-r)}function ZA(c,r,o,u,m,h,g,b,M){const P=1<<o,v=h-u,T=g-m,I=(c+1)/P*v+u,E=(r+0)/P*T+m,C=(r+1)/P*T+m;b[0]=(c+0)/P*v+u,b[1]=E,M[0]=I,M[1]=C}class YA{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(h){const g=Math.ceil(Math.log2(h.dim/8)),b=[];let M=Math.ceil(Math.pow(2,g));const P=1/M,v=(E,C,D,O,F)=>{const V=O?1:0,W=(E+1)*D-V,B=C*D,H=(C+1)*D-V;F[0]=E*D,F[1]=B,F[2]=W,F[3]=H};let T=new WA(M);const I=[];for(let E=0;E<M*M;E++){v(E%M,Math.floor(E/M),P,!1,I);const C=mu(I[0],I[1],h),D=mu(I[2],I[1],h),O=mu(I[2],I[3],h),F=mu(I[0],I[3],h);T.minimums.push(Math.min(C,D,O,F)),T.maximums.push(Math.max(C,D,O,F)),T.leaves.push(1)}for(b.push(T),M/=2;M>=1;M/=2){const E=b[b.length-1];T=new WA(M);for(let C=0;C<M*M;C++){v(C%M,Math.floor(C/M),2,!0,I);const D=E.getElevation(I[0],I[1]),O=E.getElevation(I[2],I[1]),F=E.getElevation(I[2],I[3]),V=E.getElevation(I[0],I[3]),W=E.isLeaf(I[0],I[1]),B=E.isLeaf(I[2],I[1]),H=E.isLeaf(I[2],I[3]),Z=E.isLeaf(I[0],I[3]),re=Math.min(D.min,O.min,F.min,V.min),de=Math.max(D.max,O.max,F.max,V.max),me=W&&B&&H&&Z;T.maximums.push(de),T.minimums.push(re),T.leaves.push(de-re<=5&&me?1:0)}b.push(T)}return b}(this.dem),u=o.length-1,m=o[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(r,o,u,m,h,g,b=1){return GA([r,o,-100],[u,m,this.maximums[0]*b],h,g)}raycast(r,o,u,m,h,g,b=1){if(!this.nodeCount)return null;const M=this.raycastRoot(r,o,u,m,h,g,b);if(M==null)return null;const P=[],v=[],T=[],I=[],E=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:C,t:D,nodex:O,nodey:F,depth:V}=E.pop();if(this.leaves[C]){ZA(O,F,V,r,o,u,m,T,I);const B=1<<V,H=(O+0)/B,Z=(O+1)/B,re=(F+0)/B,de=(F+1)/B,me=mu(H,re,this.dem)*b,ue=mu(Z,re,this.dem)*b,Te=mu(Z,de,this.dem)*b,_e=mu(H,de,this.dem)*b,Ce=HA(T[0],T[1],me,I[0],T[1],ue,I[0],I[1],Te,h,g),Oe=HA(I[0],I[1],Te,T[0],I[1],_e,T[0],T[1],me,h,g),Fe=Math.min(Ce!==null?Ce:Number.MAX_VALUE,Oe!==null?Oe:Number.MAX_VALUE);if(Fe!==Number.MAX_VALUE)return Fe;{const Be=be.vec3.scaleAndAdd([],h,g,D);if(XA(me,ue,_e,Te,qA(Be[0],T[0],I[0]),qA(Be[1],T[1],I[1]))>=Be[2])return D}continue}let W=0;for(let B=0;B<this._siblingOffset.length;B++){ZA((O<<1)+this._siblingOffset[B][0],(F<<1)+this._siblingOffset[B][1],V+1,r,o,u,m,T,I),T[2]=-100,I[2]=this.maximums[this.childOffsets[C]+B]*b;const H=GA(T,I,h,g);if(H!=null){const Z=H;P[B]=Z;let re=!1;for(let de=0;de<W&&!re;de++)Z>=P[v[de]]&&(v.splice(de,0,B),re=!0);re||(v[W]=B),W++}}for(let B=0;B<W;B++){const H=v[B];E.push({idx:this.childOffsets[C]+H,t:P[H],nodex:(O<<1)+this._siblingOffset[H][0],nodey:(F<<1)+this._siblingOffset[H][1],depth:V+1})}}return null}_addNode(r,o,u){return this.minimums.push(r),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,o,u,m,h){if(r[m].isLeaf(o,u)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const g=m-1,b=r[g];let M=0,P=0;for(let v=0;v<this._siblingOffset.length;v++){const T=2*o+this._siblingOffset[v][0],I=2*u+this._siblingOffset[v][1],E=b.getElevation(T,I),C=b.isLeaf(T,I),D=this._addNode(E.min,E.max,C);C&&(M|=1<<v),P||(P=D)}for(let v=0;v<this._siblingOffset.length;v++)M&1<<v||this._construct(r,2*o+this._siblingOffset[v][0],2*u+this._siblingOffset[v][1],g,P+v)}}function XA(c,r,o,u,m,h){return ur(ur(c,o,h),ur(r,u,h),m)}function mu(c,r,o){const u=o.dim,m=hr(c*u-.5,0,u-1),h=hr(r*u-.5,0,u-1),g=Math.floor(m),b=Math.floor(h),M=Math.min(g+1,u-1),P=Math.min(b+1,u-1);return XA(o.get(g,b),o.get(M,b),o.get(g,P),o.get(M,P),m-g,h-b)}const D2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function R2(c,r,o){return(256*c*256+256*r+o)/10-1e4}function k2(c,r,o){return 256*c+r+o/256-32768}class vv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,o,u,m=!1){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Gr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const h=this.dim=o.height-2,g=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let M=0;M<h;M++)g[this._idx(-1,M)]=g[this._idx(0,M)],g[this._idx(h,M)]=g[this._idx(h-1,M)],g[this._idx(M,-1)]=g[this._idx(M,0)],g[this._idx(M,h)]=g[this._idx(M,h-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(h,-1)]=g[this._idx(h-1,0)],g[this._idx(-1,h)]=g[this._idx(0,h-1)],g[this._idx(h,h)]=g[this._idx(h-1,h-1)]}const b=u==="terrarium"?k2:R2;for(let M=0;M<g.length;++M){const P=4*M;this.floatView[M]=b(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=jt.now()}_buildQuadTree(){this._tree=new YA(this)}get(r,o,u=!1){u&&(r=hr(r,-1,this.dim),o=hr(o,-1,this.dim));const m=this._idx(r,o);return this.floatView[m]}set(r,o,u){const m=this._idx(r,o),h=this.floatView[m];return this.floatView[m]=u,u-h}static getUnpackVector(r){return D2[r]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}static pack(r,o){const u=[0,0,0,0],m=vv.getUnpackVector(o);let h=Math.floor((r+m[3])/m[2]);return u[2]=h%256,h=Math.floor(h/256),u[1]=h%256,h=Math.floor(h/256),u[0]=h,u}getPixels(){return new PI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,o,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=o*this.dim,h=o*this.dim+this.dim,g=u*this.dim,b=u*this.dim+this.dim;switch(o){case-1:m=h-1;break;case 1:h=m+1}switch(u){case-1:g=b-1;break;case 1:b=g+1}const M=-o*this.dim,P=-u*this.dim;for(let v=g;v<b;v++)for(let T=m;T<h;T++){const I=4*this._idx(T,v),E=4*this._idx(T+M,v+P);this.pixels[I+0]=r.pixels[E+0],this.pixels[I+1]=r.pixels[E+1],this.pixels[I+2]=r.pixels[E+2],this.pixels[I+3]=r.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function O2(c,r,o){c===1?r.header_length=o.readFixed32():c===2?r.x=o.readVarint():c===3?r.y=o.readVarint():c===4?r.z=o.readVarint():c===5&&r.layers.push(function(u,m){return u.readFields(N2,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},m)}(o,o.readVarint()+o.pos))}function L2(c,r,o){c===1?(r.delta_filter=function(u,m){return u.readFields(z2,{block_size:0},m)}(o,o.readVarint()+o.pos),r.filter="delta_filter"):c===2?(o.readVarint(),r.filter="zigzag_filter"):c===3?(o.readVarint(),r.filter="bitshuffle_filter"):c===4&&(o.readVarint(),r.filter="byteshuffle_filter")}function z2(c,r,o){c===1&&(r.block_size=o.readVarint())}function F2(c,r,o){c===1?(o.readVarint(),r.codec="gzip_data"):c===2?(o.readVarint(),r.codec="jpeg_image"):c===3?(o.readVarint(),r.codec="webp_image"):c===4&&(o.readVarint(),r.codec="png_image")}function B2(c,r,o){c===1?r.first_byte=o.readFixed64():c===2?r.last_byte=o.readFixed64():c===3?r.filters.push(function(u,m){return u.readFields(L2,{},m)}(o,o.readVarint()+o.pos)):c===4?r.codec=function(u,m){return u.readFields(F2,{},m)}(o,o.readVarint()+o.pos):c===5?r.deprecated_offset=o.readFloat():c===6?r.deprecated_scale=o.readFloat():c===7?r.bands.push(o.readString()):c===8?r.offset=o.readDouble():c===9&&(r.scale=o.readDouble())}function N2(c,r,o){c===1?r.version=o.readVarint():c===2?r.name=o.readString():c===3?r.units=o.readString():c===4?r.tilesize=o.readVarint():c===5?r.buffer=o.readVarint():c===6?r.pixel_format=o.readVarint():c===7&&r.data_index.push(function(u,m){return u.readFields(B2,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},m)}(o,o.readVarint()+o.pos))}function U2(c,r,o){if(c===2)(function(u,m,h){u.readFields(j2,h,m)})(o,o.readVarint()+o.pos,r);else if(c===3)throw new Error("Not implemented")}function j2(c,r,o){if(c===1){let u=0;const m=o.readVarint()+o.pos;for(;o.pos<m;)r[u++]=o.readVarint()}}Zt(vv,"DEMData"),Zt(YA,"DemMinMaxQuadTree",{omit:["dem"]});class V2{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const o=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,o),o}put(r,o){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,o)}}function $2(c,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let o=r[3];for(let u=2;u>=1;u--){const m=u===1?1:0,h=u===2?1:0;for(let g=0;g<r[0];g++){const b=r[1]*g;for(let M=m;M<r[1];M++){const P=r[2]*(M+b);for(let v=h;v<r[2];v++){const T=r[3]*(v+P);for(let I=0;I<r[3];I++){const E=T+I;c[E]+=c[E-o]}}}}o*=r[u]}return c}function W2(c){for(let r=0,o=c.length;r<o;r++)c[r]=c[r]>>>1^-(1&c[r]);return c}function G2(c,r){switch(r){case"uint32":return c;case"uint16":for(let o=0;o<c.length;o+=2){const u=c[o],m=c[o+1];c[o]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,c[o+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let o=0;o<c.length;o+=4){const u=c[o],m=c[o+1],h=c[o+2],g=c[o+3];c[o+0]=(192&u)>>6|(192&m)>>4|(192&h)>>2|192&g,c[o+1]=(48&u)>>4|(48&m)>>2|48&h|(48&g)<<2,c[o+2]=(12&u)>>2|12&m|(12&h)<<2|(12&g)<<4,c[o+3]=3&u|(3&m)<<2|(3&h)<<4|(3&g)<<6}return c;default:throw new Error(`Invalid pixel format, "${r}"`)}}var Fa=Uint8Array,kg=Uint16Array,H2=Int32Array,KA=new Fa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),JA=new Fa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),q2=new Fa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),QA=function(c,r){for(var o=new kg(31),u=0;u<31;++u)o[u]=r+=1<<c[u-1];var m=new H2(o[30]);for(u=1;u<30;++u)for(var h=o[u];h<o[u+1];++h)m[h]=h-o[u]<<5|u;return{b:o,r:m}},eD=QA(KA,2),tD=eD.b,Z2=eD.r;tD[28]=258,Z2[258]=28;for(var Y2=QA(JA,0).b,rD=new kg(32768),fi=0;fi<32768;++fi){var Vf=(43690&fi)>>1|(21845&fi)<<1;rD[fi]=((65280&(Vf=(61680&(Vf=(52428&Vf)>>2|(13107&Vf)<<2))>>4|(3855&Vf)<<4))>>8|(255&Vf)<<8)>>1}var Og=function(c,r,o){for(var u=c.length,m=0,h=new kg(r);m<u;++m)c[m]&&++h[c[m]-1];var g,b=new kg(r);for(m=1;m<r;++m)b[m]=b[m-1]+h[m-1]<<1;g=new kg(1<<r);var M=15-r;for(m=0;m<u;++m)if(c[m])for(var P=m<<4|c[m],v=r-c[m],T=b[c[m]-1]++<<v,I=T|(1<<v)-1;T<=I;++T)g[rD[T]>>M]=P;return g},Lg=new Fa(288);for(fi=0;fi<144;++fi)Lg[fi]=8;for(fi=144;fi<256;++fi)Lg[fi]=9;for(fi=256;fi<280;++fi)Lg[fi]=7;for(fi=280;fi<288;++fi)Lg[fi]=8;var nD=new Fa(32);for(fi=0;fi<32;++fi)nD[fi]=5;var X2=Og(Lg,9),K2=Og(nD,5),dS=function(c){for(var r=c[0],o=1;o<c.length;++o)c[o]>r&&(r=c[o]);return r},Os=function(c,r,o){var u=r/8|0;return(c[u]|c[u+1]<<8)>>(7&r)&o},fS=function(c,r){var o=r/8|0;return(c[o]|c[o+1]<<8|c[o+2]<<16)>>(7&r)},J2=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ls=function(c,r,o){var u=new Error(r||J2[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,Ls),!o)throw u;return u},Q2=new Fa(0),e6=typeof TextDecoder<"u"&&new TextDecoder;try{e6.decode(Q2,{stream:!0})}catch{}const t6={gzip_data:"gzip"};class ss extends Error{constructor(r){super(r),this.name="MRTError"}}const r6={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},iD={uint32:1,uint16:2,uint8:4},n6={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let pS;class mS{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const o=this.layers[r];if(!o)throw new ss(`Layer '${r}' not found`);return o}getHeaderLength(r){const o=new Uint8Array(r),u=new DataView(r);if(o[0]!==13)throw new ss("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const o=new Uint8Array(r),u=this.getHeaderLength(r);if(o.length<u)throw new ss(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const m=function(h,g){return h.readFields(O2,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new pS(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new ss(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const h of m.layers)this.layers[h.name]=new i6(h,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const o=[],u=this.getLayer(r.layerName);for(let m of r.blockIndices){const h=u.dataIndex[m],g=h.first_byte-r.firstByte,b=h.last_byte-r.firstByte;if(u._blocksInProgress.has(m))continue;const M={layerName:u.name,firstByte:g,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[h.bands.length].concat(u.bandShape),buffer:u.buffer,codec:h.codec.codec,filters:h.filters.map(P=>P.filter)};u._blocksInProgress.add(m),o.push(M)}return new oD(o,()=>{o.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,h)=>{if(o.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),m)throw m;h.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class i6{constructor({version:r,name:o,units:u,tilesize:m,pixel_format:h,buffer:g,data_index:b},M){if(this.version=r,this.version!==1)throw new ss(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=o,this.units=u,this.tileSize=m,this.buffer=g,this.pixelFormat=r6[h],this.dataIndex=b,this.bandShape=[m+2*g,m+2*g,iD[this.pixelFormat]],this._decodedBlocks=new V2(M?M.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return iD[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const o=r.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,r.data)}getBlockForBand(r){let o=0;switch(typeof r){case"string":for(const[u,m]of this.dataIndex.entries()){for(const[h,g]of m.bands.entries())if(g===r)return{bandIndex:o+h,blockIndex:u,blockBandIndex:h};o+=m.bands.length}break;case"number":for(const[u,m]of this.dataIndex.entries()){if(r>=o&&r<o+m.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-o};o+=m.bands.length}break;default:throw new ss(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}throw new ss(`Band not found: ${JSON.stringify(r)}`)}getDataRange(r){let o=1/0,u=-1/0;const m=[],h=new Set;for(const g of r){const{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new ss(`Invalid band: ${JSON.stringify(g)}`);const M=this.dataIndex[b];m.includes(b)||m.push(b),h.add(b),o=Math.min(o,M.first_byte),u=Math.max(u,M.last_byte)}if(h.size>this.cacheSize)throw new ss(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:m}}hasBand(r){const{blockIndex:o}=this.getBlockForBand(r);return o>=0}hasDataForBand(r){const{blockIndex:o}=this.getBlockForBand(r);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(r){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(r),m=this._decodedBlocks.get(o.toString());if(!m)throw new ss(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[o],g=this.bandShape.reduce((P,v)=>P*v,1),b=u*g,M=m.subarray(b,b+g);return{data:M,bytes:new Uint8Array(M.buffer).subarray(M.byteOffset,M.byteOffset+M.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset!==0?h.offset:h.deprecated_offset,scale:h.scale!==0?h.scale:h.deprecated_scale}}}mS.setPbf=function(c){pS=c};class oD{constructor(r,o,u){this.tasks=r,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,o){this._finalized||(this._onComplete(r,o),this._finalized=!0)}}mS.performDecoding=function(c,r){const o=new Uint8Array(c);return Promise.all(r.tasks.map(u=>{const{layerName:m,firstByte:h,lastByte:g,pixelFormat:b,blockShape:M,blockIndex:P,filters:v,codec:T}=u,I=o.subarray(h,g+1),E=new Uint32Array(M[0]*M[1]*M[2]);let C;if(T!=="gzip_data")throw new ss(`Unhandled codec: ${T}`);return C=function(D,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((B=function(re){re[0]==31&&re[1]==139&&re[2]==8||Ls(6,"invalid gzip data");var de=re[3],me=10;4&de&&(me+=2+(re[10]|re[11]<<8));for(var ue=(de>>3&1)+(de>>4&1);ue>0;ue-=!re[me++]);return me+(2&de)}(W=D))+8>W.length&&Ls(6,"invalid gzip data"),function(re,de,me,ue){var Te=re.length;if(!Te||de.f&&!de.l)return me||new Fa(0);var _e=!me,Ce=_e||de.i!=2,Oe=de.i;_e&&(me=new Fa(3*Te));var Fe,Be,Ne=function(gu){var Vh=me.length;if(gu>Vh){var Vg=new Fa(Math.max(2*Vh,gu));Vg.set(me),me=Vg}},qe=de.f||0,Ve=de.p||0,ot=de.b||0,mt=de.l,tt=de.d,Nt=de.m,Ot=de.n,St=8*Te;do{if(!mt){qe=Os(re,Ve,1);var vt=Os(re,Ve+1,3);if(Ve+=3,!vt){var or=re[(yr=4+((Ve+7)/8|0))-4]|re[yr-3]<<8,Ft=yr+or;if(Ft>Te){Oe&&Ls(0);break}Ce&&Ne(ot+or),me.set(re.subarray(yr,Ft),ot),de.b=ot+=or,de.p=Ve=8*Ft,de.f=qe;continue}if(vt==1)mt=X2,tt=K2,Nt=9,Ot=5;else if(vt==2){var Gt=Os(re,Ve,31)+257,gr=Os(re,Ve+10,15)+4,Dr=Gt+Os(re,Ve+5,31)+1;Ve+=14;for(var Mr=new Fa(Dr),Cr=new Fa(19),zr=0;zr<gr;++zr)Cr[q2[zr]]=Os(re,Ve+3*zr,7);Ve+=3*gr;var Fr=dS(Cr),bn=(1<<Fr)-1,dn=Og(Cr,Fr);for(zr=0;zr<Dr;){var yr,on=dn[Os(re,Ve,bn)];if(Ve+=15&on,(yr=on>>4)<16)Mr[zr++]=yr;else{var an=0,In=0;for(yr==16?(In=3+Os(re,Ve,3),Ve+=2,an=Mr[zr-1]):yr==17?(In=3+Os(re,Ve,7),Ve+=3):yr==18&&(In=11+Os(re,Ve,127),Ve+=7);In--;)Mr[zr++]=an}}var ti=Mr.subarray(0,Gt),pi=Mr.subarray(Gt);Nt=dS(ti),Ot=dS(pi),mt=Og(ti,Nt),tt=Og(pi,Ot)}else Ls(1);if(Ve>St){Oe&&Ls(0);break}}Ce&&Ne(ot+131072);for(var ri=(1<<Nt)-1,$n=(1<<Ot)-1,Ui=Ve;;Ui=Ve){var vi=(an=mt[fS(re,Ve)&ri])>>4;if((Ve+=15&an)>St){Oe&&Ls(0);break}if(an||Ls(2),vi<256)me[ot++]=vi;else{if(vi==256){Ui=Ve,mt=null;break}var no=vi-254;vi>264&&(no=Os(re,Ve,(1<<(Fs=KA[zr=vi-257]))-1)+tD[zr],Ve+=Fs);var En=tt[fS(re,Ve)&$n],Qo=En>>4;if(En||Ls(3),Ve+=15&En,pi=Y2[Qo],Qo>3){var Fs=JA[Qo];pi+=fS(re,Ve)&(1<<Fs)-1,Ve+=Fs}if(Ve>St){Oe&&Ls(0);break}Ce&&Ne(ot+131072);var ls=ot+no;if(ot<pi){var cs=0-pi,jh=Math.min(pi,ls);for(cs+ot<0&&Ls(3);ot<jh;++ot)me[ot]=(void 0)[cs+ot]}for(;ot<ls;++ot)me[ot]=me[ot-pi]}}de.l=mt,de.p=Ui,de.b=ot,de.f=qe,mt&&(qe=1,de.m=Nt,de.d=tt,de.n=Ot)}while(!qe);return ot!=me.length&&_e?(Fe=me,((Be=ot)==null||Be>Fe.length)&&(Be=Fe.length),new Fa(Fe.subarray(0,Be))):me.subarray(0,ot)}(W.subarray(B,-8),{i:2},new Fa(((F=W)[(V=F.length)-4]|F[V-3]<<8|F[V-2]<<16|F[V-1]<<24)>>>0))));var F,V,W,B;const H=t6[O];if(!H)throw new Error(`Unhandled codec: ${O}`);const Z=new globalThis.DecompressionStream(H);return new Response(new Blob([D]).stream().pipeThrough(Z)).arrayBuffer().then(re=>new Uint8Array(re))}(I,T).then(D=>(function(O,F){O.readFields(U2,F)}(new pS(D),E),new n6[b](E.buffer))),C.then(D=>{for(let O=v.length-1;O>=0;O--)switch(v[O]){case"delta_filter":$2(D,M);break;case"zigzag_filter":W2(D);break;case"bitshuffle_filter":G2(D,b);break;default:throw new ss(`Unhandled filter "${v[O]}"`)}return{layerName:m,blockIndex:P,data:D}}).catch(D=>{throw D})}))},Zt(oD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var zg={workerUrl:"",workerClass:null,workerParams:void 0};const gS="mapboxgl_preloaded_worker_pool";class Fg{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Fg.workerCount;)this.workers.push(zg.workerClass!=null?new zg.workerClass:new self.Worker(zg.workerUrl,zg.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gS]}numActive(){return Object.keys(this.active).length}}let Bg;function xv(){return Bg||(Bg=new Fg),Bg}Fg.workerCount=2;let Ng,_S,zs,$f,yS,Wf=null;function aD(){return zl()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:_S||Re.DRACO_URL}function sD(){if(zl()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if($f)return $f;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return $f=WebAssembly.validate(c)?Re.MESHOPT_SIMD_URL:Re.MESHOPT_URL,$f}const bv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},o6={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ug={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function lD(c,r,o){const u=o.json.bufferViews.length,m=o.buffers.length;r.bufferView=u,o.json.bufferViews[u]={buffer:m,byteLength:c.byteLength},o.buffers[m]=c}const vS="KHR_draco_mesh_compression";function a6(c,r){const o=c.extensions&&c.extensions[vS];if(!o)return;const u=new zs.Decoder,m=dD(r,o.bufferView),h=new zs.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,h))throw new Error("Failed to decode Draco mesh");const g=r.json.accessors[c.indices],b=bv[g.componentType],M=g.count*b.BYTES_PER_ELEMENT,P=zs._malloc(M);b===Uint16Array?u.GetTrianglesUInt16Array(h,M,P):u.GetTrianglesUInt32Array(h,M,P),lD(zs.memory.buffer.slice(P,P+M),g,r),zs._free(P);for(const v of Object.keys(o.attributes)){const T=u.GetAttributeByUniqueId(h,o.attributes[v]),I=r.json.accessors[c.attributes[v]],E=o6[I.componentType],C=I.count*Ug[I.type]*bv[I.componentType].BYTES_PER_ELEMENT,D=zs._malloc(C);u.GetAttributeDataArrayForAllPoints(h,T,zs[E],C,D),lD(zs.memory.buffer.slice(D,D+C),I,r),zs._free(D)}u.destroy(),h.destroy(),delete c.extensions[vS]}const wv="EXT_meshopt_compression";function s6(c,r){if(!c.extensions||!c.extensions[wv])return;const o=c.extensions[wv],u=new Uint8Array(r.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),m=new Uint8Array(o.count*o.byteStride);yS.decodeGltfBuffer(m,o.count,o.byteStride,u,o.mode,o.filter),c.buffer=r.buffers.length,c.byteOffset=0,r.buffers[c.buffer]=m.buffer,delete c.extensions[wv]}const cD=1179937895,uD=new TextDecoder("utf8");function hD(c,r){return new URL(c,r).href}function l6(c,r,o,u){return fetch(hD(c.uri,u)).then(m=>m.arrayBuffer()).then(m=>{r.buffers[o]=m})}function dD(c,r){const o=c.json.bufferViews[r];return new Uint8Array(c.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function c6(c,r,o,u){if(c.uri){const m=hD(c.uri,u);return fetch(m).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{r.images[o]=h})}if(c.bufferView!==void 0){const m=dD(r,c.bufferView),h=new Blob([m],{type:c.mimeType});return createImageBitmap(h).then(g=>{r.images[o]=g})}}function fD(c,r=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,r,1)[0]===cD){const v=new Uint32Array(c,r);let T=2;const I=(v[T++]>>2)-3,E=v[T++]>>2;if(T++,u.json=JSON.parse(uD.decode(v.subarray(T,T+E))),T+=E,T<I){const C=v[T++];T++;const D=r+(T<<2);u.buffers[0]=c.slice(D,D+C)}}else u.json=JSON.parse(uD.decode(new Uint8Array(c,r)));const{buffers:m,images:h,meshes:g,extensionsUsed:b,bufferViews:M}=u.json;let P=Promise.resolve();if(m){const v=[];for(let T=0;T<m.length;T++){const I=m[T];I.uri?v.push(l6(I,u,T,o)):u.buffers[T]||(u.buffers[T]=null)}P=Promise.all(v)}return P.then(()=>{const v=[],T=b&&b.includes(vS),I=b&&b.includes(wv);if(T&&v.push(function(){if(!zs)return Ng??(Ng=function(E){let C,D=null;function O(){C=new Uint8Array(D.buffer)}function F(){throw new Error("Unexpected Draco error.")}const V={a:{a:F,d:function(W,B,H){return C.copyWithin(W,B,B+H)},c:function(W){const B=C.length,H=Math.max(W>>>0,Math.ceil(1.2*B)),Z=Math.ceil((H-B)/65536);try{return D.grow(Z),O(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,V):E.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,V))).then(W=>{const{Rb:B,Qb:H,P:Z,T:re,X:de,Ja:me,La:ue,Qa:Te,Va:_e,Wa:Ce,eb:Oe,jb:Fe,f:Be,e:Ne,yb:qe,zb:Ve,Ab:ot,Bb:mt,Db:tt,Gb:Nt}=W.instance.exports;D=Ne;const Ot=(()=>{let St=0,vt=0,or=0,Ft=0;return Gt=>{or&&(B(Ft),B(St),vt+=or,or=St=0),St||(vt+=128,St=H(vt));const gr=Gt.length+7&-8;let Dr=St;gr>=vt&&(or=gr,Dr=Ft=H(gr));for(let Mr=0;Mr<Gt.length;Mr++)C[Dr+Mr]=Gt[Mr];return Dr}})();return O(),Be(),{memory:Ne,_free:B,_malloc:H,Mesh:class{constructor(){this.ptr=Z()}destroy(){re(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){Fe(this.ptr)}DecodeArrayToMesh(St,vt,or){const Ft=Ot(St),Gt=ue(this.ptr,Ft,vt,or.ptr);return!!de(Gt)}GetAttributeByUniqueId(St,vt){return{ptr:Te(this.ptr,St.ptr,vt)}}GetTrianglesUInt16Array(St,vt,or){_e(this.ptr,St.ptr,vt,or)}GetTrianglesUInt32Array(St,vt,or){Ce(this.ptr,St.ptr,vt,or)}GetAttributeDataArrayForAllPoints(St,vt,or,Ft,Gt){Oe(this.ptr,St.ptr,vt.ptr,or,Ft,Gt)}},DT_INT8:qe(),DT_UINT8:Ve(),DT_INT16:ot(),DT_UINT16:mt(),DT_UINT32:tt(),DT_FLOAT32:Nt()}})}(fetch(aD())),Ng.then(E=>{zs=E,Ng=void 0}))}()),I&&v.push(function(){if(yS)return;const E=function(C){let D;const O=WebAssembly.instantiateStreaming(C,{}).then(W=>{D=W.instance,D.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},V={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(W,B,H,Z,re,de){(function(me,ue,Te,_e,Ce,Oe,Fe){const Be=me.exports.sbrk,Ne=_e+3&-4,qe=Be(Ne*Ce),Ve=Be(Oe.length),ot=new Uint8Array(me.exports.memory.buffer);ot.set(Oe,Ve);const mt=ue(qe,_e,Ce,Ve,Oe.length);if(mt===0&&Fe&&Fe(qe,Ne,Ce),Te.set(ot.subarray(qe,qe+_e*Ce)),Be(qe-Be(0)),mt!==0)throw new Error(`Malformed buffer data: ${mt}`)})(D,D.exports[V[re]],W,B,H,Z,D.exports[F[de]])}}}(fetch(sD()));return E.ready.then(()=>{yS=E})}()),h)for(let E=0;E<h.length;E++)v.push(c6(h[E],u,E,o));return(v.length?Promise.all(v):Promise.resolve()).then(()=>{if(T&&g)for(const{primitives:E}of g)for(const C of E)a6(C,u);if(I&&g&&M)for(const E of M)s6(E,u);return u})})}function Uh(c,r){const o=c.json.bufferViews[r.bufferView],u=bv[r.componentType];return new u(c.buffers[o.buffer],(r.byteOffset||0)+(o.byteOffset||0),r.count*(o.byteStride&&o.byteStride!==Ug[r.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Ug[r.type]))}function xS(c,r,o,u){const m=bv[r.componentType],h=function(v){switch(v){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),g=c.json.bufferViews[r.bufferView],b=g.byteStride?g.byteStride/m.BYTES_PER_ELEMENT:Ug[r.type],M=o.float32,P=M.length/o.capacity;for(let v=0,T=0;v<r.count*b;v+=b,T+=P)for(let I=0;I<P;I++)M[T+I]=u[v+I]*h;o._trim()}function u6(c,r,o){const u=c.indices,m=c.attributes,h={};h.indexArray=new qi;const g=r.json.accessors[u],b=g.count/3;h.indexArray.reserve(b);const M=Uh(r,g);for(let I=0;I<b;I++)h.indexArray.emplaceBack(M[3*I],M[3*I+1],M[3*I+2]);h.indexArray._trim(),h.vertexArray=new cl;const P=r.json.accessors[m.POSITION];h.vertexArray.reserve(P.count);const v=Uh(r,P);for(let I=0;I<P.count;I++)h.vertexArray.emplaceBack(v[3*I],v[3*I+1],v[3*I+2]);if(h.vertexArray._trim(),h.aabb=new Tn(P.min,P.max),h.centroid=function(I,E){const C=[0,0,0],D=I.length;if(D>0){for(let O=0;O<D;O++){const F=3*I[O];C[0]+=E[F],C[1]+=E[F+1],C[2]+=E[F+2]}C[0]/=D,C[1]/=D,C[2]/=D}return C}(M,v),m.COLOR_0!==void 0){const I=r.json.accessors[m.COLOR_0],E=Ug[I.type],C=Uh(r,I);h.colorArray=E===3?new cl:new Cs,h.colorArray.resize(I.count),xS(r,I,h.colorArray,C)}if(m.NORMAL!==void 0){h.normalArray=new cl;const I=r.json.accessors[m.NORMAL];h.normalArray.resize(I.count);const E=Uh(r,I);xS(r,I,h.normalArray,E)}if(m.TEXCOORD_0!==void 0&&o.length>0){h.texcoordArray=new Ah;const I=r.json.accessors[m.TEXCOORD_0];h.texcoordArray.resize(I.count);const E=Uh(r,I);xS(r,I,h.texcoordArray,E)}if(m._FEATURE_ID_RGBA4444!==void 0){const I=r.json.accessors[m._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Uh(r,I))}m._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Uh(r,r.json.accessors[m._FEATURE_RGBA4444]).buffer));const T=c.material;return h.material=function(I,E){const{emissiveFactor:C=[0,0,0],alphaMode:D="OPAQUE",alphaCutoff:O=.5,normalTexture:F,occlusionTexture:V,emissiveTexture:W,doubleSided:B}=I,{baseColorFactor:H=[1,1,1,1],metallicFactor:Z=1,roughnessFactor:re=1,baseColorTexture:de,metallicRoughnessTexture:me}=I.pbrMetallicRoughness||{},ue=V?E[V.index]:void 0;if(V&&V.extensions&&V.extensions.KHR_texture_transform&&ue){const Te=V.extensions.KHR_texture_transform;ue.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new un(...H),metallicFactor:Z,roughnessFactor:re,baseColorTexture:de?E[de.index]:void 0,metallicRoughnessTexture:me?E[me.index]:void 0},doubleSided:B,emissiveFactor:C,alphaMode:D,alphaCutoff:O,normalTexture:F?E[F.index]:void 0,occlusionTexture:ue,emissionTexture:W?E[W.index]:void 0,defined:I.defined===void 0}}(T!==void 0?r.json.materials[T]:{defined:!1},o),h}function pD(c,r,o){const{matrix:u,rotation:m,translation:h,scale:g,mesh:b,extras:M,children:P}=c,v={};if(v.matrix=u||be.mat4.fromRotationTranslationScale([],m||[0,0,0,1],h||[0,0,0],g||[1,1,1]),b!==void 0){v.meshes=o[b];const T=v.anchor=[0,0];for(const I of v.meshes){const{min:E,max:C}=I.aabb;T[0]+=E[0]+C[0],T[1]+=E[1]+C[1]}T[0]=Math.floor(T[0]/v.meshes.length/2),T[1]=Math.floor(T[1]/v.meshes.length/2)}if(M&&(M.id&&(v.id=M.id),M.lights&&(v.lights=function(T){if(!T.length)return[];const I=function(F){const V=atob(F),W=new Uint8Array(V.length);for(let B=0;B<V.length;B++)W[B]=V.codePointAt(B);return W}(T),E=[],C=I.length/24,D=new Uint16Array(I.buffer),O=new Float32Array(I.buffer);for(let F=0;F<C;F++){const V=D[2*F*6]/30,W=D[2*F*6+1]/30,B=D[2*F*6+10]/100,H=O[6*F+1],Z=O[6*F+2],re=O[6*F+3],de=O[6*F+4],me=re-H,ue=de-Z,Te=Math.hypot(me,ue);E.push({pos:[H+.5*me,Z+.5*ue,W],normal:[ue/Te,-me/Te,0],width:Te,height:V,depth:B,points:[H,Z,re,de]})}return E}(M.lights))),P){const T=[];for(const I of P)T.push(pD(r.json.nodes[I],r,o));v.children=T}return v}function h6(c){if(c.vertices.length===0||c.indices.length===0)return null;const r=new Pw(c.vertices,c.indices,8,256),[o,u]=[r.min.clone(),r.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:r,min:o,max:u}}function d6(c){if(!c.extras||!c.extras.ground)return null;const r=c.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const o=r[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const g of o){if(!Array.isArray(g)||g.length!==2)continue;const b=g[0],M=g[1];typeof b=="number"&&typeof M=="number"&&u.push(new lt(b,M))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let g=0;g<u.length;g++){const b=u[g],M=u[(g+1)%u.length],P=u[(g+2)%u.length];m+=(b.x-M.x)*(P.y-M.y)-(P.x-M.x)*(b.y-M.y)}m>0&&u.reverse();const h=dg(u.flatMap(g=>[g.x,g.y]),[]);return h.length===0?null:{vertices:u,indices:h}}function f6(c,r){const o=[],u=[];let m=0;const h=[];for(const g of c){m=o.length;const b=g.vertexArray.float32,M=g.indexArray.uint16;for(let P=0;P<g.vertexArray.length;P++)h[0]=b[3*P+0],h[1]=b[3*P+1],h[2]=b[3*P+2],be.vec3.transformMat4(h,h,r),o.push(new lt(h[0],h[1]));for(let P=0;P<3*g.indexArray.length;P++)u.push(M[P]+m)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const b=o[u[g+0]],M=o[u[g+1]],P=o[u[g+2]];(b.x-M.x)*(P.y-M.y)-(P.x-M.x)*(b.y-M.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:o,indices:u}}function mD(c){const r=function(M,P){const v=[],T=WebGL2RenderingContext;if(M.json.textures)for(const I of M.json.textures){const E={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};I.sampler!==void 0&&Object.assign(E,M.json.samplers[I.sampler]),v.push({image:P[I.source],sampler:E,uploaded:!1})}return v}(c,c.images),o=function(M,P){const v=[];for(const T of M.json.meshes){const I=[];for(const E of T.primitives)I.push(u6(E,M,P));v.push(I)}return v}(c,r),{scenes:u,scene:m,nodes:h}=c.json,g=u?u[m||0].nodes:h,b=[];for(const M of g)b.push(pD(h[M],c,o));return function(M,P,v){const T={},I=new Set;for(let E=0;E<M.length;E++){const C=v[P[E]];if(!C.extras)continue;const D=C.extras["mapbox:footprint:version"],O=C.extras["mapbox:footprint:id"];(D||O)&&I.add(E),D==="1.0.0"&&O&&(T[O]=E)}for(let E=0;E<M.length;E++){if(I.has(E))continue;const C=M[E],D=v[P[E]];if(!D.extras)continue;let O=null;C.id in T&&(O=f6(M[T[C.id]].meshes,C.matrix)),O||(O=d6(D)),O&&(C.footprint=h6(O))}if(I.size>0){const E=Array.from(I.values()).sort((C,D)=>C-D);for(let C=E.length-1;C>=0;C--)M.splice(E[C],1)}}(b,g,c.json.nodes),b}function p6(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const r=c.vertexArray.float32,o=c.aabb.min[0]-1,u=c.aabb.min[1]-1,m=Bh/(c.aabb.max[0]-o+2),h=Bh/(c.aabb.max[1]-u+2);for(let g=0;g<r.length;g+=3){const b=r[g+2],M=(r[g+0]-o)*m|0,P=(r[g+1]-u)*h|0;b>c.heightmap[P*Bh+M]&&(c.heightmap[P*Bh+M]=b)}}function m6(c,r){const o={};o.indexArray=new qi,o.indexArray.reserve(4*c.length),o.vertexArray=new cl,o.vertexArray.reserve(10*c.length),o.colorArray=new Cs,o.vertexArray.reserve(10*c.length);let u=0;for(const g of c){const b=Math.min(10,Math.max(4,1.3*g.height))*r,M=[-g.normal[1],g.normal[0],0],P=Math.min(.29,.1*g.width/g.depth),v=g.width-2*g.depth*r*(P+.01),T=be.vec3.scaleAndAdd([],g.pos,M,v/2),I=be.vec3.scaleAndAdd([],g.pos,M,-v/2),E=[T[0],T[1],T[2]+g.height],C=[I[0],I[1],I[2]+g.height],D=be.vec3.scaleAndAdd([],g.normal,M,P);be.vec3.scale(D,D,b);const O=be.vec3.scaleAndAdd([],g.normal,M,-P);be.vec3.scale(O,O,b),be.vec3.add(D,T,D),be.vec3.add(O,I,O),T[2]+=.1,I[2]+=.1,o.vertexArray.emplaceBack(D[0],D[1],D[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(T[0],T[1],T[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(E[0],E[1],E[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(T[0],T[1],T[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(D[0],D[1],D[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]);const F=v/b/2;o.colorArray.emplaceBack(-F-P,-1,F,.8),o.colorArray.emplaceBack(F+P,-1,F,.8),o.colorArray.emplaceBack(-F,0,F,1.3),o.colorArray.emplaceBack(F,0,F,1.3),o.colorArray.emplaceBack(F+P,-.8,F,.7),o.colorArray.emplaceBack(F+P,-.8,F,.7),o.colorArray.emplaceBack(0,0,F,1.3),o.colorArray.emplaceBack(0,0,F,1.3),o.colorArray.emplaceBack(F+P,-1.2,F,.8),o.colorArray.emplaceBack(F+P,-1.2,F,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const m={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=un.white,m.pbrMetallicRoughness=h,o.material=m,o.aabb=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}class gD{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const u=r[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const g6=["id","tile","layer","source","sourceLayer","state"];class _D{constructor(r,o,u,m,h){this.type="Feature",this._vectorTileFeature=r,this._z=o,this._x=u,this._y=m,this.properties=r.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of g6)this[o]!==void 0&&(r[o]=this[o]);return r}}class yD{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Wl(zt,16,0),this.featureIndexArray=new P0,this.promoteId=o,this.is3DTile=!1}insert(r,o,u,m,h,g=0,b=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,h,g);const P=this.grid;for(let v=0;v<o.length;v++){const T=o[v],I=[1/0,1/0,-1/0,-1/0];for(let E=0;E<T.length;E++){const C=T[E];I[0]=Math.min(I[0],C.x),I[1]=Math.min(I[1],C.y),I[2]=Math.max(I[2],C.x),I[3]=Math.max(I[3],C.y)}b!==0&&(I[0]-=b,I[1]-=b,I[2]+=b,I[3]+=b),I[0]<zt&&I[1]<zt&&I[2]>=0&&I[3]>=0&&P.insert(M,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kf.VectorTile(new K0(this.rawTileData)).layers,this.sourceLayerCoder=new gD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,o,u,m){this.loadVTLayers();const h=r.params||{},g=Oa(h.filter),b=r.tileResult,M=r.transform,P=b.bufferedTilespaceBounds,v=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(C,D,O,F)=>ha(b.bufferedTilespaceGeometry,C,D,O,F));v.sort(_6);let T=null;M.elevation&&v.length>0&&(T=Uf.create(M.elevation,this.tileID));const I={};let E;for(let C=0;C<v.length;C++){const D=v[C];if(D===E)continue;E=D;const O=this.featureIndexArray.get(D);let F=null;if(this.is3DTile){const V=this.bucketLayerIDs[0][0],W=o[V];if(W.type!=="model")continue;const{queryFeature:B,intersectionZ:H}=W.queryIntersectsMatchingFeature(b,O.featureIndex,g,M);B&&this.appendToResult(I,V,O.featureIndex,B,H)}else this.loadMatchingFeature(I,O,g,h.layers,h.availableImages,o,u,m,(V,W,B,H=0)=>(F||(F=wt(V,this.tileID.canonical,r.tileTransform)),W.queryIntersectsFeature(b,V,B,F,this.z,r.transform,r.pixelPosMatrix,T,H)))}return I}loadMatchingFeature(r,o,u,m,h,g,b,M,P){const{featureIndex:v,bucketIndex:T,sourceLayerIndex:I,layoutVertexArrayOffset:E}=o,C=this.bucketLayerIDs[T];if(m&&!function(V,W){for(let B=0;B<V.length;B++)if(W.indexOf(V[B])>=0)return!0;return!1}(m,C))return;const D=this.sourceLayerCoder.decode(I),O=this.vtLayers[D].feature(v);if(u.needGeometry){const V=Et(O,!0);if(!u.filter(new qn(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!u.filter(new qn(this.tileID.overscaledZ),O))return;const F=this.getId(O,D);for(let V=0;V<C.length;V++){const W=C[V];if(m&&m.indexOf(W)<0)continue;const B=g[W];if(!B)continue;let H={};F!==void 0&&M&&(H=M.getState(B.sourceLayer||"_geojsonTileLayer",F));const Z=!P||P(O,B,H,E);if(!Z)continue;const re=new _D(O,this.z,this.x,this.y,F),de=hi({},b[W]);de.paint=vD(de.paint,B.paint,O,H,h),de.layout=vD(de.layout,B.layout,O,H,h),re.layer=de,this.appendToResult(r,W,v,re,Z)}}appendToResult(r,o,u,m,h){let g=r[o];g===void 0&&(g=r[o]=[]),g.push({featureIndex:u,feature:m,intersectionZ:h})}lookupSymbolFeatures(r,o,u,m,h,g,b,M){const P={};this.loadVTLayers();const v=Oa(h);for(const T of r)this.loadMatchingFeature(P,{bucketIndex:u,sourceLayerIndex:m,featureIndex:T,layoutVertexArrayOffset:0},v,g,b,M,o);return P}loadFeature(r){const{featureIndex:o,sourceLayerIndex:u}=r;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),h=this.vtFeatures[m];if(h[o])return h[o];const g=this.vtLayers[m].feature(o);return h[o]=g,g}hasLayer(r){for(const o of this.bucketLayerIDs)for(const u of o)if(r===u)return!0;return!1}getId(r,o){let u=r.id;if(this.promoteId){const m=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];m!=null&&(u=r.properties[m]),typeof u=="boolean"&&(u=Number(u))}return u}}function vD(c,r,o,u,m){return kr(c,(h,g)=>{const b=r instanceof Kc?r.get(g):null;return b&&b.evaluate?b.evaluate(o,u,m):b})}function _6(c,r){return r-c}Zt(yD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const xD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bS{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const h=xD[15&u];if(!h)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new bS(b,g,h,r)}constructor(r,o=64,u=Float64Array,m){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const h=xD.indexOf(this.ArrayType),g=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-b%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+M,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+M),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+M,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=o,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return wS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:b}=this,M=[0,h.length-1,0],P=[];for(;M.length;){const v=M.pop()||0,T=M.pop()||0,I=M.pop()||0;if(T-I<=b){for(let O=I;O<=T;O++){const F=g[2*O],V=g[2*O+1];F>=r&&F<=u&&V>=o&&V<=m&&P.push(h[O])}continue}const E=I+T>>1,C=g[2*E],D=g[2*E+1];C>=r&&C<=u&&D>=o&&D<=m&&P.push(h[E]),(v===0?r<=C:o<=D)&&(M.push(I),M.push(E-1),M.push(1-v)),(v===0?u>=C:m>=D)&&(M.push(E+1),M.push(T),M.push(1-v))}return P}within(r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:h,nodeSize:g}=this,b=[0,m.length-1,0],M=[],P=u*u;for(;b.length;){const v=b.pop()||0,T=b.pop()||0,I=b.pop()||0;if(T-I<=g){for(let O=I;O<=T;O++)wD(h[2*O],h[2*O+1],r,o)<=P&&M.push(m[O]);continue}const E=I+T>>1,C=h[2*E],D=h[2*E+1];wD(C,D,r,o)<=P&&M.push(m[E]),(v===0?r-u<=C:o-u<=D)&&(b.push(I),b.push(E-1),b.push(1-v)),(v===0?r+u>=C:o+u>=D)&&(b.push(E+1),b.push(T),b.push(1-v))}return M}}function wS(c,r,o,u,m,h){if(m-u<=o)return;const g=u+m>>1;bD(c,r,g,u,m,h),wS(c,r,o,u,g-1,1-h),wS(c,r,o,g+1,m,1-h)}function bD(c,r,o,u,m,h){for(;m>u;){if(m-u>600){const P=m-u+1,v=o-u+1,T=Math.log(P),I=.5*Math.exp(2*T/3),E=.5*Math.sqrt(T*I*(P-I)/P)*(v-P/2<0?-1:1);bD(c,r,o,Math.max(u,Math.floor(o-v*I/P+E)),Math.min(m,Math.floor(o+(P-v)*I/P+E)),h)}const g=r[2*o+h];let b=u,M=m;for(jg(c,r,u,o),r[2*m+h]>g&&jg(c,r,u,m);b<M;){for(jg(c,r,b,M),b++,M--;r[2*b+h]<g;)b++;for(;r[2*M+h]>g;)M--}r[2*u+h]===g?jg(c,r,u,M):(M++,jg(c,r,M,m)),M<=o&&(u=M+1),o<=M&&(m=M-1)}}function jg(c,r,o,u){SS(c,o,u),SS(r,2*o,2*u),SS(r,2*o+1,2*u+1)}function SS(c,r,o){const u=c[r];c[r]=c[o],c[o]=u}function wD(c,r,o,u){const m=c-o,h=r-u;return m*m+h*h}a.$=v0,a.A=class extends gv{},a.B=Ul,a.C=Pc,a.D=Eh,a.E=Ic,a.F=Fm,a.G=of,a.H=u0,a.I=Hw,a.J=lf,a.K=_f,a.L=m0,a.M=bh,a.N=Xd,a.O=ph,a.P=lt,a.Q=fh,a.R=Ec,a.S=ko,a.T=iS,a.U=cm,a.V=gv,a.W=qm,a.X=af,a.Y=zm,a.Z=function(c){const r=c.value;let o=[];if(!r)return o;const u=Ul(r);return u!=="string"?(o=o.concat([new gv(c.key,r,`string expected, "${u}" found`)]),o):(RA(r,!0)||(o=o.concat([new gv(c.key,r,`invalid url "${r}"`)])),o)},a._=He,a.a=function(c){return Re.API_CDN_URL_REGEX.test(c)},a.a$=rg,a.a0=Ln,a.a1=Pt,a.a2=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return Go(c.expression.evaluate(r))}interpolate(c,r,o){return{x:ur(c.x,r.x,o),y:ur(c.y,r.y,o),z:ur(c.z,r.z,o),azimuthal:ur(c.azimuthal,r.azimuthal,o),polar:ur(c.polar,r.polar,o)}}},a.a3=qn,a.a4=rs,a.a5=$e,a.a6=be,a.a7=Po,a.a8=Kc,a.a9=lu,a.aA=Sn,a.aB=vA,a.aC=EA,a.aD=yA,a.aE=function(c,r){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){r(null,o)};for(let u=0;u<c.length;u++){const m=document.createElement("source");ua(c[u])||(o.crossOrigin="Anonymous"),m.src=c[u],o.appendChild(m)}return{cancel:()=>{}}},a.aF=hv,a.aG=function(c){return fetch(c).then(r=>r.arrayBuffer()).then(r=>fD(r,0,c))},a.aH=mD,a.aI=class{constructor(c,r,o,u){this.id=c,this.position=r!=null?new $(r[0],r[1]):new $(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,r){if(be.mat4.multiply(c.matrix,r,c.matrix),c.meshes)for(const o of c.meshes){const u=Tn.applyTransformFast(o.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const o of c.children)this._applyTransformations(o,c.matrix)}computeBoundsAndApplyParent(){const c=be.mat4.identity([]);for(const r of this.nodes)this._applyTransformations(r,c)}computeModelMatrix(c,r,o,u,m,h,g=!1){FA(this.matrix,this,c.transform,this.position,r,o,u,m,h,g)}upload(c){if(!this.uploaded){for(const r of this.nodes)cS(r,c);for(const r of this.nodes)_v(r);this.uploaded=!0}}destroy(){for(const c of this.nodes)uS(c)}},a.aJ=sa,a.aK=Mg,a.aL=xe,a.aM=ve,a.aN=ll,a.aO=qi,a.aP=kn,a.aQ=Cf,a.aR=cv,a.aS=function(){Lo.isLoading()||Lo.isLoaded()||Wm()!=="deferred"||Gm()},a.aT=Oa,a.aU=Et,a.aV=_D,a.aW=th,a.aX=Bw,a.aY=Iw,a.aZ=wt,a.a_=sl,a.aa=ur,a.ab=zt,a.ac=sh,a.ad=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return function([o,u]){const m=Go([1,o,u]);return{x:m.x,y:m.y,z:m.z}}(c.expression.evaluate(r))}interpolate(c,r,o){return{x:ur(c.x,r.x,o),y:ur(c.y,r.y,o),z:ur(c.z,r.z,o)}}},a.ae=function(c,r,o=0,u=!0){const m=new lt(o,o),h=c.sub(m),g=r.add(m),b=[h,new lt(g.x,h.y),g,new lt(h.x,g.y)];return u&&b.push(h.clone()),b},a.af=function(c,r){const o=[];for(let u=0;u<c.length;u++){const m=ao(u-1,-1,c.length-1),h=ao(u+1,-1,c.length-1),g=c[u],b=c[h],M=c[m].sub(g).unit(),P=b.sub(g).unit(),v=P.angleWithSep(M.x,M.y),T=M.add(P).unit().mult(-1*r/Math.sin(v/2));o.push(g.add(T))}return o},a.ag=iA,a.ah=ha,a.ai=function(c,r,o=0){return be.vec3.fromValues(((r.x-o)*c.scale-c.x)*zt,(r.y*c.scale-c.y)*zt,Ie(r.z,r.y))},a.aj=Ds,a.ak=TP,a.al=function(c){let r=1/0,o=1/0,u=-1/0,m=-1/0;for(const h of c)r=Math.min(r,h.x),o=Math.min(o,h.y),u=Math.max(u,h.x),m=Math.max(m,h.y);return{min:new lt(r,o),max:new lt(u,m)}},a.am=fe,a.an=Cn,a.ao=pt,a.ap=hr,a.aq=n,a.ar=function(c,r){const o={};for(let u=0;u<r.length;u++){const m=r[u];m in c&&(o[m]=c[m])}return o},a.as=Y,a.at=ge,a.au=class{constructor(c){this.entries={},this.scheduler=c}request(c,r,o,u){const m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){const[h,g]=m.result;return this.scheduler?this.scheduler.add(()=>{u(h,g)},r):u(h,g),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=o((h,g)=>{m.result=[h,g];for(const b of m.callbacks)this.scheduler?this.scheduler.add(()=>{b(h,g)},r):b(h,g);setTimeout(()=>delete this.entries[c],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(h=>h!==u),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},a.av=S0,a.aw=function(c,r,o){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},m=>{const h=Mc(c.request,(g,b,M,P)=>{g?m(g):b&&m(null,{vectorTile:o?void 0:new kf.VectorTile(new K0(b)),rawData:b,cacheControl:M,expires:P})});return()=>{h.cancel(),m()}},r)},a.ax=function(c){Si++,Si>cn&&(c.getActor().send("enforceCacheSizeLimit",xr),Si=0)},a.ay=Ut,a.az=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},a.b=function(c){return Re.API_FONTS_REGEX.test(c)},a.b$=function(c){const{x:r,y:o}=c.point,{lng:u,lat:m}=c._center;return gI(r,o,c.worldSize,u,m)},a.b0=fa,a.b1=Zn,a.b2=dg,a.b3=tS,a.b4=function(c,r){const o=lu(r.zoom);if(o===0)return fl(c);const u=F0(c),m=vw(u),h=fe(u.getWest())*r.worldSize,g=fe(u.getEast())*r.worldSize,b=ge(u.getNorth())*r.worldSize,M=ge(u.getSouth())*r.worldSize,P=[h,b,0],v=[g,b,0],T=[h,M,0],I=[g,M,0],E=be.mat4.invert([],r.globeMatrix);return be.vec3.transformMat4(P,P,E),be.vec3.transformMat4(v,v,E),be.vec3.transformMat4(T,T,E),be.vec3.transformMat4(I,I,E),m[0]=Jl(m[0],T,o),m[1]=Jl(m[1],I,o),m[2]=Jl(m[2],v,o),m[3]=Jl(m[3],P,o),Tn.fromPoints(m)},a.b5=N0,a.b6=ug,a.b7=Jl,a.b8=bf,a.b9=zo,a.bA=ao,a.bB=sr,a.bC=Fl,a.bD=he,a.bE=function(c,r,o){c[4*r+0]=o[0],c[4*r+1]=o[1],c[4*r+2]=o[2],c[4*r+3]=o[3]},a.bF=Oh,a.bG=ns,a.bH=ag,a.bI=ho,a.bJ=Yl,a.bK=$,a.bL=cA,a.bM=Ei,a.bN=su,a.bO=CA,a.bP=Oi,a.bQ=fI,a.bR=function(c,r,o,u,m,h,g,b,M){if(M.name==="globe")return fI(c,r,new Oi(o,u,m),!1);const P=Mg({z:o,x:u,y:m},M);return new Tn([(h+P.x/P.scale)*r,r*(P.y/P.scale),g],[(h+P.x2/P.scale)*r,r*(P.y2/P.scale),b])},a.bS=function(c,r,o){let u=0;for(let m=0;m<2;++m)c[m]>0&&(u+=(c[m]-0)*(c[m]-0)),r[m]<0&&(u+=(0-r[m])*(0-r[m]));return u},a.bT=Ee,a.bU=p,a.bV=function(c){const r=be.mat4.identity(new Float64Array(16));be.mat4.multiply(r,c.pixelMatrix,c.globeMatrix);const o=[0,A,0],u=[0,k,0];return be.vec3.transformMat4(o,o,r),be.vec3.transformMat4(u,u,r),[o[0]>0&&o[0]<=c.width&&o[1]>0&&o[1]<=c.height&&!ww(c,new $(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!ww(c,new $(c.center.lat,-90))]},a.bW=function(c,r){const{scale:o}=c.tileTransform,u=o*zt/(c.tileSize*Math.pow(2,r.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return be.mat2.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},a.bX=pv,a.bY=MA,a.bZ=function(c){const r=MA(c,!0);return be.mat2.invert([],[r[0],r[1],r[4],r[5]])},a.b_=dl,a.ba=mS,a.bb=K0,a.bc=Mc,a.bd=function(c){const r=[];for(const o in c)r.push(c[o]);return r},a.be=function(c,r){const o=[];for(const u in c)u in r||o.push(u);return o},a.bf=so,a.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bh=Lr,a.bi=function(c,r){const{x:o,y:u}=c.point,m=gI(o,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return be.mat4.multiply(m,m,xw(fl(r)))},a.bj=Of,a.bk=za,a.bl=X0,a.bm=function(c,r,o,u,m){const h=5*r+2;c.float32[h+0]=o,c.float32[h+1]=u,c.float32[h+2]=m},a.bn=lv,a.bo=qP,a.bp=kt,a.bq=ro,a.br=YI,a.bs=DA,a.bt=eP,a.bu=tP,a.bv=Yw,a.bw=eA,a.bx=Gw,a.by=bS,a.bz=un,a.c=Ue,a.c$=wo,a.c0=Hr,a.c1=bo,a.c2=s,a.c3=function(c){const r=Math.round((c+45+360)%360/90)%4;return mn[r]},a.c4=45,a.c5=Q,a.c6=Af,a.c7=function(c,r,o){const u=Math.sqrt(c*c+r*r+o*o),m=u>0?Math.acos(o/u)*Kr:0;let h=c!==0||r!==0?Math.atan2(-r,-c)*Kr+90:0;return h<0&&(h+=360),[u,h,m]},a.c8=De,a.c9=Tn,a.cA=function(c){const r=Ee-5;c=hr(c,-r,r)/r*90;const o=Math.pow(Math.abs(Math.sin(sr(c))),3);return Math.round(o*(w.length-1))},a.cB=function(c,r,o,u){const m=r.getNorth(),h=r.getSouth(),g=r.getWest(),b=r.getEast(),M=1<<c.z,P=b-g,v=m-h,T=P/x,I=-v/w[o],E=[0,T,0,I,0,0,m,g,0];if(c.z>0){const C=180/u;be.mat3.multiply(E,E,[C/P+1,0,0,0,C/v+1,0,-.5*C/T,.5*C/I,1])}return E[2]=M,E[5]=c.x,E[8]=c.y,E},a.cC=fl,a.cD=function(c,r,o){const u=be.mat4.identity(new Float64Array(16)),m=(r/(1<<c)-.5)*Math.PI*2;return be.mat4.rotateY(u,o.globeMatrix,m),Float32Array.from(u)},a.cE=class{isDataAvailableAtPoint(c){const r=this._source();if(this.isUsingMockSource()||!r||c.y<0||c.y>1)return!1;const o=r.getSource().maxzoom,u=1<<o,m=Math.floor(c.x),h=Math.floor((c.x-m)*u),g=Math.floor(c.y*u),b=this.findDEMTileFor(new Sn(o,m,o,h,g));return!(!b||!b.dem)}getAtPointOrZero(c,r=0){return this.getAtPoint(c,r)||0}getAtPoint(c,r,o=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||c.y<0||c.y>1)return r;const m=u.getSource().maxzoom,h=1<<m,g=Math.floor(c.x),b=c.x-g,M=new Sn(m,g,m,Math.floor(b*h),Math.floor(c.y*h)),P=this.findDEMTileFor(M);if(!P||!P.dem)return r;const v=P.dem,T=1<<P.tileID.canonical.z,I=(b*T-P.tileID.canonical.x)*v.dim,E=(c.y*T-P.tileID.canonical.y)*v.dim,C=Math.floor(I),D=Math.floor(E);return(o?this.exaggeration():1)*ur(ur(v.get(C,D),v.get(C,D+1),E-D),ur(v.get(C+1,D),v.get(C+1,D+1),E-D),I-C)}getAtTileOffset(c,r,o){const u=1<<c.canonical.z;return this.getAtPointOrZero(new $e(c.wrap+(c.canonical.x+r/zt)/u,(c.canonical.y+o/zt)/u))}getAtTileOffsetFunc(c,r,o,u){return m=>{const h=this.getAtTileOffset(c,m.x,m.y),g=u.upVector(c.canonical,m.x,m.y),b=u.upVectorScale(c.canonical,r,o).metersToTile;return be.vec3.scale(g,g,h*b),g}}getForTilePoints(c,r,o,u){if(this.isUsingMockSource())return!1;const m=Uf.create(this,c,u);return!!m&&(r.forEach(h=>{h[2]=this.exaggeration()*m.getElevationAt(h[0],h[1],o)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(c);if(!r||!r.dem)return null;const o=r.dem.tree,u=r.tileID,m=1<<c.canonical.z-u.canonical.z;let h=c.canonical.x/m-u.canonical.x,g=c.canonical.y/m-u.canonical.y,b=0;for(let M=0;M<c.canonical.z-u.canonical.z&&!o.leaves[b];M++){h*=2,g*=2;const P=2*Math.floor(g)+Math.floor(h);b=o.childOffsets[b]+P,h%=1,g%=1}return{min:this.exaggeration()*o.minimums[b],max:this.exaggeration()*o.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,r,o){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let r=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const m of c){const h=this.getMinMaxForTile(m.tileID);h&&(o=Math.min(o,h.min),u=Math.max(u,h.max),r=!0)}return r?{min:o,max:u}:null}},a.cF=PI,a.cG=Kl,a.cH=function(c,r){return[Math.pow(c[0],2.2)*r,Math.pow(c[1],2.2)*r,Math.pow(c[2],2.2)*r]},a.cI=mI,a.cJ=Se,a.cK=ae,a.cL=256,a.cM=function(c,r){const o=[0,0,0],u=N0(fl(r.canonical));return be.vec3.transformMat4(o,o,u),be.vec3.transformMat4(o,o,c),o},a.cN=c=>({u_camera_to_center_distance:new ho(c),u_extrude_scale:new lg(c),u_device_pixel_ratio:new ho(c),u_matrix:new Oh(c),u_inv_rot_matrix:new Oh(c),u_merc_center:new ns(c),u_tile_id:new ag(c),u_zoom_transition:new ho(c),u_up_dir:new ag(c),u_emissive_strength:new ho(c)}),a.cO=c=>({u_matrix:new Oh(c),u_pixels_to_tile_units:new lg(c),u_device_pixel_ratio:new ho(c),u_units_to_pixels:new ns(c),u_dash_image:new Yl(c),u_gradient_image:new Yl(c),u_image_height:new ho(c),u_texsize:new ns(c),u_tile_units_to_pixels:new ho(c),u_alpha_discard_threshold:new ho(c),u_trim_offset:new ns(c),u_trim_fade_range:new ns(c),u_trim_color:new Af(c),u_emissive_strength:new ho(c)}),a.cP=c=>({u_matrix:new Oh(c),u_texsize:new ns(c),u_pixels_to_tile_units:new lg(c),u_device_pixel_ratio:new ho(c),u_image:new Yl(c),u_units_to_pixels:new ns(c),u_tile_units_to_pixels:new ho(c),u_alpha_discard_threshold:new ho(c),u_trim_offset:new ns(c)}),a.cQ=xo,a.cR=NN,a.cS=UN,a.cT=vI,a.cU=(c,r,o,u,m,h)=>{const g=c.transform,b=g.projection.name==="globe";let M;if(h.paint.get("circle-pitch-alignment")==="map")if(b){const v=mI(g.zoom,r.canonical)*g._pixelsPerMercatorPixel;M=Float32Array.from([v,0,0,v])}else M=g.calculatePixelsToTileUnitsMatrix(o);else M=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(g.projection),u_matrix:c.translatePosMatrix(r.projMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:jt.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:$5,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(b){P.u_inv_rot_matrix=u,P.u_merc_center=m,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=lu(g.zoom);const v=m[0]*zt,T=m[1]*zt;P.u_up_dir=g.projection.upVector(new Oi(0,0,0),v,T)}return P},a.cV=CP,a.cW=(c,r,o,u,m,h)=>{const g=c.transform;return{u_matrix:MP(c,r,o,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:g.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:m,u_image:0,u_tile_units_to_pixels:EP(r,g),u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},a.cX=(c,r,o,u,m,h,g)=>{const b=c.transform,M=b.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:MP(c,r,o,u),u_pixels_to_tile_units:M,u_device_pixel_ratio:h,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:IP(o)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:EP(r,c.transform),u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength")}},a.cY=aa,a.cZ=hg,a.c_=pP,a.ca=Go,a.cb=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},a.cc=function(c){return c({pluginStatus:Ni,pluginURL:al}),$m.on("pluginStateChange",c),c},a.cd=jf,a.ce=xv,a.cf=zf,a.cg=qw,a.ch=im,a.ci=y0,a.cj=vr,a.ck=Do,a.cl=On,a.cm=function(c){const r=c.indexOf(Qc);return r>=0?c.slice(0,r):c},a.cn=function(c){return c.indexOf(Qc)>=0},a.co=function(c){const r=c.indexOf(Qc);return r>=0?c.slice(r+1):""},a.cp=function(c){const r=[],o=c.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),c.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},a.cq=function(c,r,o,u){return c.type==="custom"?new _2(c,r):new I2[c.type](c,r,o,u)},a.cr=Mn,a.cs=$m,a.ct=ih,a.cu=sg,a.cv=class extends As{constructor(c){super(c),this.current=dw}set(c,r,o){if(this.fetchUniformLocation(c,r)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.cw=Er,a.cx=function(c,r,o){const u=lu(o.zoom),m=c.style.map._antialias,h=r.options.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return u===0&&!m&&!h},a.cy=function(c){const r=c.pixelsPerMeter,o=r/he(1,c.center.lat),u=be.mat4.identity(new Float64Array(16));return be.mat4.translate(u,u,[c.point.x,c.point.y,0]),be.mat4.scale(u,u,[o,o,r]),Float32Array.from(u)},a.cz=F0,a.d=function(c){return Re.API_TILEJSON_REGEX.test(c)},a.d$=N,a.d0=Y0,a.d1=uu,a.d2=450,a.d3=7,a.d4=g2,a.d5=en,a.d6=Ef,a.d7=256,a.d8=xw,a.d9=cl,a.dA=_I,a.dB=function(c){const r=[0,0,0],o=be.mat4.identity(new Float64Array(16));return be.mat4.multiply(o,c.pixelMatrix,c.globeMatrix),be.vec3.transformMat4(r,r,o),new lt(r[0],r[1])},a.dC=function(c,r,o=!1){if(Ni===Sh||Ni===Th||Ni===mf)throw new Error("setRTLTextPlugin cannot be called multiple times.");al=jt.resolveURL(c),Ni=Sh,Yc=r,Vm(),o||Gm()},a.dD=Wm,a.dE=function(){xv().acquire(gS)},a.dF=function(){const c=Bg;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(gS),Bg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dG=Fg,a.dH=function(c){const r=Un();if(!r)return;const o=r.delete(wr);c&&o.catch(c).then(()=>c())},a.dI=zg,a.dJ=aD,a.dK=function(c){_S=jt.resolveURL(c),Wf||(Wf=new jf(xv(),new Ic)),Wf.broadcast("setDracoUrl",_S)},a.dL=sD,a.dM=function(c){$f=jt.resolveURL(c),Wf||(Wf=new jf(xv(),new Ic)),Wf.broadcast("setMeshoptUrl",$f)},a.dN=Zt,a.dO=cu,a.dP=ks,a.dQ=gD,a.dR=yD,a.dS=xP,a.dT=kr,a.dU=YP,a.dV=function(c,r,o,u,m,h,g,b,M,P,v){c.createArrays(),c.tilePixelRatio=zt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const T=c.layers[0].layout,I=c.layers[0]._unevaluatedLayout._values,E={};if(c.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:V}=c.textSizeData;E.compositeTextSizes=[I["text-size"].possiblyEvaluate(new qn(F),b),I["text-size"].possiblyEvaluate(new qn(V),b)]}if(c.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:V}=c.iconSizeData;E.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new qn(F),b),I["icon-size"].possiblyEvaluate(new qn(V),b)]}E.layoutTextSize=I["text-size"].possiblyEvaluate(new qn(M+1),b),E.layoutIconSize=I["icon-size"].possiblyEvaluate(new qn(M+1),b),E.textMaxSize=I["text-size"].possiblyEvaluate(new qn(18),b);const C=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",D=T.get("text-size");let O=!1;for(const F of c.features)if(F.icon&&F.icon.nameSecondary){O=!0;break}for(const F of c.features){const V=T.get("text-font").evaluate(F,{},b).join(","),W=D.evaluate(F,{},b),B=E.layoutTextSize.evaluate(F,{},b),H=(E.layoutIconSize.evaluate(F,{},b),{horizontal:{},vertical:void 0}),Z=F.text;let re,de=[0,0];if(Z){const Te=Z.toString(),_e=T.get("text-letter-spacing").evaluate(F,{},b)*ro,Ce=T.get("text-line-height").evaluate(F,{},b)*ro,Oe=ew(Te)?_e:0,Fe=T.get("text-anchor").evaluate(F,{},b),Be=T.get("text-variable-anchor");if(!Be){const mt=T.get("text-radial-offset").evaluate(F,{},b);de=mt?eA(Fe,[mt*ro,Zw]):T.get("text-offset").evaluate(F,{},b).map(tt=>tt*ro)}let Ne=C?"center":T.get("text-justify").evaluate(F,{},b);const qe=T.get("symbol-placement")==="point",Ve=qe?T.get("text-max-width").evaluate(F,{},b)*ro:1/0,ot=mt=>{c.allowVerticalPlacement&&df(Te)&&(H.vertical=Ww(Z,r,o,m,V,Ve,Ce,Fe,mt,Oe,de,za.vertical,!0,B,W))};if(!C&&Be){const mt=Ne==="auto"?Be.map(Nt=>Yw(Nt)):[Ne];let tt=!1;for(let Nt=0;Nt<mt.length;Nt++){const Ot=mt[Nt];if(!H.horizontal[Ot])if(tt)H.horizontal[Ot]=H.horizontal[0];else{const St=Ww(Z,r,o,m,V,Ve,Ce,"center",Ot,Oe,de,za.horizontal,!1,B,W);St&&(H.horizontal[Ot]=St,tt=St.positionedLines.length===1)}}ot("left")}else{if(Ne==="auto"&&(Ne=Yw(Fe)),qe||T.get("text-writing-mode").indexOf("horizontal")>=0||!df(Te)){const mt=Ww(Z,r,o,m,V,Ve,Ce,Fe,Ne,Oe,de,za.horizontal,!1,B,W);mt&&(H.horizontal[Ne]=mt)}ot(qe?"left":Ne)}}let me=!1;if(F.icon&&F.icon.namePrimary){const Te=u[F.icon.namePrimary];Te&&(re=XN(m[F.icon.namePrimary],F.icon.nameSecondary?m[F.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(F,{},b),T.get("icon-anchor").evaluate(F,{},b)),me=Te.sdf,c.sdfIcons===void 0?c.sdfIcons=Te.sdf:c.sdfIcons!==Te.sdf&&Gr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==c.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const ue=rA(H.horizontal)||H.vertical;c.iconsInText||(c.iconsInText=!!ue&&ue.iconsInText),(ue||re)&&n2(c,F,H,re,u,E,B,0,de,me,g,b,P,v,O)}h&&c.generateCollisionDebugBuffers(M,c.collisionBoxArray)},a.dW=kf,a.dX=vv,a.dY=pr,a.dZ=GI,a.d_=OP,a.da=Ps,a.db=tg,a.dc=function(c,r,o,u,m){return hr((c-r)/(o-r)*(m-u)+u,u,m)},a.dd=nf,a.de=ze,a.df=class{constructor(c,r,o,u){this.context=c,this.format=u,this.size=o,this.texture=c.gl.createTexture();const[m,h,g]=this.size,{gl:b}=c;b.bindTexture(b.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,m,h,g,0,rS(this.format),nS(this.format),r.data)}bind(c,r){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},a.dg=sS,a.dh=[1,1,1],a.di=Uf,a.dj=Nf,a.dk=ul,a.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,r=!1){const o=KI(new lt(0,0),new lt(zt,zt),c),u=[];if(r&&!kw(o,this._globalClipBounds))return u;for(const m of this._activeRegions){if(m.hiddenByOverlap||!kw(o,m))continue;const h=dN(m.min,m.max,c);u.push({min:h.min,max:h.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(c){this._setSources(c.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const o=[];for(const u of r.cache.getVisibleCoordinates()){const m=r.cache.getTile(u).buckets[r.layer];m&&m.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(c){const r=c.getFootprints();if(r.length===0)return;const o=c.getOrder(),u=c.getClipMask(),m=c.getClipScope();for(const h of r){if(!h.footprint)continue;const g=KI(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:o,clipMask:u,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,o)=>r.priority-o.priority||q0(r.min,o.min)||q0(r.max,o.max)||r.order-o.order||r.clipMask-o.clipMask||function(u,m){const h=(g,b)=>g+b;return u.length-m.length||u.reduce(h,"").localeCompare(m.reduce(h,""))}(r.clipScope,o.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let r=0;for(;!c&&r!==this._activeRegions.length;){const o=this._activeRegions[r],u=this._prevRegions[r];c=o.priority!==u.priority||!XI(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!Lr(o.clipScope,u.clipScope),++r}}if(c){++this._updateTime;for(const o of this._activeRegions)o.order!==H0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const r=o=>{const u=this._activeRegions;if(o>=u.length)return o;const m=u[o].priority;for(;o<u.length&&u[o].priority===m;)++o;return o};if(this._sourceIds.length>1){let o=0,u=r(o);for(;o!==u;){let m=o;const h=o;for(;m!==u;){const g=this._activeRegions[m];g.hiddenByOverlap=!1;for(let b=0;b<h;b++){const M=this._activeRegions[b];if(!M.hiddenByOverlap&&g.order===H0&&kw(g,M)&&(g.hiddenByOverlap=QI(g.footprint,g.tileId,M.footprint,M.tileId),g.hiddenByOverlap))break}++m}o=u,u=r(o)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=c.length-1;r>=0;r--)this._addSource(c[r]);this._computeReplacement()}},a.dm=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,r){const o=new sl,u=new qi,m=[],h=c+1+2,g=r[0]+1,b=r[0]+1+(1+r.length),M=(P,v,T)=>{let I=P===h-1?P-2:P===0?P:P-1;return I+=T?24575:0,[I,v]};for(let P=0;P<h;++P)o.emplaceBack(...M(P,0,!0));for(let P=0;P<g;++P)for(let v=0;v<h;++v)o.emplaceBack(...M(v,P,(v===0||v===h-1)&&!0));for(let P=0;P<r.length;++P){const v=r[P];for(let T=0;T<h;++T)o.emplaceBack(...M(T,v,!0))}for(let P=0;P<r.length;++P){const v=u.length,T=r[P]+1+2,I=new qi;for(let D=0;D<T-1;D++){const O=D===T-2,F=O?h*(b-r.length+P-D):h;for(let V=0;V<h-1;V++){const W=D*h+V;D===0||O||V===0||V===h-2?(I.emplaceBack(W+1,W,W+F),I.emplaceBack(W+F,W+F+1,W+1)):(u.emplaceBack(W+1,W,W+F),u.emplaceBack(W+F,W+F+1,W+1))}}const E=Zn.simpleSegment(0,v,o.length,u.length-v);for(let D=0;D<I.uint16.length;D+=3)u.emplaceBack(I.uint16[D],I.uint16[D+1],I.uint16[D+2]);const C=Zn.simpleSegment(0,v,o.length,u.length-v);m.push({withoutSkirts:E,withSkirts:C})}return{vertices:o,indices:u,segments:m}}_createGrid(c){const r=this._fillGridMeshWithLods(x,w);this._gridSegments=r.segments,this._gridBuffer=c.createVertexBuffer(r.vertices,fa.members),this._gridIndexBuffer=c.createIndexBuffer(r.indices,!0)}_createPoles(c){const r=new qi;for(let g=0;g<=x;g++)r.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(r,!0);const o=new Ps,u=new Ps,m=new Ps,h=new Ps;this._poleSegments=[];for(let g=0,b=0;g<s;g++){const M=360/(1<<g);o.emplaceBack(0,-n,0,.5,0),u.emplaceBack(0,-n,0,.5,1),m.emplaceBack(0,-n,0,.5,.5),h.emplaceBack(0,-n,0,.5,.5);for(let P=0;P<=x;P++){let v=P/x,T=0;const I=ur(0,M,v),[E,C,D]=L(j5,V5,I,n);o.emplaceBack(E,C,D,v,T),u.emplaceBack(E,C,D,v,1-T);const O=sr(I);v=.5+.5*Math.sin(O),T=.5+.5*Math.cos(O),m.emplaceBack(E,C,D,v,T),h.emplaceBack(E,C,D,v,1-T)}this._poleSegments.push(Zn.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(o,Jo,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,Jo,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,Jo,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,Jo,!1)}getGridBuffers(c,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},a.dn=H0,a.dp=Gi,a.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.dr=ai,a.ds=ke,a.dt=z,a.du=function([c,r,o]){const u=Math.hypot(c,r,o),m=Math.atan2(c,o),h=.5*Math.PI-Math.acos(-r/u);return new $(Hr(m),Hr(h))},a.dv=aS,a.dw=U,a.dx=function(c){const r=c.navigator?c.navigator.userAgent:null;return!!function(o){if(rh==null){const u=o.navigator?o.navigator.userAgent:null;rh=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return rh}(c)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.dy=function(c,r){xr=c,cn=r},a.dz=ww,a.e=Re,a.e0=function(c){let r=0;if(new Uint32Array(c,0,1)[0]!==cD){const o=new Uint32Array(c,0,7),[,,u,m,h,g]=o;r=o.byteLength+m+h+g+h,(u!==c.byteLength||r>=c.byteLength)&&Gr("Invalid b3dm header information.")}return fD(c,r)},a.e1=function(c,r){const o=mD(c);for(const u of o){for(const m of u.meshes)p6(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(m6(u.lights,r)))}return o},a.e2=yv,a.e3=$A,a.e4=Lo,a.e5=function(c){yi(),Ir!=null&&Ir.then(r=>{r.keys().then(o=>{for(let u=0;u<o.length-c;u++)r.delete(o[u])})})},a.f=function(c){return c.indexOf("mapbox:")===0},a.g=function(c,r){return ih(hi(c,{method:"GET"}),r)},a.h=Ae,a.i=function(c){return Re.API_STYLE_REGEX.test(c)&&!Ue(c)},a.j=function(c){return decodeURIComponent(atob(c).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(r,o)=>String.fromCharCode(+("0x"+o))))},a.l=hi,a.m=Hi,a.n=function(c,r){return ih(hi(c,{type:"json"}),r)},a.o=Ja,a.p=function(c,r){return ih(hi(c,{method:"POST"}),r)},a.q=jt,a.r=So,a.s=function(c){try{const r=self[c];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=ah,a.u=function(){return function c(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},a.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},a.w=Gr,a.x=el,a.y=2,a.z=ZP}),S(["./shared"],function(a){function N(Ke){const ee=Ke?Ke.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function G(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let ae="[";for(const Se of Ke)ae+=`${G(Se)},`;return`${ae}]`}let ee="{";for(const ae of Object.keys(Ke).sort())ee+=`${ae}:${G(Ke[ae])},`;return`${ee}}`}function q(Ke){let ee="";for(const ae of a.bg)ee+=`/${G(Ke[ae])}`;return ee}class X{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,ae){this._layerConfigs={},this._layers={},this.update(ee,[],ae)}update(ee,ae,Se){this._options=Se;for(const Ae of ee)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=a.cq(Ae,this.scope,null,this._options)).compileFilter(Se),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of ae)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const Re=function(Ae,Ue){const Ye={};for(let Xe=0;Xe<Ae.length;Xe++){const st=Ue&&Ue[Ae[Xe].id]||q(Ae[Xe]);Ue&&(Ue[Ae[Xe].id]=st);let it=Ye[st];it||(it=Ye[st]=[]),it.push(Ae[Xe])}const Ge=[];for(const Xe in Ye)Ge.push(Ye[Xe]);return Ge}(a.bd(this._layerConfigs),this.keyCache);for(const Ae of Re){const Ue=Ae.map(bt=>this._layers[bt.id]),Ye=Ue[0];if(Ye.visibility==="none")continue;const Ge=Ye.source||"";let Xe=this.familiesBySource[Ge];Xe||(Xe=this.familiesBySource[Ge]={});const st=Ye.sourceLayer||"_geojsonTileLayer";let it=Xe[st];it||(it=Xe[st]=[]),it.push(Ue)}}}const oe=1*a.dP;class te{constructor(ee){const ae={},Se=[];for(const Ye in ee){const Ge=ee[Ye],Xe=ae[Ye]={};for(const st in Ge.glyphs){const it=Ge.glyphs[+st];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;const bt=it.metrics.localGlyph?oe:1,Ut={x:0,y:0,w:it.bitmap.width+2*bt,h:it.bitmap.height+2*bt};Se.push(Ut),Xe[st]=Ut}}const{w:Re,h:Ae}=a.z(Se),Ue=new a.dO({width:Re||1,height:Ae||1});for(const Ye in ee){const Ge=ee[Ye];for(const Xe in Ge.glyphs){const st=Ge.glyphs[+Xe];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const it=ae[Ye][Xe],bt=st.metrics.localGlyph?oe:1;a.dO.copy(st.bitmap,Ue,{x:0,y:0},{x:it.x+bt,y:it.y+bt},st.bitmap)}}this.image=Ue,this.positions=ae}}a.dN(te,"GlyphAtlas");class ie{constructor(ee){this.tileID=new a.aA(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=a.aK(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep}parse(ee,ae,Se,Re,Ae){this.status="parsing",this.data=ee,this.collisionBoxArray=new a.aQ;const Ue=new a.dQ(Object.keys(ee.layers).sort()),Ye=new a.dR(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];const Ge={},Xe=new a.dS(256,256),st={featureIndex:Ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Xe,availableImages:Se,brightness:this.brightness},it=ae.familiesBySource[this.source];for(const xr in it){const cn=ee.layers[xr];if(!cn)continue;let gn=!1,Ir=!1,fn=!1;for(const Si of it[xr])Si[0].type==="symbol"?gn=!0:Ir=!0,Si[0].is3D()&&Si[0].type!=="model"&&(fn=!0);if(this.extraShadowCaster&&!fn||this.isSymbolTile===!0&&!gn||this.isSymbolTile===!1&&!Ir)continue;cn.version===1&&a.w(`Vector tile source "${this.source}" layer "${xr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Un=Ue.encode(xr),yi=[];for(let Si=0;Si<cn.length;Si++){const Hi=cn.feature(Si),Ca=Ye.getId(Hi,xr);yi.push({feature:Hi,id:Ca,index:Si,sourceLayerIndex:Un})}for(const Si of it[xr]){const Hi=Si[0];(!this.extraShadowCaster||Hi.is3D()&&Hi.type!=="model")&&(this.isSymbolTile!==void 0&&Hi.type==="symbol"!==this.isSymbolTile||Hi.minzoom&&this.zoom<Math.floor(Hi.minzoom)||Hi.maxzoom&&this.zoom>=Hi.maxzoom||Hi.visibility!=="none"&&(pe(Si,this.zoom,st.brightness,Se),(Ge[Hi.id]=Hi.createBucket({index:Ye.bucketLayerIDs.length,layers:Si,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Un,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(yi,st,this.tileID.canonical,this.tileTransform),Ye.bucketLayerIDs.push(Si.map(Ca=>Ca.id))))}}let bt,Ut,jt,_r;Xe.trim();const vr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},wr=()=>{if(bt)return this.status="done",Ae(bt);if(this.extraShadowCaster)this.status="done",Ae(null,{buckets:a.bd(Ge).filter(xr=>!xr.isEmpty()),featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ut&&jt&&_r){const xr=new te(Ut),cn=new a.dU(jt,_r,this.lut);for(const gn in Ge){const Ir=Ge[gn];Ir instanceof a.aR?(pe(Ir.layers,this.zoom,st.brightness,Se),a.dV(Ir,Ut,xr.positions,jt,cn.iconPositions,this.showCollisionBoxes,Se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Ir.hasPattern&&(Ir instanceof a.aX||Ir instanceof a.aY||Ir instanceof a.d0)&&(pe(Ir.layers,this.zoom,st.brightness,Se),Ir.addFeatures(st,this.tileID.canonical,cn.patternPositions,Se,this.tileTransform,this.brightness))}this.status="done",Ae(null,{buckets:a.bd(Ge).filter(gn=>!gn.isEmpty()),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xr.image,lineAtlas:Xe,imageAtlas:cn,brightness:st.brightness})}};if(!this.extraShadowCaster){const xr=a.dT(st.glyphDependencies,Ir=>Object.keys(Ir).map(Number));Object.keys(xr).length?Re.send("getGlyphs",{uid:this.uid,stacks:xr,scope:this.scope},(Ir,fn)=>{bt||(bt=Ir,Ut=fn,wr())},void 0,!1,vr):Ut={};const cn=Object.keys(st.iconDependencies);cn.length?Re.send("getImages",{icons:cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ir,fn)=>{bt||(bt=Ir,jt=fn,wr())},void 0,!1,vr):jt={};const gn=Object.keys(st.patternDependencies);gn.length?Re.send("getImages",{icons:gn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ir,fn)=>{bt||(bt=Ir,_r=fn,wr())},void 0,!1,vr):_r={}}wr()}}function pe(Ke,ee,ae,Se){const Re=new a.a3(ee,{brightness:ae});for(const Ae of Ke)Ae.recalculate(Re,Se)}class se extends a.E{constructor(ee,ae,Se,Re,Ae,Ue){super(),this.actor=ee,this.layerIndex=ae,this.availableImages=Se,this.loadVectorData=Ae||a.aw,this.loading={},this.loaded={},this.deduped=new a.au(ee.scheduler),this.isSpriteLoaded=Re,this.scheduler=ee.scheduler,this.brightness=Ue}loadTile(ee,ae){const Se=ee.uid,Re=ee&&ee.request,Ae=Re&&Re.collectResourceTiming,Ue=this.loading[Se]=new ie(ee);Ue.abort=this.loadVectorData(ee,(Ye,Ge)=>{const Xe=!this.loading[Se];if(delete this.loading[Se],Xe||Ye||!Ge)return Ue.status="done",Xe||(this.loaded[Se]=Ue),ae(Ye);const st=Ge.rawData,it={};Ge.expires&&(it.expires=Ge.expires),Ge.cacheControl&&(it.cacheControl=Ge.cacheControl),Ue.vectorTile=Ge.vectorTile||new a.dW.VectorTile(new a.bb(st));const bt=()=>{Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ut,jt)=>{if(Ut||!jt)return ae(Ut);const _r={};if(Ae){const vr=N(Re);vr.length>0&&(_r.resourceTiming=JSON.parse(JSON.stringify(vr)))}ae(null,a.l({rawTileData:st.slice(0)},jt,it,_r))})};this.isSpriteLoaded?bt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(bt,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):bt()}),this.loaded=this.loaded||{},this.loaded[Se]=Ue})}reloadTile(ee,ae){const Se=this.loaded,Re=ee.uid;if(Se&&Se[Re]){const Ae=Se[Re];Ae.showCollisionBoxes=ee.showCollisionBoxes,Ae.projection=ee.projection,Ae.brightness=ee.brightness,Ae.tileTransform=a.aK(ee.tileID.canonical,ee.projection),Ae.extraShadowCaster=ee.extraShadowCaster,Ae.lut=ee.lut;const Ue=(Ye,Ge)=>{const Xe=Ae.reloadCallback;Xe&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Xe)),ae(Ye,Ge)};Ae.status==="parsing"?Ae.reloadCallback=Ue:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Ue):Ue())}else ae(null,void 0)}abortTile(ee,ae){const Se=ee.uid,Re=this.loading[Se];Re&&(Re.abort&&Re.abort(),delete this.loading[Se]),ae()}removeTile(ee,ae){const Se=this.loaded,Re=ee.uid;Se&&Se[Re]&&delete Se[Re],ae()}}class le{loadTile(ee,ae){const{uid:Se,encoding:Re,rawImageData:Ae,padding:Ue}=ee,Ye=ImageBitmap&&Ae instanceof ImageBitmap?this.getImageData(Ae,Ue):Ae;ae(null,new a.dX(Se,Ye,Re,Ue<1))}getImageData(ee,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const Se=this.offscreenCanvasContext.getImageData(-ae,-ae,ee.width+2*ae,ee.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}a.ba.setPbf(a.bb);class ce{decodeRasterArray({task:ee,buffer:ae},Se){a.ba.performDecoding(ae,ee).then(Re=>{Se(null,Re)},Re=>{Se(Re)})}}const Me=a.dW.VectorTileFeature.prototype.toGeoJSON;class Le{constructor(ee){this._feature=ee,this.extent=a.ab,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ae of this._feature.geometry)ee.push([new a.P(ae[0],ae[1])]);return ee}{const ee=[];for(const ae of this._feature.geometry){const Se=[];for(const Re of ae)Se.push(new a.P(Re[0],Re[1]));ee.push(Se)}return ee}}toGeoJSON(ee,ae,Se){return Me.call(this,ee,ae,Se)}}class Je{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.ab,this.length=ee.length,this._features=ee}feature(ee){return new Le(this._features[ee])}}const Qe=64/4096,je=128;class Ct{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],ae){for(const Se of ee){const Re=Se.id;if(Re==null)continue;let Ae=this.features.get(Re);Ae&&this.updateCache(Ae,ae),Se.geometry?(Ae=et(Se),this.updateCache(Ae,ae),this.features.set(Re,Ae)):this.features.delete(Re),this.updateCache(Ae,ae)}}updateCache(ee,ae){for(const{canonical:Se,uid:Re}of Object.values(ae)){const{z:Ae,x:Ue,y:Ye}=Se;ye(ee,Math.pow(2,Ae),Ue,Ye)&&delete ae[Re]}}getTile(ee,ae,Se){const Re=Math.pow(2,ee),Ae=[];for(const Ue of this.features.values())ye(Ue,Re,ae,Se)&&Ae.push(yt(Ue,Re,ae,Se));return{features:Ae}}getFeatures(){return[...this.features.values()]}}function ye({minX:Ke,minY:ee,maxX:ae,maxY:Se},Re,Ae,Ue){return Ke<(Ae+1+Qe)/Re&&ee<(Ue+1+Qe)/Re&&ae>(Ae-Qe)/Re&&Se>(Ue-Qe)/Re}function et(Ke){const{id:ee,geometry:ae,properties:Se}=Ke;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:Ae}=ae,Ue={id:ee,type:1,geometry:[],tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Ue.geometry;if(Re==="Point")dt(Ae,Ye,Ue);else if(Re==="MultiPoint")for(const Ge of Ae)dt(Ge,Ye,Ue);else if(Re==="LineString")Ue.type=2,Xt(Ae,Ye,Ue);else if(Re==="MultiLineString")Ue.type=2,Mt(Ae,Ye,Ue);else if(Re==="Polygon")Ue.type=3,Mt(Ae,Ye,Ue,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ue.type=3;for(const Ge of Ae)Mt(Ge,Ye,Ue,!0)}return Ue}function dt([Ke,ee],ae,Se){const Re=a.am(Ke);let Ae=a.at(ee);Ae=Ae<0?0:Ae>1?1:Ae,ae.push(Re,Ae),Se.minX=Math.min(Se.minX,Re),Se.minY=Math.min(Se.minY,Ae),Se.maxX=Math.max(Se.maxX,Re),Se.maxY=Math.max(Se.maxY,Ae)}function Xt(Ke,ee,ae,Se=!1,Re=!1){const Ae=[];for(const Ue of Ke)dt(Ue,Ae,ae);ee.push(Ae),Se&&function(Ue,Ye){let Ge=0;for(let Xe=0,st=Ue.length,it=st-2;Xe<st;it=Xe,Xe+=2)Ge+=(Ue[Xe]-Ue[it])*(Ue[Xe+1]+Ue[it+1]);if(Ge>0===Ye)for(let Xe=0,st=Ue.length;Xe<st/2;Xe+=2){const it=Ue[Xe],bt=Ue[Xe+1];Ue[Xe]=Ue[st-2-Xe],Ue[Xe+1]=Ue[st-1-Xe],Ue[st-2-Xe]=it,Ue[st-1-Xe]=bt}}(Ae,Re)}function Mt(Ke,ee,ae,Se=!1){for(let Re=0;Re<Ke.length;Re++)Xt(Ke[Re],ee,ae,Se,Re===0)}function yt(Ke,ee,ae,Se){const{id:Re,type:Ae,geometry:Ue,tags:Ye}=Ke,Ge=[];if(Ae===1)(function(Xe,st,it,bt,Ut){for(let jt=0;jt<Xe.length;jt+=2){const _r=Math.round(a.ab*(Xe[jt+0]*st-it)),vr=Math.round(a.ab*(Xe[jt+1]*st-bt));Ut.push([_r,vr])}})(Ue,ee,ae,Se,Ge);else for(const Xe of Ue)gt(Xe,ee,ae,Se,Ge);return{id:Re,type:Ae,geometry:Ge,tags:Ye}}function gt(Ke,ee,ae,Se,Re){const Ae=-je,Ue=a.ab+je;let Ye;for(let Ge=0;Ge<Ke.length-2;Ge+=2){let Xe=Math.round(a.ab*(Ke[Ge+0]*ee-ae)),st=Math.round(a.ab*(Ke[Ge+1]*ee-Se)),it=Math.round(a.ab*(Ke[Ge+2]*ee-ae)),bt=Math.round(a.ab*(Ke[Ge+3]*ee-Se));const Ut=it-Xe,jt=bt-st;Xe<Ae&&it<Ae||(Xe<Ae?(st+=Math.round(jt*((Ae-Xe)/Ut)),Xe=Ae):it<Ae&&(bt=st+Math.round(jt*((Ae-Xe)/Ut)),it=Ae),st<Ae&&bt<Ae||(st<Ae?(Xe+=Math.round(Ut*((Ae-st)/jt)),st=Ae):bt<Ae&&(it=Xe+Math.round(Ut*((Ae-st)/jt)),bt=Ae),Xe>=Ue&&it>=Ue||(Xe>=Ue?(st+=Math.round(jt*((Ue-Xe)/Ut)),Xe=Ue):it>=Ue&&(bt=st+Math.round(jt*((Ue-Xe)/Ut)),it=Ue),st>=Ue&&bt>=Ue||(st>=Ue?(Xe+=Math.round(Ut*((Ue-st)/jt)),st=Ue):bt>=Ue&&(it=Xe+Math.round(Ut*((Ue-st)/jt)),bt=Ue),Ye&&Xe===Ye[Ye.length-1][0]&&st===Ye[Ye.length-1][1]||(Ye=[[Xe,st]],Re.push(Ye)),Ye.push([it,bt])))))}}var Ze,ht,Dt,Tt={exports:{}},tr=function(){if(Dt)return Tt.exports;Dt=1;var Ke=a.d_(),ee=function(){if(ht)return Ze;ht=1;var st=a.dY(),it=a.dZ().VectorTileFeature;function bt(jt,_r){this.options=_r||{},this.features=jt,this.length=jt.length}function Ut(jt,_r){this.id=typeof jt.id=="number"?jt.id:void 0,this.type=jt.type,this.rawGeometry=jt.type===1?[jt.geometry]:jt.geometry,this.properties=jt.tags,this.extent=_r||4096}return Ze=bt,bt.prototype.feature=function(jt){return new Ut(this.features[jt],this.options.extent)},Ut.prototype.loadGeometry=function(){var jt=this.rawGeometry;this.geometry=[];for(var _r=0;_r<jt.length;_r++){for(var vr=jt[_r],wr=[],xr=0;xr<vr.length;xr++)wr.push(new st(vr[xr][0],vr[xr][1]));this.geometry.push(wr)}return this.geometry},Ut.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var jt=this.geometry,_r=1/0,vr=-1/0,wr=1/0,xr=-1/0,cn=0;cn<jt.length;cn++)for(var gn=jt[cn],Ir=0;Ir<gn.length;Ir++){var fn=gn[Ir];_r=Math.min(_r,fn.x),vr=Math.max(vr,fn.x),wr=Math.min(wr,fn.y),xr=Math.max(xr,fn.y)}return[_r,wr,vr,xr]},Ut.prototype.toGeoJSON=it.prototype.toGeoJSON,Ze}();function ae(st){var it=new Ke;return function(bt,Ut){for(var jt in bt.layers)Ut.writeMessage(3,Se,bt.layers[jt])}(st,it),it.finish()}function Se(st,it){var bt;it.writeVarintField(15,st.version||1),it.writeStringField(1,st.name||""),it.writeVarintField(5,st.extent||4096);var Ut={keys:[],values:[],keycache:{},valuecache:{}};for(bt=0;bt<st.length;bt++)Ut.feature=st.feature(bt),it.writeMessage(2,Re,Ut);var jt=Ut.keys;for(bt=0;bt<jt.length;bt++)it.writeStringField(3,jt[bt]);var _r=Ut.values;for(bt=0;bt<_r.length;bt++)it.writeMessage(4,Xe,_r[bt])}function Re(st,it){var bt=st.feature;bt.id!==void 0&&it.writeVarintField(1,bt.id),it.writeMessage(2,Ae,st),it.writeVarintField(3,bt.type),it.writeMessage(4,Ge,bt)}function Ae(st,it){var bt=st.feature,Ut=st.keys,jt=st.values,_r=st.keycache,vr=st.valuecache;for(var wr in bt.properties){var xr=bt.properties[wr],cn=_r[wr];if(xr!==null){cn===void 0&&(Ut.push(wr),_r[wr]=cn=Ut.length-1),it.writeVarint(cn);var gn=typeof xr;gn!=="string"&&gn!=="boolean"&&gn!=="number"&&(xr=JSON.stringify(xr));var Ir=gn+":"+xr,fn=vr[Ir];fn===void 0&&(jt.push(xr),vr[Ir]=fn=jt.length-1),it.writeVarint(fn)}}}function Ue(st,it){return(it<<3)+(7&st)}function Ye(st){return st<<1^st>>31}function Ge(st,it){for(var bt=st.loadGeometry(),Ut=st.type,jt=0,_r=0,vr=bt.length,wr=0;wr<vr;wr++){var xr=bt[wr],cn=1;Ut===1&&(cn=xr.length),it.writeVarint(Ue(1,cn));for(var gn=Ut===3?xr.length-1:xr.length,Ir=0;Ir<gn;Ir++){Ir===1&&Ut!==1&&it.writeVarint(Ue(2,gn-1));var fn=xr[Ir].x-jt,Un=xr[Ir].y-_r;it.writeVarint(Ye(fn)),it.writeVarint(Ye(Un)),jt+=fn,_r+=Un}Ut===3&&it.writeVarint(Ue(7,1))}}function Xe(st,it){var bt=typeof st;bt==="string"?it.writeStringField(1,st):bt==="boolean"?it.writeBooleanField(7,st):bt==="number"&&(st%1!=0?it.writeDoubleField(3,st):st<0?it.writeSVarintField(6,st):it.writeVarintField(5,st))}return Tt.exports=ae,Tt.exports.fromVectorTileJs=ae,Tt.exports.fromGeojsonVt=function(st,it){it=it||{};var bt={};for(var Ut in st)bt[Ut]=new ee(st[Ut].features,it),bt[Ut].name=Ut,bt[Ut].version=it.version,bt[Ut].extent=it.extent;return ae({layers:bt})},Tt.exports.GeoJSONWrapper=ee,Tt.exports}(),Vr=a.d$(tr);const Nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},ct=Math.fround||($t=new Float32Array(1),Ke=>($t[0]=+Ke,$t[0]));var $t;const Ht=3,Bt=5,It=6;class qt{constructor(ee){this.options=Object.assign(Object.create(Nr),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:ae,minZoom:Se,maxZoom:Re}=this.options;ae&&console.time("total time");const Ae=`prepare ${ee.length} points`;ae&&console.time(Ae),this.points=ee;const Ue=[];for(let Ge=0;Ge<ee.length;Ge++){const Xe=ee[Ge];if(!Xe.geometry)continue;const[st,it]=Xe.geometry.coordinates,bt=ct(er(st)),Ut=ct(cr(it));Ue.push(bt,Ut,1/0,Ge,-1,1),this.options.reduce&&Ue.push(0)}let Ye=this.trees[Re+1]=this._createTree(Ue);ae&&console.timeEnd(Ae);for(let Ge=Re;Ge>=Se;Ge--){const Xe=+Date.now();Ye=this.trees[Ge]=this._createTree(this._cluster(Ye,Ge)),ae&&console.log("z%d: %d clusters in %dms",Ge,Ye.numItems,+Date.now()-Xe)}return ae&&console.timeEnd("total time"),this}getClusters(ee,ae){let Se=((ee[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,ee[1]));let Ae=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)Se=-180,Ae=180;else if(Se>Ae){const it=this.getClusters([Se,Re,180,Ue],ae),bt=this.getClusters([-180,Re,Ae,Ue],ae);return it.concat(bt)}const Ye=this.trees[this._limitZoom(ae)],Ge=Ye.range(er(Se),cr(Ue),er(Ae),cr(Re)),Xe=Ye.data,st=[];for(const it of Ge){const bt=this.stride*it;st.push(Xe[bt+Bt]>1?Wt(Xe,bt,this.clusterProps):this.points[Xe[bt+Ht]])}return st}getChildren(ee){const ae=this._getOriginId(ee),Se=this._getOriginZoom(ee),Re="No cluster with the specified id.",Ae=this.trees[Se];if(!Ae)throw new Error(Re);const Ue=Ae.data;if(ae*this.stride>=Ue.length)throw new Error(Re);const Ye=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),Ge=Ae.within(Ue[ae*this.stride],Ue[ae*this.stride+1],Ye),Xe=[];for(const st of Ge){const it=st*this.stride;Ue[it+4]===ee&&Xe.push(Ue[it+Bt]>1?Wt(Ue,it,this.clusterProps):this.points[Ue[it+Ht]])}if(Xe.length===0)throw new Error(Re);return Xe}getLeaves(ee,ae,Se){const Re=[];return this._appendLeaves(Re,ee,ae=ae||10,Se=Se||0,0),Re}getTile(ee,ae,Se){const Re=this.trees[this._limitZoom(ee)],Ae=Math.pow(2,ee),{extent:Ue,radius:Ye}=this.options,Ge=Ye/Ue,Xe=(Se-Ge)/Ae,st=(Se+1+Ge)/Ae,it={features:[]};return this._addTileFeatures(Re.range((ae-Ge)/Ae,Xe,(ae+1+Ge)/Ae,st),Re.data,ae,Se,Ae,it),ae===0&&this._addTileFeatures(Re.range(1-Ge/Ae,Xe,1,st),Re.data,Ae,Se,Ae,it),ae===Ae-1&&this._addTileFeatures(Re.range(0,Xe,Ge/Ae,st),Re.data,-1,Se,Ae,it),it.features.length?it:null}getClusterExpansionZoom(ee){let ae=this._getOriginZoom(ee)-1;for(;ae<=this.options.maxZoom;){const Se=this.getChildren(ee);if(ae++,Se.length!==1)break;ee=Se[0].properties.cluster_id}return ae}_appendLeaves(ee,ae,Se,Re,Ae){const Ue=this.getChildren(ae);for(const Ye of Ue){const Ge=Ye.properties;if(Ge&&Ge.cluster?Ae+Ge.point_count<=Re?Ae+=Ge.point_count:Ae=this._appendLeaves(ee,Ge.cluster_id,Se,Re,Ae):Ae<Re?Ae++:ee.push(Ye),ee.length===Se)break}return Ae}_createTree(ee){const ae=new a.by(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<ee.length;Se+=this.stride)ae.add(ee[Se],ee[Se+1]);return ae.finish(),ae.data=ee,ae}_addTileFeatures(ee,ae,Se,Re,Ae,Ue){for(const Ye of ee){const Ge=Ye*this.stride,Xe=ae[Ge+Bt]>1;let st,it,bt;if(Xe)st=be(ae,Ge,this.clusterProps),it=ae[Ge],bt=ae[Ge+1];else{const _r=this.points[ae[Ge+Ht]];st=_r.properties;const[vr,wr]=_r.geometry.coordinates;it=er(vr),bt=cr(wr)}const Ut={type:1,geometry:[[Math.round(this.options.extent*(it*Ae-Se)),Math.round(this.options.extent*(bt*Ae-Re))]],tags:st};let jt;jt=Xe||this.options.generateId?ae[Ge+Ht]:this.points[ae[Ge+Ht]].id,jt!==void 0&&(Ut.id=jt),Ue.features.push(Ut)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,ae){const{radius:Se,extent:Re,reduce:Ae,minPoints:Ue}=this.options,Ye=Se/(Re*Math.pow(2,ae)),Ge=ee.data,Xe=[],st=this.stride;for(let it=0;it<Ge.length;it+=st){if(Ge[it+2]<=ae)continue;Ge[it+2]=ae;const bt=Ge[it],Ut=Ge[it+1],jt=ee.within(Ge[it],Ge[it+1],Ye),_r=Ge[it+Bt];let vr=_r;for(const wr of jt){const xr=wr*st;Ge[xr+2]>ae&&(vr+=Ge[xr+Bt])}if(vr>_r&&vr>=Ue){let wr,xr=bt*_r,cn=Ut*_r,gn=-1;const Ir=(it/st<<5)+(ae+1)+this.points.length;for(const fn of jt){const Un=fn*st;if(Ge[Un+2]<=ae)continue;Ge[Un+2]=ae;const yi=Ge[Un+Bt];xr+=Ge[Un]*yi,cn+=Ge[Un+1]*yi,Ge[Un+4]=Ir,Ae&&(wr||(wr=this._map(Ge,it,!0),gn=this.clusterProps.length,this.clusterProps.push(wr)),Ae(wr,this._map(Ge,Un)))}Ge[it+4]=Ir,Xe.push(xr/vr,cn/vr,1/0,Ir,-1,vr),Ae&&Xe.push(gn)}else{for(let wr=0;wr<st;wr++)Xe.push(Ge[it+wr]);if(vr>1)for(const wr of jt){const xr=wr*st;if(!(Ge[xr+2]<=ae)){Ge[xr+2]=ae;for(let cn=0;cn<st;cn++)Xe.push(Ge[xr+cn])}}}}return Xe}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,ae,Se){if(ee[ae+Bt]>1){const Ue=this.clusterProps[ee[ae+It]];return Se?Object.assign({},Ue):Ue}const Re=this.points[ee[ae+Ht]].properties,Ae=this.options.map(Re);return Se&&Ae===Re?Object.assign({},Ae):Ae}}function Wt(Ke,ee,ae){return{type:"Feature",id:Ke[ee+Ht],properties:be(Ke,ee,ae),geometry:{type:"Point",coordinates:[(Se=Ke[ee],360*(Se-.5)),pr(Ke[ee+1])]}};var Se}function be(Ke,ee,ae){const Se=Ke[ee+Bt],Re=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,Ae=Ke[ee+It],Ue=Ae===-1?{}:Object.assign({},ae[Ae]);return Object.assign(Ue,{cluster:!0,cluster_id:Ke[ee+Ht],point_count:Se,point_count_abbreviated:Re})}function er(Ke){return Ke/360+.5}function cr(Ke){const ee=Math.sin(Ke*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function pr(Ke){const ee=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function lt(Ke,ee,ae,Se){let Re=Se;const Ae=ee+(ae-ee>>1);let Ue,Ye=ae-ee;const Ge=Ke[ee],Xe=Ke[ee+1],st=Ke[ae],it=Ke[ae+1];for(let bt=ee+3;bt<ae;bt+=3){const Ut=Lr(Ke[bt],Ke[bt+1],Ge,Xe,st,it);if(Ut>Re)Ue=bt,Re=Ut;else if(Ut===Re){const jt=Math.abs(bt-Ae);jt<Ye&&(Ue=bt,Ye=jt)}}Re>Se&&(Ue-ee>3&&lt(Ke,ee,Ue,Se),Ke[Ue+2]=Re,ae-Ue>3&&lt(Ke,Ue,ae,Se))}function Lr(Ke,ee,ae,Se,Re,Ae){let Ue=Re-ae,Ye=Ae-Se;if(Ue!==0||Ye!==0){const Ge=((Ke-ae)*Ue+(ee-Se)*Ye)/(Ue*Ue+Ye*Ye);Ge>1?(ae=Re,Se=Ae):Ge>0&&(ae+=Ue*Ge,Se+=Ye*Ge)}return Ue=Ke-ae,Ye=ee-Se,Ue*Ue+Ye*Ye}function br(Ke,ee,ae,Se){const Re={id:Ke??null,type:ee,geometry:ae,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Kr(Re,ae);else if(ee==="Polygon")Kr(Re,ae[0]);else if(ee==="MultiLineString")for(const Ae of ae)Kr(Re,Ae);else if(ee==="MultiPolygon")for(const Ae of ae)Kr(Re,Ae[0]);return Re}function Kr(Ke,ee){for(let ae=0;ae<ee.length;ae+=3)Ke.minX=Math.min(Ke.minX,ee[ae]),Ke.minY=Math.min(Ke.minY,ee[ae+1]),Ke.maxX=Math.max(Ke.maxX,ee[ae]),Ke.maxY=Math.max(Ke.maxY,ee[ae+1])}function sr(Ke,ee,ae,Se){if(!ee.geometry)return;const Re=ee.geometry.coordinates;if(Re&&Re.length===0)return;const Ae=ee.geometry.type,Ue=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let Ye=[],Ge=ee.id;if(ae.promoteId?Ge=ee.properties[ae.promoteId]:ae.generateId&&(Ge=Se||0),Ae==="Point")Hr(Re,Ye);else if(Ae==="MultiPoint")for(const Xe of Re)Hr(Xe,Ye);else if(Ae==="LineString")mn(Re,Ye,Ue,!1);else if(Ae==="MultiLineString"){if(ae.lineMetrics){for(const Xe of Re)Ye=[],mn(Xe,Ye,Ue,!1),Ke.push(br(Ge,"LineString",Ye,ee.properties));return}Er(Re,Ye,Ue,!1)}else if(Ae==="Polygon")Er(Re,Ye,Ue,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(const Xe of ee.geometry.geometries)sr(Ke,{id:Ge,geometry:Xe,properties:ee.properties},ae,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Re){const st=[];Er(Xe,st,Ue,!0),Ye.push(st)}}Ke.push(br(Ge,Ae,Ye,ee.properties))}function Hr(Ke,ee){ee.push(Gi(Ke[0]),ai(Ke[1]),0)}function mn(Ke,ee,ae,Se){let Re,Ae,Ue=0;for(let Ge=0;Ge<Ke.length;Ge++){const Xe=Gi(Ke[Ge][0]),st=ai(Ke[Ge][1]);ee.push(Xe,st,0),Ge>0&&(Ue+=Se?(Re*st-Xe*Ae)/2:Math.sqrt(Math.pow(Xe-Re,2)+Math.pow(st-Ae,2))),Re=Xe,Ae=st}const Ye=ee.length-3;ee[2]=1,lt(ee,0,Ye,ae),ee[Ye+2]=1,ee.size=Math.abs(Ue),ee.start=0,ee.end=ee.size}function Er(Ke,ee,ae,Se){for(let Re=0;Re<Ke.length;Re++){const Ae=[];mn(Ke[Re],Ae,ae,Se),ee.push(Ae)}}function Gi(Ke){return Ke/360+.5}function ai(Ke){const ee=Math.sin(Ke*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function hr(Ke,ee,ae,Se,Re,Ae,Ue,Ye){if(Se/=ee,Ae>=(ae/=ee)&&Ue<Se)return Ke;if(Ue<ae||Ae>=Se)return null;const Ge=[];for(const Xe of Ke){const st=Xe.geometry;let it=Xe.type;const bt=Re===0?Xe.minX:Xe.minY,Ut=Re===0?Xe.maxX:Xe.maxY;if(bt>=ae&&Ut<Se){Ge.push(Xe);continue}if(Ut<ae||bt>=Se)continue;let jt=[];if(it==="Point"||it==="MultiPoint")Po(st,jt,ae,Se,Re);else if(it==="LineString")ao(st,jt,ae,Se,Re,!1,Ye.lineMetrics);else if(it==="MultiLineString")hi(st,jt,ae,Se,Re,!1);else if(it==="Polygon")hi(st,jt,ae,Se,Re,!0);else if(it==="MultiPolygon")for(const _r of st){const vr=[];hi(_r,vr,ae,Se,Re,!0),vr.length&&jt.push(vr)}if(jt.length){if(Ye.lineMetrics&&it==="LineString"){for(const _r of jt)Ge.push(br(Xe.id,it,_r,Xe.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(jt.length===1?(it="LineString",jt=jt[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=jt.length===3?"Point":"MultiPoint"),Ge.push(br(Xe.id,it,jt,Xe.tags))}}return Ge.length?Ge:null}function Po(Ke,ee,ae,Se,Re){for(let Ae=0;Ae<Ke.length;Ae+=3){const Ue=Ke[Ae+Re];Ue>=ae&&Ue<=Se&&wi(ee,Ke[Ae],Ke[Ae+1],Ke[Ae+2])}}function ao(Ke,ee,ae,Se,Re,Ae,Ue){let Ye=so(Ke);const Ge=Re===0?kn:aa;let Xe,st,it=Ke.start;for(let vr=0;vr<Ke.length-3;vr+=3){const wr=Ke[vr],xr=Ke[vr+1],cn=Ke[vr+2],gn=Ke[vr+3],Ir=Ke[vr+4],fn=Re===0?wr:xr,Un=Re===0?gn:Ir;let yi=!1;Ue&&(Xe=Math.sqrt(Math.pow(wr-gn,2)+Math.pow(xr-Ir,2))),fn<ae?Un>ae&&(st=Ge(Ye,wr,xr,gn,Ir,ae),Ue&&(Ye.start=it+Xe*st)):fn>Se?Un<Se&&(st=Ge(Ye,wr,xr,gn,Ir,Se),Ue&&(Ye.start=it+Xe*st)):wi(Ye,wr,xr,cn),Un<ae&&fn>=ae&&(st=Ge(Ye,wr,xr,gn,Ir,ae),yi=!0),Un>Se&&fn<=Se&&(st=Ge(Ye,wr,xr,gn,Ir,Se),yi=!0),!Ae&&yi&&(Ue&&(Ye.end=it+Xe*st),ee.push(Ye),Ye=so(Ke)),Ue&&(it+=Xe)}let bt=Ke.length-3;const Ut=Ke[bt],jt=Ke[bt+1],_r=Re===0?Ut:jt;_r>=ae&&_r<=Se&&wi(Ye,Ut,jt,Ke[bt+2]),bt=Ye.length-3,Ae&&bt>=3&&(Ye[bt]!==Ye[0]||Ye[bt+1]!==Ye[1])&&wi(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&ee.push(Ye)}function so(Ke){const ee=[];return ee.size=Ke.size,ee.start=Ke.start,ee.end=Ke.end,ee}function hi(Ke,ee,ae,Se,Re,Ae){for(const Ue of Ke)ao(Ue,ee,ae,Se,Re,Ae,!1)}function wi(Ke,ee,ae,Se){Ke.push(ee,ae,Se)}function kn(Ke,ee,ae,Se,Re,Ae){const Ue=(Ae-ee)/(Se-ee);return wi(Ke,Ae,ae+(Re-ae)*Ue,1),Ue}function aa(Ke,ee,ae,Se,Re,Ae){const Ue=(Ae-ae)/(Re-ae);return wi(Ke,ee+(Se-ee)*Ue,Ae,1),Ue}function sa(Ke,ee){const ae=[];for(let Se=0;Se<Ke.length;Se++){const Re=Ke[Se],Ae=Re.type;let Ue;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Ue=la(Re.geometry,ee);else if(Ae==="MultiLineString"||Ae==="Polygon"){Ue=[];for(const Ye of Re.geometry)Ue.push(la(Ye,ee))}else if(Ae==="MultiPolygon"){Ue=[];for(const Ye of Re.geometry){const Ge=[];for(const Xe of Ye)Ge.push(la(Xe,ee));Ue.push(Ge)}}ae.push(br(Re.id,Ae,Ue,Re.tags))}return ae}function la(Ke,ee){const ae=[];ae.size=Ke.size,Ke.start!==void 0&&(ae.start=Ke.start,ae.end=Ke.end);for(let Se=0;Se<Ke.length;Se+=3)ae.push(Ke[Se]+ee,Ke[Se+1],Ke[Se+2]);return ae}function kr(Ke,ee){if(Ke.transformed)return Ke;const ae=1<<Ke.z,Se=Ke.x,Re=Ke.y;for(const Ae of Ke.features){const Ue=Ae.geometry,Ye=Ae.type;if(Ae.geometry=[],Ye===1)for(let Ge=0;Ge<Ue.length;Ge+=2)Ae.geometry.push(Mn(Ue[Ge],Ue[Ge+1],ee,ae,Se,Re));else for(let Ge=0;Ge<Ue.length;Ge++){const Xe=[];for(let st=0;st<Ue[Ge].length;st+=2)Xe.push(Mn(Ue[Ge][st],Ue[Ge][st+1],ee,ae,Se,Re));Ae.geometry.push(Xe)}}return Ke.transformed=!0,Ke}function Mn(Ke,ee,ae,Se,Re,Ae){return[Math.round(ae*(Ke*Se-Re)),Math.round(ae*(ee*Se-Ae))]}function On(Ke,ee,ae,Se,Re){const Ae=ee===Re.maxZoom?0:Re.tolerance/((1<<ee)*Re.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:ae,y:Se,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Ke)ca(Ue,Ye,Ae,Re);return Ue}function ca(Ke,ee,ae,Se){const Re=ee.geometry,Ae=ee.type,Ue=[];if(Ke.minX=Math.min(Ke.minX,ee.minX),Ke.minY=Math.min(Ke.minY,ee.minY),Ke.maxX=Math.max(Ke.maxX,ee.maxX),Ke.maxY=Math.max(Ke.maxY,ee.maxY),Ae==="Point"||Ae==="MultiPoint")for(let Ye=0;Ye<Re.length;Ye+=3)Ue.push(Re[Ye],Re[Ye+1]),Ke.numPoints++,Ke.numSimplified++;else if(Ae==="LineString")Gr(Ue,Re,Ke,ae,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(let Ye=0;Ye<Re.length;Ye++)Gr(Ue,Re[Ye],Ke,ae,Ae==="Polygon",Ye===0);else if(Ae==="MultiPolygon")for(let Ye=0;Ye<Re.length;Ye++){const Ge=Re[Ye];for(let Xe=0;Xe<Ge.length;Xe++)Gr(Ue,Ge[Xe],Ke,ae,!0,Xe===0)}if(Ue.length){let Ye=ee.tags||null;if(Ae==="LineString"&&Se.lineMetrics){Ye={};for(const Xe in ee.tags)Ye[Xe]=ee.tags[Xe];Ye.mapbox_clip_start=Re.start/Re.size,Ye.mapbox_clip_end=Re.end/Re.size}const Ge={geometry:Ue,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:Ye};ee.id!==null&&(Ge.id=ee.id),Ke.features.push(Ge)}}function Gr(Ke,ee,ae,Se,Re,Ae){const Ue=Se*Se;if(Se>0&&ee.size<(Re?Ue:Se))return void(ae.numPoints+=ee.length/3);const Ye=[];for(let Ge=0;Ge<ee.length;Ge+=3)(Se===0||ee[Ge+2]>Ue)&&(ae.numSimplified++,Ye.push(ee[Ge],ee[Ge+1])),ae.numPoints++;Re&&function(Ge,Xe){let st=0;for(let it=0,bt=Ge.length,Ut=bt-2;it<bt;Ut=it,it+=2)st+=(Ge[it]-Ge[Ut])*(Ge[it+1]+Ge[Ut+1]);if(st>0===Xe)for(let it=0,bt=Ge.length;it<bt/2;it+=2){const Ut=Ge[it],jt=Ge[it+1];Ge[it]=Ge[bt-2-it],Ge[it+1]=Ge[bt-1-it],Ge[bt-2-it]=Ut,Ge[bt-1-it]=jt}}(Ye,Ae),Ke.push(Ye)}const Ka={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ad{constructor(ee,ae){const Se=(ae=this.options=function(Ae,Ue){for(const Ye in Ue)Ae[Ye]=Ue[Ye];return Ae}(Object.create(Ka),ae)).debug;if(Se&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=function(Ae,Ue){const Ye=[];if(Ae.type==="FeatureCollection")for(let Ge=0;Ge<Ae.features.length;Ge++)sr(Ye,Ae.features[Ge],Ue,Ge);else sr(Ye,Ae.type==="Feature"?Ae:{geometry:Ae},Ue);return Ye}(ee,ae);this.tiles={},this.tileCoords=[],Se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=function(Ae,Ue){const Ye=Ue.buffer/Ue.extent;let Ge=Ae;const Xe=hr(Ae,1,-1-Ye,Ye,0,-1,2,Ue),st=hr(Ae,1,1-Ye,2+Ye,0,-1,2,Ue);return(Xe||st)&&(Ge=hr(Ae,1,-Ye,1+Ye,0,-1,2,Ue)||[],Xe&&(Ge=sa(Xe,1).concat(Ge)),st&&(Ge=Ge.concat(sa(st,-1)))),Ge}(Re,ae),Re.length&&this.splitTile(Re,0,0,0),Se&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,ae,Se,Re,Ae,Ue,Ye){const Ge=[ee,ae,Se,Re],Xe=this.options,st=Xe.debug;for(;Ge.length;){Re=Ge.pop(),Se=Ge.pop(),ae=Ge.pop(),ee=Ge.pop();const it=1<<ae,bt=Go(ae,Se,Re);let Ut=this.tiles[bt];if(!Ut&&(st>1&&console.time("creation"),Ut=this.tiles[bt]=On(ee,ae,Se,Re,Xe),this.tileCoords.push({z:ae,x:Se,y:Re}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,Se,Re,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));const yi=`z${ae}`;this.stats[yi]=(this.stats[yi]||0)+1,this.total++}if(Ut.source=ee,Ae==null){if(ae===Xe.indexMaxZoom||Ut.numPoints<=Xe.indexMaxPoints)continue}else{if(ae===Xe.maxZoom||ae===Ae)continue;if(Ae!=null){const yi=Ae-ae;if(Se!==Ue>>yi||Re!==Ye>>yi)continue}}if(Ut.source=null,ee.length===0)continue;st>1&&console.time("clipping");const jt=.5*Xe.buffer/Xe.extent,_r=.5-jt,vr=.5+jt,wr=1+jt;let xr=null,cn=null,gn=null,Ir=null,fn=hr(ee,it,Se-jt,Se+vr,0,Ut.minX,Ut.maxX,Xe),Un=hr(ee,it,Se+_r,Se+wr,0,Ut.minX,Ut.maxX,Xe);ee=null,fn&&(xr=hr(fn,it,Re-jt,Re+vr,1,Ut.minY,Ut.maxY,Xe),cn=hr(fn,it,Re+_r,Re+wr,1,Ut.minY,Ut.maxY,Xe),fn=null),Un&&(gn=hr(Un,it,Re-jt,Re+vr,1,Ut.minY,Ut.maxY,Xe),Ir=hr(Un,it,Re+_r,Re+wr,1,Ut.minY,Ut.maxY,Xe),Un=null),st>1&&console.timeEnd("clipping"),Ge.push(xr||[],ae+1,2*Se,2*Re),Ge.push(cn||[],ae+1,2*Se,2*Re+1),Ge.push(gn||[],ae+1,2*Se+1,2*Re),Ge.push(Ir||[],ae+1,2*Se+1,2*Re+1)}}getTile(ee,ae,Se){ee=+ee,ae=+ae,Se=+Se;const Re=this.options,{extent:Ae,debug:Ue}=Re;if(ee<0||ee>24)return null;const Ye=1<<ee,Ge=Go(ee,ae=ae+Ye&Ye-1,Se);if(this.tiles[Ge])return kr(this.tiles[Ge],Ae);Ue>1&&console.log("drilling down to z%d-%d-%d",ee,ae,Se);let Xe,st=ee,it=ae,bt=Se;for(;!Xe&&st>0;)st--,it>>=1,bt>>=1,Xe=this.tiles[Go(st,it,bt)];return Xe&&Xe.source?(Ue>1&&(console.log("found parent tile z%d-%d-%d",st,it,bt),console.time("drilling down")),this.splitTile(Xe.source,st,it,bt,ee,ae,Se),Ue>1&&console.timeEnd("drilling down"),this.tiles[Ge]?kr(this.tiles[Ge],Ae):null):null}}function Go(Ke,ee,ae){return 32*((1<<Ke)*ae+ee)+Ke}function zl(Ke,ee){const ae=Ke.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const Se=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!Se)return void ee(null,null);const Re=new Je(Se.features);let Ae=Vr(Re);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),ee(null,{vectorTile:Re,rawData:Ae.buffer})}class th extends se{constructor(ee,ae,Se,Re,Ae,Ue){super(ee,ae,Se,Re,zl,Ue),Ae&&(this.loadGeoJSON=Ae),this._dynamicIndex=new Ct}loadData(ee,ae){const Se=ee&&ee.request,Re=Se&&Se.collectResourceTiming;this.loadGeoJSON(ee,(Ae,Ue)=>{if(Ae||!Ue)return ae(Ae);if(typeof Ue!="object")return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Ge=a.M(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Ue.features=Ue.features.filter(Xe=>Ge.value.evaluate({zoom:0},Xe))}ee.dynamic?(Ue.type==="Feature"&&(Ue={type:"FeatureCollection",features:[Ue]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ue.features,this.loaded),ee.cluster&&(Ue.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new qt(function({superclusterOptions:Ge,clusterProperties:Xe}){if(!Xe||!Ge)return Ge;const st={},it={},bt={accumulated:null,zoom:0},Ut={properties:null},jt=Object.keys(Xe);for(const _r of jt){const[vr,wr]=Xe[_r],xr=a.M(wr),cn=a.M(typeof vr=="string"?[vr,["accumulated"],["get",_r]]:vr);st[_r]=xr.value,it[_r]=cn.value}return Ge.map=_r=>{Ut.properties=_r;const vr={};for(const wr of jt)vr[wr]=st[wr].evaluate(bt,Ut);return vr},Ge.reduce=(_r,vr)=>{Ut.properties=vr;for(const wr of jt)bt.accumulated=_r[wr],_r[wr]=it[wr].evaluate(bt,Ut)},Ge}(ee)).load(Ue.features):ee.dynamic?this._dynamicIndex:function(Ge,Xe){return new Ad(Ge,Xe)}(Ue,ee.geojsonVtOptions)}catch(Ge){return ae(Ge)}const Ye={};if(Re){const Ge=N(Se);Ge&&(Ye.resourceTiming={},Ye.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ge)))}ae(null,Ye)}})}reloadTile(ee,ae){const Se=this.loaded;return Se&&Se[ee.uid]?ee.partial?ae(null,void 0):super.reloadTile(ee,ae):this.loadTile(ee,ae)}loadGeoJSON(ee,ae){if(ee.request)a.n(ee.request,ae);else{if(typeof ee.data!="string")return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(ee.data))}catch{return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(Se){ae(Se)}}getClusterChildren(ee,ae){try{ae(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(Se){ae(Se)}}getClusterLeaves(ee,ae){try{ae(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(Se){ae(Se)}}}class Sc{constructor(ee,ae){this.tileID=new a.aA(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=ae}parse(ee,ae,Se,Re){this.status="parsing";const Ae=new a.aA(Se.tileID.overscaledZ,Se.tileID.wrap,Se.tileID.canonical.z,Se.tileID.canonical.x,Se.tileID.canonical.y),Ue={},Ye=ae.familiesBySource[Se.source],Ge=new a.dR(Ae,Se.promoteId);return Ge.bucketLayerIDs=[],Ge.is3DTile=!0,a.e0(ee).then(Xe=>{if(!Xe)return Re(new Error("Could not parse tile"));const st=a.e1(Xe,1/a.c8(Se.tileID.canonical)),it=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,bt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),Ut=new a.a3(this.zoom,{brightness:this.brightness});for(const jt in Ye)for(const _r of Ye[jt]){const vr=_r[0];Ge.bucketLayerIDs.push(_r.map(xr=>xr.id)),vr.recalculate(Ut,[]);const wr=new a.e2(st,Ae,it,bt,this.brightness,Ge);it||(wr.needsUpload=!0),Ue[vr.fqid]=wr,wr.evaluate(vr)}this.status="done",Re(null,{buckets:Ue,featureIndex:Ge})}).catch(Xe=>Re(new Error(Xe.message)))}}class rh{constructor(ee,ae,Se,Re,Ae,Ue){this.actor=ee,this.layerIndex=ae,this.brightness=Ue,this.loading={},this.loaded={}}loadTile(ee,ae){const Se=ee.uid,Re=this.loading[Se]=new Sc(ee,this.brightness);a.bc(ee.request,(Ae,Ue)=>{const Ye=!this.loading[Se];return delete this.loading[Se],Ye||Ae?(Re.status="done",Ye||(this.loaded[Se]=Re),ae(Ae)):Ue&&Ue.byteLength!==0?void Re.parse(Ue,this.layerIndex,ee,(Ge,Xe)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[Se]=Re,Ge||!Xe?ae(Ge):ae(null,Xe)}):(Re.status="done",this.loaded[Se]=Re,ae())})}reloadTile(ee,ae){const Se=this.loaded,Re=ee.uid;if(Se&&Se[Re]){const Ae=Se[Re];Ae.projection=ee.projection,Ae.brightness=ee.brightness;const Ue=(Ye,Ge)=>{Ae.reloadCallback&&(delete Ae.reloadCallback,this.loadTile(ee,ae)),ae(Ye,Ge)};Ae.status==="parsing"?Ae.reloadCallback=Ue:Ae.status==="done"&&this.loadTile(ee,ae)}}abortTile(ee,ae){const Se=ee.uid;this.loading[Se]&&delete this.loading[Se],ae()}removeTile(ee,ae){const Se=this.loaded,Re=ee.uid;Se&&Se[Re]&&delete Se[Re],ae()}}class Fl{constructor(ee){this.self=ee,this.actor=new a.e3(ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.bL({name:"mercator"}),this.workerSourceTypes={vector:se,geojson:th,"batched-model":rh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ae,Se)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=Se},this.self.registerRTLTextPlugin=ae=>{if(a.e4.isParsed())throw new Error("RTL text plugin already registered.");a.e4.applyArabicShaping=ae.applyArabicShaping,a.e4.processBidirectionalText=ae.processBidirectionalText,a.e4.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(ee,ae,Se){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],delete this.rasterArrayWorkerSource,Se()}checkIfReady(ee,ae,Se){Se()}setReferrer(ee,ae){this.referrer=ae}spriteLoaded(ee,{scope:ae,isLoaded:Se}){if(this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.isSpriteLoaded[ee][ae]=Se,this.workerSources[ee]&&this.workerSources[ee][ae])for(const Re in this.workerSources[ee][ae]){const Ae=this.workerSources[ee][ae][Re];for(const Ue in Ae){const Ye=Ae[Ue];Ye instanceof se&&(Ye.isSpriteLoaded=Se,Ye.fire(new a.x("isSpriteLoaded")))}}}setImages(ee,{scope:ae,images:Se},Re){if(this.availableImages[ee]||(this.availableImages[ee]={}),this.availableImages[ee][ae]=Se,this.workerSources[ee]&&this.workerSources[ee][ae]){for(const Ae in this.workerSources[ee][ae]){const Ue=this.workerSources[ee][ae][Ae];for(const Ye in Ue)Ue[Ye].availableImages=Se}Re()}else Re()}setProjection(ee,ae){this.projections[ee]=a.bL(ae)}setBrightness(ee,ae,Se){this.brightness=ae,Se()}setLayers(ee,ae,Se){this.getLayerIndex(ee,ae.scope).replace(ae.layers,ae.options),Se()}updateLayers(ee,ae,Se){this.getLayerIndex(ee,ae.scope).update(ae.layers,ae.removedIds,ae.options),Se()}loadTile(ee,ae,Se){ae.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ae.type,ae.source,ae.scope).loadTile(ae,Se)}loadDEMTile(ee,ae,Se){this.getDEMWorkerSource(ee,ae.source,ae.scope).loadTile(ae,Se)}decodeRasterArray(ee,ae,Se){this.getRasterArrayWorkerSource().decodeRasterArray(ae,Se)}reloadTile(ee,ae,Se){ae.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ae.type,ae.source,ae.scope).reloadTile(ae,Se)}abortTile(ee,ae,Se){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).abortTile(ae,Se)}removeTile(ee,ae,Se){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).removeTile(ae,Se)}removeSource(ee,ae,Se){if(!(this.workerSources[ee]&&this.workerSources[ee][ae.scope]&&this.workerSources[ee][ae.scope][ae.type]&&this.workerSources[ee][ae.scope][ae.type][ae.source]))return;const Re=this.workerSources[ee][ae.scope][ae.type][ae.source];delete this.workerSources[ee][ae.scope][ae.type][ae.source],Re.removeSource!==void 0?Re.removeSource(ae,Se):Se()}loadWorkerSource(ee,ae,Se){try{this.self.importScripts(ae.url),Se()}catch(Re){Se(Re.toString())}}syncRTLPluginState(ee,ae,Se){try{a.e4.setState(ae);const Re=a.e4.getPluginURL();if(a.e4.isLoaded()&&!a.e4.isParsed()&&Re!=null){this.self.importScripts(Re);const Ae=a.e4.isParsed();Se(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Re}`),Ae)}}catch(Re){Se(Re.toString())}}setDracoUrl(ee,ae){this.dracoUrl=ae}getAvailableImages(ee,ae){this.availableImages[ee]||(this.availableImages[ee]={});let Se=this.availableImages[ee][ae];return Se||(Se=[]),Se}getLayerIndex(ee,ae){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let Se=this.layerIndexes[ee][ae];return Se||(Se=this.layerIndexes[ee][ae]=new X,Se.scope=ae),Se}getWorkerSource(ee,ae,Se,Re){return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][Re]||(this.workerSources[ee][Re]={}),this.workerSources[ee][Re][ae]||(this.workerSources[ee][Re][ae]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.workerSources[ee][Re][ae][Se]||(this.workerSources[ee][Re][ae][Se]=new this.workerSourceTypes[ae]({send:(Ae,Ue,Ye,Ge,Xe,st)=>{this.actor.send(Ae,Ue,Ye,ee,Xe,st)},scheduler:this.actor.scheduler},this.getLayerIndex(ee,Re),this.getAvailableImages(ee,Re),this.isSpriteLoaded[ee][Re],void 0,this.brightness)),this.workerSources[ee][Re][ae][Se]}getDEMWorkerSource(ee,ae,Se){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][Se]||(this.demWorkerSources[ee][Se]={}),this.demWorkerSources[ee][Se][ae]||(this.demWorkerSources[ee][Se][ae]=new le),this.demWorkerSources[ee][Se][ae]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ce),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ee,ae){a.e5(ae)}getWorkerPerformanceMetrics(ee,ae,Se){Se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fl(self)),Fl}),S(["./shared"],function(a){var N="3.7.0";const G={create:"create",load:"load",fullLoad:"fullLoad"},q={mark(f){performance.mark(f)},measure(f,n,s){performance.measure(f,n,s)}};function X(f){const n=f.name.split("?")[0];return a.a(n)&&n.includes("mapbox-gl.js")?"javascript":a.a(n)&&n.includes("mapbox-gl.css")?"css":a.b(n)?"fontRange":a.c(n)?"sprite":a.i(n)?"style":a.d(n)?"tilejson":"other"}var oe,te={},ie=function(){if(oe)return te;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,w,A=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(A);try{w=new Worker(k),x=!0}catch{x=!1}return w&&w.terminate(),URL.revokeObjectURL(k),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var w=x.getContext("2d");if(!w)return!1;var A=w.getImageData(0,0,1,1);return A&&A.width===x.width}()?(s[_=p&&p.failIfMajorPerformanceCaveat]===void 0&&(s[_]=function(x){var w,A=function(k){var L=document.createElement("canvas"),z=Object.create(f.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=k,L.getContext("webgl2",z)}(x);if(!A)return!1;try{w=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!w||A.isContextLost())&&(A.shaderSource(w,"void main() {}"),A.compileShader(w),A.getShaderParameter(w,A.COMPILE_STATUS)===!0)}(_)),s[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}oe=1,te.supported=f,te.notSupportedReason=n;var s={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},te}();function pe(f,n,s){const p=document.createElement(f);return n!=null&&(p.className=n),s&&s.appendChild(p),p}function se(f,n,s){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const _ of Object.keys(n))p.setAttributeNS(null,_,String(n[_]));return s&&s.appendChild(p),p}const le=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ce=le&&le.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Me;function Le(){le&&ce&&(Me=le[ce],le[ce]="none")}function Je(){le&&ce&&(le[ce]=Me)}function Qe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Qe,!0)}function je(){window.addEventListener("click",Qe,!0),window.setTimeout(()=>{window.removeEventListener("click",Qe,!0)},0)}function Ct(f,n){const s=f.getBoundingClientRect();return dt(f,s,n)}function ye(f,n){const s=f.getBoundingClientRect(),p=[];for(let _=0;_<n.length;_++)p.push(dt(f,s,n[_]));return p}function et(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function dt(f,n,s){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new a.P((s.clientX-n.left)*p,(s.clientY-n.top)*p)}const Xt="01",Mt="NO_ACCESS_TOKEN";class yt{constructor(n,s,p){this._transformRequestFn=n,this._customAccessToken=s,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=function(){let s="";for(let p=0;p<10;p++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Xt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,s){return this._transformRequestFn&&this._transformRequestFn(n,s)||{url:n}}normalizeStyleURL(n,s){if(!a.f(n))return n;const p=Ze(n);return p.params.push(`sdk=js-${N}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||s)}normalizeGlyphsURL(n,s){if(!a.f(n))return n;const p=Ze(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||s)}normalizeModelURL(n,s){if(!a.f(n))return n;const p=Ze(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||s)}normalizeSourceURL(n,s,p,_){if(!a.f(n))return n;const x=Ze(n);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),p&&x.params.push(`language=${p}`),_&&x.params.push(`worldview=${_}`),this._makeAPIURL(x,this._customAccessToken||s)}normalizeSpriteURL(n,s,p,_){const x=Ze(n);return a.f(n)?(x.path=`/styles/v1${x.path}/sprite${s}${p}`,this._makeAPIURL(x,this._customAccessToken||_)):(x.path+=`${s}${p}`,ht(x))}normalizeTileURL(n,s,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!a.f(n))return n;const _=Ze(n);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||p&&_.authority!=="raster"&&p===512?"@2x":""}${a.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${a.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${a.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${a.e.TILE_URL_VERSION}${_.path}`);const x=this._customAccessToken||function(w){for(const A of w){const k=A.match(/^access_token=(.*)$/);if(k)return k[1]}return null}(_.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,x)}canonicalizeTileURL(n,s){const p=Ze(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let _="mapbox://";p.path.match(/^\/raster\/v1\//)?_+=`raster/${p.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${p.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${p.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let x=p.params;return s&&(x=x.filter(w=>!w.match(/^access_token=/))),x.length&&(_+=`?${x.join("&")}`),_}canonicalizeTileset(n,s){const p=!!s&&a.f(s),_=[];for(const x of n.tiles||[])a.h(x)?_.push(this.canonicalizeTileURL(x,p)):_.push(x);return _}_makeAPIURL(n,s){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Ze(a.e.API_URL);if(n.protocol=_.protocol,n.authority=_.authority,n.protocol==="http"){const x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(_.path!=="/"&&(n.path=`${_.path}${n.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return ht(n);if(s=s||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(x=>x.indexOf("access_token")===-1),n.params.push(`access_token=${s||""}`),ht(n)}}const gt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ze(f){const n=f.match(gt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ht(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const Dt="mapbox.eventData";function Tt(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(a.j(n[1]))}catch{return null}}class tr{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const s=Tt(a.e.ACCESS_TOKEN);let p="";return p=s&&s.u?a.k(s.u):a.e.ACCESS_TOKEN||"",n?`${Dt}.${n}:${p}`:`${Dt}:${p}`}fetchEventData(){const n=a.s("localStorage"),s=this.getStorageKey(),p=this.getStorageKey("uuid");if(n)try{const _=localStorage.getItem(s);_&&(this.eventData=JSON.parse(_));const x=localStorage.getItem(p);x&&(this.anonId=x)}catch{a.w("Unable to read from LocalStorage")}}saveEventData(){const n=a.s("localStorage"),s=this.getStorageKey(),p=this.getStorageKey("uuid"),_=this.anonId;if(n&&_)try{localStorage.setItem(p,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{a.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,s,p,_){if(!a.e.EVENTS_URL)return;const x=Ze(a.e.EVENTS_URL);x.params.push(`access_token=${_||a.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(n).toISOString()},A=s?a.l(w,s):w,k={url:ht(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=a.p(k,L=>{this.pendingRequest=null,p(L),this.saveEventData(),this.processRequests(_)})}queueRequest(n,s){this.queue.push(n),this.processRequests(s)}}const Vr=new class extends tr{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(s=>a.f(s)||a.h(s))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Tt(a.e.ACCESS_TOKEN),s=n?n.u:a.e.ACCESS_TOKEN;let p=s!==this.eventData.tokenU;a.v(this.anonId)||(this.anonId=a.u(),p=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(_),A=(_-this.eventData.lastSuccess)/864e5;p=p||A>=1||A<-1||x.getDate()!==w.getDate()}else p=!0;p?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:Xt,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=_,this.eventData.tokenU=s)},f):this.processRequests()}},Nr=Vr.postTurnstileEvent.bind(Vr),ct=new class extends tr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,s,p){this.skuToken=n,this.errorCb=p,a.e.EVENTS_URL&&(s||a.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(Mt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),a.v(this.anonId)||(this.anonId=a.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:Xt,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f))}remove(){this.errorCb=null}},$t=ct.postMapLoadEvent.bind(ct),Ht=new class extends tr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=a.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:s,style:p,importedStyles:_}=n;if(!a.e.EVENTS_URL||!f&&!a.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(s),w={mapInstanceId:x,eventId:this.getEventId(x),style:p};_.length&&(w.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:w},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:s}=this.queue.shift();this.postEvent(n,s,()=>{},f)}},Bt=Ht.postStyleLoadEvent.bind(Ht),It=new class extends tr{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){a.e.EVENTS_URL&&(f||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:s}=this.queue.shift(),p=function(_){const x=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),A=function($){const Y={};if($){for(const K in $)if(K!=="other")for(const J of $[K]){const Q=`${K}ResolveRangeMin`,fe=`${K}ResolveRangeMax`,ge=`${K}RequestCount`,he=`${K}RequestCachedCount`;Y[Q]=Math.min(Y[Q]||1/0,J.startTime),Y[fe]=Math.max(Y[fe]||-1/0,J.responseEnd);const xe=ve=>{Y[ve]===void 0&&(Y[ve]=0),++Y[ve]};J.transferSize!==void 0&&J.transferSize===0&&xe(he),xe(ge)}}return Y}(function($,Y){const K={};if($)for(const J of $){const Q=Y(J);K[Q]===void 0&&(K[Q]=[]),K[Q].push(J)}return K}(x,X)),k=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=L?L.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},j=($,Y,K)=>{K!=null&&$.push({name:Y,value:K.toString()})};for(const $ in A)j(U.counters,$,A[$]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(j(U.counters,"interactionRangeMin",_.interactionRange[0]),j(U.counters,"interactionRangeMax",_.interactionRange[1])),w)for(const $ of Object.keys(G)){const Y=G[$],K=w.find(J=>J.name===Y);K&&j(U.counters,Y,K.startTime)}return j(U.counters,"visibilityHidden",_.visibilityHidden),j(U.attributes,"style",function($){if($)for(const Y of $){const K=Y.name.split("?")[0];if(a.i(K)){const J=K.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(x)),j(U.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),j(U.attributes,"fogEnabled",_.fogEnabled?"true":"false"),j(U.attributes,"projection",_.projection),j(U.attributes,"zoom",_.zoom),j(U.metadata,"devicePixelRatio",k),j(U.metadata,"connectionEffectiveType",z),j(U.metadata,"navigatorUserAgent",navigator.userAgent),j(U.metadata,"screenWidth",window.screen.width),j(U.metadata,"screenHeight",window.screen.height),j(U.metadata,"windowWidth",window.innerWidth),j(U.metadata,"windowHeight",window.innerHeight),j(U.metadata,"mapWidth",_.width/k),j(U.metadata,"mapHeight",_.height/k),j(U.metadata,"webglRenderer",_.renderer),j(U.metadata,"webglVendor",_.vendor),j(U.metadata,"sdkVersion",N),j(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(s);for(const _ of p.metadata);for(const _ of p.counters);for(const _ of p.attributes);this.postEvent(n,p,()=>{},f)}},qt=It.postPerformanceEvent.bind(It),Wt=new class extends tr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,s,p){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const _=Ze(a.e.API_URL+a.e.SESSION_PATH);_.params.push(`sku=${n||""}`),_.params.push(`access_token=${p||a.e.ACCESS_TOKEN||""}`);const x={url:ht(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(x,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,n,s,p){this.skuToken=n,this.errorCb=p,a.e.SESSION_PATH&&a.e.API_URL&&(s||a.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(Mt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||this.getSession(s,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f)}remove(){this.errorCb=null}},be=Wt.getSessionAPI.bind(Wt),er=new Set;function cr(f,n){n?er.add(f):er.delete(f)}class pr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,s){this._updatedSourceCaches[n]=s,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const s=n.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(n.id),this.setDirty()}removeLayer(n){const s=n.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][n.id]=n,this._updatedLayers[s].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const s in this._updatedLayers)n[s]=n[s]||{},n[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)n[s]=n[s]||{},n[s].removedIds=Object.keys(this._removedLayers[s]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function lt(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class Lr extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new a.r({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,s){if(this.loaded[s]!==n&&(this.loaded[s]=n,n)){for(const{ids:p,callback:_}of this.requestors)this._notify(p,s,_);this.requestors=[]}}hasImage(n,s){return!!this.getImage(n,s)}getImage(n,s){return this.images[s][n]}addImage(n,s,p){this._validate(n,p)&&(this.images[s][n]=p)}_validate(n,s){let p=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new a.t(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new a.t(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(s.content,s)||(this.fire(new a.t(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,s){if(!n)return!0;let p=0;for(const _ of n){if(_[0]<p||_[1]<_[0]||s<_[1])return!1;p=_[1]}return!0}_validateContent(n,s){return!(n&&(n.length!==4||n[0]<0||s.data.width<n[0]||n[1]<0||s.data.height<n[1]||n[2]<0||s.data.width<n[2]||n[3]<0||s.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,s,p){p.version=this.images[s][n].version+1,this.images[s][n]=p,this.updatedImages[s][n]=!0}removeImage(n,s){const p=this.images[s][n];delete this.images[s][n],delete this.patterns[s][n],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,s,p){let _=!0;const x=!!this.loaded[s];if(!x)for(const w of n)this.images[s][w]||(_=!1);x||_?this._notify(n,s,p):this.requestors.push({ids:n,scope:s,callback:p})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,s,p){const _={};for(const x of n){this.images[s][x]||this.fire(new a.x("styleimagemissing",{id:x}));const w=this.images[s][x];w?_[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:a.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,_)}getPixelSize(n){const{width:s,height:p}=this.atlasImage[n];return{width:s,height:p}}getPattern(n,s,p){const _=this.patterns[s][n],x=this.getImage(n,s);if(!x)return null;if(_&&_.position.version===x.version)return _.position;if(_)_.position.version=x.version;else{const w={w:x.data.width+2*a.y,h:x.data.height+2*a.y,x:0,y:0},A=new a.I(w,x,a.y);this.patterns[s][n]={bin:w,position:A}}return this._updatePatternAtlas(s,p),this.patterns[s][n].position}bind(n,s){const p=n.gl;let _=this.atlasTexture[s];_?this.dirty&&(_.update(this.atlasImage[s]),this.dirty=!1):(_=new a.T(n,this.atlasImage[s],p.RGBA8),this.atlasTexture[s]=_),_.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,s){const p=[];for(const A in this.patterns[n])p.push(this.patterns[n][A].bin);const{w:_,h:x}=a.z(p),w=this.atlasImage[n];w.resize({width:_||1,height:x||1});for(const A in this.patterns[n]){const{bin:k,position:L}=this.patterns[n][A];let z=L.padding;const U=k.x+z,j=k.y+z,$=this.images[n][A].data,Y=$.width,K=$.height;z=z>1?z-1:z,a.r.copy($,w,{x:0,y:0},{x:U,y:j},{width:Y,height:K},s),a.r.copy($,w,{x:0,y:K-z},{x:U,y:j-z},{width:Y,height:z},s),a.r.copy($,w,{x:0,y:0},{x:U,y:j+K},{width:Y,height:z},s),a.r.copy($,w,{x:Y-z,y:0},{x:U-z,y:j},{width:z,height:K},s),a.r.copy($,w,{x:0,y:0},{x:U+Y,y:j},{width:z,height:K},s),a.r.copy($,w,{x:Y-z,y:K-z},{x:U-z,y:j-z},{width:z,height:z},s),a.r.copy($,w,{x:0,y:K-z},{x:U+Y,y:j-z},{width:z,height:z},s),a.r.copy($,w,{x:0,y:0},{x:U+Y,y:j+K},{width:z,height:z},s),a.r.copy($,w,{x:Y-z,y:0},{x:U-z,y:j+K},{width:z,height:z},s)}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,s){for(const p of n){if(this.callbackDispatchedThisFrame[s][p])continue;this.callbackDispatchedThisFrame[s][p]=!0;const _=this.images[s][p];lt(_)&&this.updateImage(p,s,_)}}}function br(f){const n=f.key,s=f.value,p=f.valueSpec||{},_=f.objectElementValidators||{},x=f.style,w=f.styleSpec;let A=[];const k=a.B(s);if(k!=="object")return[new a.V(n,s,`object expected, ${k} found`)];for(const L in s){const z=L.split(".")[0];let U;_[z]?U=_[z]:p[z]?U=Gr:_["*"]?U=_["*"]:p["*"]&&(U=Gr),U?A=A.concat(U({key:(n&&`${n}.`)+L,value:s[L],valueSpec:p[z]||p["*"],style:x,styleSpec:w,object:s,objectKey:L},s)):A.push(new a.A(n,s[L],`unknown property "${L}"`))}for(const L in p)_[L]||p[L].required&&p[L].default===void 0&&s[L]===void 0&&A.push(new a.V(n,s,`missing required property "${L}"`));return A}function Kr(f){const n=f.value,s=f.valueSpec,p=f.style,_=f.styleSpec,x=f.key,w=f.arrayElementValidator||Gr;if(a.B(n)!=="array")return[new a.V(x,n,`array expected, ${a.B(n)} found`)];if(s.length&&n.length!==s.length)return[new a.V(x,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new a.V(x,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let A={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};_.$version<7&&(A.function=s.function),a.B(s.value)==="object"&&(A=s.value);let k=[];for(let L=0;L<n.length;L++)k=k.concat(w({array:n,arrayIndex:L,value:n[L],valueSpec:A,style:p,styleSpec:_,key:`${x}[${L}]`},!0));return k}function sr(f){const n=f.key,s=f.value,p=f.valueSpec;let _=a.B(s);if(_==="number"&&s!=s&&(_="NaN"),_!=="number")return[new a.V(n,s,`number expected, ${_} found`)];if("minimum"in p){let x=p.minimum;if(a.B(p.minimum)==="array"&&(x=p.minimum[f.arrayIndex]),s<x)return[new a.V(n,s,`${s} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(a.B(p.maximum)==="array"&&(x=p.maximum[f.arrayIndex]),s>x)return[new a.V(n,s,`${s} is greater than the maximum value ${x}`)]}return[]}function Hr(f){const n=f.valueSpec,s=a.D(f.value.type);let p,_,x,w={};const A=s!=="categorical"&&f.value.property===void 0,k=!A,L=a.B(f.value.stops)==="array"&&a.B(f.value.stops[0])==="array"&&a.B(f.value.stops[0][0])==="object",z=br({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function($){if(s==="identity")return[new a.V($.key,$.value,'identity function may not have a "stops" property')];let Y=[];const K=$.value;return Y=Y.concat(Kr({key:$.key,value:K,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:U})),a.B(K)==="array"&&K.length===0&&Y.push(new a.V($.key,K,"array must have at least one stop")),Y},default:function($){return Gr({key:$.key,value:$.value,valueSpec:n,style:$.style,styleSpec:$.styleSpec})}}});return s==="identity"&&A&&z.push(new a.V(f.key,f.value,'missing required property "property"')),s==="identity"||f.value.stops||z.push(new a.V(f.key,f.value,'missing required property "stops"')),s==="exponential"&&f.valueSpec.expression&&!a.F(f.valueSpec)&&z.push(new a.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(k&&!a.G(f.valueSpec)?z.push(new a.V(f.key,f.value,"property functions not supported")):A&&!a.H(f.valueSpec)&&z.push(new a.V(f.key,f.value,"zoom functions not supported"))),s!=="categorical"&&!L||f.value.property!==void 0||z.push(new a.V(f.key,f.value,'"property" property is required')),z;function U($){let Y=[];const K=$.value,J=$.key;if(a.B(K)!=="array")return[new a.V(J,K,`array expected, ${a.B(K)} found`)];if(K.length!==2)return[new a.V(J,K,`array length 2 expected, length ${K.length} found`)];if(L){if(a.B(K[0])!=="object")return[new a.V(J,K,`object expected, ${a.B(K[0])} found`)];if(K[0].zoom===void 0)return[new a.V(J,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new a.V(J,K,"object stop key must have value")];const Q=a.D(K[0].zoom);if(typeof Q!="number")return[new a.V(J,K[0].zoom,"stop zoom values must be numbers")];if(x&&x>Q)return[new a.V(J,K[0].zoom,"stop zoom values must appear in ascending order")];Q!==x&&(x=Q,_=void 0,w={}),Y=Y.concat(br({key:`${J}[0]`,value:K[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:sr,value:j}}))}else Y=Y.concat(j({key:`${J}[0]`,value:K[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},K));return a.J(a.K(K[1]))?Y.concat([new a.V(`${J}[1]`,K[1],"expressions are not allowed in function stops.")]):Y.concat(Gr({key:`${J}[1]`,value:K[1],valueSpec:n,style:$.style,styleSpec:$.styleSpec}))}function j($,Y){const K=a.B($.value),J=a.D($.value),Q=$.value!==null?$.value:Y;if(p){if(K!==p)return[new a.V($.key,Q,`${K} stop domain type must match previous stop domain type ${p}`)]}else p=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new a.V($.key,Q,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&s!=="categorical"){let fe=`number expected, ${K} found`;return a.G(n)&&s===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V($.key,Q,fe)]}return s!=="categorical"||K!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&K==="number"&&typeof J=="number"&&typeof _=="number"&&_!==void 0&&J<_?[new a.V($.key,Q,"stop domain values must appear in ascending order")]:(_=J,s==="categorical"&&J in w?[new a.V($.key,Q,"stop domain values must be unique")]:(w[J]=!0,[])):[new a.V($.key,Q,`integer expected, found ${String(J)}`)]}}function mn(f){const n=(f.expressionContext==="property"?a.L:a.M)(a.K(f.value),f.valueSpec);if(n.result==="error")return n.value.map(p=>new a.V(`${f.key}${p.key}`,f.value,p.message));const s=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!s.outputDefined())return[new a.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!a.N(s))return[new a.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Er(s,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!a.O(s,["zoom","feature-state"]))return[new a.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!a.Q(s))return[new a.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Er(f,n){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)s.delete(_);if(s.size===0)return[];const p=[];return f instanceof a.S&&s.has(f.name)?[new a.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild(_=>{p.push(...Er(_,n))}),p)}function Gi(f){const n=f.key,s=f.value,p=f.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(a.D(s))===-1&&_.push(new a.V(n,s,`expected one of [${p.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(p.values).indexOf(a.D(s))===-1&&_.push(new a.V(n,s,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function ai(f){return a.W(a.K(f.value))?mn(a.C({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):hr(f)}function hr(f){const n=f.value,s=f.key;if(a.B(n)!=="array")return[new a.V(s,n,`array expected, ${a.B(n)} found`)];const p=f.styleSpec;let _,x=[];if(n.length<1)return[new a.V(s,n,"filter array must have at least 1 element")];switch(x=x.concat(Gi({key:`${s}[0]`,value:n[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),a.D(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&a.D(n[1])==="$type"&&x.push(new a.V(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&x.push(new a.V(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=a.B(n[1]),_!=="string"&&x.push(new a.V(`${s}[1]`,n[1],`string expected, ${_} found`)));for(let w=2;w<n.length;w++)_=a.B(n[w]),a.D(n[1])==="$type"?x=x.concat(Gi({key:`${s}[${w}]`,value:n[w],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new a.V(`${s}[${w}]`,n[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<n.length;w++)x=x.concat(hr({key:`${s}[${w}]`,value:n[w],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":_=a.B(n[1]),n.length!==2?x.push(new a.V(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new a.V(`${s}[1]`,n[1],`string expected, ${_} found`))}return x}function Po(f,n){const s=f.key,p=f.style,_=f.layer,x=f.styleSpec,w=f.value,A=f.objectKey,k=x[`${n}_${f.layerType}`];if(!k)return[];const L=A.match(/^(.*)-transition$/);if(n==="paint"&&L&&k[L[1]]&&k[L[1]].transition)return Gr({key:s,value:w,valueSpec:x.transition,style:p,styleSpec:x});const z=f.valueSpec||k[A];if(!z)return[new a.A(s,w,`unknown property "${A}"`)];let U;if(a.B(w)==="string"&&a.G(z)&&!z.tokens&&(U=/^{([^}]+)}$/.exec(w))){const $=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new a.V(s,w,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const j=[];if(f.layerType==="symbol")A!=="text-field"||!p||p.glyphs||p.imports||j.push(new a.V(s,w,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&a.X(a.K(w))&&a.D(w.type)==="identity"&&j.push(new a.V(s,w,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&a.G(z)&&(a.Y(z)||a.H(z))){const $=a.L(a.K(w),z),Y=$.value.expression||$.value._styleExpression.expression;Y&&!a.O(Y,["measure-light"])&&(A==="model-emissive-strength"&&a.Q(Y)&&a.N(Y)||j.push(new a.V(s,w,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Gr({key:f.key,value:w,valueSpec:z,style:p,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:A}))}function ao(f){return Po(f,"paint")}function so(f){return Po(f,"layout")}function hi(f){let n=[];const s=f.value,p=f.key,_=f.style,x=f.styleSpec;s.type||s.ref||n.push(new a.V(p,s,'either "type" or "ref" is required'));let w=a.D(s.type);const A=a.D(s.ref);if(s.id){const k=a.D(s.id);for(let L=0;L<f.arrayIndex;L++){const z=_.layers[L];a.D(z.id)===k&&n.push(new a.V(p,s.id,`duplicate layer id "${s.id}", previously used at line ${z.id.__line__}`))}}if("ref"in s){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in s&&n.push(new a.V(p,s[L],`"${L}" is prohibited for ref layers`))}),_.layers.forEach(L=>{a.D(L.id)===A&&(k=L)}),k?k.ref?n.push(new a.V(p,s.ref,"ref cannot reference another ref layer")):w=a.D(k.type):typeof A=="string"&&n.push(new a.V(p,s.ref,`ref layer "${A}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(s.source){const k=_.sources&&_.sources[s.source],L=k&&a.D(k.type);k?L==="vector"&&w==="raster"?n.push(new a.V(p,s.source,`layer "${s.id}" requires a raster source`)):L==="raster"&&w!=="raster"?n.push(new a.V(p,s.source,`layer "${s.id}" requires a vector source`)):L!=="vector"||s["source-layer"]?L==="raster-dem"&&w!=="hillshade"?n.push(new a.V(p,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||L==="geojson"&&k.lineMetrics?w==="raster-particle"&&L!=="raster-array"&&n.push(new a.V(p,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):n.push(new a.V(p,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new a.V(p,s.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new a.V(p,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new a.V(p,s.source,`source "${s.source}" not found`))}else n.push(new a.V(p,s,'missing required property "source"'));return n=n.concat(br({key:p,value:s,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gr({key:`${p}.type`,value:s.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:s,objectKey:"type"}),filter:k=>ai(a.C({layerType:w},k)),layout:k=>br({layer:s,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>so(a.C({layerType:w},L))}}),paint:k=>br({layer:s,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>ao(a.C({layerType:w,layer:s},L))}})}})),n}function wi(f){const n=f.value,s=f.key,p=a.B(n);return p!=="string"?[new a.V(s,n,`string expected, ${p} found`)]:[]}const kn={promoteId:function({key:f,value:n}){if(a.B(n)==="string")return wi({key:f,value:n});{const s=[];for(const p in n)s.push(...wi({key:`${f}.${p}`,value:n[p]}));return s}}};function aa(f){const n=f.value,s=f.key,p=f.styleSpec,_=f.style;if(!n.type)return[new a.V(s,n,'"type" is required')];const x=a.D(n.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(n.url||n.tiles||w.push(new a.A(s,n,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(br({key:s,value:n,valueSpec:p[`source_${x.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:kn})),w;case"geojson":if(w=br({key:s,value:n,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:kn}),n.cluster)for(const A in n.clusterProperties){const[k,L]=n.clusterProperties[A],z=typeof k=="string"?[k,["accumulated"],["get",A]]:k;w.push(...mn({key:`${s}.${A}.map`,value:L,expressionContext:"cluster-map"})),w.push(...mn({key:`${s}.${A}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return w;case"video":return br({key:s,value:n,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return br({key:s,value:n,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new a.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gi({key:`${s}.type`,value:n.type,valueSpec:{values:sa(p)},style:_,styleSpec:p})}}function sa(f){return f.source.reduce((n,s)=>{const p=f[s];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values))),n},[])}function la(f){const n=f.value,s=f.styleSpec,p=s.light,_=f.style;let x=[];const w=a.B(n);if(n===void 0)return x;if(w!=="object")return x=x.concat([new a.V("light",n,`object expected, ${w} found`)]),x;for(const A in n){const k=A.match(/^(.*)-transition$/);x=x.concat(k&&p[k[1]]&&p[k[1]].transition?Gr({key:A,value:n[A],valueSpec:s.transition,style:_,styleSpec:s}):p[A]?Gr({key:A,value:n[A],valueSpec:p[A],style:_,styleSpec:s}):[new a.V(A,n[A],`unknown property "${A}"`)])}return x}function kr(f){const n=f.value;let s=[];if(!n)return s;const p=a.B(n);if(p!=="object")return s=s.concat([new a.V("light-3d",n,`object expected, ${p} found`)]),s;const _=f.styleSpec,x=_["light-3d"],w=f.key,A=f.style,k=f.style.lights;for(const U of["type","id"])if(!(U in n))return s=s.concat([new a.V("light-3d",n,`missing property ${U} on light`)]),s;if(n.type&&k)for(let U=0;U<f.arrayIndex;U++){const j=a.D(n.type),$=k[U];a.D($.type)===j&&s.push(new a.V(w,n.id,`duplicate light type "${n.type}", previously defined at line ${$.id.__line__}`))}const L=`properties_light_${n.type}`;if(!(L in _))return s=s.concat([new a.V("light-3d",n,`Invalid light type ${n.type}`)]),s;const z=_[L];for(const U in n)if(U==="properties"){const j=n[U],$=a.B(j);if($!=="object")return s=s.concat([new a.V("properties",j,`object expected, ${$} found`)]),s;for(const Y in j)s=s.concat(z[Y]?Gr({key:Y,value:j[Y],valueSpec:z[Y],style:A,styleSpec:_}):[new a.A(f.key,j[Y],`unknown property "${Y}"`)])}else{const j=U.match(/^(.*)-transition$/);s=s.concat(j&&x[j[1]]&&x[j[1]].transition?Gr({key:U,value:n[U],valueSpec:_.transition,style:A,styleSpec:_}):x[U]?Gr({key:U,value:n[U],valueSpec:x[U],style:A,styleSpec:_}):[new a.A(U,n[U],`unknown property "${U}"`)])}return s}function Mn(f){const n=f.value,s=f.key,p=f.style,_=f.styleSpec,x=_.terrain;let w=[];const A=a.B(n);if(n===void 0||A==="null")return w;if(A!=="object")return w=w.concat([new a.V("terrain",n,`object expected, ${A} found`)]),w;for(const k in n){const L=k.match(/^(.*)-transition$/);w=w.concat(L&&x[L[1]]&&x[L[1]].transition?Gr({key:k,value:n[k],valueSpec:_.transition,style:p,styleSpec:_}):x[k]?Gr({key:k,value:n[k],valueSpec:x[k],style:p,styleSpec:_}):[new a.A(k,n[k],`unknown property "${k}"`)])}if(n.source){const k=p.sources&&p.sources[n.source],L=k&&a.D(k.type);k?L!=="raster-dem"&&w.push(new a.V(s,n.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):w.push(new a.V(s,n.source,`source "${n.source}" not found`))}else w.push(new a.V(s,n,'terrain is missing required property "source"'));return w}function On(f){const n=f.value,s=f.style,p=f.styleSpec,_=p.fog;let x=[];const w=a.B(n);if(n===void 0)return x;if(w!=="object")return x=x.concat([new a.V("fog",n,`object expected, ${w} found`)]),x;for(const A in n){const k=A.match(/^(.*)-transition$/);x=x.concat(k&&_[k[1]]&&_[k[1]].transition?Gr({key:A,value:n[A],valueSpec:p.transition,style:s,styleSpec:p}):_[A]?Gr({key:A,value:n[A],valueSpec:_[A],style:s,styleSpec:p}):[new a.A(A,n[A],`unknown property "${A}"`)])}return x}const ca={"*":()=>[],array:Kr,boolean:function(f){const n=f.value,s=f.key,p=a.B(n);return p!=="boolean"?[new a.V(s,n,`boolean expected, ${p} found`)]:[]},number:sr,color:function(f){const n=f.key,s=f.value,p=a.B(s);return p!=="string"?[new a.V(n,s,`color expected, ${p} found`)]:a.U.parseCSSColor(s)===null?[new a.V(n,s,`color expected, "${s}" found`)]:[]},enum:Gi,filter:ai,function:Hr,layer:hi,object:br,source:aa,model:a.Z,light:la,"light-3d":kr,terrain:Mn,fog:On,string:wi,formatted:function(f){return wi(f).length===0?[]:mn(f)},resolvedImage:function(f){return wi(f).length===0?[]:mn(f)},projection:function(f){const n=f.value,s=f.styleSpec,p=s.projection,_=f.style;let x=[];const w=a.B(n);if(w==="object")for(const A in n)x=x.concat(Gr({key:A,value:n[A],valueSpec:p[A],style:_,styleSpec:s}));else w!=="string"&&(x=x.concat([new a.V("projection",n,`object or string expected, ${w} found`)]));return x},import:function(f){const{value:n,styleSpec:s}=f,{data:p,..._}=n;Object.defineProperty(_,"__line__",{value:n.__line__,enumerable:!1});let x=br(a.C({},f,{value:_,valueSpec:s.import}));return a.D(_.id)===""&&x.push(new a.V(`${f.key}.id`,_,"import id can't be an empty string")),p&&(x=x.concat(Ad(p,s,{key:`${f.key}.data`}))),x}};function Gr(f,n=!1){const s=f.value,p=f.valueSpec,_=f.styleSpec;if(p.expression&&a.X(a.D(s)))return Hr(f);if(p.expression&&a.J(a.K(s)))return mn(f);if(p.type&&ca[p.type]){const x=ca[p.type](f);return n===!0&&x.length>0&&a.B(f.value)==="array"?mn(f):x}return br(a.C({},f,{valueSpec:p.type?_[p.type]:p}))}function Ka(f){const n=f.value,s=f.key,p=wi(f);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new a.V(s,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new a.V(s,n,'"glyphs" url must include a "{range}" token'))),p}function Ad(f,n=a._,s={}){return Gr({key:s.key||"",value:f,valueSpec:n.$root,styleSpec:n,style:f,objectElementValidators:{glyphs:Ka,"*":()=>[]}})}function Go(f,n=a._){return Ae(Ad(f,n))}const zl=f=>Ae(aa(f)),th=f=>Ae(la(f)),Sc=f=>Ae(kr(f)),rh=f=>Ae(Mn(f)),Fl=f=>Ae(On(f)),Ke=f=>Ae(hi(f)),ee=f=>Ae(ai(f)),ae=f=>Ae(ao(f)),Se=f=>Ae(so(f)),Re=f=>Ae(a.Z(f));function Ae(f){return f.slice().sort((n,s)=>n.line&&s.line?n.line-s.line:0)}function Ue(f,n){let s=!1;if(n&&n.length)for(const p of n)p instanceof a.A?a.w(p.message):(f.fire(new a.t(new Error(p.message))),s=!0);return s}let Ye;class Ge extends a.E{constructor(n,s="flat"){super(),this._transitionable=new a.$(Ye||(Ye=new a.a0({anchor:new a.a1(a._.light.anchor),position:new a.a2(a._.light.position),color:new a.a1(a._.light.color),intensity:new a.a1(a._.light.intensity)}))),this.setLight(n,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s,p={}){this._validate(th,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=s)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,p){return(!p||p.validate!==!1)&&Ue(this,n.call(Go,a.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a._})))}}const Xe=new a.a0({source:new a.a1(a._.terrain.source),exaggeration:new a.a1(a._.terrain.exaggeration)});let st=class extends a.E{constructor(f,n,s,p){super(),this.scope=s,this._transitionable=new a.$(Xe,s,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new a.a3(f)).get("exaggeration")}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof a.a4}};const it=45,bt=65,Ut=.05;function jt(f,n,s,p){const _=a.a7(it,bt,s),[x,w]=_r(f,p);let A=1-Math.min(1,Math.exp((n-x)/(w-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*_*f.alpha}function _r(f,n){const s=.5/Math.tan(.5*n);return[f.range[0]+s,f.range[1]+s]}function vr(f,n,s,p,_){const x=a.a6.vec3.transformMat4([],[n,s,p],_.mercatorFogMatrix);return jt(f,a.a6.vec3.length(x),_.pitch,_._fov)}function wr(f,n,s,p,_,x,w){const A=[[s,p,0],[_,p,0],[_,x,0],[s,x,0]];let k=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const z of A){const U=a.a6.vec3.transformMat4([],z,n),j=a.a6.vec3.length(U);k=Math.min(k,j),L=Math.max(L,j)}return[jt(f,k,w.pitch,w._fov),jt(f,L,w.pitch,w._fov)]}const xr=new a.a0({range:new a.a1(a._.fog.range),color:new a.a1(a._.fog.color),"high-color":new a.a1(a._.fog["high-color"]),"space-color":new a.a1(a._.fog["space-color"]),"horizon-blend":new a.a1(a._.fog["horizon-blend"]),"star-intensity":new a.a1(a._.fog["star-intensity"]),"vertical-range":new a.a1(a._.fog["vertical-range"])});class cn extends a.E{constructor(n,s,p,_){super(),this._transitionable=new a.$(xr,p,new Map(_)),this.set(n,_),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new a.a8(xr),this.scope=p}get state(){const n=this._transform,s=n.projection.name==="globe",p=a.a9(n.zoom),_=this.properties.get("range"),x=[.5,3];return{range:s?[a.aa(x[0],_[0],p),a.aa(x[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,s,p={}){if(this._validate(Fl,n,p))return;const _=a.l({},n);for(const x of Object.keys(a._.fog))_[x]===void 0&&(_[x]=a._.fog[x].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a7(it,bt,n))*s.a}getOpacityAtLatLng(n,s){return this._transform.projection.supportsFog?function(p,_,x){const w=a.a5.fromLngLat(_),A=x.elevation?x.elevation.getAtPointOrZero(w):0;return vr(p,w.x,w.y,A,x)}(this.state,n,s):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(n.toUnwrapped());return wr(this.state,s,0,0,a.ab,a.ab,this._transform)}getOpacityForBounds(n,s,p,_,x){return this._transform.projection.supportsFog?wr(this.state,n,s,p,_,x,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?_r(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const p of s){const _=n.points[p];let x;if(_[2]>=0)x=_;else{const w=n.points[p-4];x=a.ac(w,_,w[2]/(w[2]-_[2]))}if(vr(this.state,x[0],x[1],0,this._transform)>=Ut)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,p){return(!p||p.validate!==!1)&&Ue(this,n.call(Go,a.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a._})))}}class gn extends a.E{constructor(n,s,p,_){super(),this.scope=p,this._options=n,this.properties=new a.a8(s),this._transitionable=new a.$(s,p,new Map(_)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,s){this._options=n,this._transitionable.setTransitionOrValue(n.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Ir,fn;class Un{constructor(n,s,p,_){this.screenBounds=n,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,s){let p,_;if(n instanceof a.P||typeof n[0]=="number"){const x=a.P.convert(n);p=[x],_=s.isPointAboveHorizon(x)}else{const x=a.P.convert(n[0]),w=a.P.convert(n[1]);p=[x,w],_=a.ae(x,w).every(A=>s.isPointAboveHorizon(A))}return new Un(p,s.getCameraPoint(),_,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return a.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const s=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ae(s,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(_[3]=this.cameraPoint)),a.af(_,n)}bufferedCameraGeometryGlobe(n){const s=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ae(s,p,n),x=this.cameraPoint.clone();switch(3*((x.y>s.y)+(x.y>p.y))+((x.x>s.x)+(x.x>p.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(n,s,p,_=0){const x=n.queryPadding/s._pixelsPerMercatorPixel+1,w=p?this._bufferedCameraMercator(x,s):this._bufferedScreenMercator(x,s);let A=n.tileID.wrap+(w.unwrapped?_:0);const k=w.polygon.map(J=>a.ag(n.tileTransform,J,A));if(!a.ah(k,0,0,a.ab,a.ab))return;A=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const L=this.screenGeometryMercator.polygon.map(J=>a.ai(n.tileTransform,J,A)),z=L.map(J=>new a.P(J[0],J[1])),U=s.getFreeCameraOptions().position||new a.a5(0,0,0),j=a.ai(n.tileTransform,U,A),$=L.map(J=>{const Q=a.a6.vec3.sub(J,J,j);return a.a6.vec3.normalize(Q,Q),new a.aj(j,Q)}),Y=a.ak(n,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:$,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(K=a.al(k),K.min.x=a.ap(K.min.x,0,a.ab),K.min.y=a.ap(K.min.y,0,a.ab),K.max.x=a.ap(K.max.x,0,a.ab),K.max.y=a.ap(K.max.y,0,a.ab),K),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Y};var K}_bufferedScreenMercator(n,s){const p=Hi(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),s):{polygon:this.bufferedScreenGeometry(n).map(x=>s.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(n,s){const p=Hi(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),s):{polygon:this.bufferedCameraGeometry(n).map(x=>s.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(n,s){const p=function(x,w){const A=a.a6.mat4.multiply([],w.pixelMatrix,w.globeMatrix),k=[0,-a.aq,0,1],L=[0,a.aq,0,1],z=[0,0,0,1];a.a6.vec4.transformMat4(k,k,A),a.a6.vec4.transformMat4(L,L,A),a.a6.vec4.transformMat4(z,z,A);const U=new a.P(k[0]/k[3],k[1]/k[3]),j=new a.P(L[0]/L[3],L[1]/L[3]),$=a.an(x,U)&&k[3]<z[3],Y=a.an(x,j)&&L[3]<z[3];if(!$&&!Y)return null;const K=function(Ie,Ee,Pe){for(let ze=1;ze<Ie.length;ze++){const ke=Si(Ee.pointCoordinate3D(Ie[ze-1]).x),De=Si(Ee.pointCoordinate3D(Ie[ze]).x);if(Pe<0){if(ke<De)return{idx:ze,t:-ke/(De-1-ke)}}else if(De<ke)return{idx:ze,t:(1-ke)/(De+1-ke)}}return null}(x,w,$?-1:1);if(!K)return null;const{idx:J,t:Q}=K;let fe=J>1?yi(x.slice(0,J),w):[],ge=J<x.length?yi(x.slice(J),w):[];fe=fe.map(Ie=>new a.P(Si(Ie.x),Ie.y)),ge=ge.map(Ie=>new a.P(Si(Ie.x),Ie.y));const he=[...fe];he.length===0&&he.push(ge[ge.length-1]);const xe=a.aa(he[he.length-1].y,(ge.length===0?fe[0]:ge[0]).y,Q);let ve;return ve=$?[new a.P(0,xe),new a.P(0,0),new a.P(1,0),new a.P(1,xe)]:[new a.P(1,xe),new a.P(1,1),new a.P(0,1),new a.P(0,xe)],he.push(...ve),ge.length===0?he.push(fe[0]):he.push(...ge),{polygon:he.map(Ie=>new a.a5(Ie.x,Ie.y)),unwrapped:!1}}(n,s);if(p)return p;const _=function(x,w){let A=!1,k=-1/0,L=0;for(let U=0;U<x.length-1;U++)x[U].x>k&&(k=x[U].x,L=U);for(let U=0;U<x.length-1;U++){const j=(L+U)%(x.length-1),$=x[j],Y=x[j+1];Math.abs($.x-Y.x)>.5&&($.x<Y.x?($.x+=1,j===0&&(x[x.length-1].x+=1)):(Y.x+=1,j+1===x.length-1&&(x[0].x+=1)),A=!0)}const z=a.am(w.center.lng);return A&&z<Math.abs(z-1)&&x.forEach(U=>{U.x-=1}),{polygon:x,unwrapped:A}}(yi(n,s).map(x=>new a.P(Si(x.x),x.y)),s);return{polygon:_.polygon.map(x=>new a.a5(x.x,x.y)),unwrapped:_.unwrapped}}}function yi(f,n){return a.ao(f,s=>{const p=n.pointCoordinate3D(s);s.x=p.x,s.y=p.y},1/256)}function Si(f){return f<0?1+f%1:f%1}function Hi(f){return 100*f|0}function Ca(f,n,s,p,_){const x=function(A,k){if(A)return _(A);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return _(new Error("variants must be an array"));for(const z of k.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return _(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){k=a.l(k,z);break}}}const L=a.ar(a.l(k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(z=>z.id)),k.raster_layers&&(L.rasterLayers=k.raster_layers,L.rasterLayerIds=L.rasterLayers.map(z=>z.id)),L.tiles=n.canonicalizeTileset(L,f.url),_(null,L)}},w=function(A,k,L){if(!A)return null;if(!k&&!L)return A;L=L||A.worldview_default;const z=Object.values(A.language||{});if(z.length===0)return null;const U=Object.values(A.worldview||{});if(U.length===0)return null;const j=z.every(Y=>Y===k),$=U.every(Y=>Y===L);return j&&$?A:k in(A.language_options||{})||L in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(f.data,s,p);return w?a.q.frame(()=>x(null,w)):f.url?a.n(n.transformRequest(n.normalizeSourceURL(f.url,null,s,p),a.R.Source),x):a.q.frame(()=>{const{data:A,...k}=f;x(null,k)})}class Ss{constructor(n,s,p){this.bounds=a.as.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const s=Math.pow(2,n.z),p=Math.floor(a.am(this.bounds.getWest())*s),_=Math.floor(a.at(this.bounds.getNorth())*s),x=Math.ceil(a.am(this.bounds.getEast())*s),w=Math.ceil(a.at(this.bounds.getSouth())*s);return n.x>=p&&n.x<x&&n.y>=_&&n.y<w}}class Dd extends a.E{constructor(n,s,p,_){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.l(this,a.ar(s,["url","scheme","tileSize","promoteId"])),this._options=a.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new a.au}load(n){this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Ca(this._options,this.map._requestManager,s,p,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new a.t(_))):x&&(a.l(this,x),x.bounds&&(this.tileBounds=new Ss(x.bounds,this.minzoom,this.maxzoom)),Nr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))),n&&n(_)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=a.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return a.l({},this._options)}loadTile(n,s){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),_=this.map._requestManager.transformRequest(p,a.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w={request:_,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(w.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=s:n.request=n.actor.send("reloadTile",w,A.bind(this));else if(n.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",w,A.bind(this),void 0,!0);else{const k=a.aw.call({deduped:this._deduped},w,(L,z)=>{L||!z?A.call(this,L):(w.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},n.actor&&n.actor.send("loadTile",w,A.bind(this),void 0,!0))},!0);n.request={cancel:k}}function A(k,L){return delete n.request,n.aborted?s(null):k&&k.status!==404?s(k):(L&&L.resourceTiming&&(n.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&n.setExpiryData(L),n.loadVectorData(L,this.map.painter),a.ax(this.dispatcher),s(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,s){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class nh extends a.E{constructor(n,s,p,_){super(),this.id=n,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.l({type:"raster"},s),a.l(this,a.ar(s,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Ca(this._options,this.map._requestManager,null,null,(s,p)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new a.t(s)):p&&(a.l(this,p),p.bounds&&(this.tileBounds=new Ss(p.bounds,this.minzoom,this.maxzoom)),Nr(p.tiles),this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))),n&&n(s)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=a.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return a.l({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,s){const p=a.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=a.o(this.map._requestManager.transformRequest(_,a.R.Tile),(x,w,A,k)=>(delete n.request,n.aborted?(n.state="unloaded",s(null)):x?(n.state="errored",s(x)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:k}),n.setTexture(w,this.map.painter),n.state="loaded",a.ax(this.dispatcher),void s(null)):s(null)))}abortTile(n,s){n.request&&(n.request.cancel(),delete n.request),s&&s()}unloadTile(n,s){n.texture&&n.texture instanceof a.T?(n.destroy(!0),n.texture&&n.texture instanceof a.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Tc extends nh{constructor(n,s,p,_){super(n,s,p,_),this.type="raster-array",this.maxzoom=22,this._options=a.l({type:"raster-array"},s)}triggerRepaint(n){const s=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);s&&s.enabled&&p&&s._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,s){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,a.R.Tile);n.requestParams=_,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(x,w,A,k)=>{if(delete n.request,n.aborted)return n.state="unloaded",s(null);if(x)return x.code===20?void 0:(n.state="errored",s(x));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:k}),n.state="empty",s(null)})}unloadTile(n,s){const p=n.texture;p&&p instanceof a.T?(n.destroy(!0),this.map.painter.saveTileTexture(p)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,s,p){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(s,p,(_,x)=>{if(_)return n.state="errored",this.fire(new a.t(_)),void this.triggerRepaint(n);x&&(n.setTexture(x,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:x})=>x===n),p=s&&s.fields,_=p&&p.bands&&p.bands;return _?_[0]:0}getTextureDescriptor(n,s,p){if(!n)return;const _=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let x=null;s instanceof a.aB?x=s.paint.get("raster-array-band"):s instanceof a.aC&&(x=s.paint.get("raster-particle-array-band"));const w=x||this.getInitialBand(_);if(w!=null)if(n.textureDescriptor){if(!n.updateNeeded(_,w)||p)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,_,w)}}const Rd={vector:Dd,raster:nh,"raster-dem":class extends nh{constructor(f,n,s,p){super(f,n,s,p),this.type="raster-dem",this.maxzoom=22,this._options=a.l({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(f.state="errored",n(_)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=a.o(this.map._requestManager.transformRequest(s,a.R.Tile),(function(_,x,w,A){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(_)f.state="errored",n(_);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:w,expires:A});const k=ImageBitmap&&x instanceof ImageBitmap&&a.ay(),L=1-(x.width-a.az(x.width))/2;L<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const z=k?x:a.q.getImageData(x,L),U={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:L};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,s=Math.pow(2,n.z),p=(n.x-1+s)%s,_=n.x===0?f.wrap-1:f.wrap,x=(n.x+1+s)%s,w=n.x+1===s?f.wrap+1:f.wrap,A={};return A[new a.aA(f.overscaledZ,_,n.z,p,n.y).key]={backfilled:!1},A[new a.aA(f.overscaledZ,w,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(A[new a.aA(f.overscaledZ,_,n.z,p,n.y-1).key]={backfilled:!1},A[new a.aA(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new a.aA(f.overscaledZ,w,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<s&&(A[new a.aA(f.overscaledZ,_,n.z,p,n.y+1).key]={backfilled:!1},A[new a.aA(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new a.aA(f.overscaledZ,w,n.z,x,n.y+1).key]={backfilled:!1}),A}},"raster-array":Tc,geojson:class extends a.E{constructor(f,n,s,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(p),this._data=n.data,this._options=a.l({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=a.ab/this.tileSize;this.workerOptions=a.l({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:a.ab,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.ab,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new a.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new a.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const s of this._data.features)n.set(s.id,s);for(const s of f.features)n.set(s.id,s);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,s,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:s},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.x("dataloading",{dataType:"source"})),this._loaded=!1;const n=a.l({append:f},this.workerOptions);n.scope=this.scope;const s=this._data;typeof s=="string"?(n.request=this.map._requestManager.transformRequest(a.q.resolveURL(s),a.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,_)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new a.t(p));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new a.x("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,n){const s=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,_=this._partialReload,x={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p?{image:p.image.clone()}:null,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:_};f.request=this.actor.send(s,x,(w,A)=>_&&!A?(f.state="loaded",n(null)):(delete f.request,f.destroy(),f.aborted?n(null):w?n(w):(f.loadVectorData(A,this.map.painter,s==="reloadTile"),n(null))),void 0,s==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aD{constructor(f,n,s,p){super(f,n,s,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.R.Source).url);a.aE(this.urls,(n,s)=>{this._loaded=!0,n?this.fire(new a.t(n)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new a.t(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aD,model:class extends a.E{constructor(f,n,s,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const f=[];for(const n in this._options.models){const s=this._options.models[n],p=a.aG(this.map._requestManager.transformRequest(s.uri,a.R.Model).url).then(_=>{if(!_)return;const x=a.aH(_),w=new a.aI(n,s.position,s.orientation,x);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(_=>{this.fire(new a.t(new Error(`Could not load model ${n} from ${s.uri}: ${_.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new a.t(new Error(`Could not load models: ${n.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,n){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(f,n,s,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=Ca(this._options,this.map._requestManager,n,s,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new a.t(p))):_&&(a.l(this,_),_.bounds&&(this.tileBounds=new Ss(_.bounds,this.minzoom,this.maxzoom)),Nr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(s,a.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const x=Object.values(f.buckets);for(const w of x)w.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,_.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,_.bind(this),void 0,!0);function _(x,w){return f.aborted?n(null):x&&x.status!==404?n(x):(w&&(w.resourceTiming&&(f.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(w),f.buckets={...f.buckets,...w.buckets},w.featureIndex&&(f.latestFeatureIndex=w.featureIndex)),f.state="loaded",void n(null))}}serialize(){return a.l({},this._options)}},canvas:class extends a.aD{constructor(f,n,s,p){super(f,n,s,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new a.t(new a.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.t(new a.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.t(new a.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.t(new a.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.t(new a.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof a.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends a.E{constructor(f,n,s,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ss(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),a.l(this,a.ar(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new a.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:s,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:s,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:s,y:p,z:_}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:s,y:p,z:_},{signal:x.signal})).then((function(w){return delete f.request,f.aborted?(f.state="unloaded",n(null)):w===void 0?(f.state="errored",n(null)):w===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(w)?(this.loadTileData(f,w),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(f.state="errored",n(w))}),f.request.cancel=()=>x.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof a.T?(f.destroy(!0),f.texture&&f.texture instanceof a.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:s,y:p,z:_}=f.tileID.canonical;this._implementation.unloadTile({x:s,y:p,z:_})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=a.av(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new a.x("data",{dataType:"source",sourceDataType:"content"}))}}},Ec=function(f,n,s,p){const _=new Rd[n.type](f,n,s,p);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return a.aJ(["load","abort","unload","serialize","prepare"],_),_};function nm(f,n){const s=a.a6.mat4.identity([]);return a.a6.mat4.scale(s,s,[.5*f.width,.5*-f.height,1]),a.a6.mat4.translate(s,s,[1,-1,0]),a.a6.mat4.multiply(s,s,f.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(s)}function im(f,n,s,p,_,x,w,A=!1){const k=f.tilesIn(p,w,A);k.sort(Mc);const L=[];for(const U of k)L.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(n,s,f._state,U,_,x,nm(f.transform,U.tile.tileID),A)});const z=function(U){const j={},$={};for(const Y of U){const K=Y.queryResults,J=Y.wrappedTileID,Q=$[J]=$[J]||{};for(const fe in K){const ge=K[fe],he=Q[fe]=Q[fe]||{},xe=j[fe]=j[fe]||[];for(const ve of ge)he[ve.featureIndex]||(he[ve.featureIndex]=!0,xe.push(ve))}}return j}(L);for(const U in z)z[U].forEach(j=>{const $=j.feature,Y=$.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&Y.type!=="slot"&&($.source=Y.source,Y["source-layer"]&&($.sourceLayer=Y["source-layer"]),$.state=$.id!==void 0?f.getFeatureState(Y["source-layer"],$.id):{})});return z}function ih(f,n){const s=f.getRenderableIds().map(x=>f.getTileByID(x)),p=[],_={};for(let x=0;x<s.length;x++){const w=s[x],A=w.tileID.canonical.key;_[A]||(_[A]=!0,w.querySourceFeatures(p,n))}return p}function Mc(f,n){const s=f.tileID,p=n.tileID;return s.overscaledZ-p.overscaledZ||s.canonical.y-p.canonical.y||s.wrap-p.wrap||s.canonical.x-p.canonical.x}const ua=32,Ia=33,Pa=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,s=0,p=0,_=0,x=0,w=0,A=0;for(1&n?_=x=w=ua:s=p=A=ua;(n>>=1)>1;){const L=s+_>>1,z=p+x>>1;1&n?(_=s,x=p,s=w,p=A):(s=_,p=x,_=w,x=A),w=L,A=z}const k=4*f;Pa[k+0]=s,Pa[k+1]=p,Pa[k+2]=_,Pa[k+3]=x}const Ao=new Uint16Array(2178),Ja=new Uint8Array(1089),oh=new Uint16Array(1089);function om(f){return f===0?-.03125:f===32?.03125:0}const am={type:2,extent:a.ab,loadGeometry:()=>[[new a.P(0,0),new a.P(a.ab+1,0),new a.P(a.ab+1,a.ab+1),new a.P(0,a.ab+1),new a.P(0,0)]]};class Qa{constructor(n,s,p,_,x){this.tileID=n,this.uid=a.aP(),this.uses=0,this.tileSize=s,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(n){const s=n+this.timeAdded;s<a.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(_,x){const w={};if(!x)return w;for(const A of _){const k=A.layerIds.map(L=>x.getLayer(L)).filter(Boolean);if(k.length!==0){A.layers=k,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(L=>k.filter(z=>z.id===L)[0]));for(const L of k)w[L.fqid]=A}}return w}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof a.aR){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof a.aR&&x.hasRTLText){this.hasRTLText=!0,a.aS();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_],w=s.style.getOwnLayer(_);if(!w)continue;const A=w.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,A)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new a.aQ}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const _ in this.buckets){const x=this.buckets[_];x.uploadPending()&&x.upload(n)}const s=n.gl,p=this.imageAtlas;if(p&&!p.uploaded){const _=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new a.T(n,p.image,s.RGBA8,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(n,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(n,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(n,s,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=s.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(s)))}queryRenderedFeatures(n,s,p,_,x,w,A,k){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:A,transform:w,params:x,tileTransform:this.tileTransform},n,s,p):{}}querySourceFeatures(n,s){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=s?s.sourceLayer:"",w=_._geojsonTileLayer||_[x];if(!w)return;const A=a.aT(s&&s.filter),{z:k,x:L,y:z}=this.tileID.canonical,U={z:k,x:L,y:z};for(let j=0;j<w.length;j++){const $=w.feature(j);if(A.needGeometry){const J=a.aU($,!0);if(!A.filter(new a.a3(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!A.filter(new a.a3(this.tileID.overscaledZ),$))continue;const Y=p.getId($,x),K=new a.aV($,k,L,z,Y);K.tile=U,n.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const p=a.aW(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{const x=this.expirationTime-s;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&s&&this.updateBuckets(s)}updateBuckets(n){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),p=n.style.listImages(),_=n.style.getBrightness();for(const x in this.buckets){if(!n.style.hasLayer(x))continue;const w=this.buckets[x],A=w.layers[0].sourceLayer||"_geojsonTileLayer",k=s[A],L=n.style.getOwnSourceCache(w.layers[0].source);let z={};L&&(z=L._state.getState(A,void 0)),w.update(z,k,p,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),(w instanceof a.aX||w instanceof a.aY)&&n._terrain&&n._terrain.enabled&&L&&w.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(L.id,this.tileID);const U=n&&n.style&&n.style.getOwnLayer(x);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=a.q.now()+n}setTexture(n,s){const p=s.context,_=p.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof a.T?this.texture.update(n):(this.texture=new a.T(p,n,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(n,s){const p={};for(const _ of s)p[_]=!0;this.dependencies[n]=p}hasDependency(n,s){for(const p of n){const _=this.dependencies[p];if(_){for(const x of s)if(_[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const p=a.aZ(am,this.tileID.canonical,this.tileTransform)[0],_=new a.a_,x=new a.a$;for(let w=0;w<p.length;w++){const{x:A,y:k}=p[w];_.emplaceBack(A,k),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(_,a.b0.members),this._tileDebugSegments=a.b1.simpleSegment(0,0,_.length,x.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const p=a.aZ(am,this.tileID.canonical,this.tileTransform)[0];let _,x;if(this.isRaster){const w=function(A,k){const L=a.aK(A,k),z=Math.pow(2,A.z);for(let J=0;J<Ia;J++)for(let Q=0;Q<Ia;Q++){const fe=a.aL((A.x+(Q+om(Q))/ua)/z),ge=a.aM((A.y+(J+om(J))/ua)/z),he=k.project(fe,ge),xe=J*Ia+Q;Ao[2*xe+0]=Math.round((he.x*L.scale-L.x)*a.ab),Ao[2*xe+1]=Math.round((he.y*L.scale-L.y)*a.ab)}Ja.fill(0),oh.fill(0);for(let J=2045;J>=0;J--){const Q=4*J,fe=Pa[Q+0],ge=Pa[Q+1],he=Pa[Q+2],xe=Pa[Q+3],ve=fe+he>>1,Ie=ge+xe>>1,Ee=ve+Ie-ge,Pe=Ie+fe-ve,ze=ge*Ia+fe,ke=xe*Ia+he,De=Ie*Ia+ve,$e=Math.hypot((Ao[2*ze+0]+Ao[2*ke+0])/2-Ao[2*De+0],(Ao[2*ze+1]+Ao[2*ke+1])/2-Ao[2*De+1])>=16;Ja[De]=Ja[De]||($e?1:0),J<1022&&(Ja[De]=Ja[De]||Ja[(ge+Pe>>1)*Ia+(fe+Ee>>1)]||Ja[(xe+Pe>>1)*Ia+(he+Ee>>1)])}const U=new a.aN,j=new a.aO;let $=0;function Y(J,Q){const fe=Q*Ia+J;return oh[fe]===0&&(U.emplaceBack(Ao[2*fe+0],Ao[2*fe+1],J*a.ab/ua,Q*a.ab/ua),oh[fe]=++$),oh[fe]-1}function K(J,Q,fe,ge,he,xe){const ve=J+fe>>1,Ie=Q+ge>>1;if(Math.abs(J-he)+Math.abs(Q-xe)>1&&Ja[Ie*Ia+ve])K(he,xe,J,Q,ve,Ie),K(fe,ge,he,xe,ve,Ie);else{const Ee=Y(J,Q),Pe=Y(fe,ge),ze=Y(he,xe);j.emplaceBack(Ee,Pe,ze)}}return K(0,0,ua,ua,ua,0),K(ua,ua,0,0,0,ua),{vertices:U,indices:j}}(this.tileID.canonical,s);_=w.vertices,x=w.indices}else{_=new a.aN,x=new a.aO;for(const{x:A,y:k}of p)_.emplaceBack(A,k,0,0);const w=a.b2(_.int16,void 0,4);for(let A=0;A<w.length;A+=3)x.emplaceBack(w[A],w[A+1],w[A+2])}this._tileBoundsBuffer=n.createVertexBuffer(_,a.b3.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(x),this._tileBoundsSegments=a.b1.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugBuffers(n,s){const p=s.projection;if(!p||p.name!=="globe"||s.freezeTileCoverage)return;const _=this.tileID.canonical,x=a.b4(_,s),w=a.b5(x),A=a.a9(s.zoom);let k;A>0&&(k=a.a6.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,_,s,w,k,A),this._makeGlobeTileDebugTextBuffer(n,_,s,w,k,A)}_globePoint(n,s,p,_,x,w,A){let k=a.b6(n,s,p);if(w){const L=1<<p.z,z=a.am(_.center.lng),U=a.at(_.center.lat),j=(p.x+.5)/L-z;let $=0;j>.5?$=-1:j<-.5&&($=1);let Y=(n/a.ab+p.x)/L+$,K=(s/a.ab+p.y)/L;Y=(Y-z)*_._pixelsPerMercatorPixel+z,K=(K-U)*_._pixelsPerMercatorPixel+U;const J=[Y*_.worldSize,K*_.worldSize,0];a.a6.vec3.transformMat4(J,J,w),k=a.b7(k,J,A)}return a.a6.vec3.transformMat4(k,k,x)}_makeGlobeTileDebugBorderBuffer(n,s,p,_,x,w){const A=new a.a_,k=new a.a$,L=new a.b8,z=(j,$,Y,K,J)=>{const Q=(Y-j)/(J-1),fe=(K-$)/(J-1),ge=A.length;for(let he=0;he<J;he++){const xe=j+he*Q,ve=$+he*fe;A.emplaceBack(xe,ve);const Ie=this._globePoint(xe,ve,s,p,_,x,w);L.emplaceBack(Ie[0],Ie[1],Ie[2]),k.emplaceBack(ge+he)}},U=a.ab;z(0,0,U,0,16),z(U,0,U,U,16),z(U,U,0,U,16),z(0,U,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(k),this._tileDebugBuffer=n.createVertexBuffer(A,a.b0.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(L,a.b9.members),this._tileDebugSegments=a.b1.simpleSegment(0,0,A.length,k.length)}_makeGlobeTileDebugTextBuffer(n,s,p,_,x,w){const A=a.ab/4,k=new a.a_,L=new a.aO,z=new a.b8,U=25;L.reserve(32),k.reserve(U),z.reserve(U);const j=($,Y)=>U*$+Y;for(let $=0;$<U;$++){const Y=$*A;for(let K=0;K<U;K++){const J=K*A;k.emplaceBack(J,Y);const Q=this._globePoint(J,Y,s,p,_,x,w);z.emplaceBack(Q[0],Q[1],Q[2])}}for(let $=0;$<4;$++)for(let Y=0;Y<4;Y++){const K=j($,Y),J=j($,Y+1),Q=j($+1,Y),fe=j($+1,Y+1);L.emplaceBack(K,J,Q),L.emplaceBack(Q,J,fe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(L),this._tileDebugTextBuffer=n.createVertexBuffer(k,a.b0.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(z,a.b9.members),this._tileDebugTextSegments=a.b1.simpleSegment(0,0,U,32)}destroy(n=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.ba.setPbf(a.bb);class kd extends Qa{constructor(n,s,p,_,x){super(n,s,p,_,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,s){const p=s.context,_=p.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof a.T?this.texture.update(n,{premultiply:!1}):this.texture=new a.T(p,n,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,s){const p=this._mrt=new a.ba(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=a.bc(_,(x,w,A,k)=>{if(x)s(x);else try{const L=p.getHeaderLength(w);if(L>n)return void(this.request=this.fetchHeader(L,s));p.parseHeader(w),this._isHeaderLoaded=!0;let z=0;for(const U of Object.values(p.layers))z=Math.max(z,U.dataIndex[U.dataIndex.length-1].last_byte);w.byteLength>=z&&(this.entireBuffer=w),s(null,this.entireBuffer||w,A,k)}catch(L){s(L)}}),this.request}fetchBand(n,s,p){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void p(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void p(new Error("Can't fetch tile band without an actor"));let w;const A=(U,j)=>{w.complete(U,j),U?p(U):(this.updateTextureDescriptor(n,s),p(null,this.textureDescriptor&&this.textureDescriptor.img))},k=(U,j)=>{if(U)return p(U);const $=x.send("decodeRasterArray",{buffer:j,task:w},A,void 0,!0);this._workQueue.push(()=>{$&&$.cancel(),w.cancel()})},L=_.getLayer(n);if(!L)return void p(new Error(`Unknown sourceLayer "${n}"`));if(L.hasDataForBand(s))return this.updateTextureDescriptor(n,s),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=L.getDataRange([s]);if(w=_.createDecodingTask(z),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)k(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),j=a.bc(U,k);this._fetchQueue.push(()=>{j.cancel(),w.cancel()})}else p(null)}updateNeeded(n,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,s){if(!this._mrt)return;const p=this._mrt.getLayer(n);if(!p||!p.hasBand(s)||!p.hasDataForBand(s))return;const{bytes:_,tileSize:x,buffer:w,offset:A,scale:k}=p.getBandView(s),L=x+2*w,z={data:_,width:L,height:L},U=this.texture;U&&U instanceof a.T&&U.update(z,{premultiply:!1}),this.textureDescriptor={layer:n,band:s,img:z,buffer:w,offset:A,tileSize:x,format:p.pixelFormat,mix:[k,256*k,65536*k,16777216*k]}}}class Oy{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,p){const _=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:s,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(n,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const p=n.wrapped().key,_=s===void 0?0:this.data[p].indexOf(s),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const p in this.data)for(const _ of this.data[p])n(_.value)||s.push(_);for(const p of s)this.remove(p.value.tileID,p)}}class jb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,p){const _=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][_]=this.stateChanges[n][_]||{},a.l(this.stateChanges[n][_],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==_&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][_]===null){this.deletedStates[n][_]={};for(const x in this.state[n][_])p[x]||(this.deletedStates[n][_][x]=null)}else for(const x in p)this.deletedStates[n]&&this.deletedStates[n][_]&&this.deletedStates[n][_][x]===null&&delete this.deletedStates[n][_][x]}removeFeatureState(n,s,p){if(this.deletedStates[n]===null)return;const _=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&s!==void 0)this.deletedStates[n][_]!==null&&(this.deletedStates[n][_]=this.deletedStates[n][_]||{},this.deletedStates[n][_][p]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][_])for(p in this.deletedStates[n][_]={},this.stateChanges[n][_])this.deletedStates[n][_][p]=null;else this.deletedStates[n][_]=null;else this.deletedStates[n]=null}getState(n,s){const p=this.state[n]||{},_=this.stateChanges[n]||{},x=this.deletedStates[n];if(x===null)return{};if(s!==void 0){const A=String(s),k=a.l({},p[A],_[A]);if(x){const L=x[s];if(L===null)return{};for(const z in L)delete k[z]}return k}const w=a.l({},p,_);if(x)for(const A in x)delete w[A];return w}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),a.l(this.state[_][w],this.stateChanges[_][w]),x[w]=this.state[_][w];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const w in this.state[_])x[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const A of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][A];x[w]=this.state[_][w]}p[_]=p[_]||{},a.l(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in n)n[_].setFeatureState(p,s)}}class Do extends a.E{constructor(n,s,p){super(),this.id=n,this._onlySymbols=p,s.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new Oy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new jb,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const p=this._tiles[s];p.upload(n),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return a.bd(this._tiles).map(n=>n.tileID).sort(el).map(n=>n.key)}getRenderableIds(n,s){const p=[];for(const _ in this._tiles)this._isIdRenderable(+_,n,s)&&p.push(this._tiles[_]);return n?p.sort((_,x)=>{const w=_.tileID,A=x.tileID,k=new a.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),L=new a.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-A.overscaledZ||L.y-k.y||L.x-k.x}).map(_=>_.tileID.key):p.map(_=>_.tileID).sort(el).map(_=>_.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=s),this._loadTile(p,this._tileLoaded.bind(this,p,n,s)))}_tileLoaded(n,s,p,_){if(_)if(n.state="errored",_.status!==404)this._source.fire(new a.t(_,{tile:n}));else{if(this._source.fire(new a.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=a.q.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new a.x("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const s=this.getRenderableIds();for(let _=0;_<s.length;_++){const x=s[_];if(n.neighboringTiles&&n.neighboringTiles[x]){const w=this.getTileByID(x);p(n,w),p(w,n)}}function p(_,x){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-_.tileID.canonical.x;const A=x.tileID.canonical.y-_.tileID.canonical.y,k=Math.pow(2,_.tileID.canonical.z),L=x.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+k)===1?w+=k:Math.abs(w-k)===1&&(w-=k)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,w,A),_.neighboringTiles&&_.neighboringTiles[L]&&(_.neighboringTiles[L].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,p,_){for(const x in this._tiles){let w=this._tiles[x];if(_[x]||!w.hasData()||w.tileID.overscaledZ<=s||w.tileID.overscaledZ>p)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>s+1;){const L=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[L.key],w&&w.hasData()&&(A=L)}let k=A;for(;k.overscaledZ>s;)if(k=k.scaledTo(k.overscaledZ-1),n[k.key]){_[A.key]=A;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=s?p:null}for(let p=n.overscaledZ-1;p>=s;p--){const _=n.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;const p=Math.ceil(n.width/s)+1,_=Math.ceil(n.height/s)+1,x=Math.floor(p*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)}handleWrapJump(n){const s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+s),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(n,s,p,_){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let w;if(this.used||this.usedForTerrain){if(this._source.tileID)w=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new a.aA(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y));else if(this.tileCoverLift!==0){const L=n.clone();L.tileCoverLift=this.tileCoverLift,w=L.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&n.projection.name==="globe"&&(w.push(new a.aA(1,0,1,0,0)),w.push(new a.aA(1,0,1,1,0)),w.push(new a.aA(1,0,1,0,1)),w.push(new a.aA(1,0,1,1,1)))}else if(w=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const L=this._source.hasTile.bind(this._source);w=w.filter(z=>L(z))}}else w=[];if(w.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ah(this._source.type)){const L=n.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),z=Math.min(L,this._source.maxzoom);if(x){const U=n.extendTileCover(w,z);for(const j of U)w.push(j)}else{const U=n.extendTileCover(w,z,_);for(const j of U)this._shadowCasterTiles[j.key]=!0,w.push(j)}}const A=this._updateRetainedTiles(w);if(ah(this._source.type)&&w.length!==0){const L={},z={},U=Object.keys(A);for(const $ of U){const Y=A[$],K=this._tiles[$];if(!K||K.fadeEndTime&&K.fadeEndTime<=a.q.now())continue;const J=this.findLoadedParent(Y,Math.max(Y.overscaledZ-Do.maxOverzooming,this._source.minzoom));J&&(this._addTile(J.tileID),L[J.tileID.key]=J.tileID),z[$]=Y}const j=w[w.length-1].overscaledZ;for(const $ in this._tiles){const Y=this._tiles[$];if(A[$]||!Y.hasData())continue;let K=Y.tileID;for(;K.overscaledZ>j;){K=K.scaledTo(K.overscaledZ-1);const J=this._tiles[K.key];if(J&&J.hasData()&&z[K.key]){A[$]=Y.tileID;break}}}for(const $ in L)A[$]||(this._coveredTiles[$]=!0,A[$]=L[$])}for(const L in A)this._tiles[L].clearFadeHold();const k=a.be(this._tiles,A);for(const L of k){const z=this._tiles[L];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+L)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const s={};if(n.length===0)return s;const p={},_=n.reduce((L,z)=>Math.min(L,z.overscaledZ),1/0),x=n[0].overscaledZ,w=Math.max(x-Do.maxOverzooming,this._source.minzoom),A=Math.max(x+Do.maxUnderzooming,this._source.minzoom),k={};for(const L of n){const z=this._addTile(L);s[L.key]=L,z.hasData()||_<this._source.maxzoom&&(k[L.key]=L)}this._retainLoadedChildren(k,_,A,s);for(const L of n){let z=this._tiles[L.key];if(z.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const j=L.children(this._source.maxzoom)[0],$=this.getTile(j);if($&&$.hasData()){s[j.key]=j;continue}}else{const j=L.children(this._source.maxzoom);if(s[j[0].key]&&s[j[1].key]&&s[j[2].key]&&s[j[3].key])continue}let U=z.wasRequested();for(let j=L.overscaledZ-1;j>=w;--j){const $=L.scaledTo(j);if(p[$.key]||(p[$.key]=!0,z=this.getTile($),!z&&U&&(z=this._addTile($)),z&&(s[$.key]=$,U=z.wasRequested(),z.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let p,_=this._tiles[n].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}s.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of s)this._loadedParentTiles[x]=p}}_addTile(n){let s=this._tiles[n.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const p=!!s;if(!p){const _=this.map?this.map.painter:null,x=this._source.tileSize*n.overscaleFactor();s=this._source.type==="raster-array"?new kd(n,x,this.transform.tileZoom,_,this._isRaster):new Qa(n,x,this.transform.tileZoom,_,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,p||this._source.fire(new a.x("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=s.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,s,p){const _=[],x=this.transform;if(!x)return _;const w=x.projection.name==="globe",A=a.am(x.center.lng);for(const k in this._tiles){const L=this._tiles[k];if(p&&L.clearQueryDebugViz(),L.holdingForFade())continue;let z;if(w){const U=L.tileID.canonical;if(U.z===0){const j=[Math.abs(a.ap(A,...Cc(U,-1))-A),Math.abs(a.ap(A,...Cc(U,1))-A)];z=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(a.ap(A,...Cc(U,-1))-A),Math.abs(a.ap(A,...Cc(U,0))-A),Math.abs(a.ap(A,...Cc(U,1))-A)];z=[j.indexOf(Math.min(...j))-1]}}else z=[0];for(const U of z){const j=n.containsTile(L,x,s,U);j&&_.push(j)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,s){const p=this.getRenderableIds(n,s).map(x=>this._tiles[x].tileID),_=this.transform.projection.name==="globe";for(const x of p)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=_?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return p}sortCoordinatesByDistance(n){const s=n.slice(),p=this.transform._camera.position,_=this.transform._camera.forward(),x={};for(const w of s){const A=1/(1<<w.canonical.z);x[w.key]=((w.canonical.x+.5)*A+w.wrap-p[0])*_[0]+((w.canonical.y+.5)*A-p[1])*_[1]-p[2]*_[2]}return s.sort((w,A)=>x[w.key]-x[A.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(ah(this._source.type))for(const n in this._tiles){const s=this._tiles[n];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=a.q.now())return!0}return!1}setFeatureState(n,s,p){this._state.updateState(n=n||"_geojsonTileLayer",s,p)}removeFeatureState(n,s,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,p)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,p){const _=this._tiles[n];_&&_.setDependencies(s,p)}reloadTilesForDependencies(n,s){for(const p in this._tiles)this._tiles[p].hasDependency(n,s)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,s))}_preloadTiles(n,s){if(!this._sourceLoaded){const k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(n,s))};return void this._source.on("data",k)}const p=new Map,_=Array.isArray(n)?n:[n],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const k of _){const L=k.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of L)p.set(z.key,z);this.usedForTerrain&&k.updateElevation(!1)}const A=Array.from(p.values());a.bf(A,(k,L)=>{const z=new Qa(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,U=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),L(U,z)})},s)}}function el(f,n){const s=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-s||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function ah(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Cc(f,n){const s=1<<f.z;return[f.x/s+n,(f.x+1)/s+n]}Do.maxOverzooming=10,Do.maxUnderzooming=3;class sm{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,s=!1;for(const p in this.style._mergedLayers){const _=this.style._mergedLayers[p];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:n,visibilityChanged:s});else if(_.type==="model"){const x=this.style.getLayerSource(_);x&&x.type==="batched-model"&&this.layers.push({layer:_,visible:n,visibilityChanged:s})}}}onNewFrame(n){this.layersGotHidden=!1;for(const s of this.layers){const p=s.layer;let _=!1;p.type==="fill-extrusion"?_=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(_=!p.isHidden(n)&&p.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&s.visible,s.visible=_}}updateZOffset(n,s){this.currentBuildingBuckets=[];for(const _ of this.layers){const x=_.layer,w=this.style.getLayerSourceCache(x);let A=1;x.type==="fill-extrusion"&&(A=_.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let k=w?w.getTile(s):null;if(!k&&w&&s.canonical.z>w.getSource().minzoom){let L=s.scaledTo(Math.min(w.getSource().maxzoom,s.overscaledZ-1));for(;L.overscaledZ>=w.getSource().minzoom&&(k=w.getTile(L),!k&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(x):null,tileID:k?k.tileID:s,verticalScale:A})}n.hasAnyZOffset=!1;let p=!1;for(let _=0;_<n.symbolInstances.length;_++){const x=n.symbolInstances.get(_),w=x.zOffset,A=this._getHeightAtTileOffset(s,x.tileAnchorX,x.tileAnchorY);x.zOffset=A!==Number.NEGATIVE_INFINITY?A:w,p||w===x.zOffset||(p=!0),n.hasAnyZOffset||x.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,s,p,_){let x=s,w=p;if(n.canonical.z!==_.canonical.z){const A=_.canonical,k=1/(1<<n.canonical.z-A.z);x=(s+n.canonical.x*a.ab)*k-A.x*a.ab|0,w=(p+n.canonical.y*a.ab)*k-A.y*a.ab|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(n,s,p){let _,x;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:A,tileID:k,verticalScale:L}=this.currentBuildingBuckets[w];if(!A)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(n,s,p,k),j=A.getHeightAtTileCoord(z,U);j&&j.height!==void 0&&(j.hidden?_=j.height:x=Math.max(j.height*L,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){const A=this.layers[w];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[w];if(!k)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(n,s,p,L),j=k.getHeightAtTileCoord(z,U);if(j&&!j.hidden)return j.height===void 0&&_!==void 0?Math.min(j.maxHeight,_)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ic(f,n){const s={};for(const p in f)p!=="ref"&&(s[p]=f[p]);return a.bg.forEach(p=>{p in n&&(s[p]=n[p])}),s}function lm(f){f=f.slice();const n=Object.create(null);for(let s=0;s<f.length;s++)n[f[s].id]=f[s];for(let s=0;s<f.length;s++)"ref"in f[s]&&(f[s]=Ic(f[s],n[f[s].ref]));return f}const Qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function cm(f,n,s){s.push({command:Qr.addSource,args:[f,n[f]]})}function un(f,n,s){n.push({command:Qr.removeSource,args:[f]}),s[f]=!0}function Vb(f,n,s,p){un(f,s,p),cm(f,n,s)}function ur(f,n,s){let p;for(p in f[s])if(f[s].hasOwnProperty(p)&&p!=="data"&&!a.bh(f[s][p],n[s][p]))return!1;for(p in n[s])if(n[s].hasOwnProperty(p)&&p!=="data"&&!a.bh(f[s][p],n[s][p]))return!1;return!0}function sh(f,n,s,p,_,x){let w;for(w in n=n||{},f=f||{})f.hasOwnProperty(w)&&(a.bh(f[w],n[w])||s.push({command:x,args:[p,w,n[w],_]}));for(w in n)n.hasOwnProperty(w)&&!f.hasOwnProperty(w)&&(a.bh(f[w],n[w])||s.push({command:x,args:[p,w,n[w],_]}))}function Bl(f){return f.id}function Pc(f,n){return f[n.id]=n,f}class es{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.ap(n,0,1);let s=1,p=this._distances[s];const _=n*this.paddedLength+this.padding;for(;p<_&&s<this._distances.length;)p=this._distances[++s];const x=s-1,w=this._distances[x],A=p-w,k=A>0?(_-w)/A:0;return this.points[x].mult(1-k).add(this.points[s].mult(k))}}class Od{constructor(n,s,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(s/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,p,_,x){this._forEachCell(s,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(n,s,p,_){this._forEachCell(s-_,p-_,s+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(p),this.circles.push(_)}_insertBoxCell(n,s,p,_,x,w){this.boxCells[x].push(w)}_insertCircleCell(n,s,p,_,x,w){this.circleCells[x].push(w)}_query(n,s,p,_,x,w){if(p<0||n>this.width||_<0||s>this.height)return!x&&[];const A=[];if(n<=0&&s<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let k=0;k<this.boxKeys.length;k++)A.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],z=this.circles[3*k+1],U=this.circles[3*k+2];A.push({key:this.circleKeys[k],x1:L-U,y1:z-U,x2:L+U,y2:z+U})}return w?A.filter(w):A}return this._forEachCell(n,s,p,_,this._queryCell,A,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?A.length>0:A}_queryCircle(n,s,p,_,x){const w=n-p,A=n+p,k=s-p,L=s+p;if(A<0||w>this.width||L<0||k>this.height)return!_&&[];const z=[];return this._forEachCell(w,k,A,L,this._queryCellCircle,z,{hitTest:_,circle:{x:n,y:s,radius:p},seenUids:{box:{},circle:{}}},x),_?z.length>0:z}query(n,s,p,_,x){return this._query(n,s,p,_,!1,x)}hitTest(n,s,p,_,x){return this._query(n,s,p,_,!0,x)}hitTestCircle(n,s,p,_){return this._queryCircle(n,s,p,!0,_)}_queryCell(n,s,p,_,x,w,A,k){const L=A.seenUids,z=this.boxCells[x];if(z!==null){const j=this.bboxes;for(const $ of z)if(!L.box[$]){L.box[$]=!0;const Y=4*$;if(n<=j[Y+2]&&s<=j[Y+3]&&p>=j[Y+0]&&_>=j[Y+1]&&(!k||k(this.boxKeys[$]))){if(A.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[$],x1:j[Y],y1:j[Y+1],x2:j[Y+2],y2:j[Y+3]})}}}const U=this.circleCells[x];if(U!==null){const j=this.circles;for(const $ of U)if(!L.circle[$]){L.circle[$]=!0;const Y=3*$;if(this._circleAndRectCollide(j[Y],j[Y+1],j[Y+2],n,s,p,_)&&(!k||k(this.circleKeys[$]))){if(A.hitTest)return w.push(!0),!0;{const K=j[Y],J=j[Y+1],Q=j[Y+2];w.push({key:this.circleKeys[$],x1:K-Q,y1:J-Q,x2:K+Q,y2:J+Q})}}}}}_queryCellCircle(n,s,p,_,x,w,A,k){const L=A.circle,z=A.seenUids,U=this.boxCells[x];if(U!==null){const $=this.bboxes;for(const Y of U)if(!z.box[Y]){z.box[Y]=!0;const K=4*Y;if(this._circleAndRectCollide(L.x,L.y,L.radius,$[K+0],$[K+1],$[K+2],$[K+3])&&(!k||k(this.boxKeys[Y])))return w.push(!0),!0}}const j=this.circleCells[x];if(j!==null){const $=this.circles;for(const Y of j)if(!z.circle[Y]){z.circle[Y]=!0;const K=3*Y;if(this._circlesCollide($[K],$[K+1],$[K+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[Y])))return w.push(!0),!0}}}_forEachCell(n,s,p,_,x,w,A,k){const L=this._convertToXCellCoord(n),z=this._convertToYCellCoord(s),U=this._convertToXCellCoord(p),j=this._convertToYCellCoord(_);for(let $=L;$<=U;$++)for(let Y=z;Y<=j;Y++)if(x.call(this,n,s,p,_,this.xCellCount*Y+$,w,A,k))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,p,_,x,w){const A=_-n,k=x-s,L=p+w;return L*L>A*A+k*k}_circleAndRectCollide(n,s,p,_,x,w,A){const k=(w-_)/2,L=Math.abs(n-(_+k));if(L>k+p)return!1;const z=(A-x)/2,U=Math.abs(s-(x+z));if(U>z+p)return!1;if(L<=k||U<=z)return!0;const j=L-k,$=U-z;return j*j+$*$<=p*p}}const Aa={unknown:0,flipRequired:1,flipNotRequired:2},Yt=Math.tan(85*Math.PI/180);function qr(f,n,s,p,_,x,w){const A=a.a6.mat4.create();if(s)if(x.name==="globe"){const k=a.bi(_,n);a.a6.mat4.multiply(A,A,k)}else{const k=a.a6.mat2.invert([],w);A[0]=k[0],A[1]=k[1],A[4]=k[2],A[5]=k[3],p||a.a6.mat4.rotateZ(A,A,_.angle)}else a.a6.mat4.multiply(A,_.labelPlaneMatrix,f);return A}function Zr(f,n,s,p,_,x,w){const A=qr(f,n,s,p,_,x,w);return x.name==="globe"&&s||(A[2]=A[6]=A[10]=A[14]=0),A}function Ro(f,n,s,p,_,x,w){if(s){if(x.name==="globe"){const A=qr(f,n,s,p,_,x,w);return a.a6.mat4.invert(A,A),a.a6.mat4.multiply(A,f,A),A}{const A=a.a6.mat4.clone(f),k=a.a6.mat4.identity([]);return k[0]=w[0],k[1]=w[1],k[4]=w[2],k[5]=w[3],a.a6.mat4.multiply(A,A,k),p||a.a6.mat4.rotateZ(A,A,-_.angle),A}}return _.glCoordMatrix}function lo(f,n,s,p){const _=[f,n,s,1];s?a.a6.vec4.transformMat4(_,_,p):zd(_,_,p);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function Jr(f,n){return Math.min(.5+f/n*.5,1.5)}function Ld(f,n){const s=f[0]/f[3],p=f[1]/f[3];return s>=-n[0]&&s<=n[0]&&p>=-n[1]&&p<=n[1]}function Ac(f,n,s,p,_,x,w,A,k,L){const z=s.transform,U=p?f.textSizeData:f.iconSizeData,j=a.bj(U,s.transform.zoom),$=z.projection.name==="globe",Y=[256/s.width*2+1,256/s.height*2+1],K=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;K.clear();let J=null;$&&(J=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Q=f.lineVertexArray,fe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ge=s.transform.width/s.transform.height;let he,xe=!1;for(let ve=0;ve<fe.length;ve++){const Ie=fe.get(ve),{numGlyphs:Ee,writingMode:Pe}=Ie;if(Pe!==a.bk.vertical||xe||he===a.bk.horizontal||(xe=!0),he=Pe,(Ie.hidden||Pe===a.bk.vertical)&&!xe){ts(Ee,K);continue}xe=!1;const ze=new a.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:ke,y:De,z:$e}=z.projection.projectTilePoint(ze.x,ze.y,L.canonical);if(k){const[ft,_t,ir]=k(ze);ke+=ft,De+=_t,$e+=ir}const nt=[ke,De,$e,1];if(a.a6.vec4.transformMat4(nt,nt,n),!Ld(nt,Y)){ts(Ee,K);continue}const pt=nt[3],rt=Jr(s.transform.getCameraToCenterDistance(z.projection),pt),xt=a.bl(U,j,Ie),We=w?xt/rt:xt*rt,ut=lo(ke,De,$e,_);if(ut[3]<=0){ts(Ee,K);continue}let at={};const wt=w?null:k,Et=ei(Ie,We,!1,A,n,_,x,f.glyphOffsetArray,Q,K,J,ut,ze,at,ge,wt,z.projection,L,w);xe=Et.useVertical,wt&&Et.needsFlipping&&(at={}),(Et.notEnoughRoom||xe||Et.needsFlipping&&ei(Ie,We,!0,A,n,_,x,f.glyphOffsetArray,Q,K,J,ut,ze,at,ge,wt,z.projection,L,w).notEnoughRoom)&&ts(Ee,K)}p?(f.text.dynamicLayoutVertexBuffer.updateData(K),J&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(J)):(f.icon.dynamicLayoutVertexBuffer.updateData(K),J&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(J))}function Dc(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K){const{lineStartIndex:J,glyphStartIndex:Q,segment:fe}=A,ge=Q+A.numGlyphs,he=J+A.lineLength,xe=n.getoffsetX(Q),ve=n.getoffsetX(ge-1),Ie=kc(f*xe,s,p,_,x,w,fe,J,he,k,L,z,U,j,!0,$,Y,K);if(!Ie)return null;const Ee=kc(f*ve,s,p,_,x,w,fe,J,he,k,L,z,U,j,!0,$,Y,K);return Ee?{first:Ie,last:Ee}:null}function _o(f,n,s,p){return f===a.bk.horizontal&&Math.abs(p)>Math.abs(s)?{useVertical:!0}:f===a.bk.vertical?p>0?{needsFlipping:!0}:null:n!==Aa.unknown&&function(_,x){return _===0||Math.abs(x/_)>Yt}(s,p)?n===Aa.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function ei(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J,Q,fe){const ge=n/24,he=f.lineOffsetX*ge,xe=f.lineOffsetY*ge,{lineStartIndex:ve,glyphStartIndex:Ie,numGlyphs:Ee,segment:Pe,writingMode:ze,flipState:ke}=f,De=ve+f.lineLength,$e=nt=>{if(z){const[We,ut,at]=nt.up,wt=L.length;a.bm(z,wt+0,We,ut,at),a.bm(z,wt+1,We,ut,at),a.bm(z,wt+2,We,ut,at),a.bm(z,wt+3,We,ut,at)}const[pt,rt,xt]=nt.point;a.bn(L,pt,rt,xt,nt.angle)};if(Ee>1){const nt=Dc(ge,A,he,xe,s,U,j,f,k,x,$,K,!1,J,Q,fe);if(!nt)return{notEnoughRoom:!0};if(p&&!s){let[pt,rt,xt]=nt.first.point,[We,ut,at]=nt.last.point;[pt,rt]=lo(pt,rt,xt,w),[We,ut]=lo(We,ut,at,w);const wt=_o(ze,ke,(We-pt)*Y,ut-rt);if(f.flipState=wt&&wt.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,wt)return wt}$e(nt.first);for(let pt=Ie+1;pt<Ie+Ee-1;pt++){const rt=kc(ge*A.getoffsetX(pt),he,xe,s,U,j,Pe,ve,De,k,x,$,K,!1,!1,J,Q,fe);if(!rt)return L.length-=4*(pt-Ie),{notEnoughRoom:!0};$e(rt)}$e(nt.last)}else{if(p&&!s){const pt=lo(j.x,j.y,0,_),rt=ve+Pe+1,xt=new a.P(k.getx(rt),k.gety(rt)),We=lo(xt.x,xt.y,0,_),ut=We[3]>0?We:Rc(j,xt,pt,1,_,void 0,J,Q.canonical),at=_o(ze,ke,(ut[0]-pt[0])*Y,ut[1]-pt[1]);if(f.flipState=at&&at.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,at)return at}const nt=kc(ge*A.getoffsetX(Ie),he,xe,s,U,j,Pe,ve,De,k,x,$,K,!1,!1,J,Q,fe);if(!nt)return{notEnoughRoom:!0};$e(nt)}return{}}function Ly(f,n,s,p,_){const{x,y:w,z:A}=p.projectTilePoint(f.x,f.y,n);if(!_)return lo(x,w,A,s);const[k,L,z]=_(f);return lo(x+k,w+L,A+z,s)}function Rc(f,n,s,p,_,x,w,A){const k=Ly(f.sub(n)._unit()._add(f),A,_,w,x);return a.a6.vec3.sub(k,s,k),a.a6.vec3.normalize(k,k),a.a6.vec3.scaleAndAdd(k,s,k,p)}function kc(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J,Q){const fe=p?f-n:f+n;let ge=fe>0?1:-1,he=0;p&&(ge*=-1,he=Math.PI),ge<0&&(he+=Math.PI);let xe=A+w+(ge>0?0:1)|0,ve=_,Ie=_,Ee=0,Pe=0;const ze=Math.abs(fe),ke=[],De=[];let $e=x,nt=$e;const pt=()=>Rc(nt,$e,Ie,ze-Ee+1,z,j,K,J.canonical);for(;Ee+Pe<=ze;){if(xe+=ge,xe<A||xe>=k)return null;if(Ie=ve,nt=$e,ke.push(Ie),$&&De.push(nt),$e=new a.P(L.getx(xe),L.gety(xe)),ve=U[xe],!ve){const _t=Ly($e,J.canonical,z,K,j);ve=_t[3]>0?U[xe]=_t:pt()}Ee+=Pe,Pe=a.a6.vec3.distance(Ie,ve)}Y&&j&&(U[xe]&&(ve=pt(),Pe=a.a6.vec3.distance(Ie,ve)),U[xe]=ve);const rt=(ze-Ee)/Pe,xt=$e.sub(nt)._mult(rt)._add(nt),We=a.a6.vec3.sub([],ve,Ie),ut=a.a6.vec3.scaleAndAdd([],Ie,We,rt);let at=[0,0,1],wt=We[0],Et=We[1];if(Q&&(at=K.upVector(J.canonical,xt.x,xt.y),at[0]!==0||at[1]!==0||at[2]!==1)){const _t=[at[2],0,-at[0]],ir=a.a6.vec3.cross([],at,_t);a.a6.vec3.normalize(_t,_t),a.a6.vec3.normalize(ir,ir),wt=a.a6.vec3.dot(We,_t),Et=a.a6.vec3.dot(We,ir)}if(s){const _t=a.a6.vec3.cross([],at,We);a.a6.vec3.normalize(_t,_t),a.a6.vec3.scaleAndAdd(ut,ut,_t,s*ge)}const ft=he+Math.atan2(Et,wt);return ke.push(ut),$&&De.push(xt),{point:ut,angle:ft,path:ke,tilePath:De,up:at}}function ts(f,n){const s=n.length,p=s+4*f;n.resize(p),n.float32.fill(-1/0,4*s,4*p)}function zd(f,n,s){const p=n[0],_=n[1];return f[0]=s[0]*p+s[4]*_+s[12],f[1]=s[1]*p+s[5]*_+s[13],f[3]=s[3]*p+s[7]*_+s[15],f}const Ho=100;class co{constructor(n,s,p=new Od(n.width+200,n.height+200,25),_=new Od(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ho,this.screenBottomBoundary=n.height+Ho,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=s}placeCollisionBox(n,s,p,_,x,w,A,k){let L=p.projectedAnchorX,z=p.projectedAnchorY,U=p.projectedAnchorZ;const j=p.elevation,$=p.tileID,Y=n.getProjection();if(j&&$){const[ve,Ie,Ee]=Y.upVector($.canonical,p.tileAnchorX,p.tileAnchorY),Pe=Y.upVectorScale($.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=ve*j*Pe,z+=Ie*j*Pe,U+=Ee*j*Pe}const K=this.projectAndGetPerspectiveRatio(A,L,z,U,p.tileID,Y.name==="globe"||!!j||this.transform.pitch>0,Y),J=w*K.perspectiveRatio,Q=(p.x1*s+_.x-p.padding)*J+K.point.x,fe=(p.y1*s+_.y-p.padding)*J+K.point.y,ge=(p.x2*s+_.x+p.padding)*J+K.point.x,he=(p.y2*s+_.y+p.padding)*J+K.point.y,xe=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(Q,fe,ge,he)||!x&&this.grid.hitTest(Q,fe,ge,he,k)||xe?{box:[],offscreen:!1,occluded:K.occluded}:{box:[Q,fe,ge,he],offscreen:this.isOffscreen(Q,fe,ge,he),occluded:!1}}placeCollisionCircles(n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K){const J=[],Q=this.transform.elevation,fe=n.getProjection(),ge=Q?Q.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,fe):null,he=new a.P(p.tileAnchorX,p.tileAnchorY);let{x:xe,y:ve,z:Ie}=fe.projectTilePoint(he.x,he.y,K.canonical);if(ge){const[xt,We,ut]=ge(he);xe+=xt,ve+=We,Ie+=ut}const Ee=fe.name==="globe",Pe=this.projectAndGetPerspectiveRatio(A,xe,ve,Ie,K,Ee||!!Q||this.transform.pitch>0,fe),{perspectiveRatio:ze}=Pe,ke=(U?w/ze:w*ze)/a.bq,De=lo(xe,ve,Ie,k),$e=Pe.signedDistanceFromCamera>0?Dc(ke,x,p.lineOffsetX*ke,p.lineOffsetY*ke,!1,De,he,p,_,k,{},Q&&!U?ge:null,U&&!!Q,fe,K,U):null;let nt=!1,pt=!1,rt=!0;if($e&&!Pe.occluded){const xt=.5*$*ze+Y,We=new a.P(-100,-100),ut=new a.P(this.screenRightBoundary,this.screenBottomBoundary),at=new es,{first:wt,last:Et}=$e,ft=wt.path.length;let _t=[];for(let Vt=ft-1;Vt>=1;Vt--)_t.push(wt.path[Vt]);for(let Vt=1;Vt<Et.path.length;Vt++)_t.push(Et.path[Vt]);const ir=2.5*xt;L&&(_t=_t.map(([Vt,dr,Jt],lr)=>(ge&&!Ee&&(Jt=ge(lr<ft-1?wt.tilePath[ft-1-lr]:Et.tilePath[lr-ft+2])[2]),lo(Vt,dr,Jt,L))),_t.some(Vt=>Vt[3]<=0)&&(_t=[]));let kt=[];if(_t.length>0){let Vt=1/0,dr=-1/0,Jt=1/0,lr=-1/0;for(const Or of _t)Vt=Math.min(Vt,Or[0]),Jt=Math.min(Jt,Or[1]),dr=Math.max(dr,Or[0]),lr=Math.max(lr,Or[1]);dr>=We.x&&Vt<=ut.x&&lr>=We.y&&Jt<=ut.y&&(kt=[_t.map(Or=>new a.P(Or[0],Or[1]))],(Vt<We.x||dr>ut.x||Jt<We.y||lr>ut.y)&&(kt=a.bo(kt,We.x,We.y,ut.x,ut.y)))}for(const Vt of kt){at.reset(Vt,.25*xt);let dr=0;dr=at.length<=.5*xt?1:Math.ceil(at.paddedLength/ir)+1;for(let Jt=0;Jt<dr;Jt++){const lr=Jt/Math.max(dr-1,1),Or=at.lerp(lr),Pr=Or.x+Ho,pn=Or.y+Ho;J.push(Pr,pn,xt,0);const xn=Pr-xt,Cn=pn-xt,ha=Pr+xt,si=pn+xt;if(rt=rt&&this.isOffscreen(xn,Cn,ha,si),pt=pt||this.isInsideGrid(xn,Cn,ha,si),!s&&this.grid.hitTestCircle(Pr,pn,xt,j)&&(nt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:nt,occluded:!1}}}}return{circles:!z&&nt||!pt?[]:J,offscreen:rt,collisionDetected:nt,occluded:Pe.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let p=1/0,_=1/0,x=-1/0,w=-1/0;for(const z of n){const U=new a.P(z.x+Ho,z.y+Ho);p=Math.min(p,U.x),_=Math.min(_,U.y),x=Math.max(x,U.x),w=Math.max(w,U.y),s.push(U)}const A=this.grid.query(p,_,x,w).concat(this.ignoredGrid.query(p,_,x,w)),k={},L={};for(const z of A){const U=z.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;const j=[new a.P(z.x1,z.y1),new a.P(z.x2,z.y1),new a.P(z.x2,z.y2),new a.P(z.x1,z.y2)];a.bp(s,j)&&(k[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(n,s,p,_,x){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,p,_,x){const w=s?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let k=0;k<n.length;k+=4)w.insertCircle(A,n[k],n[k+1],n[k+2])}projectAndGetPerspectiveRatio(n,s,p,_,x,w,A){const k=[s,p,_,1];let L=!1;_||this.transform.pitch>0?(a.a6.vec4.transformMat4(k,k,n),this.fogState&&x&&A.name!=="globe"&&(L=function(j,$,Y,K,J,Q){const fe=Q.calculateFogTileMatrix(J),ge=[$,Y,K];return a.a6.vec3.transformMat4(ge,ge,fe),jt(j,a.a6.vec3.length(ge),Q.pitch,Q._fov)}(this.fogState,s,p,_,x.toUnwrapped(),this.transform)>.9)):zd(k,k,n);const z=k[3];return{point:new a.P((k[0]/z+1)/2*this.transform.width+Ho,(-k[1]/z+1)/2*this.transform.height+Ho),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:w&&k[2]>z||L}}isOffscreen(n,s,p,_){return p<Ho||n>=this.screenRightBoundary||_<Ho||s>this.screenBottomBoundary}isInsideGrid(n,s,p,_){return p>=0&&n<this.gridRightBoundary&&_>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const n=a.a6.mat4.identity([]);return a.a6.mat4.translate(n,n,[-100,-100,0]),n}}function yo(f,n,s){const p=n.createTileMatrix(f,f.worldSize,s.toUnwrapped());return a.a6.mat4.multiply(new Float32Array(16),f.projMatrix,p)}function zy(f,n,s){if(n.projection.name===s.projection.name)return f.projMatrix;const p=s.clone();return p.setProjection(n.projection),yo(p,n.getProjection(),f)}function tl(f,n,s){return n.name===s.projection.name?f.projMatrix:yo(s,n,f)}class di{constructor(n,s,p,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class vo{constructor(n,s,p,_,x,w=!1){this.text=new di(n?n.text:null,s,p,x),this.icon=new di(n?n.icon:null,s,_,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Da{constructor(n,s,p,_=!1){this.text=n,this.icon=s,this.skipFade=p,this.clipped=_}}class ki{constructor(){this.invProjMatrix=a.a6.mat4.create(),this.viewportMatrix=a.a6.mat4.create(),this.circles=[]}}class um{constructor(n,s,p,_,x){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class Ra{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:p=>p.collisionGroupID===s}}return this.collisionGroups[n]}}function Oc(f,n,s,p,_){const{horizontalAlign:x,verticalAlign:w}=a.bx(f),A=-(x-.5)*n,k=-(w-.5)*s,L=a.bw(f,p);return new a.P(A+L[0]*_,k+L[1]*_)}function Nl(f,n,s,p,_){const x=new a.P(f,n);return s&&x._rotate(p?_:-_),x}class Ul{constructor(n,s,p,_,x,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new co(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Ra(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,s,p,_){const x=p.getBucket(s),w=p.latestFeatureIndex;if(!x||!w||s.fqid!==x.layerIds[0])return;const A=x.layers[0].layout,k=x.layers[0].paint,L=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/a.ab,j=p.tileID.toUnwrapped();this.transform.setProjection(x.projection);const $=(Y=p.tileID,K=x.getProjection(),J=this.transform,K.name===this.projection?J.calculateProjMatrix(Y.toUnwrapped()):yo(J,K,Y));var Y,K,J;const Q=A.get("text-pitch-alignment")==="map",fe=A.get("text-rotation-alignment")==="map";s.compileFilter();const ge=s.dynamicFilter(),he=s.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(p),ve=Zr($,p.tileID.canonical,Q,fe,this.transform,x.getProjection(),xe);let Ie=null;if(Q){const ze=Ro($,p.tileID.canonical,Q,fe,this.transform,x.getProjection(),xe);Ie=a.a6.mat4.multiply([],this.transform.labelPlaneMatrix,ze)}let Ee=null;ge&&p.latestFeatureIndex&&(Ee={unwrappedTileID:j,dynamicFilter:ge,dynamicFilterNeedsFeature:he}),this.retainedQueryData[x.bucketInstanceId]=new um(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,p.tileID);const Pe={bucket:x,layout:A,paint:k,posMatrix:$,textLabelPlaneMatrix:ve,labelToScreenMatrix:Ie,clippingData:Ee,scale:z,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:a.bj(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.bj(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(_)for(const ze of x.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:De,symbolInstanceEnd:$e}=ze;n.push({sortKey:ke,symbolInstanceStart:De,symbolInstanceEnd:$e,parameters:Pe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J,Q,fe){const{textOffset0:ge,textOffset1:he,crossTileID:xe}=j,ve=[ge,he],Ie=Oc(n,p,_,ve,x),Ee=this.collisionIndex.placeCollisionBox(Y,x,s,Nl(Ie.x,Ie.y,w,A,this.transform.angle),U,k,L,z.predicate);if(J){const Pe=Y.getSymbolInstanceIconSize(fe,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,Pe,J,Nl(Ie.x,Ie.y,w,A,this.transform.angle),U,k,L,z.predicate).box.length===0)return}if(Ee.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Pe=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ve,width:p,height:_,anchor:n,textScale:x,prevAnchor:Pe},this.markUsedJustification(Y,n,j,K),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,K,j),this.placedOrientations[xe]=K),{shift:Ie,placedGlyphBoxes:Ee}}}placeLayerBucketPart(n,s,p,_){const{bucket:x,layout:w,paint:A,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:z,clippingData:U,textPixelRatio:j,holdingForFade:$,collisionBoxArray:Y,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:J,collisionGroup:Q,latestFeatureIndex:fe}=n.parameters,ge=w.get("text-optional"),he=w.get("icon-optional"),xe=w.get("text-allow-overlap"),ve=w.get("icon-allow-overlap"),Ie=w.get("text-rotation-alignment")==="map",Ee=w.get("text-pitch-alignment")==="map",Pe=w.get("symbol-z-elevate"),ze=A.get("symbol-z-offset"),ke=A.get("symbol-elevation-reference")==="sea";this.transform.setProjection(x.projection);let De=xe&&(ve||!x.hasIconData()||he),$e=ve&&(xe||!x.hasTextData()||ge);const nt=!ze.isConstant();!x.collisionArrays&&Y&&x.deserializeCollisionBoxes(Y),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,Y);const pt=(rt,xt,We)=>{const{crossTileID:ut,numVerticalGlyphVertices:at}=rt;let wt=null;if(U&&U.dynamicFilterNeedsFeature||nt){const Ar=this.retainedQueryData[x.bucketInstanceId];wt=fe.loadFeature({featureIndex:rt.featureIndex,bucketIndex:Ar.bucketIndex,sourceLayerIndex:Ar.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},wt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new a.P(rt.tileAnchorX,rt.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[ut]=new Da(!1,!1,!1,!0),void s.add(ut);const Et=ze.evaluate(wt,{});if(s.has(ut))return;if($)return void(this.placements[ut]=new Da(!1,!1,!1));let ft=!1,_t=!1,ir=!0,kt=!1,Vt=!1,dr=null,Jt={box:null,offscreen:null,occluded:null},lr={box:null,offscreen:null,occluded:null},Or=null,Pr=null,pn=null,xn=0,Cn=0,ha=0;We.textFeatureIndex?xn=We.textFeatureIndex:rt.useRuntimeCollisionCircles&&(xn=rt.featureIndex),We.verticalTextFeatureIndex&&(Cn=We.verticalTextFeatureIndex);const si=Ar=>{Ar.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const tn=this.transform.elevation;Ar.elevation=ke?Et:Et+(tn?tn.getAtTileOffset(Ar.tileID,Ar.tileAnchorX,Ar.tileAnchorY):0),Ar.elevation+=rt.zOffset},$r=We.textBox;if($r){si($r);const Ar=hn=>{let Yn=a.bk.horizontal;if(x.allowVerticalPlacement&&!hn&&this.prevPlacement){const li=this.prevPlacement.placedOrientations[ut];li&&(this.placedOrientations[ut]=li,Yn=li,this.markUsedOrientation(x,Yn,rt))}return Yn},tn=(hn,Yn)=>{if(x.allowVerticalPlacement&&at>0&&We.verticalTextBox){for(const li of x.writingModes)if(li===a.bk.vertical?(Jt=Yn(),lr=Jt):Jt=hn(),Jt&&Jt.box&&Jt.box.length)break}else Jt=hn()};if(w.get("text-variable-anchor")){let hn=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ut]){const Xr=this.prevPlacement.variableOffsets[ut];hn.indexOf(Xr.anchor)>0&&(hn=hn.filter(Ti=>Ti!==Xr.anchor),hn.unshift(Xr.anchor))}const Yn=(Xr,Ti,Oi)=>{const Ei=x.getSymbolInstanceTextSize(K,rt,this.transform.zoom,xt),Sn=(Xr.x2-Xr.x1)*Ei+2*Xr.padding,bo=(Xr.y2-Xr.y1)*Ei+2*Xr.padding,wo=rt.hasIconTextFit&&!ve?Ti:null;wo&&si(wo);let da={box:[],offscreen:!1,occluded:!1};const Jo=xe?2*hn.length:hn.length;for(let zo=0;zo<Jo;++zo){const fa=this.attemptAnchorPlacement(hn[zo%hn.length],Xr,Sn,bo,Ei,Ie,Ee,j,k,Q,zo>=hn.length,rt,xt,x,Oi,wo,K,J);if(fa&&(da=fa.placedGlyphBoxes,da&&da.box&&da.box.length)){ft=!0,dr=fa.shift;break}}return da};tn(()=>Yn($r,We.iconBox,a.bk.horizontal),()=>{const Xr=We.verticalTextBox;return Xr&&si(Xr),x.allowVerticalPlacement&&!(Jt&&Jt.box&&Jt.box.length)&&at>0&&Xr?Yn(Xr,We.verticalIconBox,a.bk.vertical):{box:null,offscreen:null,occluded:null}}),Jt&&(ft=Jt.box,ir=Jt.offscreen,kt=Jt.occluded);const li=Ar(!(!Jt||!Jt.box));if(!ft&&this.prevPlacement){const Xr=this.prevPlacement.variableOffsets[ut];Xr&&(this.variableOffsets[ut]=Xr,this.markUsedJustification(x,Xr.anchor,rt,li))}}else{const hn=(Yn,li)=>{const Xr=x.getSymbolInstanceTextSize(K,rt,this.transform.zoom,xt),Ti=this.collisionIndex.placeCollisionBox(x,Xr,Yn,new a.P(0,0),xe,j,k,Q.predicate);return Ti&&Ti.box&&Ti.box.length&&(this.markUsedOrientation(x,li,rt),this.placedOrientations[ut]=li),Ti};tn(()=>hn($r,a.bk.horizontal),()=>{const Yn=We.verticalTextBox;return x.allowVerticalPlacement&&at>0&&Yn?(si(Yn),hn(Yn,a.bk.vertical)):{box:null,offscreen:null,occluded:null}}),Ar(!!(Jt&&Jt.box&&Jt.box.length))}}if(Or=Jt,ft=Or&&Or.box&&Or.box.length>0,ir=Or&&Or.offscreen,kt=Or&&Or.occluded,rt.useRuntimeCollisionCircles){const Ar=x.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex>=0?rt.centerJustifiedTextSymbolIndex:rt.verticalPlacedTextSymbolIndex),tn=a.bl(x.textSizeData,K,Ar),hn=w.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(x,xe,Ar,x.lineVertexArray,x.glyphOffsetArray,tn,k,L,z,p,Ee,Q.predicate,rt.collisionCircleDiameter*tn/a.bq,hn,this.retainedQueryData[x.bucketInstanceId].tileID),ft=xe||Pr.circles.length>0&&!Pr.collisionDetected,ir=ir&&Pr.offscreen,kt=Pr.occluded}if(We.iconFeatureIndex&&(ha=We.iconFeatureIndex),We.iconBox){const Ar=tn=>{si(tn);const hn=rt.hasIconTextFit&&dr?Nl(dr.x,dr.y,Ie,Ee,this.transform.angle):new a.P(0,0),Yn=x.getSymbolInstanceIconSize(J,this.transform.zoom,rt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Yn,tn,hn,ve,j,k,Q.predicate)};lr&&lr.box&&lr.box.length&&We.verticalIconBox?(pn=Ar(We.verticalIconBox),_t=pn.box.length>0):(pn=Ar(We.iconBox),_t=pn.box.length>0),ir=ir&&pn.offscreen,Vt=pn.occluded}const yn=ge||rt.numHorizontalGlyphVertices===0&&at===0,zn=he||rt.numIconVertices===0;if(yn||zn?zn?yn||(_t=_t&&ft):ft=_t&&ft:_t=ft=_t&&ft,ft&&Or&&Or.box&&this.collisionIndex.insertCollisionBox(Or.box,w.get("text-ignore-placement"),x.bucketInstanceId,lr&&lr.box&&Cn?Cn:xn,Q.ID),_t&&pn&&this.collisionIndex.insertCollisionBox(pn.box,w.get("icon-ignore-placement"),x.bucketInstanceId,ha,Q.ID),Pr&&(ft&&this.collisionIndex.insertCollisionCircles(Pr.circles,w.get("text-ignore-placement"),x.bucketInstanceId,xn,Q.ID),p)){const Ar=x.bucketInstanceId;let tn=this.collisionCircleArrays[Ar];tn===void 0&&(tn=this.collisionCircleArrays[Ar]=new ki);for(let hn=0;hn<Pr.circles.length;hn+=4)tn.circles.push(Pr.circles[hn+0]),tn.circles.push(Pr.circles[hn+1]),tn.circles.push(Pr.circles[hn+2]),tn.circles.push(Pr.collisionDetected?1:0)}const _n=x.projection.name!=="globe";De=De&&(_n||!kt),$e=$e&&(_n||!Vt),this.placements[ut]=new Da(ft||De,_t||$e,ir||x.justReloaded),s.add(ut)};if(Pe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),x.sortFeaturesByY){const rt=x.getSortedSymbolIndexes(this.transform.angle);for(let xt=rt.length-1;xt>=0;--xt){const We=rt[xt];pt(x.symbolInstances.get(We),We,x.collisionArrays[We])}x.hasAnyZOffset&&a.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const rt=x.getSortedIndexesByZOffset();for(let xt=0;xt<rt.length;++xt){const We=rt[xt];pt(x.symbolInstances.get(We),We,x.collisionArrays[We])}}else for(let rt=n.symbolInstanceStart;rt<n.symbolInstanceEnd;rt++)pt(x.symbolInstances.get(rt),rt,x.collisionArrays[rt]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const rt=this.collisionCircleArrays[x.bucketInstanceId];a.a6.mat4.invert(rt.invProjMatrix,k),rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(n,s,p,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:k,crossTileID:L}=p,z=a.bv(s),U=_===a.bk.vertical?k:z==="left"?x:z==="center"?w:z==="right"?A:-1;x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:L),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=U>=0&&w!==U?0:L),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:L),k>=0&&(n.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:L)}markUsedOrientation(n,s,p){const _=s===a.bk.horizontal||s===a.bk.horizontalOnly?s:0,x=s===a.bk.vertical?s:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L}=p,z=n.text.placedSymbolArray;w>=0&&(z.get(w).placedOrientation=_),A>=0&&(z.get(A).placedOrientation=_),k>=0&&(z.get(k).placedOrientation=_),L>=0&&(z.get(L).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let p=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const _=s?s.symbolFadeChange(n):1,x=s?s.opacities:{},w=s?s.variableOffsets:{},A=s?s.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],z=x[k];z?(this.opacities[k]=new vo(z,_,L.text,L.icon,null,L.clipped),p=p||L.text!==z.text.placed||L.icon!==z.icon.placed):(this.opacities[k]=new vo(null,_,L.text,L.icon,L.skipFade,L.clipped),p=p||L.text||L.icon)}for(const k in x){const L=x[k];if(!this.opacities[k]){const z=new vo(L,_,!1,!1);z.isHidden()||(this.opacities[k]=z,p=p||L.text.placed||L.icon.placed)}}for(const k in w)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=w[k]);for(const k in A)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=A[k]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s,p,_){const x=new Set;for(const w of s){const A=w.getBucket(n);A&&w.latestFeatureIndex&&n.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,x,w,w.collisionBoxArray,p,_,w.tileID,n.scope),A.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,w.tileID),A.updateZOffset()))}}updateBucketOpacities(n,s,p,_,x,w,A,k){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const L=n.layers[0].layout,z=n.layers[0].paint,U=!!n.layers[0].dynamicFilter(),j=new vo(null,0,!1,!1,!0),$=L.get("text-allow-overlap"),Y=L.get("icon-allow-overlap"),K=L.get("text-variable-anchor"),J=L.get("text-rotation-alignment")==="map",Q=L.get("text-pitch-alignment")==="map",fe=z.get("symbol-z-offset"),ge=z.get("symbol-elevation-reference")==="sea",he=!fe.isConstant(),xe=new vo(null,0,$&&(Y||!n.hasIconData()||L.get("icon-optional")),Y&&($||!n.hasTextData()||L.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const ve=(Ee,Pe,ze)=>{for(let ke=0;ke<Pe/4;ke++)Ee.opacityVertexArray.emplaceBack(ze)};let Ie=0;w&&n.updateReplacement(A,w);for(let Ee=0;Ee<n.symbolInstances.length;Ee++){const Pe=n.symbolInstances.get(Ee),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:ke,crossTileID:De,numIconVertices:$e,tileAnchorX:nt,tileAnchorY:pt}=Pe;let rt=null;if(Pe&&he){const kt=this.retainedQueryData[n.bucketInstanceId];rt=p.latestFeatureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:kt.bucketIndex,sourceLayerIndex:kt.sourceLayerIndex,layoutVertexArrayOffset:0})}const xt=fe.evaluate(rt,{}),We=s.has(De);let ut=this.opacities[De];We?ut=j:ut||(ut=xe,this.opacities[De]=ut),s.add(De);const at=ze>0||ke>0,wt=$e>0,Et=this.placedOrientations[De],ft=Et===a.bk.vertical,_t=Et===a.bk.horizontal||Et===a.bk.horizontalOnly;!at&&!wt||ut.isHidden()||Ie++;let ir=!1;if((at||wt)&&w)for(const kt of n.activeReplacements){if(a.br(kt,x,a.bs.Symbol,k)||kt.min.x>nt||nt>kt.max.x||kt.min.y>pt||pt>kt.max.y)continue;const Vt=a.bt(nt,pt,A.canonical,kt.footprintTileId.canonical);if(ir=a.bu(Vt,kt.footprint),ir)break}if(at){const kt=ir?zc:Lc(ut.text);ve(n.text,ze,ft?zc:kt),ve(n.text,ke,_t?zc:kt);const Vt=ut.text.isHidden(),{leftJustifiedTextSymbolIndex:dr,centerJustifiedTextSymbolIndex:Jt,rightJustifiedTextSymbolIndex:lr,verticalPlacedTextSymbolIndex:Or}=Pe,Pr=n.text.placedSymbolArray,pn=Vt||ft?1:0;dr>=0&&(Pr.get(dr).hidden=pn),Jt>=0&&(Pr.get(Jt).hidden=pn),lr>=0&&(Pr.get(lr).hidden=pn),Or>=0&&(Pr.get(Or).hidden=Vt||_t?1:0);const xn=this.variableOffsets[De];xn&&this.markUsedJustification(n,xn.anchor,Pe,Et);const Cn=this.placedOrientations[De];Cn&&(this.markUsedJustification(n,"left",Pe,Cn),this.markUsedOrientation(n,Cn,Pe))}if(wt){const kt=ir?zc:Lc(ut.icon),{placedIconSymbolIndex:Vt,verticalPlacedIconSymbolIndex:dr}=Pe,Jt=n.icon.placedSymbolArray,lr=ut.icon.isHidden()?1:0;Vt>=0&&(ve(n.icon,$e,ft?zc:kt),Jt.get(Vt).hidden=lr),dr>=0&&(ve(n.icon,Pe.numVerticalIconVertices,_t?zc:kt),Jt.get(dr).hidden=lr)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const kt=n.collisionArrays[Ee];if(kt){let Vt=new a.P(0,0),dr=!0;if(kt.textBox||kt.verticalTextBox){if(K){const lr=this.variableOffsets[De];lr?(Vt=Oc(lr.anchor,lr.width,lr.height,lr.textOffset,lr.textScale),J&&Vt._rotate(Q?this.transform.angle:-this.transform.angle)):dr=!1}U&&(dr=!ut.clipped),kt.textBox&&Fd(n.textCollisionBox.collisionVertexArray,ut.text.placed,!dr||ft,xt,ge,Vt.x,Vt.y),kt.verticalTextBox&&Fd(n.textCollisionBox.collisionVertexArray,ut.text.placed,!dr||_t,xt,ge,Vt.x,Vt.y)}const Jt=dr&&!!(!_t&&kt.verticalIconBox);kt.iconBox&&Fd(n.iconCollisionBox.collisionVertexArray,ut.icon.placed,Jt,xt,ge,Pe.hasIconTextFit?Vt.x:0,Pe.hasIconTextFit?Vt.y:0),kt.verticalIconBox&&Fd(n.iconCollisionBox.collisionVertexArray,ut.icon.placed,!Jt,xt,ge,Pe.hasIconTextFit?Vt.x:0,Pe.hasIconTextFit?Vt.y:0)}}}if(n.fullyClipped=Ie===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Ee.invProjMatrix,n.placementViewportMatrix=Ee.viewportMatrix,n.collisionCircleArray=Ee.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){const p=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Fd(f,n,s,p,_,x,w){f.emplaceBack(n?1:0,s?1:0,x||0,w||0,p,_?1:0),f.emplaceBack(n?1:0,s?1:0,x||0,w||0,p,_?1:0),f.emplaceBack(n?1:0,s?1:0,x||0,w||0,p,_?1:0),f.emplaceBack(n?1:0,s?1:0,x||0,w||0,p,_?1:0)}const Ts=Math.pow(2,25),$b=Math.pow(2,24),Fy=Math.pow(2,17),ko=Math.pow(2,16),Wb=Math.pow(2,9),Bd=Math.pow(2,8),By=Math.pow(2,1);function Lc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Ts+n*$b+s*Fy+n*ko+s*Wb+n*Bd+s*By+n}const zc=0;class Gb{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,s,p,_,x){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(w,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((A,k)=>A.sortKey-k.sortKey));this._currentPartIndex<w.length;){const A=w[this._currentPartIndex];if(s.placeLayerBucketPart(A,this._seenCrossTileIDs,p,A.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class lh{constructor(n,s,p,_,x,w,A,k,L){this.placement=new Ul(n,x,w,A,k,L),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,s,p,_){const x=a.q.now(),w=()=>{const A=a.q.now()-x;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=s[n[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=k)&&(!A.maxzoom||A.maxzoom>k)){const L=A,z=L.layout.get("symbol-z-elevate"),U=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=L.layout.get("symbol-z-order"),$=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&U),Y=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),K=$&&Y,J=this._inProgressLayer=this._inProgressLayer||new Gb(L),Q=a.av(A.source,A.scope);if(J.continuePlacement(z||K?_[Q]:p[Q],this.placement,this._showCollisionBoxes,A,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const jl=512/a.ab/2;class Hb{constructor(n,s,p){this.tileID=n,this.bucketInstanceId=p,this.index=new a.by(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=n.canonical.x*a.ab,x=n.canonical.y*a.ab;for(let w=0;w<s.length;w++){const{key:A,crossTileID:k,tileAnchorX:L,tileAnchorY:z}=s.get(w),U=Math.floor((_+L)*jl),j=Math.floor((x+z)*jl);this.index.add(U,j),this.keys.push(A),this.crossTileIDs.push(k)}this.index.finish()}findMatches(n,s,p){const _=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),x=jl/Math.pow(2,s.canonical.z-this.tileID.canonical.z),w=s.canonical.x*a.ab,A=s.canonical.y*a.ab;for(let k=0;k<n.length;k++){const L=n.get(k);if(L.crossTileID)continue;const{key:z,tileAnchorX:U,tileAnchorY:j}=L,$=Math.floor((w+U)*x),Y=Math.floor((A+j)*x),K=this.index.range($-_,Y-_,$+_,Y+_);for(const J of K){const Q=this.crossTileIDs[J];if(this.keys[J]===z&&!p.has(Q)){p.add(Q),L.crossTileID=Q;break}}}}}class Fc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ny{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const s=Math.round((n-this.lng)/360);if(s!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const w in _){const A=_[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+s),x[A.tileID.key]=A}this.indexes[p]=x}this.lng=n}addBucket(n,s,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<s.symbolInstances.length;x++)s.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const _=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>n.overscaledZ)for(const A in w){const k=w[A];k.tileID.isChildOf(n)&&k.findMatches(s.symbolInstances,n,_)}else{const A=w[n.scaledTo(Number(x)).key];A&&A.findMatches(s.symbolInstances,n,_)}}for(let x=0;x<s.symbolInstances.length;x++){const w=s.symbolInstances.get(x);w.crossTileID||(w.crossTileID=p.generate(),_.add(w.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Hb(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(const p of s.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let s=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)n[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],s=!0)}return s}}class Nd{constructor(){this.layerIndexes={},this.crossTileIDs=new Fc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,p,_){let x=this.layerIndexes[n.fqid];x===void 0&&(x=this.layerIndexes[n.fqid]=new Ny);let w=!1;const A={};_.name!=="globe"&&x.handleWrapJump(p);for(const k of s){const L=k.getBucket(n);L&&n.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(k.tileID,L,this.crossTileIDs)&&(w=!0),A[L.bucketInstanceId]=!0)}return x.removeStaleBuckets(A)&&(w=!0),w}pruneUnusedLayers(n){const s={};n.forEach(p=>{s[p]=!0});for(const p in this.layerIndexes)s[p]||delete this.layerIndexes[p]}}const qo=771;class Ur{constructor(n,s,p,_){this.blendFunction=n,this.blendColor=s,this.mask=p,this.blendEquation=_}}Ur.Replace=[1,0,1,0],Ur.disabled=new Ur(Ur.Replace,a.bz.transparent,[!1,!1,!1,!1]),Ur.unblended=new Ur(Ur.Replace,a.bz.transparent,[!0,!0,!0,!0]),Ur.alphaBlended=new Ur([1,qo,1,qo],a.bz.transparent,[!0,!0,!0,!0]),Ur.alphaBlendedNonPremultiplied=new Ur([770,qo,770,qo],a.bz.transparent,[!0,!0,!0,!0]),Ur.multiply=new Ur([774,0,774,0],a.bz.transparent,[!0,!0,!0,!0]);class ar{constructor(n,s,p){this.func=n,this.mask=s,this.range=p}}ar.ReadOnly=!1,ar.ReadWrite=!0,ar.disabled=new ar(519,ar.ReadOnly,[0,1]);const hm=7680;class Tr{constructor(n,s,p,_,x,w){this.test=n,this.ref=s,this.mask=p,this.fail=_,this.depthFail=x,this.pass=w}}Tr.disabled=new Tr({func:519,mask:0},0,0,hm,hm,hm);const dm=1029,ch=2305;class mr{constructor(n,s,p){this.enable=n,this.mode=s,this.frontFace=p}}function fm(f,n){const s=a.bC(f,3);a.a6.mat4.fromQuat(f,n),a.bE(f,3,s)}function Ud(f,n){const s=a.a6.quat.identity([]);return a.a6.quat.rotateZ(s,s,-n),a.a6.quat.rotateX(s,s,-f),s}function pm(f,n){const s=[f[0],f[1],0],p=[n[0],n[1],0];if(a.a6.vec3.length(s)>=1e-15){const w=a.a6.vec3.normalize([],s);a.a6.vec3.scale(p,w,a.a6.vec3.dot(p,w)),n[0]=p[0],n[1]=p[1]}const _=a.a6.vec3.cross([],n,f);if(a.a6.vec3.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return Ud(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}mr.disabled=new mr(!1,dm,ch),mr.backCCW=new mr(!0,dm,ch),mr.backCW=new mr(!0,dm,2304),mr.frontCW=new mr(!0,1028,2304),mr.frontCCW=new mr(!0,1028,ch);class rl{constructor(n,s){this.position=n,this.orientation=s}get position(){return this._position}set position(n){if(n){const s=n instanceof a.a5?n:new a.a5(n[0],n[1],n[2]);this._renderWorldCopies&&(s.x=a.bA(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(n,s){if(this.orientation=null,!this.position)return;const p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(a.a5.fromLngLat(n)):0,x=a.a5.fromLngLat(n,_),w=[x.x-p.x,x.y-p.y,x.z-p.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=pm(w,s)}setPitchBearing(n,s){this.orientation=Ud(a.bB(n),a.bB(-s))}}class Vl{constructor(n,s){this._transform=a.a6.mat4.identity([]),this.orientation=s,this.position=n}get mercatorPosition(){const n=this.position;return new a.a5(n[0],n[1],n[2])}get position(){const n=a.bC(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var s;n&&a.bE(this._transform,3,[(s=n)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||a.a6.quat.identity([]),n&&fm(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,s){this._orientation=Ud(n,s),fm(this._transform,this._orientation)}forward(){const n=a.bC(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.bC(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.bC(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,s){const p=new Float64Array(16);return a.a6.mat4.invert(p,this.getWorldToCamera(n,s)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,s,p){const _=this.position;a.a6.vec3.scale(_,_,-n);const x=new Float64Array(16);return a.a6.mat4.fromScaling(x,[p,p,p]),a.a6.mat4.translate(x,x,_),x[10]*=s,x}getWorldToCamera(n,s){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return a.a6.quat.conjugate(_,this._orientation),a.a6.vec3.scale(x,x,-n),a.a6.mat4.fromQuat(p,_),a.a6.mat4.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=s,p[9]*=s,p[10]*=s,p[11]*=s,p}getCameraToClipPerspective(n,s,p,_){const x=new Float64Array(16);return a.a6.mat4.perspective(x,n,s,p,_),x}getCameraToClipOrthographic(n,s,p,_,x,w){const A=new Float64Array(16);return a.a6.mat4.ortho(A,n,s,p,_,x,w),A}getDistanceToElevation(n,s=!1){const p=n===0?0:a.bD(n,s?a.aM(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new Vl([...this.position],[...this.orientation])}}const to={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class jd{constructor(n=0,s=0,p=0,_=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=p,this.right=_}interpolate(n,s,p){return s.top!=null&&n.top!=null&&(this.top=a.aa(n.top,s.top,p)),s.bottom!=null&&n.bottom!=null&&(this.bottom=a.aa(n.bottom,s.bottom,p)),s.left!=null&&n.left!=null&&(this.left=a.aa(n.left,s.left,p)),s.right!=null&&n.right!=null&&(this.right=a.aa(n.right,s.right,p)),this}getCenter(n,s){const p=a.ap((this.left+n-this.right)/2,0,n),_=a.ap((this.top+s-this.bottom)/2,0,s);return new a.P(p,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new jd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Bc=(f,n,s)=>(1-s)*f+s*n,Nc=f=>f*f*f*f*f;class Vd{constructor(n,s,p,_,x,w,A){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=s||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new a.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new jd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Vl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new Vd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,s=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return a.ar(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=a.bL(this.projectionOptions);const p=this.getProjection(),_=!a.bh(s,p);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.bL({name:"mercator"});const s=n!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bA(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const s=-n*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=a.a6.mat2.create(),a.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const s=a.ap(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=a.bB(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const s=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let w=0;w<s.length;w++){const A=new a.P(s[w][0]*this.width,p+s[w][1]*(this.height-p)),k=n.pointCoordinate(A);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);_+=k[3]*L,x+=L}return x===0?NaN:_/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*s,_=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[s.x,s.y,s.z]:[n.x,n.y,n.z];const _=a.a6.vec3.length(a.a6.vec3.sub([],this._camera.position,p));return a.ap(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let s=!1;if(n.orientation&&!a.a6.quat.exactEquals(n.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];a.a6.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,s=new rl;return s.position=new a.a5(n[0],n[1],n[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(n){if(!a.a6.quat.length(n))return!1;a.a6.quat.normalize(n,n);const s=a.a6.vec3.transformQuat([],[0,0,-1],n),p=a.a6.vec3.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const _=pm(s,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const s=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=a.ap(n[2],_/p,_/s),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,p){this._unmodified=!1,this._edgeInsets.interpolate(n,s,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const s=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(n){const s=[new a.bM(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),_=this.pointCoordinate(new a.P(this.width,0)),x=this.pointCoordinate(new a.P(this.width,this.height)),w=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(p.x,_.x,x.x,w.x)),k=Math.floor(Math.max(p.x,_.x,x.x,w.x)),L=1;for(let z=A-L;z<=k+L;z++)z!==0&&s.push(new a.bM(z,n))}return s}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,s,p){let _=[];const x=p!==void 0,w=!x;if(w&&this.zoom<s||x&&p[0]===0&&p[1]===0)return _;const A=new Set,k=(z,U,j,$,Y)=>{const K=a.c1(U,z,j,$,Y);A.has(K)||(_.push(new a.aA(z,U,j,$,Y)),A.add(K))};for(let z=0;z<n.length;z++){const U=n[z];if(w&&U.canonical.z!==s)continue;const j=U.canonical,$=U.overscaledZ,Y=U.wrap,K=1<<j.z,J=j.x+1<K,Q=j.x>0,fe=j.y+1<K,ge=j.y>0,he=U.wrap-(Q?0:1),xe=U.wrap+(J?0:1),ve=Q?j.x-1:K-1,Ie=J?j.x+1:0;if(x)p[0]<0?(k($,xe,j.z,Ie,j.y),p[1]<0&&fe&&(k($,Y,j.z,j.x,j.y+1),k($,xe,j.z,Ie,j.y+1)),p[1]>0&&ge&&(k($,Y,j.z,j.x,j.y-1),k($,xe,j.z,Ie,j.y-1))):p[0]>0?(k($,he,j.z,ve,j.y),p[1]<0&&fe&&(k($,Y,j.z,j.x,j.y+1),k($,he,j.z,ve,j.y+1)),p[1]>0&&ge&&(k($,Y,j.z,j.x,j.y-1),k($,he,j.z,ve,j.y-1))):p[1]<0&&fe?k($,Y,j.z,j.x,j.y+1):ge&&k($,Y,j.z,j.x,j.y-1);else{const Ee=U.visibleQuadrants;1&Ee&&(k($,he,j.z,ve,j.y),ge&&(k($,Y,j.z,j.x,j.y-1),k($,he,j.z,ve,j.y-1))),2&Ee&&(k($,xe,j.z,Ie,j.y),ge&&(k($,Y,j.z,j.x,j.y-1),k($,xe,j.z,Ie,j.y-1))),4&Ee&&(k($,he,j.z,ve,j.y),fe&&(k($,Y,j.z,j.x,j.y+1),k($,he,j.z,ve,j.y+1))),8&Ee&&(k($,xe,j.z,Ie,j.y),fe&&(k($,Y,j.z,j.x,j.y+1),k($,xe,j.z,Ie,j.y+1)))}}const L=[];for(const z of _)_.some(U=>z.isChildOf(U))||L.push(z);if(_=L.filter(z=>!n.some(U=>!!(z.overscaledZ<s&&U.isChildOf(z))||z.equals(U)||z.isChildOf(U))),w){const z=1<<s,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[z*U.x,z*U.y],$=4,Y=$*$;_=_.filter(K=>{const J=K.canonical.x+.5-j[0],Q=K.canonical.y+.5-j[1];return J*J+Q*Q<Y})}return _}coveringTiles(n){let s=this.coveringZoomLevel(n);const p=s,_=this.elevation&&this.elevation.exaggeration(),x=_&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&s<n.minzoom)return[];n.maxzoom!==void 0&&s>n.maxzoom&&(s=n.maxzoom);const A=this.locationCoordinate(this.center),k=this.center.lat,L=1<<s,z=[L*A.x,L*A.y,0],U=this.projection.name==="globe",j=!U,$=a.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,j),Y=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=L*a.bD(1,this.center.lat),J=this._camera.position[2]/a.bD(1,this.center.lat),Q=[L*Y.x,L*Y.y,J*(j?1:K)],fe=U||_,ge=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),he=this.isLODDisabled(!0)?s:0;let xe;if(this._elevation&&n.isTerrainDEM)xe=1e4*this._elevation.exaggeration();else if(this._elevation){const We=this._elevation.getMinMaxForVisibleTiles();xe=We?We.max:this._centerAltitude}else xe=this._centerAltitude;const ve=n.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?a.bO(this):1,Ee=We=>{const at=new a.a5(We.x+25e-6,We.y,We.z),wt=new a.a5(We.x,We.y+25e-6,We.z),Et=We.toLngLat(),ft=at.toLngLat(),_t=wt.toLngLat(),ir=this.locationCoordinate(Et),kt=this.locationCoordinate(ft),Vt=this.locationCoordinate(_t),dr=Math.hypot(kt.x-ir.x,kt.y-ir.y),Jt=Math.hypot(Vt.x-ir.x,Vt.y-ir.y);return Math.sqrt(dr*Jt)*Ie/25e-6},Pe=We=>{const ut=xe,at=ve;return{aabb:a.bR(this,L,0,0,0,We,at,ut,this.projection),zoom:0,x:0,y:0,minZ:at,maxZ:ut,wrap:We,fullyVisible:!1}},ze=[];let ke=[];const De=s,$e=n.reparseOverscaled?p:s,nt=(J-this._centerAltitude)*K,pt=We=>{if(!this._elevation||!We.tileID||!w)return;const ut=this._elevation.getMinMaxForTile(We.tileID),at=We.aabb;ut?(at.min[2]=ut.min,at.max[2]=ut.max,at.center[2]=(at.min[2]+at.max[2])/2):(We.shouldSplit=xt(We),We.shouldSplit||(at.min[2]=at.max[2]=at.center[2]=this._centerAltitude))},rt=(We,ut)=>{if(.707*ut<We)return 1;const at=ut/We;return at/(1.4144271570014144+(Math.pow(1.1,at-1.4144271570014144+1)-1)/(1.1-1)-1)},xt=We=>{if(We.zoom<he)return!0;if(We.zoom===De)return!1;if(We.shouldSplit!=null)return We.shouldSplit;const ut=We.aabb.distanceX(Q),at=We.aabb.distanceY(Q);let wt=nt,Et=1;if(U){wt=We.aabb.distanceZ(Q);const Jt=Math.pow(2,We.zoom),lr=a.aM((We.y+1)/Jt),Or=a.aM(We.y/Jt),Pr=Math.min(Math.max(k,lr),Or),pn=a.c5(Pr)/a.c5(k);if(Et=Pr===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pn/this._mercatorScaleRatio),this.zoom<=a.c2&&We.zoom===De-1&&pn>=.9)return!0}else if(x&&(wt=We.aabb.distanceZ(Q)*K),this.projection.isReprojectedInTileSpace&&p<=5){const Jt=Math.pow(2,We.zoom),lr=Ee(new a.a5((We.x+.5)/Jt,(We.y+.5)/Jt));Et=lr>.85?1:lr}if(!w){const Jt=Math.sqrt(ut*ut+at*at+wt*wt);let lr=(1<<De-We.zoom)*ge*Et;return lr*=rt(Math.max(wt,nt),Jt),Jt<lr}let ft=Number.MAX_VALUE,_t=0;const ir=We.aabb.getCorners(),kt=[];for(const Jt of ir){a.a6.vec3.sub(kt,Jt,Q),U||(x?kt[2]*=K:kt[2]=nt);const lr=a.a6.vec3.dot(kt,this._camera.forward());lr<ft&&(ft=lr,_t=Math.abs(kt[2]))}let Vt=(1<<De-We.zoom)*ge*Et;if(Vt*=rt(Math.max(_t,nt),ft),ft<Vt)return!0;const dr=We.aabb.closestPoint(z);return dr[0]===z[0]&&dr[1]===z[1]};if(this.renderWorldCopies)for(let We=1;We<=3;We++)ze.push(Pe(-We)),ze.push(Pe(We));for(ze.push(Pe(0));ze.length>0;){const We=ze.pop(),ut=We.x,at=We.y;let wt=We.fullyVisible;const Et=()=>this.projection.name==="globe"&&(We.y===0||We.y===(1<<We.zoom)-1);if(!wt){let ft=fe?We.aabb.intersects($):We.aabb.intersectsFlat($);if(ft===0&&Et()){const _t=new a.bP(We.zoom,ut,at);ft=a.bQ(this,L,_t,!0).intersects($)}if(ft===0)continue;wt=ft===2}if(We.zoom!==De&&xt(We))for(let ft=0;ft<4;ft++){const _t=(ut<<1)+ft%2,ir=(at<<1)+(ft>>1),kt={aabb:w?We.aabb.quadrant(ft):a.bR(this,L,We.zoom+1,_t,ir,We.wrap,We.minZ,We.maxZ,this.projection),zoom:We.zoom+1,x:_t,y:ir,wrap:We.wrap,fullyVisible:wt,tileID:void 0,shouldSplit:void 0,minZ:We.minZ,maxZ:We.maxZ};x&&!U&&(kt.tileID=new a.aA(We.zoom+1===De?$e:We.zoom+1,We.wrap,We.zoom+1,_t,ir),pt(kt)),ze.push(kt)}else{const ft=We.zoom===De?$e:We.zoom;if(n.minzoom&&n.minzoom>ft)continue;let _t=0;if(!wt){let dr=fe?We.aabb.intersectsPrecise($):We.aabb.intersectsPreciseFlat($);if(dr===0&&Et()){const Jt=new a.bP(We.zoom,ut,at);dr=a.bQ(this,L,Jt,!0).intersectsPrecise($)}if(dr===0)continue;if(n.calculateQuadrantVisibility)if($.containsPoint(We.aabb.center))_t=15;else for(let Jt=0;Jt<4;Jt++)We.aabb.quadrant(Jt).intersects($)!==0&&(_t|=1<<Jt)}const ir=z[0]-(.5+ut+(We.wrap<<We.zoom))*(1<<s-We.zoom),kt=z[1]-.5-at,Vt=We.tileID?We.tileID:new a.aA(ft,We.wrap,We.zoom,ut,at);n.calculateQuadrantVisibility&&(Vt.visibleQuadrants=_t),ke.push({tileID:Vt,distanceSq:ir*ir+kt*kt})}}if(this.fogCullDistSq){const We=this.fogCullDistSq,ut=this.horizonLineFromTop();ke=ke.filter(at=>{const wt=[0,0,0,1],Et=[a.ab,a.ab,0,1],ft=this.calculateFogTileMatrix(at.tileID.toUnwrapped());a.a6.vec4.transformMat4(wt,wt,ft),a.a6.vec4.transformMat4(Et,Et,ft);const _t=a.a6.vec4.min([],wt,Et),ir=a.a6.vec4.max([],wt,Et),kt=a.bS(_t,ir);if(kt===0)return!0;let Vt=!1;const dr=this._elevation;if(dr&&kt>We&&ut!==0){const Jt=this.calculateProjMatrix(at.tileID.toUnwrapped());let lr;n.isTerrainDEM||(lr=dr.getMinMaxForTile(at.tileID)),lr||(lr={min:ve,max:xe});const Or=a.c3(this.rotation),Pr=[Or[0]*a.ab,Or[1]*a.ab,lr.max];a.a6.vec3.transformMat4(Pr,Pr,Jt),Vt=(1-Pr[1])*this.height*.5<ut}return kt<We||Vt})}return ke.sort((We,ut)=>We.distanceSq-ut.distanceSq).map(We=>We.tileID)}resize(n,s){this.width=n,this.height=s,this.pixelsToGLUnits=[2/n,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const s=a.ap(n.lat,-a.bT,a.bT),p=this.projection.project(n.lng,s);return new a.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,s){let p,_;const x=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;p=(s.x-x.x)/A,_=(s.y-x.y)/A}else{const A=this.pointCoordinate(s),k=this.pointCoordinate(x);p=A.x-k.x,_=A.y-k.y}const w=this.locationCoordinate(n);this.setLocation(new a.a5(w.x-p,w.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,s){const p=s?a.bD(s,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new a.a5(_.x,_.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,s){const p=s??this._centerAltitude,_=[n.x,n.y,0,1],x=[n.x,n.y,1,1];a.a6.vec4.transformMat4(_,_,this.pixelMatrixInverse),a.a6.vec4.transformMat4(x,x,this.pixelMatrixInverse);const w=x[3];a.a6.vec4.scale(_,_,1/_[3]),a.a6.vec4.scale(x,x,1/w);const A=_[2],k=x[2];return{p0:_,p1:x,t:A===k?0:(p-A)/(k-A)}}screenPointToMercatorRay(n){const s=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return a.a6.vec4.transformMat4(s,s,this.pixelMatrixInverse),a.a6.vec4.transformMat4(p,p,this.pixelMatrixInverse),a.a6.vec4.scale(s,s,1/s[3]),a.a6.vec4.scale(p,p,1/p[3]),s[2]=a.bD(s[2],this._center.lat)*this.worldSize,p[2]=a.bD(p[2],this._center.lat)*this.worldSize,a.a6.vec4.scale(s,s,1/this.worldSize),a.a6.vec4.scale(p,p,1/this.worldSize),new a.aj([s[0],s[1],s[2]],a.a6.vec3.normalize([],a.a6.vec3.sub([],p,s)))}rayIntersectionCoordinate(n){const{p0:s,p1:p,t:_}=n,x=a.bD(s[2],this._center.lat),w=a.bD(p[2],this._center.lat);return new a.a5(a.aa(s[0],p[0],_)/this.worldSize,a.aa(s[1],p[1],_)/this.worldSize,a.aa(x,w,_))}pointCoordinate(n,s=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,s)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let s=this.projection.pointCoordinate3D(this,n.x,n.y);if(s)return new a.a5(s[0],s[1],s[2]);let p=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const x=.02*_,w=n.clone();for(let A=0;A<10&&_-p>x;A++){w.y=a.aa(p,_,.66);const k=this.projection.pointCoordinate3D(this,w.x,w.y);k?(_=w.y,s=k):p=w.y}return s?new a.a5(s[0],s[1],s[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=a.bU)return!this.isPointAboveHorizon(n);const s=this.pointCoordinate(n);return s.y>=0&&s.y<=1}_coordinatePoint(n,s){const p=s&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return a.a6.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new a.P(_[0]/_[3],_[1]/_[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:s}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new a.P(s,n)),w=this.pointLocation3D(new a.P(_,n)),A=this.pointLocation3D(new a.P(_,p)),k=this.pointLocation3D(new a.P(s,p));let L=Math.min(x.lng,w.lng,A.lng,k.lng),z=Math.max(x.lng,w.lng,A.lng,k.lng),U=Math.min(x.lat,w.lat,A.lat,k.lat),j=Math.max(x.lat,w.lat,A.lat,k.lat);const $=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,K=(J,Q,fe,ge,he)=>{const xe=(J+fe)/2,ve=(Q+ge)/2,Ie=new a.P(xe,ve),{lng:Ee,lat:Pe}=this.pointLocation3D(Ie),ze=Math.max(0,L-Ee,U-Pe,Ee-z,Pe-j);L=Math.min(L,Ee),z=Math.max(z,Ee),U=Math.min(U,Pe),j=Math.max(j,Pe),(he<Y||ze>$)&&(K(J,Q,xe,ve,he+1),K(xe,ve,fe,ge,he+1))};if(K(s,n,_,n,1),K(_,n,_,p,1),K(_,p,s,p,1),K(s,p,s,n,1),this.projection.name==="globe"){const[J,Q]=a.bV(this);J?(j=90,z=180,L=-180):Q&&(U=-90,z=180,L=-180)}return new a.as(new a.bK(L,U),new a.bK(z,j))}_getBoundsRectangular(n,s){const{top:p,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,A=new a.P(_,p),k=new a.P(w,p),L=new a.P(w,x),z=new a.P(_,x);let U=this.pointCoordinate(A,n),j=this.pointCoordinate(k,n);const $=this.pointCoordinate(L,s),Y=this.pointCoordinate(z,s),K=(J,Q)=>(Q.y-J.y)/(Q.x-J.x);return U.y>1&&j.y>=0?U=new a.a5((1-Y.y)/K(Y,U)+Y.x,1):U.y<0&&j.y<=1&&(U=new a.a5(-Y.y/K(Y,U)+Y.x,0)),j.y>1&&U.y>=0?j=new a.a5((1-$.y)/K($,j)+$.x,1):j.y<0&&U.y<=1&&(j=new a.a5(-$.y/K($,j)+$.x,0)),new a.as().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=n.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*n.exaggeration(),s.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-s*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.bT,this.maxLat=a.bT,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.am(this.minLng)*this.tileSize,this.worldMaxX=a.am(this.maxLng)*this.tileSize,this.worldMinY=a.at(this.maxLat)*this.tileSize,this.worldMaxY=a.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,s){return this.projection.createTileMatrix(this,s,n)}calculateDistanceTileData(n){const s=n.key,p=this._distanceTileDataCache;if(p[s])return p[s];const _=n.canonical,x=1/this.height,w=this.cameraWorldSize,A=w/this.zoomScale(_.z),k=(_.x+Math.pow(2,_.z)*n.wrap)*A,L=_.y*A,z=this.point;z.x*=w/this.worldSize,z.y*=w/this.worldSize;const U=this.angle,j=Math.sin(-U),$=-Math.cos(-U);return p[s]={bearing:[j,$],center:[(z.x-k)*x,(z.y-L)*x],scale:A/a.ab*x},p[s]}calculateFogTileMatrix(n){const s=n.key,p=this._fogTileMatrixCache;if(p[s])return p[s];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return a.a6.mat4.multiply(_,this.worldToFogMatrix,_),p[s]=new Float32Array(_),p[s]}calculateProjMatrix(n,s=!1,p=!1){const _=n.key;let x;if(x=p?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,x[_])return x[_];const w=this.calculatePosMatrix(n,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,a.a6.mat4.multiply(w,A,w),x[_]=new Float32Array(w),x[_]}calculatePixelsToTileUnitsMatrix(n){const s=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[s])return p[s];const _=a.bW(n,this);return p[s]=_,p[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,s=a.a6.mat4.fromScaling([],[n,n,n]);return a.a6.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const s=a.bD(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(s),_=this._camera.forward(),x=a.bD(1,this._center.lat);p[2]/=x,_[2]/=x,a.a6.vec3.normalize(_,_);const w=n.raycast(p,_,n.exaggeration());if(w){const A=a.a6.vec3.scaleAndAdd([],p,_,w),k=new a.a5(A[0],A[1],a.bD(A[2],a.aM(A[1]))),L=(k.z+a.a6.vec3.length([k.x-p[0],k.y-p[1],k.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const s=this._elevation,p=a.bD(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),x=s.getAtPointOrZero(new a.a5(..._)),w=this.pixelsPerMeter/this.worldSize*x,A=this._minimumHeightOverTerrain(),k=_[2]-w;if(k<=A)if(k<0||n){const L=this.locationCoordinate(this._center,this._centerAltitude),z=[_[0],_[1],L.z-_[2]],U=a.a6.vec3.length(z);z[2]-=(A-k)/this._pixelsPerMercatorPixel;const j=a.a6.vec3.length(z);if(j===0)return;a.a6.vec3.scale(z,z,U/j*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],L.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const j=this.center;return j.lat=a.ap(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(j.lng=a.ap(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const s=this._unmodified,{x:p,y:_}=this.point;let x=0,w=p,A=_;const k=this.width/2,L=this.height/2,z=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(_-L<z&&(A=z+L),_+L>U&&(A=U-L),U-z<this.height&&(x=Math.max(x,this.height/(U-z)),A=(U+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,Y=this.worldSize/2-(j+$)/2;w=(p+Y+this.worldSize)%this.worldSize-Y,w-k<j&&(w=j+k),w+k>$&&(w=$-k),$-j<this.width&&(x=Math.max(x,this.width/($-j)),w=($+j)/2)}w===p&&A===_||(this.center=this.unproject(new a.P(w,A))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,s=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.bD(1,this.center.lat)/a.bD(1,a.c4));const _=a.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?p:1,w=this._camera.getWorldToCamera(this.worldSize,x);let A;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-n.x/this.width,k[9]=2*n.y/this.height,this.isOrthographic){let Pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ze=Pe*this.aspect,ke=-ze,De=-Pe;ze-=n.x,ke-=n.x,Pe+=n.y,De+=n.y,A=this._camera.getCameraToClipOrthographic(ke,ze,De,Pe,this._nearZ,this._farZ),(($e,nt,pt,rt)=>{for(let xt=0;xt<16;xt++)$e[xt]=Bc(nt[xt],pt[xt],rt)})(A,A,k,Nc(this.pitch>=15?1:this.pitch/15))}else A=k;const L=a.a6.mat4.mul([],k,w);let z=a.a6.mat4.mul([],A,w);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),ze=a.a6.mat4.identity([]);a.a6.mat4.translate(ze,ze,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),a.a6.mat4.multiply(ze,ze,a.bY(this)),a.a6.mat4.translate(ze,ze,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),a.a6.mat4.multiply(z,z,ze),a.a6.mat4.multiply(L,L,ze),this.inverseAdjustmentMatrix=a.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.a6.mat4.scale([],z,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=z,this.invProjMatrix=a.a6.mat4.invert(new Float64Array(16),this.projMatrix),s){const Pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Pe[8]=2*-n.x/this.width,Pe[9]=2*n.y/this.height,this.expandedFarZProjMatrix=a.a6.mat4.mul([],Pe,w)}else this.expandedFarZProjMatrix=this.projMatrix;const U=a.a6.mat4.invert([],A);this.frustumCorners=a.b_.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const j=new Float32Array(16);a.a6.mat4.identity(j),a.a6.mat4.scale(j,j,[1,-1,1]),a.a6.mat4.rotateX(j,j,this._pitch),a.a6.mat4.rotateZ(j,j,this.angle);const $=a.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.a6.mat4.clone($);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-n.x/this.width,$[9]=2*(n.y+Y)/this.height,this.skyboxMatrix=a.a6.mat4.multiply(j,$,j);const K=this.point,J=K.x,Q=K.y,fe=this.width%2/2,ge=this.height%2/2,he=Math.cos(this.angle),xe=Math.sin(this.angle),ve=J-Math.round(J)+he*fe+xe*ge,Ie=Q-Math.round(Q)+he*ge+xe*fe,Ee=new Float64Array(z);if(a.a6.mat4.translate(Ee,Ee,[ve>.5?ve-1:ve,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=Ee,z=a.a6.mat4.create(),a.a6.mat4.scale(z,z,[this.width/2,-this.height/2,1]),a.a6.mat4.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=a.a6.mat4.create(),a.a6.mat4.scale(z,z,[1,-1,1]),a.a6.mat4.translate(z,z,[-1,-1,0]),a.a6.mat4.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=a.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},z=a.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.b$(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.a6.vec3.transformMat4(Pe,Pe,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[n,n,s];a.a6.vec3.scale(x,x,_),a.a6.vec3.scale(p,p,-1),a.a6.vec3.multiply(p,p,x);const w=a.a6.mat4.create();a.a6.mat4.translate(w,w,p),a.a6.mat4.scale(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,s,_)}_computeCameraPosition(n){const s=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,n/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=n[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((s-p)/_,1)),this._camera.position=a.a6.vec3.scaleAndAdd([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,s=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=a.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.bB(this._maxPitch)),A=Math.max((n[2]-x)/Math.cos(p),w),k=this._zoomFromMercatorZ(A);a.a6.vec3.scaleAndAdd(n,n,s,A),this._pitch=a.ap(p,a.bB(this.minPitch),a.bB(this.maxPitch)),this.angle=a.bA(_,-Math.PI,Math.PI),this._setZoom(a.ap(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.a5(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let s=0,p=a.bU,_=0,x=1/0;for(;p-s>1e-6&&p>s;){const w=s+.5*(p-s),A=this.tileSize*Math.pow(2,w),k=this.getCameraToCenterDistance(this.projection,w,A),L=this.scaleZoom(k/(n*this.tileSize)),z=Math.abs(w-L);z<x&&(x=z,_=w),w<L?s=w:p=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,s){const p=Math.min(n.x,s.x),_=Math.max(n.x,s.x),x=Math.min(n.y,s.y),w=Math.max(n.y,s.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new a.P(p,x),new a.P(_,w),new a.P(p,w),new a.P(_,x)],k=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const z of A){const U=this.pointRayIntersection(z);if(U.t<0)return!0;const j=this.rayIntersectionCoordinate(U);if(j.x<k||j.y<0||j.x>L||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(n,s){const p=a.a6.vec3.length(a.a6.vec3.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(p)+s;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([s,p,_],x){const w=[s,p,_,1];a.a6.vec4.transformMat4(w,w,x);const A=w[3]=Math.max(w[3],1e-6);return w[0]/=A,w[1]/=A,w[2]/=A,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,n))}}getCameraToCenterDistance(n,s=this.zoom,p=this.worldSize){const _=a.bX(n,s,this.width,this.height,1024),x=n.pixelSpaceConversion(this.center.lat,p,_);let w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=Bc(1,w,Nc(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.a6.mat4.multiply(n,n,this.globeMatrix),n}getFrustum(n){return a.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Es=(f,n)=>{if(n>0&&f.terrain&&a.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=f.transform,p=Math.max(Math.abs(s._zoom-(f.minCutoffZoom-1)),1),_=s.isLODDisabled(!1)?a.a7(60,45,s.pitch):a.a7(30,15,s.pitch),x=s._farZ-s._nearZ,w=n*s.height,A=((1-(k=_))*s.cameraToCenterDistance+k*(s._farZ+w))*p;var k;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(A-s._nearZ)/x,(A-w-s._nearZ)/x]}}},Vn={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class mm{constructor(n,s){this.aabb=n,this.lastCascade=s}}class zt{add(n,s){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],s.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],s.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],s.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],s.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],s.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],s.max[2])):this.receivers[n.key]=new mm(s,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,s,p){const _=a.c9.fromPoints(n.points);let x=0;for(const w in this.receivers){const A=this.receivers[w];if(!A||!_.intersectsAabb(A.aabb))continue;A.aabb.min=_.closestPoint(A.aabb.min),A.aabb.max=_.closestPoint(A.aabb.max);const k=A.aabb.getCorners();for(let L=0;L<p.length;L++){let z=!0;for(const U of k){const j=[U[0]*s,U[1]*s,U[2]];if(a.a6.vec3.transformMat4(j,j,p[L].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){z=!1;break}}if(A.lastCascade=L,x=Math.max(x,L),z)break}}return x+1}}class Uy{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new zt,this._depthMode=new ar(n.context.gl.LEQUAL,ar.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(Vn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Vn,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(Vn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,s){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const _=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||_<=0||(this._shadowLayerCount=p.style.order.reduce((Y,K)=>{const J=p.style._mergedLayers[K];return Y+(J.hasShadowPass()&&!J.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=p.context,w=Vn.shadowMapResolution,A=Vn.shadowMapResolution;if(this._cascades.length===0||Vn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<Vn.cascadeCount;++Y){const K=p._shadowMapDebug,J=x.gl,Q=x.createFramebuffer(w,A,K,"texture"),fe=new a.T(x,{width:w,height:A,data:null},J.DEPTH_COMPONENT16);if(Q.depthAttachment.set(fe.texture),K){const ge=new a.T(x,{width:w,height:A,data:null},J.RGBA8);Q.colorAttachment.set(ge.texture)}this._cascades.push({framebuffer:Q,texture:fe,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.bN,scale:0})}}this.shadowDirection=$d(s);let k=0;if(n.elevation){const Y=n.elevation,K=[1e4,-1e4];Y.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const Q=J.dem.tree;K[0]=Math.min(K[0],Q.minimums[0]),K[1]=Math.max(K[1],Q.maximums[0])}),K[0]!==1e4&&(k=(K[1]-K[0])*Y.exaggeration())}const L=1.5*n.cameraToCenterDistance,z=3*L,U=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const K=this._cascades[Y];let J=n.height/50,Q=1;Vn.cascadeCount===1?Q=z:Y===0?Q=L:(J=L,Q=z);const[fe,ge]=Gd(n,this.shadowDirection,J,Q,Vn.shadowMapResolution,k);K.scale=n.scale,K.matrix=fe,K.boundingSphereRadius=ge,a.a6.mat4.invert(U,K.matrix),K.frustum=a.bN.fromInvProjectionMatrix(U,1,0,!0),K.far=Q}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Vn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Vn.shadowMapResolution,this._uniformValues.u_shadowmap_0=to.ShadowMap0,this._uniformValues.u_shadowmap_1=to.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $=p.transform.elevation;for(const Y of this._groundShadowTiles){let K={min:0,max:0};if($){const J=$.getMinMaxForTile(Y);J&&(K=J)}this.addShadowReceiver(Y.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,s){if(!this.enabled)return;const p=this.painter,_=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),_.viewport.set([0,0,Vn.shadowMapResolution,Vn.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){p.currentShadowCascade=x,_.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),_.clear({color:a.bz.white,depth:1});for(const w of n.order){const A=n._mergedLayers[w];if(!A.hasShadowPass()||A.isHidden(p.transform.zoom))continue;const k=n.getLayerSourceCache(A),L=k?s[k.id]:void 0;(A.type==="model"||L&&L.length)&&p.renderLayer(p,k,A,L)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,s=n.style,p=n.context,_=s.directionalLight,x=s.ambientLight;if(!_||!x)return;const w=[],A=Es(n,n.longestCutoffRange);A.shouldRenderCutoff&&w.push("RENDER_CUTOFF");const k=Wd(s,_,x),L=new ar(p.gl.LEQUAL,ar.ReadOnly,n.depthRangeFor3D);for(const z of this._groundShadowTiles){const U=z.toUnwrapped(),j=n.isTileAffectedByFog(z),$=n.getOrCreateProgram("groundShadow",{defines:w,overrideFog:j});this.setupShadows(U,$),n.uploadCommonUniforms(p,$,U,null,A);const Y={u_matrix:n.transform.calculateProjMatrix(U),u_ground_shadow_factor:k};$.draw(n,p.gl.TRIANGLES,L,Tr.disabled,Ur.multiply,mr.disabled,Y,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ur.unblended:Ur.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const s=this.painter.transform,p=s.calculatePosMatrix(n,s.worldSize);return a.a6.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){return a.a6.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,s,p,_=0){if(!this.enabled)return;const x=this.painter.transform,w=this.painter.context,A=w.gl,k=this._uniformValues,L=new Float64Array(16),z=x.calculatePosMatrix(n,x.worldSize);for(let U=0;U<this._cascades.length;U++)a.a6.mat4.multiply(L,this._cascades[U].matrix,z),k[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),w.activeTexture.set(A.TEXTURE0+to.ShadowMap0+U),this._cascades[U].texture.bind(A.NEAREST,A.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const U=a.c8(n.canonical),j=2/x.tileSize*a.ab/Vn.shadowMapResolution,$=j*this._cascades[0].boundingSphereRadius,Y=j*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(p==="vector-tile"?1:3)/Math.pow(2,_-n.canonical.z-(1-x.zoom+Math.floor(x.zoom)));k.u_shadow_normal_offset=[U,$*K,Y*K],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(w,k)}setupShadowsFromMatrix(n,s,p=!1){if(!this.enabled)return;const _=this.painter.context,x=_.gl,w=this._uniformValues,A=new Float64Array(16);for(let k=0;k<Vn.cascadeCount;k++)a.a6.mat4.multiply(A,this._cascades[k].matrix,n),w[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),_.activeTexture.set(x.TEXTURE0+to.ShadowMap0+k),this._cascades[k].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const k=Vn.normalOffset;w.u_shadow_normal_offset=[1,k,k],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,s,p,_){if(_[2]>=0)return{};const x=function(k,L,z){const U=z/(1<<k.canonical.z);return new a.c9([k.canonical.x*U+k.wrap*z,k.canonical.y*U+k.wrap*z,0],[(k.canonical.x+1)*U+k.wrap*z,(k.canonical.y+1)*U+k.wrap*z,L])}(n,s,p).getCorners(),w=s/-_[2];_[0]<0?(a.a6.vec3.add(x[0],x[0],[_[0]*w,0,0]),a.a6.vec3.add(x[3],x[3],[_[0]*w,0,0])):_[0]>0&&(a.a6.vec3.add(x[1],x[1],[_[0]*w,0,0]),a.a6.vec3.add(x[2],x[2],[_[0]*w,0,0])),_[1]<0?(a.a6.vec3.add(x[0],x[0],[0,_[1]*w,0]),a.a6.vec3.add(x[1],x[1],[0,_[1]*w,0])):_[1]>0&&(a.a6.vec3.add(x[2],x[2],[0,_[1]*w,0]),a.a6.vec3.add(x[3],x[3],[0,_[1]*w,0]));const A={};return A.vertices=x,A.planes=[Uc(x[1],x[0],x[4]),Uc(x[2],x[1],x[5]),Uc(x[3],x[2],x[6]),Uc(x[0],x[3],x[7])],A}addShadowReceiver(n,s,p){this._receivers.add(n,a.c9.fromTileIdAndHeight(n,s,p))}getMaxCascadeForTile(n){const s=this._receivers.get(n);return s&&s.lastCascade?s.lastCascade:0}}function Uc(f,n,s){const p=a.a6.vec3.sub([],s,n),_=a.a6.vec3.sub([],f,n),x=a.a6.vec3.cross([],p,_),w=a.a6.vec3.length(x);return w===0?[0,0,1,0]:(a.a6.vec3.scale(x,x,1/w),[x[0],x[1],x[2],-a.a6.vec3.dot(x,n)])}function $d(f){const n=f.properties.get("direction"),s=a.c7(n.x,n.y,n.z);s[2]=a.ap(s[2],0,75);const p=a.ca([s[0],s[1],s[2]]);return a.a6.vec3.fromValues(p.x,p.y,p.z)}function Wd(f,n,s){const p=n.properties.get("color"),_=n.properties.get("intensity"),x=n.properties.get("direction"),w=[x.x,x.y,x.z],A=s.properties.get("color"),k=s.properties.get("intensity"),L=Math.max(a.a6.vec3.dot([0,0,1],w),0),z=[0,0,0];a.a6.vec3.scale(z,A.toRenderColor(f.getLut(n.scope)).toArray01Linear().slice(0,3),k);const U=[0,0,0];return a.a6.vec3.scale(U,p.toRenderColor(f.getLut(s.scope)).toArray01Linear().slice(0,3),L*_),a.cb([z[0]>0?z[0]/(z[0]+U[0]):0,z[1]>0?z[1]/(z[1]+U[1]):0,z[2]>0?z[2]/(z[2]+U[2]):0])}function Gd(f,n,s,p,_,x){const w=f.zoom,A=f.scale,k=f.worldSize,L=1/k,z=f.aspect,U=Math.sqrt(1+z*z)*Math.tan(.5*f.fovX),j=U*U,$=p-s,Y=p+s;let K,J;j>$/Y?(K=p,J=p*U):(K=.5*Y*(1+j),J=.5*Math.sqrt($*$+2*(p*p+s*s)*j+Y*Y*j*j));const Q=f.projection.pixelsPerMeter(f.center.lat,k),fe=f._camera.getCameraToWorldMercator(),ge=[0,0,-K*L];a.a6.vec3.transformMat4(ge,ge,fe);let he=J*L;const xe=f._edgeInsets;if(!(xe.left===0&&xe.top===0&&xe.right===0&&xe.bottom===0||xe.left===xe.right&&xe.top===xe.bottom)){const wt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Q:1),Et=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,s,p);Et[8]=2*-f.centerOffset.x/f.width,Et[9]=2*f.centerOffset.y/f.height;const ft=new Float64Array(16);a.a6.mat4.mul(ft,Et,wt);const _t=new Float64Array(16);a.a6.mat4.invert(_t,ft);const ir=a.bN.fromInvProjectionMatrix(_t,k,w,!0);for(const kt of ir.points){const Vt=((ve=kt)[0]/=A,ve[1]/=A,ve[2]=a.bD(ve[2],f._center.lat),ve);he=Math.max(he,a.a6.vec3.len(a.a6.vec3.subtract([],ge,Vt)))}}var ve;he*=_/(_-1);const Ie=Math.acos(n[2]),Ee=Math.atan2(-n[0],-n[1]),Pe=new Vl;Pe.position=ge,Pe.setPitchBearing(Ie,Ee);const ze=Pe.getWorldToCamera(k,Q),ke=he*k,De=Math.min(f._mercatorZfromZoom(17)*k*-2,-2*ke),$e=Pe.getCameraToClipOrthographic(-ke,ke,-ke,ke,De,(ke+x*Q)/n[2]),nt=new Float64Array(16);a.a6.mat4.multiply(nt,$e,ze);const pt=a.a6.vec3.fromValues(Math.floor(1e6*ge[0])/1e6*k,Math.floor(1e6*ge[1])/1e6*k,0),rt=.5*_,xt=[0,0,0];a.a6.vec3.transformMat4(xt,pt,nt),a.a6.vec3.scale(xt,xt,rt);const We=[Math.floor(xt[0]),Math.floor(xt[1]),Math.floor(xt[2])],ut=[0,0,0];a.a6.vec3.sub(ut,xt,We),a.a6.vec3.scale(ut,ut,-1/rt);const at=new Float64Array(16);return a.a6.mat4.identity(at),a.a6.mat4.translate(at,at,ut),a.a6.mat4.multiply(nt,at,nt),[nt,ke]}class Ms extends a.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,s){return a.aG(this.requestManager.transformRequest(s,a.R.Model).url).then(p=>{if(!p)return;const _=a.aH(p),x=new a.aI(n,void 0,void 0,_);return x.computeBoundsAndApplyParent(),x}).catch(p=>{if(p&&p.status===404)return null;this.fire(new a.t(new Error(`Could not load model ${n} from ${s}: ${p.message}`)))})}load(n,s){this.models[s]||(this.models[s]={});const p=Object.keys(n);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+p.length;const _=[];for(const x of p)_.push(this.loadModel(x,n[x]));Promise.allSettled(_).then(x=>{for(let w=0;w<x.length;w++){const{status:A,value:k}=x[w];A==="fulfilled"&&k&&(this.models[s][p[w]]={model:k,numReferences:1})}this.numModelsLoading[s]-=p.length,this.fire(new a.x("data",{dataType:"style"}))}).catch(x=>{this.fire(new a.t(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,s){return!!this.getModel(n,s)}getModel(n,s){return this.models[s]||(this.models[s]={}),this.models[s][n]?this.models[s][n].model:void 0}addModel(n,s,p){this.models[p]||(this.models[p]={}),this.hasModel(n,p)&&this.models[p][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(s)},p)}addModels(n,s){this.models[s]||(this.models[s]={});const p={};for(const _ in n)this.models[s][_]={},p[_]=this.requestManager.normalizeModelURL(n[_]);this.load(p,s)}addModelsFromBucket(n,s){this.models[s]||(this.models[s]={});const p={};for(const _ of n)this.hasModel(_,s)?this.models[s][_].numReferences++:p[_]=this.requestManager.normalizeModelURL(_);this.load(p,s)}removeModel(n,s){if(this.models[s]&&this.models[s][n]&&(this.models[s][n].numReferences--,this.models[s][n].numReferences===0)){const p=this.models[s][n].model;delete this.models[s][n],p.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,s){this.models[s]||(this.models[s]={});for(const p in this.models[s])this.models[s][p].model&&this.models[s][p].model.upload(n.context)}}const gm=new a.a0({data:new a.a1(a._.colorTheme.data)}),Zo=(f,n)=>Ue(f,n&&n.filter(s=>s.identifier!=="source.canvas")),Hd=a.ar(Qr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),jc=a.ar(Qr,["setCenter","setZoom","setBearing","setPitch"]),jy={version:8,layers:[],sources:{}},Vy={duration:300,delay:0};class Yo extends a.E{constructor(n,s={}){super(),this.map=n,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=a.l({},Vy),this._buildingIndex=new sm(this),this.crossTileSymbolIndex=new Nd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new pr,this.dispatcher=s.dispatcher?s.dispatcher:new a.cd(a.ce(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Lr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new a.cf(n._requestManager,s.localFontFamily?a.cg.all:s.localIdeographFontFamily?a.cg.ideographs:a.cg.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Ms(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",a.ch());const p=this;this._rtlTextPluginCallback=Yo.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,w)=>{if(a.ci(x),w&&w.every(A=>A))for(const A in p._sourceCaches){const k=p._sourceCaches[A],L=k.getSource().type;L!=="vector"&&L!=="geojson"||k.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getOwnSource(_.sourceId);if(x&&x.vectorLayerIds)for(const w in this._layers){const A=this._layers[w];A.source===x.id&&this._validateLayer(A)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(a.f(n))return n;const s=a.cj(n);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${a.ck(JSON.stringify(n))}`}_diffStyle(n,s,p){this.globalId=this._getGlobalId(n);const _=(x,w)=>{try{w(null,this.setState(x,p))}catch(A){w(A,!1)}};if(typeof n=="string"){const x=this.map._requestManager.normalizeStyleURL(n),w=this.map._requestManager.transformRequest(x,a.R.Style);a.n(w,(A,k)=>{A?this.fire(new a.t(A)):k&&_(k,s)})}else typeof n=="object"&&_(n,s)}loadURL(n,s={}){this.fire(new a.x("dataloading",{dataType:"style"}));const p=typeof s.validate=="boolean"?s.validate:!a.f(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,s.accessToken),this.resolvedImports.add(n);const _=this.importsCache.get(n);if(_)return this._load(_,p);const x=this.map._requestManager.transformRequest(n,a.R.Style);this._request=a.n(x,(w,A)=>{if(this._request=null,w)this.fire(new a.t(w));else if(A)return this.importsCache.set(n,A),this._load(A,p)})}loadJSON(n,s={}){this.fire(new a.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=a.q.frame(()=>{this._request=null,this._load(n,s.validate!==!1)})}loadEmpty(){this.fire(new a.x("dataloading",{dataType:"style"})),this._load(jy,!1)}_loadImports(n,s,p){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const x of n){const w=this._createFragmentStyle(x),A=new Promise(z=>{w.once("style.import.load",z),w.once("error",z)}).then(()=>this.mergeAll());if(_.push(A),this.resolvedImports.has(x.url)){w.loadEmpty();continue}const k=x.data||this.importsCache.get(x.url);k?(w.loadJSON(k,{validate:s}),this._isInternalStyle(k)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:s}):w.loadEmpty();const L={style:w,id:x.id,config:x.config};if(p){const z=this.fragments.findIndex(({id:U})=>U===p);this.fragments=this.fragments.slice(0,z).concat(L).concat(this.fragments.slice(z))}else this.fragments.push(L)}return Promise.allSettled(_)}getImportGlobalIds(n=this,s=new Set){for(const p of n.fragments)p.style.globalId&&s.add(p.style.globalId),this.getImportGlobalIds(p.style,s);return[...s.values()]}_createFragmentStyle(n){const s=this.scope?a.av(n.id,this.scope):n.id;let p;const _=this._initialConfig&&this._initialConfig[s];(n.config||_)&&(p=a.l({},n.config,_));const x=new Yo(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,s){const p=n.schema;if(this._isInternalStyle(n)){const w=a.l({},jy,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(w,s)}if(this.updateConfig(this._config,p),s&&Zo(this,Go(n)))return;this._loaded=!0,this.stylesheet=a.cl(n);const _=()=>{for(const L in n.sources)this.addSource(L,n.sources[L],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const w=lm(this.stylesheet.layers);if(this._order=w.map(L=>L.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new Ge(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ge(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of w){const z=a.cq(L,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize();const U=this.getOwnLayerSourceCache(z),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&z.canCastShadows()&&j&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.x("data",{dataType:"style"}));const k=this.isRootStyle();n.imports?this._loadImports(n.imports,s).then(()=>{this._reloadImports(),this.fire(new a.x(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.x(k?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){const w=this._evaluateColorThemeData(x);this._loadColorTheme(w).then(()=>{_()}).catch(A=>{a.w(`Couldn't load color theme from the stylesheet: ${A}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,s,p,_,x,w,A,k;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(n=z.light),z.stylesheet.lights)for(const U of z.stylesheet.lights)U.type==="ambient"&&z.ambientLight!=null&&(s=z.ambientLight),U.type==="directional"&&z.directionalLight!=null&&(p=z.directionalLight);_=this._prioritizeTerrain(_,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(x=z.fog),z.stylesheet.camera!=null&&(k=z.stylesheet.camera),z.stylesheet.projection!=null&&(w=z.stylesheet.projection),z.stylesheet.transition!=null&&(A=z.stylesheet.transition),L[z.scope]=z._styleColorTheme}}),this.light=n,this.ambientLight=s,this.directionalLight=p,this.fog=x,this._styleColorThemeForScope=L,_===null?delete this.terrain:this.terrain=_,this.camera=k||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=a.l({},Vy,A),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const s=p=>{for(const _ of p.fragments)s(_.style);n(p)};s(this)}_prioritizeTerrain(n,s,p){const _=n&&n.drapeRenderMode===0;return p===null?s&&s.drapeRenderMode===0?s:_?n:null:s!=null&&(!n||_||s&&s.drapeRenderMode===1)?s:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{n=this._prioritizeTerrain(n,s.terrain,s.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(n=s.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},s={},p={};this.forEachFragmentStyle(_=>{for(const x in _._sourceCaches){const w=a.av(x,_.scope);n[w]=_._sourceCaches[x]}for(const x in _._otherSourceCaches){const w=a.av(x,_.scope);s[w]=_._otherSourceCaches[x]}for(const x in _._symbolSourceCaches){const w=a.av(x,_.scope);p[w]=_._symbolSourceCaches[x]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=p}mergeLayers(){const n={},s=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const w of x._order){const A=x._layers[w];if(A.type==="slot"){const k=a.cm(w);if(n[k])continue;n[k]=[]}A.slot&&n[A.slot]?n[A.slot].push(A):s.push(A)}}),this._mergedOrder=[];const _=(x=[])=>{for(const w of x)if(w.type==="slot"){const A=a.cm(w.id);n[A]&&_(n[A]),this._mergedSlots.push(A)}else{const A=a.av(w.id,w.scope);this._mergedOrder.push(A),p[A]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};_(s),this._mergedOrder.sort((x,w)=>{const A=p[x],k=p[w];return A.hasInitialOcclusionOpacityProperties?k.is3D()?1:0:A.is3D()&&k.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=a.l({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(s,p,_){const x=a.l({},p);for(const A of Object.keys(a._.colorTheme))x[A]===void 0&&(x[A]=a._.colorTheme[A].default);const w=new a.$(gm,s,new Map(_));return w.setTransitionOrValue(x,_),w.untransitioned().possiblyEvaluate(new a.a3(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,_)=>{const x="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let w=n;w.startsWith(x)||(w=x+w);const A="mapbox-reserved-lut",k=new Image;k.src=w,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void p();this._styleColorTheme.lutLoading=!1;const{width:L,height:z,data:U}=a.q.getImageData(k);if(z>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==z*z)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new a.r({width:L,height:z},U),pixelRatio:1,sdf:!1,version:0});const j=this.imageManager.getImage(A,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:n},p()):_(new Error("Missing LUT image."))}})}getLut(n){const s=this._styleColorThemeForScope[n];return s?s.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(s,p,_){let x,w,A;const k=a.q.devicePixelRatio>1?"@2x":"";let L=a.n(p.transformRequest(p.normalizeSpriteURL(s,k,".json"),a.R.SpriteJSON),(j,$)=>{L=null,A||(A=j,x=$,U())}),z=a.o(p.transformRequest(p.normalizeSpriteURL(s,k,".png"),a.R.SpriteImage),(j,$)=>{z=null,A||(A=j,w=$,U())});function U(){if(A)_(A);else if(x&&w){const j=a.q.getImageData(w),$={};for(const Y in x){const{width:K,height:J,x:Q,y:fe,sdf:ge,pixelRatio:he,stretchX:xe,stretchY:ve,content:Ie}=x[Y],Ee=new a.r({width:K,height:J});a.r.copy(j,Ee,{x:Q,y:fe},{x:0,y:0},{width:K,height:J},null),$[Y]={data:Ee,pixelRatio:he,sdf:ge,stretchX:xe,stretchY:ve,content:Ie}}_(null,$)}}return{cancel(){L&&(L.cancel(),L=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(s,p)=>{if(this._spriteRequest=null,s)this.fire(new a.t(s));else if(p)for(const _ in p)this.imageManager.addImage(_,this.scope,p[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.x("data",{dataType:"style"}))})}_validateLayer(n){const s=this.getOwnSource(n.source);if(!s)return;const p=n.sourceLayer;p&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.t(new Error(`Source layer "${p}" does not exist on source "${s.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,s)=>{const p=this.fragments[s];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const s in this._sourceCaches){const p=this._sourceCaches[s].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const s=[];for(const p of n){const _=this._layers[p];_&&_.type!=="custom"&&s.push(_.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const s=this.getOwnLayer(n);if(s)return s;this.fire(new a.t(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const s=this.getOwnSource(n);if(s)return s;this.fire(new a.t(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,s){const p=this.map.painter;if(p)for(let _=n.minzoom||0;_<(n.maxzoom||25.5);_++){const x=n.getProgramIds();if(x)for(const w of x){const A=n.getDefaultProgramParams(w,s.zoom,this._styleColorTheme.lut);A&&(p.style=this,this.fog&&(p._fogVisible=!0,A.overrideFog=!0,p.getOrCreateProgram(w,A)),p._fogVisible=!1,A.overrideFog=!1,p.getOrCreateProgram(w,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,p.getOrCreateProgram(w,A)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const s=this.calculateLightsBrightness();n.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const p=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const A in w){const{updatedIds:k,removedIds:L}=w[A];(k||L)&&(this._updateWorkerLayers(A,k,L),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const x={};for(const w in this._mergedSourceCaches){const A=this._mergedSourceCaches[w];x[w]=A.used,A.used=!1,A.tileCoverLift=0}for(const w of this._mergedOrder){const A=this._mergedLayers[w];if(A.recalculate(n,this._availableImages),!A.isHidden(n.zoom)){const k=this.getLayerSourceCache(A);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,n)}):this.precompilePrograms(A,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const w in x){const A=this._mergedSourceCaches[w];x[w]!==A.used&&A.getSource().fire(new a.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new a.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,s,p){const _=this.getFragmentStyle(n);_&&this.dispatcher.broadcast("updateLayers",{layers:s?_._serializeLayers(s):[],scope:n,removedIds:p||[],options:_.options})}setState(n,s){if(this._checkLoaded(),Zo(this,Go(n)))return!1;(n=a.cl(n)).layers=lm(n.layers);const p=function(w,A){if(!w)return[{command:Qr.setStyle,args:[A]}];let k=[];try{if(!a.bh(w.version,A.version))return[{command:Qr.setStyle,args:[A]}];if(a.bh(w.center,A.center)||k.push({command:Qr.setCenter,args:[A.center]}),a.bh(w.zoom,A.zoom)||k.push({command:Qr.setZoom,args:[A.zoom]}),a.bh(w.bearing,A.bearing)||k.push({command:Qr.setBearing,args:[A.bearing]}),a.bh(w.pitch,A.pitch)||k.push({command:Qr.setPitch,args:[A.pitch]}),a.bh(w.sprite,A.sprite)||k.push({command:Qr.setSprite,args:[A.sprite]}),a.bh(w.glyphs,A.glyphs)||k.push({command:Qr.setGlyphs,args:[A.glyphs]}),a.bh(w.imports,A.imports)||function($=[],Y=[],K){Y=Y||[];const J=($=$||[]).map(Bl),Q=Y.map(Bl),fe=$.reduce(Pc,{}),ge=Y.reduce(Pc,{}),he=J.slice();let xe,ve,Ie,Ee;for(xe=0,ve=0;xe<J.length;xe++)Ie=J[xe],ge.hasOwnProperty(Ie)?ve++:(K.push({command:Qr.removeImport,args:[Ie]}),he.splice(he.indexOf(Ie,ve),1));for(xe=0,ve=0;xe<Q.length;xe++)Ie=Q[Q.length-1-xe],he[he.length-1-xe]!==Ie&&(fe.hasOwnProperty(Ie)?(K.push({command:Qr.removeImport,args:[Ie]}),he.splice(he.lastIndexOf(Ie,he.length-ve),1)):ve++,Ee=he[he.length-xe],K.push({command:Qr.addImport,args:[ge[Ie],Ee]}),he.splice(he.length-xe,0,Ie));for(const Pe of Y){const ze=fe[Pe.id];ze&&!a.bh(ze,Pe)&&K.push({command:Qr.updateImport,args:[Pe.id,Pe]})}}(w.imports,A.imports,k),a.bh(w.transition,A.transition)||k.push({command:Qr.setTransition,args:[A.transition]}),a.bh(w.light,A.light)||k.push({command:Qr.setLight,args:[A.light]}),a.bh(w.fog,A.fog)||k.push({command:Qr.setFog,args:[A.fog]}),a.bh(w.projection,A.projection)||k.push({command:Qr.setProjection,args:[A.projection]}),a.bh(w.lights,A.lights)||k.push({command:Qr.setLights,args:[A.lights]}),a.bh(w.camera,A.camera)||k.push({command:Qr.setCamera,args:[A.camera]}),!a.bh(w["color-theme"],A["color-theme"]))return[{command:Qr.setStyle,args:[A]}];const L={},z=[];(function($,Y,K,J){let Q;for(Q in Y=Y||{},$=$||{})$.hasOwnProperty(Q)&&(Y.hasOwnProperty(Q)||un(Q,K,J));for(Q in Y){if(!Y.hasOwnProperty(Q))continue;const fe=Y[Q];$.hasOwnProperty(Q)?a.bh($[Q],fe)||($[Q].type==="geojson"&&fe.type==="geojson"&&ur($,Y,Q)?K.push({command:Qr.setGeoJSONSourceData,args:[Q,fe.data]}):Vb(Q,Y,K,J)):cm(Q,Y,K)}})(w.sources,A.sources,z,L);const U=[];w.layers&&w.layers.forEach($=>{$.source&&L[$.source]?k.push({command:Qr.removeLayer,args:[$.id]}):U.push($)});let j=w.terrain;j&&L[j.source]&&(k.push({command:Qr.setTerrain,args:[void 0]}),j=void 0),k=k.concat(z),a.bh(j,A.terrain)||k.push({command:Qr.setTerrain,args:[A.terrain]}),function($,Y,K){Y=Y||[];const J=($=$||[]).map(Bl),Q=Y.map(Bl),fe=$.reduce(Pc,{}),ge=Y.reduce(Pc,{}),he=J.slice(),xe=Object.create(null);let ve,Ie,Ee,Pe,ze,ke,De;for(ve=0,Ie=0;ve<J.length;ve++)Ee=J[ve],ge.hasOwnProperty(Ee)?Ie++:(K.push({command:Qr.removeLayer,args:[Ee]}),he.splice(he.indexOf(Ee,Ie),1));for(ve=0,Ie=0;ve<Q.length;ve++)Ee=Q[Q.length-1-ve],he[he.length-1-ve]!==Ee&&(fe.hasOwnProperty(Ee)?(K.push({command:Qr.removeLayer,args:[Ee]}),he.splice(he.lastIndexOf(Ee,he.length-Ie),1)):Ie++,ke=he[he.length-ve],K.push({command:Qr.addLayer,args:[ge[Ee],ke]}),he.splice(he.length-ve,0,Ee),xe[Ee]=!0);for(ve=0;ve<Q.length;ve++)if(Ee=Q[ve],Pe=fe[Ee],ze=ge[Ee],!xe[Ee]&&!a.bh(Pe,ze))if(a.bh(Pe.source,ze.source)&&a.bh(Pe["source-layer"],ze["source-layer"])&&a.bh(Pe.type,ze.type)){for(De in sh(Pe.layout,ze.layout,K,Ee,null,Qr.setLayoutProperty),sh(Pe.paint,ze.paint,K,Ee,null,Qr.setPaintProperty),a.bh(Pe.slot,ze.slot)||K.push({command:Qr.setSlot,args:[Ee,ze.slot]}),a.bh(Pe.filter,ze.filter)||K.push({command:Qr.setFilter,args:[Ee,ze.filter]}),a.bh(Pe.minzoom,ze.minzoom)&&a.bh(Pe.maxzoom,ze.maxzoom)||K.push({command:Qr.setLayerZoomRange,args:[Ee,ze.minzoom,ze.maxzoom]}),Pe)Pe.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?sh(Pe[De],ze[De],K,Ee,De.slice(6),Qr.setPaintProperty):a.bh(Pe[De],ze[De])||K.push({command:Qr.setLayerProperty,args:[Ee,De,ze[De]]}));for(De in ze)ze.hasOwnProperty(De)&&!Pe.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?sh(Pe[De],ze[De],K,Ee,De.slice(6),Qr.setPaintProperty):a.bh(Pe[De],ze[De])||K.push({command:Qr.setLayerProperty,args:[Ee,De,ze[De]]}))}else K.push({command:Qr.removeLayer,args:[Ee]}),ke=he[he.lastIndexOf(Ee)+1],K.push({command:Qr.addLayer,args:[ze,ke]})}(U,A.layers,k)}catch(L){console.warn("Unable to compute style diff:",L),k=[{command:Qr.setStyle,args:[A]}]}return k}(this.serialize(),n).filter(w=>!(w.command in jc));if(p.length===0)return!1;const _=p.filter(w=>!(w.command in Hd));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);const x=[];return p.forEach(w=>{x.push(this[w.command].apply(this,w.args))}),s&&Promise.all(x).then(s),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,s){return this.getImage(n)?this.fire(new a.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,s),this._afterImageUpdated(n),this)}updateImage(n,s){this.imageManager.updateImage(n,this.scope,s)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new a.t(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,s,p={}){return this._checkLoaded(),this._validate(Re,`models.${n}`,s,null,p)||(this.modelManager.addModel(n,s,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new a.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,s,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(zl,`sources.${n}`,s,null,p))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const _=Ec(n,s,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const x=w=>{const A=(w?"symbol:":"other:")+_.id,k=a.av(A,this.scope),L=this._sourceCaches[A]=new Do(k,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=L,L.onAdd(this.map)};x(!1),s.type!=="vector"&&s.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const s=this.getOwnSource(n);if(!s)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new a.t(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new a.t(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(n);for(const _ of p){const x=a.cm(_.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(_.id),_.fire(new a.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,s){this._checkLoaded(),this.getOwnSource(n).setData(s),this._changes.setDirty()}getOwnSource(n){const s=this.getOwnSourceCache(n);return s&&s.getSource()}getOwnSources(){const n=[];for(const s in this._otherSourceCaches){const p=this.getOwnSourceCache(s);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const s in n){const p=n[s]._tiles;for(const _ in p){const x=p[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const _ of n){if(this._validate(Sc,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(_),x.updateTransitions(s)}else this.ambientLight=new gn(_,Ir||(Ir=new a.a0({color:new a.a1(a._.properties_light_ambient.color),intensity:new a.a1(a._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(_),x.updateTransitions(s)}else this.directionalLight=new gn(_,fn||(fn=new a.a0({direction:new a.ad(a._.properties_light_directional.direction),color:new a.a1(a._.properties_light_directional.color),intensity:new a.a1(a._.properties_light_directional.intensity),"cast-shadows":new a.a1(a._.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.a1(a._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new a.a3(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,s=this.ambientLight;if(!n||!s)return;const p=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),_=n.properties.get("color").toRenderColor(null).toArray01(),x=n.properties.get("intensity"),w=n.properties.get("direction"),A=1-a.c7(w.x,w.y,w.z)[2]/90,k=p(_)*x*A,L=s.properties.get("color").toRenderColor(null).toArray01(),z=s.properties.get("intensity");return(k+p(L)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(a.cn(n)){const s=a.co(n),p=this.fragments.find(({id:x})=>x===s);if(!p)throw new Error(`Style import not found: ${n}`);const _=a.cm(n);return p.style.getFragmentStyle(_)}{const s=this.fragments.find(({id:p})=>p===n);if(!s)throw new Error(`Style import not found: ${n}`);return s.style}}getConfigProperty(n,s){const p=this.getFragmentStyle(n);if(!p)return null;const _=a.av(s,p.scope),x=p.options.get(_),w=x?x.value||x.default:null;return w?w.serialize():null}setConfigProperty(n,s,p){const _=this.getFragmentStyle(n);if(!_)return;const x=_.stylesheet.schema;if(!x||!x[s])return;const w=a.M(p);if(w.result!=="success")return void Zo(this,w.value);const A=w.value.expression,k=a.av(s,_.scope),L=_.options.get(k);if(!L)return;let z;const{minValue:U,maxValue:j,stepValue:$,type:Y,values:K}=x[s],J=a.M(x[s].default);J.result==="success"&&(z=J.value.expression),z?(this.options.set(k,{...L,value:A,default:z,minValue:U,maxValue:j,stepValue:$,type:Y,values:K}),this.updateConfigDependencies(s)):this.fire(new a.t(new Error(`No schema defined for the config option "${s}" in the "${n}" fragment.`)))}getConfig(n){const s=this.getFragmentStyle(n);if(!s)return null;const p=s.stylesheet.schema;if(!p)return null;const _={};for(const x in p){const w=a.av(x,s.scope),A=s.options.get(w),k=A?A.value||A.default:null;_[x]=k?k.serialize():null}return _}setConfig(n,s){const p=this.getFragmentStyle(n);p&&(p.updateConfig(s,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const s=this.getFragmentStyle(n);return s?s.stylesheet.schema:null}setSchema(n,s){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=s,p.updateConfig(p._config,s),this.updateConfigDependencies())}updateConfig(n,s){if(this._config=n,n||s)if(s)for(const p in s){let _,x;const w=a.M(s[p].default);if(w.result==="success"&&(_=w.value.expression),n&&n[p]!==void 0){const j=a.M(n[p]);j.result==="success"&&(x=j.value.expression)}const{minValue:A,maxValue:k,stepValue:L,type:z,values:U}=s[p];if(_){const j=a.av(p,this.scope);this.options.set(j,{default:_,value:x,minValue:A,maxValue:k,stepValue:L,type:z,values:U})}else this.fire(new a.t(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new a.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const s of this._configDependentLayers){const p=this.getLayer(s);if(p){if(n&&!p.configDependencies.has(n))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){const p=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut&&p!==""||s._styleColorTheme.lut&&p!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(n,s,p={}){this._checkLoaded();const _=n.id;if(this._layers[_])return void this.fire(new a.t(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(n.type==="custom"){if(Zo(this,a.cp(n)))return;x=a.cq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=a.cl(n),n=a.l(n,{source:_})),this._validate(Ke,`layers.${_}`,n,{arrayIndex:-1},p))return;x=a.cq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let w=this._order.length;if(s){const z=this._order.indexOf(s);if(z===-1)return void this.fire(new a.t(new Error(`Layer with id "${s}" does not exist on this map.`)));x.slot===this._layers[s].slot?w=z:a.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const A=this.getOwnLayerSourceCache(x),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&x.canCastShadows()&&k&&(A.castsShadows=!0);const L=this._changes.getRemovedLayer(x);if(L&&x.source&&A&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const z=a.av(x.source,x.scope);L.type!==x.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),A.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(n,s){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===s)return;const _=this._order.indexOf(n);this._order.splice(_,1);let x=this._order.length;if(s){const w=this._order.indexOf(s);if(w===-1)return void this.fire(new a.t(new Error(`Layer with id "${s}" does not exist on this map.`)));p.slot===this._layers[s].slot?x=w:a.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const s=this._checkLayer(n);if(!s)return;s.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const _=this.getOwnLayerSourceCache(s);if(_&&_.castsShadows){let x=!1;for(const w in this._layers)if(this._layers[w].source===s.source&&this._layers[w].canCastShadows()){x=!0;break}_.castsShadows=x}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const s in this._layers)if(this._layers[s].type===n)return!0;return!1}setLayerZoomRange(n,s,p){this._checkLoaded();const _=this._checkLayer(n);_&&(_.minzoom===s&&_.maxzoom===p||(s!=null&&(_.minzoom=s),p!=null&&(_.maxzoom=p),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,s){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==s&&(p.slot=s,this._updateLayer(p))}setFilter(n,s,p={}){this._checkLoaded();const _=this._checkLayer(n);if(_&&!a.bh(_.filter,s))return s==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(ee,`layers.${_.id}.filter`,s,{layerType:_.type},p)||(_.filter=a.cl(s),this._updateLayer(_)))}getFilter(n){const s=this._checkLayer(n);if(s)return a.cl(s.filter)}setLayoutProperty(n,s,p,_={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!a.bh(x.getLayoutProperty(s),p)){if(p!=null&&(!_||_.validate!==!1)&&Zo(x,Se.call(Go,{key:`layers.${n}.layout.${s}`,layerType:x.type,objectKey:s,value:p,styleSpec:a._,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(s,p),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(n,s){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(s)}setPaintProperty(n,s,p,_={}){this._checkLoaded();const x=this._checkLayer(n);if(!x||a.bh(x.getPaintProperty(s),p)||p!=null&&(!_||_.validate!==!1)&&Zo(x,ae.call(Go,{key:`layers.${n}.paint.${s}`,layerType:x.type,objectKey:s,value:p,styleSpec:a._})))return;const w=x.setPaintProperty(s,p);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(n,s){const p=this._checkLayer(n);if(p)return p.getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();const p=n.source,_=n.sourceLayer,x=this._checkSource(p);if(!x)return;const w=x.type;if(w==="geojson"&&_)return void this.fire(new a.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new a.t(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new a.t(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(p);for(const k of A)k.setFeatureState(_,n.id,s)}removeFeatureState(n,s){this._checkLoaded();const p=n.source,_=this._checkSource(p);if(!_)return;const x=_.type,w=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new a.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new a.t(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(p);for(const k of A)k.removeFeatureState(w,n.id,s)}getFeatureState(n){this._checkLoaded();const s=n.source,p=n.sourceLayer,_=this._checkSource(s);if(_){if(_.type!=="vector"||p)return n.id===void 0&&this.fire(new a.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(p,n.id);this.fire(new a.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=a.l({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return a.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),s=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return a.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const s=this.getLayerSourceCache(n),p=a.av(n.source,n.scope),_=this._changes.getUpdatedSourceCaches();n.source&&!_[p]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),s.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const s=A=>this._mergedLayers[A].is3D(),p=this.order,_={},x=[];for(let A=p.length-1;A>=0;A--){const k=p[A];if(s(k)){_[k]=A;for(const L of n){const z=L[k];if(z)for(const U of z)x.push(U)}}}x.sort((A,k)=>k.intersectionZ-A.intersectionZ);const w=[];for(let A=p.length-1;A>=0;A--){const k=p[A];if(s(k))for(let L=x.length-1;L>=0;L--){const z=x[L].feature;if(z.layer&&_[z.layer.id]<A)break;w.push(z),x.pop()}else for(const L of n){const z=L[k];if(z)for(const U of z)w.push(U.feature)}}return w}queryRenderedFeatures(n,s,p){s&&s.filter&&this._validate(ee,"queryRenderedFeatures.filter",s.filter,null,s),s.scope=this.scope,s.availableImages=this._availableImages,s.serializedLayers=this._serializedLayers;const _={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new a.t(new Error("parameters.layers must be an Array."))),[];for(const L of s.layers){const z=this._mergedLayers[L];if(!z)return this.fire(new a.t(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const x=[],w=s.serializedLayers||{},A=s&&s.layers?s.layers.some(L=>{const z=this.getLayer(L);return z&&z.is3D()}):this.has3DLayers(),k=Un.createFromScreenPoints(n,p);for(const L in this._mergedSourceCaches){const z=this._mergedSourceCaches[L].getSource();if(!z||z.scope!==s.scope)continue;const U=this._mergedSourceCaches[L].getSource().id;s.layers&&!_[U]||x.push(im(this._mergedSourceCaches[L],this._mergedLayers,w,k,s,p,A,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(L,z,U,j,$,Y,K){const J={},Q=Y.queryRenderedSymbols(j),fe=[];for(const ge of Object.keys(Q).map(Number))fe.push(K[ge]);fe.sort(Mc);for(const ge of fe){const he=ge.featureIndex.lookupSymbolFeatures(Q[ge.bucketInstanceId],z,ge.bucketIndex,ge.sourceLayerIndex,$.filter,$.layers,$.availableImages,L);for(const xe in he){const ve=J[xe]=J[xe]||[],Ie=he[xe];Ie.sort((Ee,Pe)=>{const ze=ge.featureSortOrder;if(ze){const ke=ze.indexOf(Ee.featureIndex);return ze.indexOf(Pe.featureIndex)-ke}return Pe.featureIndex-Ee.featureIndex});for(const Ee of Ie)ve.push(Ee)}}for(const ge in J)J[ge].forEach(he=>{const xe=he.feature,ve=U(L[ge]);if(!ve)return;const Ie=ve.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=Ie});return J}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),k.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,s){s&&s.filter&&this._validate(ee,"querySourceFeatures.filter",s.filter,null,s);const p=this.getOwnSourceCaches(n);let _=[];for(const x of p)_=_.concat(ih(x,s));return _}addSourceType(n,s,p){return Yo.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(Yo.setSourceType(n,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:s.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,s,p={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const A in n)if(!a.bh(n[A],_[A])){x=!0;break}if(!x)return;const w=this._getTransitionParameters();this.light.setLight(n,s,p),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,s=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const _=n.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const A="terrain-dem-src";this.addSource(A,p.source),p=a.cl(p),p=a.l(p,{source:A})}const x=a.l({},p),w={};if(this.terrain&&_){x.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(w.style=A.serialize())}if(this._validate(rh,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&s!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,s),this.fire(new a.x("data",{dataType:"style"}))}else{const x=this.terrain,w=x.get();for(const A of Object.keys(a._.terrain))!p.hasOwnProperty(A)&&a._.terrain[A].default&&(p[A]=a._.terrain[A].default);for(const A in n)if(!a.bh(n[A],w[A])){x.set(n,this.options),this.stylesheet.terrain=n;const k=this._getTransitionParameters({duration:0});x.updateTransitions(k),this.fire(new a.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const s=this.fog=new cn(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const p=this._getTransitionParameters({duration:0});s.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!a.bh(s.get(),n)){s.set(n,this.options),this.stylesheet.fog=s.get();const p=this._getTransitionParameters({duration:0});s.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}setColorTheme(n){this._checkLoaded();const s=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()};if(this._styleColorTheme.colorTheme=n,!n)return this._styleColorTheme.lut=null,void s();const p=this._evaluateColorThemeData(n);this._loadColorTheme(p).then(()=>{this.fire(new a.x("colorthemeset")),s()}).catch(_=>{a.w(`Couldn't set color theme: ${_}`)})}_getTransitionParameters(n){return{now:a.q.now(),transition:a.l(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],s=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):s.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...s)}_createTerrain(n,s){const p=this.terrain=new st(n,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const s=this._layers[n];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const s=this._layers[n];s.type==="symbol"&&this._updateLayer(s)}}_validate(n,s,p,_,x={}){if(x&&x.validate===!1)return!1;const w=a.l({},this.serialize());return Zo(this,n.call(Go,a.l({key:s,style:w,value:p,styleSpec:a._},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const s=this.getSourceCaches(n);for(const p of s)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const s=this.getSourceCaches(n);for(const p of s)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let s;this.directionalLight&&(s=$d(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(n,void 0,void 0,s)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const s=this._sourceCaches[n];s.resume(),s.reload()}}_updatePlacement(n,s,p,_,x,w,A=!1){let k=!1,L=!1;const z={},U={};for(const j of this._mergedOrder){const $=this._mergedLayers[j];if($.type!=="symbol")continue;const Y=a.av($.source,$.scope);let K=z[Y];if(!K){const Q=this.getLayerSourceCache($);if(!Q)continue;const fe=Q.getRenderableIds(!0).map(ge=>Q.getTileByID(ge));U[Y]=fe.slice(),K=z[Y]=fe.sort((ge,he)=>he.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(he.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer($,K,s.center.lng,s.projection);k=k||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new a.x("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.q.now(),s.zoom))&&(this.pauseablePlacement=new lh(s,this._mergedOrder,A,p,_,x,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.q.now()),L=!0),k&&this.pauseablePlacement.placement.setStale()),L||k){this._buildingIndex.onNewFrame(s.zoom);for(let j=0;j<this._mergedOrder.length;j++){const $=this._mergedLayers[this._mergedOrder[j]];if($.type!=="symbol")continue;const Y=this.isLayerClipped($);this.placement.updateLayerOpacities($,z[a.av($.source,$.scope)],j,Y?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,s){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:x})=>x===n.id)!==-1)return void this.fire(new a.t(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!s)return p.push(n),this._loadImports([n],!0);const _=p.findIndex(({id:x})=>x===s);return _===-1&&this.fire(new a.t(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,_).concat(n).concat(p.slice(_)),this._loadImports([n],!0,s)}updateImport(n,s){this._checkLoaded();const p=this.stylesheet.imports||[],_=this.getImportIndex(n);return _===-1?this:typeof s=="string"?(this.setImportUrl(n,s),this):(s.url&&s.url!==p[_].url&&this.setImportUrl(n,s.url),a.bh(s.config,p[_].config)||this.setImportConfig(n,s.config),a.bh(s.data,p[_].data)||this.setImportData(n,s.data),this)}moveImport(n,s){this._checkLoaded();let p=this.stylesheet.imports||[];const _=this.getImportIndex(n);if(_===-1)return this;const x=this.getImportIndex(s);if(x===-1)return this;const w=p[_],A=this.fragments[_];return p=p.filter(({id:k})=>k!==n),this.fragments=this.fragments.filter(({id:k})=>k!==n),this.stylesheet.imports=p.slice(0,x).concat(w).concat(p.slice(x)),this.fragments=this.fragments.slice(0,x).concat(A).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(n,s){this._checkLoaded();const p=this.stylesheet.imports||[],_=this.getImportIndex(n);if(_===-1)return this;p[_].url=s;const x=this.fragments[_];return x.style=this._createFragmentStyle(p[_]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(s),this}setImportData(n,s){this._checkLoaded();const p=this.getImportIndex(n),_=this.stylesheet.imports||[];return p===-1?this:s?(this.fragments[p].style.setState(s),this._reloadImports(),this):(delete _[p].data,this.setImportUrl(n,_[p].url))}setImportConfig(n,s){this._checkLoaded();const p=this.getImportIndex(n),_=this.stylesheet.imports||[];if(p===-1)return this;s?_[p].config=s:delete _[p].config;const x=this.fragments[p],w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=s,x.style.updateConfig(s,w),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const s=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(s.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const s=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return s===-1&&this.fire(new a.t(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),s}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const s in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[s];p&&n.push(p.getSource())}return n}getSource(n,s){const p=this.getSourceCache(n,s);return p&&p.getSource()}getLayerSource(n){const s=this.getLayerSourceCache(n);return s&&s.getSource()}getSourceCache(n,s){const p=a.av(n,s);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const s=a.av(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[n]&&s.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&s.push(this._mergedSymbolSourceCaches[n]),s}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const s in n){const p=n[s];p==="reload"?this.reloadSource(s):p==="clear"&&this.clearSource(s)}}updateLayers(n){const s=this._changes.getUpdatedPaintProperties();for(const p of s){const _=this.getLayer(p);_&&_.updateTransitions(n)}}getImages(n,s,p){this.imageManager.getImages(s.icons,s.scope,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(s.tileID.key,s.type,s.icons)};_(this._otherSourceCaches[s.source]),_(this._symbolSourceCaches[s.source])}getGlyphs(n,s,p){this.glyphManager.getGlyphs(s.stacks,s.scope,p)}getResource(n,s,p){return a.ct(s,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const s=[];return this._otherSourceCaches[n]&&s.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&s.push(this._symbolSourceCaches[n]),s}_isSourceCacheLoaded(n){const s=this.getOwnSourceCaches(n);return s.length===0?(this.fire(new a.t(new Error(`There is no source with ID '${n}'`))),!1):s.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,s){if(!this._clipLayerPresent&&n.type!=="fill-extrusion")return!1;const p=n.type==="fill-extrusion"&&n.sourceLayer==="building";if(n.is3D()){if(p||s&&s.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Yo.getSourceType=function(f){return Rd[f]},Yo.setSourceType=function(f,n){Rd[f]=n},Yo.registerForPluginStateChange=a.cc;var $y=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,_m=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ym=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,qd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wy=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Gy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hy=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,qy=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,vm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Zy=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,uh=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Zd=[];il($y,Zd),il(ym,Zd),il(_m,Zd);const hh={"_prelude_fog.vertex.glsl":Gy,"_prelude_terrain.vertex.glsl":Wy,"_prelude_shadow.vertex.glsl":Zy,"_prelude_fog.fragment.glsl":Hy,"_prelude_shadow.fragment.glsl":uh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":qy,"_prelude_raster_particle.glsl":vm},Vc={};Yr("",Wy),Yr(Hy,Gy),Yr(uh,Zy),Yr(qy,""),Yr(vm,"");const dh=Yr(_m,ym),Yd=$y;var nl={background:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Yr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Yr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Yr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Yr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Yr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Yr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Yr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Yr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Yr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Yr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Yr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Yr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Yr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Yr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,qd),skyboxGradient:Yr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,qd),skyboxCapture:Yr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Yr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Yr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Yr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Yr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function il(f,n){const s=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of s)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const x of _)n.includes(x)||n.push(x)}}function Yr(f,n){const s=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(L=>{const z=L.split(" ");return z[z.length-1]}),_=[...new Set(_)]);const x={},w=[],A=[];if(f=f.replace(s,(L,z)=>(A.push(z),"")),(n=n.replace(s,(L,z)=>(w.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...Zd];il(f,k),il(n,k);for(const L of[...w,...A])hh[L]||console.error(`Undefined include: ${L}`),Vc[L]||(Vc[L]=[],il(hh[L],Vc[L])),k=[...k,...Vc[L]];return{fragmentSource:f=f.replace(p,(L,z,U,j,$)=>(x[$]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${U} ${j} ${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${$}
    ${U} ${j} ${$} = u_${$};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${U} ${j} ${$};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(p,(L,z,U,j,$)=>{const Y=j==="float"?"vec2":j,K=$.match(/color/)?"color":Y;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${$}
in ${U} ${j} a_${$};
#endif
`:x[$]?z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Y} a_${$};
out ${U} ${j} ${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:z==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${U} ${j} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${K}(a_${$}, u_${$}_t);
#else
    ${U} ${j} ${$} = u_${$};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${U} ${j} a_${$};
    out ${U} ${j} ${$};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${$} = a_${$};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Y} a_${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:z==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${$}0;
in vec4 a_${$}1;
in vec4 a_${$}2;
in vec4 a_${$}3;
#else
uniform ${U} ${j} u_${$};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${Y} a_${$};
#else
uniform ${U} ${j} u_${$};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${U} ${j} ${$} = a_${$};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${j} ${$} = a_${$};
#else
    ${U} ${j} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${j} ${$} = unpack_mix_${K}(a_${$}, u_${$}_t);
#else
    ${U} ${j} ${$} = u_${$};
#endif
`}),staticAttributes:_,usedDefines:k,vertexIncludes:w,fragmentIncludes:A}}class $c{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,s,p,_,x,w,A,k){this.context=n;let L=this.boundPaintVertexBuffers.length!==_.length;for(let U=0;!L&&U<_.length;U++)this.boundPaintVertexBuffers[U]!==_[U]&&(L=!0);let z=this.boundDynamicVertexBuffers.length!==A.length;for(let U=0;!z&&U<A.length;U++)this.boundDynamicVertexBuffers[U]!==A[U]&&(z=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==p||L||z||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(s,p,_,x,w,A,k);else{n.bindVertexArrayOES.set(this.vao);for(const U of A)U&&(U.bind(),k&&U.instanceCount&&U.setVertexAttribDivisor(n.gl,s,k));x&&x.dynamicDraw&&x.bind()}}freshBind(n,s,p,_,x,w,A){const k=n.numAttributes,L=this.context,z=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,s.enableAttributes(z,n),s.bind(),s.setVertexAttribPointers(z,n,x);for(const U of p)U.enableAttributes(z,n),U.bind(),U.setVertexAttribPointers(z,n,x);for(const U of w)U&&(U.enableAttributes(z,n),U.bind(),U.setVertexAttribPointers(z,n,x),A&&U.instanceCount&&U.setVertexAttribDivisor(z,n,A));_&&_.bind(),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function fh(f,n){const s=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new a.a5(0,p/s).toLngLat().lat,new a.a5(0,(p+1)/s).toLngLat().lat]}function Xd(f,n,s,p,_,x,w){const A=f.context,k=A.gl,L=s.hillshadeFBO;if(!L)return;f.prepareDrawTile();const z=f.isTileAffectedByFog(n),U=f.getOrCreateProgram("hillshade",{overrideFog:z});A.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const j=((J,Q,fe,ge)=>{const he=fe.paint.get("hillshade-shadow-color"),xe=fe.paint.get("hillshade-highlight-color"),ve=fe.paint.get("hillshade-accent-color"),Ie=fe.paint.get("hillshade-emissive-strength");let Ee=a.bB(fe.paint.get("hillshade-illumination-direction"));if(fe.paint.get("hillshade-illumination-anchor")==="viewport")Ee-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const ze=J.style.directionalLight.properties.get("direction"),ke=a.c7(ze.x,ze.y,ze.z);Ee=a.bB(ke[1])}const Pe=!J.options.moving;return{u_matrix:ge||J.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:fh(0,Q.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),Ee],u_shadow:he.toRenderColor(fe.lut),u_highlight:xe.toRenderColor(fe.lut),u_emissive_strength:Ie,u_accent:ve.toRenderColor(fe.lut)}})(f,s,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(A,U,n.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Y,tileBoundsSegments:K}=f.getTileBoundsBuffers(s);U.draw(f,k.TRIANGLES,_,x,w,mr.disabled,j,p.id,$,Y,K)}function Kd(f,n,s){if(!n.needsDEMTextureUpload)return;const p=f.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(s.stride);const x=s.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new a.T(p,x,_.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ph(f,n,s){const p=f.context,_=p.gl;if(!n.dem)return;const x=n.dem;if(p.activeTexture.set(_.TEXTURE1),Kd(f,n,x),!n.demTexture)return;n.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=x.dim;p.activeTexture.set(_.TEXTURE0);let A=n.hillshadeFBO;if(!A){const j=new a.T(p,{width:w,height:w,data:null},_.RGBA8);j.bind(_.LINEAR,_.CLAMP_TO_EDGE),A=n.hillshadeFBO=p.createFramebuffer(w,w,!0,"renderbuffer"),A.colorAttachment.set(j.texture)}p.bindFramebuffer.set(A.framebuffer),p.viewport.set([0,0,w,w]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:L,tileBoundsSegments:z}=f.getMercatorTileBoundsBuffers(),U=[];f.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(f,_.TRIANGLES,ar.disabled,Tr.disabled,Ur.unblended,mr.disabled,((j,$)=>{const Y=$.stride,K=a.a6.mat4.create();return a.a6.mat4.ortho(K,0,a.ab,-a.ab,0,0,1),a.a6.mat4.translate(K,K,[0,-a.ab,0]),{u_matrix:K,u_image:1,u_dimension:[Y,Y],u_zoom:j.overscaledZ}})(n.tileID,x),s.id,k,L,z),n.needsHillshadePrepare=!1}class vn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xm extends vn{getDefault(){return a.bz.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Yy extends vn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class bm extends vn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Jd extends vn{getDefault(){return[!0,!0,!0,!0]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class mh extends vn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Xy extends vn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ky extends vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Jy extends vn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Wc extends vn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class Qy extends vn{getDefault(){return[0,1]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class qb extends vn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class Zb extends vn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Yb extends vn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class wm extends vn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Sm extends vn{getDefault(){return a.bz.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Tm extends vn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Em extends vn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class e0 extends vn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class t0 extends vn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Xb=class extends vn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class gh extends vn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class _h extends vn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class r0 extends vn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Xo extends vn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Mm extends vn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Qd extends vn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ef extends vn{getDefault(){return null}set(n){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Cm extends vn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Im extends vn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class tf extends vn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Pm extends vn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class yh extends vn{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class rf extends yh{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Am extends yh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class n0 extends yh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Gc extends Am{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Kb=(f,n,s)=>({u_matrix:f,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:s}),i0=(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:s,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:A,u_frustum_br:k,u_frustum_bl:L,u_globe_pos:z,u_globe_radius:U,u_viewport:j,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:Y});function o0(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const Hc=new class{constructor(){this.operations={}}newMorphing(f,n,s,p,_){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==s.tileID.key&&(x.queued=s)}else this.operations[f]={startTime:p,phase:0,duration:_,from:n,to:s,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const s=this.operations[n];for(s.phase=(f-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},a0={0:null,1:"TERRAIN_VERTEX_MORPHING"};function s0(f,n,s){if(n===0)return 0;const p=n<1&&s===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function Dm(f,n){const s=1<<f.z;return!n&&(f.x===0||f.x===s-1)||f.y===0||f.y===s-1}const vh=f=>({u_matrix:f});function nf(f,n,s,p,_){if(_>0){const x=a.q.now(),w=(x-f.timeAdded)/_,A=n?(x-n.timeAdded)/_:-1,k=s.getSource(),L=p.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-L)>Math.abs(f.tileID.overscaledZ-L),U=z&&f.refreshedUponExpiration?1:a.ap(z?w:1-A,0,1);return f.refreshedUponExpiration&&w>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class qc extends Do{constructor(n){const s={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new a.cd(a.ce(),null),_=Ec("mock-dem",s,p,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,s){n.state="loaded",s(null)}}class l0 extends Do{constructor(n){const s=Ec("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new a.cd(a.ce(),null),n.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,s,p){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){const A=new Qa(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);A.state="loaded",this._tiles[w.key]=A}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const s=this.proxyCachedFBO[n];if(s!==void 0){const p=Object.values(s);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rm extends a.aA{constructor(n,s,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=s,this.projMatrix=p}}class km extends a.cE{constructor(n,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(k){const L=new a.a_,z=new a.aO,U=131;L.reserve(17161),z.reserve(33800);const j=a.ab/128,$=a.ab+j/2,Y=$+j;for(let J=-j;J<Y;J+=j)for(let Q=-j;Q<Y;Q+=j){const fe=Q<0||Q>$||J<0||J>$?24575:0,ge=a.ap(Math.round(Q),0,a.ab),he=a.ap(Math.round(J),0,a.ab);L.emplaceBack(ge+fe,he)}const K=(J,Q)=>{const fe=Q*U+J;z.emplaceBack(fe+1,fe,fe+U),z.emplaceBack(fe+U,fe+U+1,fe+1)};for(let J=1;J<129;J++)for(let Q=1;Q<129;Q++)K(Q,J);return[0,129].forEach(J=>{for(let Q=0;Q<130;Q++)K(Q,J),K(J,Q)}),[L,z,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(p,a.b0.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=a.b1.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=a.b1.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new l0(s.map),this.orthoMatrix=a.a6.mat4.create(),a.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.ab,0,a.ab,0,1);const A=w.gl;this._overlapStencilMode=new Tr({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qc(s.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,s,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const _=n.terrain.properties,x=n.terrain.drapeRenderMode===0,w=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.q.now();const A=n.terrain&&n.terrain.scope,k=_.get("source"),L=x?this._mockSourceCache:n.getSourceCache(k,A);if(!L)return void a.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=L,this._exaggeration=w?this.calculateExaggeration(s):_.get("exaggeration"),!s.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(s,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),s.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(n){const s=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const _=s!=null?p-s:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const x=n.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let A=x-this._previousZoom;const k=this._previousUpdateTimestamp;let L=x;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(x-L)>.5&&(A=.5*(x-L+A)),A*_<0&&(L+=A)),this._evaluationZoom=L;const z=w.getExaggeration(L),U=z===w.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(z-this._exaggeration)<.01)return z;let j=Math.min(.1,.00375*(this._updateTimestamp-k));return(U||z<.1||Math.abs(A)<1e-4)&&(j=Math.min(.2,4*j)),a.aa(this._exaggeration,z,j)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(a.a5.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=s.getIds().map(k=>{const L=s.getTileByID(k).tileID;return L.projMatrix=p.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const z=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new a.P(z.x,z.y);k.sort((j,$)=>{if($.overscaledZ-j.overscaledZ)return $.overscaledZ-j.overscaledZ;const Y=new a.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),K=new a.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),J=U.mult(1<<j.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Y)-J.distSqr(K)})})(_,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const k in w){const L=w[k];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,n[k],x),L.usedForTerrain))continue;const z=n[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[s.id]=_.map(k=>new Rm(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const z=L.tileID.key;z in A||(this._visibleDemTiles.push(L),A[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(s=>{if(this.terrainTileForTile[s.key])return;const p=this._findTileCoveringTileID(s,this.sourceCache);p&&(this.terrainTileForTile[s.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,s=n.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(s.TEXTURE1),Kd(this.painter,_,x))}}_prepareDemTileUniforms(n,s,p,_){if(!s||s.demTexture==null)return!1;const x=n.tileID.canonical,w=Math.pow(2,s.tileID.canonical.z-x.z),A=_||"";return p[`u_dem_tl${A}`]=[x.x*w%1,x.y*w%1],p[`u_dem_scale${A}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const s=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&n++,p+x},0);return n?s/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,s=n.gl;n.activeTexture.set(s.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new a.cF({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new a.T(n,_,s.R32F,{premultiply:!1}),x}setupElevationDraw(n,s,p){const _=this.painter.context,x=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let A=null,k=null,L=1;if(p&&p.morphing&&this._useVertexMorphing){const $=p.morphing.srcDemTile,Y=p.morphing.dstDemTile;L=p.morphing.phase,$&&Y&&(this._prepareDemTileUniforms(n,$,w,"_prev")&&(k=$),this._prepareDemTileUniforms(n,Y,w)&&(A=Y))}const z=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let U=null;var j;if(this.enabled?k&&A?(U=A.demTexture,_.activeTexture.set(x.TEXTURE4),k.demTexture.bind(z(k),x.CLAMP_TO_EDGE),w.u_dem_lerp=L):(A=this.terrainTileForTile[n.tileID.key],U=this._prepareDemTileUniforms(n,A,w)?A.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,_.activeTexture.set(x.TEXTURE2),U&&(w.u_dem_size=(j=U).size[0]===1?1:j.size[0]-2,U.bind(z(A),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,s,w),p&&p.useMeterToDem&&A){const $=(1<<A.tileID.canonical.z)*a.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=$}if(p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),s.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);s.setGlobeUniformValues(_,$)}}globeUniformValues(n,s,p){const _=n.projection;return{u_tile_tl_up:_.upVector(s,0,0),u_tile_tr_up:_.upVector(s,a.ab,0),u_tile_br_up:_.upVector(s,a.ab,a.ab),u_tile_bl_up:_.upVector(s,0,a.ab),u_tile_up_scale:p?a.cG(1):_.upVectorScale(s,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const s=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,w,A,k){if(_.transform.projection.name==="globe")(function(L,z,U,j,$){const Y=L.context,K=Y.gl;let J,Q;const fe=L.transform,ge=a.cx(L,Y,fe),he=($e,nt)=>{if(Q===nt)return;const pt=[a0[nt],"PROJECTION_GLOBE_VIEW"];ge&&pt.push("CUSTOM_ANTIALIASING");const rt=L.isTileAffectedByFog($e);J=L.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:rt}),Q=nt},xe=L.colorModeForRenderPass(),ve=new ar(K.LEQUAL,ar.ReadWrite,L.depthRangeFor3D);Hc.update($);const Ie=a.cy(fe),Ee=[a.am(fe.center.lng),a.at(fe.center.lat)],Pe=L.globeSharedBuffers,ze=[fe.width*a.q.devicePixelRatio,fe.height*a.q.devicePixelRatio],ke=Float32Array.from(fe.globeMatrix),De={useDenormalizedUpVectorScale:!0};{const $e=L.transform,nt=s0($e.zoom,z.exaggeration(),z.sourceCache._source.tileSize);Q=-1;const pt=K.TRIANGLES;for(const rt of j){const xt=U.getTile(rt),We=Tr.disabled,ut=z.prevTerrainTileForTile[rt.key],at=z.terrainTileForTile[rt.key];o0(ut,at)&&Hc.newMorphing(rt.key,ut,at,$,250),Y.activeTexture.set(K.TEXTURE0),xt.texture&&xt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const wt=Hc.getMorphValuesForProxy(rt.key),Et=wt?1:0;wt&&a.C(De,{morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:a.cw(wt.phase)}});const ft=a.cz(rt.canonical),_t=a.cA(ft.getCenter().lat),ir=a.cB(rt.canonical,ft,_t,$e.worldSize/$e._pixelsPerMercatorPixel),kt=a.b5(a.cC(rt.canonical)),Vt=i0($e.expandedFarZProjMatrix,ke,Ie,kt,a.a9($e.zoom),Ee,$e.frustumCorners.TL,$e.frustumCorners.TR,$e.frustumCorners.BR,$e.frustumCorners.BL,$e.globeCenterInViewSpace,$e.globeRadius,ze,nt,$e._farZ,ir);if(he(rt,Et),J&&(z.setupElevationDraw(xt,J,De),L.uploadCommonUniforms(Y,J,rt.toUnwrapped()),Pe)){const[dr,Jt,lr]=Pe.getGridBuffers(_t,nt!==0);J.draw(L,pt,ve,We,xe,mr.backCCW,Vt,"globe_raster",dr,Jt,lr)}}}if(Pe&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const $e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&$e.push("CUSTOM_ANTIALIASING"),J=L.getOrCreateProgram("globeRaster",{defines:$e});for(const nt of j){const{x:pt,y:rt,z:xt}=nt.canonical,We=rt===0,ut=rt===(1<<xt)-1,[at,wt,Et,ft]=Pe.getPoleBuffers(xt,!1);if(ft&&(We||ut)){const _t=U.getTile(nt);Y.activeTexture.set(K.TEXTURE0),_t.texture&&_t.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let ir=a.cD(xt,pt,fe);const kt=a.b5(a.cC(nt.canonical)),Vt=(dr,Jt)=>dr.draw(L,K.TRIANGLES,ve,Tr.disabled,xe,mr.disabled,i0(fe.expandedFarZProjMatrix,ir,ir,kt,0,Ee,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,ze,0,fe._farZ),"globe_pole_raster",Jt,Et,ft);z.setupElevationDraw(_t,J,De),L.uploadCommonUniforms(Y,J,nt.toUnwrapped()),We&&L.renderDefaultNorthPole&&Vt(J,at),ut&&L.renderDefaultSouthPole&&(ir=a.a6.mat4.scale(a.a6.mat4.create(),ir,[1,-1,1]),Vt(J,wt))}}}})(_,x,w,A,k);else{const L=_.context,z=L.gl;let U,j;const $=_.shadowRenderer,Y=Es(_,_.longestCutoffRange),K=xe=>{if(j===xe)return;const ve=[];ve.push(a0[xe]),Y.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),U=_.getOrCreateProgram("terrainRaster",{defines:ve}),j=xe},J=_.colorModeForRenderPass(),Q=new ar(z.LEQUAL,ar.ReadWrite,_.depthRangeFor3D);Hc.update(k);const fe=_.transform,ge=s0(fe.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let he=[0,0,0];if($){const xe=_.style.directionalLight,ve=_.style.ambientLight;xe&&ve&&(he=Wd(_.style,xe,ve))}{j=-1;const xe=z.TRIANGLES,[ve,Ie]=[x.gridIndexBuffer,x.gridSegments];for(const Ee of A){const Pe=w.getTile(Ee),ze=Tr.disabled,ke=x.prevTerrainTileForTile[Ee.key],De=x.terrainTileForTile[Ee.key];o0(ke,De)&&Hc.newMorphing(Ee.key,ke,De,k,250),L.activeTexture.set(z.TEXTURE0),Pe.texture&&Pe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const $e=Hc.getMorphValuesForProxy(Ee.key),nt=$e?1:0;let pt;$e&&(pt={morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:a.cw($e.phase)}});const rt=Kb(Ee.projMatrix,Dm(Ee.canonical,fe.renderWorldCopies)?ge/10:ge,he);if(K(nt),!U)continue;x.setupElevationDraw(Pe,U,pt);const xt=Ee.toUnwrapped();$&&$.setupShadows(xt,U),_.uploadCommonUniforms(L,U,xt,null,Y),U.draw(_,xe,Q,ze,J,mr.backCCW,rt,"terrain_raster",x.gridBuffer,ve,Ie)}}}}(s,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const s=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),A=s.style.order,k=[];let L=0;for(const z of x){const U=_.getTileByID(z.proxyTileKey),j=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][n]:void 0,$=j!==void 0?_.renderCache[j]:this.pool[L++],Y=j!==void 0;if(U.texture=$.tex,Y&&!$.dirty){k.push(U.tileID);continue}let K;p.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(p.clear({color:a.bz.transparent,stencil:0}),$.dirty=!1);for(let J=w.start;J<=w.end;++J){const Q=s.style._mergedLayers[A[J]];if(Q.isHidden(s.transform.zoom))continue;const fe=s.style.getLayerSourceCache(Q),ge=fe?this.proxyToSource[z.key][fe.id]:[z];if(!ge)continue;const he=ge;p.viewport.set([0,0,$.fb.width,$.fb.height]),K!==(fe?fe.id:null)&&(this._setupStencil($,ge,Q,fe),K=fe?fe.id:null),s.renderLayer(s,fe,Q,he)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Q=s.style._mergedLayers[A[J]];if(Q.isHidden(s.transform.zoom))continue;const fe=s.style.getLayerSourceCache(Q),ge=fe?this.proxyToSource[z.key][fe.id]:[z];if(!ge)continue;const he=ge;p.viewport.set([0,0,$.fb.width,$.fb.height]),K!==(fe?fe.id:null)&&(this._setupStencil($,ge,Q,fe),K=fe?fe.id:null),s.renderLayer(s,fe,Q,he)}this.renderedToTile?($.dirty=!0,k.push(U.tileID)):Y||--L,L===5&&(L=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,s.width,s.height]),w.end+1}postRender(){}isLayerOrderingCorrect(n){const s=n.order.length;let p=-1,_=s;for(let x=0;x<s;++x)this._style.isLayerDraped(n._mergedLayers[n.order[x]])?p=Math.max(p,x):_=Math.min(_,x);return _>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{n=Math.min(n,s.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,s,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const w=x.tileID,A=1<<w.overscaledZ,{x:k,y:L}=w.canonical,z=k/A,U=(k+1)/A,j=L/A,$=(L+1)/A;return{minx:z,miny:j,maxx:U,maxy:$,t:x.dem.tree.raycastRoot(z,j,U,$,n,s,p),tile:x}});_.sort((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,s,p);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,s=n.gl,p=this.drapeBufferSize;n.activeTexture.set(s.TEXTURE0);const _=new a.T(n,{width:p[0],height:p[1],data:null},s.RGBA8);_.bind(s.LINEAR,s.CLAMP_TO_EDGE);const x=n.createFramebuffer(p[0],p[1],!0,null);return x.colorAttachment.set(_.texture),x.depthAttachment=new Gc(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const s=this._style._mergedLayers[n],p=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!p&&s.shouldRedrape():!p&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof Dd){n=!0;break}if(!n)return;const s={};for(let p=0;p<this._style.order.length;++p){const _=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(_);if(x&&!s[x.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof a.a4){s[x.id]=!0;for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][x.id];if(A)for(const k of A)this._clearRenderCacheForTile(x.id,k)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof nh){n=!0;break}if(!n)return;const s={};for(let p=0;p<this._style.order.length;++p){const _=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(_);if(!x||s[x.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const k=this.proxyToSource[A.key][x.id];if(k)for(const L of k){const z=nf(x.getTile(L),x.findLoadedParent(L,0),x,this.painter.transform,w);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(x.id,L)}}}}_setupDrapedRenderBatches(){const n=this._style.order,s=n.length;if(s===0)return;const p=[];this._pendingGroundEffectLayers=[];let _,x=0,w=this._style._mergedLayers[n[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<s;)w=this._style._mergedLayers[n[x]];for(;x<s;++x){const A=this._style._mergedLayers[n[x]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?_===void 0&&(_=x):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),_!==void 0&&(p.push({start:_,end:x-1}),_=void 0)))}if(_!==void 0&&p.push({start:_,end:x-1}),p.length!==0){const A=p[p.length-1];this._pendingGroundEffectLayers.every(k=>k>A.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const w=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let A=0;A<w.length;++A){const k=Object.values(w[A]);s.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const A=p[w];if(s.getTileByID(A.key),s.proxyCachedFBO[A.key]!==void 0){const k=n[A.key],L=this.proxyToSource[A.key];let z=0;for(const U in L){const j=L[U],$=k[U];if(!$||$.length!==j.length||j.some((Y,K)=>Y!==$[K]||_[U]&&_[U].hasOwnProperty(Y.key))){z=-1;break}++z}for(const U in s.proxyCachedFBO[A.key])s.renderCache[s.proxyCachedFBO[A.key][U]].dirty=z<0||z!==Object.values(k).length}}const x=[...this._drapedRenderBatches];x.sort((w,A)=>A.end-A.start-(w.end-w.start));for(const w of x)for(const A of p){if(s.proxyCachedFBO[A.key])continue;let k=s.renderCachePool.pop();k===void 0&&s.renderCache.length<50&&(k=s.renderCache.length,s.renderCache.push(this._createFBO())),k!==void 0&&(s.proxyCachedFBO[A.key]={},s.proxyCachedFBO[A.key][w.start]=k,s.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(n,s,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,w=x.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=s.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Tr.disabled}_renderTileClippingMasks(n,s){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(Ur.disabled),_.setDepthMode(ar.disabled);const w=p.getOrCreateProgram("clippingMask");for(const A of n){const k=p._tileClippingMaskIDs[A.key]=--s;w.draw(p,x.TRIANGLES,ar.disabled,new Tr({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),Ur.disabled,mr.disabled,vh(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const s=this.painter.transform;if(n.x<0||n.x>s.width||n.y<0||n.y>s.height)return null;const p=[n.x,n.y,1,1];a.a6.vec4.transformMat4(p,p,s.pixelMatrixInverse),a.a6.vec4.scale(p,p,1/p[3]),p[0]/=s.worldSize,p[1]/=s.worldSize;const _=s._camera.position,x=a.bD(1,s.center.lat),w=[_[0],_[1],_[2]/x,0],A=a.a6.vec3.subtract([],p.slice(0,3),w);a.a6.vec3.normalize(A,A);const k=this.raycast(w,A,this._exaggeration);return k!==null&&k?(a.a6.vec3.scaleAndAdd(w,w,A,k),w[3]=w[2],w[2]*=x,w):null}_setupProxiedCoordsForOrtho(n,s,p){if(n.getSource()instanceof a.aD)return this._setupProxiedCoordsForImageSource(n,s,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let k=0;k<x.length;k++){const L=x[k],z=this._findTileCoveringTileID(L,n);if(z){const U=this._createProxiedId(L,z,p[L.key]&&p[L.key][n.id]);_.push(U),this.proxyToSource[L.key][n.id]=[U]}}let w=!1;const A=new Set;for(let k=0;k<s.length;k++){const L=n.getTile(s[k]);if(!L||!L.hasData())continue;const z=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[z.tileID.key][n.id],j=this._createProxiedId(z.tileID,L,p[z.tileID.key]&&p[z.tileID.key][n.id]);U?U.splice(U.length-1,0,j):this.proxyToSource[z.tileID.key][n.id]=[j];const $=this.proxyToSource[z.tileID.key][n.id];A.has($)||A.add($),_.push(j),w=!0}}if(this._sourceTilesOverlap[n.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const k of A)k.sort((L,z)=>z.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(n,s,p){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],x=this.proxyCoords,w=n.getSource(),A=w.tileID;if(!A)return;const k=new a.P(A.x,A.y)._div(1<<A.z),L=w.coordinates.map(a.a5.fromLngLat).reduce((U,j)=>(U.min.x=Math.min(U.min.x,j.x-k.x),U.min.y=Math.min(U.min.y,j.y-k.y),U.max.x=Math.max(U.max.x,j.x-k.x),U.max.y=Math.max(U.max.y,j.y-k.y),U),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(U,j)=>{const $=U.wrap+U.canonical.x/(1<<U.canonical.z),Y=U.canonical.y/(1<<U.canonical.z),K=a.ab/(1<<U.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),Q=j.canonical.y/(1<<j.canonical.z);return $+K<J+L.min.x||$>J+L.max.x||Y+K<Q+L.min.y||Y>Q+L.max.y};for(let U=0;U<x.length;U++){const j=x[U];for(let $=0;$<s.length;$++){const Y=n.getTile(s[$]);if(!Y||!Y.hasData()||z(j,Y.tileID))continue;const K=this._createProxiedId(j,Y,p[j.key]&&p[j.key][n.id]),J=this.proxyToSource[j.key][n.id];J?J.push(K):this.proxyToSource[j.key][n.id]=[K],_.push(K)}}}_createProxiedId(n,s,p){let _=this.orthoMatrix;if(p){const x=p.find(w=>w.key===s.tileID.key);if(x)return x}if(s.tileID.key!==n.key){const x=n.canonical.z-s.tileID.canonical.z;let w,A,k;_=a.a6.mat4.create();const L=s.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(w=a.ab>>x,A=w*((s.tileID.canonical.x<<x)-n.canonical.x+L),k=w*((s.tileID.canonical.y<<x)-n.canonical.y)):(w=a.ab<<-x,A=a.ab*(s.tileID.canonical.x-(n.canonical.x+L<<-x)),k=a.ab*(s.tileID.canonical.y-(n.canonical.y<<-x))),a.a6.mat4.ortho(_,0,w,0,w,0,1),a.a6.mat4.translate(_,_,[A,k,0])}return new Rm(s.tileID,n.key,_)}_findTileCoveringTileID(n,s){let p=s.getTile(n);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[s.id],x=_[n.key];if(p=x?s.getTileByID(x):null,p&&p.hasData()||x===null)return p;let w=p?p.tileID:n,A=w.overscaledZ;const k=s.getSource().minzoom,L=[];if(!x){const U=s.getSource().maxzoom;if(n.canonical.z>=U){const j=n.canonical.z-U;s.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,s.transform.tileZoom),w=new a.aA(A,n.wrap,U,n.canonical.x>>j,n.canonical.y>>j)):j!==0&&(A=U,w=new a.aA(A,n.wrap,U,n.canonical.x>>j,n.canonical.y>>j))}w.key!==n.key&&(L.push(w.key),p=s.getTile(w))}const z=U=>{L.forEach(j=>{_[j]=U}),L.length=0};for(A-=1;A>=k&&(!p||!p.hasData());A--){p&&z(p.tileID.key);const U=w.calculateScaledKey(A);if(p=s.getTileByID(U),p&&p.hasData())break;const j=_[U];if(j===null)break;j===void 0?L.push(U):p=s.getTileByID(j)}return z(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,s){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[s.key]=!0}}function Om(f,n,s){const p=function(A,k,L){const z=a.a6.vec3.dot(k,A),U=a.a6.vec3.dot(L,[.2126,.7152,.0722]),j=(Y,K,J)=>(1-J)*Y+J*K,$=j(1-.3*Math.min(U,1),1,Math.min(z+1,1));return j(.92,1,Math.asin(a.ap(k[2],-1,1))/Math.PI+.5)*$}(f,[0,0,1],n),_=[0,0,0];a.a6.vec3.scale(_,s.slice(0,3),p);const x=[0,0,0];a.a6.vec3.scale(x,n.slice(0,3),f[2]);const w=[0,0,0];return a.a6.vec3.add(w,_,x),a.cb(w)}const $l=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],c0=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class ol{static cacheKey(n,s,p,_){let x=`${s}${_?_.cacheKey:""}`;for(const w of p)n.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(n,s,p,_,x,w){const A=n.gl;this.program=A.createProgram(),this.configuration=_,this.name=s,this.fixedDefines=[...w];const k=_?_.getBinderAttributes():[],L=(p.staticAttributes||[]).concat(k);let z=_?_.defines():[];z=z.concat(w.map(J=>`#define ${J}`));const U=`#version 300 es
`;let j=U+z.concat("precision mediump float;",Yd,dh.fragmentSource).join(`
`);for(const J of p.fragmentIncludes)j+=`
${hh[J]}`;j+=`
${p.fragmentSource}`;let $=U+z.concat("precision highp float;",Yd,dh.vertexSource).join(`
`);for(const J of p.vertexIncludes)$+=`
${hh[J]}`;$+=`
${p.vertexSource}`;const Y=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(Y,j),A.compileShader(Y),A.attachShader(this.program,Y);const K=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(K,$),A.compileShader(K),A.attachShader(this.program,K),this.attributes={},this.numAttributes=L.length;for(let J=0;J<this.numAttributes;J++)if(L[J]){const Q=L[J].startsWith("a_")?L[J]:`a_${L[J]}`;A.bindAttribLocation(this.program,J,Q),this.attributes[Q]=J}A.linkProgram(this.program),A.deleteShader(K),A.deleteShader(Y),this.fixedUniforms=x(n),this.binderUniforms=_?_.getUniforms(n):[],(w.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new a.bJ(J),u_dem_prev:new a.bJ(J),u_dem_tl:new a.bG(J),u_dem_scale:new a.bI(J),u_dem_tl_prev:new a.bG(J),u_dem_scale_prev:new a.bI(J),u_dem_size:new a.bI(J),u_dem_lerp:new a.bI(J),u_exaggeration:new a.bI(J),u_depth:new a.bJ(J),u_depth_size_inv:new a.bG(J),u_depth_range_unpack:new a.bG(J),u_occluder_half_size:new a.bI(J),u_occlusion_depth_offset:new a.bI(J),u_meter_to_dem:new a.bI(J),u_label_plane_matrix_inv:new a.bF(J)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new a.bH(J),u_tile_tr_up:new a.bH(J),u_tile_br_up:new a.bH(J),u_tile_bl_up:new a.bH(J),u_tile_up_scale:new a.bI(J)}))(n)),w.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new a.bF(J),u_fog_range:new a.bG(J),u_fog_color:new a.c6(J),u_fog_horizon_blend:new a.bI(J),u_fog_vertical_limit:new a.bG(J),u_fog_temporal_offset:new a.bI(J),u_frustum_tl:new a.bH(J),u_frustum_tr:new a.bH(J),u_frustum_br:new a.bH(J),u_frustum_bl:new a.bH(J),u_globe_pos:new a.bH(J),u_globe_radius:new a.bI(J),u_globe_transition:new a.bI(J),u_is_globe:new a.bJ(J),u_viewport:new a.bG(J)}))(n)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new a.c6(J)}))(n)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new a.bH(J),u_lighting_directional_dir:new a.bH(J),u_lighting_directional_color:new a.bH(J),u_ground_radiance:new a.bH(J)}))(n)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new a.bF(J),u_light_matrix_1:new a.bF(J),u_fade_range:new a.bG(J),u_shadow_normal_offset:new a.bH(J),u_shadow_intensity:new a.bI(J),u_shadow_texel_size:new a.bI(J),u_shadow_map_resolution:new a.bI(J),u_shadow_direction:new a.bH(J),u_shadow_bias:new a.bH(J),u_shadowmap_0:new a.bJ(J),u_shadowmap_1:new a.bJ(J)}))(n))}}setTerrainUniformValues(n,s){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in s)p[_]&&p[_].set(this.program,_,s[_])}}setGlobeUniformValues(n,s){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in s)p[_]&&p[_].set(this.program,_,s[_])}}setFogUniformValues(n,s){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in s)p[_].set(this.program,_,s[_])}}setCutoffUniformValues(n,s){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in s)p[_].set(this.program,_,s[_])}}setLightsUniformValues(n,s){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in s)p[_].set(this.program,_,s[_])}}setShadowUniformValues(n,s){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const _ in s)p[_].set(this.program,_,s[_])}_drawDebugWireframe(n,s,p,_,x,w,A,k,L,z){const U=n.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const j=n.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||n._terrain&&n._terrain.renderingToTexture||!$l.includes(this.name))||!(!U.layers3D||!c0.includes(this.name))))return;const $=j.gl,Y=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,x,j);if(!Y)return;const K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");const J=n.getOrCreateProgram(this.name,{config:this.configuration,defines:K});j.program.set(J.program);const Q=(he,xe,ve)=>{if(xe[he]&&ve[he])for(const Ie in xe[he])ve[he][Ie]&&ve[he][Ie].set(ve.program,Ie,xe[he][Ie].current)};L&&L.setUniforms(J.program,j,J.binderUniforms,A,{zoom:k}),Q("fixedUniforms",this,J),Q("terrainUniforms",this,J),Q("globeUniforms",this,J),Q("fogUniforms",this,J),Q("lightsUniforms",this,J),Q("shadowUniforms",this,J),Y.bind(),j.setColorMode(new Ur([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],a.bz.transparent,[!0,!0,!0,!1])),j.setDepthMode(new ar(s.func===$.LESS?$.LEQUAL:s.func,ar.ReadOnly,s.range)),j.setStencilMode(Tr.disabled);const fe=3*w.primitiveLength*2,ge=3*w.primitiveOffset*2*2;z&&z>1?$.drawElementsInstanced($.LINES,fe,$.UNSIGNED_SHORT,ge,z):$.drawElements($.LINES,fe,$.UNSIGNED_SHORT,ge),x.bind(),j.program.set(this.program),j.setDepthMode(s),j.setStencilMode(p),j.setColorMode(_)}draw(n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J){const Q=n.context,fe=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(p),Q.setStencilMode(_),Q.setColorMode(x),Q.setCullFace(w);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(this.program,xe,A[xe]);Y&&Y.setUniforms(this.program,Q,this.binderUniforms,j,{zoom:$});const ge={[fe.POINTS]:1,[fe.LINES]:2,[fe.TRIANGLES]:3,[fe.LINE_STRIP]:1}[s],he=J&&J>0?1:void 0;for(const xe of U.get()){const ve=xe.vaos||(xe.vaos={});(ve[k]||(ve[k]=new $c)).bind(Q,this,L,Y?Y.getPaintVertexBuffers():[],z,xe.vertexOffset,K||[],he),J&&J>1?fe.drawElementsInstanced(s,xe.primitiveLength*ge,fe.UNSIGNED_SHORT,xe.primitiveOffset*ge*2,J):z?fe.drawElements(s,xe.primitiveLength*ge,fe.UNSIGNED_SHORT,xe.primitiveOffset*ge*2):fe.drawArrays(s,xe.vertexOffset,xe.vertexLength),s===fe.TRIANGLES&&z&&this._drawDebugWireframe(n,p,_,x,z,xe,j,$,Y,J)}}}function Lm(f,n){const s=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,f.transform.tileZoom)/s,_=p*(n.tileID.canonical.x+n.tileID.wrap*s),x=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ak(n,1,f.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const of=a.a6.mat4.create(),zm=(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K)=>{const J=n.style.light,Q=J.properties.get("position"),fe=[Q.x,Q.y,Q.z],ge=a.a6.mat3.create();J.properties.get("anchor")==="viewport"&&(a.a6.mat3.fromRotation(ge,-n.transform.angle),a.a6.vec3.transformMat3(fe,fe,ge));const he=J.properties.get("color"),xe=n.transform,ve={u_matrix:f,u_lightpos:fe,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+s,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:of,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:x,u_width_scale:w,u_flood_light_color:j,u_vertical_scale:$,u_flood_light_intensity:Y,u_ground_shadow_factor:K};return xe.projection.name==="globe"&&(ve.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],ve.u_zoom_transition=L,ve.u_inv_rot_matrix=U,ve.u_merc_center=z,ve.u_up_dir=xe.projection.upVector(new a.bP(0,0,0),z[0]*a.ab,z[1]*a.ab),ve.u_height_lift=k),ve},u0=(f,n,s,p)=>({u_matrix:f,u_edge_radius:n,u_width_scale:s,u_vertical_scale:p}),Fm=(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y)=>{const K=zm(f,n,s,p,_,x,w,A,L,z,U,j,$,Y,1,[0,0,0]),J={u_height_factor:-Math.pow(2,A.overscaledZ)/k.tileSize/8};return a.l(K,Lm(n,k),J)},af=(f,n)=>({u_matrix:f,u_emissive_strength:n}),h0=(f,n,s,p)=>a.l(af(f,n),Lm(s,p)),d0=(f,n,s)=>({u_matrix:f,u_world:s,u_emissive_strength:n}),xh=(f,n,s,p,_)=>a.l(h0(f,n,s,p),{u_world:_}),Jb=(f,n,s,p)=>{const _=a.ab/s.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},f0=(f,n,s=1)=>({u_matrix:f,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),p0=a.a6.mat4.create(),Qb=(f,n,s,p,_,x,w)=>{const A=f.transform,k=A.projection.name==="globe",L=k?a.cI(A.zoom,n.canonical)*A._pixelsPerMercatorPixel:a.ak(s,1,x),z={u_matrix:n.projMatrix,u_extrude_scale:L,u_intensity:w,u_inv_rot_matrix:p0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){z.u_inv_rot_matrix=p,z.u_merc_center=_,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=a.a9(A.zoom);const U=_[0]*a.ab,j=_[1]*a.ab;z.u_up_dir=A.projection.upVector(new a.bP(0,0,0),U,j)}return z};function sf(f,[n,s,p,_],[x,w]){if(x===w)return[0,0,0,0];const A=255*(f-1)/(f*(w-x));return[n*A,s*A,p*A,_*A]}function lf(f,n,[s,p]){return s===p?0:.5/f+(n-s)*(f-1)/(f*(p-s))}const bh=(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J,Q,fe,ge,he)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:s,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:L,u_fade_t:z.mix,u_opacity:z.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:a.cJ(U.paint.get("raster-saturation")),u_contrast_factor:a.cK(U.paint.get("raster-contrast")),u_spin_weights:Bm(U.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:$,u_zoom_transition:w,u_merc_center:A,u_cutoff_params:k,u_colorization_mix:sf(a.cL,K,Q),u_colorization_offset:lf(a.cL,J,Q),u_color_ramp:Y,u_texture_offset:[ge/(fe+2*ge),fe/(fe+2*ge)],u_texture_res:[fe+2*ge,fe+2*ge],u_emissive_strength:he});function Bm(f){f*=Math.PI/180;const n=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}const rs=.05,m0=(f,n,s,p,_,x,w,A,k,L,z,U)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:s,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:L,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:w,u_merc_center:A,u_cutoff_params:k}),cf=(f,n,s,p,_,x,w,A,k,L)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:s,u_velocity:p,u_color_ramp:x,u_velocity_res:_,u_max_speed:w,u_uv_offset:A,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[rs,rs]}),uf=(f,n,s,p,_,x,w,A,k,L)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:s,u_velocity_res:p,u_max_speed:_,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[rs,rs]}),hf=a.a6.mat4.create(),Nm=(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J,Q,fe,ge,he)=>{const xe=_.transform,ve={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(fe),u_rotate_symbol:+s,u_aspect_ratio:xe.width/xe.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:A,u_is_text:+L,u_elevation_from_sea:k?1:0,u_pitch_with_map:+p,u_texsize:z,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hf,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:he||0,u_gamma_scale:p?_.transform.getCameraToCenterDistance(fe)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.q.devicePixelRatio,u_is_halo:+j};return fe.name==="globe"&&(ve.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],ve.u_zoom_transition=Y,ve.u_inv_rot_matrix=J,ve.u_merc_center=K,ve.u_camera_forward=xe._camera.forward(),ve.u_ecef_origin=a.cM(xe.globeMatrix,$.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(xe.globeMatrix),ve.u_up_vector=Q),ve},g0=(f,n,s,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:s,u_color:p}),Wl=(f,n,s,p,_,x,w,A,k)=>a.l(function(L,z,U,j,$,Y){const{width:K,height:J}=j.imageManager.getPixelSize(z),Q=Math.pow(2,Y.tileID.overscaledZ),fe=Y.tileSize*Math.pow(2,j.transform.tileZoom)/Q,ge=fe*(Y.tileID.canonical.x+Y.tileID.wrap*Q),he=fe*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[K,J],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:$?[j.transform.width,-1*j.transform.height]:[1/a.ak(Y,1,j.transform.tileZoom),1/a.ak(Y,1,j.transform.tileZoom)],u_pixel_coord_upper:[ge>>16,he>>16],u_pixel_coord_lower:[65535&ge,65535&he]}}(0,x,w,p,A,k),{u_matrix:f,u_emissive_strength:n,u_opacity:s}),Zc=new Float32Array(a.a6.mat4.identity([])),Zt=(f,n,s,p,_,x,w,A,k,L,z,U,j,$=[0,0,0],Y)=>{const K=_.style.light,J=K.properties.get("position"),Q=[-J.x,-J.y,J.z],fe=a.a6.mat3.create();K.properties.get("anchor")==="viewport"&&(a.a6.mat3.fromRotation(fe,-_.transform.angle),a.a6.vec3.transformMat3(Q,Q,fe));const ge=z.alphaMode==="MASK",he=K.properties.get("color").toRenderColor(null),xe=j.paint.get("model-ambient-occlusion-intensity"),ve=j.paint.get("model-color").constantOr(a.bz.white).toRenderColor(null),Ie=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:s,u_node_matrix:p||Zc,u_lightpos:Q,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_camera_pos:$,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:to.BaseColor,u_metallicRoughnessTexture:to.MetallicRoughness,u_normalTexture:to.Normal,u_occlusionTexture:to.Occlusion,u_emissionTexture:to.Emission,u_lutTexture:to.LUT,u_color_mix:[ve.r,ve.g,ve.b,Ie],u_aoIntensity:xe,u_emissive_strength:U,u_occlusionTextureTransform:Y||[0,0,0,0]}},Um=(f,n=Zc,s=Zc)=>({u_matrix:f,u_instance:n,u_node_matrix:s}),_0={fillExtrusion:f=>({u_matrix:new a.bF(f),u_lightpos:new a.bH(f),u_lightintensity:new a.bI(f),u_lightcolor:new a.bH(f),u_vertical_gradient:new a.bI(f),u_opacity:new a.bI(f),u_edge_radius:new a.bI(f),u_width_scale:new a.bI(f),u_ao:new a.bG(f),u_tile_id:new a.bH(f),u_zoom_transition:new a.bI(f),u_inv_rot_matrix:new a.bF(f),u_merc_center:new a.bG(f),u_up_dir:new a.bH(f),u_height_lift:new a.bI(f),u_flood_light_color:new a.bH(f),u_vertical_scale:new a.bI(f),u_flood_light_intensity:new a.bI(f),u_ground_shadow_factor:new a.bH(f)}),fillExtrusionDepth:f=>({u_matrix:new a.bF(f),u_edge_radius:new a.bI(f),u_width_scale:new a.bI(f),u_vertical_scale:new a.bI(f)}),fillExtrusionPattern:f=>({u_matrix:new a.bF(f),u_lightpos:new a.bH(f),u_lightintensity:new a.bI(f),u_lightcolor:new a.bH(f),u_vertical_gradient:new a.bI(f),u_height_factor:new a.bI(f),u_edge_radius:new a.bI(f),u_width_scale:new a.bI(f),u_ao:new a.bG(f),u_tile_id:new a.bH(f),u_zoom_transition:new a.bI(f),u_inv_rot_matrix:new a.bF(f),u_merc_center:new a.bG(f),u_up_dir:new a.bH(f),u_height_lift:new a.bI(f),u_image:new a.bJ(f),u_texsize:new a.bG(f),u_pixel_coord_upper:new a.bG(f),u_pixel_coord_lower:new a.bG(f),u_tile_units_to_pixels:new a.bI(f),u_opacity:new a.bI(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new a.bF(f),u_opacity:new a.bI(f),u_ao_pass:new a.bI(f),u_meter_to_tile:new a.bI(f),u_ao:new a.bG(f),u_flood_light_intensity:new a.bI(f),u_flood_light_color:new a.bH(f),u_attenuation:new a.bI(f),u_edge_radius:new a.bI(f),u_fb:new a.bJ(f),u_fb_size:new a.bI(f),u_dynamic_offset:new a.bI(f)}),fill:f=>({u_matrix:new a.bF(f),u_emissive_strength:new a.bI(f)}),fillPattern:f=>({u_matrix:new a.bF(f),u_emissive_strength:new a.bI(f),u_image:new a.bJ(f),u_texsize:new a.bG(f),u_pixel_coord_upper:new a.bG(f),u_pixel_coord_lower:new a.bG(f),u_tile_units_to_pixels:new a.bI(f)}),fillOutline:f=>({u_matrix:new a.bF(f),u_emissive_strength:new a.bI(f),u_world:new a.bG(f)}),fillOutlinePattern:f=>({u_matrix:new a.bF(f),u_emissive_strength:new a.bI(f),u_world:new a.bG(f),u_image:new a.bJ(f),u_texsize:new a.bG(f),u_pixel_coord_upper:new a.bG(f),u_pixel_coord_lower:new a.bG(f),u_tile_units_to_pixels:new a.bI(f)}),circle:a.cN,collisionBox:f=>({u_matrix:new a.bF(f),u_camera_to_center_distance:new a.bI(f),u_extrude_scale:new a.bG(f)}),collisionCircle:f=>({u_matrix:new a.bF(f),u_inv_matrix:new a.bF(f),u_camera_to_center_distance:new a.bI(f),u_viewport_size:new a.bG(f)}),debug:f=>({u_color:new a.cu(f),u_matrix:new a.bF(f),u_overlay:new a.bJ(f),u_overlay_scale:new a.bI(f)}),clippingMask:f=>({u_matrix:new a.bF(f)}),heatmap:f=>({u_extrude_scale:new a.bI(f),u_intensity:new a.bI(f),u_matrix:new a.bF(f),u_inv_rot_matrix:new a.bF(f),u_merc_center:new a.bG(f),u_tile_id:new a.bH(f),u_zoom_transition:new a.bI(f),u_up_dir:new a.bH(f)}),heatmapTexture:f=>({u_image:new a.bJ(f),u_color_ramp:new a.bJ(f),u_opacity:new a.bI(f)}),hillshade:f=>({u_matrix:new a.bF(f),u_image:new a.bJ(f),u_latrange:new a.bG(f),u_light:new a.bG(f),u_shadow:new a.cu(f),u_highlight:new a.cu(f),u_emissive_strength:new a.bI(f),u_accent:new a.cu(f)}),hillshadePrepare:f=>({u_matrix:new a.bF(f),u_image:new a.bJ(f),u_dimension:new a.bG(f),u_zoom:new a.bI(f)}),line:a.cO,linePattern:a.cP,raster:f=>({u_matrix:new a.bF(f),u_normalize_matrix:new a.bF(f),u_globe_matrix:new a.bF(f),u_merc_matrix:new a.bF(f),u_grid_matrix:new a.cv(f),u_tl_parent:new a.bG(f),u_scale_parent:new a.bI(f),u_fade_t:new a.bI(f),u_opacity:new a.bI(f),u_image0:new a.bJ(f),u_image1:new a.bJ(f),u_brightness_low:new a.bI(f),u_brightness_high:new a.bI(f),u_saturation_factor:new a.bI(f),u_contrast_factor:new a.bI(f),u_spin_weights:new a.bH(f),u_perspective_transform:new a.bG(f),u_raster_elevation:new a.bI(f),u_zoom_transition:new a.bI(f),u_merc_center:new a.bG(f),u_cutoff_params:new a.c6(f),u_colorization_mix:new a.c6(f),u_colorization_offset:new a.bI(f),u_color_ramp:new a.bJ(f),u_texture_offset:new a.bG(f),u_texture_res:new a.bG(f),u_emissive_strength:new a.bI(f)}),rasterParticle:f=>({u_matrix:new a.bF(f),u_normalize_matrix:new a.bF(f),u_globe_matrix:new a.bF(f),u_merc_matrix:new a.bF(f),u_grid_matrix:new a.cv(f),u_tl_parent:new a.bG(f),u_scale_parent:new a.bI(f),u_fade_t:new a.bI(f),u_opacity:new a.bI(f),u_image0:new a.bJ(f),u_image1:new a.bJ(f),u_raster_elevation:new a.bI(f),u_zoom_transition:new a.bI(f),u_merc_center:new a.bG(f),u_cutoff_params:new a.c6(f)}),rasterParticleTexture:f=>({u_texture:new a.bJ(f),u_opacity:new a.bI(f)}),rasterParticleDraw:f=>({u_particle_texture:new a.bJ(f),u_particle_texture_side_len:new a.bI(f),u_tile_offset:new a.bG(f),u_velocity:new a.bJ(f),u_color_ramp:new a.bJ(f),u_velocity_res:new a.bG(f),u_max_speed:new a.bI(f),u_uv_offset:new a.bG(f),u_data_scale:new a.bG(f),u_data_offset:new a.bI(f),u_particle_pos_scale:new a.bI(f),u_particle_pos_offset:new a.bG(f)}),rasterParticleUpdate:f=>({u_particle_texture:new a.bJ(f),u_particle_texture_side_len:new a.bI(f),u_velocity:new a.bJ(f),u_velocity_res:new a.bG(f),u_max_speed:new a.bI(f),u_speed_factor:new a.bI(f),u_reset_rate:new a.bI(f),u_rand_seed:new a.bI(f),u_uv_offset:new a.bG(f),u_data_scale:new a.bG(f),u_data_offset:new a.bI(f),u_particle_pos_scale:new a.bI(f),u_particle_pos_offset:new a.bG(f)}),symbol:f=>({u_is_size_zoom_constant:new a.bJ(f),u_is_size_feature_constant:new a.bJ(f),u_size_t:new a.bI(f),u_size:new a.bI(f),u_camera_to_center_distance:new a.bI(f),u_rotate_symbol:new a.bJ(f),u_aspect_ratio:new a.bI(f),u_fade_change:new a.bI(f),u_matrix:new a.bF(f),u_label_plane_matrix:new a.bF(f),u_coord_matrix:new a.bF(f),u_is_text:new a.bJ(f),u_elevation_from_sea:new a.bJ(f),u_pitch_with_map:new a.bJ(f),u_texsize:new a.bG(f),u_texsize_icon:new a.bG(f),u_texture:new a.bJ(f),u_texture_icon:new a.bJ(f),u_gamma_scale:new a.bI(f),u_device_pixel_ratio:new a.bI(f),u_tile_id:new a.bH(f),u_zoom_transition:new a.bI(f),u_inv_rot_matrix:new a.bF(f),u_merc_center:new a.bG(f),u_camera_forward:new a.bH(f),u_tile_matrix:new a.bF(f),u_up_vector:new a.bH(f),u_ecef_origin:new a.bH(f),u_is_halo:new a.bJ(f),u_icon_transition:new a.bI(f),u_color_adj_mat:new a.bF(f)}),background:f=>({u_matrix:new a.bF(f),u_emissive_strength:new a.bI(f),u_opacity:new a.bI(f),u_color:new a.cu(f)}),backgroundPattern:f=>({u_matrix:new a.bF(f),u_emissive_strength:new a.bI(f),u_opacity:new a.bI(f),u_image:new a.bJ(f),u_pattern_tl:new a.bG(f),u_pattern_br:new a.bG(f),u_texsize:new a.bG(f),u_pattern_size:new a.bG(f),u_pixel_coord_upper:new a.bG(f),u_pixel_coord_lower:new a.bG(f),u_pattern_units_to_pixels:new a.bG(f)}),terrainRaster:f=>({u_matrix:new a.bF(f),u_image0:new a.bJ(f),u_skirt_height:new a.bI(f),u_ground_shadow_factor:new a.bH(f)}),skybox:f=>({u_matrix:new a.bF(f),u_sun_direction:new a.bH(f),u_cubemap:new a.bJ(f),u_opacity:new a.bI(f),u_temporal_offset:new a.bI(f)}),skyboxGradient:f=>({u_matrix:new a.bF(f),u_color_ramp:new a.bJ(f),u_center_direction:new a.bH(f),u_radius:new a.bI(f),u_opacity:new a.bI(f),u_temporal_offset:new a.bI(f)}),skyboxCapture:f=>({u_matrix_3f:new a.cv(f),u_sun_direction:new a.bH(f),u_sun_intensity:new a.bI(f),u_color_tint_r:new a.c6(f),u_color_tint_m:new a.c6(f),u_luminance:new a.bI(f)}),globeRaster:f=>({u_proj_matrix:new a.bF(f),u_globe_matrix:new a.bF(f),u_normalize_matrix:new a.bF(f),u_merc_matrix:new a.bF(f),u_zoom_transition:new a.bI(f),u_merc_center:new a.bG(f),u_image0:new a.bJ(f),u_grid_matrix:new a.cv(f),u_skirt_height:new a.bI(f),u_far_z_cutoff:new a.bI(f),u_frustum_tl:new a.bH(f),u_frustum_tr:new a.bH(f),u_frustum_br:new a.bH(f),u_frustum_bl:new a.bH(f),u_globe_pos:new a.bH(f),u_globe_radius:new a.bI(f),u_viewport:new a.bG(f)}),globeAtmosphere:f=>({u_frustum_tl:new a.bH(f),u_frustum_tr:new a.bH(f),u_frustum_br:new a.bH(f),u_frustum_bl:new a.bH(f),u_horizon:new a.bI(f),u_transition:new a.bI(f),u_fadeout_range:new a.bI(f),u_color:new a.c6(f),u_high_color:new a.c6(f),u_space_color:new a.c6(f),u_temporal_offset:new a.bI(f),u_horizon_angle:new a.bI(f)}),model:f=>({u_matrix:new a.bF(f),u_lighting_matrix:new a.bF(f),u_normal_matrix:new a.bF(f),u_node_matrix:new a.bF(f),u_lightpos:new a.bH(f),u_lightintensity:new a.bI(f),u_lightcolor:new a.bH(f),u_camera_pos:new a.bH(f),u_opacity:new a.bI(f),u_baseColorFactor:new a.c6(f),u_emissiveFactor:new a.c6(f),u_metallicFactor:new a.bI(f),u_roughnessFactor:new a.bI(f),u_baseTextureIsAlpha:new a.bJ(f),u_alphaMask:new a.bJ(f),u_alphaCutoff:new a.bI(f),u_baseColorTexture:new a.bJ(f),u_metallicRoughnessTexture:new a.bJ(f),u_normalTexture:new a.bJ(f),u_occlusionTexture:new a.bJ(f),u_emissionTexture:new a.bJ(f),u_lutTexture:new a.bJ(f),u_color_mix:new a.c6(f),u_aoIntensity:new a.bI(f),u_emissive_strength:new a.bI(f),u_occlusionTextureTransform:new a.c6(f)}),modelDepth:f=>({u_matrix:new a.bF(f),u_instance:new a.bF(f),u_node_matrix:new a.bF(f)}),groundShadow:f=>({u_matrix:new a.bF(f),u_ground_shadow_factor:new a.bH(f)}),stars:f=>({u_matrix:new a.bF(f),u_up:new a.bH(f),u_right:new a.bH(f),u_intensity_multiplier:new a.bI(f)}),occlusion:f=>({u_matrix:new a.bF(f),u_anchorPos:new a.bH(f),u_screenSizePx:new a.bG(f),u_occluderSizePx:new a.bG(f),u_color:new a.c6(f)})};class Oo{constructor(n,s,p,_){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oo.uniqueIdxCounter=0;const Gl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class rr{constructor(n,s,p,_,x,w){this.length=s.length,this.attributes=p,this.itemSize=s.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=n;const A=n.gl;this.buffer=A.createBuffer(),n.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||x||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let p=0;p<this.attributes.length;p++){const _=s.attributes[this.attributes[p].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,s,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],w=s.attributes[x.name];w!==void 0&&n.vertexAttribPointer(w,x.components,n[Gl[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,s,p){for(let _=0;_<this.attributes.length;_++){const x=s.attributes[this.attributes[_].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(x,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class df{constructor(n,s,p,_,x){this.context=n,this.width=s,this.height=p;const w=this.framebuffer=n.gl.createFramebuffer();_&&(this.colorAttachment=new rf(n,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Am(n,w):new n0(n,w))}destroy(){const n=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&n.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&n.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&n.deleteTexture(s)}n.deleteFramebuffer(this.framebuffer)}}class ew{constructor(n,s){this.gl=n,this.clearColor=new xm(this),this.clearDepth=new Yy(this),this.clearStencil=new bm(this),this.colorMask=new Jd(this),this.depthMask=new mh(this),this.stencilMask=new Xy(this),this.stencilFunc=new Ky(this),this.stencilOp=new Jy(this),this.stencilTest=new Wc(this),this.depthRange=new Qy(this),this.depthTest=new qb(this),this.depthFunc=new Zb(this),this.blend=new Yb(this),this.blendFunc=new wm(this),this.blendColor=new Sm(this),this.blendEquation=new Tm(this),this.cullFace=new Em(this),this.cullFaceSide=new e0(this),this.frontFace=new t0(this),this.program=new Xb(this),this.activeTexture=new gh(this),this.viewport=new _h(this),this.bindFramebuffer=new r0(this),this.bindRenderbuffer=new Xo(this),this.bindTexture=new Mm(this),this.bindVertexBuffer=new Qd(this),this.bindElementBuffer=new ef(this),this.bindVertexArrayOES=new Cm(this),this.pixelStoreUnpack=new Im(this),this.pixelStoreUnpackPremultiplyAlpha=new tf(this),this.pixelStoreUnpackFlipY=new Pm(this),this.options=s?{...s}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s,p){return new Oo(this,n,s,p)}createVertexBuffer(n,s,p,_,x){return new rr(this,n,s,p,_,x)}createRenderbuffer(n,s,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,n,s,p),this.bindRenderbuffer.set(null),x}createFramebuffer(n,s,p,_){return new df(this,n,s,p,_)}clear({color:n,depth:s,stencil:p,colorMask:_}){const x=this.gl;let w=0;n&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(_||[!0,!0,!0,!0])),s!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),p!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){a.bh(n.blendFunction,Ur.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ff;function pf(f,n,s,p,_,x,w){const A=f.context,k=A.gl,L=f.transform,z=f.getOrCreateProgram("collisionBox"),U=[];let j=0,$=0;for(let he=0;he<p.length;he++){const xe=p[he],ve=n.getTile(xe),Ie=ve.getBucket(s);if(!Ie)continue;const Ee=zy(xe,Ie,L);let Pe=Ee;_[0]===0&&_[1]===0||(Pe=f.translatePosMatrix(Ee,ve,_,x));const ze=w?Ie.textCollisionBox:Ie.iconCollisionBox,ke=Ie.collisionCircleArray;if(ke.length>0){const De=a.a6.mat4.create(),$e=Pe;a.a6.mat4.mul(De,Ie.placementInvProjMatrix,L.glCoordMatrix),a.a6.mat4.mul(De,De,Ie.placementViewportMatrix),U.push({circleArray:ke,circleOffset:$,transform:$e,invTransform:De,projection:Ie.getProjection()}),j+=ke.length/4,$=j}ze&&(f.terrain&&f.terrain.setupElevationDraw(ve,z),z.draw(f,k.LINES,ar.disabled,Tr.disabled,f.colorModeForRenderPass(),mr.disabled,Jb(Pe,L,ve,Ie.getProjection()),s.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,L.zoom,null,[ze.collisionVertexBuffer,ze.collisionVertexBufferExt]))}if(!w||!U.length)return;const Y=f.getOrCreateProgram("collisionCircle"),K=new a.cQ;K.resize(4*j),K._trim();let J=0;for(const he of U)for(let xe=0;xe<he.circleArray.length/4;xe++){const ve=4*xe,Ie=he.circleArray[ve+0],Ee=he.circleArray[ve+1],Pe=he.circleArray[ve+2],ze=he.circleArray[ve+3];K.emplace(J++,Ie,Ee,Pe,ze,0),K.emplace(J++,Ie,Ee,Pe,ze,1),K.emplace(J++,Ie,Ee,Pe,ze,2),K.emplace(J++,Ie,Ee,Pe,ze,3)}(!ff||ff.length<2*j)&&(ff=function(he){const xe=2*he,ve=new a.aO;ve.resize(xe),ve._trim();for(let Ie=0;Ie<xe;Ie++){const Ee=6*Ie;ve.uint16[Ee+0]=4*Ie+0,ve.uint16[Ee+1]=4*Ie+1,ve.uint16[Ee+2]=4*Ie+2,ve.uint16[Ee+3]=4*Ie+2,ve.uint16[Ee+4]=4*Ie+3,ve.uint16[Ee+5]=4*Ie+0}return ve}(j));const Q=A.createIndexBuffer(ff,!0),fe=A.createVertexBuffer(K,a.cR.members,!0);for(const he of U){const xe={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ge=L).getCameraToCenterDistance(he.projection),u_viewport_size:[ge.width,ge.height]};Y.draw(f,k.TRIANGLES,ar.disabled,Tr.disabled,f.colorModeForRenderPass(),mr.disabled,xe,s.id,fe,Q,a.b1.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,L.zoom)}var ge;fe.destroy(),Q.destroy()}const wh=a.a6.mat4.create();function jm(f){const n=f._camera.getWorldToCamera(f.worldSize,1),s=a.a6.mat4.multiply([],n,f.globeMatrix);a.a6.mat4.invert(s,s);const p=[0,0,0],_=[0,1,0,0];return a.a6.vec4.transformMat4(_,_,s),p[0]=_[0],p[1]=_[1],p[2]=_[2],a.a6.vec3.normalize(p,p),p}function tw({width:f,height:n,anchor:s,textOffset:p,textScale:_},x){const{horizontalAlign:w,verticalAlign:A}=a.bx(s),k=-(w-.5)*f,L=-(A-.5)*n,z=a.bw(s,p);return new a.P((k/_+z[0])*x,(L/_+z[1])*x)}function rw(f,n,s,p,_,x,w,A,k,L,z){const U=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,$=f.icon.dynamicLayoutVertexArray,Y={},K=f.getProjection(),J=tl(A,K,x),Q=x.elevation,fe=K.upVectorScale(A.canonical,x.center.lat,x.worldSize).metersToTile;j.clear();for(let ge=0;ge<U.length;ge++){const he=U.get(ge),{tileAnchorX:xe,tileAnchorY:ve,numGlyphs:Ie}=he,Ee=he.hidden||!he.crossTileID||f.allowVerticalPlacement&&!he.placedOrientation?null:p[he.crossTileID];if(Ee){let Pe=0,ze=0,ke=0;if(Q){const at=Q?Q.getAtTileOffset(A,xe,ve):0,[wt,Et,ft]=K.upVector(A.canonical,xe,ve);Pe=at*wt*fe,ze=at*Et*fe,ke=at*ft*fe}let[De,$e,nt,pt]=lo(he.projectedAnchorX+Pe,he.projectedAnchorY+ze,he.projectedAnchorZ+ke,s?J:w);const rt=Jr(x.getCameraToCenterDistance(K),pt);let xt=_.evaluateSizeForFeature(f.textSizeData,L,he)*rt/a.bq;s&&(xt*=f.tilePixelRatio/k);const We=tw(Ee,xt);s?({x:De,y:$e,z:nt}=K.projectTilePoint(xe+We.x,ve+We.y,A.canonical),[De,$e,nt]=lo(De+Pe,$e+ze,nt+ke,w)):(n&&We._rotate(-x.angle),De+=We.x,$e+=We.y,nt=0);const ut=f.allowVerticalPlacement&&he.placedOrientation===a.bk.vertical?Math.PI/2:0;for(let at=0;at<Ie;at++)a.bn(j,De,$e,nt,ut);z&&he.associatedIconIndex>=0&&(Y[he.associatedIconIndex]={x:De,y:$e,z:nt,angle:ut})}else ts(Ie,j)}if(z){$.clear();const ge=f.icon.placedSymbolArray;for(let he=0;he<ge.length;he++){const xe=ge.get(he),{numGlyphs:ve}=xe,Ie=Y[he];if(xe.hidden||!Ie)ts(ve,$);else{const{x:Ee,y:Pe,z:ze,angle:ke}=Ie;for(let De=0;De<ve;De++)a.bn($,Ee,Pe,ze,ke)}}f.icon.dynamicLayoutVertexBuffer.updateData($)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function Sh(f,n,s,p,_,x,w={}){const A=s.paint.get("icon-translate"),k=s.paint.get("text-translate"),L=s.paint.get("icon-translate-anchor"),z=s.paint.get("text-translate-anchor"),U=s.layout.get("icon-rotation-alignment"),j=s.layout.get("text-rotation-alignment"),$=s.layout.get("icon-pitch-alignment"),Y=s.layout.get("text-pitch-alignment"),K=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),Q=s.paint.get("icon-color-saturation"),fe=s.paint.get("icon-color-contrast"),ge=s.paint.get("icon-color-brightness-min"),he=s.paint.get("icon-color-brightness-max"),xe=s.paint.get("symbol-elevation-reference")==="sea",ve=s.paint.get("text-occlusion-opacity").constantOr(0),Ie=f.context,Ee=Ie.gl,Pe=f.transform,ze=U==="map",ke=j==="map",De=$==="map",$e=Y==="map",nt=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pt=!1;const rt=f.depthModeForSublayer(0,ar.ReadOnly),xt=[a.am(Pe.center.lng),a.at(Pe.center.lat)],We=s.layout.get("text-variable-anchor"),ut=Pe.projection.name==="globe",at=[],wt=[0,-1,0];for(const Et of p){const ft=n.getTile(Et),_t=ft.getBucket(s);if(!_t||_t.projection.name==="mercator"&&ut||_t.fullyClipped)continue;const ir=_t.projection.name==="globe",kt=ir?a.a9(Pe.zoom):0,Vt=tl(Et,_t.getProjection(),Pe),dr=Pe.calculatePixelsToTileUnitsMatrix(ft),Jt=We&&_t.hasTextData(),lr=_t.hasIconTextFit()&&Jt&&_t.hasIconData(),Or=_t.getProjection().createInversionMatrix(Pe,Et.canonical),Pr=_n=>{Pe.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||f.terrain)&&(_n.push("DEPTH_D24"),_n.push("DEPTH_OCCLUSION"))},pn=()=>{const _n=ze&&s.layout.get("symbol-placement")!=="point",Ar=[];Pr(Ar);const tn=_n||lr,hn=s.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&De&&Ar.push("PITCH_WITH_MAP_TERRAIN"),ir&&(Ar.push("PROJECTION_GLOBE_VIEW"),tn&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),hn>0&&Ar.push("ICON_TRANSITION"),_t.icon.zOffsetVertexBuffer&&Ar.push("Z_OFFSET"),Q===0&&fe===0&&ge===0&&he===1||Ar.push("COLOR_ADJUSTMENT"),_t.sdfIcons&&Ar.push("RENDER_SDF");const Yn=_t.icon.programConfigurations.get(s.id),li=f.getOrCreateProgram("symbol",{config:Yn,defines:Ar}),Xr=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],Ti=_t.iconSizeData,Oi=a.bj(Ti,Pe.zoom),Ei=De||Pe.pitch!==0,Sn=qr(Vt,ft.tileID.canonical,De,ze,Pe,_t.getProjection(),dr),bo=Ro(Vt,ft.tileID.canonical,De,ze,Pe,_t.getProjection(),dr),wo=f.translatePosMatrix(bo,ft,A,L,!0),da=f.translatePosMatrix(Vt,ft,A,L),Jo=tn?wh:Sn,zo=ze&&!De&&!_n;let fa=wt;!ut&&!Pe.mercatorFromTransition||ze||(fa=jm(Pe));const Ds=ir?fa:wt,dl=s.getColorAdjustmentMatrix(Q,fe,ge,he),as=Nm(Ti.kind,Oi,zo,De,f,da,Jo,wo,xe,!1,Xr,[0,0],!0,Et,kt,xt,Or,Ds,_t.getProjection(),dl,hn),ou=ft.imageAtlasTexture?ft.imageAtlasTexture:null,au=s.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,Df=_t.sdfIcons||f.options.rotating||f.options.zooming||au||Ei?Ee.LINEAR:Ee.NEAREST,su=_t.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Tn=f.terrain&&De&&_n?a.a6.mat4.invert(a.a6.mat4.create(),Sn):wh;if(_n&&_t.icon){const Kl=Pe.elevation,_w=Kl?Kl.getAtTileOffsetFunc(Et,Pe.center.lat,Pe.worldSize,_t.getProjection()):null,z0=Zr(Vt,ft.tileID.canonical,De,ze,Pe,_t.getProjection(),dr);Ac(_t,Vt,f,!1,z0,bo,De,K,_w,Et)}return{program:li,buffers:_t.icon,uniformValues:as,atlasTexture:ou,atlasTextureIcon:null,atlasInterpolation:Df,atlasInterpolationIcon:null,isSDF:_t.sdfIcons,hasHalo:su,tile:ft,labelPlaneMatrixInv:Tn}},xn=()=>{const _n=ke&&s.layout.get("symbol-placement")!=="point",Ar=[],tn=_n||We||lr;f.terrainRenderModeElevated()&&$e&&Ar.push("PITCH_WITH_MAP_TERRAIN"),ir&&(Ar.push("PROJECTION_GLOBE_VIEW"),tn&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),_t.text.zOffsetVertexBuffer&&Ar.push("Z_OFFSET"),_t.iconsInText&&Ar.push("RENDER_TEXT_AND_SYMBOL"),Ar.push("RENDER_SDF"),Pr(Ar);const hn=_t.text.programConfigurations.get(s.id),Yn=f.getOrCreateProgram("symbol",{config:hn,defines:Ar});let li,Xr=[0,0],Ti=null;const Oi=_t.textSizeData;_t.iconsInText&&(Xr=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],Ti=ft.imageAtlasTexture?ft.imageAtlasTexture:null,li=$e||Pe.pitch!==0||f.options.rotating||f.options.zooming||Oi.kind==="composite"||Oi.kind==="camera"?Ee.LINEAR:Ee.NEAREST);const Ei=ft.glyphAtlasTexture?ft.glyphAtlasTexture.size:[0,0],Sn=a.bj(Oi,Pe.zoom),bo=qr(Vt,ft.tileID.canonical,$e,ke,Pe,_t.getProjection(),dr),wo=Ro(Vt,ft.tileID.canonical,$e,ke,Pe,_t.getProjection(),dr),da=f.translatePosMatrix(wo,ft,k,z,!0),Jo=f.translatePosMatrix(Vt,ft,k,z),zo=tn?wh:bo,fa=ke&&!$e&&!_n;let Ds=wt;!ut&&!Pe.mercatorFromTransition||ke||(Ds=jm(Pe));const dl=Nm(Oi.kind,Sn,fa,$e,f,Jo,zo,da,xe,!0,Ei,Xr,!0,Et,kt,xt,Or,ir?Ds:wt,_t.getProjection(),ve),as=ft.glyphAtlasTexture?ft.glyphAtlasTexture:null,ou=Ee.LINEAR,au=s.paint.get("text-halo-width").constantOr(1)!==0,Df=f.terrain&&$e&&_n?a.a6.mat4.invert(a.a6.mat4.create(),bo):wh;if(_n&&_t.text){const su=Pe.elevation,Tn=su?su.getAtTileOffsetFunc(Et,Pe.center.lat,Pe.worldSize,_t.getProjection()):null,Kl=Zr(Vt,ft.tileID.canonical,$e,ke,Pe,_t.getProjection(),dr);Ac(_t,Vt,f,!0,Kl,wo,$e,J,Tn,Et)}return{program:Yn,buffers:_t.text,uniformValues:dl,atlasTexture:as,atlasTextureIcon:Ti,atlasInterpolation:ou,atlasInterpolationIcon:li,isSDF:!0,hasHalo:au,tile:ft,labelPlaneMatrixInv:Df}},Cn=_t.icon.segments.get().length,ha=_t.text.segments.get().length,si=Cn&&!w.onlyText?pn():null,$r=ha&&!w.onlyIcons?xn():null,yn=s.paint.get("icon-opacity").constantOr(1),zn=s.paint.get("text-opacity").constantOr(1);if(nt&&_t.canOverlap){pt=!0;const _n=yn&&!w.onlyText?_t.icon.segments.get():[],Ar=zn&&!w.onlyIcons?_t.text.segments.get():[];for(const tn of _n)at.push({segments:new a.b1([tn]),sortKey:tn.sortKey,state:si});for(const tn of Ar)at.push({segments:new a.b1([tn]),sortKey:tn.sortKey,state:$r})}else w.onlyText||at.push({segments:yn?_t.icon.segments:new a.b1([]),sortKey:0,state:si}),w.onlyIcons||at.push({segments:zn?_t.text.segments:new a.b1([]),sortKey:0,state:$r})}pt&&at.sort((Et,ft)=>Et.sortKey-ft.sortKey);for(const Et of at){const ft=Et.state;if(ft)if(f.terrain?f.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:Pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Pe.depthOcclusionForSymbolsAndCircles,ft.program),Ie.activeTexture.set(Ee.TEXTURE0),ft.atlasTexture&&ft.atlasTexture.bind(ft.atlasInterpolation,Ee.CLAMP_TO_EDGE,!0),ft.atlasTextureIcon&&(Ie.activeTexture.set(Ee.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,Ee.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,ft.program),ft.hasHalo){const _t=ft.uniformValues;_t.u_is_halo=1,Th(ft.buffers,Et.segments,s,f,ft.program,rt,_,x,_t,2),_t.u_is_halo=0}else{if(ft.isSDF){const _t=ft.uniformValues;ft.hasHalo&&(_t.u_is_halo=1,Th(ft.buffers,Et.segments,s,f,ft.program,rt,_,x,_t,1)),_t.u_is_halo=0}Th(ft.buffers,Et.segments,s,f,ft.program,rt,_,x,ft.uniformValues,1)}}}function Th(f,n,s,p,_,x,w,A,k,L){const z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];_.draw(p,p.context.gl.TRIANGLES,x,w,A,mr.disabled,k,s.id,f.layoutVertexBuffer,f.indexBuffer,n,s.paint,p.transform.zoom,f.programConfigurations.get(s.id),z,L)}function mf(f,n,s,p,_,x,w){const A=f.context.gl,k=s.paint.get("fill-pattern"),L=s.is3D(),z=L?f.stencilModeFor3D():Tr.disabled,U=k&&k.constantOr(1);let j,$,Y,K,J;w?($=U&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=A.LINES):($=U?"fillPattern":"fill",j=A.TRIANGLES);for(const Q of p){const fe=n.getTile(Q);if(U&&!fe.patternsLoaded())continue;const ge=fe.getBucket(s);if(!ge)continue;f.prepareDrawTile();const he=ge.programConfigurations.get(s.id),xe=f.isTileAffectedByFog(Q),ve=f.getOrCreateProgram($,{config:he,overrideFog:xe});U&&(f.context.activeTexture.set(A.TEXTURE0),fe.imageAtlasTexture&&fe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),he.updatePaintBuffers());const Ie=k.constantOr(null);if(Ie&&fe.imageAtlas){const ze=fe.imageAtlas.patternPositions[Ie.toString()];ze&&he.setConstantPatternPositions(ze)}const Ee=f.translatePosMatrix(Q.projMatrix,fe,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),Pe=s.paint.get("fill-emissive-strength");if(w){K=ge.indexBuffer2,J=ge.segments2;const ze=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];Y=$==="fillOutlinePattern"&&U?xh(Ee,Pe,f,fe,ze):d0(Ee,Pe,ze)}else K=ge.indexBuffer,J=ge.segments,Y=U?h0(Ee,Pe,f,fe):af(Ee,Pe);f.uploadCommonUniforms(f.context,ve,Q.toUnwrapped()),ve.draw(f,j,_,L?z:f.stencilModeForClipping(Q),x,mr.disabled,Y,s.id,ge.layoutVertexBuffer,K,J,s.paint,f.transform.zoom,he,void 0)}}function Yc(f,n,s,p,_,x,w,A){s.resetLayerRenderingStats(f);const k=f.context,L=k.gl,z=f.transform,U=s.paint.get("fill-extrusion-pattern"),j=U.constantOr(1),$=s.paint.get("fill-extrusion-opacity"),Y=f.style.enable3dLights(),K=s.paint.get(Y&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],Q=s.layout.get("fill-extrusion-edge-radius"),fe=Q>0&&!s.paint.get("fill-extrusion-rounded-roof"),ge=fe?0:Q,he=z.projection.name==="globe"?a.c_():0,xe=z.projection.name==="globe",ve=xe?a.a9(z.zoom):0,Ie=[a.am(z.center.lng),a.at(z.center.lat)],Ee=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(s.lut).toArray01().slice(0,3),Pe=s.paint.get("fill-extrusion-flood-light-intensity"),ze=s.paint.get("fill-extrusion-vertical-scale"),ke=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,De=Es(f,s.paint.get("fill-extrusion-cutoff-fade-range")),$e=[];let nt;xe&&$e.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&$e.push("FAUX_AO"),fe&&$e.push("ZERO_ROOF_RADIUS"),A&&$e.push("HAS_CENTROID"),Pe>0&&$e.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&$e.push("RENDER_CUTOFF"),ke&&$e.push("RENDER_WALL_MODE");const pt=f.renderPass==="shadow",rt=f.shadowRenderer,xt=pt&&!!rt;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let We=[0,0,0];if(rt){const wt=f.style.directionalLight,Et=f.style.ambientLight;wt&&Et&&(We=Wd(f.style,wt,Et)),nt=$e.concat(["SHADOWS_SINGLE_CASCADE"])}const ut=xt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",at=s.getLayerRenderingStats();for(const wt of p){const Et=n.getTile(wt),ft=Et.getBucket(s);if(!ft||ft.projection.name!==z.projection.name)continue;let _t=!1;rt&&(_t=rt.getMaxCascadeForTile(wt.toUnwrapped())===0);const ir=f.isTileAffectedByFog(wt),kt=ft.programConfigurations.get(s.id),Vt=f.getOrCreateProgram(ut,{config:kt,defines:_t?nt:$e,overrideFog:ir});if(f.terrain&&f.terrain.setupElevationDraw(Et,Vt,{useMeterToDem:!0}),!ft.centroidVertexBuffer){const xn=Vt.attributes.a_centroid_pos;xn!==void 0&&L.vertexAttrib2f(xn,0,0)}!pt&&rt&&rt.setupShadows(Et.tileID.toUnwrapped(),Vt,"vector-tile",Et.tileID.overscaledZ),j&&(f.context.activeTexture.set(L.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),kt.updatePaintBuffers());const dr=U.constantOr(null);if(dr&&Et.imageAtlas){const xn=Et.imageAtlas.patternPositions[dr.toString()];xn&&kt.setConstantPatternPositions(xn)}const Jt=s.paint.get("fill-extrusion-vertical-gradient"),lr=1/ft.tileToMeter;let Or;if(pt&&rt){if(Wm(Et.tileID,ft,f))continue;const xn=rt.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());Or=u0(xn,ge,lr,ze)}else{const xn=f.translatePosMatrix(wt.expandedProjMatrix,Et,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Cn=z.projection.createInversionMatrix(z,wt.canonical);Or=j?Fm(xn,f,Jt,$,J,ge,lr,wt,Et,he,ve,Ie,Cn,Ee,ze):zm(xn,f,Jt,$,J,ge,lr,wt,he,ve,Ie,Cn,Ee,ze,Pe,We)}f.uploadCommonUniforms(k,Vt,wt.toUnwrapped(),null,De);let Pr=ft.segments;if(z.projection.name==="mercator"&&!pt&&(Pr=ft.getVisibleSegments(Et.tileID,f.terrain,f.transform.getFrustum(0)),!Pr.get().length))continue;if(at)if(pt)for(const xn of Pr.get())at.numRenderedVerticesInShadowPass+=xn.primitiveLength;else for(const xn of Pr.get())at.numRenderedVerticesInTransparentPass+=xn.primitiveLength;const pn=[];(f.terrain||A)&&pn.push(ft.centroidVertexBuffer),xe&&pn.push(ft.layoutVertexExtBuffer),ke&&pn.push(ft.wallVertexBuffer),Vt.draw(f,k.gl.TRIANGLES,_,x,w,mr.backCCW,Or,s.id,ft.layoutVertexBuffer,ft.indexBuffer,Pr,s.paint,f.transform.zoom,kt,pn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Ni(f,n,s,p,_,x,w,A,k,L,z,U,j,$,Y,K,J,Q,fe){const ge=f.context,he=ge.gl,xe=f.transform,ve=f.transform.zoom,Ie=[],Ee=Es(f,s.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Ie.push("CLEAR_SUBPASS"),fe&&(Ie.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(he.TEXTURE0),fe.bind(he.LINEAR,he.CLAMP_TO_EDGE))):L==="sdf"&&Ie.push("SDF_SUBPASS"),J&&Ie.push("HAS_CENTROID"),Ee.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const Pe=s.layout.get("fill-extrusion-edge-radius"),ze=(ke,De,$e,nt,pt)=>{const rt=De.programConfigurations.get(s.id),xt=f.isTileAffectedByFog(ke),We=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:rt,defines:Ie,overrideFog:xt}),ut=((wt,Et,ft,_t,ir,kt,Vt,dr,Jt,lr,Or)=>({u_matrix:Et,u_opacity:ft,u_ao_pass:_t?1:0,u_meter_to_tile:ir,u_ao:kt,u_flood_light_intensity:Vt,u_flood_light_color:dr,u_attenuation:Jt,u_edge_radius:lr,u_fb:0,u_fb_size:Or,u_dynamic_offset:1}))(0,nt,z,k,pt,[U,j*pt],$,Y,K,ve>=17?0:Pe*pt,fe?fe.size[0]:0),at=[];J&&at.push(De.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ge,We,ke.toUnwrapped(),null,Ee),We.draw(f,ge.gl.TRIANGLES,_,x,w,A,ut,s.id,De.vertexBuffer,De.indexBuffer,$e,s.paint,ve,rt,at)};for(const ke of p){const De=n.getTile(ke),$e=De.getBucket(s);if(!$e||$e.projection.name!==xe.projection.name||!$e.groundEffect||$e.groundEffect&&!$e.groundEffect.hasData())continue;const nt=$e.groundEffect,pt=1/$e.tileToMeter;{const rt=f.translatePosMatrix(ke.projMatrix,De,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),xt=nt.getDefaultSegment();ze(ke,nt,xt,rt,pt)}if(Q)for(let rt=0;rt<4;rt++){const xt=a.c$[rt](ke),We=n.getTile(xt);if(!We)continue;const ut=We.getBucket(s);if(!ut||ut.projection.name!==xe.projection.name||!ut.groundEffect||ut.groundEffect&&!ut.groundEffect.hasData())continue;const at=ut.groundEffect;let wt,Et;rt===0?(wt=[-a.ab,0,0],Et=1):rt===1?(wt=[a.ab,0,0],Et=0):rt===2?(wt=[0,-a.ab,0],Et=3):(wt=[0,a.ab,0],Et=2);const ft=at.regionSegments[Et];if(!ft)continue;const _t=new Float32Array(16);a.a6.mat4.translate(_t,ke.projMatrix,wt),ze(ke,at,ft,f.translatePosMatrix(_t,De,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pt)}}}function al(f,n,s,p,_,x,w){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const A=x?x.findDEMTileFor(s):null;if(!(A&&A.dem||w))return;const k=Q=>new a.P(Math.ceil((Q+a.d2)*a.d3),0),L=Q=>{const fe=n.getSource().minzoom,ge=xe=>{const ve=n.getTileByID(xe);if(ve&&ve.hasData())return ve.getBucket(_)},he=[0,-1,1];for(const xe of he){if(Q.overscaledZ+xe<fe)continue;const ve=ge(Q.calculateScaledKey(Q.overscaledZ+xe));if(ve)return ve}},z=[0,0,0],U=(Q,fe)=>(z[0]=Math.min(Q.min.y,fe.min.y),z[1]=Math.max(Q.max.y,fe.max.y),z[2]=a.ab-fe.min.x>Q.max.x?fe.min.x-a.ab:Q.max.x,z),j=(Q,fe)=>(z[0]=Math.min(Q.min.x,fe.min.x),z[1]=Math.max(Q.max.x,fe.max.x),z[2]=a.ab-fe.min.y>Q.max.y?fe.min.y-a.ab:Q.max.y,z),$=[(Q,fe)=>U(Q,fe),(Q,fe)=>U(fe,Q),(Q,fe)=>j(Q,fe),(Q,fe)=>j(fe,Q)],Y=(Q,fe,ge,he,xe,ve,Ie)=>{if(!x)return 0;const Ee=[[ve?ge:Q,ve?Q:ge,0],[ve?ge:fe,ve?fe:ge,0]],Pe=Ie<0?a.ab+Ie:Ie,ze=[ve?Pe:(Q+fe)/2,ve?(Q+fe)/2:Pe,0];return ge===0&&Ie<0||ge!==0&&Ie>0?x.getForTilePoints(xe,[ze],!0,he):Ee.push(ze),x.getForTilePoints(s,Ee,!0,A),Math.max(Ee[0][2],Ee[1][2],ze[2])/x.exaggeration()};for(let Q=0;Q<4;Q++){const fe=p.borderFeatureIndices[Q];if(fe.length===0)continue;const ge=a.c$[Q](s),he=L(ge);if(!(he&&he instanceof a.d0)||p.borderDoneWithNeighborZ[Q]===he.canonical.z)continue;he.centroidVertexArray.length===0&&he.createCentroidsBuffer();const xe=x?x.findDEMTileFor(ge):null;if(!(xe&&xe.dem||w))continue;const ve=(Q<2?1:5)-Q,Ie=he.borderDoneWithNeighborZ[ve]!==p.canonical.z,Ee=he.borderFeatureIndices[ve];let Pe=0;if(p.canonical.z!==he.canonical.z){for(const ze of fe)p.showCentroid(p.featuresOnBorder[ze]);if(Ie)for(const ze of Ee)he.showCentroid(he.featuresOnBorder[ze]);p.borderDoneWithNeighborZ[Q]=he.canonical.z,he.borderDoneWithNeighborZ[ve]=p.canonical.z}for(const ze of fe){const ke=p.featuresOnBorder[ze],De=p.centroidData[ke.centroidDataIndex],$e=ke.borders[Q];let nt;for(;Pe<Ee.length;){nt=he.featuresOnBorder[Ee[Pe]];const pt=nt.borders[ve];if(pt[1]>$e[0]+3||pt[0]>$e[0]-3)break;he.showCentroid(nt),Pe++}if(nt&&Pe<Ee.length){const pt=Pe;let rt=0;for(;!(nt.borders[ve][0]>$e[1]-3)&&(rt++,++Pe!==Ee.length);)nt=he.featuresOnBorder[Ee[Pe]];nt=he.featuresOnBorder[Ee[pt]];let xt=!1;if(rt>=1){const at=nt.borders[ve];Math.abs($e[0]-at[0])<3&&Math.abs($e[1]-at[1])<3&&(rt=1,xt=!0,Pe=pt+1)}else if(rt===0){p.showCentroid(ke);continue}const We=he.centroidData[nt.centroidDataIndex];w&&xt&&(((K=De).flags|(J=We).flags)&a.d1?(K.flags|=a.d1,J.flags|=a.d1):(K.flags&=~a.d1,J.flags&=~a.d1));const ut=ke.intersectsCount()>1||nt.intersectsCount()>1;if(rt>1)Pe=pt,De.centroidXY=We.centroidXY=new a.P(0,0);else if(xe&&xe.dem&&!ut){const at=$[Q](De,We),wt=Q%2?a.ab-1:0,Et=Y(at[0],Math.min(a.ab-1,at[1]),wt,xe,ge,Q<2,at[2]);De.centroidXY=We.centroidXY=k(Et)}else ut?De.centroidXY=We.centroidXY=new a.P(0,0):(De.centroidXY=p.encodeBorderCentroid(ke),We.centroidXY=he.encodeBorderCentroid(nt));p.writeCentroidToBuffer(De),he.writeCentroidToBuffer(We)}else p.showCentroid(ke)}p.borderDoneWithNeighborZ[Q]=he.canonical.z,he.borderDoneWithNeighborZ[ve]=p.canonical.z}var K,J;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const y0=[1,0,0],Vm=[0,1,0],$m=[0,0,1];function Wm(f,n,s){const p=s.transform,_=s.shadowRenderer;if(!_)return!0;const x=f.toUnwrapped(),w=p.tileSize*_._cascades[s.currentShadowCascade].scale;let A=n.maxHeight;if(p.elevation){const K=p.elevation.getMinMaxForTile(f);K&&(A+=K.max)}const k=[..._.shadowDirection];k[2]=-k[2];const L=_.computeSimplifiedTileShadowVolume(x,A,w,k);if(!L)return!1;const z=[y0,Vm,$m,k,[k[0],0,k[2]],[0,k[1],k[2]]],U=p.projection.name==="globe",j=p.scaleZoom(w),$=a.bN.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,j,!U),Y=_.getCurrentCascadeFrustum();return $.intersectsPrecise(L.vertices,L.planes,z)===0||Y.intersectsPrecise(L.vertices,L.planes,z)===0}function Gm(f){return[f[0]*a.d4,f[1]*a.d4,f[2]*a.d4,0]}function Lo(f,n,s,p,_,x,w,A,k){const L=p.getSource(),z=s.globeSharedBuffers;if(!z)return;let U,j,$;if(n&&(U=p.getTile(n)),L instanceof a.aD?(j=L.texture,$=a.cD(0,0,s.transform)):U&&n&&(j=U.texture,$=a.cD(n.canonical.z,n.canonical.x,s.transform)),!j||!$)return;f||($=a.a6.mat4.scale(a.a6.mat4.create(),$,[1,-1,1]));const Y=s.context,K=Y.gl,J=_.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR,Q=s.colorModeForDrapableLayerRenderPass(x),fe=w.defines;fe.push("GLOBE_POLES");const ge=new ar(K.LEQUAL,ar.ReadWrite,s.depthRangeFor3D),he=Float32Array.from(s.transform.expandedFarZProjMatrix),xe=Float32Array.from(a.b5(a.cC(new a.bP(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),Y.activeTexture.set(K.TEXTURE0),j.bind(J,K.CLAMP_TO_EDGE),Y.activeTexture.set(K.TEXTURE1),j.bind(J,K.CLAMP_TO_EDGE),j.useMipmap&&Y.extTextureFilterAnisotropic&&s.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[ve,Ie,Ee,Pe]=n?z.getPoleBuffers(n.canonical.z,!1):z.getPoleBuffers(0,!0),ze=_.paint.get("raster-elevation");let ke;f?(ke=ve,s.renderDefaultNorthPole=ze!==0):(ke=Ie,s.renderDefaultSouthPole=ze!==0);const De=Gm(w.mix),$e=((pt,rt,xt,We,ut,at,wt,Et,ft,_t,ir,kt,Vt)=>bh(pt,rt,xt,new Float32Array(16),new Float32Array(9),[0,0],We,[0,0],[0,0,0,0],1,{opacity:1,mix:0},at,[0,0],Et,2,_t,ir,kt,1,0,Vt))(he,xe,$,a.a9(s.transform.zoom),0,_,0,ze,0,De,w.offset,w.range,x),nt=s.getOrCreateProgram("raster",{defines:fe});s.uploadCommonUniforms(Y,nt,null),nt.draw(s,K.TRIANGLES,ge,k,Q,A,$e,_.id,ke,Ee,Pe)}function qn(f){const n=f._nearZ,s=f.projection.farthestPixelDistance(f),p=s-n,_=.2*f.height,x=n+_;return[n,s,(x-_-n)/p,(x-n)/p]}function gf(f,n,s,p){if(f)return n instanceof Tc&&f instanceof kd?n.getTextureDescriptor(f,s,!0):{texture:f.texture,mix:Gm(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Hm=a.d5([{name:"a_index",type:"Int16",components:1}]);class v0{constructor(n,s,p,_){const x={width:p[0],height:p[1],data:null},w=n.gl;this.targetColorTexture=new a.T(n,x,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(n,x,w.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(s,_),this.lastInvalidatedAt=0}updateParticleTexture(n,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,_=s.width*s.height;this.particleTexture0=new a.T(this.context,s,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,s,p.RGBA8,{premultiply:!1,useMipmap:!1});const x=new a.d6;x.reserve(_);for(let w=0;w<_;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,Hm.members,!0),this.particleSegment=a.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=a.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function x0(f,n,s){if(!f)return null;const p=n.getTextureDescriptor(f,s,!0);if(!p)return null;let{texture:_,mix:x,offset:w,tileSize:A,buffer:k,format:L}=p;if(!_||!L)return null;let z=!1;return L==="uint32"&&(z=!0,x[3]=0,x=sf(a.d7,x,[0,s.paint.get("raster-particle-max-speed")]),w=lf(a.d7,w,[0,s.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[k/(A+2*k),A/(A+2*k)],tileSize:A,scalarData:z,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function b0(f){const n=f._nearZ,s=f.projection.farthestPixelDistance(f),p=s-n,_=.2*f.height,x=n+_;return[n,s,(x-_-n)/p,(x-n)/p]}const nw=new a.bz(1,0,0,1),Xc=new a.bz(0,1,0,1),Kc=new a.bz(0,0,1,1),Pt=new a.bz(1,0,1,1),nr=new a.bz(0,1,1,1);function ka(f,n,s,p,_,x,w){const A=f.context,k=f.transform,L=A.gl,z=k.projection.name==="globe",U=z?["PROJECTION_GLOBE_VIEW"]:[];let j=a.a6.mat4.clone(s.projMatrix);if(z&&a.a9(k.zoom)>0){const De=a.b4(s.canonical,k),$e=a.d8(De);j=a.a6.mat4.multiply(new Float32Array(16),k.globeMatrix,$e),a.a6.mat4.multiply(j,k.projMatrix,j)}const $=a.a6.mat4.create();$[12]+=2*_/(a.q.devicePixelRatio*k.width),$[13]+=2*x/(a.q.devicePixelRatio*k.height),a.a6.mat4.multiply(j,$,j);const Y=f.getOrCreateProgram("debug",{defines:U}),K=n.getTileByID(s.key);f.terrain&&f.terrain.setupElevationDraw(K,Y);const J=ar.disabled,Q=Tr.disabled,fe=f.colorModeForRenderPass(),ge="$debug";A.activeTexture.set(L.TEXTURE0),f.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),z?K._makeGlobeTileDebugBuffers(f.context,k):K._makeDebugTileBoundsBuffers(f.context,k.projection);const he=K._tileDebugBuffer||f.debugBuffer,xe=K._tileDebugIndexBuffer||f.debugIndexBuffer,ve=K._tileDebugSegments||f.debugSegments;if(Y.draw(f,L.LINE_STRIP,J,Q,fe,mr.disabled,f0(j,p),ge,he,xe,ve,null,null,null,[K._globeTileDebugBorderBuffer]),w){const De=K.latestRawTileData,$e=Math.floor((De&&De.byteLength||0)/1024);let nt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(nt+=` => ${s.overscaledZ}`),nt+=` ${K.state}`,nt+=` ${$e}kb`,function(pt,rt){pt.initDebugOverlayCanvas();const xt=pt.debugOverlayCanvas,We=pt.context.gl,ut=pt.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,xt.width,xt.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(rt,5,5),ut.strokeText(rt,5,5),pt.debugOverlayTexture.update(xt),pt.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(f,nt)}const Ie=n.getTile(s).tileSize,Ee=512/Math.min(Ie,512)*(s.overscaledZ/k.zoom)*.5,Pe=K._tileDebugTextBuffer||f.debugBuffer,ze=K._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,ke=K._tileDebugTextSegments||f.debugSegments;Y.draw(f,L.TRIANGLES,J,Q,Ur.alphaBlended,mr.disabled,f0(j,a.bz.transparent,Ee),ge,Pe,ze,ke,null,null,null,[K._globeTileDebugTextBuffer])}function Ln(f,n,s,p){Eh(f,0,n+s/2,f.transform.width,s,p)}function He(f,n,s,p){Eh(f,n-s/2,0,s,f.transform.height,p)}function Eh(f,n,s,p,_,x){const w=f.context,A=w.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*a.q.devicePixelRatio,s*a.q.devicePixelRatio,p*a.q.devicePixelRatio,_*a.q.devicePixelRatio),w.clear({color:x}),A.disable(A.SCISSOR_TEST)}const _f=a.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:qm}=_f;function Oa(f,n,s,p){f.emplaceBack(n,s,p)}class Zm{constructor(n){this.vertexArray=new a.d9,this.indices=new a.aO,Oa(this.vertexArray,-1,-1,1),Oa(this.vertexArray,1,-1,1),Oa(this.vertexArray,-1,1,1),Oa(this.vertexArray,1,1,1),Oa(this.vertexArray,-1,-1,-1),Oa(this.vertexArray,1,-1,-1),Oa(this.vertexArray,-1,1,-1),Oa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,qm),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.b1.simpleSegment(0,0,36,12)}}function Hl(f,n,s,p,_,x){const w=f.context.gl,A=n.paint.get("sky-atmosphere-color"),k=n.paint.get("sky-atmosphere-halo-color"),L=n.paint.get("sky-atmosphere-sun-intensity"),z=((U,j,$,Y,K)=>({u_matrix_3f:U,u_sun_direction:j,u_sun_intensity:$,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(a.a6.mat3.fromMat4(a.a6.mat3.create(),p),_,L,A,k);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),s.draw(f,w.TRIANGLES,ar.disabled,Tr.disabled,Ur.unblended,mr.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Jc=a.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class iw{constructor(n){const s=new a.da;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const p=new a.aO;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(s,Jc.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=a.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ow=a.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class w0{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class yf{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Ur([1,qo,1,qo],a.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ur([1,0,1,0],a.bz.transparent,[!1,!1,!1,!0]),this.params=new w0,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const s=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new iw(s);const p=this.params.sizeRange,_=this.params.intensityRange,x=function(z){const U=a.dd(30),j=[];for(let $=0;$<z;++$){const Y=2*Math.PI*U(),K=Math.acos(1-2*U())-.5*Math.PI;j.push(a.a6.vec3.fromValues(Math.cos(K)*Math.cos(Y),Math.cos(K)*Math.sin(Y),Math.sin(K)))}return j}(this.params.starsCount),w=a.dd(300),A=new a.db,k=new a.aO;let L=0;for(let z=0;z<x.length;++z){const U=a.a6.vec3.scale([],x[z],200),j=Math.max(0,1+.01*p*(1*w()-.5)),$=Math.max(0,1+.01*_*(1*w()-.5));A.emplaceBack(U[0],U[1],U[2],-1,-1,j,$),A.emplaceBack(U[0],U[1],U[2],1,-1,j,$),A.emplaceBack(U[0],U[1],U[2],1,1,j,$),A.emplaceBack(U[0],U[1],U[2],-1,1,j,$),k.emplaceBack(L+0,L+1,L+2),k.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=s.createVertexBuffer(A,ow.members),this.starsIdx=s.createIndexBuffer(k),this.starsSegments=a.b1.simpleSegment(0,0,A.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,s){const p=n.context,_=p.gl,x=n.transform,w=new ar(_.LEQUAL,ar.ReadOnly,[0,1]),A=a.a9(x.zoom),k=n.style.getLut(s.scope),L=s.properties.get("color").toRenderColor(k).toArray01(),z=s.properties.get("high-color").toRenderColor(k).toArray01(),U=s.properties.get("space-color").toRenderColor(k).toArray01PremultipliedAlpha(),j=5e-4,$=a.dc(s.properties.get("horizon-blend"),0,1,j,.25),Y=a.cx(n,p,x)&&$===j?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,K=n.frameCounter/1e3%1,J=a.a6.vec3.length(x.globeCenterInViewSpace),Q=Math.sqrt(Math.pow(J,2)-Math.pow(Y,2)),fe=Math.acos(Q/J),ge=he=>{const xe=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];he&&xe.push("ALPHA_PASS");const ve=n.getOrCreateProgram("globeAtmosphere",{defines:xe}),Ie=((Pe,ze,ke,De,$e,nt,pt,rt,xt,We,ut,at)=>({u_frustum_tl:Pe,u_frustum_tr:ze,u_frustum_br:ke,u_frustum_bl:De,u_horizon:$e,u_transition:nt,u_fadeout_range:pt,u_color:rt,u_high_color:xt,u_space_color:We,u_temporal_offset:ut,u_horizon_angle:at}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,A,$,L,z,U,K,fe);n.uploadCommonUniforms(p,ve);const Ee=this.atmosphereBuffer;Ee&&ve.draw(n,_.TRIANGLES,w,Tr.disabled,he?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mr.backCW,Ie,he?"atmosphere_glow_alpha":"atmosphere_glow",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)};ge(!1),ge(!0)}drawStars(n,s){const p=a.ap(s.properties.get("star-intensity"),0,1);if(p===0)return;const _=n.context,x=_.gl,w=n.transform,A=n.getOrCreateProgram("stars"),k=a.a6.quat.identity([]);a.a6.quat.rotateX(k,k,-w._pitch),a.a6.quat.rotateZ(k,k,-w.angle),a.a6.quat.rotateX(k,k,a.bB(w._center.lat)),a.a6.quat.rotateY(k,k,-a.bB(w._center.lng));const L=a.a6.mat4.fromQuat(new Float32Array(16),k),z=a.a6.mat4.multiply([],w.starsProjMatrix,L),U=a.a6.mat3.fromMat4([],L),j=a.a6.mat3.invert([],U),$=[0,1,0];a.a6.vec3.transformMat3($,$,j),a.a6.vec3.scale($,$,this.params.sizeMultiplier);const Y=[1,0,0];a.a6.vec3.transformMat3(Y,Y,j),a.a6.vec3.scale(Y,Y,this.params.sizeMultiplier);const K=(J=$,Q=Y,fe=p,{u_matrix:Float32Array.from(z),u_up:J,u_right:Q,u_intensity_multiplier:fe});var J,Q,fe;n.uploadCommonUniforms(_,A),this.starsVx&&this.starsIdx&&A.draw(n,x.TRIANGLES,ar.disabled,Tr.disabled,this.colorModeAlphaBlendedWriteRGB,mr.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function vf(f,n){const s=[...f],p=n.cameraWorldSizeForFog/n.worldSize,_=a.a6.mat4.identity([]);return a.a6.mat4.scale(_,_,[p,p,1]),a.a6.mat4.multiply(s,_,s),a.a6.mat4.multiply(s,n.worldToFogMatrix,s),s}function xf(f,n,s,p,_){const x=s.material,w=p.context,{baseColorTexture:A,metallicRoughnessTexture:k}=x.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:z,emissionTexture:U}=x;function j($,Y,K){if($&&(f.push(Y),w.activeTexture.set(w.gl.TEXTURE0+K),$.gfxTexture)){const{minFilter:J,magFilter:Q,wrapS:fe,wrapT:ge}=$.sampler;$.gfxTexture.bindExtraParam(J,Q,fe,ge)}}j(A,"HAS_TEXTURE_u_baseColorTexture",to.BaseColor),j(k,"HAS_TEXTURE_u_metallicRoughnessTexture",to.MetallicRoughness),j(L,"HAS_TEXTURE_u_normalTexture",to.Normal),j(z,"HAS_TEXTURE_u_occlusionTexture",to.Occlusion),j(U,"HAS_TEXTURE_u_emissionTexture",to.Emission),_&&(_.texture||(_.texture=new a.df(p.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+to.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(s.texcoordBuffer)),s.colorBuffer&&(f.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(s.colorBuffer)),s.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(s.normalBuffer)),s.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(s.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function Mh(f,n,s,p,_,x){const w=s.paint.get("model-opacity"),A=n.context,k=new ar(n.context.gl.LEQUAL,ar.ReadWrite,n.depthRangeFor3D),L=n.transform,z=f.mesh,U=z.material,j=U.pbrMetallicRoughness,$=n.style.fog;let Y;Y=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:a.a6.mat4.multiply([],p.zScaleMatrix,f.nodeModelMatrix),a.a6.mat4.multiply(Y,p.negCameraPosMatrix,Y);const K=a.a6.mat4.invert([],Y);a.a6.mat4.transpose(K,K);const J=s.paint.get("model-emissive-strength").constantOr(0),Q=Zt(new Float32Array(f.worldViewProjection),new Float32Array(Y),new Float32Array(K),null,n,w,j.baseColorFactor.toRenderColor(null),U.emissiveFactor,j.metallicFactor,j.roughnessFactor,U,J,s),fe={defines:[]},ge=[];xf(fe.defines,ge,z,n,s.lut);const he=n.shadowRenderer;he&&(he.useNormalOffset=!1);let xe=null;if($){const Ee=vf(f.nodeModelMatrix,n.transform);if(xe=new Float32Array(Ee),L.projection.name!=="globe"){const Pe=z.aabb.min,ze=z.aabb.max,[ke,De]=$.getOpacityForBounds(Ee,Pe[0],Pe[1],ze[0],ze[1]);fe.overrideFog=ke>=Ut||De>=Ut}}const ve=Es(n,s.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const Ie=n.getOrCreateProgram("model",fe);n.uploadCommonUniforms(A,Ie,null,xe,ve),n.renderPass!=="shadow"&&he&&he.setupShadowsFromMatrix(f.nodeModelMatrix,Ie),Ie.draw(n,A.gl.TRIANGLES,k,_,x,z.material.doubleSided?mr.disabled:mr.backCCW,Q,s.id,z.vertexBuffer,z.indexBuffer,z.segments,s.paint,n.transform.zoom,void 0,ge)}function Ch(f,n,s,p,_,x,w){let A;A=f.projection.name==="globe"?a.dg(s,f):[...s],a.a6.mat4.multiply(A,A,n.matrix);const k=a.a6.mat4.multiply([],p,A);if(n.meshes)for(const L of n.meshes){if(L.material.alphaMode!=="BLEND"){w.push({mesh:L,depth:0,modelIndex:_,worldViewProjection:k,nodeModelMatrix:A});continue}const z=a.a6.vec3.transformMat4([],L.centroid,k);z[2]>0&&x.push({mesh:L,depth:z[2],modelIndex:_,worldViewProjection:k,nodeModelMatrix:A})}if(n.children)for(const L of n.children)Ch(f,L,s,p,_,x,w)}function Qc(f,n,s,p){const _=s.shadowRenderer;if(!_)return;const x=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),A=_.calculateShadowPassMatrixFromMatrix(n),k=Um(A);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,x,Tr.disabled,w,mr.backCCW,k,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,s.transform.zoom,void 0,void 0)}function S0(f,n,s){const p=n.updateZoomBasedPaintProperties(),_=function(x,w,A){let k,L,z,U=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&U>0){const j=x.terrain,$=j.findDEMTileFor(A);$&&$.dem?k=a.di.create(j,A,$):U=0}if(U===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),U===w.validForExaggeration&&(U===0||k&&k._demTile&&k._demTile.tileID===w.validForDEMTile.id&&k._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const j in w.instancesPerModel){const $=w.instancesPerModel[j];for(let Y=0;Y<$.instancedDataArray.length;++Y){const K=(k?U*k.getElevationAt(0|$.instancedDataArray.float32[16*Y],0|$.instancedDataArray.float32[16*Y+1],!0,!0):0)+$.instancesEvaluatedElevation[Y];$.instancedDataArray.float32[16*Y+6]=K,L=L?Math.min(w.terrainElevationMin,K):K,z=z?Math.max(w.terrainElevationMax,K):K}}return w.terrainElevationMin=L||0,w.terrainElevationMax=z||0,w.validForExaggeration=U,w.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,n,s);(p||_)&&(n.uploaded=!1,n.upload(f.context))}const La={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.c9([0,0,0],[a.ab,a.ab,0])};function aw(f,n){const s=1<<f.canonical.z,p=n.getFreeCameraOptions().position,_=n.elevation,x=f.canonical.x/s,w=(f.canonical.x+1)/s,A=f.canonical.y/s,k=(f.canonical.y+1)/s;let L=n._centerAltitude;if(_){const $=_.getMinMaxForTile(f);$&&$.max>L&&(L=$.max)}const z=a.ap(p.x,x,w)-p.x,U=a.ap(p.y,A,k)-p.y,j=a.bD(L,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(z*z+U*U+j*j))}function uo(f,n,s,p,_,x,w){const A=f.context,k=f.renderPass==="shadow",L=f.shadowRenderer,z=k&&L?L.getShadowPassDepthMode():new ar(A.gl.LEQUAL,ar.ReadWrite,f.depthRangeFor3D),U=f.isTileAffectedByFog(x);if(s.meshes)for(const j of s.meshes){const $=["MODEL_POSITION_ON_GPU"],Y=[];let K,J,Q;p.instancedDataArray.length>20&&$.push("INSTANCED_ARRAYS");const fe=Es(f,n.paint.get("model-cutoff-fade-range"));if(fe.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),k&&L)K=f.getOrCreateProgram("modelDepth",{defines:$}),J=Um(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(s.matrix)),Q=L.getShadowPassColorMode();else{xf($,Y,j,f,n.lut),K=f.getOrCreateProgram("model",{defines:$,overrideFog:U});const he=j.material,xe=he.pbrMetallicRoughness,ve=n.paint.get("model-opacity"),Ie=n.paint.get("model-emissive-strength").constantOr(0);J=Zt(x.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,f,ve,xe.baseColorFactor.toRenderColor(null),he.emissiveFactor,xe.metallicFactor,xe.roughnessFactor,he,Ie,n,_),L&&(w.shadowUniformsInitialized?K.setShadowUniformValues(A,L.getShadowUniformValues()):(L.setupShadows(x.toUnwrapped(),K,"model-tile",x.overscaledZ),w.shadowUniformsInitialized=!0)),Q=fe.shouldRenderCutoff||ve<1||he.alphaMode!=="OPAQUE"?Ur.alphaBlended:Ur.unblended}f.uploadCommonUniforms(A,K,x.toUnwrapped(),null,fe);const ge=j.material.doubleSided?mr.disabled:mr.backCCW;if(p.instancedDataArray.length>20)Y.push(p.instancedDataBuffer),K.draw(f,A.gl.TRIANGLES,z,Tr.disabled,Q,ge,J,n.id,j.vertexBuffer,j.indexBuffer,j.segments,n.paint,f.transform.zoom,void 0,Y,p.instancedDataArray.length);else{const he=k?"u_instance":"u_normal_matrix";for(let xe=0;xe<p.instancedDataArray.length;++xe)J[he]=new Float32Array(p.instancedDataArray.arrayBuffer,64*xe,16),K.draw(f,A.gl.TRIANGLES,z,Tr.disabled,Q,ge,J,n.id,j.vertexBuffer,j.indexBuffer,j.segments,n.paint,f.transform.zoom,void 0,Y)}}if(s.children)for(const j of s.children)uo(f,n,j,p,_,x,w)}const sw=[1,-1,1];function Ih(f,n,s,p){if(!s.modelManager)return!0;const _=s.modelManager;if(!s.shadowRenderer)return!0;const x=s.shadowRenderer,w=n.aabb;let A=!0,k=f.maxHeight;if(k===0){let z=0;for(const U in f.instancesPerModel){const j=_.getModel(U,p);j?z=Math.max(z,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):A=!1}k=f.maxScale*z*1.41+f.maxVerticalOffset,A&&(f.maxHeight=k)}w.max[2]=k,w.min[2]+=f.terrainElevationMin,w.max[2]+=f.terrainElevationMax,a.a6.vec3.transformMat4(w.min,w.min,n.tileMatrix),a.a6.vec3.transformMat4(w.max,w.max,n.tileMatrix);const L=w.intersects(x.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=L===2),L===0}function Pn(f,n){const s=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],_=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return p===s||x===_?1:a.ap(((n-s)/(p-s)-_)/(x-_),0,1)}function en(f,n,s,p){if(n.pitch<20)return 1;const _=n.getWorldToCameraMatrix();a.a6.mat4.multiply(_,_,f);const x=a.a6.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let w=a.a6.vec4.transformMat4(a.a6.vec4.create(),x,_),A=w,k=w;x[1]=s.max[1],w=a.a6.vec4.transformMat4(a.a6.vec4.create(),x,_),A=w[1]<A[1]?w:A,k=w[1]>k[1]?w:k,x[0]=s.max[0],w=a.a6.vec4.transformMat4(a.a6.vec4.create(),x,_),A=w[1]<A[1]?w:A,k=w[1]>k[1]?w:k,x[1]=s.min[1],w=a.a6.vec4.transformMat4(a.a6.vec4.create(),x,_),A=w[1]<A[1]?w:A,k=w[1]>k[1]?w:k;const L=a.ap(p[0],0,1),z=100*n.pixelsPerMeter*a.ap(p[1],0,1),U=a.ap(p[2],0,1),j=a.a6.vec4.lerp(a.a6.vec4.create(),A,k,L),$=Math.tan(.5*n.fovX),Y=-j[2]*$;if(z===0)return j[1]<-Math.abs(Y)?U:1;const K=(-Math.abs(Y)-j[1])/z,J=(fe,ge,he)=>(1-he)*fe+he*ge,Q=a.ap(J(1,U,K),U,1);return J(1,Q,a.ap((n.pitch-20)/20,0,1))}class T0{}class sl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,s,p){{const U=this._storage.get(s.id);if(U)return U.lastUsedFrameIdx=n,U.buf}const _=p.gl,x=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(x),A=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const k=new a.dk;for(let U=0;U<x/2;U+=3){const j=A[U],$=A[U+1],Y=A[U+2];k.emplaceBack(j,$),k.emplaceBack($,Y),k.emplaceBack(Y,j)}const L=p.bindVertexArrayOES.current,z=new T0;return z.buf=new Oo(p,k),z.lastUsedFrameIdx=n,this._storage.set(s.id,z),p.bindVertexArrayOES.set(L),z.buf}update(n){for(const[s,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(s))}destroy(){for(const[n,s]of this._storage)s.buf.destroy(),this._storage.delete(n)}}class bf{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ll={symbol:function(f,n,s,p,_){if(f.renderPass!=="translucent")return;const x=Tr.disabled,w=f.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(L,z,U,j,$,Y,K){const J=z.transform,Q=$==="map",fe=Y==="map";for(const ge of L){const he=j.getTile(ge),xe=he.getBucket(U);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const ve=a.bj(xe.textSizeData,J.zoom),Ie=tl(ge,xe.getProjection(),J),Ee=J.calculatePixelsToTileUnitsMatrix(he),Pe=qr(Ie,he.tileID.canonical,fe,Q,J,xe.getProjection(),Ee),ze=xe.hasIconTextFit()&&xe.hasIconData();if(ve){const ke=Math.pow(2,J.zoom-he.tileID.overscaledZ);rw(xe,Q,fe,K,a.cS,J,Pe,ge,ke,ve,ze)}}}(p,f,s,n,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),_);const A=s.paint.get("icon-opacity").constantOr(1)!==0,k=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||k)?Sh(f,n,s,p,x,w):(A&&Sh(f,n,s,p,x,w,{onlyIcons:!0}),k&&Sh(f,n,s,p,x,w,{onlyText:!0})),n.map.showCollisionBoxes&&(pf(f,n,s,p,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),pf(f,n,s,p,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,s,p){if(f.renderPass!=="translucent")return;const _=s.paint.get("circle-opacity"),x=s.paint.get("circle-stroke-width"),w=s.paint.get("circle-stroke-opacity"),A=s.layout.get("circle-sort-key").constantOr(1)!==void 0,k=s.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;const L=f.context,z=L.gl,U=f.transform,j=f.depthModeForSublayer(0,ar.ReadOnly),$=Tr.disabled,Y=f.colorModeForDrapableLayerRenderPass(k),K=U.projection.name==="globe",J=[a.am(U.center.lng),a.at(U.center.lat)],Q=[];for(let ge=0;ge<p.length;ge++){const he=p[ge],xe=n.getTile(he),ve=xe.getBucket(s);if(!ve||ve.projection.name!==U.projection.name)continue;const Ie=ve.programConfigurations.get(s.id),Ee=a.cT(s),Pe=f.isTileAffectedByFog(he);K&&Ee.push("PROJECTION_GLOBE_VIEW"),Ee.push("DEPTH_D24"),f.terrain&&U.depthOcclusionForSymbolsAndCircles&&Ee.push("DEPTH_OCCLUSION");const ze=f.getOrCreateProgram("circle",{config:Ie,defines:Ee,overrideFog:Pe}),ke=ve.layoutVertexBuffer,De=ve.globeExtVertexBuffer,$e=ve.indexBuffer,nt=U.projection.createInversionMatrix(U,he.canonical),pt={programConfiguration:Ie,program:ze,layoutVertexBuffer:ke,globeExtVertexBuffer:De,indexBuffer:$e,uniformValues:a.cU(f,he,xe,nt,J,s),tile:xe};if(A){const rt=ve.segments.get();for(const xt of rt)Q.push({segments:new a.b1([xt]),sortKey:xt.sortKey,state:pt})}else Q.push({segments:ve.segments,sortKey:0,state:pt})}A&&Q.sort((ge,he)=>ge.sortKey-he.sortKey);const fe={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const ge of Q){const{programConfiguration:he,program:xe,layoutVertexBuffer:ve,globeExtVertexBuffer:Ie,indexBuffer:Ee,uniformValues:Pe,tile:ze}=ge.state,ke=ge.segments;f.terrain&&f.terrain.setupElevationDraw(ze,xe,fe),f.uploadCommonUniforms(L,xe,ze.tileID.toUnwrapped()),xe.draw(f,z.TRIANGLES,j,$,Y,mr.disabled,Pe,s.id,ve,Ee,ke,s.paint,U.zoom,he,[Ie])}},heatmap:function(f,n,s,p){if(s.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const _=f.context,x=_.gl,w=Tr.disabled,A=new Ur([x.ONE,x.ONE,x.ONE,x.ONE],a.bz.transparent,[!0,!0,!0,!0]);(function($,Y,K,J){const Q=$.gl,fe=Y.width*J,ge=Y.height*J;$.activeTexture.set(Q.TEXTURE1),$.viewport.set([0,0,fe,ge]);let he=K.heatmapFbo;if(!he||he&&(he.width!==fe||he.height!==ge)){he&&he.destroy();const xe=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,xe),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),he=K.heatmapFbo=$.createFramebuffer(fe,ge,!0,null),function(ve,Ie,Ee,Pe,ze,ke){const De=ve.gl;De.texImage2D(De.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?De.RGBA16F:De.RGBA,ze,ke,0,De.RGBA,ve.extRenderToTextureHalfFloat?De.HALF_FLOAT:De.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Ee)}($,0,xe,he,fe,ge)}else Q.bindTexture(Q.TEXTURE_2D,he.colorAttachment.get()),$.bindFramebuffer.set(he.framebuffer)})(_,f,s,f.transform.projection.name==="globe"?.5:.25),_.clear({color:a.bz.transparent});const k=f.transform,L=k.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?mr.frontCCW:mr.disabled,j=[a.am(k.center.lng),a.at(k.center.lat)];for(let $=0;$<p.length;$++){const Y=p[$];if(n.hasRenderableParent(Y))continue;const K=n.getTile(Y),J=K.getBucket(s);if(!J||J.projection.name!==k.projection.name)continue;const Q=f.isTileAffectedByFog(Y),fe=J.programConfigurations.get(s.id),ge=f.getOrCreateProgram("heatmap",{config:fe,defines:z,overrideFog:Q}),{zoom:he}=f.transform;f.terrain&&f.terrain.setupElevationDraw(K,ge),f.uploadCommonUniforms(_,ge,Y.toUnwrapped());const xe=k.projection.createInversionMatrix(k,Y.canonical);ge.draw(f,x.TRIANGLES,ar.disabled,w,A,U,Qb(f,Y,K,xe,j,he,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,f.transform.zoom,fe,L?[J.globeExtVertexBuffer]:null)}_.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(_,x){const w=_.context,A=w.gl,k=x.heatmapFbo;if(!k)return;w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,k.colorAttachment.get()),w.activeTexture.set(A.TEXTURE1);let L=x.colorRampTexture;L||(L=x.colorRampTexture=new a.T(w,x.colorRamp,A.RGBA8)),L.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,A.TRIANGLES,ar.disabled,Tr.disabled,_.colorModeForRenderPass(),mr.disabled,((z,U,j,$)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(f,s))},line:function(f,n,s,p){if(f.renderPass!=="translucent")return;const _=s.paint.get("line-opacity"),x=s.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const w=s.paint.get("line-emissive-strength"),A=s.paint.get("line-occlusion-opacity"),k=f.context,L=k.gl,z=s.layout.get("line-z-offset"),U=!z.isConstant()||!!z.constantOr(0),j=U?new ar(f.depthOcclusion?L.GREATER:L.LEQUAL,ar.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,ar.ReadOnly),$=f.colorModeForDrapableLayerRenderPass(w),Y=f.terrain&&f.terrain.renderingToTexture,K=Y?1:a.q.devicePixelRatio,J=s.paint.get("line-dasharray"),Q=J.constantOr(1),fe=s.layout.get("line-cap"),ge=J.constantOr(null),he=fe.constantOr(null),xe=s.paint.get("line-pattern"),ve=xe.constantOr(1),Ie=xe.constantOr(null),Ee=s.paint.get("line-opacity").constantOr(1);let Pe=!ve&&Ee!==1||f.depthOcclusion&&A>0&&A<1;const ze=s.paint.get("line-gradient"),ke=ve?"linePattern":"line",De=a.cV(s);let $e;if(Y&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Pe=!1),A!==0&&f.depthOcclusion){const pt=s.paint._values["line-opacity"];pt&&pt.value&&pt.value.kind==="constant"?$e=pt.value:a.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(f.forceTerrainMode=!0),!U&&A!==0&&f.terrain&&!Y)return void a.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const nt=Pe&&U?f.stencilModeFor3D():Tr.disabled;for(const pt of p){const rt=n.getTile(pt);if(ve&&!rt.patternsLoaded())continue;const xt=rt.getBucket(s);if(!xt)continue;f.prepareDrawTile();const We=xt.programConfigurations.get(s.id),ut=f.isTileAffectedByFog(pt),at=f.getOrCreateProgram(ke,{config:We,defines:U?[...De,"ELEVATED"]:De,overrideFog:ut});if(Ie&&rt.imageAtlas){const kt=rt.imageAtlas.patternPositions[Ie.toString()];kt&&We.setConstantPatternPositions(kt)}if(!ve&&ge&&he&&rt.lineAtlas){const kt=rt.lineAtlas.getDash(ge,he);kt&&We.setConstantPatternPositions(kt)}let[wt,Et]=s.paint.get("line-trim-offset");(he==="round"||he==="square")&&wt!==Et&&(wt===0&&(wt-=1),Et===1&&(Et+=1));const ft=Y?pt.projMatrix:null,_t=ve?a.cW(f,rt,s,ft,K,[wt,Et]):a.cX(f,rt,s,ft,xt.lineClipsArray.length,K,[wt,Et]);if(ze){const kt=xt.gradients[s.id];let Vt=kt.texture;if(s.gradientVersion!==kt.version){let dr=256;if(s.stepInterpolant){const Jt=n.getSource().maxzoom,lr=pt.canonical.z===Jt?Math.ceil(1<<f.transform.maxZoom-pt.canonical.z):1;dr=a.ap(a.cY(xt.maxLineLength/a.ab*1024*lr),256,k.maxTextureSize)}kt.gradient=a.cZ({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:dr,image:kt.gradient||void 0,clips:xt.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new a.T(k,kt.gradient,L.RGBA8),kt.version=s.gradientVersion,Vt=kt.texture}k.activeTexture.set(L.TEXTURE1),Vt.bind(s.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}Q&&(k.activeTexture.set(L.TEXTURE0),rt.lineAtlasTexture&&rt.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),We.updatePaintBuffers()),ve&&(k.activeTexture.set(L.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),We.updatePaintBuffers()),U&&f.terrain.setupElevationDraw(rt,at),f.uploadCommonUniforms(k,at,pt.toUnwrapped());const ir=kt=>{$e!=null&&($e.value=Ee*A),at.draw(f,L.TRIANGLES,j,kt,$,mr.disabled,_t,s.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,s.paint,f.transform.zoom,We,[xt.layoutVertexBuffer2,xt.patternVertexBuffer,xt.zOffsetVertexBuffer]),$e!=null&&($e.value=Ee)};if(Pe&&!U){const kt=f.stencilModeForClipping(pt).ref;kt===0&&Y&&k.clear({stencil:0});const Vt={func:L.EQUAL,mask:255};_t.u_alpha_discard_threshold=.8,ir(new Tr(Vt,kt,255,L.KEEP,L.KEEP,L.INVERT)),_t.u_alpha_discard_threshold=0,ir(new Tr(Vt,kt,255,L.KEEP,L.KEEP,L.KEEP))}else Pe&&U&&(_t.u_alpha_discard_threshold=.001),ir(U?nt:f.stencilModeForClipping(pt))}Pe&&(f.resetStencilClippingMasks(),Y&&k.clear({stencil:0})),A===0||f.depthOcclusion||Y||f.layersWithOcclusionOpacity.push(f.currentLayer),U&&(f.forceTerrainMode=!1)},fill:function(f,n,s,p){const _=s.paint.get("fill-color"),x=s.paint.get("fill-opacity"),w=s.is3D(),A=new ar(f.context.gl.LEQUAL,ar.ReadWrite,f.depthRangeFor3D);if(x.constantOr(1)===0)return;const k=s.paint.get("fill-emissive-strength"),L=f.colorModeForDrapableLayerRenderPass(k),z=s.paint.get("fill-pattern"),U=f.opaquePassEnabledForLayer()&&!z.constantOr(1)&&_.constantOr(a.bz.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===U){const j=w?A:f.depthModeForSublayer(1,f.renderPass==="opaque"?ar.ReadWrite:ar.ReadOnly);mf(f,n,s,p,j,L,!1)}if(!w&&f.renderPass==="translucent"&&s.paint.get("fill-antialias")){const j=w?A:f.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,ar.ReadOnly);mf(f,n,s,p,j,L,!0)}},"fill-extrusion":function(f,n,s,p){const _=s.paint.get("fill-extrusion-opacity"),x=f.context,w=x.gl,A=f.terrain,k=A&&A.renderingToTexture;if(_===0)return;const L=f.conflationActive&&f.style.isLayerClipped(s,n.getSource()),z=f.style.order.indexOf(s.fqid);if(L&&function(U,j,$,Y,K){for(const J of Y){const Q=j.getTile(J).getBucket($);Q&&(Q.updateReplacement(J,U.replacementSource,K),Q.uploadCentroid(U.context))}}(f,n,s,p,z),A||L)for(const U of p){const j=n.getTile(U).getBucket(s);j&&al(f.context,n,U,j,s,A,L)}if(f.renderPass==="shadow"&&f.shadowRenderer){const U=f.shadowRenderer;if(A&&_<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.a4)return;const j=U.getShadowPassDepthMode(),$=U.getShadowPassColorMode();Yc(f,n,s,p,j,Tr.disabled,$,L)}else if(f.renderPass==="translucent"){const U=!s.paint.get("fill-extrusion-pattern").constantOr(1),j=s.paint.get("fill-extrusion-color").constantOr(a.bz.white);if(!k&&j.a!==0){const $=new ar(f.context.gl.LEQUAL,ar.ReadWrite,f.depthRangeFor3D);_===1&&U?Yc(f,n,s,p,$,Tr.disabled,Ur.unblended,L):(Yc(f,n,s,p,$,Tr.disabled,Ur.disabled,L),Yc(f,n,s,p,$,f.stencilModeFor3D(),f.colorModeForRenderPass(),L),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&U&&(!A&&f.transform.projection.name!=="globe"||k)){const $=s.paint.get("fill-extrusion-opacity"),Y=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),K=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),Q=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(s.lut).toArray01().slice(0,3),fe=Y>0&&K>0,ge=J>0,he=(ve,Ie,Ee)=>(1-Ee)*ve+Ee*Ie,xe=ve=>{const Ie=f.depthModeForSublayer(1,ar.ReadOnly,w.LEQUAL,!0),Ee=s.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pe=he(.1,3,Ee),ze=f._showOverdrawInspector;if(!ze){const ke=new Tr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),De=new Ur([w.ONE,w.ONE,w.ONE,w.ONE],a.bz.transparent,[!1,!1,!1,!0],w.MIN);Ni(f,n,s,p,Ie,ke,De,mr.disabled,ve,"sdf",$,Y,K,J,Q,Pe,L,!1)}{const ke=ze?Tr.disabled:new Tr({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),De=ze?f.colorModeForRenderPass():new Ur([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],a.bz.transparent,[!0,!0,!0,!0]);Ni(f,n,s,p,Ie,ke,De,mr.disabled,ve,"color",$,Y,K,J,Q,Pe,L,!1)}};if(k){const ve=(Ie,Ee,Pe)=>{const ze=f.depthModeForSublayer(1,ar.ReadOnly,w.LEQUAL,!1),ke=s.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=he(.1,3,ke);{const $e=new Ur([w.ONE,w.ONE,w.ONE,w.ONE],a.bz.transparent,[!1,!1,!1,!0]);Ni(f,n,s,p,ze,Tr.disabled,$e,mr.disabled,Ie,"clear",$,Y,K,J,Q,De,L,Ee)}{const $e=new Tr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),nt=new Ur([w.ONE,w.ONE,w.ONE,w.ONE],a.bz.transparent,[!1,!1,!1,!0],w.MIN);Ni(f,n,s,p,ze,$e,nt,mr.disabled,Ie,"sdf",$,Y,K,J,Q,De,L,Ee)}{const $e=Ie?w.ZERO:w.ONE_MINUS_DST_ALPHA,nt=new Tr({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),pt=new Ur([$e,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],a.bz.transparent,[!0,!0,!0,!0]);Ni(f,n,s,p,ze,nt,pt,mr.disabled,Ie,"color",$,Y,K,J,Q,De,L,Ee)}{const $e=new Ur([w.ONE,w.ONE,w.ONE,Ie?w.ZERO:w.ONE],a.bz.transparent,[!1,!1,!1,!0],Ie?w.FUNC_ADD:w.MAX);Ni(f,n,s,p,ze,Tr.disabled,$e,mr.disabled,Ie,"clear",$,Y,K,J,Q,De,L,Ee,Pe)}};if(fe||ge){let Ie;if(f.prepareDrawTile(),A){const Ee=A.drapeBufferSize[0],Pe=A.drapeBufferSize[1];Ie=A.framebufferCopyTexture,Ie&&(!Ie||Ie.size[0]===Ee&&Ie.size[1]===Pe)||(Ie&&Ie.destroy(),Ie=A.framebufferCopyTexture=new a.T(x,new a.r({width:Ee,height:Pe}),w.RGBA8)),Ie.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,Ee,Pe,0)}fe&&ve(!0,!1,Ie),ge&&ve(!1,!0,Ie)}}else fe&&xe(!0),ge&&xe(!1),(fe||ge)&&f.resetStencilClippingMasks()}}},hillshade:function(f,n,s,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const _=f.context,x=f.terrain&&f.terrain.renderingToTexture,[w,A]=f.renderPass!=="translucent"||x?[{},p]:f.stencilConfigForOverlap(p);for(const k of A){const L=n.getTile(k);if(L.needsHillshadePrepare&&f.renderPass==="offscreen")ph(f,L,s);else if(f.renderPass==="translucent"){const z=f.depthModeForSublayer(0,ar.ReadOnly),U=s.paint.get("hillshade-emissive-strength"),j=f.colorModeForDrapableLayerRenderPass(U),$=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(k):w[k.overscaledZ];Xd(f,k,L,s,z,$,j)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,s,p,_,x){if(f.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const w=f.transform.projection.name==="globe",A=s.paint.get("raster-elevation")!==0,k=A&&w;if(f.renderElevatedRasterBackface&&!k)return;const L=f.context,z=L.gl,U=n.getSource(),j=function(ve,Ie,Ee,Pe){const ze=Ie.paint.get("raster-color"),ke=ve.type==="raster-array",De=[],$e=Ie.paint.get("raster-resampling"),nt=Ie.paint.get("raster-color-mix");let pt=Ie.paint.get("raster-color-range");const rt=[nt[0],nt[1],nt[2],0],xt=nt[3];let We=$e==="nearest"?Pe.NEAREST:Pe.LINEAR;if(ke&&(De.push("RASTER_ARRAY"),ze||De.push("RASTER_COLOR"),$e==="linear"&&De.push("RASTER_ARRAY_LINEAR"),We=Pe.NEAREST,!pt&&ve.rasterLayers)){const ut=ve.rasterLayers.find(({id:at})=>at===Ie.sourceLayer);ut&&ut.fields&&ut.fields.range&&(pt=ut.fields.range)}if(pt=pt||[0,1],ze){De.push("RASTER_COLOR"),Ee.activeTexture.set(Pe.TEXTURE2),Ie.updateColorRamp(pt);let ut=Ie.colorRampTexture;ut||(ut=Ie.colorRampTexture=new a.T(Ee,Ie.colorRamp,Pe.RGBA8)),ut.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}return{mix:rt,range:pt,offset:xt,defines:De,resampling:We}}(U,s,L,z);if(U instanceof a.aD&&!p.length&&!w)return;const $=s.paint.get("raster-emissive-strength"),Y=f.colorModeForDrapableLayerRenderPass($),K=f.terrain&&f.terrain.renderingToTexture,J=!f.options.moving,Q=s.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(U instanceof a.aD&&!p.length&&(U.onNorthPole||U.onSouthPole)){const ve=A?f.stencilModeFor3D():Tr.disabled;return void Lo(!!U.onNorthPole,null,f,n,s,$,j,mr.disabled,ve)}if(!p.length)return;const[fe,ge]=U instanceof a.aD||K?[{},p]:f.stencilConfigForOverlap(p),he=ge[ge.length-1].overscaledZ;k&&j.defines.push("PROJECTION_GLOBE_VIEW"),A&&j.defines.push("RENDER_CUTOFF");const xe=(ve,Ie,Ee)=>{for(const Pe of ve){const ze=Pe.toUnwrapped(),ke=n.getTile(Pe);if(K&&(!ke||!ke.hasData()))continue;L.activeTexture.set(z.TEXTURE0);const De=gf(ke,U,s,j);if(!De||!De.texture)continue;const{texture:$e,mix:nt,offset:pt,tileSize:rt,buffer:xt}=De;let We,ut;K?(We=ar.disabled,ut=Pe.projMatrix):A?(We=new ar(z.LEQUAL,ar.ReadWrite,f.depthRangeFor3D),ut=w?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(ze,J)):(We=f.depthModeForSublayer(Pe.overscaledZ-he,s.paint.get("raster-opacity")===1?ar.ReadWrite:ar.ReadOnly,z.LESS),ut=f.transform.calculateProjMatrix(ze,J));const at=f.terrain&&K?f.terrain.stencilModeForRTTOverlap(Pe):fe[Pe.overscaledZ],wt=x?0:s.paint.get("raster-fade-duration");ke.registerFadeDuration(wt);const Et=n.findLoadedParent(Pe,0),ft=nf(ke,Et,n,f.transform,wt);let _t,ir;f.terrain&&f.terrain.prepareDrawTile(),L.activeTexture.set(z.TEXTURE0),$e.bind(Q,z.CLAMP_TO_EDGE),L.activeTexture.set(z.TEXTURE1),Et?(Et.texture&&Et.texture.bind(Q,z.CLAMP_TO_EDGE),_t=Math.pow(2,Et.tileID.overscaledZ-ke.tileID.overscaledZ),ir=[ke.tileID.canonical.x*_t%1,ke.tileID.canonical.y*_t%1]):$e.bind(Q,z.CLAMP_TO_EDGE),$e.useMipmap&&L.extTextureFilterAnisotropic&&f.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const kt=f.transform;let Vt;const dr=A?qn(kt):[0,0,0,0];let Jt,lr,Or,Pr,pn,xn=0;if(k&&U instanceof a.aD&&U.coordinates.length>3)Jt=Float32Array.from(a.b5(a.cC(new a.bP(0,0,0)))),lr=Float32Array.from(kt.globeMatrix),Or=Float32Array.from(a.cy(kt)),Pr=[a.am(kt.center.lng),a.at(kt.center.lat)],Vt=U.elevatedGlobePerspectiveTransform,pn=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const $r=a.cz(Pe.canonical);xn=a.cA($r.getCenter().lat),Jt=Float32Array.from(a.b5(a.cC(Pe.canonical))),lr=Float32Array.from(kt.globeMatrix),Or=Float32Array.from(a.cy(kt)),Pr=[a.am(kt.center.lng),a.at(kt.center.lat)],Vt=[0,0],pn=Float32Array.from(a.cB(Pe.canonical,$r,xn,kt.worldSize/kt._pixelsPerMercatorPixel))}else Vt=U instanceof a.aD?U.perspectiveTransform:[0,0],Jt=new Float32Array(16),lr=new Float32Array(9),Or=new Float32Array(16),Pr=[0,0],pn=new Float32Array(9);const Cn=bh(ut,Jt,lr,Or,pn,ir||[0,0],a.a9(f.transform.zoom),Pr,dr,_t||1,ft,s,Vt,A?s.paint.get("raster-elevation"):0,2,nt,pt,j.range,rt,xt,$),ha=f.isTileAffectedByFog(Pe),si=f.getOrCreateProgram("raster",{defines:j.defines,overrideFog:ha});if(f.uploadCommonUniforms(L,si,ze),U instanceof a.aD){const $r=U.elevatedGlobeVertexBuffer,yn=U.elevatedGlobeIndexBuffer;if(K||!w)U.boundsBuffer&&U.boundsSegments&&si.draw(f,z.TRIANGLES,We,Tr.disabled,Y,mr.disabled,Cn,s.id,U.boundsBuffer,f.quadTriangleIndexBuffer,U.boundsSegments);else if($r&&yn){const zn=kt.zoom<=a.c2?U.elevatedGlobeSegments:U.getSegmentsForLongitude(kt.center.lng);zn&&si.draw(f,z.TRIANGLES,We,Tr.disabled,Y,Ie,Cn,s.id,$r,yn,zn)}}else if(k){We=new ar(z.LEQUAL,ar.ReadOnly,f.depthRangeFor3D);const $r=f.globeSharedBuffers;if($r){const[yn,zn,_n]=$r.getGridBuffers(xn,!1);si.draw(f,z.TRIANGLES,We,Ee||at,f.colorModeForRenderPass(),Ie,Cn,s.id,yn,zn,_n)}}else{const{tileBoundsBuffer:$r,tileBoundsIndexBuffer:yn,tileBoundsSegments:zn}=f.getTileBoundsBuffers(ke);si.draw(f,z.TRIANGLES,We,at,Y,mr.disabled,Cn,s.id,$r,yn,zn)}}if(!(U instanceof a.aD)&&k)for(const Pe of ve){const ze=Pe.canonical.y===(1<<Pe.canonical.z)-1;Pe.canonical.y===0&&Lo(!0,Pe,f,n,s,$,j,Ie,Ee||Tr.disabled),ze&&Lo(!1,Pe,f,n,s,$,j,Ie===mr.frontCW?mr.backCW:mr.frontCW,Ee||Tr.disabled)}};k?xe(ge,f.renderElevatedRasterBackface?mr.backCW:mr.frontCW,f.stencilModeFor3D()):xe(ge,mr.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,s,p,_,x){f.renderPass==="offscreen"&&function(w,A,k,L){if(!L.length)return;const z=w.context,U=z.gl,j=A.getSource();if(!(j instanceof Tc))return;const $=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let Y=k.particlePositionRGBAImage;if(!Y||Y.width!==$){const ge=function(he){const xe=he*he,ve=new Uint8Array(4*xe),Ie=function(Pe){return Pe|=0,Pe=Math.imul(2747636419^Pe,2654435769),Pe=Math.imul(Pe^Pe>>>16,2654435769),((Pe=Math.imul(Pe^Pe>>>16,2654435769))>>>0)/4294967296},Ee=1/1.1;for(let Pe=0;Pe<xe;Pe++){const ze=Ee*(Ie(2*Pe+0)+rs),ke=Ee*(Ie(2*Pe+1)+rs),De=255*ze%1,$e=255*ke%1,nt=De,pt=ke-$e/255,rt=$e;ve[4*Pe+0]=255*(ze-De/255),ve[4*Pe+1]=255*nt,ve[4*Pe+2]=255*pt,ve[4*Pe+3]=255*rt}return ve}($);Y=k.particlePositionRGBAImage=new a.r({width:$,height:$},ge)}let K=k.particleFramebuffer;K?K.width!==$&&(K.destroy(),K=k.particleFramebuffer=z.createFramebuffer($,$,!0,null)):K=k.particleFramebuffer=z.createFramebuffer($,$,!0,null);const J=[];for(const ge of L){const he=A.getTile(ge);if(!(he instanceof kd))continue;const xe=x0(he,j,k);if(!xe)continue;const ve=[he.tileSize,he.tileSize];let Ie=k.tileFramebuffer;Ie||(Ie=k.tileFramebuffer=z.createFramebuffer(ve[0],ve[1],!0,null));let Ee=he.rasterParticleState;Ee||(Ee=he.rasterParticleState=new v0(z,ge,ve,Y));const Pe=Ee.update(k.lastInvalidatedAt);Ee.particleTextureDimension!==$&&Ee.updateParticleTexture(ge,Y);const ze=Ee.targetColorTexture;Ee.targetColorTexture=Ee.backgroundColorTexture,Ee.backgroundColorTexture=ze;const ke=Ee.particleTexture0;Ee.particleTexture0=Ee.particleTexture1,Ee.particleTexture1=ke,J.push([ge,xe,Ee,Pe])}if(J.length===0)return;const Q=a.q.now(),fe=k.previousDrawTimestamp?.001*(Q-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=Q,k.hasColorMap()){z.activeTexture.set(U.TEXTURE0+2);let ge=k.colorRampTexture;ge||(ge=k.colorRampTexture=new a.T(z,k.colorRamp,U.RGBA8)),ge.bind(U.LINEAR,U.CLAMP_TO_EDGE)}z.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(ge,he,xe){const ve=ge.context,Ie=ve.gl,Ee=he.tileFramebuffer;ve.activeTexture.set(Ie.TEXTURE0);const Pe={u_texture:0,u_opacity:1.05*(ke=he.paint.get("raster-particle-fade-opacity-factor"))/(ke+.05)},ze=ge.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ke;for(const De of xe){const[,,$e,nt]=De;Ee.colorAttachment.set($e.targetColorTexture.texture),ve.viewport.set([0,0,Ee.width,Ee.height]),ve.clear({color:a.bz.transparent}),nt&&($e.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),ze.draw(ge,Ie.TRIANGLES,ar.disabled,Tr.disabled,Ur.alphaBlended,mr.disabled,Pe,he.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments))}}(w,k,J),function(ge,he,xe,ve){const Ie=ge.context,Ee=Ie.gl,Pe=xe.tileFramebuffer,ze=ge.transform.projection.name==="globe",ke=xe.paint.get("raster-particle-max-speed");for(const De of ve){const[$e,nt,pt]=De;Ie.activeTexture.set(Ee.TEXTURE0+0),nt.texture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Pe.colorAttachment.set(pt.targetColorTexture.texture);const rt=ge.getOrCreateProgram("rasterParticleDraw",{defines:nt.defines,overrideFog:!1});Ie.activeTexture.set(Ee.TEXTURE0+1);const xt=nt.scalarData?[]:[0,1,2,3].map(at=>a.c$[at]($e));xt.push($e);const We=$e.canonical.x,ut=$e.canonical.y;for(const at of xt){const wt=he.getTile(ze?at.wrapped():at);if(!wt)continue;const Et=wt.rasterParticleState;if(!Et)continue;const ft=at.canonical.x+(1<<at.canonical.z)*(at.wrap-$e.wrap),_t=at.canonical.y;Et.particleTexture0.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);const ir=cf(1,Et.particleTexture0.size[0],[ft-We,_t-ut],0,nt.texture.size,2,ke,nt.textureOffset,nt.scale,nt.offset);rt.draw(ge,Ee.POINTS,ar.disabled,Tr.disabled,Ur.alphaBlended,mr.disabled,ir,xe.id,Et.particleIndexBuffer,void 0,Et.particleSegment)}}}(w,A,k,J),z.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(ge,he,xe,ve){const Ie=ge.context,Ee=Ie.gl,Pe=he.paint.get("raster-particle-max-speed"),ze=ve*he.paint.get("raster-particle-speed-factor")*.15,ke=function($e){return Math.pow($e,6)}(.01+1*he.paint.get("raster-particle-reset-rate-factor")),De=he.particleFramebuffer;Ie.viewport.set([0,0,De.width,De.height]);for(const $e of xe){const[,nt,pt]=$e;Ie.activeTexture.set(Ee.TEXTURE0+0),nt.texture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Ie.activeTexture.set(Ee.TEXTURE0+1);const rt=pt.particleTexture0;rt.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);const xt=uf(1,rt.size[0],0,nt.texture.size,Pe,ze,ke,nt.textureOffset,nt.scale,nt.offset);De.colorAttachment.set(pt.particleTexture1.texture),Ie.clear({color:a.bz.transparent}),ge.getOrCreateProgram("rasterParticleUpdate",{defines:nt.defines}).draw(ge,Ee.TRIANGLES,ar.disabled,Tr.disabled,Ur.unblended,mr.disabled,xt,he.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments)}}(w,k,J,fe)}(f,n,s,p),f.renderPass==="translucent"&&(function(w,A,k,L,z){const U=w.context,j=U.gl,$=A.getSource().tileSize,Y=5*(1-a.a7(a.bU,a.bU+1,w.transform.zoom))*$+k.paint.get("raster-particle-elevation"),K=!w.options.moving,J=w.transform.projection.name==="globe";if(!L.length)return;const[Q,fe]=w.stencilConfigForOverlap(L),ge=[];J&&ge.push("PROJECTION_GLOBE_VIEW");const he=w.stencilModeFor3D();for(const xe of fe){const ve=xe.toUnwrapped(),Ie=A.getTile(xe);if(!Ie.rasterParticleState)continue;const Ee=Ie.rasterParticleState,Pe=100;Ie.registerFadeDuration(Pe);const ze=A.findLoadedParent(xe,0),ke=nf(Ie,ze,A,w.transform,Pe);let De,$e;w.terrain&&w.terrain.prepareDrawTile(),U.activeTexture.set(j.TEXTURE0),Ee.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE1),ze&&ze.rasterParticleState?(ze.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),De=Math.pow(2,ze.tileID.overscaledZ-Ie.tileID.overscaledZ),$e=[Ie.tileID.canonical.x*De%1,Ie.tileID.canonical.y*De%1]):Ee.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const nt=J?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(ve,K),pt=w.transform,rt=b0(pt),xt=a.cz(xe.canonical),We=a.cA(xt.getCenter().lat);let ut,at,wt,Et,ft;J?(ut=Float32Array.from(a.b5(a.cC(xe.canonical))),at=Float32Array.from(pt.globeMatrix),wt=Float32Array.from(a.cy(pt)),Et=[a.am(pt.center.lng),a.at(pt.center.lat)],ft=Float32Array.from(a.cB(xe.canonical,xt,We,pt.worldSize/pt._pixelsPerMercatorPixel))):(ut=new Float32Array(16),at=new Float32Array(9),wt=new Float32Array(16),Et=[0,0],ft=new Float32Array(9));const _t=m0(nt,ut,at,wt,ft,$e||[0,0],a.a9(w.transform.zoom),Et,rt,De||1,ke,Y),ir=w.isTileAffectedByFog(xe),kt=w.getOrCreateProgram("rasterParticle",{defines:ge,overrideFog:ir});if(w.uploadCommonUniforms(U,kt,ve),J){const Vt=new ar(j.LEQUAL,ar.ReadOnly,w.depthRangeFor3D),dr=0,Jt=w.globeSharedBuffers;if(Jt){const[lr,Or,Pr]=Jt.getGridBuffers(We,dr!==0);kt.draw(w,j.TRIANGLES,Vt,he,Ur.alphaBlended,w.renderElevatedRasterBackface?mr.frontCCW:mr.backCCW,_t,k.id,lr,Or,Pr)}}else{const Vt=w.depthModeForSublayer(0,ar.ReadOnly),dr=Q[xe.overscaledZ],{tileBoundsBuffer:Jt,tileBoundsIndexBuffer:lr,tileBoundsSegments:Or}=w.getTileBoundsBuffers(Ie);kt.draw(w,j.TRIANGLES,Vt,dr,Ur.alphaBlended,mr.disabled,_t,k.id,Jt,lr,Or)}}w.resetStencilClippingMasks()}(f,n,s,p),f.style.map.triggerRepaint())},background:function(f,n,s,p){const _=s.paint.get("background-color"),x=s.paint.get("background-opacity"),w=s.paint.get("background-emissive-strength"),A=s.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const k=f.context,L=k.gl,z=f.transform,U=z.tileSize,j=s.paint.get("background-pattern");let $;if(j!==void 0&&(j===null||($=f.imageManager.getPattern(j.toString(),s.scope,f.style.getLut(s.scope)),!$)))return;const Y=!j&&_.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const K=Tr.disabled,J=f.depthModeForSublayer(0,Y==="opaque"?ar.ReadWrite:ar.ReadOnly),Q=f.colorModeForDrapableLayerRenderPass(w),fe=j?"backgroundPattern":"background";let ge,he=p;if(he||(ge=f.getBackgroundTiles(),he=Object.values(ge).map(xe=>xe.tileID)),j&&(k.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context,s.scope)),A){const xe=f.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(a.a6.mat4.identity([])),Ie=new a.aA(0,0,0,0,0),Ee=j?Wl(ve,w,x,f,0,s.scope,$,A,{tileID:Ie,tileSize:U}):g0(ve,w,x,_.toRenderColor(s.lut));xe.draw(f,L.TRIANGLES,J,K,Q,mr.disabled,Ee,s.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const xe of he){const ve=f.isTileAffectedByFog(xe),Ie=f.getOrCreateProgram(fe,{overrideFog:ve}),Ee=xe.toUnwrapped(),Pe=p?xe.projMatrix:f.transform.calculateProjMatrix(Ee);f.prepareDrawTile();const ze=n?n.getTile(xe):ge?ge[xe.key]:new Qa(xe,U,z.zoom,f),ke=j?Wl(Pe,w,x,f,0,s.scope,$,A,{tileID:xe,tileSize:U}):g0(Pe,w,x,_.toRenderColor(s.lut));f.uploadCommonUniforms(k,Ie,Ee);const{tileBoundsBuffer:De,tileBoundsIndexBuffer:$e,tileBoundsSegments:nt}=f.getTileBoundsBuffers(ze);Ie.draw(f,L.TRIANGLES,J,K,Q,mr.disabled,ke,s.id,De,$e,nt)}},sky:function(f,n,s){const p=f._atmosphere?a.a9(f.transform.zoom):1,_=s.paint.get("sky-opacity")*p;if(_===0)return;const x=f.context,w=s.paint.get("sky-type"),A=new ar(x.gl.LEQUAL,ar.ReadOnly,[0,1]),k=f.frameCounter/1e3%1;w==="atmosphere"?f.renderPass==="offscreen"?s.needsSkyboxCapture(f)&&(function(L,z,U,j){const $=L.context,Y=$.gl;let K=z.skyboxFbo;if(!K){K=z.skyboxFbo=$.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Zm($),z.skyboxTexture=$.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,z.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ge=0;ge<6;++ge)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(K.framebuffer),$.viewport.set([0,0,32,32]);const J=z.getCenter(L,!0),Q=L.getOrCreateProgram("skyboxCapture"),fe=new Float64Array(16);a.a6.mat4.identity(fe),a.a6.mat4.rotateY(fe,fe,.5*-Math.PI),Hl(L,z,Q,fe,J,0),a.a6.mat4.identity(fe),a.a6.mat4.rotateY(fe,fe,.5*Math.PI),Hl(L,z,Q,fe,J,1),a.a6.mat4.identity(fe),a.a6.mat4.rotateX(fe,fe,.5*-Math.PI),Hl(L,z,Q,fe,J,2),a.a6.mat4.identity(fe),a.a6.mat4.rotateX(fe,fe,.5*Math.PI),Hl(L,z,Q,fe,J,3),a.a6.mat4.identity(fe),Hl(L,z,Q,fe,J,4),a.a6.mat4.identity(fe),a.a6.mat4.rotateY(fe,fe,Math.PI),Hl(L,z,Q,fe,J,5),$.viewport.set([0,0,L.width,L.height])}(f,s),s.markSkyboxValid(f)):f.renderPass==="sky"&&function(L,z,U,j,$){const Y=L.context,K=Y.gl,J=L.transform,Q=L.getOrCreateProgram("skybox");Y.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,z.skyboxTexture);const fe=((ge,he,xe,ve,Ie)=>({u_matrix:ge,u_sun_direction:he,u_cubemap:0,u_opacity:ve,u_temporal_offset:Ie}))(J.skyboxMatrix,z.getCenter(L,!1),0,j,$);L.uploadCommonUniforms(Y,Q),Q.draw(L,K.TRIANGLES,U,Tr.disabled,L.colorModeForRenderPass(),mr.backCW,fe,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,s,A,_,k):w==="gradient"&&f.renderPass==="sky"&&function(L,z,U,j,$){const Y=L.context,K=Y.gl,J=L.transform,Q=L.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Zm(Y)),Y.activeTexture.set(K.TEXTURE0);let fe=z.colorRampTexture;fe||(fe=z.colorRampTexture=new a.T(Y,z.colorRamp,K.RGBA8)),fe.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ge=((he,xe,ve,Ie,Ee)=>({u_matrix:he,u_color_ramp:0,u_center_direction:xe,u_radius:a.bB(ve),u_opacity:Ie,u_temporal_offset:Ee}))(J.skyboxMatrix,z.getCenter(L,!1),z.paint.get("sky-gradient-radius"),j,$);L.uploadCommonUniforms(Y,Q),Q.draw(L,K.TRIANGLES,U,Tr.disabled,L.colorModeForRenderPass(),mr.backCW,ge,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,s,A,_,k)},debug:function(f,n,s,p,_,x){for(let w=0;w<s.length;w++)if(_){const L=new a.bz(p.r*.8,p.g*.8,p.b*.8,1);ka(f,n,s[w],p,-1,-1,x),ka(f,n,s[w],p,-1,1,x),ka(f,n,s[w],p,1,1,x),ka(f,n,s[w],p,1,-1,x),ka(f,n,s[w],L,0,0,x)}else ka(f,n,s[w],p,0,0,x)},custom:function(f,n,s,p){const _=f.context,x=s.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&s.isDraped(n)){if(f.renderPass==="offscreen"){const w=x.prerender;if(w){if(f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;w.call(x,_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.a9(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else w.call(x,_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const A=x.renderToTile;if(A){const k=p[0].canonical,L=new a.a5(k.x+p[0].wrap*(1<<k.z),k.y,k.z);_.setDepthMode(ar.disabled),_.setStencilMode(Tr.disabled),_.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),A.call(x,_.gl,L),_.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),_.setStencilMode(Tr.disabled);const w=x.renderingMode==="3d"?new ar(f.context.gl.LEQUAL,ar.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,ar.ReadOnly);if(_.setDepthMode(w),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;x.render(_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.a9(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else x.render(_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState(),_.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,s,p){if(f.renderPass==="opaque")return;const _=s.paint.get("model-opacity");if(_===0)return;const x=s.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&_<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof a.a4))return;const w=f.shadowRenderer,A=s.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,A||(w.enabled=!1));const k=()=>{w&&(w.useNormalOffset=!0,A||(w.enabled=!0))},L=n.getSource();if(f.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(Q,fe,ge,he,xe){const ve=Q.transform;if(ve.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const Ie=ve.getFreeCameraOptions().position;if(!Q.modelManager)return;const Ee=Q.modelManager;ge.modelManager=Ee;const Pe=Q.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=ge._unevaluatedLayout._values["model-id"],ke={...ge.layout.get("model-id").parameters},De=Q.style.order.indexOf(ge.fqid);for(const $e of he){const nt=fe.getTile($e).getBucket(ge);if(!nt||nt.projection.name!==ve.projection.name)continue;const pt=nt.getModelUris();pt&&!nt.modelsRequested&&(Ee.addModelsFromBucket(pt,xe),nt.modelsRequested=!0);const rt=aw($e,ve);ke.zoom=rt;const xt=ze.possiblyEvaluate(ke);if(S0(Q,nt,$e),La.shadowUniformsInitialized=!1,La.useSingleShadowCascade=!!Pe&&Pe.getMaxCascadeForTile($e.toUnwrapped())===0,Q.renderPass==="shadow"&&Pe){if(Q.currentShadowCascade===1&&nt.isInsideFirstShadowMapFrustum)continue;const at=ve.calculatePosMatrix($e.toUnwrapped(),ve.worldSize);if(La.tileMatrix.set(at),La.shadowTileMatrix=Float32Array.from(Pe.calculateShadowPassMatrixFromMatrix(at)),La.aabb.min.fill(0),La.aabb.max[0]=La.aabb.max[1]=a.ab,La.aabb.max[2]=0,Ih(nt,La,Q,ge.scope))continue}const We=1<<$e.canonical.z,ut=[((Ie.x-$e.wrap)*We-$e.canonical.x)*a.ab,(Ie.y*We-$e.canonical.y)*a.ab,Ie.z*We*a.ab];Q.conflationActive&&Object.keys(nt.instancesPerModel).length>0&&Q.style.isLayerClipped(ge,fe.getSource())&&nt.updateReplacement($e,Q.replacementSource,De,xe)&&(nt.uploaded=!1,nt.upload(Q.context));for(let at in nt.instancesPerModel){const wt=nt.instancesPerModel[at];wt.features.length>0&&(at=xt.evaluate(wt.features[0].feature,{}));const Et=Ee.getModel(at,xe);if(Et&&Et.uploaded)for(const ft of Et.nodes)uo(Q,ge,ft,wt,ut,$e,La)}}}(f,n,s,p,L.type==="vector"?s.scope:""),void k();if(!L.loaded())return;if(L.type==="batched-model")return function(Q,fe,ge,he){ge.resetLayerRenderingStats(Q);const xe=Q.context,ve=Q.transform,Ie=Q.style.fog,Ee=Q.shadowRenderer;if(ve.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Pe=Q.transform.getFreeCameraOptions().position,ze=a.a6.vec3.scale([],[Pe.x,Pe.y,Pe.z],Q.transform.worldSize),ke=a.a6.vec3.negate([],ze),De=a.a6.mat4.identity([]),$e=a.de(ve.center.lat,ve.zoom),nt=a.a6.mat4.fromScaling([],[1,1,1/$e]);a.a6.mat4.translate(De,De,ke);const pt=ge.paint.get("model-opacity"),rt=new ar(xe.gl.LEQUAL,ar.ReadWrite,Q.depthRangeFor3D),xt=new ar(xe.gl.LEQUAL,ar.ReadOnly,Q.depthRangeFor3D),We=new a.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ut=Q.renderPass==="shadow",at=ut&&Ee?Ee.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),wt=ge.paint.get("model-front-cutoff"),Et=wt[2]<1,ft=Es(Q,ge.paint.get("model-cutoff-fade-range")),_t=ge.getLayerRenderingStats();(function(ir,kt,Vt,dr){const Jt=ir.terrain?ir.terrain.exaggeration():0,lr=ir.transform.zoom;for(const Or of dr){const Pr=kt.getTile(Or).getBucket(Vt);Pr&&(ir.conflationActive&&Pr.updateReplacement(Or,ir.replacementSource),Pr.evaluateScale(ir,Vt),ir.terrain&&Jt>0&&Pr.elevationUpdate(ir.terrain,Jt,Or,Vt.source),Pr.needsReEvaluation(ir,lr,Vt)&&Pr.evaluate(Vt))}})(Q,fe,ge,he),function(){let ir,kt,Vt;Et?(ir=he.length-1,kt=-1,Vt=-1):(ir=0,kt=he.length,Vt=1);const dr=new Float64Array(16),Jt=a.a6.vec3.create(),lr=new a.P(0,0);for(let Or=ir;Or!==kt;Or+=Vt){const Pr=he[Or],pn=fe.getTile(Pr).getBucket(ge);if(!pn||!pn.uploaded)continue;let xn=!1;Ee&&(xn=Ee.getMaxCascadeForTile(Pr.toUnwrapped())===0);const Cn=ve.calculatePosMatrix(Pr.toUnwrapped(),ve.worldSize),ha=pn.modelTraits;!ut&&Et&&(a.a6.mat4.invert(dr,Cn),a.a6.vec3.transformMat4(Jt,ze,dr),lr.x=Jt[0],lr.y=Jt[1]);const si=[];for(const $r of pn.getNodesInfo()){if($r.hiddenByReplacement||!$r.node.meshes)continue;const yn=$r.node;let zn=0;Q.terrain&&yn.elevation&&(zn=yn.elevation*Q.terrain.exaggeration());const _n=(()=>{const Sn=$r.aabb;return We.min=[...Sn.min],We.max=[...Sn.max],We.min[2]+=zn,We.max[2]+=zn,a.a6.vec3.transformMat4(We.min,We.min,Cn),a.a6.vec3.transformMat4(We.max,We.max,Cn),We})(),Ar=$r.evaluatedScale;if(Ar[0]<=1&&Ar[1]<=1&&Ar[2]<=1&&_n.intersects(at)===0)continue;if(!ut&&Et){const Sn=.16666666666666666;$r.cameraCollisionOpacity=ze[0]>_n.min[0]&&ze[0]<_n.max[0]&&ze[1]>_n.min[1]&&ze[1]<_n.max[1]&&ze[2]*$e<_n.max[2]&&yn.footprint&&a.bu(lr,yn.footprint)?Math.max($r.cameraCollisionOpacity-Sn,0):Math.min(1,$r.cameraCollisionOpacity+Sn)}const tn=[...Cn],hn=yn.anchor?yn.anchor[0]:0,Yn=yn.anchor?yn.anchor[1]:0;a.a6.mat4.translate(tn,tn,[hn*(Ar[0]-1),Yn*(Ar[1]-1),zn]),a.a6.vec3.exactEquals(Ar,a.dh)||a.a6.mat4.scale(tn,tn,Ar);const li=a.a6.mat4.multiply([],tn,yn.matrix),Xr=a.a6.mat4.multiply([],ve.expandedFarZProjMatrix,li),Ti=a.a6.mat4.multiply([],ve.expandedFarZProjMatrix,tn),Oi=a.a6.vec4.transformMat4([],[hn,Yn,zn,1],Xr)[2];yn.hidden=!1;let Ei=pt;ut||(Et&&(Ei*=$r.cameraCollisionOpacity,Ei*=en(tn,ve,$r.aabb,wt)),Ei*=Pn(ft,Oi)),Ei!==0?si.push({nodeInfo:$r,depth:Oi,opacity:Ei,wvpForNode:Xr,wvpForTile:Ti,nodeModelMatrix:li,tileModelMatrix:tn}):yn.hidden=!0}ut||si.sort(($r,yn)=>!Et||$r.opacity===1&&yn.opacity===1?$r.depth<yn.depth?-1:1:$r.opacity===1?-1:yn.opacity===1?1:$r.depth>yn.depth?-1:1);for(const $r of si){const yn=$r.nodeInfo,zn=yn.node;let _n=a.a6.mat4.multiply([],nt,$r.tileModelMatrix);a.a6.mat4.multiply(_n,De,_n);const Ar=a.a6.mat4.invert([],_n);a.a6.mat4.transpose(Ar,Ar),a.a6.mat4.scale(Ar,Ar,sw),_n=a.a6.mat4.multiply(_n,_n,zn.matrix);const tn=Q.renderPass==="light-beam",hn=ha&a.dj.HasMapboxMeshFeatures,Yn=hn?0:yn.evaluatedRMEA[0][2];for(let li=0;li<zn.meshes.length;++li){const Xr=zn.meshes[li],Ti=li===zn.lightMeshIndex;let Oi=$r.wvpForNode;if(Ti){if(!tn&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}Oi=$r.wvpForTile}else if(tn)continue;const Ei={defines:[]},Sn=[];if(xf(Ei.defines,Sn,Xr,Q,ge.lut),hn||Ei.defines.push("DIFFUSE_SHADED"),xn&&Ei.defines.push("SHADOWS_SINGLE_CASCADE"),_t&&(ut?_t.numRenderedVerticesInShadowPass+=Xr.vertexArray.length:_t.numRenderedVerticesInTransparentPass+=Xr.vertexArray.length),ut){Qc(Xr,$r.nodeModelMatrix,Q,ge);continue}let bo=null;if(Ie){const Ds=vf($r.nodeModelMatrix,Q.transform);if(bo=new Float32Array(Ds),ve.projection.name!=="globe"){const dl=Xr.aabb.min,as=Xr.aabb.max,[ou,au]=Ie.getOpacityForBounds(Ds,dl[0],dl[1],as[0],as[1]);Ei.overrideFog=ou>=Ut||au>=Ut}}const wo=Xr.material;let da;wo.occlusionTexture&&wo.occlusionTexture.offsetScale&&(da=wo.occlusionTexture.offsetScale,Ei.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ut&&Ee&&(Ee.useNormalOffset=!!Xr.normalBuffer);const Jo=Q.getOrCreateProgram("model",Ei);!ut&&Ee&&Ee.setupShadowsFromMatrix($r.tileModelMatrix,Jo,Ee.useNormalOffset),Q.uploadCommonUniforms(xe,Jo,null,bo);const zo=wo.pbrMetallicRoughness;zo.metallicFactor=.9,zo.roughnessFactor=.5;const fa=Zt(new Float32Array(Oi),new Float32Array(_n),new Float32Array(Ar),new Float32Array(zn.matrix),Q,$r.opacity,zo.baseColorFactor.toRenderColor(null),wo.emissiveFactor,zo.metallicFactor,zo.roughnessFactor,wo,Yn,ge,[0,0,0],da);!Ti&&(yn.hasTranslucentParts||$r.opacity<1)&&Jo.draw(Q,xe.gl.TRIANGLES,rt,Tr.disabled,Ur.disabled,mr.backCCW,fa,ge.id,Xr.vertexBuffer,Xr.indexBuffer,Xr.segments,ge.paint,Q.transform.zoom,void 0,Sn),Jo.draw(Q,xe.gl.TRIANGLES,Ti?xt:rt,Tr.disabled,Ti||$r.opacity<1||yn.hasTranslucentParts?Ur.alphaBlended:Ur.unblended,mr.backCCW,fa,ge.id,Xr.vertexBuffer,Xr.indexBuffer,Xr.segments,ge.paint,Q.transform.zoom,void 0,Sn)}}}}()}(f,n,s,p),void k();if(L.type!=="model")return;const z=L.getModels(),U=[],j=f.transform.getFreeCameraOptions().position,$=a.a6.vec3.scale([],[j.x,j.y,j.z],f.transform.worldSize);a.a6.vec3.negate($,$);const Y=[],K=[];let J=0;for(const Q of z){const fe=s.paint.get("model-rotation").constantOr(null),ge=s.paint.get("model-scale").constantOr(null),he=s.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(f,fe,ge,he,!0,!0,!1);const xe=a.a6.mat4.identity([]),ve=a.de(Q.position.lat,f.transform.zoom),Ie=a.a6.mat4.fromScaling([],[1,1,1/ve]);a.a6.mat4.translate(xe,xe,$),U.push({zScaleMatrix:Ie,negCameraPosMatrix:xe});for(const Ee of Q.nodes)Ch(f.transform,Ee,Q.matrix,f.transform.expandedFarZProjMatrix,J,Y,K);J++}if(Y.sort((Q,fe)=>fe.depth-Q.depth),f.renderPass!=="shadow"){if(_===1)for(const Q of K)Mh(Q,f,s,U[Q.modelIndex],Tr.disabled,f.colorModeForRenderPass());else{for(const Q of K)Mh(Q,f,s,U[Q.modelIndex],Tr.disabled,Ur.disabled);for(const Q of K)Mh(Q,f,s,U[Q.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const Q of Y)Mh(Q,f,s,U[Q.modelIndex],Tr.disabled,f.colorModeForRenderPass());k()}else{for(const Q of K)Qc(Q.mesh,Q.nodeModelMatrix,f,s);for(const Q of Y)Qc(Q.mesh,Q.nodeModelMatrix,f,s);k()}}},wf={model:function(f,n,s){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const _=p.getModels();for(const x of _)x.upload(s.context)},raster:function(f,n,s){const p=n.getSource();if(!(p instanceof Tc&&p.loaded()))return;const _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;const x=f.paint.get("raster-array-band")||p.getInitialBand(_);if(x==null)return;const w=n.getIds().map(A=>n.getTileByID(A));for(const A of w)A.updateNeeded(_,x)&&p.prepareTile(A,_,x)},"raster-particle":function(f,n,s){const p=n.getSource();if(!(p instanceof Tc&&p.loaded()))return;const _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;const x=f.paint.get("raster-particle-array-band")||p.getInitialBand(_);if(x==null)return;const w=n.getIds().map(A=>n.getTileByID(A));for(const A of w)A.updateNeeded(_,x)&&p.prepareTile(A,_,x)}};class Ym{constructor(n,s,p,_){this.context=new ew(n,s),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=a.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const A of x)this._debugParams.enabledLayers[A]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const A of x)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new bf(_),this.setup(),this.numSublayers=Do.maxUnderzooming+Do.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Uy(this),this._wireframeDebugCache=new sl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const w=new a.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,w,n.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(n,s){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new km(this,n));const _=this._terrain;this.transform.elevation=p?_:null,_.update(n,this.transform,s),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(n){const s=n.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=s.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new km(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,s){if(this.width=n*a.q.devicePixelRatio,this.height=s*a.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,s=new a.a_;s.emplaceBack(0,0),s.emplaceBack(a.ab,0),s.emplaceBack(0,a.ab),s.emplaceBack(a.ab,a.ab),this.tileExtentBuffer=n.createVertexBuffer(s,a.b0.members),this.tileExtentSegments=a.b1.simpleSegment(0,0,4,2);const p=new a.a_;p.emplaceBack(0,0),p.emplaceBack(a.ab,0),p.emplaceBack(0,a.ab),p.emplaceBack(a.ab,a.ab),this.debugBuffer=n.createVertexBuffer(p,a.b0.members),this.debugSegments=a.b1.simpleSegment(0,0,4,5);const _=new a.a_;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,a.b0.members),this.viewportSegments=a.b1.simpleSegment(0,0,4,2);const x=new a.aN;x.emplaceBack(0,0,0,0),x.emplaceBack(a.ab,0,a.ab,0),x.emplaceBack(0,a.ab,0,a.ab),x.emplaceBack(a.ab,a.ab,a.ab,a.ab),this.mercatorBoundsBuffer=n.createVertexBuffer(x,a.b3.members),this.mercatorBoundsSegments=a.b1.simpleSegment(0,0,4,2);const w=new a.aO;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const A=new a.a$;for(const L of[0,1,3,2,0])A.emplaceBack(L);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new a.T(n,new a.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=a.a6.mat4.create();const k=this.context.gl;this.stencilClearMode=new Tr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,ar.disabled,this.stencilClearMode,Ur.disabled,mr.disabled,vh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,s,p){if(!s||this.currentStencilSource===s.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const k of p)if(this._tileClippingMaskIDs[k.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=s.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(Ur.disabled),_.setDepthMode(ar.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const k=s.getTile(A),L=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=this.getTileBoundsBuffers(k);w.draw(this,x.TRIANGLES,ar.disabled,new Tr({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),Ur.disabled,mr.disabled,vh(A.projMatrix),"$clipping",z,U,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,s=this.context.gl;return new Tr({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const s=this.context.gl;return new Tr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(n){const s=this.context.gl,p=n.sort((w,A)=>A.overscaledZ-w.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let A=0;A<x;A++)w[A+_]=new Tr({func:s.GEQUAL,mask:255},A+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=x,[w,p]}return[{[_]:Tr.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Ur([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new a.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ur.unblended:Ur.alphaBlended}colorModeForDrapableLayerRenderPass(n){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ur([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new a.bz(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,s,p,_=!1){if(this.depthOcclusion)return new ar(this.context.gl.GREATER,ar.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return ar.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new ar(p||this.context.gl.LEQUAL,s,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,s=Math.ceil(this.width),p=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),x=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&p!==0&&(this.depthFBO=new df(this.context,s,p,!1,"texture"),this.depthTexture=new a.T(this.context,{width:s,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),n.bindTexture(n.TEXTURE_2D,x),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,s,p,0,0,s,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,s)=>n+s/this._fpsHistory.length,0))}render(n,s){const p=a.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=s;const _=this.style._mergedLayers,x=this.style.order.filter(ke=>{const De=_[ke];return!(De.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[De.type]});let w=!1,A=!1;for(const ke of x){const De=_[ke];De.type==="circle"&&(w=!0),De.type==="symbol"&&(De.hasInitialOcclusionOpacityProperties?A=!0:w=!0)}const k=x.map(ke=>_[ke]),L=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.q.now()),this.imageManager.beginFrame();let z=0,U=!1;for(const ke in L){const De=L[ke];De.used&&(De.prepare(this.context),De.getSource().usedInConflation&&++z)}let j=!1;for(const ke of k)ke.isHidden(this.transform.zoom)||(ke.type==="clip"&&(j=!0),this.prepareLayer(ke));const $={},Y={},K={},J={},Q={};for(const ke in L){const De=L[ke];$[ke]=De.getVisibleCoordinates(),Y[ke]=$[ke].slice().reverse(),K[ke]=De.getVisibleCoordinates(!0).reverse(),J[ke]=De.getShadowCasterCoordinates(),Q[ke]=De.sortCoordinatesByDistance($[ke])}const fe=ke=>{const De=this.style.getLayerSourceCache(ke);return De&&De.used?De.getSource():null};if(z||j||this._clippingActiveLastFrame){const ke=[],De=[];let $e=0;for(const nt of k)this.isSourceForClippingOrConflation(nt,fe(nt))&&(ke.push(nt),De.push($e)),$e++;if(ke&&(j||ke.length>1)||this._clippingActiveLastFrame){j=!1;const nt=[];for(let pt=0;pt<ke.length;pt++){const rt=ke[pt],xt=De[pt],We=this.style.getLayerSourceCache(rt);if(!We||!We.used||!We.getSource().usedInConflation&&rt.type!=="clip")continue;let ut=a.dn,at=a.bs.None;const wt=[];let Et=!0;if(rt.type==="clip"){ut=xt;for(const ft of rt.layout.get("clip-layer-types"))at|=ft==="model"?a.bs.Model:ft==="symbol"?a.bs.Symbol:a.bs.FillExtrusion;for(const ft of rt.layout.get("clip-layer-scope"))wt.push(ft);rt.isHidden(this.transform.zoom)?Et=!1:j=!0}Et&&nt.push({layer:rt.fqid,cache:We,order:ut,clipMask:at,clipScope:wt})}this.replacementSource.setSources(nt),U=!0}}this._clippingActiveLastFrame=j,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ke=0;ke<k.length;ke++){const De=k[ke],$e=De.cutoffRange();if(this.longestCutoffRange=Math.max($e,this.longestCutoffRange),$e>0){const nt=fe(De);nt&&(this.minCutoffZoom=Math.max(nt.minzoom,this.minCutoffZoom)),De.minzoom&&(this.minCutoffZoom=Math.max(De.minzoom,this.minCutoffZoom))}De.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ke),this._lastOcclusionLayer=ke)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0);const he=this._shadowRenderer;if(he){he.updateShadowParameters(this.transform,this.style.directionalLight);for(const ke in L)for(const De of $[ke]){let $e={min:0,max:0};this.terrain&&($e=this.terrain.getMinMaxForTile(De)||$e),he.addShadowReceiver(De.toUnwrapped(),$e.min,$e.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new yf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!er.has(this.context.gl))return;this.renderPass="offscreen";for(const ke of k){const De=n.getLayerSourceCache(ke);if(!ke.hasOffscreenPass()||ke.isHidden(this.transform.zoom))continue;const $e=De?Y[De.id]:void 0;(ke.type==="custom"||ke.type==="raster"||ke.type==="raster-particle"||ke.isSky()||$e&&$e.length)&&this.renderLayer(this,De,ke,$e)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,J)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ve=(()=>{if(s.showOverdrawInspector)return a.bz.black;const ke=this.style.fog;if(ke&&this.transform.projection.supportsFog){const De=this.style.getLut(ke.scope);if(!xe){const $e=ke.properties.get("color").toRenderColor(De).toArray01();return new a.bz(...$e)}if(xe){const $e=ke.properties.get("space-color").toRenderColor(De).toArray01();return new a.bz(...$e)}}return a.bz.transparent})();if(this.context.clear({color:ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const ke=k[this.currentLayer],De=n.getLayerSourceCache(ke);if(ke.isSky())continue;const $e=De?(ke.is3D()?Q:Y)[De.id]:void 0;this._renderTileClippingMasks(ke,De,$e),this.renderLayer(this,De,ke,$e)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const ke=k[this.currentLayer],De=n.getLayerSourceCache(ke);ke.isSky()&&this.renderLayer(this,De,ke,De?Y[De.id]:void 0)}function Ie(ke,De){let $e;return De&&($e=(ke.type==="symbol"?K:ke.is3D()?Q:Y)[De.id]),$e}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){const ke=k[this.currentLayer];if(ke.type==="raster"||ke.type==="raster-particle"){const De=n.getLayerSourceCache(ke);this.renderLayer(this,De,ke,Ie(ke,De))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ee=0;he&&(Ee=he.getShadowCastingLayerCount());let Pe=!1,ze=-1;for(let ke=0;ke<x.length;++ke){const De=k[ke];De.isHidden(this.transform.zoom)||De.is3D()&&(ze=ke)}for(A&&ze===-1&&(w=!0);this.currentLayer<x.length;){const ke=k[this.currentLayer],De=n.getLayerSourceCache(ke);if(ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ke)){if(ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(w&&!Pe&&this.terrain&&!this.transform.isOrthographic&&(Pe=!0,this.blitDepth()),A&&ze!==-1&&this.currentLayer===ze+1&&!this.transform.isOrthographic&&this.blitDepth(),ke.is3D()||this.terrain||this._renderTileClippingMasks(ke,De,De?$[De.id]:void 0),this.renderLayer(this,De,ke,Ie(ke,De)),!this.terrain&&he&&Ee>0&&ke.hasShadowPass()&&--Ee==0&&(he.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const $e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=$e;this.currentLayer++){const nt=k[this.currentLayer];if(!nt.hasLightBeamPass())continue;const pt=n.getLayerSourceCache(nt);this.renderLayer(this,pt,nt,pt?Y[pt.id]:void 0)}this.currentLayer=$e,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const $e=this.currentLayer;this.depthOcclusion=!0;for(const nt of this.layersWithOcclusionOpacity){this.currentLayer=nt;const pt=k[this.currentLayer],rt=n.getLayerSourceCache(pt),xt=rt?Y[rt.id]:void 0;pt.is3D()||this.terrain||this._renderTileClippingMasks(pt,rt,rt?$[rt.id]:void 0),this.renderLayer(this,rt,pt,xt)}this.depthOcclusion=!1,this.currentLayer=$e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ke=null;k.forEach(De=>{const $e=n.getLayerSourceCache(De);$e&&!De.isHidden(this.transform.zoom)&&$e.getVisibleCoordinates().length&&(!ke||ke.getSource().maxzoom<$e.getSource().maxzoom)&&(ke=$e)}),ke&&this.options.showTileBoundaries&&ll.debug(this,ke,ke.getVisibleCoordinates(),a.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ll.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ke){const De=ke.transform.padding;Ln(ke,ke.transform.height-(De.top||0),3,nw),Ln(ke,De.bottom||0,3,Xc),He(ke,De.left||0,3,Kc),He(ke,ke.transform.width-(De.right||0),3,Pt);const $e=ke.transform.centerPoint;(function(nt,pt,rt,xt){Eh(nt,pt-1,rt-10,2,20,xt),Eh(nt,pt-10,rt-1,20,2,xt)})(ke,$e.x,ke.transform.height-$e.y,nr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:s}=this.transform.projection,p=!s||!s.includes(n.type);if(wf[n.type]&&(p||this.terrain&&n.type==="custom")){const _=this.style.getLayerSourceCache(n);wf[n.type](n,_,this)}this.gpuTimingEnd()}renderLayer(n,s,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||ll[p.type](n,s,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,p=this.context.gl;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),_.calls++,p.beginQuery(s.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,s=this.context.gl,p=s.createQuery();this.deferredRenderGpuTimeQueries.push(p),s.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const s={};for(const p in n){const _=n[p],x=this.context.extTimerQuery,w=x.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(_.query),s[p]=w}return s}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery,p=this.context.gl;let _=0;for(const x of n)_+=s.getQueryParameter(x,p.QUERY_RESULT)/1e6,s.deleteQueryEXT(x);return _}translatePosMatrix(n,s,p,_,x){if(!p[0]&&!p[1])return n;const w=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const L=Math.sin(w),z=Math.cos(w);p=[p[0]*z-p[1]*L,p[0]*L+p[1]*z]}const A=[x?p[0]:a.ak(s,p[0],this.transform.zoom),x?p[1]:a.ak(s,p[1],this.transform.zoom),0],k=new Float32Array(16);return a.a6.mat4.translate(k,n,A),k}saveTileTexture(n){const s=n.size[0],p=this._tileTextures[s];p?p.push(n):this._tileTextures[s]=[n]}getTileTexture(n){const s=this._tileTextures[n];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,s,p){const _=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,x=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||_||s!==void 0&&!s||x.push("FOG","FOG_DITHERING"),_&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(n,s){this.cache=this.cache||{};const p=s&&s.defines||[],_=s&&s.config,x=this.currentGlobalDefines(n,s&&s.overrideFog,s&&s.overrideRtt).concat(p),w=ol.cacheKey(nl[n],n,x,_);return this.cache[w]||(this.cache[w]=new ol(this.context,n,nl[n],_,_0[n],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,s){if(this.style.enable3dLights()){const p=this.style.directionalLight,_=this.style.ambientLight;if(p&&_){const x=((w,A,k)=>{const L=w.properties.get("direction"),z=w.properties.get("color").toRenderColor(k.getLut(w.scope)).toArray01(),U=w.properties.get("intensity"),j=A.properties.get("color").toRenderColor(k.getLut(A.scope)).toArray01(),$=A.properties.get("intensity"),Y=[L.x,L.y,L.z],K=a.cH(j,$),J=a.cH(z,U);return{u_lighting_ambient_color:K,u_lighting_directional_dir:Y,u_lighting_directional_color:J,u_ground_radiance:Om(Y,J,K)}})(p,_,this.style);s.setLightsUniformValues(n,x)}}}uploadCommonUniforms(n,s,p,_,x){if(this.uploadCommonLightUniforms(n,s),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const A=w.getOpacity(this.transform.pitch),k=((L,z,U,j,$,Y,K,J,Q,fe,ge,he)=>{const xe=L.transform,ve=z.properties.get("color").toRenderColor(L.style.getLut(z.scope)).toArray01();ve[3]=j;const Ie=L.frameCounter/1e3%1,[Ee,Pe]=z.properties.get("vertical-range");return{u_fog_matrix:U?xe.calculateFogTileMatrix(U):he||L.identityMat,u_fog_range:z.getFovAdjustedRange(xe._fov),u_fog_color:ve,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,Pe),Pe],u_fog_temporal_offset:Ie,u_frustum_tl:$,u_frustum_tr:Y,u_frustum_br:K,u_frustum_bl:J,u_globe_pos:Q,u_globe_radius:fe,u_viewport:ge,u_globe_transition:a.a9(xe.zoom),u_is_globe:+(xe.projection.name==="globe")}})(this,w,p,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.q.devicePixelRatio,this.transform.height*a.q.devicePixelRatio],_);s.setFogUniformValues(n,k)}x&&s.setCutoffUniformValues(n,x.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,s=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)s[_.key]=n[_.key]||new Qa(_,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,s){return!(!n.is3D()||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[n.key];return s||(this._cachedTileFogOpacities[n.key]=s=this.style.fog.getOpacityForTile(n)),s[0]>=Ut||s[1]>=Ut}setupDepthForOcclusion(n,s,p){const _=this.context,x=_.gl,w=!!p;var A;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(x.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),_.activeTexture.set(x.TEXTURE0),w||s.setTerrainUniformValues(_,p)}}function Cs(f,n){let s=!1,p=null;const _=()=>{p=null,s&&(f(),p=setTimeout(_,n),s=!1)};return()=>(s=!0,p||_(),p)}class cl{constructor(n){this._hashName=n&&encodeURIComponent(n),a.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Cs(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const s=Is(n);if(this._hashName){const p=this._hashName;let _=!1;const x=location.hash.slice(1).split("&").map(w=>{const A=w.split("=")[0];return A===p?(_=!0,`${A}=${s}`):w}).filter(w=>w);return _||x.push(`${p}=${s}`),`#${x.join("&")}`}return`#${s}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let s;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(s=p)}),(s&&s[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(s[3]||0):n.getBearing();return n.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:p,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Is(f,n){const s=f.getCenter(),p=Math.round(100*f.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),w=Math.round(s.lng*x)/x,A=Math.round(s.lat*x)/x,k=f.getBearing(),L=f.getPitch();let z=n?`/${w}/${A}/${p}`:`${p}/${A}/${w}`;return(k||L)&&(z+="/"+Math.round(10*k)/10),L&&(z+=`/${Math.round(L)}`),z}const ql={linearity:.3,easing:a.dp(0,0,.3,1)},Sf=a.l({deceleration:2500,maxSpeed:1400},ql),Xm=a.l({deceleration:20,maxSpeed:1400},ql),Km=a.l({deceleration:1e3,maxSpeed:360},ql),Jm=a.l({deceleration:1e3,maxSpeed:90},ql);class ul{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,s=a.q.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)s.zoom+=x.zoomDelta||0,s.bearing+=x.bearingDelta||0,s.pitch+=x.pitchDelta||0,x.panDelta&&s.pan._add(x.panDelta),x.around&&(s.around=x.around),x.pinchAround&&(s.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(s.pan.mag()){const x=Zl(s.pan.mag(),p,a.l({},Sf,n||{}));_.offset=s.pan.mult(x.amount/s.pan.mag()),_.center=this._map.transform.center,eu(_,x)}if(s.zoom){const x=Zl(s.zoom,p,Xm);_.zoom=this._map.transform.zoom+x.amount,eu(_,x)}if(s.bearing){const x=Zl(s.bearing,p,Km);_.bearing=this._map.transform.bearing+a.ap(x.amount,-179,179),eu(_,x)}if(s.pitch){const x=Zl(s.pitch,p,Jm);_.pitch=this._map.transform.pitch+x.amount,eu(_,x)}if(_.zoom||_.bearing){const x=s.pinchAround===void 0?s.around:s.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function eu(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Zl(f,n,s){const{maxSpeed:p,linearity:_,deceleration:x}=s,w=a.ap(f*_/(n/1e3),-p,p),A=Math.abs(w)/(x*_);return{easing:s.easing,duration:1e3*A,amount:w*(A/2)}}class xo extends a.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,p,_={}){const x=Ct(s.getCanvasContainer(),p),w=s.unproject(x);super(n,a.l({point:x,lngLat:w,originalEvent:p},_)),this._defaultPrevented=!1,this.target=s}}class tu extends a.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,p){const _=n==="touchend"?p.changedTouches:p.touches,x=ye(s.getCanvasContainer(),_),w=x.map(k=>s.unproject(k)),A=x.reduce((k,L,z,U)=>k.add(L.div(U.length)),new a.P(0,0));super(n,{points:x,point:A,lngLats:w,lngLat:s.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class qi extends a.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Qm{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new qi(this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new xo(n.type,this._map,n))}mouseup(n){this._map.fire(new xo(n.type,this._map,n))}preclick(n){const s=a.l({},n);s.type="preclick",this._map.fire(new xo(s.type,this._map,s))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(n),this._map.fire(new xo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new xo(n.type,this._map,n))}mouseover(n){this._map.fire(new xo(n.type,this._map,n))}mouseout(n){this._map.fire(new xo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new tu(n.type,this._map,n))}touchmove(n){this._map.fire(new tu(n.type,this._map,n))}touchend(n){this._map.fire(new tu(n.type,this._map,n))}touchcancel(n){this._map.fire(new tu(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class eg{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new xo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new xo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ru{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(Le(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;const p=s,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=pe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(_.x,p.x),A=Math.max(_.x,p.x),k=Math.min(_.y,p.y),L=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${k}px)`,this._box.style.width=A-w+"px",this._box.style.height=L-k+"px")})}mouseupWindow(n,s){if(!this._active)return;const p=this._startPos,_=s;if(p&&n.button===0){if(this.reset(),je(),p.x!==_.x||p.y!==_.y)return this._map.fire(new a.x("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Je(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new a.x(n,{originalEvent:s}))}}function Ps(f,n){const s={};for(let p=0;p<f.length;p++)s[f[p].identifier]=n[p];return s}class tg{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,s,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new a.P(0,0);for(const w of _)x._add(w);return x.div(_.length)}(s),this.touches=Ps(p,s)))}touchmove(n,s,p){if(this.aborted||!this.centroid)return;const _=Ps(p,s);for(const x in this.touches){const w=_[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,s,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ph{constructor(n){this.singleTap=new tg(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,s,p){this.singleTap.touchstart(n,s,p)}touchmove(n,s,p){this.singleTap.touchmove(n,s,p)}touchend(n,s,p){const _=this.singleTap.touchend(n,s,p);if(_){const x=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(x&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class rg{constructor(){this._zoomIn=new Ph({numTouches:1,numTaps:2}),this._zoomOut=new Ph({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,p){this._zoomIn.touchstart(n,s,p),this._zoomOut.touchstart(n,s,p)}touchmove(n,s,p){this._zoomIn.touchmove(n,s,p),this._zoomOut.touchmove(n,s,p)}touchend(n,s,p){const _=this._zoomIn.touchend(n,s,p),x=this._zoomOut.touchend(n,s,p);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ah={0:1,2:2};class Dh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,s){return!1}_move(n,s){return{}}mousedown(n,s){if(this._lastPoint)return;const p=et(n);this._correctButton(n,p)&&(this._lastPoint=s,this._eventButton=p)}mousemoveWindow(n,s){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(_,x){const w=Ah[x];return _.buttons===void 0||(_.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(s.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(p,s)}}mouseupWindow(n){this._lastPoint&&et(n)===this._eventButton&&(this._moved&&je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tf extends Dh{mousedown(n,s){super.mousedown(n,s),this._lastPoint&&(this._active=!0)}_correctButton(n,s){return s===0&&!n.ctrlKey}_move(n,s){return{around:s,panDelta:s.sub(n)}}}class Ef extends Dh{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){const p=.8*(s.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class Mf extends Dh{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){const p=-.5*(s.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class E0{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),a.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(n,s,p){return this._calculateTransform(n,s,p)}touchmove(n,s,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!a.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,s,p)}}touchend(n,s,p){this._calculateTransform(n,s,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,p){p.length>0&&(this._active=!0);const _=Ps(p,s),x=new a.P(0,0),w=new a.P(0,0);let A=0;for(const L in _){const z=_[L],U=this._touches[L];U&&(x._add(z),w._add(z.sub(U)),A++,_[L]=z)}if(this._touches=_,A<this._minTouches||!w.mag())return;const k=w.div(A);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Cf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,s,p){return{}}touchstart(n,s,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,p){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[x,w]=_,A=Rh(p,s,x),k=Rh(p,s,w);if(!A||!k)return;const L=this._aroundCenter?null:A.add(k).div(2);return this._move([A,k],L,n)}touchend(n,s,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,w=Rh(p,s,_),A=Rh(p,s,x);w&&A||(this._active&&je(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rh(f,n,s){for(let p=0;p<f.length;p++)if(f[p].identifier===s)return n[p]}function ng(f,n){return Math.log(f/n)/Math.LN2}class M0 extends Cf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(ng(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ng(this._distance,p),pinchAround:s}}}function ig(f,n){return 180*f.angleWith(n)/Math.PI}class C0 extends Cf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ig(this._vector,p),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const s=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=ig(n,p);return Math.abs(_)<s}}function If(f){return Math.abs(f.y)>Math.abs(f.x)}class I0 extends Cf{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,If(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,p){const _=this._lastPoints;if(!_)return;const x=n[0].sub(_[0]),w=n[1].sub(_[1]);return this._map._cooperativeGestures&&!a.dq()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(n,s,p){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,x=s.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=n.y>0==s.y>0;return If(n)&&If(s)&&w}}const P0={panStep:100,bearingStep:15,pitchStep:10};class A0{constructor(){const n=P0;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,p=0,_=0,x=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const k=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:D0,zoom:s?Math.round(k)+s*(n.shiftKey?2:1):k,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function D0(f){return f*(2-f)}const og=4.000244140625,lw=1/450;class cw{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=lw,a.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||a.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=a.q.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,s!==0&&s%og==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ct(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>og?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&z!==0&&(z=1/z);const U=s(),j=Math.pow(2,U),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*z))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:s(),_=this._startZoom,x=this._easing;let w,A=!1;if(this._type==="wheel"&&_&&x){const L=Math.min((a.q.now()-this._lastWheelEventTime)/200,1),z=x(L);w=a.aa(_,p,z),L<1?this._frameId||(this._frameId=!0):A=!0}else w=p,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=w-s();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=a.dr;if(this._prevEase){const p=this._prevEase,_=(a.q.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),w=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-w*w);s=a.dp(w,A,.25,1)}return this._prevEase={start:a.q.now(),duration:n,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Zn{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class R0{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,s){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uw{constructor(){this._tap=new Ph({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,s,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=s[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,s,p))}touchmove(n,s,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=s[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,s,p)}touchend(n,s,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,s,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hw{constructor(n,s,p){this._el=n,this._mousePan=s,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class kh{constructor(n,s,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=s,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class k0{constructor(n,s,p,_){this._el=n,this._touchZoom=s,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nu=f=>f.zoom||f.drag||f.pitch||f.rotate;class Pf extends a.x{}class As{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,s){const p=a.a6.vec3.sub([],s,n);this.radius=a.a6.vec3.length(p[2]<0?a.a6.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){a.a6.vec3.div(n,n,this.constants),a.a6.vec3.normalize(n,n),a.a6.vec3.mul(n,n,this.constants);const s=a.a6.vec3.scale([],n,this.radius);if(s[2]>0){const p=a.a6.vec3.scale([],[0,0,1],a.a6.vec3.dot(s,[0,0,1])),_=a.a6.vec3.scale([],a.a6.vec3.normalize([],[s[0],s[1],0]),this.radius),x=a.a6.vec3.add([],s,a.a6.vec3.scale([],a.a6.vec3.sub([],a.a6.vec3.add([],_,p),s),2));s[0]=x[0],s[1]=x[1]}return s}}function Yl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class ho{constructor(n,s){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ul(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new As,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),a.aJ(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,w]of this._listeners){const A=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(x,A,w)}}destroy(){for(const[n,s,p]of this._listeners){const _=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(s,_,p)}}_addDefaultHandlers(n){const s=this._map,p=s.getCanvasContainer();this._add("mapEvent",new Qm(s,n));const _=s.boxZoom=new ru(s,n);this._add("boxZoom",_);const x=new rg,w=new R0;s.doubleClickZoom=new Zn(w,x),this._add("tapZoom",x),this._add("clickZoom",w);const A=new uw;this._add("tapDragZoom",A);const k=s.touchPitch=new I0(s);this._add("touchPitch",k);const L=new Ef(n),z=new Mf(n);s.dragRotate=new kh(n,L,z),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const U=new Tf(n),j=new E0(s,n);s.dragPan=new hw(p,U,j),this._add("mousePan",U),this._add("touchPan",j,["touchZoom","touchRotate"]);const $=new C0,Y=new M0;s.touchZoomRotate=new k0(p,Y,$,A),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new eg(s));const K=s.scrollZoom=new cw(s,this);this._add("scrollZoom",K,["mousePan"]);const J=s.keyboard=new A0;this._add("keyboard",J);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Q]&&s[Q].enable(n[Q])}_add(n,s,p){this._handlers.push({handlerName:n,handler:s,allowed:p}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,s,p){for(const _ in n)if(_!==p&&(!s||s.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const s=[];for(const p of n)this._el.contains(p.target)&&s.push(p);return s}handleEvent(n,s){this._updatingCamera=!0;const p=n.type==="renderFrame",_=p?void 0:n,x={needsRenderFrame:!1},w={},A={},k=n.touches?this._getMapTouches(n.touches):void 0,L=k?ye(this._el,k):p?void 0:Ct(this._el,n);for(const{handlerName:j,handler:$,allowed:Y}of this._handlers){if(!$.isEnabled())continue;let K;this._blockedByActive(A,Y,j)?$.reset():$[s||n.type]&&(K=$[s||n.type](n,L,k),this.mergeHandlerResult(x,w,K,j,_),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||$.isActive())&&(A[j]=$)}const z={};for(const j in this._previousActiveHandlers)A[j]||(z[j]=_);this._previousActiveHandlers=A,(Object.keys(z).length||Yl(x))&&(this._changes.push([x,w,z]),this._triggerRenderFrame()),(Object.keys(A).length||Yl(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,s,p,_,x){if(!p)return;a.l(n,p);const w={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(s.zoom=w),p.panDelta!==void 0&&(s.drag=w),p.pitchDelta!==void 0&&(s.pitch=w),p.bearingDelta!==void 0&&(s.rotate=w)}_applyChanges(){const n={},s={},p={};for(const[_,x,w]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),a.l(s,x),a.l(p,w);this._updateMapTransform(n,s,p),this._changes=[]}_updateMapTransform(n,s,p){const _=this._map,x=_.transform,w=fe=>[fe.x,fe.y,fe.z];if((fe=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Yl(n)){const fe=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),fe!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!Yl(n))return void this._fireEvents(s,p,!0);let{panDelta:A,zoomDelta:k,bearingDelta:L,pitchDelta:z,around:U,aroundCoord:j,pinchAround:$}=n;x._isCameraConstrained&&(k>0&&(k=0),x._isCameraConstrained=!1),$!==void 0&&(U=$),(k||(fe=>s[fe]&&!this._eventsInProgress[fe])("drag"))&&U&&(this._dragOrigin=w(x.pointCoordinate3D(U)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),U=U||_.transform.centerPoint,L&&(x.bearing+=L),z&&(x.pitch+=z),x._updateCameraState();const Y=[0,0,0];if(A)if(x.projection.name==="mercator"){const fe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U).dir),ge=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U.sub(A)).dir);Y[0]=ge[0]-fe[0],Y[1]=ge[1]-fe[1]}else{const fe=x.pointCoordinate(U);if(x.projection.name==="globe"){A=A.rotate(-x.angle);const ge=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-A.x*a.ds(a.aM(fe.y))*ge,Y[1]=-A.y*a.ds(x.center.lat)*ge}else{const ge=x.pointCoordinate(U.sub(A));fe&&ge&&(Y[0]=ge.x-fe.x,Y[1]=ge.y-fe.y)}}const K=x.zoom,J=[0,0,0];if(k){const fe=w(j||x.pointCoordinate3D(U)),ge={dir:a.a6.vec3.normalize([],a.a6.vec3.sub([],fe,x._camera.position))};if(ge.dir[2]<0){const he=x.zoomDeltaToMovement(fe,k);a.a6.vec3.scale(J,ge.dir,he)}}const Q=a.a6.vec3.add(Y,Y,J);x._translateCameraConstrained(Q),k&&Math.abs(x.zoom-K)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,p,!0)}_fireEvents(n,s,p){const _=nu(this._eventsInProgress),x=nu(n),w={};for(const z in n){const{originalEvent:U}=n[z];this._eventsInProgress[z]||(w[`${z}start`]=U),this._eventsInProgress[z]=n[z]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const z in w)this._fireEvent(z,w[z]);x&&this._fireEvent("move",x.originalEvent);for(const z in n){const{originalEvent:U}=n[z];this._fireEvent(z,U)}const A={};let k;for(const z in this._eventsInProgress){const{handlerName:U,originalEvent:j}=this._eventsInProgress[z];this._handlersById[U].isActive()||(delete this._eventsInProgress[z],k=s[U]||j,A[`${z}end`]=k)}for(const z in A)this._fireEvent(z,A[z]);const L=nu(this._eventsInProgress);if(p&&(_||x)&&!L){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(U(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:k})):(this._map.fire(new a.x("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new a.x(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Pf("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ns="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ag extends a.E{constructor(n,s){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,a.aJ(["_renderFrameCallback"],this)}getCenter(){return new a.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}panBy(n,s,p){return n=a.P.convert(n).mult(-1),this.panTo(this.transform.center,a.l({offset:n},s),p)}panTo(n,s,p){return this.easeTo(a.l({center:n},s),p)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,p){return this.easeTo(a.l({zoom:n},s),p)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,p){return this.easeTo(a.l({bearing:n},s),p)}resetNorth(n,s){return this.rotateTo(0,a.l({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(a.l({bearing:0,pitch:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}cameraForBounds(n,s){n=a.as.convert(n);const p=s&&s.bearing||0,_=s&&s.pitch||0,x=n.getNorthWest(),w=n.getSouthEast();return this._cameraForBounds(this.transform,x,w,p,_,s)}_extendPadding(n){const s={top:0,right:0,bottom:0,left:0};return n==null?a.l({},s,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:a.l({},s,n)}_extendCameraOptions(n){return(n=a.l({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,s){const p=s.max[0]-s.min[0],_=s.max[1]-s.min[1];return p/_>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):_/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,s,p,_,x,w){const A=n.clone(),k=this._extendCameraOptions(w);A.bearing=_,A.pitch=x;const L=a.bK.convert(s),z=a.bK.convert(p),U=.5*(L.lat+z.lat),j=.5*(L.lng+z.lng),$=a.dt(U,j),Y=a.a6.vec3.normalize([],$),K=a.a6.vec3.normalize([],a.a6.vec3.cross([],Y,[0,1,0])),J=a.a6.vec3.cross([],K,Y),Q=[K[0],K[1],K[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],fe=[$,a.dt(L.lat,L.lng),a.dt(z.lat,L.lng),a.dt(z.lat,z.lng),a.dt(L.lat,z.lng),a.dt(U,L.lng),a.dt(U,z.lng),a.dt(L.lat,j),a.dt(z.lat,j)];let ge=a.c9.fromPoints(fe.map(at=>[a.a6.vec3.dot(K,at),a.a6.vec3.dot(J,at),a.a6.vec3.dot(Y,at)]));const he=a.a6.vec3.transformMat4([],ge.center,Q);a.a6.vec3.squaredLength(he)===0&&a.a6.vec3.set(he,0,0,1),a.a6.vec3.normalize(he,he),a.a6.vec3.scale(he,he,a.aq),A.center=a.du(he);const xe=A.getWorldToCameraMatrix(),ve=a.a6.mat4.invert(new Float64Array(16),xe);ge=a.c9.applyTransform(ge,a.a6.mat4.multiply([],xe,Q));const Ie=this._extendAABB(ge,A,k,_);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=Ie,a.a6.vec3.transformMat4(he,he,xe);const Ee=.5*(ge.max[2]-ge.min[2]),Pe=this._minimumAABBFrustumDistance(A,ge),ze=a.a6.vec3.scale([],[0,0,1],Ee),ke=a.a6.vec3.add(ze,he,ze),De=Pe+(A.pitch===0?0:a.a6.vec3.distance(he,ke)),$e=A.globeCenterInViewSpace,nt=a.a6.vec3.sub([],he,[$e[0],$e[1],$e[2]]);a.a6.vec3.normalize(nt,nt),a.a6.vec3.scale(nt,nt,De);const pt=a.a6.vec3.add([],he,nt);a.a6.vec3.transformMat4(pt,pt,ve);const rt=a.dw/a.aq,xt=a.a6.vec3.length(pt),We=a.bD(Math.max(xt*rt-a.dw,Number.EPSILON),0),ut=Math.min(A.zoomFromMercatorZAdjusted(We),k.maxZoom);return ut>.5*(a.c2+a.bU)?(A.setProjection({name:"mercator"}),A.zoom=ut,this._cameraForBounds(A,s,p,_,x,w)):{center:A.center,zoom:ut,bearing:_,pitch:x}}_extendAABB(n,s,p,_){const x=.5*((p.padding.left||0)+(p.padding.right||0)),w=.5*((p.padding.top||0)+(p.padding.bottom||0)),A=w,k=x,L=x,z=w,U=s.width-(k+L),j=s.height-(A+z),$=a.a6.vec3.sub([],n.max,n.min),Y=Math.min(U/$[0],j/$[1]),K=Math.min(s.scaleZoom(s.scale*Y),p.maxZoom);if(isNaN(K))return null;const J=s.scale/s.zoomScale(K),Q=new a.c9([n.min[0]-k*J,n.min[1]-z*J,n.min[2]],[n.max[0]+L*J,n.max[1]+A*J,n.max[2]]),fe=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new a.P(p.offset.x,p.offset.y):a.P.convert(p.offset)).rotate(-a.bB(_));return Q.center[0]-=fe.x*J,Q.center[1]+=fe.y*J,Q}queryTerrainElevation(n,s){const p=this.transform.elevation;return p?(s=a.l({},{exaggerated:!0},s),p.getAtPoint(a.a5.fromLngLat(n),null,s.exaggerated)):null}_cameraForBounds(n,s,p,_,x,w){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,s,p,_,x,w);const A=n.clone(),k=this._extendCameraOptions(w);A.bearing=_,A.pitch=x;const L=a.bK.convert(s),z=a.bK.convert(p),U=new a.bK(L.lng,z.lat),j=new a.bK(z.lng,L.lat),$=A.project(L),Y=A.project(z),K=this.queryTerrainElevation(L),J=this.queryTerrainElevation(z),Q=this.queryTerrainElevation(U),fe=this.queryTerrainElevation(j),ge=[[$.x,$.y,Math.min(K||0,J||0,Q||0,fe||0)],[Y.x,Y.y,Math.max(K||0,J||0,Q||0,fe||0)]];let he=a.c9.fromPoints(ge);const xe=A.getWorldToCameraMatrix(),ve=a.a6.mat4.invert(new Float64Array(16),xe);he=a.c9.applyTransform(he,xe);const Ie=this._extendAABB(he,A,k,_);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=Ie;const Ee=.5*a.a6.vec3.sub([],he.max,he.min)[2],Pe=this._minimumAABBFrustumDistance(A,he),ze=[0,0,1,0];a.a6.vec4.transformMat4(ze,ze,xe),a.a6.vec4.normalize(ze,ze);const ke=a.a6.vec3.scale([],ze,Pe+Ee),De=a.a6.vec3.add([],he.center,ke);a.a6.vec3.transformMat4(he.center,he.center,ve),a.a6.vec3.transformMat4(De,De,ve);const $e=A.unproject(new a.P(he.center[0],he.center[1])),nt=a.dv(A.projection,$e),pt=Math.pow(2,nt),rt=Math.min(A._zoomFromMercatorZ(De[2]*A.pixelsPerMeter*pt/A.worldSize),k.maxZoom);return A.mercatorFromTransition&&rt<.5*(a.c2+a.bU)?(A.setProjection({name:"globe"}),A.zoom=rt,this._cameraForBounds(A,s,p,_,x,w)):{center:$e,zoom:rt,bearing:_,pitch:x}}fitBounds(n,s,p){const _=this.cameraForBounds(n,s);return this._fitInternal(_,s,p)}fitScreenCoordinates(n,s,p,_,x){const w=a.P.convert(n),A=a.P.convert(s),k=new a.P(Math.min(w.x,A.x),Math.min(w.y,A.y)),L=new a.P(Math.max(w.x,A.x),Math.max(w.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,A))return this;const z=this.transform.pointLocation3D(k),U=this.transform.pointLocation3D(L),j=this.transform.pointLocation3D(new a.P(k.x,L.y)),$=this.transform.pointLocation3D(new a.P(L.x,k.y)),Y=[Math.min(z.lng,U.lng,j.lng,$.lng),Math.min(z.lat,U.lat,j.lat,$.lat)],K=[Math.max(z.lng,U.lng,j.lng,$.lng),Math.max(z.lat,U.lat,j.lat,$.lat)],J=_&&_.pitch?_.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,Y,K,p,J,_);return this._fitInternal(Q,_,x)}_fitInternal(n,s,p){return n?(s=a.l(n,s)).linear?this.easeTo(s,p):this.flyTo(s,p):this}jumpTo(n,s){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,w=!1;"zoom"in n&&p.zoom!==+n.zoom&&(_=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=a.bK.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(x=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(w=!0,p.pitch=+n.pitch);const A=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(A))if(n.retainPadding===!1){const k=p.clone();k.padding=A,p.setLocationAtPoint(p.center,k.centerPoint)}else p.padding=A;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new a.x("movestart",s)).fire(new a.x("move",s)),_&&this.fire(new a.x("zoomstart",s)).fire(new a.x("zoom",s)).fire(new a.x("zoomend",s)),x&&this.fire(new a.x("rotatestart",s)).fire(new a.x("rotate",s)).fire(new a.x("rotateend",s)),w&&this.fire(new a.x("pitchstart",s)).fire(new a.x("pitch",s)).fire(new a.x("pitchend",s)),this.fire(new a.x("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(ns),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,s){const p=this.transform;if(!p.projection.supportsFreeCamera)return a.w(ns),this;this.stop();const _=p.zoom,x=p.pitch,w=p.bearing;p.setFreeCameraOptions(n);const A=_!==p.zoom,k=x!==p.pitch,L=w!==p.bearing;return this.fire(new a.x("movestart",s)).fire(new a.x("move",s)),A&&this.fire(new a.x("zoomstart",s)).fire(new a.x("zoom",s)).fire(new a.x("zoomend",s)),L&&this.fire(new a.x("rotatestart",s)).fire(new a.x("rotate",s)).fire(new a.x("rotateend",s)),k&&this.fire(new a.x("pitchstart",s)).fire(new a.x("pitch",s)).fire(new a.x("pitchend",s)),this.fire(new a.x("moveend",s)),this}easeTo(n,s){this._stop(!1,n.easeId),((n=a.l({offset:[0,0],duration:500,easing:a.dr},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),A=this.getPadding(),k="zoom"in n?+n.zoom:_,L="bearing"in n?this._normalizeBearing(n.bearing,x):x,z="pitch"in n?+n.pitch:w,U=this._extendPadding(n.padding),j=a.P.convert(n.offset);let $,Y,K;if(p.projection.name==="globe"){const ze=a.a5.fromLngLat(p.center),ke=j.rotate(-p.angle);ze.x+=ke.x/p.worldSize,ze.y+=ke.y/p.worldSize;const De=ze.toLngLat(),$e=a.bK.convert(n.center||De);this._normalizeCenter($e),$=p.centerPoint.add(ke),Y=new a.P(ze.x,ze.y).mult(p.worldSize),K=new a.P(a.am($e.lng),a.at($e.lat)).mult(p.worldSize).sub(Y)}else{$=p.centerPoint.add(j);const ze=p.pointLocation($),ke=a.bK.convert(n.center||ze);this._normalizeCenter(ke),Y=p.project(ze),K=p.project(ke).sub(Y)}const J=p.zoomScale(k-_);let Q,fe;n.around&&(Q=a.bK.convert(n.around),fe=p.locationPoint(Q));const ge=this._zooming||k!==_,he=this._rotating||x!==L,xe=this._pitching||z!==w,ve=!p.isPaddingEqual(U),Ie=n.retainPadding===!1?p.clone():p,Ee=ze=>ke=>{if(ge&&(ze.zoom=a.aa(_,k,ke)),he&&(ze.bearing=a.aa(x,L,ke)),xe&&(ze.pitch=a.aa(w,z,ke)),ve&&(Ie.interpolatePadding(A,U,ke),$=Ie.centerPoint.add(j)),Q)ze.setLocationAtPoint(Q,fe);else{const De=ze.zoomScale(ze.zoom-_),$e=k>_?Math.min(2,J):Math.max(.5,J),nt=Math.pow($e,1-ke),pt=ze.unproject(Y.add(K.mult(ke*nt)).mult(De));ze.setLocationAtPoint(ze.renderWorldCopies?pt.wrap():pt,$)}return n.preloadOnly||this._fireMoveEvents(s),ze};if(n.preloadOnly){const ze=this._emulate(Ee,n.duration,p);return this._preloadTiles(ze),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=he,this._pitching=xe,this._padding=ve,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,Pe),this._ease(Ee(p),ze=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(s,ze)},n),this}_prepareEase(n,s,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||p.moving||this.fire(new a.x("movestart",n)),this._zooming&&!p.zooming&&this.fire(new a.x("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new a.x("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new a.x("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.x("move",n)),this._zooming&&this.fire(new a.x("zoom",n)),this._rotating&&this.fire(new a.x("rotate",n)),this._pitching&&this.fire(new a.x("pitch",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.x("zoomend",n)),_&&this.fire(new a.x("rotateend",n)),x&&this.fire(new a.x("pitchend",n)),this.fire(new a.x("moveend",n))}flyTo(n,s){if(this._prefersReducedMotion(n)){const at=a.ar(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(at,s)}this.stop(),n=a.l({offset:[0,0],speed:1.2,curve:1.42,easing:a.dr},n);const p=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),A=this.getPadding(),k="zoom"in n?a.ap(+n.zoom,p.minZoom,p.maxZoom):_,L="bearing"in n?this._normalizeBearing(n.bearing,x):x,z="pitch"in n?+n.pitch:w,U=this._extendPadding(n.padding),j=p.zoomScale(k-_),$=a.P.convert(n.offset);let Y=p.centerPoint.add($);const K=p.pointLocation(Y),J=a.bK.convert(n.center||K);this._normalizeCenter(J);const Q=p.project(K),fe=p.project(J).sub(Q);let ge=n.curve;const he=Math.max(p.width,p.height),xe=he/j,ve=fe.mag();if("minZoom"in n){const at=a.ap(Math.min(n.minZoom,_,k),p.minZoom,p.maxZoom),wt=he/p.zoomScale(at-_);ge=Math.sqrt(wt/ve*2)}const Ie=ge*ge;function Ee(at){const wt=(xe*xe-he*he+(at?-1:1)*Ie*Ie*ve*ve)/(2*(at?xe:he)*Ie*ve);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Pe(at){return(Math.exp(at)-Math.exp(-at))/2}function ze(at){return(Math.exp(at)+Math.exp(-at))/2}const ke=Ee(0);let De=function(at){return ze(ke)/ze(ke+ge*at)},$e=function(at){return he*((ze(ke)*(Pe(wt=ke+ge*at)/ze(wt))-Pe(ke))/Ie)/ve;var wt},nt=(Ee(1)-ke)/ge;if(Math.abs(ve)<1e-6||!isFinite(nt)){if(Math.abs(he-xe)<1e-6)return this.easeTo(n,s);const at=xe<he?-1:1;nt=Math.abs(Math.log(xe/he))/ge,$e=function(){return 0},De=function(wt){return Math.exp(at*ge*wt)}}n.duration="duration"in n?+n.duration:1e3*nt/("screenSpeed"in n?+n.screenSpeed/ge:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const pt=x!==L,rt=z!==w,xt=!p.isPaddingEqual(U),We=n.retainPadding===!1?p.clone():p,ut=at=>wt=>{const Et=wt*nt,ft=1/De(Et);at.zoom=wt===1?k:_+at.scaleZoom(ft),pt&&(at.bearing=a.aa(x,L,wt)),rt&&(at.pitch=a.aa(w,z,wt)),xt&&(We.interpolatePadding(A,U,wt),Y=We.centerPoint.add($));const _t=wt===1?J:at.unproject(Q.add(fe.mult($e(Et))).mult(ft));return at.setLocationAtPoint(at.renderWorldCopies?_t.wrap():_t,Y),at._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(s),at};if(n.preloadOnly){const at=this._emulate(ut,n.duration,p);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=pt,this._pitching=rt,this._padding=xt,this._prepareEase(s,!1),this._ease(ut(p),()=>this._afterEase(s),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,s)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,s,p){p.animate===!1||p.duration===0?(n(1),s()):(this._easeStart=a.q.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,s){n=a.bA(n,-180,180);const p=Math.abs(n-s);return Math.abs(n-360-s)<p&&(n-=360),Math.abs(n+360-s)<p&&(n+=360),n}_normalizeCenter(n){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const p=n.lng-s.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&a.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,s,p){const _=Math.ceil(15*s/1e3),x=[],w=n(p.clone());for(let A=0;A<=_;A++){const k=w(A/_);x.push(k.clone())}return x}_preloadTiles(n,s){}}class Af{constructor(n={}){this.options=n,a.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const s=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=pe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const _=pe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",p),this._innerContainer=pe("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(n){const p=s.reduce((_,x,w)=>(x.value&&(_+=`${x.key}=${x.value}${w<s.length-1?"&":""}`),_),"?");n.href=`${a.e.FEEDBACK_URL}/${p}#${Is(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const s=this._map.style._mergedSourceCaches;for(const _ in s){const x=s[_];if(x.used){const w=x.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((_,x)=>_.length-x.length),n=n.filter((_,x)=>{for(let w=x+1;w<n.length;w++)if(n[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class sg{constructor(){a.aJ(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=pe("div","mapboxgl-ctrl");const s=pe("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const s in n){const p=n[s].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const s=n[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class O0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){const s=this._currentlyRunning,p=s?this._queue.concat(s):this._queue;for(const _ of p)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const p of s)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Oh{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const s=a.cw((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,s,p){this._start=this.getValue(s),this._end=n,this._startTime=s,this._endTime=s+p}}const dw={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class fw{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class lg{constructor(n){this.map=n,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(n,s){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const{type:p,filter:_}=s;if(_){const w=a.M(_,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(w.result==="error")throw new Error(w.value.map(A=>`${A.key}: ${A.message}`).join(", "));this.filters.set(n,w.value)}const x=this.interactionsByType.get(p)||new Map;x.size===0&&(this.map.on(p,this.handleType),this.interactionsByType.set(p,x)),x.set(n,s),this.typeById.set(n,p)}remove(n){const s=this.typeById.get(n);if(!s)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(s);p&&(p.delete(n),p.size===0&&this.map.off(s,this.handleType))}handleType(n){const s=n.features||this.map.queryRenderedFeatures(n.point);if(!s)return;const p=this.interactionsByType.get(n.type),_={zoom:0};for(const[x,w]of p){const A=this.filters.get(x),{handler:k,layers:L}=w;for(const z of s)if((!L||L.includes(z.layer.id))&&(!A||A.evaluate(_,z))&&k({id:x,feature:z,interaction:w})!==!1)break}}}const cg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Lh={showCompass:!0,showZoom:!0,visualizePitch:!1};class iu{constructor(n,s,p=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Ef({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Mf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(n,s){this.mouseRotate.mousedown(n,s),this.mousePitch&&this.mousePitch.mousedown(n,s),Le()}move(n,s){const p=this.map,_=this.mouseRotate.mousemoveWindow(n,s),x=_&&_.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,s),A=w&&w.pitchDelta;A&&p.setPitch(p.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Je(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.l({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ct(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ct(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ye(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=ye(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function is(f,n,s){if(f=new a.bK(f.lng,f.lat),n){const p=new a.bK(f.lng-360,f.lat),_=new a.bK(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-s.center.lng)/360),w=s.locationPoint(f).distSqr(n),A=n.x<0||n.y<0||n.x>s.width||n.y>s.height;s.locationPoint(p).distSqr(n)<w&&(A||Math.abs(p.lng-s.center.lng)<x)?f=p:s.locationPoint(_).distSqr(n)<w&&(A||Math.abs(_.lng-s.center.lng)<x)&&(f=_)}for(;Math.abs(f.lng-s.center.lng)>180;){const p=s.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=s.width&&p.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f}const Ko={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class os extends a.E{constructor(n,s){if(super(),(n instanceof HTMLElement||s)&&(n=a.l({element:n},s)),a.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=a.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=pe("div");const x=41,w=27,A=se("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),k=se("radialGradient",{id:"shadowGradient"},se("defs",{},A));se("stop",{offset:"10%","stop-opacity":.4},k),se("stop",{offset:"100%","stop-opacity":.05},k),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=a.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const p=this._element.classList;for(const x in Ko)p.remove(`mapboxgl-marker-anchor-${x}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=n&&n.className?n.className.trim().split(/\s+/):[];p.add(..._),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.bK.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const s=n.code,p=n.charCode||n.keyCode;s!=="Space"&&s!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const s=n.originalEvent.target,p=this._element;this._popup&&(s===p||p.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,s=this._pos;if(!n||!s)return!1;const p=n.unproject(s),_=n.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const s=this._pos;if(!s||s.x<0||s.x>n.transform.width||s.y<0||s.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(s);let _;n._showingGlobe()&&a.dz(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Ko[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const n=this._pos,s=this._map,p=this.getPitchAlignment();if(!s||!n||p!=="map")return"";if(!s._showingGlobe()){const k=s.getPitch();return k?`rotateX(${k}deg)`:""}const _=a.c0(a.dA(s.transform,this._lngLat)),x=n.sub(a.dB(s.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";const A=_/w;return`rotateX(${-x.y*A}deg) rotateY(${x.x*A}deg)`}_calculateZTransform(){const n=this._pos,s=this._map;if(!s||!n)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(s._showingGlobe()){const x=s.project(new a.bK(this._lngLat.lng,this._lngLat.lat+.001)),w=s.project(new a.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);p=a.c0(Math.atan2(w.y,w.x))-90}else p=-s.getBearing();else if(_==="horizon"){const x=a.a7(4,6,s.getZoom()),w=a.dB(s.transform);w.y+=x*s.transform.height;const A=n.sub(w),k=a.c0(Math.atan2(A.y,A.x));p=(k>90?k-270:k+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=is(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=a.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const s=this._map;if(!s)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const x=this._clickTolerance||s._clickTolerance;if(n.point.dist(p)<x)return;this._isDragging=!0}this._pos=n.point.sub(_),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.x("dragstart"))),this.fire(new a.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.x("dragend")),this._state="inactive"}_addDragHandler(n){const s=this._map,p=this._pos;s&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const s=this._map;return s&&(n?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Xl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hl={maxWidth:100,unit:"metric"},pw={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},mw={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},gw=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function L0(f=new a.P(0,0),n="bottom"){if(typeof f=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new a.P(0,f);case"top-left":return new a.P(s,s);case"top-right":return new a.P(-s,s);case"bottom":return new a.P(0,-f);case"bottom-left":return new a.P(s,-s);case"bottom-right":return new a.P(-s,-s);case"left":return new a.P(f,0);case"right":return new a.P(-f,0)}return new a.P(0,0)}return f instanceof a.P||Array.isArray(f)?a.P.convert(f):a.P.convert(f[n]||[0,0])}return{version:N,supported:ie.supported,setRTLTextPlugin:a.dC,getRTLTextPluginStatus:a.dD,Map:class extends ag{constructor(f){q.mark(G.create);const n=f;if((f=a.l({},cg,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&a.dx(window)&&(f.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Vd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new O0,this._domRenderTaskQueue=new O0,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.aP(),this._locale=a.l({},dw,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Oh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new yt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?{...f.contextCreateOptions}:{},typeof f.container=="string"){const s=document.getElementById(f.container);if(!s)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=s}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),a.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new fw),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ho(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||a.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new cl(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const s=f.bounds;s&&(this.resize(),this.fitBounds(s,a.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Af({customAttribution:f.customAttribution})),this._logoControl=new sg,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.x(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.x(`${s.dataType}dataloading`,s))}),this._interactions=new lg(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new a.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(s,p.firstChild):p.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new a.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.x("movestart",f)).fire(new a.x("move",f)),this.fire(new a.x("resize",f)),n&&this.fire(new a.x("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(a.as.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new a.x("zoomstart")).fire(new a.x("zoom")).fire(new a.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new a.x("zoomstart")).fire(new a.x("zoom")).fire(new a.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new a.x("pitchstart")).fire(new a.x("pitch")).fire(new a.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new a.x("pitchstart")).fire(new a.x("pitch")).fire(new a.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let s;n==="globe"&&f.zoom>=a.bU?(f.setMercatorFromTransition(),s=!0):n==="mercator"&&f.zoom<a.bU&&(f.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;return n=f.name==="globe"&&this.transform.zoom>=a.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(a.bK.convert(f))}unproject(f){return this.transform.pointLocation3D(a.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,s){if(f==="mouseenter"||f==="mouseover"){let p=!1;const _=w=>{const A=n.filter(L=>this.getLayer(L)),k=A.length?this.queryRenderedFeatures(w.point,{layers:A}):[];k.length?p||(p=!0,s.call(this,new xo(f,this,w.originalEvent,{features:k}))):p=!1},x=()=>{p=!1};return{layers:new Set(n),listener:s,delegates:{mousemove:_,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let p=!1;const _=w=>{const A=n.filter(k=>this.getLayer(k));(A.length?this.queryRenderedFeatures(w.point,{layers:A}):[]).length?p=!0:p&&(p=!1,s.call(this,new xo(f,this,w.originalEvent)))},x=w=>{p&&(p=!1,s.call(this,new xo(f,this,w.originalEvent)))};return{layers:new Set(n),listener:s,delegates:{mousemove:_,mouseout:x}}}{const p=_=>{const x=n.filter(A=>this.getLayer(A)),w=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];w.length&&(_.features=w,s.call(this,_),delete _.features)};return{layers:new Set(n),listener:s,delegates:{[f]:p}}}}on(f,n,s){if(typeof n=="function"||s===void 0)return super.on(f,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const p=this._createDelegatedListener(f,n,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(f,n,s){if(typeof n=="function"||s===void 0)return super.once(f,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const p=this._createDelegatedListener(f,n,s);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(f,n,s){if(typeof n=="function"||s===void 0)return super.off(f,n);const p=new Set(Array.isArray(n)?n:[n]);for(const w of p)if(!this._isValidId(w))return this;const _=(w,A)=>{if(w.size!==A.size)return!1;for(const k of w)if(!A.has(k))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(w=>{for(let A=0;A<w.length;A++){const k=w[A];if(k.listener===s&&_(k.layers,p)){for(const L in k.delegates)this.off(L,k.delegates[L]);return w.splice(A,1),this}}})(x),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(n!==void 0||f===void 0||f instanceof a.P||Array.isArray(f)||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const s of n.layers)if(!this._isValidId(s))return[]}return this.style.queryRenderedFeatures(f,n,this.transform)}querySourceFeatures(f,n){return this._isValidId(f)?this.style.querySourceFeatures(f,n):[]}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&a.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,n){return n=a.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,(s,p)=>{s?(a.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(f,n)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const s=a.l({},n);n&&n.config&&(s.initialConfig=n.config,delete s.config),this.style=new Yo(this,s).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Yo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new a.t(new Error("IDs can't be empty."))),!1):!a.cn(f)||(this.fire(new a.t(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,s){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,s)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:s=1,sdf:p=!1,stretchX:_,stretchY:x,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:A,height:k,data:L}=a.q.getImageData(n);this.style.addImage(f,{data:new a.r({width:A,height:k},L),pixelRatio:s,stretchX:_,stretchY:x,content:w,sdf:p,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new a.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:k}=n,L=n;this.style.addImage(f,{data:new a.r({width:A,height:k},new Uint8Array(L.data)),pixelRatio:s,stretchX:_,stretchY:x,content:w,sdf:p,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const s=this.style.getImage(f);if(!s)return void this.fire(new a.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?a.q.getImageData(n):n,{width:_,height:x,data:w}=p;if(_===void 0||x===void 0)return void this.fire(new a.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==s.data.width||x!==s.data.height)return void this.fire(new a.t(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));const A=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);s.data.replace(w,A),this.style.updateImage(f,s)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new a.t(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,n){a.o(this._requestManager.transformRequest(f,a.R.Image),(s,p)=>{n(s,p instanceof HTMLImageElement?a.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new a.t(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,s){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,s),this._update(!0)):this}setFilter(f,n,s={}){return this._isValidId(f)?(this.style.setFilter(f,n,s),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,s,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,s,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,s,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,s,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,s){return this.style.setConfigProperty(f,n,s),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.bK.convert(f),this.transform):0}setFeatureState(f,n){return this._isValidId(f.source)?(this.style.setFeatureState(f,n),this._update()):this}removeFeatureState(f,n){return this._isValidId(f.source)?(this.style.removeFeatureState(f,n),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let s,p,_,x=this._container;for(;x&&(!p||!_);){const w=window.getComputedStyle(x).transform;w&&w!=="none"&&(s=w.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(p=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(_=s[3])),x=x.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=pe("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=pe("div","mapboxgl-canvas-container",f);this._canvas=pe("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=pe("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{p[_]=pe("div",`mapboxgl-ctrl-${_}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const s=a.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(f),this._canvas.height=s*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=a.l({},ie.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(cr(n,!0),this.painter=new Ym(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.m.testSupport(n)):this.fire(new a.t(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.x("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new a.x("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new a.x("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,p=a.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=_.createQuery(),_.beginQuery(s.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,z=this.transform.pitch,U=a.q.now(),j=new a.a3(L,{now:U,fadeDuration:x,pitch:z,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,q.mark(G.load),this.fire(new a.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const L=a.q.now()-p;_.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const z=_.getQueryParameter(n,_.QUERY_RESULT)/1e6;_.deleteQuery(n),this.fire(new a.x("gpu-timing-frame",{cpuTime:L,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(L);this.fire(new a.x("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.x("gpu-timing-deferred-render",{gpuTime:z}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(k||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new a.x("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,q.mark(G.fullLoad),this._performanceMetricsCollection&&qt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const s=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const w=Math.abs(_-x);if(w>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(x),s(x);this._averageElevation.easeTo(x,f,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),s(x)}return!!this._averageElevation.isEasing(f)&&s(this._averageElevation.getValue(f))}_authenticate(){be(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Mt||f.status===401)){const n=this.painter.context.gl;cr(n,!1),this._logoControl instanceof sg&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),$t(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Bt(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const s=this.painter.context.gl,p=s.createFramebuffer();function _(x){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,x,0);const w=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,w),w}return s.bindFramebuffer(s.FRAMEBUFFER,p),this._canvasPixelComparison(_(f),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(f,n,s){let p=s[1]-s[0];const _=f.length/4;for(let x=0;x<n.length;x++){const w=n[x];let A=0;for(let k=0;k<w.length;k+=4)w[k]===f[k]&&w[k+1]===f[k+1]&&w[k+2]===f[k+2]&&w[k+3]===f[k+3]&&(A+=1);p+=(s[x+2]-s[x+1])*(1-A/_)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),er.delete(this.painter.context.gl),Wt.remove(),ct.remove(),this._removed=!0,this.fire(new a.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=a.q.frame(n=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(n)}))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return a.bf(n,(s,p)=>s._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,n){a.dy(f,n)}get version(){return N}},NavigationControl:class{constructor(f={}){this.options=a.l({},Lh,f),this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),pe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),pe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:n}):s.resetNorth({},{originalEvent:n}))}),this._compassIcon=pe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),s=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new iu(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const s=pe("button",f,this._container);return s.type="button",s.addEventListener("click",n),s}_setButtonTitle(f,n){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",s),f.firstElementChild&&f.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends a.E{constructor(f={}){super();const n=navigator.geolocation;this.options=a.l({geolocation:n},Xl,f),a.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Cs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,f(s)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>n(s.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),s=f.coords;return!!n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new a.x("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.x("geolocate",f)),this._finish()}}_updateCamera(f){const n=new a.bK(f.coords.longitude,f.coords.latitude),s=f.coords.accuracy,p=this._map.getBearing(),_=a.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(s),_,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new a.bK(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=a.bD(1,f._center.lat)*f.worldSize,s=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.x("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=pe("button","mapboxgl-ctrl-geolocate",this._container),pe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=pe("div","mapboxgl-user-location"),this._dotElement.appendChild(pe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(pe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new os({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=pe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new os({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.x("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Af,ScaleControl:class{constructor(f={}){this.options=a.l({},hl,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,s=n._containerHeight/2,p=n._containerWidth/2-f/2,_=n.unproject([p,s]),x=n.unproject([p+f,s]),w=_.distanceTo(x);if(this.options.unit==="imperial"){const A=3.2808*w;A>5280?this._setScale(f,A/5280,"mile"):this._setScale(f,A,"foot")}else this.options.unit==="nautical"?this._setScale(f,w/1852,"nautical-mile"):w>=1e3?this._setScale(f,w/1e3,"kilometer"):this._setScale(f,w,"meter")}_setScale(f,n,s){this._map._requestDomTask(()=>{const p=function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let A=x/w;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L}(A),w*A}(n),_=p/n;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(p):`${p}&nbsp;${pw[s]}`,this._container.style.width=f*_+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:a.w("Full screen control 'container' must be a DOM element.")),a.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=pe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);pe("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(f){super(),this.options=a.l(Object.create(mw),f),a.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new a.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new a.x("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=a.bK.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),s=document.createElement("body");let p;for(s.innerHTML=f;p=s.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=pe("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const s=this._closeButton=pe("button","mapboxgl-popup-close-button",n);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,s=this._container,p=this._pos;if(!n||!s||!p)return"bottom";const _=s.offsetWidth,x=s.offsetHeight,w=p.x<_/2,A=p.x>n.transform.width-_/2;if(p.y+f<x)return w?"top-left":A?"top-right":"top";if(p.y>n.transform.height-x){if(w)return"bottom-left";if(A)return"bottom-right"}return w?"left":A?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,s=this._content;if(!n||!this._lngLat&&!this._trackPointer||!s)return;let p=this._container;if(p||(p=this._container=pe("div","mapboxgl-popup",n.getContainer()),this._tip=pe("div","mapboxgl-popup-tip",p),p.appendChild(s)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=is(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const _=this._pos=this._trackPointer&&f instanceof a.P?f:n.project(this._lngLat),x=L0(this.options.offset),w=this._anchor=this._getAnchor(x.y),A=L0(this.options.offset,w),k=_.add(A).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Ko[w]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=a.dz(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(gw);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:os,Style:Yo,LngLat:a.bK,LngLatBounds:a.as,Point:a.P,MercatorCoordinate:a.a5,FreeCameraOptions:rl,Evented:a.E,config:a.e,prewarm:a.dE,clearPrewarmedResources:a.dF,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(f){a.e.ACCESS_TOKEN=f},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(f){a.e.API_URL=f},get workerCount(){return a.dG.workerCount},set workerCount(f){a.dG.workerCount=f},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){a.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){a.dH(f)},get workerUrl(){return a.dI.workerUrl},set workerUrl(f){a.dI.workerUrl=f},get workerClass(){return a.dI.workerClass},set workerClass(f){a.dI.workerClass=f},get workerParams(){return a.dI.workerParams},set workerParams(f){a.dI.workerParams=f},get dracoUrl(){return a.dJ()},set dracoUrl(f){a.dK(f)},get meshoptUrl(){return a.dL()},set meshoptUrl(f){a.dM(f)},setNow:a.q.setNow,restoreNow:a.q.restoreNow}});var R=y;return R})})(C5);var Vee=C5.exports;const x1=ly(Vee);x1.accessToken="pk.eyJ1IjoiYWJkdWxsYWgyMi0yMiIsImEiOiJjbTJvaHZ5dnYwNzB4MmxzaWFvcGJxbGVsIn0.jxfAbPp1oJn1sChxn32nQA";const $ee=e=>new x1.Map({container:e,style:"mapbox://styles/mapbox/streets-v11",center:[24.92220464661415,60.16032749891157],zoom:10,interactive:!0}),Wee=(e,t)=>{e.flyTo({center:t,zoom:12,essential:!0})},cI=()=>{const e=we.useRef(null),[t,i]=we.useState(null),[l,d]=we.useState(""),[y,S]=we.useState([]),[R,a]=we.useState(!1);we.useEffect(()=>{const G=$ee(e.current);return i(G),()=>G.remove()},[]);const N=async()=>{if(!l.trim()){alert("Please enter a city or country name!");return}a(!0),S([]);try{const G=await Uee(l);if(G){const[X,oe]=G.geometry.coordinates,te=new x1.Marker({anchor:"center"}).setLngLat([X,oe]).addTo(t);te.getElement().style.pointerEvents="none",Wee(t,[X,oe])}const q=await jee(l);S(q),q.length===0?alert("No hotels found in this location."):q.forEach(X=>{if(X.latitude&&X.longitude){const oe=new x1.Marker({anchor:"center"}).setLngLat([X.longitude,X.latitude]).addTo(t);oe.getElement().style.pointerEvents="none"}console.log(X.longitude,X.latitude)})}catch(G){console.error("Error fetching data:",G),alert("An error occurred while searching. Please try again later.")}finally{a(!1)}};return ne.createElement(Pu,{sx:{display:"flex",flexDirection:"row"}},ne.createElement(Pu,{sx:{width:"300px",padding:"20px",overflowY:"auto"}},ne.createElement(M5,{label:"Search by city or country",variant:"outlined",fullWidth:!0,value:l,onChange:G=>d(G.target.value),style:{marginBottom:"10px"}}),ne.createElement(v5,{onClick:N,variant:"contained",color:"primary"},"Search"),R&&ne.createElement(A_,{variant:"h6",color:"primary",style:{marginTop:"20px"}},"Searching..."),ne.createElement(Pu,{style:{marginTop:"20px"}},ne.createElement(A_,{variant:"h5",gutterBottom:!0},"Hotels in ",l),y.length===0?ne.createElement(A_,null,"No hotels found in this city."):ne.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(1, 1fr)",gap:"20px"}},y.map(G=>ne.createElement("div",{key:G._id,className:"container",style:{border:"1px solid #ccc",padding:"15px"}},ne.createElement("img",{src:`http://localhost:5000/${G.photos&&G.photos.length>0?G.photos[0].replace(/\\/g,"/"):"default-image.jpg"}`,alt:G.name,style:{width:"100%",height:"200px",objectFit:"cover"}}),ne.createElement("h3",null,G.name),ne.createElement("p",null,ne.createElement("strong",null,"Country:")," ",G.country),ne.createElement("p",null,ne.createElement("strong",null,"City:")," ",G.city),ne.createElement("p",null,ne.createElement("strong",null,"Address:")," ",G.address),ne.createElement("p",null,ne.createElement("strong",null,"Cheapest Price:")," $",G.cheapestPrice),ne.createElement("p",null,ne.createElement("strong",null,"Max Price:")," $",G.maxPrice),ne.createElement("p",null,ne.createElement("strong",null,"Phone Number:")," ",G.phoneNumber),ne.createElement(Uu,{to:`/hotels/${G._id}/rooms`},"Go to Rooms")))))),ne.createElement(Pu,{sx:{flexGrow:1,height:"500px",marginTop:"20px"}},ne.createElement("div",{ref:e,style:{width:"100%",height:"100%"}})))},P5=()=>{const[e,t]=we.useState([]),[i,l]=we.useState(!0),[d,y]=we.useState(null),[S,R]=we.useState(null);we.useEffect(()=>{(async()=>{try{const G=await Rn.get("http://localhost:5000/api/hotels");t(G.data),l(!1)}catch(G){console.error("Error fetching hotels:",G),y("Failed to fetch hotels. Please try again."),l(!1)}})()},[]);const a=(N,G)=>{R([G,N])};return i?ne.createElement("p",null,"Loading hotels..."):d?ne.createElement("p",null,d):ne.createElement("div",null,ne.createElement("h2",null,"Available Hotels"),ne.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px"}},e.map(N=>ne.createElement("div",{key:N._id,className:"hotel-card"},ne.createElement("div",{className:"hotel-image"},ne.createElement("img",{src:`http://localhost:5000/${N.img?N.img.replace(/\\/g,"/"):"default-image.jpg"}`,alt:N.name,className:"hotel-img"})),ne.createElement("div",{className:"hotel-info"},ne.createElement("h3",null,N.name),ne.createElement("p",null,ne.createElement("strong",null,"Country:")," ",N.country),ne.createElement("p",null,ne.createElement("strong",null,"City:")," ",N.city),ne.createElement("p",null,ne.createElement("strong",null,"Address:")," ",N.address),ne.createElement("p",null,ne.createElement("strong",null,"Price:")," $",N.cheapestPrice),ne.createElement("p",null,ne.createElement("strong",null,"Max Price:")," $",N.maxPrice),ne.createElement("p",null,ne.createElement("strong",null,"Phone Number:")," ",N.phoneNumber),ne.createElement("button",{onClick:()=>a(N.latitude,N.longitude)},"Show on Map"),ne.createElement(Uu,{to:`/hotels/${N._id}/rooms`},"Go to Rooms"))))),S&&ne.createElement("div",{style:{height:"400px",marginTop:"20px"}},ne.createElement(cI,{selectedLocation:S})))},Gee="_FutureTrip_Wrapper_5wn18_1",Hee="_FutureTripCards_5wn18_11",qee="_FutureTripCard_5wn18_11",Zee="_FutureTripCardImage_5wn18_49",bu={FutureTrip_Wrapper:Gee,FutureTripCards:Hee,FutureTripCard:qee,FutureTripCardImage:Zee},Yee="/assets/Blog3-DGouW948.png",Xee="/assets/Blog2-CKm7TPox.png",Kee="/assets/Blog1-i3xfM73T.png";function Jee(){return ne.createElement("div",{className:`${bu.FutureTrip_Wrapper} section`,id:"inspiration"},ne.createElement("div",{className:bu.FutureTripCards},ne.createElement("div",{className:bu.FutureTripCard},ne.createElement("div",{className:bu.FutureTripCardImage},ne.createElement("img",{src:Kee,alt:""})),ne.createElement("h3",null,"10Europian ski Destination you should visit this winter"),ne.createElement("p",null,"jan-06-2024")),ne.createElement("div",{className:bu.FutureTripCard},ne.createElement("div",{className:bu.FutureTripCardImage},ne.createElement("img",{src:Xee,alt:""})),ne.createElement("h3",null,"Booking Travel To the most Beautiful Places in the World"),ne.createElement("p",null,"jan-14-2024")),ne.createElement("div",{className:bu.FutureTripCard},ne.createElement("div",{className:bu.FutureTripCardImage},ne.createElement("img",{src:Yee,alt:""})),ne.createElement("h3",null,"Where  can i go? 5 Amazing Countryies that open right now"),ne.createElement("p",null,"jan-06-2024"))))}const Qee=()=>ne.createElement("div",null,ne.createElement("div",{className:"Header_Container"},ne.createElement(Yp,null),ne.createElement(yK,null)),ne.createElement("div",null,ne.createElement("div",null,ne.createElement(Jee,null),ne.createElement(P5,null))),ne.createElement("div",{className:"footer"},ne.createElement(vK,null))),ete=()=>{const[e,t]=we.useState([]),[i,l]=we.useState(!0),[d,y]=we.useState(null),[S,R]=we.useState(null),a=Ku(),{destination:N,date:G,options:q,priceRange:X}=a.state||{};we.useEffect(()=>{(async()=>{if(!N||!X||X[0]>X[1]){y("Invalid parameters. Please check your inputs."),l(!1);return}try{const ie=await Rn.get("http://localhost:5000/api/hotels/filter",{params:{city:N,minPrice:X[0],maxPrice:X[1]}});t(ie.data),l(!1)}catch(ie){console.error("Error fetching hotels:",ie),y("Failed to attract hotels. Please try again."),l(!1)}})()},[N,X]);const oe=(te,ie)=>{R([ie,te])};return i?ne.createElement("p",null,"Loading hotels..."):d?ne.createElement("p",null,d):ne.createElement("div",null,ne.createElement(Yp,null),ne.createElement("h2",null,"Available Hotels"),ne.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px"}},e.map(te=>ne.createElement("div",{key:te._id,className:"container",style:{border:"1px solid #ccc",padding:"15px"}},ne.createElement("img",{src:`http://localhost:5000/${te.photos&&te.photos.length>0?te.photos[0].replace(/\\/g,"/"):"default-image.jpg"}`,alt:te.name,style:{width:"100%",height:"200px",objectFit:"cover"}}),ne.createElement("h3",null,te.name),ne.createElement("p",null,ne.createElement("strong",null,"Country:")," ",te.country),ne.createElement("p",null,ne.createElement("strong",null,"City:")," ",te.city),ne.createElement("p",null,ne.createElement("strong",null,"Address:")," ",te.address),ne.createElement("p",null,ne.createElement("strong",null,"Cheapest Price:")," $",te.cheapestPrice),ne.createElement("p",null,ne.createElement("strong",null,"Max Price:")," $",te.maxPrice),ne.createElement("p",null,ne.createElement("strong",null,"Phone Number:")," ",te.phoneNumber),ne.createElement("button",{onClick:()=>oe(te.latitude,te.longitude)},"Show on Map"),ne.createElement(Uu,{to:`/hotels/${te._id}/rooms`,style:{display:"block",marginTop:"10px"}},"Go to Rooms")))),S&&ne.createElement("div",{style:{height:"400px",marginTop:"20px"}},ne.createElement(cI,{selectedLocation:S})))},tte=()=>{const{hotelId:e}=i4(),[t,i]=we.useState([]),[l,d]=we.useState(!0),[y,S]=we.useState(null);return we.useEffect(()=>{(async()=>{try{const a=await Rn.get(`http://localhost:5000/api/hotels/${e}/rooms`);i(a.data),d(!1)}catch(a){console.error("Error fetching rooms:",a),S("Failed to fetch rooms. Please try again."),d(!1)}})()},[e]),l?ne.createElement("p",null,"Loading rooms..."):y?ne.createElement("p",null,y):ne.createElement("div",{className:"hotel-rooms-container"},ne.createElement(Yp,null),ne.createElement("h2",null,"Available Rooms"),ne.createElement("div",{className:"room-grid"},t.map(R=>ne.createElement("div",{key:R._id,className:"room-card"},ne.createElement("div",{className:"room-image"},ne.createElement("img",{src:`http://localhost:5000/${R.img?R.img.replace(/\\/g,"/"):"default-image.jpg"}`,alt:R.title,className:"room-img"})),ne.createElement("div",{className:"room-info"},ne.createElement("h3",null,R.title),ne.createElement("p",null,R.details),ne.createElement("p",null,ne.createElement("strong",null,"Price:")," $",R.price),ne.createElement("p",null,ne.createElement("strong",null,"Room Number:")," ",R.roomNumber),ne.createElement(Uu,{to:`/hotels/${e}/rooms/${R._id}`,className:"room-details-link"},"Room Details"))))))};var KE={exports:{}},bd={},JE={exports:{}},Js={},QE={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=G;/*!
 * Adapted from jQuery UI core
 *
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */var i="none",l="contents",d=/^(input|select|textarea|button|object|iframe)$/;function y(q,X){return X.getPropertyValue("overflow")!=="visible"||q.scrollWidth<=0&&q.scrollHeight<=0}function S(q){var X=q.offsetWidth<=0&&q.offsetHeight<=0;if(X&&!q.innerHTML)return!0;try{var oe=window.getComputedStyle(q),te=oe.getPropertyValue("display");return X?te!==l&&y(q,oe):te===i}catch{return console.warn("Failed to inspect element style"),!1}}function R(q){for(var X=q,oe=q.getRootNode&&q.getRootNode();X&&X!==document.body;){if(oe&&X===oe&&(X=oe.host.parentNode),S(X))return!1;X=X.parentNode}return!0}function a(q,X){var oe=q.nodeName.toLowerCase(),te=d.test(oe)&&!q.disabled||oe==="a"&&q.href||X;return te&&R(q)}function N(q){var X=q.getAttribute("tabindex");X===null&&(X=void 0);var oe=isNaN(X);return(oe||X>=0)&&a(q,!oe)}function G(q){var X=[].slice.call(q.querySelectorAll("*"),0).reduce(function(oe,te){return oe.concat(te.shadowRoot?G(te.shadowRoot):[te])},[]);return X.filter(N)}e.exports=t.default})(QE,QE.exports);var A5=QE.exports;Object.defineProperty(Js,"__esModule",{value:!0});Js.resetState=ote;Js.log=ate;Js.handleBlur=ay;Js.handleFocus=sy;Js.markForFocusLater=ste;Js.returnFocus=lte;Js.popWithoutFocus=cte;Js.setupScopedFocus=ute;Js.teardownScopedFocus=hte;var rte=A5,nte=ite(rte);function ite(e){return e&&e.__esModule?e:{default:e}}var jp=[],_p=null,eM=!1;function ote(){jp=[]}function ate(){}function ay(){eM=!0}function sy(){if(eM){if(eM=!1,!_p)return;setTimeout(function(){if(!_p.contains(document.activeElement)){var e=(0,nte.default)(_p)[0]||_p;e.focus()}},0)}}function ste(){jp.push(document.activeElement)}function lte(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=null;try{jp.length!==0&&(t=jp.pop(),t.focus({preventScroll:e}));return}catch{console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}}function cte(){jp.length>0&&jp.pop()}function ute(e){_p=e,window.addEventListener?(window.addEventListener("blur",ay,!1),document.addEventListener("focus",sy,!0)):(window.attachEvent("onBlur",ay),document.attachEvent("onFocus",sy))}function hte(){_p=null,window.addEventListener?(window.removeEventListener("blur",ay),document.removeEventListener("focus",sy)):(window.detachEvent("onBlur",ay),document.detachEvent("onFocus",sy))}var tM={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=S;var i=A5,l=d(i);function d(R){return R&&R.__esModule?R:{default:R}}function y(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;return R.activeElement.shadowRoot?y(R.activeElement.shadowRoot):R.activeElement}function S(R,a){var N=(0,l.default)(R);if(!N.length){a.preventDefault();return}var G=void 0,q=a.shiftKey,X=N[0],oe=N[N.length-1],te=y();if(R===te){if(!q)return;G=oe}if(oe===te&&!q&&(G=X),X===te&&q&&(G=oe),G){a.preventDefault(),G.focus();return}var ie=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent),pe=ie!=null&&ie[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(pe){var se=N.indexOf(te);if(se>-1&&(se+=q?-1:1),G=N[se],typeof G>"u"){a.preventDefault(),G=q?oe:X,G.focus();return}a.preventDefault(),G.focus()}}e.exports=t.default})(tM,tM.exports);var dte=tM.exports,Qs={},fte=function(){},pte=fte,Hs={},D5={exports:{}};/*!
  Copyright (c) 2015 Jed Watson.
  Based on code that is Copyright 2013-2015, Facebook, Inc.
  All rights reserved.
*/(function(e){(function(){var t=!!(typeof window<"u"&&window.document&&window.document.createElement),i={canUseDOM:t,canUseWorkers:typeof Worker<"u",canUseEventListeners:t&&!!(window.addEventListener||window.attachEvent),canUseViewport:t&&!!window.screen};e.exports?e.exports=i:window.ExecutionEnvironment=i})()})(D5);var mte=D5.exports;Object.defineProperty(Hs,"__esModule",{value:!0});Hs.canUseDOM=Hs.SafeNodeList=Hs.SafeHTMLCollection=void 0;var gte=mte,_te=yte(gte);function yte(e){return e&&e.__esModule?e:{default:e}}var Ub=_te.default,vte=Ub.canUseDOM?window.HTMLElement:{};Hs.SafeHTMLCollection=Ub.canUseDOM?window.HTMLCollection:{};Hs.SafeNodeList=Ub.canUseDOM?window.NodeList:{};Hs.canUseDOM=Ub.canUseDOM;Hs.default=vte;Object.defineProperty(Qs,"__esModule",{value:!0});Qs.resetState=Tte;Qs.log=Ete;Qs.assertNodeList=R5;Qs.setElement=Mte;Qs.validateElement=uI;Qs.hide=Cte;Qs.show=Ite;Qs.documentNotReadyOrSSRTesting=Pte;var xte=pte,bte=Ste(xte),wte=Hs;function Ste(e){return e&&e.__esModule?e:{default:e}}var fs=null;function Tte(){fs&&(fs.removeAttribute?fs.removeAttribute("aria-hidden"):fs.length!=null?fs.forEach(function(e){return e.removeAttribute("aria-hidden")}):document.querySelectorAll(fs).forEach(function(e){return e.removeAttribute("aria-hidden")})),fs=null}function Ete(){}function R5(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function Mte(e){var t=e;if(typeof t=="string"&&wte.canUseDOM){var i=document.querySelectorAll(t);R5(i,t),t=i}return fs=t||fs,fs}function uI(e){var t=e||fs;return t?Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList?t:[t]:((0,bte.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}function Cte(e){var t=!0,i=!1,l=void 0;try{for(var d=uI(e)[Symbol.iterator](),y;!(t=(y=d.next()).done);t=!0){var S=y.value;S.setAttribute("aria-hidden","true")}}catch(R){i=!0,l=R}finally{try{!t&&d.return&&d.return()}finally{if(i)throw l}}}function Ite(e){var t=!0,i=!1,l=void 0;try{for(var d=uI(e)[Symbol.iterator](),y;!(t=(y=d.next()).done);t=!0){var S=y.value;S.removeAttribute("aria-hidden")}}catch(R){i=!0,l=R}finally{try{!t&&d.return&&d.return()}finally{if(i)throw l}}}function Pte(){fs=null}var tm={};Object.defineProperty(tm,"__esModule",{value:!0});tm.resetState=Ate;tm.log=Dte;var k_={},O_={};function AO(e,t){e.classList.remove(t)}function Ate(){var e=document.getElementsByTagName("html")[0];for(var t in k_)AO(e,k_[t]);var i=document.body;for(var l in O_)AO(i,O_[l]);k_={},O_={}}function Dte(){}var Rte=function(t,i){return t[i]||(t[i]=0),t[i]+=1,i},kte=function(t,i){return t[i]&&(t[i]-=1),i},Ote=function(t,i,l){l.forEach(function(d){Rte(i,d),t.add(d)})},Lte=function(t,i,l){l.forEach(function(d){kte(i,d),i[d]===0&&t.remove(d)})};tm.add=function(t,i){return Ote(t.classList,t.nodeName.toLowerCase()=="html"?k_:O_,i.split(" "))};tm.remove=function(t,i){return Lte(t.classList,t.nodeName.toLowerCase()=="html"?k_:O_,i.split(" "))};var rm={};Object.defineProperty(rm,"__esModule",{value:!0});rm.log=Fte;rm.resetState=Bte;function zte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var k5=function e(){var t=this;zte(this,e),this.register=function(i){t.openInstances.indexOf(i)===-1&&(t.openInstances.push(i),t.emit("register"))},this.deregister=function(i){var l=t.openInstances.indexOf(i);l!==-1&&(t.openInstances.splice(l,1),t.emit("deregister"))},this.subscribe=function(i){t.subscribers.push(i)},this.emit=function(i){t.subscribers.forEach(function(l){return l(i,t.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},b1=new k5;function Fte(){console.log("portalOpenInstances ----------"),console.log(b1.openInstances.length),b1.openInstances.forEach(function(e){return console.log(e)}),console.log("end portalOpenInstances ----------")}function Bte(){b1=new k5}rm.default=b1;var hI={};Object.defineProperty(hI,"__esModule",{value:!0});hI.resetState=Vte;hI.log=$te;var Nte=rm,Ute=jte(Nte);function jte(e){return e&&e.__esModule?e:{default:e}}var Uo=void 0,Us=void 0,dd=[];function Vte(){for(var e=[Uo,Us],t=0;t<e.length;t++){var i=e[t];i&&i.parentNode&&i.parentNode.removeChild(i)}Uo=Us=null,dd=[]}function $te(){console.log("bodyTrap ----------"),console.log(dd.length);for(var e=[Uo,Us],t=0;t<e.length;t++){var i=e[t],l=i||{};console.log(l.nodeName,l.className,l.id)}console.log("edn bodyTrap ----------")}function DO(){dd.length!==0&&dd[dd.length-1].focusContent()}function Wte(e,t){!Uo&&!Us&&(Uo=document.createElement("div"),Uo.setAttribute("data-react-modal-body-trap",""),Uo.style.position="absolute",Uo.style.opacity="0",Uo.setAttribute("tabindex","0"),Uo.addEventListener("focus",DO),Us=Uo.cloneNode(),Us.addEventListener("focus",DO)),dd=t,dd.length>0?(document.body.firstChild!==Uo&&document.body.insertBefore(Uo,document.body.firstChild),document.body.lastChild!==Us&&document.body.appendChild(Us)):(Uo.parentElement&&Uo.parentElement.removeChild(Uo),Us.parentElement&&Us.parentElement.removeChild(Us))}Ute.default.subscribe(Wte);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(Mt){for(var yt=1;yt<arguments.length;yt++){var gt=arguments[yt];for(var Ze in gt)Object.prototype.hasOwnProperty.call(gt,Ze)&&(Mt[Ze]=gt[Ze])}return Mt},l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Mt){return typeof Mt}:function(Mt){return Mt&&typeof Symbol=="function"&&Mt.constructor===Symbol&&Mt!==Symbol.prototype?"symbol":typeof Mt},d=function(){function Mt(yt,gt){for(var Ze=0;Ze<gt.length;Ze++){var ht=gt[Ze];ht.enumerable=ht.enumerable||!1,ht.configurable=!0,"value"in ht&&(ht.writable=!0),Object.defineProperty(yt,ht.key,ht)}}return function(yt,gt,Ze){return gt&&Mt(yt.prototype,gt),Ze&&Mt(yt,Ze),yt}}(),y=we,S=Ya,R=Le(S),a=Js,N=Me(a),G=dte,q=Le(G),X=Qs,oe=Me(X),te=tm,ie=Me(te),pe=Hs,se=Le(pe),le=rm,ce=Le(le);function Me(Mt){if(Mt&&Mt.__esModule)return Mt;var yt={};if(Mt!=null)for(var gt in Mt)Object.prototype.hasOwnProperty.call(Mt,gt)&&(yt[gt]=Mt[gt]);return yt.default=Mt,yt}function Le(Mt){return Mt&&Mt.__esModule?Mt:{default:Mt}}function Je(Mt,yt){if(!(Mt instanceof yt))throw new TypeError("Cannot call a class as a function")}function Qe(Mt,yt){if(!Mt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return yt&&(typeof yt=="object"||typeof yt=="function")?yt:Mt}function je(Mt,yt){if(typeof yt!="function"&&yt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof yt);Mt.prototype=Object.create(yt&&yt.prototype,{constructor:{value:Mt,enumerable:!1,writable:!0,configurable:!0}}),yt&&(Object.setPrototypeOf?Object.setPrototypeOf(Mt,yt):Mt.__proto__=yt)}var Ct={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},ye=function(yt){return yt.code==="Tab"||yt.keyCode===9},et=function(yt){return yt.code==="Escape"||yt.keyCode===27},dt=0,Xt=function(Mt){je(yt,Mt);function yt(gt){Je(this,yt);var Ze=Qe(this,(yt.__proto__||Object.getPrototypeOf(yt)).call(this,gt));return Ze.setOverlayRef=function(ht){Ze.overlay=ht,Ze.props.overlayRef&&Ze.props.overlayRef(ht)},Ze.setContentRef=function(ht){Ze.content=ht,Ze.props.contentRef&&Ze.props.contentRef(ht)},Ze.afterClose=function(){var ht=Ze.props,Dt=ht.appElement,Tt=ht.ariaHideApp,tr=ht.htmlOpenClassName,Vr=ht.bodyOpenClassName,Nr=ht.parentSelector,ct=Nr&&Nr().ownerDocument||document;Vr&&ie.remove(ct.body,Vr),tr&&ie.remove(ct.getElementsByTagName("html")[0],tr),Tt&&dt>0&&(dt-=1,dt===0&&oe.show(Dt)),Ze.props.shouldFocusAfterRender&&(Ze.props.shouldReturnFocusAfterClose?(N.returnFocus(Ze.props.preventScroll),N.teardownScopedFocus()):N.popWithoutFocus()),Ze.props.onAfterClose&&Ze.props.onAfterClose(),ce.default.deregister(Ze)},Ze.open=function(){Ze.beforeOpen(),Ze.state.afterOpen&&Ze.state.beforeClose?(clearTimeout(Ze.closeTimer),Ze.setState({beforeClose:!1})):(Ze.props.shouldFocusAfterRender&&(N.setupScopedFocus(Ze.node),N.markForFocusLater()),Ze.setState({isOpen:!0},function(){Ze.openAnimationFrame=requestAnimationFrame(function(){Ze.setState({afterOpen:!0}),Ze.props.isOpen&&Ze.props.onAfterOpen&&Ze.props.onAfterOpen({overlayEl:Ze.overlay,contentEl:Ze.content})})}))},Ze.close=function(){Ze.props.closeTimeoutMS>0?Ze.closeWithTimeout():Ze.closeWithoutTimeout()},Ze.focusContent=function(){return Ze.content&&!Ze.contentHasFocus()&&Ze.content.focus({preventScroll:!0})},Ze.closeWithTimeout=function(){var ht=Date.now()+Ze.props.closeTimeoutMS;Ze.setState({beforeClose:!0,closesAt:ht},function(){Ze.closeTimer=setTimeout(Ze.closeWithoutTimeout,Ze.state.closesAt-Date.now())})},Ze.closeWithoutTimeout=function(){Ze.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},Ze.afterClose)},Ze.handleKeyDown=function(ht){ye(ht)&&(0,q.default)(Ze.content,ht),Ze.props.shouldCloseOnEsc&&et(ht)&&(ht.stopPropagation(),Ze.requestClose(ht))},Ze.handleOverlayOnClick=function(ht){Ze.shouldClose===null&&(Ze.shouldClose=!0),Ze.shouldClose&&Ze.props.shouldCloseOnOverlayClick&&(Ze.ownerHandlesClose()?Ze.requestClose(ht):Ze.focusContent()),Ze.shouldClose=null},Ze.handleContentOnMouseUp=function(){Ze.shouldClose=!1},Ze.handleOverlayOnMouseDown=function(ht){!Ze.props.shouldCloseOnOverlayClick&&ht.target==Ze.overlay&&ht.preventDefault()},Ze.handleContentOnClick=function(){Ze.shouldClose=!1},Ze.handleContentOnMouseDown=function(){Ze.shouldClose=!1},Ze.requestClose=function(ht){return Ze.ownerHandlesClose()&&Ze.props.onRequestClose(ht)},Ze.ownerHandlesClose=function(){return Ze.props.onRequestClose},Ze.shouldBeClosed=function(){return!Ze.state.isOpen&&!Ze.state.beforeClose},Ze.contentHasFocus=function(){return document.activeElement===Ze.content||Ze.content.contains(document.activeElement)},Ze.buildClassName=function(ht,Dt){var Tt=(typeof Dt>"u"?"undefined":l(Dt))==="object"?Dt:{base:Ct[ht],afterOpen:Ct[ht]+"--after-open",beforeClose:Ct[ht]+"--before-close"},tr=Tt.base;return Ze.state.afterOpen&&(tr=tr+" "+Tt.afterOpen),Ze.state.beforeClose&&(tr=tr+" "+Tt.beforeClose),typeof Dt=="string"&&Dt?tr+" "+Dt:tr},Ze.attributesFromObject=function(ht,Dt){return Object.keys(Dt).reduce(function(Tt,tr){return Tt[ht+"-"+tr]=Dt[tr],Tt},{})},Ze.state={afterOpen:!1,beforeClose:!1},Ze.shouldClose=null,Ze.moveFromContentToOverlay=null,Ze}return d(yt,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(Ze,ht){this.props.isOpen&&!Ze.isOpen?this.open():!this.props.isOpen&&Ze.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!ht.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var Ze=this.props,ht=Ze.appElement,Dt=Ze.ariaHideApp,Tt=Ze.htmlOpenClassName,tr=Ze.bodyOpenClassName,Vr=Ze.parentSelector,Nr=Vr&&Vr().ownerDocument||document;tr&&ie.add(Nr.body,tr),Tt&&ie.add(Nr.getElementsByTagName("html")[0],Tt),Dt&&(dt+=1,oe.hide(ht)),ce.default.register(this)}},{key:"render",value:function(){var Ze=this.props,ht=Ze.id,Dt=Ze.className,Tt=Ze.overlayClassName,tr=Ze.defaultStyles,Vr=Ze.children,Nr=Dt?{}:tr.content,ct=Tt?{}:tr.overlay;if(this.shouldBeClosed())return null;var $t={ref:this.setOverlayRef,className:this.buildClassName("overlay",Tt),style:i({},ct,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},Ht=i({id:ht,ref:this.setContentRef,style:i({},Nr,this.props.style.content),className:this.buildClassName("content",Dt),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",i({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),Bt=this.props.contentElement(Ht,Vr);return this.props.overlayElement($t,Bt)}}]),yt}(y.Component);Xt.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},Xt.propTypes={isOpen:R.default.bool.isRequired,defaultStyles:R.default.shape({content:R.default.object,overlay:R.default.object}),style:R.default.shape({content:R.default.object,overlay:R.default.object}),className:R.default.oneOfType([R.default.string,R.default.object]),overlayClassName:R.default.oneOfType([R.default.string,R.default.object]),parentSelector:R.default.func,bodyOpenClassName:R.default.string,htmlOpenClassName:R.default.string,ariaHideApp:R.default.bool,appElement:R.default.oneOfType([R.default.instanceOf(se.default),R.default.instanceOf(pe.SafeHTMLCollection),R.default.instanceOf(pe.SafeNodeList),R.default.arrayOf(R.default.instanceOf(se.default))]),onAfterOpen:R.default.func,onAfterClose:R.default.func,onRequestClose:R.default.func,closeTimeoutMS:R.default.number,shouldFocusAfterRender:R.default.bool,shouldCloseOnOverlayClick:R.default.bool,shouldReturnFocusAfterClose:R.default.bool,preventScroll:R.default.bool,role:R.default.string,contentLabel:R.default.string,aria:R.default.object,data:R.default.object,children:R.default.node,shouldCloseOnEsc:R.default.bool,overlayRef:R.default.func,contentRef:R.default.func,id:R.default.string,overlayElement:R.default.func,contentElement:R.default.func,testId:R.default.string},t.default=Xt,e.exports=t.default})(JE,JE.exports);var Gte=JE.exports;function O5(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);e!=null&&this.setState(e)}function L5(e){function t(i){var l=this.constructor.getDerivedStateFromProps(e,i);return l??null}this.setState(t.bind(this))}function z5(e,t){try{var i=this.props,l=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(i,l)}finally{this.props=i,this.state=l}}O5.__suppressDeprecationWarning=!0;L5.__suppressDeprecationWarning=!0;z5.__suppressDeprecationWarning=!0;function Hte(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if(typeof e.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function")return e;var i=null,l=null,d=null;if(typeof t.componentWillMount=="function"?i="componentWillMount":typeof t.UNSAFE_componentWillMount=="function"&&(i="UNSAFE_componentWillMount"),typeof t.componentWillReceiveProps=="function"?l="componentWillReceiveProps":typeof t.UNSAFE_componentWillReceiveProps=="function"&&(l="UNSAFE_componentWillReceiveProps"),typeof t.componentWillUpdate=="function"?d="componentWillUpdate":typeof t.UNSAFE_componentWillUpdate=="function"&&(d="UNSAFE_componentWillUpdate"),i!==null||l!==null||d!==null){var y=e.displayName||e.name,S=typeof e.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+y+" uses "+S+" but also contains the following legacy lifecycles:"+(i!==null?`
  `+i:"")+(l!==null?`
  `+l:"")+(d!==null?`
  `+d:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof e.getDerivedStateFromProps=="function"&&(t.componentWillMount=O5,t.componentWillReceiveProps=L5),typeof t.getSnapshotBeforeUpdate=="function"){if(typeof t.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=z5;var R=t.componentDidUpdate;t.componentDidUpdate=function(N,G,q){var X=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:q;R.call(this,N,G,X)}}return e}const qte=Object.freeze(Object.defineProperty({__proto__:null,polyfill:Hte},Symbol.toStringTag,{value:"Module"})),Zte=rM(qte);Object.defineProperty(bd,"__esModule",{value:!0});bd.bodyOpenClassName=bd.portalClassName=void 0;var RO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},Yte=function(){function e(t,i){for(var l=0;l<i.length;l++){var d=i[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(t,d.key,d)}}return function(t,i,l){return i&&e(t.prototype,i),l&&e(t,l),t}}(),F5=we,w1=Ry(F5),Xte=N1,S1=Ry(Xte),Kte=Ya,rn=Ry(Kte),Jte=Gte,kO=Ry(Jte),Qte=Qs,ere=rre(Qte),Au=Hs,OO=Ry(Au),tre=Zte;function rre(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function Ry(e){return e&&e.__esModule?e:{default:e}}function nre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LO(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function ire(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ore=bd.portalClassName="ReactModalPortal",are=bd.bodyOpenClassName="ReactModal__Body--open",td=Au.canUseDOM&&S1.default.createPortal!==void 0,zO=function(t){return document.createElement(t)},FO=function(){return td?S1.default.createPortal:S1.default.unstable_renderSubtreeIntoContainer};function ex(e){return e()}var ky=function(e){ire(t,e);function t(){var i,l,d,y;nre(this,t);for(var S=arguments.length,R=Array(S),a=0;a<S;a++)R[a]=arguments[a];return y=(l=(d=LO(this,(i=t.__proto__||Object.getPrototypeOf(t)).call.apply(i,[this].concat(R))),d),d.removePortal=function(){!td&&S1.default.unmountComponentAtNode(d.node);var N=ex(d.props.parentSelector);N&&N.contains(d.node)?N.removeChild(d.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},d.portalRef=function(N){d.portal=N},d.renderPortal=function(N){var G=FO(),q=G(d,w1.default.createElement(kO.default,RO({defaultStyles:t.defaultStyles},N)),d.node);d.portalRef(q)},l),LO(d,y)}return Yte(t,[{key:"componentDidMount",value:function(){if(Au.canUseDOM){td||(this.node=zO("div")),this.node.className=this.props.portalClassName;var l=ex(this.props.parentSelector);l.appendChild(this.node),!td&&this.renderPortal(this.props)}}},{key:"getSnapshotBeforeUpdate",value:function(l){var d=ex(l.parentSelector),y=ex(this.props.parentSelector);return{prevParent:d,nextParent:y}}},{key:"componentDidUpdate",value:function(l,d,y){if(Au.canUseDOM){var S=this.props,R=S.isOpen,a=S.portalClassName;l.portalClassName!==a&&(this.node.className=a);var N=y.prevParent,G=y.nextParent;G!==N&&(N.removeChild(this.node),G.appendChild(this.node)),!(!l.isOpen&&!R)&&!td&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(!(!Au.canUseDOM||!this.node||!this.portal)){var l=this.portal.state,d=Date.now(),y=l.isOpen&&this.props.closeTimeoutMS&&(l.closesAt||d+this.props.closeTimeoutMS);y?(l.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,y-d)):this.removePortal()}}},{key:"render",value:function(){if(!Au.canUseDOM||!td)return null;!this.node&&td&&(this.node=zO("div"));var l=FO();return l(w1.default.createElement(kO.default,RO({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function(l){ere.setElement(l)}}]),t}(F5.Component);ky.propTypes={isOpen:rn.default.bool.isRequired,style:rn.default.shape({content:rn.default.object,overlay:rn.default.object}),portalClassName:rn.default.string,bodyOpenClassName:rn.default.string,htmlOpenClassName:rn.default.string,className:rn.default.oneOfType([rn.default.string,rn.default.shape({base:rn.default.string.isRequired,afterOpen:rn.default.string.isRequired,beforeClose:rn.default.string.isRequired})]),overlayClassName:rn.default.oneOfType([rn.default.string,rn.default.shape({base:rn.default.string.isRequired,afterOpen:rn.default.string.isRequired,beforeClose:rn.default.string.isRequired})]),appElement:rn.default.oneOfType([rn.default.instanceOf(OO.default),rn.default.instanceOf(Au.SafeHTMLCollection),rn.default.instanceOf(Au.SafeNodeList),rn.default.arrayOf(rn.default.instanceOf(OO.default))]),onAfterOpen:rn.default.func,onRequestClose:rn.default.func,closeTimeoutMS:rn.default.number,ariaHideApp:rn.default.bool,shouldFocusAfterRender:rn.default.bool,shouldCloseOnOverlayClick:rn.default.bool,shouldReturnFocusAfterClose:rn.default.bool,preventScroll:rn.default.bool,parentSelector:rn.default.func,aria:rn.default.object,data:rn.default.object,role:rn.default.string,contentLabel:rn.default.string,shouldCloseOnEsc:rn.default.bool,overlayRef:rn.default.func,contentRef:rn.default.func,id:rn.default.string,overlayElement:rn.default.func,contentElement:rn.default.func};ky.defaultProps={isOpen:!1,portalClassName:ore,bodyOpenClassName:are,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(t,i){return w1.default.createElement("div",t,i)},contentElement:function(t,i){return w1.default.createElement("div",t,i)}};ky.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}};(0,tre.polyfill)(ky);bd.default=ky;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=bd,l=d(i);function d(y){return y&&y.__esModule?y:{default:y}}t.default=l.default,e.exports=t.default})(KE,KE.exports);var sre=KE.exports;const B5=ly(sre),lre=({reservationId:e,onPaymentSuccess:t,onPaymentError:i})=>{const l=w4(),d=x4(),[y,S]=we.useState(""),[R,a]=we.useState(""),[N,G]=we.useState(!1),[q,X]=we.useState(""),oe=async te=>{if(te.preventDefault(),G(!0),X(""),!l||!d){X("Stripe is not ready yet."),G(!1);return}try{const{data:ie}=await Rn.post("http://localhost:5000/api/payment",{amount:parseFloat(R)*100,email:y,reservationId:e}),pe=ie.clientSecret,se=d.getElement(Zx),{error:le,paymentIntent:ce}=await l.confirmCardPayment(pe,{payment_method:{card:se,billing_details:{email:y}}});le?i(le.message):ce.status==="succeeded"&&t(ce)}catch(ie){X(`An unexpected error occurred: ${ie.message}`),i(ie.message)}finally{G(!1)}};return ne.createElement("div",null,ne.createElement("h2",null,"Stripe Payment Form"),ne.createElement("form",{onSubmit:oe},ne.createElement("div",null,ne.createElement("input",{type:"email",placeholder:"Email",value:y,onChange:te=>S(te.target.value),required:!0})),ne.createElement("div",null,ne.createElement("input",{type:"number",placeholder:"Amount (USD)",value:R,onChange:te=>a(te.target.value),required:!0})),ne.createElement("div",null,ne.createElement(Zx,null)),ne.createElement("button",{type:"submit",disabled:N||!l},N?"Processing...":"Pay")),q&&ne.createElement("p",null,q))},cre={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"400px",padding:"20px"}};B5.setAppElement("#root");const N5=({roomId:e,hotelId:t})=>{const{state:i}=oC(),l=Hp(),d=Ku(),[y,S]=we.useState({roomId:e||"",userId:"",startDate:"",endDate:"",hotelId:t||""}),[R,a]=we.useState(null),[N,G]=we.useState(null),[q,X]=we.useState(!1),[oe,te]=we.useState(!1),[ie,pe]=we.useState(!1);we.useEffect(()=>{S(Le=>({...Le,roomId:e,userId:i.user?i.user.id:"",hotelId:t}))},[i.user,e,t]);const se=Le=>{const{name:Je,value:Qe}=Le.target;S(je=>({...je,[Je]:Qe}))},le=async Le=>{var Je,Qe;if(Le.preventDefault(),G(null),te(!0),!i.user){alert("You must be logged in to make a reservation."),l("/RegisterLogin",{state:{from:d}}),te(!1);return}try{const je=await Rn.post("http://localhost:5000/api/reservations",y);a(je.data),q&&pe(!0)}catch(je){G(((Qe=(Je=je.response)==null?void 0:Je.data)==null?void 0:Qe.message)||"An error occurred while creating the reservation.")}finally{te(!1)}},ce=Le=>{alert("Payment Successful"),console.log("Payment Data:",Le),a(Je=>({...Je,isPaid:!0})),pe(!1)},Me=Le=>{alert("Payment Failed"),console.log("Payment Error:",Le),G(`Payment error: ${Le}`)};return ne.createElement("div",null,ne.createElement("h2",null,"Create a Reservation"),R?ne.createElement("div",null,ne.createElement("h3",null,"Reservation Details"),ne.createElement("p",null,"Reservation ID: ",R._id),ne.createElement("p",null,"Room Number: ",R.roomnumber),ne.createElement("p",null,"User ID: ",R.userId),ne.createElement("p",null,"Start Date: ",new Date(R.startDate).toLocaleDateString()),ne.createElement("p",null,"End Date: ",new Date(R.endDate).toLocaleDateString()),ne.createElement("p",null,"Status: ",R.status),ne.createElement("p",null,"Payment Status: ",R.isPaid?"Paid":"Not Paid")," "):ne.createElement("form",{onSubmit:le},ne.createElement("div",null,ne.createElement("label",null,"Start Date:"),ne.createElement("input",{type:"date",name:"startDate",value:y.startDate,onChange:se,required:!0})),ne.createElement("div",null,ne.createElement("label",null,"End Date:"),ne.createElement("input",{type:"date",name:"endDate",value:y.endDate,onChange:se,required:!0})),ne.createElement("div",null,ne.createElement("label",null,ne.createElement("input",{type:"checkbox",checked:q,onChange:Le=>X(Le.target.checked)}),"Pay Now")),ne.createElement("button",{type:"submit",disabled:oe},oe?"Creating...":"Create Reservation")),ne.createElement(B5,{isOpen:ie,onRequestClose:()=>pe(!1),style:cre,contentLabel:"Payment Modal"},ne.createElement("h2",null,"Payment"),ne.createElement(lre,{reservationId:R==null?void 0:R._id,onPaymentSuccess:ce,onPaymentError:Me}),ne.createElement("button",{onClick:()=>pe(!1),style:{marginTop:"10px"}},"Close")),N&&ne.createElement("p",{style:{color:"red"}},"Error: ",N))},ure=()=>{const{hotelId:e,roomId:t}=i4(),[i,l]=we.useState(null),[d,y]=we.useState(!0),[S,R]=we.useState(null),[a,N]=we.useState(!1);return we.useEffect(()=>{(async()=>{try{const q=await Rn.get(`http://localhost:5000/api/hotels/${e}/rooms/${t}`);l(q.data),y(!1)}catch(q){console.error("Error fetching room details:",q),R("Failed to fetch room details. Please try again."),y(!1)}})()},[e,t]),d?ne.createElement("p",null,"Loading room details..."):S?ne.createElement("p",null,S):ne.createElement("div",null,ne.createElement(Yp,null),ne.createElement("h2",null,i.title),ne.createElement("img",{src:`http://localhost:5000/${i.img?i.img.replace(/\\/g,"/"):"default-image.jpg"}`,alt:i.title,style:{width:"100%",height:"300px",objectFit:"cover"}}),ne.createElement("p",null,i.details),ne.createElement("p",null,ne.createElement("strong",null,"Price:")," $",i.price),ne.createElement("p",null,ne.createElement("strong",null,"Location:")," ",i.location),ne.createElement("button",{onClick:()=>N(!0)},"Book Now"),a&&ne.createElement(N5,{roomId:t,hotelId:e}))},hre=h4("pk_test_51QFvkhLAzYW8YRzjlm4VYKp19bMXpFMoHcCsHM3wda661NR4YOjHO2iyXMrDZmNqKfGUNXD5neKjeUmt1mTClIgc00RBYWEAAX"),dre=({reservationId:e,onPaymentSuccess:t,onPaymentError:i})=>{const l=w4(),d=x4(),[y,S]=we.useState(""),[R,a]=we.useState(""),[N,G]=we.useState(!1),[q,X]=we.useState(""),oe=async te=>{if(te.preventDefault(),G(!0),X(""),!l||!d){X("Stripe is not ready yet."),G(!1);return}try{const{data:ie}=await Rn.post("http://localhost:5000/api/payment",{amount:parseFloat(R)*100,email:y,reservationId:e}),pe=ie.clientSecret,se=d.getElement(Zx),{error:le,paymentIntent:ce}=await l.confirmCardPayment(pe,{payment_method:{card:se,billing_details:{email:y}}});le?i(le.message):ce.status==="succeeded"&&t(ce)}catch(ie){X(`An unexpected error occurred: ${ie.message}`),i(ie.message)}finally{G(!1)}};return ne.createElement("div",null,ne.createElement("form",{onSubmit:oe},ne.createElement("div",null,ne.createElement("input",{type:"email",placeholder:"Email",value:y,onChange:te=>S(te.target.value),required:!0})),ne.createElement("div",null,ne.createElement("input",{type:"number",placeholder:"Amount (USD)",value:R,onChange:te=>a(te.target.value),required:!0})),ne.createElement("div",null,ne.createElement(Zx,null)),ne.createElement("button",{type:"submit",disabled:N||!l},N?"Processing...":"Pay")),q&&ne.createElement("p",null,q))},fre=()=>ne.createElement(QM,{stripe:hre},ne.createElement(dre,null)),pre=()=>{const[e,t]=we.useState([]),[i,l]=we.useState(null);if(we.useEffect(()=>{(async()=>{try{const S=localStorage.getItem("userId"),R=await Rn.get(`http://localhost:5000/api/auth/users/${S}`);t(R.data)}catch(S){l("Error fetching user data"),console.error(S)}})()},[]),i)return ne.createElement("div",null,i);if(!e)return ne.createElement("div",null,"Loading...");const d=()=>{};return ne.createElement("div",{className:"user-profile"},ne.createElement(Yp,null),ne.createElement(Uu,{to:"/UserReservation"},"UserReservation"),ne.createElement("h2",null,"User Profile"),ne.createElement("div",null,ne.createElement("strong",null,"Name:")," ",e.name),ne.createElement("div",null,ne.createElement("strong",null,"Email:")," ",e.email),ne.createElement("div",null,ne.createElement("strong",null,"Age:")," ",e.age),ne.createElement("div",null,ne.createElement("strong",null,"Phone:")," ",e.phoneNumber),ne.createElement("div",null,ne.createElement("strong",null,"Country:")," ",e.country),ne.createElement("div",null,ne.createElement("strong",null,"Gender:")," ",e.gender),ne.createElement("div",null,ne.createElement("button",{onClick:d()},"edit profile")))},mre=Dy(Kt.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),gre=()=>{const[e,t]=we.useState([]),[i,l]=we.useState([]),[d,y]=we.useState(""),[S,R]=we.useState(!0),[a,N]=we.useState("");we.useEffect(()=>{(async()=>{try{const oe=localStorage.getItem("userId"),te=await Rn.get(`http://localhost:5000/api/reservations/user/${oe}`);t(te.data),l(te.data)}catch(oe){console.error("Error fetching reservations:",oe),N("Error fetching reservation data.")}finally{R(!1)}})()},[]);const G=X=>{const oe=X.target.value.toLowerCase();if(y(oe),oe==="")l(e);else{const te=e.filter(ie=>ie.userId.toLowerCase().includes(oe)||ie.HotelId.name.toLowerCase().includes(oe));l(te)}},q=async X=>{try{await Rn.delete(`http://localhost:5000/api/reservations/${X}`),t(e.filter(oe=>oe._id!==X)),l(i.filter(oe=>oe._id!==X))}catch(oe){console.error("Error deleting reservation:",oe)}};return S?ne.createElement(Pu,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},ne.createElement(kJ,null)):a?ne.createElement(Pu,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},ne.createElement(A_,{variant:"h6",color:"error"},a)):ne.createElement(Pu,{p:3},ne.createElement(A_,{variant:"h4",gutterBottom:!0},"Reservation History"),ne.createElement(Pu,{mb:3},ne.createElement(M5,{fullWidth:!0,variant:"outlined",placeholder:"Search by User ID or Hotel Name",value:d,onChange:G})),ne.createElement(Cee,{component:_5},ne.createElement(pee,null,ne.createElement(Ree,null,ne.createElement(PO,null,ne.createElement(_a,null,ne.createElement("strong",null,"User ID")),ne.createElement(_a,null,ne.createElement("strong",null,"Hotel Name")),ne.createElement(_a,null,ne.createElement("strong",null,"Room Number")),ne.createElement(_a,null,ne.createElement("strong",null,"Start Date")),ne.createElement(_a,null,ne.createElement("strong",null,"End Date")),ne.createElement(_a,null,ne.createElement("strong",null,"Paid")),ne.createElement(_a,null,ne.createElement("strong",null,"Actions")))),ne.createElement(vee,null,i.map(X=>ne.createElement(PO,{key:X._id},ne.createElement(_a,null,X.userId),ne.createElement(_a,null,X.HotelId.name),ne.createElement(_a,null,X.roomId.roomNumber.join(", ")),ne.createElement(_a,null,new Date(X.startDate).toLocaleDateString()),ne.createElement(_a,null,new Date(X.endDate).toLocaleDateString()),ne.createElement(_a,null,X.isPaid?"Yes":"No"),ne.createElement(_a,null,ne.createElement(v5,{variant:"contained",color:"error",startIcon:ne.createElement(mre,null),onClick:()=>q(X._id)},"Delete"))))))))},_re=h4("pk_test_51QFvkhLAzYW8YRzjlm4VYKp19bMXpFMoHcCsHM3wda661NR4YOjHO2iyXMrDZmNqKfGUNXD5neKjeUmt1mTClIgc00RBYWEAAX");function yre(){return ne.createElement("div",{className:"container"},ne.createElement(QM,{stripe:_re},ne.createElement(IV,null,ne.createElement(hs,{path:"/",element:ne.createElement(Qee,null)}),ne.createElement(hs,{path:"/RegisterLogin",element:ne.createElement(Q$,null)}),ne.createElement(hs,{path:"/map",element:ne.createElement(cI,null)}),ne.createElement(hs,{path:"/hotels",element:ne.createElement(P5,null)}),ne.createElement(hs,{path:"/hotels/:hotelId/rooms",element:ne.createElement(tte,null)}),ne.createElement(hs,{path:"/hotels/:hotelId/rooms/:roomId",element:ne.createElement(ure,null)}),ne.createElement(hs,{path:"/reservation/:roomId/:hotelId",element:ne.createElement(N5,null)}),ne.createElement(hs,{path:"/HotelFltring",element:ne.createElement(ete,null)}),ne.createElement(hs,{path:"/UserProfile",element:ne.createElement(pre,null)}),ne.createElement(hs,{path:"/UserReservation",element:ne.createElement(gre,null)}),ne.createElement(hs,{path:"/payment/:reservationId",element:ne.createElement(fre,null)}))))}Yz(document.getElementById("root")).render(ne.createElement(LV,null,ne.createElement(V$,null,ne.createElement(yre,null))));
